import "dart:async";import "dart:typed_data";import "dart:io";import "dart:io" as Mb;import "dart:convert";import "dart:math";import "dart:math" as bI;import "dart:isolate";import "dart:collection";class ZN extends IterableBase<QD>{List<QD> KF=[] ;String JJ;void qh(QD A){KF.add(A);}int get length=>KF.length;QD operator[](int A)=>KF[A];QD Kv(String B){for(QD A in KF){if(A.name==B){return A;}}return null;}int bw(){return KF.length;}QD get first=>KF.first;QD get last=>KF.last;bool get isEmpty=>KF.isEmpty;bool get isNotEmpty=>KF.isNotEmpty;Iterator<QD> get iterator=>KF.iterator;}class QD{static const int Pb=0;static const int Il=8;String name;int size;int mode;int MEB=0;int qv=0;int KEB;bool r$=true;int QH;String JJ;bool ZZ=true;QD(this.name,this.size,A,[this.SEB=Pb]){if(A is List<int>){TEB=A;UEB=new UC(TEB);}else if(A is UC){UEB=new UC.SCB(A);}}List<int> get oF{if(TEB==null){bU();}return TEB;}void bU(){if(TEB==null){if(SEB==Il){var A=UEB.tR();TEB=Jy.decode(A);}else{TEB=UEB.tR();}SEB=Pb;}}bool get uO=>SEB!=Pb;int get Z_=>SEB;UC get GBB=>UEB;String toString()=>name;int SEB;UC UEB;List<int> TEB;static final ZLibCodec Jy=new ZLibCodec(raw:true);}class cH implements Exception{final String message;cH(this.message);String toString()=>"ArchiveException: ${message}";}const int El=0;const int xR=1;int qV(List<int> B,[int A=0]){int D=B.length;A=A^0xffffffff;int C=0;while(D>=8){A=XK[(A^B[C++ ])&0xff]^(A>>8);A=XK[(A^B[C++ ])&0xff]^(A>>8);A=XK[(A^B[C++ ])&0xff]^(A>>8);A=XK[(A^B[C++ ])&0xff]^(A>>8);A=XK[(A^B[C++ ])&0xff]^(A>>8);A=XK[(A^B[C++ ])&0xff]^(A>>8);A=XK[(A^B[C++ ])&0xff]^(A>>8);A=XK[(A^B[C++ ])&0xff]^(A>>8);D-= 8;}if(D>0)do{A=XK[(A^B[C++ ])&0xff]^(A>>8);}while( --D>0);return A^0xffffffff;}const List<int> XK=const[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];class UC{final List<int> buffer;int offset;final int start;final int byteOrder;UC(A,{this.byteOrder: El,int start: 0,int length}):this.buffer=A is ByteData?new Uint8List.view(A.buffer):A,this.start=start{VEB=length==null?buffer.length:length;offset=start;}UC.SCB(UC A):buffer=A.buffer,offset=A.offset,start=A.start,VEB=A.VEB,byteOrder=A.byteOrder;int get position=>offset-start;int get length=>VEB-(offset-start);bool get oU=>offset>=(start+VEB);void reset(){offset=start;}int operator[](int A)=>buffer[offset+A];UC KP([int A,int B]){if(A==null){A=this.offset;}else{A+= start;}if(B==null||B<0){B=VEB-(A-start);}return new UC(buffer,byteOrder:byteOrder,start:A,length:B);}int indexOf(int B,[int C=0]){for(int A=this.offset+C,D=this.offset+length;A<D; ++A){if(buffer[A]==B){return A-this.start;}}return -1;}void skip(int A){offset+= A;}int readByte(){return buffer[offset++ ];}UC PV(int B){UC A=KP(this.offset-start,B);offset+= A.length;return A;}String Ya([int A]){if(A==null){List<int> B=[] ;while(!oU){int C=readByte();if(C==0){return new String.fromCharCodes(B);}B.add(C);}throw new cH('EOF reached without finding string terminator');}UC D=PV(A);Uint8List G=D.tR();String H=new String.fromCharCodes(G);return H;}int uC(){int A=buffer[offset++ ]&0xff;int B=buffer[offset++ ]&0xff;if(byteOrder==xR){return (A<<8)|B;}return (B<<8)|A;}int OD(){int A=buffer[offset++ ]&0xff;int B=buffer[offset++ ]&0xff;int C=buffer[offset++ ]&0xff;int D=buffer[offset++ ]&0xff;if(byteOrder==xR){return (A<<24)|(B<<16)|(C<<8)|D;}return (D<<24)|(C<<16)|(B<<8)|A;}int vL(){int A=buffer[offset++ ]&0xff;int B=buffer[offset++ ]&0xff;int C=buffer[offset++ ]&0xff;int D=buffer[offset++ ]&0xff;int G=buffer[offset++ ]&0xff;int H=buffer[offset++ ]&0xff;int I=buffer[offset++ ]&0xff;int J=buffer[offset++ ]&0xff;if(byteOrder==xR){return (A<<56)|(B<<48)|(C<<40)|(D<<32)|(G<<24)|(H<<16)|(I<<8)|J;}return (J<<56)|(I<<48)|(H<<40)|(G<<32)|(D<<24)|(C<<16)|(B<<8)|A;}Uint8List tR(){int A=length;if(buffer is Uint8List){Uint8List B=buffer;Uint8List C=new Uint8List.view(B.buffer,offset,A);return C;}return new Uint8List.fromList(buffer.sublist(offset,offset+A));}int VEB;}class YN{int length;final int byteOrder;YN({int size: rV,this.byteOrder: El}):WEB=new Uint8List(size==null?rV:size),length=0;List<int> sZ(){return new Uint8List.view(WEB.buffer,0,length);}void clear(){WEB=new Uint8List(rV);length=0;}void reset(){VEB=0;}void writeByte(int A){if(length==WEB.length){XEB();}WEB[length++ ]=A&0xff;}void zL(List<int> B,[int A]){if(A==null){A=B.length;}while(length+A>WEB.length){XEB((length+A)-WEB.length);}WEB.setRange(length,length+A,B);length+= A;}void Cy(UC A){while(length+A.length>WEB.length){XEB((length+A.length)-WEB.length);}WEB.setRange(length,length+A.length,A.buffer,A.offset);length+= A.length;}void lD(int A){if(byteOrder==xR){writeByte((A>>8)&0xff);writeByte((A)&0xff);return;}writeByte((A)&0xff);writeByte((A>>8)&0xff);}void bH(int A){if(byteOrder==xR){writeByte((A>>24)&0xff);writeByte((A>>16)&0xff);writeByte((A>>8)&0xff);writeByte((A)&0xff);return;}writeByte((A)&0xff);writeByte((A>>8)&0xff);writeByte((A>>16)&0xff);writeByte((A>>24)&0xff);}List<int> KP(int B,[int A]){if(B<0){B=(length)+B;}if(A==null){A=length;}else if(A<0){A=length+A;}return new Uint8List.view(WEB.buffer,B,A-B);}void XEB([int A]){int B=rV;if(A!=null){if(A>B){B=A;}}Uint8List C=new Uint8List(WEB.length+B);C.setRange(0,WEB.length,WEB);WEB=C;}static const int rV=0x8000;Uint8List WEB;}class pV{static const int Hl=0x06054b50;static const int Gy=0x07064b50;static const int Jl=20;static const int Iy=0x06064b50;int ci=-1;int cw=0;int wu=0;int jx=0;int ix=0;int Ci;int Bi;String MCB='';List<XN> Jv=[] ;pV.TCB(UC A){ci=YEB(A);A.offset=ci;int G=A.OD();cw=A.uC();wu=A.uC();jx=A.uC();ix=A.uC();Ci=A.OD();Bi=A.OD();int C=A.uC();if(C>0){MCB=A.Ya(C);}ZEB(A);UC B=A.KP(Bi,Ci);while(!B.oU){int D=B.OD();if(D!=XN.Fl){break;}Jv.add(new XN(B,A));}}void ZEB(UC A){int C=A.offset;int G=ci-Jl;UC B=A.KP(G,Jl);int D=B.OD();if(D!=Gy){A.offset=C;return;}int Q=B.OD();int H=B.vL();int S=B.OD();A.offset=H;D=A.OD();if(D!=Iy){A.offset=C;return;}int Z=A.vL();int h=A.uC();int p=A.uC();int I=A.OD();int J=A.OD();int K=A.vL();int M=A.vL();int O=A.vL();int P=A.vL();cw=I;wu=J;jx=K;ix=M;Ci=O;Bi=P;A.offset=C;}int YEB(UC A){int C=A.offset;int D=A.length;for(int B=D-4;B>0; --B){A.offset=B;int G=A.OD();if(G==Hl){A.offset=C;return B;}}throw new cH('Could not find End of Central Directory Record');}}class WK{static const int Nb=0;static const int Ob=8;static const int Qb=0x04034b50;int Qx=Qb;int version=0;int Mv=0;int MR=0;int y$=0;int x$=0;int QH;int LR;int PP;String MJ='';List<int> bi=[] ;XN tv;WK([UC A,this.tv]){if(A!=null){Qx=A.OD();if(Qx!=Qb){throw new cH('Invalid Zip Signature');}version=A.uC();Mv=A.uC();MR=A.uC();y$=A.uC();x$=A.uC();QH=A.OD();LR=A.OD();PP=A.OD();int C=A.uC();int D=A.uC();MJ=A.Ya(C);bi=A.PV(D).tR();UEB=A.PV(tv.LR);if(Mv&0x08!=0){int B=A.OD();if(B==0x08074b50){QH=A.OD();}else{QH=B;}LR=A.OD();PP=A.OD();}}}List<int> get oF{if(TEB==null){if(MR==Ob){TEB=new Dl.RCB(UEB,PP).sZ();MR=Nb;}else{TEB=UEB.tR();}}return TEB;}String toString()=>MJ;UC UEB;List<int> TEB;int aEB;}class XN{static const int Fl=0x02014b50;int ICB=0;int JCB=0;int J$=0;int MR=0;int AAB=0;int z$=0;int QH;int LR;int PP;int vu;int m$;int C$;int Gj;String MJ='';List<int> bi=[] ;String D$='';WK file;XN([UC A,UC D]){if(A!=null){ICB=A.uC();JCB=A.uC();J$=A.uC();MR=A.uC();AAB=A.uC();z$=A.uC();QH=A.OD();LR=A.OD();PP=A.OD();int G=A.uC();int H=A.uC();int I=A.uC();vu=A.uC();m$=A.uC();C$=A.OD();Gj=A.OD();if(G>0){MJ=A.Ya(G);}if(H>0){UC B=A.PV(H);bi=B.tR();int J=B.uC();int C=B.uC();if(J==1){if(C>=8){PP=B.vL();}if(C>=16){LR=B.vL();}if(C>=24){Gj=B.vL();}if(C>=28){vu=B.OD();}}}if(I>0){D$=A.Ya(I);}if(D!=null){D.offset=Gj;file=new WK(D,this);}}}String toString()=>MJ;}class Gl{pV tu;ZN ou(List<int> A,{bool verify: false}){return i_(new UC(A),verify:verify);}ZN i_(UC D,{bool verify: false}){tu=new pV.TCB(D);ZN B=new ZN();for(XN G in tu.Jv){WK A=G.file;if(verify){int H=qV(A.oF);if(H!=A.QH){throw new cH('Invalid CRC for file in archive.');}}var I=A.TEB!=null?A.TEB:A.UEB;QD C=new QD(A.MJ,A.PP,I,A.MR);C.QH=A.QH;B.qh(C);}return B;}}class Fy{List<int> encode(ZN H,{int level: Ey.Hy}){DateTime C=new DateTime.now();int O=((C.minute&0x7)<<5)|(C.second~/2);int P=(C.hour<<3)|(C.minute>>3);int Q=((P&0xff)<<8)|(O&0xff);int S=((C.month&0x7)<<5)|C.day;int Z=(((C.year-1980)&0x7f)<<1)|(C.month>>3);int h=((Z&0xff)<<8)|(S&0xff);int J=0;int K=0;int M=0;Map<QD,Map> B={};for(QD A in H.KF){B[A]={};B[A]['time']=Q;B[A]['date']=h;UC D;int G;if(!A.ZZ){if(A.uO){A.bU();}D=new UC(A.oF);if(A.QH!=null){G=A.QH;}else{G=qV(A.oF);}}else if(!A.ZZ||A.Z_==QD.Il){D=A.GBB;if(A.QH!=null){G=A.QH;}else{G=qV(A.oF);}}else{G=qV(A.oF);List<int> p=new ZLibCodec(level:level==null?ZLibOption.DEFAULT_LEVEL:level,raw:true).encode(A.oF);D=new UC(p);}J+= 30+A.name.length+D.length;K+= 46+A.name.length+(A.JJ!=null?A.JJ.length:0);B[A]['crc']=G;B[A]['size']=D.length;B[A]['data']=D;}M=46+(H.JJ!=null?H.JJ.length:0);int EB=J+K+M;YN I=new YN(size:EB);for(QD A in H.KF){B[A]['pos']=I.length;bEB(A,B,I);}cEB(H,B,I);return I.sZ();}void bEB(QD B,Map C,YN A){A.bH(WK.Qb);int H=Kl;int I=0;int J=B.ZZ?WK.Ob:WK.Nb;int K=C[B]['time'];int M=C[B]['date'];int O=C[B]['crc'];int P=C[B]['size'];int Q=B.size;String D=B.name;List<int> G=[] ;UC S=C[B]['data'];A.lD(H);A.lD(I);A.lD(J);A.lD(K);A.lD(M);A.bH(O);A.bH(P);A.bH(Q);A.lD(D.length);A.lD(G.length);A.zL(D.codeUnits);A.zL(G);A.Cy(S);}void cEB(ZN C,Map D,YN A){int G=A.length;int H=Kl;int O=Ky;for(QD B in C.KF){int P=(O<<8)|H;int Q=H;int S=0;int Z=B.ZZ?WK.Ob:WK.Nb;int h=D[B]['time'];int p=D[B]['date'];int EB=D[B]['crc'];int PB=D[B]['size'];int TB=B.size;int UB=0;int dB=0;int sB=0;int tB=D[B]['pos'];String I=B.name;List<int> J=[] ;String K=(B.JJ==null?'':B.JJ);A.bH(XN.Fl);A.lD(P);A.lD(Q);A.lD(S);A.lD(Z);A.lD(h);A.lD(p);A.bH(EB);A.bH(PB);A.bH(TB);A.lD(I.length);A.lD(J.length);A.lD(K.length);A.lD(UB);A.lD(dB);A.bH(sB);A.bH(tB);A.zL(I.codeUnits);A.zL(J);A.zL(K.codeUnits);}int KC=0;int TC=0;int xC=C.bw();int fD=C.bw();int gD=A.length-G;int mD=G;String M=(C.JJ==null?'':C.JJ);A.bH(pV.Hl);A.lD(KC);A.lD(TC);A.lD(xC);A.lD(fD);A.bH(gD);A.bH(mD);A.lD(M.length);A.zL(M.codeUnits);}static const int Kl=20;static const int Ky=0;}class Ey{static const int Hy=1;}class yG{Uint32List LP;int xU=0;int Sw=0x7fffffff;yG(List<int> B){int I=B.length;for(int A=0;A<I; ++A){if(B[A]>xU){xU=B[A];}if(B[A]<Sw){Sw=B[A];}}int J=1<<xU;LP=new Uint32List(J);for(int D=1,G=0,K=2;D<=xU;){for(int A=0;A<I; ++A){if(B[A]==D){int H=0;int M=G;for(int C=0;C<D; ++C){H=(H<<1)|(M&1);M>>= 1;}for(int C=H;C<J;C+= K){LP[C]=(D<<16)|A;} ++G;}} ++D;G<<= 1;K<<= 1;}}}class Dl{UC input;final YN nE;Dl.RCB(UC A,[int B]):input=A,nE=new YN(size:B){dEB();}List<int> sZ(){return nE.sZ();}void dEB(){eEB=0;fEB=0;while(gEB());}bool gEB(){if(input.oU){return false;}int A=hEB(3);bool C=(A&0x1)!=0;int B=A>>1;switch (B){case Ly:iEB();break;case My:jEB();break;case Ny:kEB();break;default:throw new cH('unknown BTYPE: ${B}');}return !C;}int hEB(int A){if(A==0){return 0;}while(fEB<A){if(input.oU){throw new cH('input buffer is broken');}int B=input.readByte();eEB|= B<<fEB;fEB+= 8;}int B=eEB&((1<<A)-1);eEB>>= A;fEB-= A;return B;}int lEB(yG A){List<int> G=A.LP;int B=A.xU;while(fEB<B){if(input.oU){break;}int H=input.readByte();eEB|= H<<fEB;fEB+= 8;}int C=G[eEB&((1<<B)-1)];int D=C>>16;eEB>>= D;fEB-= D;return C&0xffff;}void iEB(){eEB=0;fEB=0;int A=hEB(16);int B=hEB(16);if(A==~B){throw new cH('Invalid uncompressed block header');}if(A>input.length){throw new cH('Input buffer is broken');}nE.Cy(input.PV(A));}void jEB(){mEB(nEB,oEB);}void kEB(){int B=hEB(5)+257;int C=hEB(5)+1;int H=hEB(4)+4;Uint8List D=new Uint8List(Ll.length);for(int A=0;A<H; ++A){D[Ll[A]]=hEB(3);}yG G=new yG(D);Uint8List I=new Uint8List(B);Uint8List J=new Uint8List(C);List<int> K=pEB(B,G,I);List<int> M=pEB(C,G,J);mEB(new yG(K),new yG(M));}void mEB(yG H,yG I){while(true){int A=lEB(H);if(A<0||A>285){throw new cH('Invalid Huffman Code ${A}');}if(A==256){break;}if(A<256){nE.writeByte(A&0xff);continue;}int G=A-257;int C=Qy[G]+hEB(Ry[G]);int D=lEB(I);if(D>=0&&D<=29){int B=Sy[D]+hEB(Ty[D]);while(C>B){nE.zL(nE.KP(-B));C-= B;}if(C==B){nE.zL(nE.KP(-B));}else{nE.zL(nE.KP(-B,C-B));}}else{throw new cH('Illegal unused distance symbol');}}while(fEB>=8){fEB-= 8;input.offset-- ;}}List<int> pEB(int H,yG I,List<int> B){int G=0;int C=0;while(C<H){int A=lEB(I);switch (A){case 16:int D=3+hEB(2);while(D-- >0){B[C++ ]=G;}break;case 17:int D=3+hEB(3);while(D-- >0){B[C++ ]=0;}G=0;break;case 18:int D=11+hEB(7);while(D-- >0){B[C++ ]=0;}G=0;break;default:if(A<0||A>15){throw new cH('Invalid Huffman Code: ${A}');}B[C++ ]=A;G=A;break;}}return B;}int eEB=0;int fEB=0;int qEB=0;static const int Ly=0;static const int My=1;static const int Ny=2;static const List<int> Oy=const[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8];final yG nEB=new yG(Oy);static const List<int> Py=const[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];final yG oEB=new yG(Py);static const List<int> Ll=const[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];static const List<int> Qy=const[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];static const List<int> Ry=const[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];static const List<int> Sy=const[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];static const List<int> Ty=const[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];}class dH{final Map<String,vE> rEB;final Map<String,dH> sEB;final Map<String,vE> bD;final Map<String,dH> ju;final tEB=[] ;final bool Yu;factory dH({bool allowTrailingOptions: false})=>new dH.UCB(<String,vE>{},<String,dH>{},allowTrailingOptions:allowTrailingOptions);dH.UCB(Map<String,vE> A,Map<String,dH> B,{bool allowTrailingOptions: false}):this.rEB=A,this.bD=new UnmodifiableMapView(A),this.sEB=B,this.ju=new UnmodifiableMapView(B),this.Yu=allowTrailingOptions!=null?allowTrailingOptions:false;void Vu(String A,{String abbr,String help,bool defaultsTo: false,bool negatable: true,void callback(bool value),bool hide: false}){uEB(A,abbr,help,null,null,null,defaultsTo,callback,RG.Nl,negatable:negatable,hide:hide);}void JI(String A,{String abbr,String help,String valueHelp,List<String> allowed,Map<String,String> allowedHelp,String defaultsTo,void callback(value),bool allowMultiple: false,bool splitCommas,bool hide: false}){if(!allowMultiple&&splitCommas!=null){throw new ArgumentError('splitCommas may not be set if allowMultiple is false.');}uEB(A,abbr,help,valueHelp,allowed,allowedHelp,defaultsTo,callback,allowMultiple?RG.Rb:RG.Wy,splitCommas:splitCommas,hide:hide);}void uEB(String A,String B,String G,String H,List<String> I,Map<String,String> J,K,void M(value),RG O,{bool negatable: false,bool splitCommas,bool hide: false}){if(rEB.containsKey(A)){throw new ArgumentError('Duplicate option "${A}".');}if(B!=null){var C=oZ(B);if(C!=null){throw new ArgumentError('Abbreviation "${B}" is already used by "${C.name}".');}}var D=Vy(A,B,G,H,I,J,K,M,O,negatable:negatable,splitCommas:splitCommas,hide:hide);rEB[A]=D;tEB.add(D);}YK BE(List<String> A)=>new yR(null,this,A.toList()).BE();String get xx=>new Ol(tEB).Uv();vE oZ(String A){return bD.values.firstWhere((B)=>B.uM==A,orElse:()=>null);}}YK Uy(dH A,Map<String,dynamic> B,String C,YK D,List<String> G,List<String> H){return new YK.VCB(A,B,C,D,G,H);}class YK{final dH vEB;final Map<String,dynamic> wEB;final String name;final YK command;final List<String> NK;final List<String> arguments;YK.VCB(this.vEB,this.wEB,this.name,this.command,List<String> A,List<String> B):this.NK=new UnmodifiableListView(A),this.arguments=new UnmodifiableListView(B);operator[](String A){if(!vEB.bD.containsKey(A)){throw new ArgumentError('Could not find an option named "${A}".');}return vEB.bD[A].iv(wEB[A]);}Iterable<String> get bD{var A=new Set<String>.from(wEB.keys);vEB.bD.forEach((B,C){if(C.HF!=null)A.add(B);});return A;}}class Tl extends bC{List<int> SF;int rx;Tl.eCB(Uint8List A):super.iCB(A){rx=A[0];SF=iV().sublist(1);}Uint8List xEB(){var A=[rx];A.addAll(SF);yEB=A.length;zEB();AFB(A);return BFB;}String toString()=>"BitString(${SF})";}class sV extends bC{bool CFB;sV(this.CFB,{tag: Sl}):super(tag:tag){yEB=1;}sV.cCB(Uint8List A):super.iCB(A){var B=A[DFB];CFB=(B==bl);}Uint8List xEB(){super.zEB();super.AFB([CFB==true?bl:hy]);return BFB;}}const int Sl=0x01;const int Ul=0x02;const int dy=0x03;const int Vl=0x04;const int Wl=0x05;const int Xl=0x0A;const int ey=0x13;const int fy=0x17;const int tV=0x30;const int al=0x31;const int gy=0x06;const int bl=0xff;const int hy=0x00;class Sb extends SG{Sb(int A,{tag: Xl}):super(A,tag:tag);}class AS{String message;AS(this.message);}class SG extends bC{var NG;SG(this.NG,{tag: Ul}):super(tag:tag);SG.YCB(Uint8List A):super.iCB(A){NG=ly(this.iV());}Uint8List xEB(){var A=jy(this.NG);yEB=A.length;super.zEB();AFB(A);return BFB;}static Uint8List jy(var B){var C;if(B is e){C=new Uint8List.fromList(B.MP());}else{var H=new Int64List(1);H[0]=B;var D=new Uint8List.view(H.buffer);int A=7;var I=0;if(B.isNegative){I=0xFF;}while(D[A]==I&&A>0) --A;if(B.isNegative){if((D[A]&0x80)==0){ ++A;}}else{if((D[A]&0x80)!=0){ ++A;}}C=new Uint8List(A+1);for(int G=0;G<(A+1); ++G){C[G]=D[A-G];}}return C;}static dynamic ly(Uint8List A,{int offset: 0}){if(A.length-offset>8)return new e(A.sublist(offset));var H=(A[offset]&0x80)==0?0:0xFF;var C=new Int64List(1);var D=new Uint8List.view(C.buffer);int B=0;int G=A.length-1;while(G>=offset){D[B++ ]=A[G-- ];}while(B<=7){D[B++ ]=H;}return C[0];}String toString()=>"ASNInteger(${NG})";}class nP{int EFB;int get length=>EFB;int DFB;int get GCB=>DFB;nP(this.EFB,this.DFB);static Uint8List iy(int C){Uint8List A;if(C<=127){A=new Uint8List(1);A[0]=C;}else{var G=new Uint32List(1);G[0]=C;var H=new Uint8List.view(G.buffer);int B=3;while(H[B]==0) --B;A=new Uint8List(B+2);A[0]=0x80+B+1;for(int D=1;D<A.length; ++D)A[D]=H[B-- ];}return A;}static nP ky(Uint8List B){int C=2;int A=(B[1]&0x7F);if(A!=B[1]){int G=A;A=0;for(int D=0;D<G;D++ ){A<<= 8;A|= (B[C++ ]&0xFF);}}return new nP(A,C);}}class Rl extends bC{static final by=[Wl,0x00];List get RI=>by;Rl.aCB(Uint8List A):super.iCB(A);}class bC{final int FFB;int get tag=>FFB;Uint8List BFB;Uint8List get RI{if(BFB==null)xEB();return BFB;}bC({int tag: 0}):FFB=tag;bC.iCB(A):FFB=A[0]{BFB=A;GFB();}void GFB(){nP A=nP.ky(BFB);yEB=A.length;DFB=A.GCB;}int get kx=>DFB+yEB;int yEB;int DFB=2;Uint8List zEB(){if(BFB==null){Uint8List A=nP.iy(yEB);BFB=new Uint8List(1+A.length+yEB);BFB[0]=tag;BFB.setRange(1,1+A.length,A,0);DFB=1+A.length;}return BFB;}Uint8List xEB()=>zEB();Uint8List iV(){return new Uint8List.view(BFB.buffer,DFB+BFB.offsetInBytes,yEB);}void AFB(List<int> A){this.RI.setRange(DFB,DFB+A.length,A);}jBB()=>ay.cy(RI);String toString()=>"ASN1Object(tag=${tag.toRadixString(16)} valueByteLength=${yEB}) startpos=${DFB} bytes=${jBB()}";}class Ql extends bC{List<int> dw;Ql.ZCB(Uint8List A):super.iCB(A);Uint8List xEB(){yEB=dw.length;super.zEB();AFB(dw);return BFB;}}class yC extends bC{Uint8List CP;yC(dynamic A,{int tag: Vl}):super(tag:tag){if(A is String)this.CP=new Uint8List.fromList(A.codeUnits);else if(A is Uint8List)this.CP=A;else if(A is List<int>)this.CP=new Uint8List.fromList(A);else throw new ArgumentError("Parameters octets should be either of type String or List<int>.");}yC.hCB(Uint8List A):super.iCB(A){CP=iV();}String get SF=>new String.fromCharCodes(CP);Uint8List xEB(){yEB=CP.length;zEB();AFB(CP);return BFB;}String toString()=>"OctetString(${SF})";}class Tb{Uint8List HFB;Tb(this.HFB);int IFB=0;bool hasNext(){return IFB<HFB.length;}bC aw(){int A=HFB[IFB];bool D=(0xC0&A)==0;bool G=(0x40&A)!=0;int H=HFB.length-IFB;var C=new Uint8List.view(HFB.buffer,IFB+HFB.offsetInBytes,H);bC B=null;if(D)B=JFB(A,C);else if(G){if((A&tV)!=0)B=new HC.dCB(C);else throw new AS("Parser for tag ${A} not implemented yet");}else{B=new bC.iCB(C);}IFB=IFB+B.kx;return B;}bC JFB(int B,Uint8List A){switch (B){case tV:return new HC.dCB(A);case Vl:return new yC.hCB(A);case Ul:case Xl:return new SG.YCB(A);case al:return new mP.bCB(A);case Sl:return new sV.cCB(A);case gy:return new Ql.ZCB(A);case dy:return new Tl.eCB(A);case Wl:return new Rl.aCB(A);case ey:return new Yl.fCB(A);case fy:return new Zl.gCB(A);default:throw new AS("Parser for tag ${B} not implemented yet");}}}class Yl extends bC{String SF;List<int> fV;Yl.fCB(Uint8List A):super.iCB(A){fV=A.sublist(0,2);SF=new String.fromCharCodes(A.sublist(2));}Uint8List xEB(){var A=new List.from(fV);A.addAll(SF.codeUnits);yEB=A.length;zEB();AFB(A);return BFB;}String toString()=>"PrintableString(${SF})";}class HC extends bC{List<bC> fB=new List();HC.dCB(Uint8List A):super.iCB(A){if((tag&0x30)==0)throw new AS("The tag ${tag} does not look like a sequence type");KFB();}HC({int tag: tV}):super(tag:tag);add(bC A){fB.add(A);}Uint8List xEB(){yEB=LFB();super.zEB();var A=DFB;fB.forEach((C){var B=C.RI;RI.setRange(A,A+B.length,B);A+= B.length;});return BFB;}int LFB(){int A=0;fB.forEach((B){A+= B.xEB().length;});return A;}KFB(){var A=new Tb(iV());while(A.hasNext()){fB.add(A.aw());}}String toString(){var A=new StringBuffer("Seq[");fB.forEach((B){A.write(B.toString());A.write(" ");});A.write("]");return A.toString();}}class mP extends bC{Set<bC> fB=new Set<bC>();mP.bCB(Uint8List A):super.iCB(A){if((tag&0x30)==0)throw new AS("The tag ${tag} does not look like a set type");MFB();}mP({int tag: al}):super(tag:tag);add(bC A){fB.add(A);}Uint8List xEB(){yEB=LFB();super.zEB();var A=DFB;fB.forEach((C){var B=C.RI;RI.setRange(A,A+B.length,B);A+= B.length;});return BFB;}int LFB(){int A=0;fB.forEach((B){B.xEB();A+= B.RI.length;});return A;}MFB(){var A=new Tb(iV());while(A.hasNext()){fB.add(A.aw());}}String toString(){var A=new StringBuffer("Set[");fB.forEach((B){A.write(B.toString());A.write(" ");});A.write("]");return A.toString();}}class Zl extends bC{DateTime Qi;List<int> fV;Zl.gCB(Uint8List B):super.iCB(B){fV=B.sublist(0,2);var C=B.sublist(2).indexOf(13)+2-1;if(C<=0)C=B.length;var A=new String.fromCharCodes(B.sublist(2,C));var D=int.parse(A.substring(0,2));if(D>75)A="19"+A;else A="20"+A;A=A.substring(0,8)+"T"+A.substring(8);Qi=DateTime.parse(A);}Uint8List xEB(){var B=new List.from(fV);var A=Qi.toUtc();var C=A.year.toString().substring(2).padLeft(2,"0");var D=A.month.toString().padLeft(2,"0");var G=A.day.toString().padLeft(2,"0");var H=A.hour.toString().padLeft(2,"0");var I=A.minute.toString().padLeft(2,"0");var J=A.second.toString().padLeft(2,"0");var K="${C}${D}${G}${H}${I}${J}Z";B.addAll(K.codeUnits);yEB=B.length;zEB();AFB(B);return BFB;}String toString()=>"UtcTime(${Qi})";}class ay{static String cy(List<int> C){StringBuffer A=new StringBuffer("[");bool B=false;C.forEach((D){B?A.write(", "):B=true;A.write("0x${D.toRadixString(16)}");});A.write("]");return A.toString();}}abstract class e{static bool oP=(){if(0.0 is int){return true;}try {return 3.modInverse(7)==-1;}catch (A){return true;}return false;}();static e get ny{if(oP){return i.eH(0);}else{return AB.uV(0);}}static e get ZK{if(oP){return i.eH(1);}else{return AB.uV(1);}}static e get Vb{if(oP){return i.eH(2);}else{return AB.uV(2);}}static e get gl{if(oP){return i.eH(3);}else{return AB.uV(3);}}factory e([A,B,C]){if(oP){return new i(A,B,C);}else{return new AB(A,B,C);}}factory e.jCB(int A,List<int> B){if(oP){return new i.lCB(A,B);}else{return new AB.kCB(A,B);}}}class AB implements e{static AB uV(int A){return new AB(A);}int data;AB([A,B,C]){if(A!=null){if(A is int){data=A;}else if(A is num){data=A.toInt();}else if(A is List){this.fi(A);}else{this.TR(A,B);}}}factory AB.kCB(int B,List<int> C){AB A=new AB();if(B!=0){A.fi(C,true);}else{A.fi(C,false);}if(B<0){A.data=-A.data;}return A;}void yM(AB A){A.data=data;}void qZ(int A){data=A;}void TR(String A,int B){data=int.parse(A,radix:B,onError:(C)=>0);}void fi(List B,[bool G=false]){if(B==null||B.length==0){data=0;return;}bool D=false;if(!G&&B[0]&0xFF>0x7F){D=true;}if(D){int A=0;for(int C in B){A=(A<<8)|(~((C&0xFF)-256));}data=~A;}else{int A=0;for(int C in B){A=(A<<8)|(C&0xFF);}data=A;}}String toString([int A=10]){return data.toRadixString(A);}fR(){return new AB(-data);}AB abs(){return (data<0)?this.fR():this.xM();}int compareTo(A){if(A is num){return data.compareTo(A);}if(A is AB){return data.compareTo(A.data);}return 0;}int La(A){var C=1,B;if(A is num)A=A.toInt();if((B=A>>16)!=0){A=B;C+= 16;}if((B=A>>8)!=0){A=B;C+= 8;}if((B=A>>4)!=0){A=B;C+= 4;}if((B=A>>2)!=0){A=B;C+= 2;}if((B=A>>1)!=0){A=B;C+= 1;}return C;}int bitLength(){return data.bitLength;}void sU(int A,B){B.data=data<<A;}void KK(int A,B){B.data=data>>A;}void vC(A,B){B.data=data-A.data;}void BV(A,B){B.data=data*A.data;}void ha(A){A.data=data*data;}AN(AB A,AB B,AB C){B.data=data~/A.data;C.data=data%A.data;}AV(A){return new AB(data%A.data);}isEven(){return data.isEven;}isOdd(){return data.isOdd;}xM(){return new AB(this.data);}int NG(){return data;}int oG(){return data.sign;}String Yk([int A=10]){return data.toRadixString(A);}void Rv(A,B){data=int.parse(A,radix:B,onError:(C)=>0);}List<int> MP(){String G;bool M=false;if(data<0){G=(~data).toRadixString(16);M=true;}else{G=data.toRadixString(16);}int D=0;int K=G.length;int I=(K+1)~/2;int J=0;List A;if(M){if(K&1==1){D=-1;}int B=~int.parse(G.substring(0,D+2),radix:16);if(B<-128)B+= 256;if(B>=0){J=1;A=new List<int>(I+1);A[0]=-1;A[1]=B;}else{A=new List<int>(I);A[0]=B;}for(int C=1;C<I; ++C){int H=~int.parse(G.substring(D+(C<<1),D+(C<<1)+2),radix:16);if(H<-128)H+= 256;A[C+J]=H;}}else{if(K&1==1){D=-1;}int B=int.parse(G.substring(0,D+2),radix:16);if(B>127)B-= 256;if(B<0){J=1;A=new List<int>(I+1);A[0]=0;A[1]=B;}else{A=new List<int>(I);A[0]=B;}for(int C=1;C<I; ++C){int H=int.parse(G.substring(D+(C<<1),D+(C<<1)+2),radix:16);if(H>127)H-= 256;A[C+J]=H;}}return A;}bool JF(AB A){return this.compareTo(A)==0?true:false;}AB min(AB A){return (this.compareTo(A)<0)?this:A;}AB max(AB A){return (this.compareTo(A)>0)?this:A;}void VZ(AB A,Function B,AB C){C.data=B(data,A.data);}jw(A,B){return A&B;}kO(A){return new AB(data&A.data);}kw(A,B){return A|B;}IK(A){return new AB(data|A.data);}lw(A,B){return A^B;}Lb(A){return new AB(data^A.data);}BP(){return new AB(~data);}Mk(int A){return new AB(data<<A);}fa(int A){return new AB(data>>A);}int Cj(int A){if(A==0)return -1;int B=0;while((A&0xffffffff)==0){A>>= 32;B+= 32;}if((A&0xffff)==0){A>>= 16;B+= 16;}if((A&0xff)==0){A>>= 8;B+= 8;}if((A&0xf)==0){A>>= 4;B+= 4;}if((A&3)==0){A>>= 2;B+= 2;}if((A&1)==0) ++B;return B;}ii(){return Cj(data);}int get Ow=>ii();SJ(A){return ((data&(1<<A))!=0);}NU(A,B){B.data=data+A.data;}AB add(A){return new AB(data+A.data);}AB subtract(A){return new AB(data-A.data);}AB Pj(A){return new AB(data*A.data);}AB NR(A){return new AB(data~/A.data);}AB remainder(AB A){return new AB(data.remainder(A.data));}Mi(A){data*= A;}dZ(A,B){if(B==0){data+= A;}else{throw 'dAddOffset(${A},${B}) not implemented';}}modPow(AB A,AB B){return new AB(data.modPow(A.data,B.data));}AB modInverse(AB A){return new AB(data.modInverse(A.data));}AB operator+(AB A)=>add(A);AB operator-(AB A)=>subtract(A);AB operator*(AB A)=>Pj(A);AB operator%(AB A)=>AV(A);AB operator/(AB A)=>NR(A);AB operator~/(AB A)=>NR(A);AB operator-()=>this.fR();bool operator<(AB A)=>compareTo(A)<0?true:false;bool operator<=(AB A)=>compareTo(A)<=0?true:false;bool operator>(AB A)=>compareTo(A)>0?true:false;bool operator>=(AB A)=>compareTo(A)>=0?true:false;bool operator==(A)=>compareTo(A)==0?true:false;AB operator&(AB A)=>kO(A);AB operator|(AB A)=>IK(A);AB operator^(AB A)=>Lb(A);AB operator~()=>BP();AB operator<<(int A)=>Mk(A);AB operator>>(int A)=>fa(A);}class hl{i MC;hl(this.MC);convert(A){if(A.QB<0||A.compareTo(this.MC)>=0){return A.AV(this.MC);}else{return A;}}Dk(A){return A;}reduce(A){A.AN(this.MC,null,A);}Ka(B,C,A){B.BV(C,A);this.reduce(A);}JP(B,A){B.ha(A);this.reduce(A);}}class il{i MC;var Nj;var Oj;var Tw;var qx;var Uw;il(this.MC){this.Nj=MC.n$();this.Oj=this.Nj&0x7fff;this.Tw=this.Nj>>15;this.qx=(1<<(i.jB-15))-1;this.Uw=2*MC.U;}i convert(i B){var A=i.kC();B.abs().dU(this.MC.U,A);A.AN(this.MC,null,A);if(B.QB<0&&A.compareTo(i.XJ)>0)this.MC.vC(A,A);return A;}i Dk(i B){var A=i.kC();B.yM(A);this.reduce(A);return A;}void reduce(A){var B=A.NB;while(A.U<=this.Uw){B[A.U++ ]=0;}for(var D=0;D<this.MC.U; ++D){var C=B[D]&0x7fff;var G=(C*this.Oj+(((C*this.Tw+(B[D]>>15)*this.Oj)&this.qx)<<15))&i.UF;C=D+this.MC.U;B[C]+=this.MC.IJ(0,G,A,D,0,this.MC.U);while(B[C]>=i.TG){B[C]-=i.TG;B[ ++C]++;}}A.clamp();A.kZ(this.MC.U,A);if(A.compareTo(this.MC)>=0){A.vC(this.MC,A);}}JP(B,A){B.ha(A);this.reduce(A);}Ka(B,C,A){B.BV(C,A);this.reduce(A);}}class jl{i MC;i ON;i sj;var Vw;jl(this.MC){this.ON=i.kC();this.sj=i.kC();i.Yb.dU(2*MC.U,this.ON);this.Vw=this.ON.NR(MC);}i convert(i A){if(A.QB<0||A.U>2*this.MC.U){return A.AV(this.MC);}else if(A.compareTo(this.MC)<0){return A;}else{var B=i.kC();A.yM(B);this.reduce(B);return B;}}Dk(A){return A;}void reduce(i A){A.kZ(this.MC.U-1,this.ON);if(A.U>this.MC.U+1){A.U=this.MC.U+1;A.clamp();}this.Vw.aAB(this.ON,this.MC.U+1,this.sj);this.MC.ZAB(this.sj,this.MC.U+1,this.ON);while(A.compareTo(this.ON)<0){A.dZ(1,this.MC.U+1);}A.vC(this.ON,A);while(A.compareTo(this.MC)>=0){A.vC(this.MC,A);}}JP(B,A){B.ha(A);this.reduce(A);}Ka(B,C,A){B.BV(C,A);this.reduce(A);}}class vV<BB>{operator[](var A){return data[A];}operator[]=(var A,var B){if(A>data.length-1){data.length=A+1;}return data[A]=B;}List<BB> data=new List<BB>();}class i implements e{static int pP;static int jB;static int UF;static int TG;static int wV;static int kl;static int Wb;static int Xb;static i kC(){return new i(null,null,null);}static i eH(int B){var A=kC();A.qZ(B);return A;}static i get XJ=>eH(0);static i get Yb=>eH(1);static final List<int> ll=const[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509];static int oy;static int py=0xdeadbeefcafe;static bool qy;vV<int> NB;Function IJ;static var ml="0123456789abcdefghijklmnopqrstuvwxyz";static Map aN;int U;var QB;i([A,B,C]){sy(28);IJ=NFB;this.NB=new vV<int>();if(A!=null){if(A is int){this.TR(A.toString(),10);}else if(A is num){this.TR(A.toInt().toString(),10);}else if(B==null&&A is!String){this.TR(A,256);}else{this.TR(A,B);}}}factory i.lCB(int B,List<int> A){if(B==0)throw new ArgumentError("Argument signum must not be zero");if((A[0]&0x80)!=0){A=new Uint8List(1+A.length)..[0]=0..setRange(1,1+A.length,A);}var C=new i(A);return (B<0)?-C:C;}NFB(C,D,P,G,B,Q){var H=this.NB;var I=P.NB;var J=D.toInt()&0x3fff,K=D.toInt()>>14;while( --Q>=0){var A=H[C]&0x3fff;var M=H[C++ ]>>14;var O=K*A+M*J;A=J*A+((O&0x3fff)<<14)+I[G]+B;B=(A>>28)+(O>>14)+K*M;I[G++ ]=A&0xfffffff;}return B;}static ry(int A){pP=A;jB=pP;UF=((1<<pP)-1);TG=(1<<pP);wV=52;kl=pow(2,wV);Wb=wV-pP;Xb=2*pP-wV;}static sy(int A){if(aN!=null)return;aN=new Map();qy=((py&0xffffff)==0xefcafe);ty();oy=(1<<26)~/ll[ll.length-1];ry(A);}static ty(){ml="0123456789abcdefghijklmnopqrstuvwxyz";aN=new Map();int B,A;B="0".codeUnitAt(0);for(A=0;A<=9; ++A)aN[B++ ]=A;B="a".codeUnitAt(0);for(A=10;A<36; ++A)aN[B++ ]=A;B="A".codeUnitAt(0);for(A=10;A<36; ++A)aN[B++ ]=A;}OFB(A){return ml[A];}PFB(B,C){var A=aN[B.codeUnitAt(C)];return (A==null)?-1:A;}void yM(i B){var C=this.NB;var D=B.NB;for(var A=this.U-1;A>=0; --A)D[A]=C[A];B.U=this.U;B.QB=this.QB;}void qZ(int A){var B=this.NB;this.U=1;this.QB=(A<0)?-1:0;if(A>0){B[0]=A;}else if(A<-1){B[0]=A+TG;}else{this.U=0;}}void TR(D,int C){var G=this.NB;var B;if(C==16){B=4;}else if(C==8){B=3;}else if(C==256){B=8;}else if(C==2){B=1;}else if(C==32){B=5;}else if(C==4){B=2;}else{this.Rv(D,C);return;}this.U=0;this.QB=0;var I=D.length,J=false,A=0;while( --I>=0){var H=(B==8)?D[I]&0xff:PFB(D,I);if(H<0){if(D[I]=="-")J=true;continue;}J=false;if(A==0){G[this.U++ ]=H;}else if(A+B>jB){G[this.U-1]|=(H&((1<<(jB-A))-1))<<A;G[this.U++ ]=(H>>(jB-A));}else{G[this.U-1]|=H<<A;}A+= B;if(A>=jB)A-= jB;}if(B==8&&(D[0]&0x80)!=0){this.QB=-1;if(A>0)G[this.U-1]|=((1<<(jB-A))-1)<<A;}this.clamp();if(J)i.XJ.vC(this,this);}String toString([int D]){var H=this.NB;if(this.QB<0){return "-${this.fR().toString(D)}";}var A;if(D==16){A=4;}else if(D==8){A=3;}else if(D==2){A=1;}else if(D==32){A=5;}else if(D==4){A=2;}else{return this.Yk(D);}var K=(1<<A)-1,G,I=false,J="",C=this.U;var B=jB-(C*jB)%A;if(C-- >0){if(B<jB&&(G=H[C]>>B)>0){I=true;J=OFB(G);}while(C>=0){if(B<A){G=(H[C]&((1<<B)-1))<<(A-B);G|= H[ --C]>>(B+= jB-A);}else{G=(H[C].toInt()>>(B-= A.toInt()).toInt())&K.toInt();if(B<=0){B+= jB; --C;}}if(G>0)I=true;if(I)J="${J}${OFB(G)}";}}return I?J:"0";}fR(){var A=kC();i.XJ.vC(this,A);return A;}i abs(){return (this.QB<0)?this.fR():this;}int compareTo(B){if(B is num){B=new i(B);}var D=this.NB;var G=B.NB;var A=this.QB-B.QB;if(A!=0)return A;var C=this.U;A=C-B.U;if(A!=0)return A;while( --C>=0)if((A=D[C]-G[C])!=0)return A;return 0;}int La(A){var C=1,B;if(A is num)A=A.toInt();if((B=A>>16)!=0){A=B;C+= 16;}if((B=A>>8)!=0){A=B;C+= 8;}if((B=A>>4)!=0){A=B;C+= 4;}if((B=A>>2)!=0){A=B;C+= 2;}if((B=A>>1)!=0){A=B;C+= 1;}return C;}int bitLength(){var A=this.NB;if(this.U<=0)return 0;return jB*(this.U-1)+La(A[this.U-1]^(this.QB&UF));}void dU(B,C){var G=this.NB;var D=C.NB;var A;for(A=this.U-1;A>=0; --A)D[A+B]=G[A];for(A=B-1;A>=0; --A)D[A]=0;C.U=this.U+B;C.QB=this.QB;}void kZ(B,C){var D=this.NB;var G=C.NB;for(var A=B;A<this.U; ++A)G[A-B]=D[A];C.U=bI.max(this.U-B,0);C.QB=this.QB;}void sU(I,B){var J=this.NB;var D=B.NB;var G=I%jB;var K=jB-G;var M=(1<<K)-1;int C=I~/jB;var H=(this.QB<<G)&UF;var A;for(A=this.U-1;A>=0; --A){D[A+C+1]=(J[A]>>K)|H;H=(J[A]&M)<<G;}for(A=C-1;A>=0; --A)D[A]=0;D[C]=H;B.U=this.U+C+1;B.QB=this.QB;B.clamp();}void KK(I,C){var H=this.NB;var G=C.NB;C.QB=this.QB;var A=I~/jB;if(A>=this.U){C.U=0;return;}var D=I%jB;var J=jB-D;var K=(1<<D)-1;G[0]=H[A]>>D;for(var B=A+1;B<this.U; ++B){G[B-A-1]|=(H[B]&K)<<J;G[B-A]=H[B]>>D;}if(D>0)G[this.U-A-1]|=(this.QB&K)<<J;C.U=this.U-A;C.clamp();}void clamp(){var A=this.NB;var B=this.QB&UF;while(this.U>0&&A[this.U-1]==B){ --this.U;}}void vC(C,G){var H=this.NB;var D=G.NB;var I=C.NB;int B=0;int A=0;int J=bI.min(C.U,this.U);while(B<J){A+= (H[B].toInt()-I[B].toInt()).toInt();D[B++ ]=A&UF;A>>= jB;if(A==4294967295){A=-1;}}if(C.U<this.U){A-= C.QB;while(B<this.U){A+= H[B];D[B++ ]=A&UF;A>>= jB;if(A==4294967295){A=-1;}}A+= this.QB;}else{A+= this.QB;while(B<C.U){A-= I[B];D[B++ ]=A&UF;A>>= jB;if(A==4294967295){A=-1;}}A-= C.QB;}G.QB=(A<0)?-1:0;if(A<-1){D[B++ ]=TG+A;}else if(A>0){D[B++ ]=A;}G.U=B;G.clamp();}bool QFB=true;void BV(G,B){var J=this.NB;var H=B.NB;i C=this.abs();i D=G.abs();var I=D.NB;var A=C.U;B.U=A+D.U;while( --A>=0)H[A]=0;for(A=0;A<D.U; ++A)H[A+C.U]=C.IJ(0,I[A],B,A,0,C.U);B.QB=0;B.clamp();if(this.QB!=G.QB){i.XJ.vC(B,B);}}void ha(C){var B=this.abs();var G=B.NB;var D=C.NB;var A=C.U=2*B.U;while( --A>=0)D[A]=0;for(A=0;A<B.U-1; ++A){var H=B.IJ(A,G[A],C,2*A,0,1);if((D[A+B.U]+=B.IJ(A+1,2*G[A],C,2*A+1,H,B.U-A-1))>=TG){D[A+B.U]-=TG;D[A+B.U+1]=1;}}if(C.U>0)D[C.U-1]+=B.IJ(A,G[A],C,2*A,0,1);C.QB=0;C.clamp();}AN(i Z,D,i A){var H=Z.abs();if(H.U<=0)return;var O=this.abs();if(O.U<H.U){if(D!=null)D.qZ(0);if(A!=null)this.yM(A);return;}if(A==null)A=kC();var B=kC(),h=this.QB,EB=Z.QB;var PB=H.NB;var K=jB-La(PB[H.U-1]);if(K>0){H.sU(K,B);O.sU(K,A);}else{H.yM(B);O.yM(A);}var C=B.U;var P=B.NB;var Q=P[C-1];if(Q==0)return;var p=Q*(1<<Wb)+((C>1)?P[C-2]>>Xb:0);var TB=kl/p,UB=(1<<Wb)/p,dB=1<<Xb;var I=A.U,M=I-C;i G=(D==null)?kC():D;B.dU(M,G);var J=A.NB;if(A.compareTo(G)>=0){J[A.U++ ]=1;A.vC(G,A);}i.Yb.dU(C,G);G.vC(B,B);while(B.U<C)P[B.U++ ]=0;while( --M>=0){var S=(J[ --I]==Q)?UF:(J[I]*TB+(J[I-1]+dB)*UB).floor();if((J[I]+=B.IJ(0,S,A,M,0,C))<S){B.dU(M,G);A.vC(G,A);while(J[I]< --S)A.vC(G,A);}}if(D!=null){A.kZ(C,D);if(h!=EB)i.XJ.vC(D,D);}A.U=C;A.clamp();if(K>0)A.KK(K,A);if(h<0)i.XJ.vC(A,A);}AV(B){var A=kC();this.abs().AN(B,null,A);if(this.QB<0&&A.compareTo(i.XJ)>0)B.vC(A,A);return A;}n$(){var C=this.NB;if(this.U<1)return 0;var B=C[0];if((B&1)==0)return 0;var A=B&3;A=(A*(2-(B&0xf)*A))&0xf;A=(A*(2-(B&0xff)*A))&0xff;A=(A*(2-(((B&0xffff)*A)&0xffff)))&0xffff;A=(A*(2-B*A%TG))%TG;return (A>0)?TG-A:-A;}isEven(){var A=this.NB;return ((this.U>0)?(A[0]&1):this.QB)==0;}isOdd()=>!isEven();xM(){var A=kC();this.yM(A);return A;}int NG(){var A=this.NB;if(this.QB<0){if(this.U==1){return A[0]-TG;}else if(this.U==0)return -1;}else if(this.U==1){return A[0];}else if(this.U==0)return 0;return ((A[1]&((1<<(32-jB))-1))<<jB)|A[0];}int fu(A){return (LN2*jB/log(A)).floor().toInt();}int oG(){var A=this.NB;if(this.QB<0){return -1;}else if(this.U<=0||(this.U==1&&A[0]<=0)){return 0;}else{return 1;}}String Yk([int A=10]){if(A==null)A=10;if(this.oG()==0||A<2||A>36)return "0";var I=this.fu(A);int G=pow(A,I);var H=eH(G),B=kC(),C=kC(),D="";this.AN(H,B,C);while(B.oG()>0){D="${(G+C.NG()).toInt().toRadixString(A).substring(1)}${D}";B.AN(H,B,C);}return "${C.NG().toRadixString(A)}${D}";}void Rv(C,A){this.qZ(0);if(A==null)A=10;var H=this.fu(A);num K=pow(A,H);bool I=false;int D=0,B=0;for(var G=0;G<C.length; ++G){var J=PFB(C,G);if(J<0){if(C is String){if(C[0]=="-"&&this.oG()==0){I=true;}}continue;}B=A*B+J;if( ++D>=H){this.Mi(K);this.dZ(B,0);D=0;B=0;}}if(D>0){this.Mi(pow(A,D));if(B!=0){this.dZ(B,0);}}if(I){i.XJ.vC(this,this);}}List<int> MP(){var G=this.NB;var C=this.U;vV<int> H=new vV<int>();H[0]=this.QB;var A=jB-(C*jB)%8,B,D=0;if(C-- >0){if(A<jB&&(B=G[C]>>A)!=(this.QB&UF)>>A){H[D++ ]=B|(this.QB<<(jB-A));}while(C>=0){if(A<8){B=(G[C]&((1<<A)-1))<<(8-A);B|= G[ --C]>>(A+= jB-8);}else{B=(G[C]>>(A-= 8))&0xff;if(A<=0){A+= jB; --C;}}if((B&0x80)!=0)B|= -256;if(D==0&&(this.QB&0x80)!=(B&0x80)) ++D;if(D>0||B!=this.QB)H[D++ ]=B;}}return H.data;}bool JF(i A){return this.compareTo(A)==0?true:false;}i min(i A){return (this.compareTo(A)<0)?this:A;}i max(i A){return (this.compareTo(A)>0)?this:A;}void VZ(i B,Function D,i C){var J=this.NB;var K=B.NB;var H=C.NB;var A,G,I=bI.min(B.U,this.U);for(A=0;A<I; ++A)H[A]=D(J[A],K[A]);if(B.U<this.U){G=B.QB&UF;for(A=I;A<this.U; ++A)H[A]=D(J[A],G);C.U=this.U;}else{G=this.QB&UF;for(A=I;A<B.U; ++A)H[A]=D(G,K[A]);C.U=B.U;}C.QB=D(this.QB,B.QB);C.clamp();}jw(A,B){return A&B;}kO(B){var A=kC();this.VZ(B,jw,A);return A;}kw(A,B){return A|B;}IK(B){var A=kC();this.VZ(B,kw,A);return A;}lw(A,B){return A^B;}Lb(B){var A=kC();this.VZ(B,lw,A);return A;}BP(){var C=this.NB;var A=kC();var D=A.NB;for(var B=0;B<this.U; ++B){D[B]=UF&~C[B];}A.U=this.U;A.QB=~this.QB;return A;}Mk(A){var B=kC();if(A<0){this.KK(-A,B);}else{this.sU(A,B);}return B;}fa(A){var B=kC();if(A<0){this.sU(-A,B);}else{this.KK(A,B);}return B;}Cj(A){if(A==0)return -1;var B=0;if((A&0xffff)==0){A>>= 16;B+= 16;}if((A&0xff)==0){A>>= 8;B+= 8;}if((A&0xf)==0){A>>= 4;B+= 4;}if((A&3)==0){A>>= 2;B+= 2;}if((A&1)==0) ++B;return B;}ii(){var B=this.NB;for(var A=0;A<this.U; ++A)if(B[A]!=0)return A*jB+Cj(B[A]);if(this.QB<0)return this.U*jB;return -1;}int get Ow=>ii();SJ(A){var C=this.NB;int B=A~/jB;if(B>=this.U)return (this.QB!=0);return ((C[B]&(1<<(A%jB)))!=0);}NU(C,G){var H=this.NB;var I=C.NB;var D=G.NB;var B=0,A=0,J=bI.min(C.U,this.U);while(B<J){A+= H[B]+I[B];D[B++ ]=A&UF;A>>= jB;}if(C.U<this.U){A+= C.QB;while(B<this.U){A+= H[B];D[B++ ]=A&UF;A>>= jB;}A+= this.QB;}else{A+= this.QB;while(B<C.U){A+= I[B];D[B++ ]=A&UF;A>>= jB;}A+= C.QB;}G.QB=(A<0)?-1:0;if(A>0){D[B++ ]=A;}else if(A<-1)D[B++ ]=TG+A;G.U=B;G.clamp();}i add(B){var A=kC();this.NU(B,A);return A;}i subtract(B){var A=kC();this.vC(B,A);return A;}i Pj(B){var A=kC();this.BV(B,A);return A;}i NR(B){var A=kC();this.AN(B,A,null);return A;}i remainder(i B){i A=kC();this.AN(B,null,A);return (A.oG()>=0)?A:(A+B);}Mi(A){var B=this.NB;B[this.U]=this.IJ(0,A-1,this,0,0,this.U); ++this.U;this.clamp();}dZ(C,A){var B=this.NB;while(this.U<=A)B[this.U++ ]=0;B[A]+=C;while(B[A]>=TG){B[A]-=TG;if( ++A>=this.U)B[this.U++ ]=0; ++B[A];}}ZAB(D,G,B){var H=B.NB;var I=D.NB;var A=bI.min(this.U+D.U,G);B.QB=0;B.U=A;while(A>0)H[ --A]=0;var C;for(C=B.U-this.U;A<C; ++A)H[A+this.U]=this.IJ(0,I[A],B,A,0,this.U);for(C=bI.min(D.U,G);A<C; ++A)this.IJ(0,I[A],B,A,0,G-A);B.clamp();}aAB(D,C,B){var G=B.NB;var H=D.NB; --C;var A=B.U=this.U+D.U-C;B.QB=0;while( --A>=0)G[A]=0;for(A=bI.max(C-this.U,0);A<D.U; ++A){G[this.U+A-C]=this.IJ(C-A,H[A],B,0,0,this.U+A-C);}B.clamp();B.kZ(1,B);}modPow(i S,i O){var M=S.NB;var A=S.bitLength(),H,B=eH(1),C;if(A<=0){return B;}else if(A<18){H=1;}else if(A<48){H=3;}else if(A<144){H=4;}else if(A<768){H=5;}else{H=6;}if(A<8){C=new hl(O);}else if(O.isEven()){C=new jl(O);}else{C=new il(O);}var J=new Map(),D=3,P=H-1,Z=(1<<H)-1;J[1]=C.convert(this);if(H>1){var h=kC();C.JP(J[1],h);while(D<=Z){J[D]=kC();C.Ka(h,J[D-2],J[D]);D+= 2;}}var G=S.U-1,K,p=true,I=kC(),Q;A=La(M[G])-1;while(G>=0){if(A>=P){K=(M[G]>>(A-P))&Z;}else{K=(M[G]&((1<<(A+1))-1))<<(P-A);if(G>0)K|= M[G-1]>>(jB+A-P);}D=H;while((K&1)==0){K>>= 1; --D;}if((A-= D)<0){A+= jB; --G;}if(p){J[K].yM(B);p=false;}else{while(D>1){C.JP(B,I);C.JP(I,B);D-= 2;}if(D>0)C.JP(B,I);else{Q=B;B=I;I=Q;}C.Ka(I,J[K],B);}while(G>=0&&(M[G]&(1<<A))==0){C.JP(B,I);Q=B;B=I;I=Q;if( --A<0){A=jB-1; --G;}}}return C.Dk(B);}i modInverse(i B){var J=B.isEven();if((this.isEven()&&J)||B.oG()==0)return i.XJ;var G=B.xM(),C=this.xM();if(C.oG()<0)C=-C;var H=eH(1),D=eH(0),I=eH(0),A=eH(1);while(G.oG()!=0){while(G.isEven()){G.KK(1,G);if(J){if(!H.isEven()||!D.isEven()){H.NU(this,H);D.vC(B,D);}H.KK(1,H);}else if(!D.isEven())D.vC(B,D);D.KK(1,D);}while(C.isEven()){C.KK(1,C);if(J){if(!I.isEven()||!A.isEven()){I.NU(this,I);A.vC(B,A);}I.KK(1,I);}else if(!A.isEven())A.vC(B,A);A.KK(1,A);}if(G.compareTo(C)>=0){G.vC(C,G);if(J)H.vC(I,H);D.vC(A,D);}else{C.vC(G,C);if(J)I.vC(H,I);A.vC(D,A);}}if(C.compareTo(i.Yb)!=0)return i.XJ;if(A.compareTo(B)>=0)return RFB(A.subtract(B),B);if(A.oG()<0)A.NU(B,A);else return RFB(A,B);if(A.oG()<0)return RFB(A.add(B),B);else return RFB(A,B);}RFB(A,B)=>(oG()<0)?(B-A):A;i operator+(i A)=>add(A);i operator-(i A)=>subtract(A);i operator*(i A)=>Pj(A);i operator%(i A)=>remainder(A);i operator/(i A)=>NR(A);i operator~/(i A)=>NR(A);i operator-()=>this.fR();bool operator<(i A)=>compareTo(A)<0?true:false;bool operator<=(i A)=>compareTo(A)<=0?true:false;bool operator>(i A)=>compareTo(A)>0?true:false;bool operator>=(i A)=>compareTo(A)>=0?true:false;bool operator==(A)=>compareTo(A)==0?true:false;i operator&(i A)=>kO(A);i operator|(i A)=>IK(A);i operator^(i A)=>Lb(A);i operator~()=>BP();i operator<<(int A)=>Mk(A);i operator>>(int A)=>fa(A);}class KW{static String KS;static final pD n0=new pD.PDB("1.0.1");static final pD o0=new pD.PDB("1.0.4");int uR=200;final sH lB;final kS SFB;SD PH;String Ox;SE CE;String Nx;KW(kS A,this.lB):SFB=(A==null)?new y2():A{CE=Pd();Ox=CE.pE.kR;Nx=CE.pE.bv("broker-dsa");}List<String> cv(HttpRequest A,[m G]){String C=A.uri.queryParameters["dsId"];if(C!=null&&C.length>=43){if(A.requestedUri.queryParameters["home"]!=null){C="${A.requestedUri.queryParameters["home"]}:${C}";}return [C,null];}String B=G==null?null:G.username;if(KS!=null&&A.headers.value("X-Verification-Token")==KS){if(A.uri.queryParameters["username"]!=null){B=A.requestedUri.queryParameters["username"];}if(A.headers.value("X-Username")!=null){B=A.headers.value("X-Username");}}if(B!=null&&B.isNotEmpty&&B.length<43){String D=A.uri.queryParameters["session"];if(D==null){D="";}return [B,D];}return null;}rv(HttpRequest A,[m P])async{var I=cv(A,P);if(I==null){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("Invalid Request.");A.response.close();return;}String J=I[0];List<int> K=await A.fold([] ,ip);try {if(K.length>1024){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("Invalid Request.");A.response.close();return;}String Q=const Utf8Decoder(allowMalformed:true).convert(K);Map B=const JsonDecoder().convert(Q);if(f.wO(RB.VX)){f.eC("DSLink attempting handshake (${I[0]}): ${B}");}if(B["linkData"]!=null&&B["linkData"] is!Map){throw HttpStatus.BAD_REQUEST;}if(B["formats"]!=null&&B["formats"] is!List){throw HttpStatus.BAD_REQUEST;}var M=new pD.PDB(B["version"]);bool G=false;String H=A.requestedUri.queryParameters["token"];if(H!=null){String S=H.substring(0,16);for(var Z in lB.ZH.dV.values){if(Z.id==S){G=true;break;}}}kI D=SFB.vZ(J);if(D==null){String h=B["publicKey"];var O=bG.VQ(h);if(O==null){throw HttpStatus.BAD_REQUEST;}String H=A.requestedUri.queryParameters["token"];D=new kI(J,new wH.wCB(O),SFB,token:H,nodeProvider:lB,enableTimeout:M>=n0,enableAck:M>=o0,onDisconnect:SFB.Xj,trusted:G);if(!G&&!D.q$){throw HttpStatus.BAD_REQUEST;}if(!SFB.KU(D)){throw HttpStatus.UNAUTHORIZED;}}await D.h$(A,B["isRequester"]==true,B["isResponder"]==true,Nx,Ox,updateInterval:uR,trusted:G,linkData:B["linkData"],formats:B["formats"],enableCompression:B["enableWebSocketCompression"]==true);}catch (C){if(C is int){A.response.statusCode=C;if(C==HttpStatus.BAD_REQUEST){A.response.writeln("Invalid Request.");}else if(C==HttpStatus.UNAUTHORIZED){A.response.writeln("Unauthorized.");}}if(PH!=null&&PH.WL==true&&C is!int){A.response.writeln(C);}A.response.close();}}void oi(HttpRequest B,[m G]){var C=cv(B,G);if(C==null){B.response.statusCode=HttpStatus.BAD_REQUEST;B.response.writeln("Invalid Request.");B.response.close();return;}bool H=C[1]!=null;String O=B.requestedUri.queryParameters["token"];String J;String K;if(O!=null){J=O.substring(0,16);for(var P in lB.ZH.dV.keys){var Q=lB.ZH.dV[P];if(Q.id==J){H=true;K=P;break;}}}kI A=SFB.vZ(C[0],sessionId:C[1]);if(A==null&&C[1]!=null){A=new kI(C[0],null,SFB,nodeProvider:lB,session:C[1],enableTimeout:true,onDisconnect:uAB,trusted:H);A.Xi=true;SFB.KU(A);}String D;if(C[1]!=null&&G!=null){var I=G.IB["groups"];if(I is String){D=I;}else if(I is List){D=I.map((M)=>M.toString()).join();}else{D=G.wC?":config":":user";}}if(KS!=null&&B.headers.value("X-Verification-Token")==KS){if(B.headers.value("X-Permission-Group")!=null){D=B.headers.value("X-Permission-Group");}}if(A!=null){if(D!=null&&D.isNotEmpty){A.CC.VJ(D.split(",").map((M)=>M.trim()).toList());}if(A.Ua!=null){SFB.tx(A.ZD,A.Ua);A.Ua=null;}if(H&&J!=null&&K!=null){KM.EQ.sD(K,"connected");}A.oi(B,H,o1.q1);}else{throw HttpStatus.UNAUTHORIZED;}}void uAB(kI A){String B='${A.ZD} ${A.session}';SFB.mG(A,B);}}class jD implements StackTrace{final List<qB> cV;static Tf get Kr=>Zone.current[#stack_trace.stack_zone.spec];static n5(C(),{void onError(error,jD chain),bool when: true}){if(!when){var D;if(onError!=null){D=(A,B){onError(A,new jD.TDB(B));};}return runZoned(C,onError:D) as dynamic;}var G=new Tf(onError);return runZoned((){try {return C();}catch (A,B){return Zone.current.handleUncaughtError(A,B);}},zoneSpecification:G.kBB(),zoneValues:{#stack_trace.stack_zone.spec:G}) as dynamic;}factory jD.TDB(StackTrace A){if(A is jD)return A;if(Kr==null)return new jD([new qB.aDB(A)]);return Kr.du(A);}factory jD.UDB(String A){if(A.isEmpty)return new jD([] );if(!A.contains(iX))return new jD([new qB.bDB(A)]);return new jD(A.split(iX).map((B)=>new qB.gDB(B)));}jD(Iterable<qB> A):cV=new List<qB>.unmodifiable(A);jD get oa=>SR((A)=>false,terse:true);jD SR(bool D(WC frame),{bool terse: false}){var B=cV.map((A)=>A.SR(D,terse:terse));var C=B.where((A){if(A.RH.length>1)return true;if(A.RH.isEmpty)return false;if(!terse)return false;return A.RH.single.HD!=null;});if(C.isEmpty&&B.isNotEmpty){return new jD([B.last]);}return new jD(C);}qB gx()=>new qB(cV.expand((A)=>A.RH));String toString(){var C=cV.map((B){return B.RH.map((A)=>A.location.length).fold(0,bI.max);}).fold(0,bI.max);return cV.map((B){return B.RH.map((A){return '${Nr(A.location,C)}  ${A.GK}\n';}).join();}).join(iX);}}const int Zb=0x0A;const int nl=0x0D;const int ab=0x2B;const int bb=0x2D;const int xV=0x2E;const int qP=0x30;const int yV=0x39;const int uy=0x46;const int vy=0x4E;const int wy=0x54;const int xy=0x66;const int yy=0x6E;const int zy=0x6F;const int Az=0x74;const int Bz=0x78;const int Cz=0x7E;abstract class cI{}abstract class cb{}abstract class ql implements cb{}abstract class rl implements cb{}class zV<Gg extends ql,jC extends rl>{final Gg pE;final jC CE;zV(this.pE,this.CE);}abstract class Ez{}abstract class BM{static final Dz=new Gz<BM>();factory BM([String A=""])=>Dz.create(A);}abstract class pl{}abstract class ol{}abstract class YJ{}abstract class Fz{}abstract class bN{}abstract class sl{}abstract class db implements cb{final YJ parameters;db(this.parameters);}class UG extends db implements rl{final e NI;UG(this.NI,YJ A):super(A);bool operator==(A){if(A==null)return false;if(A is!UG)return false;return (A.parameters==this.parameters)&&(A.NI==this.NI);}int get hashCode{return parameters.hashCode+NI.hashCode;}}class wE extends db implements ql{final bN sI;wE(this.sI,YJ A):super(A);bool operator==(A){if(A==null)return false;if(A is!wE)return false;return (A.parameters==this.parameters)&&(A.sI==this.sI);}int get hashCode{return parameters.hashCode+sI.hashCode;}}class Gz<BB>{final TFB=new Map<String,Function>();final UFB=new List<Function>();operator[]=(String A,BB B(String))=>JBB(A,B);void JBB(String A,BB B(String)){TFB[A]=B;}BB create(String A){var B=TFB[A];if(B!=null){return B(A);}else{for(B in UFB){var C=B(A);if(C!=null){return C;}}}throw new UnsupportedError("No algorithm with that name registered: ${A}");}}class tl extends Mz{static const ul=16;bool VFB;List<List<int>> WFB;int XFB;int YFB;int ZFB;int aFB;int bFB;int get blockSize=>ul;void reset(){XFB=0;YFB=ZFB=aFB=bFB=0;VFB=false;WFB=null;}void init(bool J,ib K){var H=K.key;int B=(H.lengthInBytes/4).floor();if(((B!=4)&&(B!=6)&&(B!=8))||((B*4)!=H.lengthInBytes)){throw new ArgumentError("Key length must be 128/192/256 bits");}this.VFB=J;XFB=B+6;WFB=new List.generate(XFB+1,(int A)=>new List<int>(4));var M=new ByteData.view(K.key.buffer);for(var A=0,I=0;A<H.lengthInBytes;A+= 4,I++ ){var C=uP(M,A,Endianness.LITTLE_ENDIAN);WFB[I>>2][I&3]=C;}int O=(XFB+1)<<2;for(int A=B;A<O;A++ ){int D=WFB[(A-1)>>2][(A-1)&3].toInt();if((A%B)==0){D=vl(AW(D,8))^Lz[((A/B)-1).floor()];}else if((B>6)&&((A%B)==4)){D=vl(D);}var C=WFB[(A-B)>>2][(A-B)&3]^D;WFB[A>>2][A&3]=C;}if(!J){for(var G=1;G<XFB;G++ ){for(var A=0;A<4;A++ ){var C=Kz(WFB[G][A].toInt());WFB[G][A]=C;}}}}int iR(Uint8List C,int A,Uint8List D,int B){if(WFB==null){throw new StateError("AES engine not initialised");}if((A+(32/2))>C.lengthInBytes){throw new ArgumentError("Input buffer too short");}if((B+(32/2))>D.lengthInBytes){throw new ArgumentError("Output buffer too short");}var G=new ByteData.view(C.buffer);var H=new ByteData.view(D.buffer);if(VFB){cFB(G,A);dFB(WFB);eFB(H,B);}else{cFB(G,A);fFB(WFB);eFB(H,B);}return ul;}void dFB(List<List<int>> B){int A,C,D,G,H;YFB^= B[0][0].toInt();ZFB^= B[0][1].toInt();aFB^= B[0][2].toInt();bFB^= B[0][3].toInt();A=1;while(A<XFB-1){C=fH[YFB&255]^gH[(ZFB>>8)&255]^hH[(aFB>>16)&255]^iH[(bFB>>24)&255]^B[A][0].toInt();D=fH[ZFB&255]^gH[(aFB>>8)&255]^hH[(bFB>>16)&255]^iH[(YFB>>24)&255]^B[A][1].toInt();G=fH[aFB&255]^gH[(bFB>>8)&255]^hH[(YFB>>16)&255]^iH[(ZFB>>24)&255]^B[A][2].toInt();H=fH[bFB&255]^gH[(YFB>>8)&255]^hH[(ZFB>>16)&255]^iH[(aFB>>24)&255]^B[A][3].toInt();A++ ;YFB=fH[C&255]^gH[(D>>8)&255]^hH[(G>>16)&255]^iH[(H>>24)&255]^B[A][0].toInt();ZFB=fH[D&255]^gH[(G>>8)&255]^hH[(H>>16)&255]^iH[(C>>24)&255]^B[A][1].toInt();aFB=fH[G&255]^gH[(H>>8)&255]^hH[(C>>16)&255]^iH[(D>>24)&255]^B[A][2].toInt();bFB=fH[H&255]^gH[(C>>8)&255]^hH[(D>>16)&255]^iH[(G>>24)&255]^B[A][3].toInt();A++ ;}C=fH[YFB&255]^gH[(ZFB>>8)&255]^hH[(aFB>>16)&255]^iH[(bFB>>24)&255]^B[A][0].toInt();D=fH[ZFB&255]^gH[(aFB>>8)&255]^hH[(bFB>>16)&255]^iH[(YFB>>24)&255]^B[A][1].toInt();G=fH[aFB&255]^gH[(bFB>>8)&255]^hH[(YFB>>16)&255]^iH[(ZFB>>24)&255]^B[A][2].toInt();H=fH[bFB&255]^gH[(YFB>>8)&255]^hH[(ZFB>>16)&255]^iH[(aFB>>24)&255]^B[A][3].toInt();A++ ;YFB=(HE[C&255]&255)^((HE[(D>>8)&255]&255)<<8)^((HE[(G>>16)&255]&255)<<16)^(HE[(H>>24)&255]<<24)^B[A][0].toInt();ZFB=(HE[D&255]&255)^((HE[(G>>8)&255]&255)<<8)^((HE[(H>>16)&255]&255)<<16)^(HE[(C>>24)&255]<<24)^B[A][1].toInt();aFB=(HE[G&255]&255)^((HE[(H>>8)&255]&255)<<8)^((HE[(C>>16)&255]&255)<<16)^(HE[(D>>24)&255]<<24)^B[A][2].toInt();bFB=(HE[H&255]&255)^((HE[(C>>8)&255]&255)<<8)^((HE[(D>>16)&255]&255)<<16)^(HE[(G>>24)&255]<<24)^B[A][3].toInt();}void fFB(List<List<int>> A){int B,C,D,G,H;YFB^= A[XFB][0].toInt();ZFB^= A[XFB][1].toInt();aFB^= A[XFB][2].toInt();bFB^= A[XFB][3].toInt();B=XFB-1;while(B>1){C=jH[YFB&255]^kH[(bFB>>8)&255]^lH[(aFB>>16)&255]^mH[(ZFB>>24)&255]^A[B][0].toInt();D=jH[ZFB&255]^kH[(YFB>>8)&255]^lH[(bFB>>16)&255]^mH[(aFB>>24)&255]^A[B][1].toInt();G=jH[aFB&255]^kH[(ZFB>>8)&255]^lH[(YFB>>16)&255]^mH[(bFB>>24)&255]^A[B][2].toInt();H=jH[bFB&255]^kH[(aFB>>8)&255]^lH[(ZFB>>16)&255]^mH[(YFB>>24)&255]^A[B][3].toInt();B-- ;YFB=jH[C&255]^kH[(H>>8)&255]^lH[(G>>16)&255]^mH[(D>>24)&255]^A[B][0].toInt();ZFB=jH[D&255]^kH[(C>>8)&255]^lH[(H>>16)&255]^mH[(G>>24)&255]^A[B][1].toInt();aFB=jH[G&255]^kH[(D>>8)&255]^lH[(C>>16)&255]^mH[(H>>24)&255]^A[B][2].toInt();bFB=jH[H&255]^kH[(G>>8)&255]^lH[(D>>16)&255]^mH[(C>>24)&255]^A[B][3].toInt();B-- ;}C=jH[YFB&255]^kH[(bFB>>8)&255]^lH[(aFB>>16)&255]^mH[(ZFB>>24)&255]^A[B][0].toInt();D=jH[ZFB&255]^kH[(YFB>>8)&255]^lH[(bFB>>16)&255]^mH[(aFB>>24)&255]^A[B][1].toInt();G=jH[aFB&255]^kH[(ZFB>>8)&255]^lH[(YFB>>16)&255]^mH[(bFB>>24)&255]^A[B][2].toInt();H=jH[bFB&255]^kH[(aFB>>8)&255]^lH[(ZFB>>16)&255]^mH[(YFB>>24)&255]^A[B][3].toInt();YFB=(VF[C&255]&255)^((VF[(H>>8)&255]&255)<<8)^((VF[(G>>16)&255]&255)<<16)^(VF[(D>>24)&255]<<24)^A[0][0].toInt();ZFB=(VF[D&255]&255)^((VF[(C>>8)&255]&255)<<8)^((VF[(H>>16)&255]&255)<<16)^(VF[(G>>24)&255]<<24)^A[0][1].toInt();aFB=(VF[G&255]&255)^((VF[(D>>8)&255]&255)<<8)^((VF[(C>>16)&255]&255)<<16)^(VF[(H>>24)&255]<<24)^A[0][2].toInt();bFB=(VF[H&255]&255)^((VF[(G>>8)&255]&255)<<8)^((VF[(D>>16)&255]&255)<<16)^(VF[(C>>24)&255]<<24)^A[0][3].toInt();}void cFB(ByteData A,int B){YFB=uP(A,B,Endianness.LITTLE_ENDIAN);ZFB=uP(A,B+4,Endianness.LITTLE_ENDIAN);aFB=uP(A,B+8,Endianness.LITTLE_ENDIAN);bFB=uP(A,B+12,Endianness.LITTLE_ENDIAN);}void eFB(ByteData A,int B){BS(YFB,A,B,Endianness.LITTLE_ENDIAN);BS(ZFB,A,B+4,Endianness.LITTLE_ENDIAN);BS(aFB,A,B+8,Endianness.LITTLE_ENDIAN);BS(bFB,A,B+12,Endianness.LITTLE_ENDIAN);}}int AW(int A,int B)=>dI(A,B);const int Hz=0x80808080;const int Iz=0x7f7f7f7f;const int Jz=0x0000001b;int eb(int A){var B=lb((A&Hz),7);return (((A&Iz)<<1)^B*Jz);}int Kz(int D){int A=eb(D);int B=eb(A);int G=eb(B);int C=D^G;return A^B^G^AW(A^C,8)^AW(B^C,16)^AW(C,24);}int vl(int A){return (HE[A&255]&255|((HE[(A>>8)&255]&255)<<8)|((HE[(A>>16)&255]&255)<<16)|HE[(A>>24)&255]<<24);}final HE=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];final VF=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125];final Lz=[0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x1b,0x36,0x6c,0xd8,0xab,0x4d,0x9a,0x2f,0x5e,0xbc,0x63,0xc6,0x97,0x35,0x6a,0xd4,0xb3,0x7d,0xfa,0xef,0xc5,0x91];final fH=[0xa56363c6,0x847c7cf8,0x997777ee,0x8d7b7bf6,0x0df2f2ff,0xbd6b6bd6,0xb16f6fde,0x54c5c591,0x50303060,0x03010102,0xa96767ce,0x7d2b2b56,0x19fefee7,0x62d7d7b5,0xe6abab4d,0x9a7676ec,0x45caca8f,0x9d82821f,0x40c9c989,0x877d7dfa,0x15fafaef,0xeb5959b2,0xc947478e,0x0bf0f0fb,0xecadad41,0x67d4d4b3,0xfda2a25f,0xeaafaf45,0xbf9c9c23,0xf7a4a453,0x967272e4,0x5bc0c09b,0xc2b7b775,0x1cfdfde1,0xae93933d,0x6a26264c,0x5a36366c,0x413f3f7e,0x02f7f7f5,0x4fcccc83,0x5c343468,0xf4a5a551,0x34e5e5d1,0x08f1f1f9,0x937171e2,0x73d8d8ab,0x53313162,0x3f15152a,0x0c040408,0x52c7c795,0x65232346,0x5ec3c39d,0x28181830,0xa1969637,0x0f05050a,0xb59a9a2f,0x0907070e,0x36121224,0x9b80801b,0x3de2e2df,0x26ebebcd,0x6927274e,0xcdb2b27f,0x9f7575ea,0x1b090912,0x9e83831d,0x742c2c58,0x2e1a1a34,0x2d1b1b36,0xb26e6edc,0xee5a5ab4,0xfba0a05b,0xf65252a4,0x4d3b3b76,0x61d6d6b7,0xceb3b37d,0x7b292952,0x3ee3e3dd,0x712f2f5e,0x97848413,0xf55353a6,0x68d1d1b9,0x00000000,0x2cededc1,0x60202040,0x1ffcfce3,0xc8b1b179,0xed5b5bb6,0xbe6a6ad4,0x46cbcb8d,0xd9bebe67,0x4b393972,0xde4a4a94,0xd44c4c98,0xe85858b0,0x4acfcf85,0x6bd0d0bb,0x2aefefc5,0xe5aaaa4f,0x16fbfbed,0xc5434386,0xd74d4d9a,0x55333366,0x94858511,0xcf45458a,0x10f9f9e9,0x06020204,0x817f7ffe,0xf05050a0,0x443c3c78,0xba9f9f25,0xe3a8a84b,0xf35151a2,0xfea3a35d,0xc0404080,0x8a8f8f05,0xad92923f,0xbc9d9d21,0x48383870,0x04f5f5f1,0xdfbcbc63,0xc1b6b677,0x75dadaaf,0x63212142,0x30101020,0x1affffe5,0x0ef3f3fd,0x6dd2d2bf,0x4ccdcd81,0x140c0c18,0x35131326,0x2fececc3,0xe15f5fbe,0xa2979735,0xcc444488,0x3917172e,0x57c4c493,0xf2a7a755,0x827e7efc,0x473d3d7a,0xac6464c8,0xe75d5dba,0x2b191932,0x957373e6,0xa06060c0,0x98818119,0xd14f4f9e,0x7fdcdca3,0x66222244,0x7e2a2a54,0xab90903b,0x8388880b,0xca46468c,0x29eeeec7,0xd3b8b86b,0x3c141428,0x79dedea7,0xe25e5ebc,0x1d0b0b16,0x76dbdbad,0x3be0e0db,0x56323264,0x4e3a3a74,0x1e0a0a14,0xdb494992,0x0a06060c,0x6c242448,0xe45c5cb8,0x5dc2c29f,0x6ed3d3bd,0xefacac43,0xa66262c4,0xa8919139,0xa4959531,0x37e4e4d3,0x8b7979f2,0x32e7e7d5,0x43c8c88b,0x5937376e,0xb76d6dda,0x8c8d8d01,0x64d5d5b1,0xd24e4e9c,0xe0a9a949,0xb46c6cd8,0xfa5656ac,0x07f4f4f3,0x25eaeacf,0xaf6565ca,0x8e7a7af4,0xe9aeae47,0x18080810,0xd5baba6f,0x887878f0,0x6f25254a,0x722e2e5c,0x241c1c38,0xf1a6a657,0xc7b4b473,0x51c6c697,0x23e8e8cb,0x7cdddda1,0x9c7474e8,0x211f1f3e,0xdd4b4b96,0xdcbdbd61,0x868b8b0d,0x858a8a0f,0x907070e0,0x423e3e7c,0xc4b5b571,0xaa6666cc,0xd8484890,0x05030306,0x01f6f6f7,0x120e0e1c,0xa36161c2,0x5f35356a,0xf95757ae,0xd0b9b969,0x91868617,0x58c1c199,0x271d1d3a,0xb99e9e27,0x38e1e1d9,0x13f8f8eb,0xb398982b,0x33111122,0xbb6969d2,0x70d9d9a9,0x898e8e07,0xa7949433,0xb69b9b2d,0x221e1e3c,0x92878715,0x20e9e9c9,0x49cece87,0xff5555aa,0x78282850,0x7adfdfa5,0x8f8c8c03,0xf8a1a159,0x80898909,0x170d0d1a,0xdabfbf65,0x31e6e6d7,0xc6424284,0xb86868d0,0xc3414182,0xb0999929,0x772d2d5a,0x110f0f1e,0xcbb0b07b,0xfc5454a8,0xd6bbbb6d,0x3a16162c];final gH=[0x6363c6a5,0x7c7cf884,0x7777ee99,0x7b7bf68d,0xf2f2ff0d,0x6b6bd6bd,0x6f6fdeb1,0xc5c59154,0x30306050,0x01010203,0x6767cea9,0x2b2b567d,0xfefee719,0xd7d7b562,0xabab4de6,0x7676ec9a,0xcaca8f45,0x82821f9d,0xc9c98940,0x7d7dfa87,0xfafaef15,0x5959b2eb,0x47478ec9,0xf0f0fb0b,0xadad41ec,0xd4d4b367,0xa2a25ffd,0xafaf45ea,0x9c9c23bf,0xa4a453f7,0x7272e496,0xc0c09b5b,0xb7b775c2,0xfdfde11c,0x93933dae,0x26264c6a,0x36366c5a,0x3f3f7e41,0xf7f7f502,0xcccc834f,0x3434685c,0xa5a551f4,0xe5e5d134,0xf1f1f908,0x7171e293,0xd8d8ab73,0x31316253,0x15152a3f,0x0404080c,0xc7c79552,0x23234665,0xc3c39d5e,0x18183028,0x969637a1,0x05050a0f,0x9a9a2fb5,0x07070e09,0x12122436,0x80801b9b,0xe2e2df3d,0xebebcd26,0x27274e69,0xb2b27fcd,0x7575ea9f,0x0909121b,0x83831d9e,0x2c2c5874,0x1a1a342e,0x1b1b362d,0x6e6edcb2,0x5a5ab4ee,0xa0a05bfb,0x5252a4f6,0x3b3b764d,0xd6d6b761,0xb3b37dce,0x2929527b,0xe3e3dd3e,0x2f2f5e71,0x84841397,0x5353a6f5,0xd1d1b968,0x00000000,0xededc12c,0x20204060,0xfcfce31f,0xb1b179c8,0x5b5bb6ed,0x6a6ad4be,0xcbcb8d46,0xbebe67d9,0x3939724b,0x4a4a94de,0x4c4c98d4,0x5858b0e8,0xcfcf854a,0xd0d0bb6b,0xefefc52a,0xaaaa4fe5,0xfbfbed16,0x434386c5,0x4d4d9ad7,0x33336655,0x85851194,0x45458acf,0xf9f9e910,0x02020406,0x7f7ffe81,0x5050a0f0,0x3c3c7844,0x9f9f25ba,0xa8a84be3,0x5151a2f3,0xa3a35dfe,0x404080c0,0x8f8f058a,0x92923fad,0x9d9d21bc,0x38387048,0xf5f5f104,0xbcbc63df,0xb6b677c1,0xdadaaf75,0x21214263,0x10102030,0xffffe51a,0xf3f3fd0e,0xd2d2bf6d,0xcdcd814c,0x0c0c1814,0x13132635,0xececc32f,0x5f5fbee1,0x979735a2,0x444488cc,0x17172e39,0xc4c49357,0xa7a755f2,0x7e7efc82,0x3d3d7a47,0x6464c8ac,0x5d5dbae7,0x1919322b,0x7373e695,0x6060c0a0,0x81811998,0x4f4f9ed1,0xdcdca37f,0x22224466,0x2a2a547e,0x90903bab,0x88880b83,0x46468cca,0xeeeec729,0xb8b86bd3,0x1414283c,0xdedea779,0x5e5ebce2,0x0b0b161d,0xdbdbad76,0xe0e0db3b,0x32326456,0x3a3a744e,0x0a0a141e,0x494992db,0x06060c0a,0x2424486c,0x5c5cb8e4,0xc2c29f5d,0xd3d3bd6e,0xacac43ef,0x6262c4a6,0x919139a8,0x959531a4,0xe4e4d337,0x7979f28b,0xe7e7d532,0xc8c88b43,0x37376e59,0x6d6ddab7,0x8d8d018c,0xd5d5b164,0x4e4e9cd2,0xa9a949e0,0x6c6cd8b4,0x5656acfa,0xf4f4f307,0xeaeacf25,0x6565caaf,0x7a7af48e,0xaeae47e9,0x08081018,0xbaba6fd5,0x7878f088,0x25254a6f,0x2e2e5c72,0x1c1c3824,0xa6a657f1,0xb4b473c7,0xc6c69751,0xe8e8cb23,0xdddda17c,0x7474e89c,0x1f1f3e21,0x4b4b96dd,0xbdbd61dc,0x8b8b0d86,0x8a8a0f85,0x7070e090,0x3e3e7c42,0xb5b571c4,0x6666ccaa,0x484890d8,0x03030605,0xf6f6f701,0x0e0e1c12,0x6161c2a3,0x35356a5f,0x5757aef9,0xb9b969d0,0x86861791,0xc1c19958,0x1d1d3a27,0x9e9e27b9,0xe1e1d938,0xf8f8eb13,0x98982bb3,0x11112233,0x6969d2bb,0xd9d9a970,0x8e8e0789,0x949433a7,0x9b9b2db6,0x1e1e3c22,0x87871592,0xe9e9c920,0xcece8749,0x5555aaff,0x28285078,0xdfdfa57a,0x8c8c038f,0xa1a159f8,0x89890980,0x0d0d1a17,0xbfbf65da,0xe6e6d731,0x424284c6,0x6868d0b8,0x414182c3,0x999929b0,0x2d2d5a77,0x0f0f1e11,0xb0b07bcb,0x5454a8fc,0xbbbb6dd6,0x16162c3a];final hH=[0x63c6a563,0x7cf8847c,0x77ee9977,0x7bf68d7b,0xf2ff0df2,0x6bd6bd6b,0x6fdeb16f,0xc59154c5,0x30605030,0x01020301,0x67cea967,0x2b567d2b,0xfee719fe,0xd7b562d7,0xab4de6ab,0x76ec9a76,0xca8f45ca,0x821f9d82,0xc98940c9,0x7dfa877d,0xfaef15fa,0x59b2eb59,0x478ec947,0xf0fb0bf0,0xad41ecad,0xd4b367d4,0xa25ffda2,0xaf45eaaf,0x9c23bf9c,0xa453f7a4,0x72e49672,0xc09b5bc0,0xb775c2b7,0xfde11cfd,0x933dae93,0x264c6a26,0x366c5a36,0x3f7e413f,0xf7f502f7,0xcc834fcc,0x34685c34,0xa551f4a5,0xe5d134e5,0xf1f908f1,0x71e29371,0xd8ab73d8,0x31625331,0x152a3f15,0x04080c04,0xc79552c7,0x23466523,0xc39d5ec3,0x18302818,0x9637a196,0x050a0f05,0x9a2fb59a,0x070e0907,0x12243612,0x801b9b80,0xe2df3de2,0xebcd26eb,0x274e6927,0xb27fcdb2,0x75ea9f75,0x09121b09,0x831d9e83,0x2c58742c,0x1a342e1a,0x1b362d1b,0x6edcb26e,0x5ab4ee5a,0xa05bfba0,0x52a4f652,0x3b764d3b,0xd6b761d6,0xb37dceb3,0x29527b29,0xe3dd3ee3,0x2f5e712f,0x84139784,0x53a6f553,0xd1b968d1,0x00000000,0xedc12ced,0x20406020,0xfce31ffc,0xb179c8b1,0x5bb6ed5b,0x6ad4be6a,0xcb8d46cb,0xbe67d9be,0x39724b39,0x4a94de4a,0x4c98d44c,0x58b0e858,0xcf854acf,0xd0bb6bd0,0xefc52aef,0xaa4fe5aa,0xfbed16fb,0x4386c543,0x4d9ad74d,0x33665533,0x85119485,0x458acf45,0xf9e910f9,0x02040602,0x7ffe817f,0x50a0f050,0x3c78443c,0x9f25ba9f,0xa84be3a8,0x51a2f351,0xa35dfea3,0x4080c040,0x8f058a8f,0x923fad92,0x9d21bc9d,0x38704838,0xf5f104f5,0xbc63dfbc,0xb677c1b6,0xdaaf75da,0x21426321,0x10203010,0xffe51aff,0xf3fd0ef3,0xd2bf6dd2,0xcd814ccd,0x0c18140c,0x13263513,0xecc32fec,0x5fbee15f,0x9735a297,0x4488cc44,0x172e3917,0xc49357c4,0xa755f2a7,0x7efc827e,0x3d7a473d,0x64c8ac64,0x5dbae75d,0x19322b19,0x73e69573,0x60c0a060,0x81199881,0x4f9ed14f,0xdca37fdc,0x22446622,0x2a547e2a,0x903bab90,0x880b8388,0x468cca46,0xeec729ee,0xb86bd3b8,0x14283c14,0xdea779de,0x5ebce25e,0x0b161d0b,0xdbad76db,0xe0db3be0,0x32645632,0x3a744e3a,0x0a141e0a,0x4992db49,0x060c0a06,0x24486c24,0x5cb8e45c,0xc29f5dc2,0xd3bd6ed3,0xac43efac,0x62c4a662,0x9139a891,0x9531a495,0xe4d337e4,0x79f28b79,0xe7d532e7,0xc88b43c8,0x376e5937,0x6ddab76d,0x8d018c8d,0xd5b164d5,0x4e9cd24e,0xa949e0a9,0x6cd8b46c,0x56acfa56,0xf4f307f4,0xeacf25ea,0x65caaf65,0x7af48e7a,0xae47e9ae,0x08101808,0xba6fd5ba,0x78f08878,0x254a6f25,0x2e5c722e,0x1c38241c,0xa657f1a6,0xb473c7b4,0xc69751c6,0xe8cb23e8,0xdda17cdd,0x74e89c74,0x1f3e211f,0x4b96dd4b,0xbd61dcbd,0x8b0d868b,0x8a0f858a,0x70e09070,0x3e7c423e,0xb571c4b5,0x66ccaa66,0x4890d848,0x03060503,0xf6f701f6,0x0e1c120e,0x61c2a361,0x356a5f35,0x57aef957,0xb969d0b9,0x86179186,0xc19958c1,0x1d3a271d,0x9e27b99e,0xe1d938e1,0xf8eb13f8,0x982bb398,0x11223311,0x69d2bb69,0xd9a970d9,0x8e07898e,0x9433a794,0x9b2db69b,0x1e3c221e,0x87159287,0xe9c920e9,0xce8749ce,0x55aaff55,0x28507828,0xdfa57adf,0x8c038f8c,0xa159f8a1,0x89098089,0x0d1a170d,0xbf65dabf,0xe6d731e6,0x4284c642,0x68d0b868,0x4182c341,0x9929b099,0x2d5a772d,0x0f1e110f,0xb07bcbb0,0x54a8fc54,0xbb6dd6bb,0x162c3a16];final iH=[0xc6a56363,0xf8847c7c,0xee997777,0xf68d7b7b,0xff0df2f2,0xd6bd6b6b,0xdeb16f6f,0x9154c5c5,0x60503030,0x02030101,0xcea96767,0x567d2b2b,0xe719fefe,0xb562d7d7,0x4de6abab,0xec9a7676,0x8f45caca,0x1f9d8282,0x8940c9c9,0xfa877d7d,0xef15fafa,0xb2eb5959,0x8ec94747,0xfb0bf0f0,0x41ecadad,0xb367d4d4,0x5ffda2a2,0x45eaafaf,0x23bf9c9c,0x53f7a4a4,0xe4967272,0x9b5bc0c0,0x75c2b7b7,0xe11cfdfd,0x3dae9393,0x4c6a2626,0x6c5a3636,0x7e413f3f,0xf502f7f7,0x834fcccc,0x685c3434,0x51f4a5a5,0xd134e5e5,0xf908f1f1,0xe2937171,0xab73d8d8,0x62533131,0x2a3f1515,0x080c0404,0x9552c7c7,0x46652323,0x9d5ec3c3,0x30281818,0x37a19696,0x0a0f0505,0x2fb59a9a,0x0e090707,0x24361212,0x1b9b8080,0xdf3de2e2,0xcd26ebeb,0x4e692727,0x7fcdb2b2,0xea9f7575,0x121b0909,0x1d9e8383,0x58742c2c,0x342e1a1a,0x362d1b1b,0xdcb26e6e,0xb4ee5a5a,0x5bfba0a0,0xa4f65252,0x764d3b3b,0xb761d6d6,0x7dceb3b3,0x527b2929,0xdd3ee3e3,0x5e712f2f,0x13978484,0xa6f55353,0xb968d1d1,0x00000000,0xc12ceded,0x40602020,0xe31ffcfc,0x79c8b1b1,0xb6ed5b5b,0xd4be6a6a,0x8d46cbcb,0x67d9bebe,0x724b3939,0x94de4a4a,0x98d44c4c,0xb0e85858,0x854acfcf,0xbb6bd0d0,0xc52aefef,0x4fe5aaaa,0xed16fbfb,0x86c54343,0x9ad74d4d,0x66553333,0x11948585,0x8acf4545,0xe910f9f9,0x04060202,0xfe817f7f,0xa0f05050,0x78443c3c,0x25ba9f9f,0x4be3a8a8,0xa2f35151,0x5dfea3a3,0x80c04040,0x058a8f8f,0x3fad9292,0x21bc9d9d,0x70483838,0xf104f5f5,0x63dfbcbc,0x77c1b6b6,0xaf75dada,0x42632121,0x20301010,0xe51affff,0xfd0ef3f3,0xbf6dd2d2,0x814ccdcd,0x18140c0c,0x26351313,0xc32fecec,0xbee15f5f,0x35a29797,0x88cc4444,0x2e391717,0x9357c4c4,0x55f2a7a7,0xfc827e7e,0x7a473d3d,0xc8ac6464,0xbae75d5d,0x322b1919,0xe6957373,0xc0a06060,0x19988181,0x9ed14f4f,0xa37fdcdc,0x44662222,0x547e2a2a,0x3bab9090,0x0b838888,0x8cca4646,0xc729eeee,0x6bd3b8b8,0x283c1414,0xa779dede,0xbce25e5e,0x161d0b0b,0xad76dbdb,0xdb3be0e0,0x64563232,0x744e3a3a,0x141e0a0a,0x92db4949,0x0c0a0606,0x486c2424,0xb8e45c5c,0x9f5dc2c2,0xbd6ed3d3,0x43efacac,0xc4a66262,0x39a89191,0x31a49595,0xd337e4e4,0xf28b7979,0xd532e7e7,0x8b43c8c8,0x6e593737,0xdab76d6d,0x018c8d8d,0xb164d5d5,0x9cd24e4e,0x49e0a9a9,0xd8b46c6c,0xacfa5656,0xf307f4f4,0xcf25eaea,0xcaaf6565,0xf48e7a7a,0x47e9aeae,0x10180808,0x6fd5baba,0xf0887878,0x4a6f2525,0x5c722e2e,0x38241c1c,0x57f1a6a6,0x73c7b4b4,0x9751c6c6,0xcb23e8e8,0xa17cdddd,0xe89c7474,0x3e211f1f,0x96dd4b4b,0x61dcbdbd,0x0d868b8b,0x0f858a8a,0xe0907070,0x7c423e3e,0x71c4b5b5,0xccaa6666,0x90d84848,0x06050303,0xf701f6f6,0x1c120e0e,0xc2a36161,0x6a5f3535,0xaef95757,0x69d0b9b9,0x17918686,0x9958c1c1,0x3a271d1d,0x27b99e9e,0xd938e1e1,0xeb13f8f8,0x2bb39898,0x22331111,0xd2bb6969,0xa970d9d9,0x07898e8e,0x33a79494,0x2db69b9b,0x3c221e1e,0x15928787,0xc920e9e9,0x8749cece,0xaaff5555,0x50782828,0xa57adfdf,0x038f8c8c,0x59f8a1a1,0x09808989,0x1a170d0d,0x65dabfbf,0xd731e6e6,0x84c64242,0xd0b86868,0x82c34141,0x29b09999,0x5a772d2d,0x1e110f0f,0x7bcbb0b0,0xa8fc5454,0x6dd6bbbb,0x2c3a1616];final jH=[0x50a7f451,0x5365417e,0xc3a4171a,0x965e273a,0xcb6bab3b,0xf1459d1f,0xab58faac,0x9303e34b,0x55fa3020,0xf66d76ad,0x9176cc88,0x254c02f5,0xfcd7e54f,0xd7cb2ac5,0x80443526,0x8fa362b5,0x495ab1de,0x671bba25,0x980eea45,0xe1c0fe5d,0x02752fc3,0x12f04c81,0xa397468d,0xc6f9d36b,0xe75f8f03,0x959c9215,0xeb7a6dbf,0xda595295,0x2d83bed4,0xd3217458,0x2969e049,0x44c8c98e,0x6a89c275,0x78798ef4,0x6b3e5899,0xdd71b927,0xb64fe1be,0x17ad88f0,0x66ac20c9,0xb43ace7d,0x184adf63,0x82311ae5,0x60335197,0x457f5362,0xe07764b1,0x84ae6bbb,0x1ca081fe,0x942b08f9,0x58684870,0x19fd458f,0x876cde94,0xb7f87b52,0x23d373ab,0xe2024b72,0x578f1fe3,0x2aab5566,0x0728ebb2,0x03c2b52f,0x9a7bc586,0xa50837d3,0xf2872830,0xb2a5bf23,0xba6a0302,0x5c8216ed,0x2b1ccf8a,0x92b479a7,0xf0f207f3,0xa1e2694e,0xcdf4da65,0xd5be0506,0x1f6234d1,0x8afea6c4,0x9d532e34,0xa055f3a2,0x32e18a05,0x75ebf6a4,0x39ec830b,0xaaef6040,0x069f715e,0x51106ebd,0xf98a213e,0x3d06dd96,0xae053edd,0x46bde64d,0xb58d5491,0x055dc471,0x6fd40604,0xff155060,0x24fb9819,0x97e9bdd6,0xcc434089,0x779ed967,0xbd42e8b0,0x888b8907,0x385b19e7,0xdbeec879,0x470a7ca1,0xe90f427c,0xc91e84f8,0x00000000,0x83868009,0x48ed2b32,0xac70111e,0x4e725a6c,0xfbff0efd,0x5638850f,0x1ed5ae3d,0x27392d36,0x64d90f0a,0x21a65c68,0xd1545b9b,0x3a2e3624,0xb1670a0c,0x0fe75793,0xd296eeb4,0x9e919b1b,0x4fc5c080,0xa220dc61,0x694b775a,0x161a121c,0x0aba93e2,0xe52aa0c0,0x43e0223c,0x1d171b12,0x0b0d090e,0xadc78bf2,0xb9a8b62d,0xc8a91e14,0x8519f157,0x4c0775af,0xbbdd99ee,0xfd607fa3,0x9f2601f7,0xbcf5725c,0xc53b6644,0x347efb5b,0x7629438b,0xdcc623cb,0x68fcedb6,0x63f1e4b8,0xcadc31d7,0x10856342,0x40229713,0x2011c684,0x7d244a85,0xf83dbbd2,0x1132f9ae,0x6da129c7,0x4b2f9e1d,0xf330b2dc,0xec52860d,0xd0e3c177,0x6c16b32b,0x99b970a9,0xfa489411,0x2264e947,0xc48cfca8,0x1a3ff0a0,0xd82c7d56,0xef903322,0xc74e4987,0xc1d138d9,0xfea2ca8c,0x360bd498,0xcf81f5a6,0x28de7aa5,0x268eb7da,0xa4bfad3f,0xe49d3a2c,0x0d927850,0x9bcc5f6a,0x62467e54,0xc2138df6,0xe8b8d890,0x5ef7392e,0xf5afc382,0xbe805d9f,0x7c93d069,0xa92dd56f,0xb31225cf,0x3b99acc8,0xa77d1810,0x6e639ce8,0x7bbb3bdb,0x097826cd,0xf418596e,0x01b79aec,0xa89a4f83,0x656e95e6,0x7ee6ffaa,0x08cfbc21,0xe6e815ef,0xd99be7ba,0xce366f4a,0xd4099fea,0xd67cb029,0xafb2a431,0x31233f2a,0x3094a5c6,0xc066a235,0x37bc4e74,0xa6ca82fc,0xb0d090e0,0x15d8a733,0x4a9804f1,0xf7daec41,0x0e50cd7f,0x2ff69117,0x8dd64d76,0x4db0ef43,0x544daacc,0xdf0496e4,0xe3b5d19e,0x1b886a4c,0xb81f2cc1,0x7f516546,0x04ea5e9d,0x5d358c01,0x737487fa,0x2e410bfb,0x5a1d67b3,0x52d2db92,0x335610e9,0x1347d66d,0x8c61d79a,0x7a0ca137,0x8e14f859,0x893c13eb,0xee27a9ce,0x35c961b7,0xede51ce1,0x3cb1477a,0x59dfd29c,0x3f73f255,0x79ce1418,0xbf37c773,0xeacdf753,0x5baafd5f,0x146f3ddf,0x86db4478,0x81f3afca,0x3ec468b9,0x2c342438,0x5f40a3c2,0x72c31d16,0x0c25e2bc,0x8b493c28,0x41950dff,0x7101a839,0xdeb30c08,0x9ce4b4d8,0x90c15664,0x6184cb7b,0x70b632d5,0x745c6c48,0x4257b8d0];final kH=[0xa7f45150,0x65417e53,0xa4171ac3,0x5e273a96,0x6bab3bcb,0x459d1ff1,0x58faacab,0x03e34b93,0xfa302055,0x6d76adf6,0x76cc8891,0x4c02f525,0xd7e54ffc,0xcb2ac5d7,0x44352680,0xa362b58f,0x5ab1de49,0x1bba2567,0x0eea4598,0xc0fe5de1,0x752fc302,0xf04c8112,0x97468da3,0xf9d36bc6,0x5f8f03e7,0x9c921595,0x7a6dbfeb,0x595295da,0x83bed42d,0x217458d3,0x69e04929,0xc8c98e44,0x89c2756a,0x798ef478,0x3e58996b,0x71b927dd,0x4fe1beb6,0xad88f017,0xac20c966,0x3ace7db4,0x4adf6318,0x311ae582,0x33519760,0x7f536245,0x7764b1e0,0xae6bbb84,0xa081fe1c,0x2b08f994,0x68487058,0xfd458f19,0x6cde9487,0xf87b52b7,0xd373ab23,0x024b72e2,0x8f1fe357,0xab55662a,0x28ebb207,0xc2b52f03,0x7bc5869a,0x0837d3a5,0x872830f2,0xa5bf23b2,0x6a0302ba,0x8216ed5c,0x1ccf8a2b,0xb479a792,0xf207f3f0,0xe2694ea1,0xf4da65cd,0xbe0506d5,0x6234d11f,0xfea6c48a,0x532e349d,0x55f3a2a0,0xe18a0532,0xebf6a475,0xec830b39,0xef6040aa,0x9f715e06,0x106ebd51,0x8a213ef9,0x06dd963d,0x053eddae,0xbde64d46,0x8d5491b5,0x5dc47105,0xd406046f,0x155060ff,0xfb981924,0xe9bdd697,0x434089cc,0x9ed96777,0x42e8b0bd,0x8b890788,0x5b19e738,0xeec879db,0x0a7ca147,0x0f427ce9,0x1e84f8c9,0x00000000,0x86800983,0xed2b3248,0x70111eac,0x725a6c4e,0xff0efdfb,0x38850f56,0xd5ae3d1e,0x392d3627,0xd90f0a64,0xa65c6821,0x545b9bd1,0x2e36243a,0x670a0cb1,0xe757930f,0x96eeb4d2,0x919b1b9e,0xc5c0804f,0x20dc61a2,0x4b775a69,0x1a121c16,0xba93e20a,0x2aa0c0e5,0xe0223c43,0x171b121d,0x0d090e0b,0xc78bf2ad,0xa8b62db9,0xa91e14c8,0x19f15785,0x0775af4c,0xdd99eebb,0x607fa3fd,0x2601f79f,0xf5725cbc,0x3b6644c5,0x7efb5b34,0x29438b76,0xc623cbdc,0xfcedb668,0xf1e4b863,0xdc31d7ca,0x85634210,0x22971340,0x11c68420,0x244a857d,0x3dbbd2f8,0x32f9ae11,0xa129c76d,0x2f9e1d4b,0x30b2dcf3,0x52860dec,0xe3c177d0,0x16b32b6c,0xb970a999,0x489411fa,0x64e94722,0x8cfca8c4,0x3ff0a01a,0x2c7d56d8,0x903322ef,0x4e4987c7,0xd138d9c1,0xa2ca8cfe,0x0bd49836,0x81f5a6cf,0xde7aa528,0x8eb7da26,0xbfad3fa4,0x9d3a2ce4,0x9278500d,0xcc5f6a9b,0x467e5462,0x138df6c2,0xb8d890e8,0xf7392e5e,0xafc382f5,0x805d9fbe,0x93d0697c,0x2dd56fa9,0x1225cfb3,0x99acc83b,0x7d1810a7,0x639ce86e,0xbb3bdb7b,0x7826cd09,0x18596ef4,0xb79aec01,0x9a4f83a8,0x6e95e665,0xe6ffaa7e,0xcfbc2108,0xe815efe6,0x9be7bad9,0x366f4ace,0x099fead4,0x7cb029d6,0xb2a431af,0x233f2a31,0x94a5c630,0x66a235c0,0xbc4e7437,0xca82fca6,0xd090e0b0,0xd8a73315,0x9804f14a,0xdaec41f7,0x50cd7f0e,0xf691172f,0xd64d768d,0xb0ef434d,0x4daacc54,0x0496e4df,0xb5d19ee3,0x886a4c1b,0x1f2cc1b8,0x5165467f,0xea5e9d04,0x358c015d,0x7487fa73,0x410bfb2e,0x1d67b35a,0xd2db9252,0x5610e933,0x47d66d13,0x61d79a8c,0x0ca1377a,0x14f8598e,0x3c13eb89,0x27a9ceee,0xc961b735,0xe51ce1ed,0xb1477a3c,0xdfd29c59,0x73f2553f,0xce141879,0x37c773bf,0xcdf753ea,0xaafd5f5b,0x6f3ddf14,0xdb447886,0xf3afca81,0xc468b93e,0x3424382c,0x40a3c25f,0xc31d1672,0x25e2bc0c,0x493c288b,0x950dff41,0x01a83971,0xb30c08de,0xe4b4d89c,0xc1566490,0x84cb7b61,0xb632d570,0x5c6c4874,0x57b8d042];final lH=[0xf45150a7,0x417e5365,0x171ac3a4,0x273a965e,0xab3bcb6b,0x9d1ff145,0xfaacab58,0xe34b9303,0x302055fa,0x76adf66d,0xcc889176,0x02f5254c,0xe54ffcd7,0x2ac5d7cb,0x35268044,0x62b58fa3,0xb1de495a,0xba25671b,0xea45980e,0xfe5de1c0,0x2fc30275,0x4c8112f0,0x468da397,0xd36bc6f9,0x8f03e75f,0x9215959c,0x6dbfeb7a,0x5295da59,0xbed42d83,0x7458d321,0xe0492969,0xc98e44c8,0xc2756a89,0x8ef47879,0x58996b3e,0xb927dd71,0xe1beb64f,0x88f017ad,0x20c966ac,0xce7db43a,0xdf63184a,0x1ae58231,0x51976033,0x5362457f,0x64b1e077,0x6bbb84ae,0x81fe1ca0,0x08f9942b,0x48705868,0x458f19fd,0xde94876c,0x7b52b7f8,0x73ab23d3,0x4b72e202,0x1fe3578f,0x55662aab,0xebb20728,0xb52f03c2,0xc5869a7b,0x37d3a508,0x2830f287,0xbf23b2a5,0x0302ba6a,0x16ed5c82,0xcf8a2b1c,0x79a792b4,0x07f3f0f2,0x694ea1e2,0xda65cdf4,0x0506d5be,0x34d11f62,0xa6c48afe,0x2e349d53,0xf3a2a055,0x8a0532e1,0xf6a475eb,0x830b39ec,0x6040aaef,0x715e069f,0x6ebd5110,0x213ef98a,0xdd963d06,0x3eddae05,0xe64d46bd,0x5491b58d,0xc471055d,0x06046fd4,0x5060ff15,0x981924fb,0xbdd697e9,0x4089cc43,0xd967779e,0xe8b0bd42,0x8907888b,0x19e7385b,0xc879dbee,0x7ca1470a,0x427ce90f,0x84f8c91e,0x00000000,0x80098386,0x2b3248ed,0x111eac70,0x5a6c4e72,0x0efdfbff,0x850f5638,0xae3d1ed5,0x2d362739,0x0f0a64d9,0x5c6821a6,0x5b9bd154,0x36243a2e,0x0a0cb167,0x57930fe7,0xeeb4d296,0x9b1b9e91,0xc0804fc5,0xdc61a220,0x775a694b,0x121c161a,0x93e20aba,0xa0c0e52a,0x223c43e0,0x1b121d17,0x090e0b0d,0x8bf2adc7,0xb62db9a8,0x1e14c8a9,0xf1578519,0x75af4c07,0x99eebbdd,0x7fa3fd60,0x01f79f26,0x725cbcf5,0x6644c53b,0xfb5b347e,0x438b7629,0x23cbdcc6,0xedb668fc,0xe4b863f1,0x31d7cadc,0x63421085,0x97134022,0xc6842011,0x4a857d24,0xbbd2f83d,0xf9ae1132,0x29c76da1,0x9e1d4b2f,0xb2dcf330,0x860dec52,0xc177d0e3,0xb32b6c16,0x70a999b9,0x9411fa48,0xe9472264,0xfca8c48c,0xf0a01a3f,0x7d56d82c,0x3322ef90,0x4987c74e,0x38d9c1d1,0xca8cfea2,0xd498360b,0xf5a6cf81,0x7aa528de,0xb7da268e,0xad3fa4bf,0x3a2ce49d,0x78500d92,0x5f6a9bcc,0x7e546246,0x8df6c213,0xd890e8b8,0x392e5ef7,0xc382f5af,0x5d9fbe80,0xd0697c93,0xd56fa92d,0x25cfb312,0xacc83b99,0x1810a77d,0x9ce86e63,0x3bdb7bbb,0x26cd0978,0x596ef418,0x9aec01b7,0x4f83a89a,0x95e6656e,0xffaa7ee6,0xbc2108cf,0x15efe6e8,0xe7bad99b,0x6f4ace36,0x9fead409,0xb029d67c,0xa431afb2,0x3f2a3123,0xa5c63094,0xa235c066,0x4e7437bc,0x82fca6ca,0x90e0b0d0,0xa73315d8,0x04f14a98,0xec41f7da,0xcd7f0e50,0x91172ff6,0x4d768dd6,0xef434db0,0xaacc544d,0x96e4df04,0xd19ee3b5,0x6a4c1b88,0x2cc1b81f,0x65467f51,0x5e9d04ea,0x8c015d35,0x87fa7374,0x0bfb2e41,0x67b35a1d,0xdb9252d2,0x10e93356,0xd66d1347,0xd79a8c61,0xa1377a0c,0xf8598e14,0x13eb893c,0xa9ceee27,0x61b735c9,0x1ce1ede5,0x477a3cb1,0xd29c59df,0xf2553f73,0x141879ce,0xc773bf37,0xf753eacd,0xfd5f5baa,0x3ddf146f,0x447886db,0xafca81f3,0x68b93ec4,0x24382c34,0xa3c25f40,0x1d1672c3,0xe2bc0c25,0x3c288b49,0x0dff4195,0xa8397101,0x0c08deb3,0xb4d89ce4,0x566490c1,0xcb7b6184,0x32d570b6,0x6c48745c,0xb8d04257];final mH=[0x5150a7f4,0x7e536541,0x1ac3a417,0x3a965e27,0x3bcb6bab,0x1ff1459d,0xacab58fa,0x4b9303e3,0x2055fa30,0xadf66d76,0x889176cc,0xf5254c02,0x4ffcd7e5,0xc5d7cb2a,0x26804435,0xb58fa362,0xde495ab1,0x25671bba,0x45980eea,0x5de1c0fe,0xc302752f,0x8112f04c,0x8da39746,0x6bc6f9d3,0x03e75f8f,0x15959c92,0xbfeb7a6d,0x95da5952,0xd42d83be,0x58d32174,0x492969e0,0x8e44c8c9,0x756a89c2,0xf478798e,0x996b3e58,0x27dd71b9,0xbeb64fe1,0xf017ad88,0xc966ac20,0x7db43ace,0x63184adf,0xe582311a,0x97603351,0x62457f53,0xb1e07764,0xbb84ae6b,0xfe1ca081,0xf9942b08,0x70586848,0x8f19fd45,0x94876cde,0x52b7f87b,0xab23d373,0x72e2024b,0xe3578f1f,0x662aab55,0xb20728eb,0x2f03c2b5,0x869a7bc5,0xd3a50837,0x30f28728,0x23b2a5bf,0x02ba6a03,0xed5c8216,0x8a2b1ccf,0xa792b479,0xf3f0f207,0x4ea1e269,0x65cdf4da,0x06d5be05,0xd11f6234,0xc48afea6,0x349d532e,0xa2a055f3,0x0532e18a,0xa475ebf6,0x0b39ec83,0x40aaef60,0x5e069f71,0xbd51106e,0x3ef98a21,0x963d06dd,0xddae053e,0x4d46bde6,0x91b58d54,0x71055dc4,0x046fd406,0x60ff1550,0x1924fb98,0xd697e9bd,0x89cc4340,0x67779ed9,0xb0bd42e8,0x07888b89,0xe7385b19,0x79dbeec8,0xa1470a7c,0x7ce90f42,0xf8c91e84,0x00000000,0x09838680,0x3248ed2b,0x1eac7011,0x6c4e725a,0xfdfbff0e,0x0f563885,0x3d1ed5ae,0x3627392d,0x0a64d90f,0x6821a65c,0x9bd1545b,0x243a2e36,0x0cb1670a,0x930fe757,0xb4d296ee,0x1b9e919b,0x804fc5c0,0x61a220dc,0x5a694b77,0x1c161a12,0xe20aba93,0xc0e52aa0,0x3c43e022,0x121d171b,0x0e0b0d09,0xf2adc78b,0x2db9a8b6,0x14c8a91e,0x578519f1,0xaf4c0775,0xeebbdd99,0xa3fd607f,0xf79f2601,0x5cbcf572,0x44c53b66,0x5b347efb,0x8b762943,0xcbdcc623,0xb668fced,0xb863f1e4,0xd7cadc31,0x42108563,0x13402297,0x842011c6,0x857d244a,0xd2f83dbb,0xae1132f9,0xc76da129,0x1d4b2f9e,0xdcf330b2,0x0dec5286,0x77d0e3c1,0x2b6c16b3,0xa999b970,0x11fa4894,0x472264e9,0xa8c48cfc,0xa01a3ff0,0x56d82c7d,0x22ef9033,0x87c74e49,0xd9c1d138,0x8cfea2ca,0x98360bd4,0xa6cf81f5,0xa528de7a,0xda268eb7,0x3fa4bfad,0x2ce49d3a,0x500d9278,0x6a9bcc5f,0x5462467e,0xf6c2138d,0x90e8b8d8,0x2e5ef739,0x82f5afc3,0x9fbe805d,0x697c93d0,0x6fa92dd5,0xcfb31225,0xc83b99ac,0x10a77d18,0xe86e639c,0xdb7bbb3b,0xcd097826,0x6ef41859,0xec01b79a,0x83a89a4f,0xe6656e95,0xaa7ee6ff,0x2108cfbc,0xefe6e815,0xbad99be7,0x4ace366f,0xead4099f,0x29d67cb0,0x31afb2a4,0x2a31233f,0xc63094a5,0x35c066a2,0x7437bc4e,0xfca6ca82,0xe0b0d090,0x3315d8a7,0xf14a9804,0x41f7daec,0x7f0e50cd,0x172ff691,0x768dd64d,0x434db0ef,0xcc544daa,0xe4df0496,0x9ee3b5d1,0x4c1b886a,0xc1b81f2c,0x467f5165,0x9d04ea5e,0x015d358c,0xfa737487,0xfb2e410b,0xb35a1d67,0x9252d2db,0xe9335610,0x6d1347d6,0x9a8c61d7,0x377a0ca1,0x598e14f8,0xeb893c13,0xceee27a9,0xb735c961,0xe1ede51c,0x7a3cb147,0x9c59dfd2,0x553f73f2,0x1879ce14,0x73bf37c7,0x53eacdf7,0x5f5baafd,0xdf146f3d,0x7886db44,0xca81f3af,0xb93ec468,0x382c3424,0xc25f40a3,0x1672c31d,0xbc0c25e2,0x288b493c,0xff41950d,0x397101a8,0x08deb30c,0xd89ce4b4,0x6490c156,0x7b6184cb,0xd570b632,0x48745c6c,0xd04257b8];abstract class Mz implements pl{Uint8List process(Uint8List B){var A=new Uint8List(blockSize);var C=iR(B,0,A,0);return A.sublist(0,C);}}abstract class Nz implements ol{Uint8List process(Uint8List A){update(A,0,A.length);var B=new Uint8List(ru);var C=q_(B,0);return B.sublist(0,C);}}abstract class wl extends Nz{final gFB=new AH(0);final hFB=new Uint8List(4);int iFB;final Endianness jFB;final kFB;final state;final buffer;int UU;wl(this.jFB,int A,int C,[int B=null]):kFB=(B==null)?A:B,state=new List<int>(A),buffer=new List<int>(C){reset();}void Ex();void iR();void reset(){gFB.set(0);iFB=0;hFB.fillRange(0,hFB.length,0);UU=0;buffer.fillRange(0,buffer.length,0);Ex();}void Bb(int A){hFB[iFB++ ]=Am(A);lFB();gFB.sum(1);}void update(Uint8List D,int B,int C){var A;A=mFB(D,B,C);B+= A;C-= A;A=nFB(D,B,C);B+= A;C-= A;oFB(D,B,C);}int q_(Uint8List A,int B){var C=new AH(gFB)..fBB(3);pFB();qFB(C);rFB();sFB(A,B);reset();return ru;}void tFB(Uint8List A,int B){buffer[UU++ ]=uP(A,B,jFB);if(UU==16){rFB();}}void rFB(){iR();UU=0;buffer.fillRange(0,16,0);}void oFB(Uint8List C,int A,int B){while(B>0){Bb(C[A]);A++ ;B-- ;}}int nFB(Uint8List D,int A,int B){int C=0;while(B>hFB.length){tFB(D,A);A+= hFB.length;B-= hFB.length;gFB.sum(hFB.length);C+= 4;}return C;}int mFB(Uint8List D,int A,int B){var C=0;while((iFB!=0)&&(B>0)){Bb(D[A]);A++ ;B-- ;C++ ;}return C;}void lFB(){if(iFB==hFB.length){tFB(hFB,0);iFB=0;}}void pFB(){Bb(128);while(iFB!=0){Bb(0);}}void qFB(AH A){if(UU>14){rFB();}switch (jFB){case Endianness.LITTLE_ENDIAN:buffer[14]=A.Kw;buffer[15]=A.vv;break;case Endianness.BIG_ENDIAN:buffer[14]=A.vv;buffer[15]=A.Kw;break;default:throw new StateError("Invalid endianness: ${jFB}");}}void sFB(Uint8List B,int C){for(int A=0;A<kFB;A++ ){BS(state[A],B,(C+A*4),jFB);}}}class cN extends wl implements ol{static const Oz=32;cN():super(Endianness.BIG_ENDIAN,8,64);final CEB="SHA-256";final ru=Oz;void Ex(){state[0]=0x6a09e667;state[1]=0xbb67ae85;state[2]=0x3c6ef372;state[3]=0xa54ff53a;state[4]=0x510e527f;state[5]=0x9b05688c;state[6]=0x1f83d9ab;state[7]=0x5be0cd19;}void iR(){for(var A=16;A<64;A++ ){buffer[A]=NC(uFB(buffer[A-2])+buffer[A-7]+vFB(buffer[A-15])+buffer[A-16]);}var B=state[0];var C=state[1];var D=state[2];var G=state[3];var H=state[4];var I=state[5];var J=state[6];var K=state[7];var A=0;for(var M=0;M<8;M++ ){K=NC(K+wFB(H)+xFB(H,I,J)+CM[A]+buffer[A]);G=NC(G+K);K=NC(K+yFB(B)+zFB(B,C,D)); ++A;J=NC(J+wFB(G)+xFB(G,H,I)+CM[A]+buffer[A]);D=NC(D+J);J=NC(J+yFB(K)+zFB(K,B,C)); ++A;I=NC(I+wFB(D)+xFB(D,G,H)+CM[A]+buffer[A]);C=NC(C+I);I=NC(I+yFB(J)+zFB(J,K,B)); ++A;H=NC(H+wFB(C)+xFB(C,D,G)+CM[A]+buffer[A]);B=NC(B+H);H=NC(H+yFB(I)+zFB(I,J,K)); ++A;G=NC(G+wFB(B)+xFB(B,C,D)+CM[A]+buffer[A]);K=NC(K+G);G=NC(G+yFB(H)+zFB(H,I,J)); ++A;D=NC(D+wFB(K)+xFB(K,B,C)+CM[A]+buffer[A]);J=NC(J+D);D=NC(D+yFB(G)+zFB(G,H,I)); ++A;C=NC(C+wFB(J)+xFB(J,K,B)+CM[A]+buffer[A]);I=NC(I+C);C=NC(C+yFB(D)+zFB(D,G,H)); ++A;B=NC(B+wFB(I)+xFB(I,J,K)+CM[A]+buffer[A]);H=NC(H+B);B=NC(B+yFB(C)+zFB(C,D,G)); ++A;}state[0]=NC(state[0]+B);state[1]=NC(state[1]+C);state[2]=NC(state[2]+D);state[3]=NC(state[3]+G);state[4]=NC(state[4]+H);state[5]=NC(state[5]+I);state[6]=NC(state[6]+J);state[7]=NC(state[7]+K);}int xFB(int A,int B,int C)=>(A&B)^((~A)&C);int zFB(int A,int B,int C)=>(A&B)^(A&C)^(B&C);int yFB(int A)=>dI(A,2)^dI(A,13)^dI(A,22);int wFB(int A)=>dI(A,6)^dI(A,11)^dI(A,25);int vFB(int A)=>dI(A,7)^dI(A,18)^lb(A,3);int uFB(int A)=>dI(A,17)^dI(A,19)^lb(A,10);static final CM=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];}class xl implements YJ{final String r_;final sl bE;final List<int> UV;final bN Hg;final e Qj;e AGB;xl(this.r_,this.bE,this.Hg,this.Qj,[this.AGB=null,this.UV=null]){if(AGB==null){AGB=e.ZK;}}}abstract class OE implements Fz{e YH();int get gU;int get O_=>((gU+7)~/8);OE operator+(OE A);OE operator-(OE A);OE operator*(OE A);OE operator/(OE A);OE operator-();OE XV();OE sqrt();String toString()=>YH().toString();}abstract class tD implements bN{final fb bE;final OE x;final OE y;final bool uO;final Pz BGB;rP CGB;tD(this.bE,this.x,this.y,this.uO,[this.BGB=Qz]);bool get dL=>(x==null&&y==null);void set BBB(rP A){CGB=A;}bool operator==(A){if(A is tD){if(dL){return A.dL;}return x==A.x&&y==A.y;}return false;}String toString()=>"(${x},${y})";int get hashCode{if(dL){return 0;}return x.hashCode^y.hashCode;}Uint8List UR([bool A=true]);tD operator+(tD A);tD operator-(tD A);tD operator-();tD eV();tD operator*(e A){if(A.oG()<0){throw new ArgumentError("The multiplicator cannot be negative");}if(dL){return this;}if(A.oG()==0){return bE.bR;}return BGB(this,A,CGB);}}abstract class fb implements sl{OE DGB;OE EGB;fb(e A,e B){this.DGB=bL(A);this.EGB=bL(B);}OE get GU=>DGB;OE get UZ=>EGB;int get gU;tD get bR;OE bL(e A);tD mu(e A,e B,[bool C=false]);tD pu(int A,e B);tD qO(List<int> A){tD C=null;int B=(gU+7)~/8;switch (A[0]){case 0x00:if(A.length!=1){throw new ArgumentError("Incorrect length for infinity encoding");}C=bR;break;case 0x02:case 0x03:if(A.length!=(B+1)){throw new ArgumentError("Incorrect length for compressed encoding");}int G=A[0]&1;var D=FGB(A,1,B);C=pu(G,D);break;case 0x04:case 0x06:case 0x07:if(A.length!=(2*B+1)){throw new ArgumentError("Incorrect length for uncompressed/hybrid encoding");}e D=FGB(A,1,B);e H=FGB(A,1+B,B);C=mu(D,H,false);break;default:throw new ArgumentError("Invalid point encoding 0x"+A[0].toRadixString(16));}return C;}e FGB(List<int> B,int A,int C){return new e.jCB(1,B.sublist(A,A+C));}}abstract class rP{}typedef tD Pz(tD _0,e _1,rP _2);tD Qz(tD C,e I,rP M){e D=I;e G=D*e.gl;tD J=-C;tD A=C;for(var B=G.bitLength()-2;B>0; --B){A=A.eV();var H=G.SJ(B);var K=D.SJ(B);if(H!=K){A+= (H?C:J);}}return A;}class zC extends OE{final e nB;final e x;zC(this.nB,this.x){if(x>=nB){throw new ArgumentError("Value x must be smaller than q");}}int get gU=>nB.bitLength();e YH()=>x;zC operator+(zC A)=>new zC(nB,(x+A.YH())%nB);zC operator-(zC A)=>new zC(nB,(x-A.YH())%nB);zC operator*(zC A)=>new zC(nB,(x*A.YH())%nB);zC operator/(zC A)=>new zC(nB,(x*A.YH().modInverse(nB))%nB);zC operator-()=>new zC(nB,-x%nB);zC XV()=>new zC(nB,x.modPow(e.Vb,nB));zC sqrt(){if(!nB.SJ(0)){throw new UnimplementedError("Not implemented yet");}if(nB.SJ(1)){var G=new zC(nB,x.modPow((nB>>2)+e.ZK,nB));return G.XV()==this?G:null;}var C=nB-e.ZK;var H=C>>1;if(x.modPow(H,nB)!=e.ZK){return null;}var M=C>>2;var O=(M<<1)+e.ZK;var I=x;var J=(I>>2)%nB;var D,A;var P=new BM();do{e B;do{B=P.Zw(nB.bitLength());}while((B>=nB)||(((B*B)-J).modPow(H,nB)!=C));List<e> K=GGB(nB,B,I,O);D=K[0];A=K[1];if(((A*A)%nB)==J){if(A.SJ(0)){A=A+nB;}A=(A>>1);return new zC(nB,A);}}while((D==e.ZK)||(D==C));return null;}List<e> GGB(e B,e J,e M,e K){var P=K.bitLength();var O=K.Ow;e D=e.ZK;e C=e.Vb;e G=J;e A=e.ZK;e H=e.ZK;for(var I=P-1;I>=(O+1);I-- ){A=(A*H)%B;if(K.SJ(I)){H=(A*M)%B;D=(D*G)%B;C=((G*C)-(J*A))%B;G=((G*G)-(H<<1))%B;}else{H=A;D=((D*C)-A)%B;G=((G*C)-(J*A))%B;C=((C*C)-(A<<1))%B;}}A=(A*H)%B;H=(A*M)%B;D=((D*C)-A)%B;C=((G*C)-(J*A))%B;A=(A*H)%B;for(var I=1;I<=O;I++ ){D=(D*C)%B;C=((C*C)-(A<<1))%B;A=(A*A)%B;}return [D,C];}bool operator==(A){if(A is zC){return (nB==A.nB)&&(x==A.x);}return false;}int get hashCode=>nB.hashCode^x.hashCode;}class RD extends tD{RD(BW C,zC A,zC B,[bool D=false]):super(C,A,B,D,Rz){if((A!=null&&B==null)||(A==null&&B!=null)){throw new ArgumentError("Exactly one of the field elements is null");}}Uint8List UR([bool H=true]){if(dL){return new Uint8List.fromList([1]);}var C=x.O_;if(H){int D;if(y.YH().SJ(0)){D=0x03;}else{D=0x02;}Uint8List B=hb(x.YH(),C);Uint8List A=new Uint8List(B.length+1);A[0]=D.toInt();A.setAll(1,B);return A;}else{Uint8List B=hb(x.YH(),C);Uint8List G=hb(y.YH(),C);Uint8List A=new Uint8List(B.length+G.length+1);A[0]=0x04;A.setAll(1,B);A.setAll(B.length+1,G);return A;}}RD operator+(RD A){if(dL){return A;}if(A.dL){return this;}if(x==A.x){if(y==A.y){return eV();}return bE.bR;}var B=(A.y-y)/(A.x-x);var C=(B.XV()-x)-A.x;var D=(B*(x-C))-y;return new RD(bE,C,D,uO);}RD eV(){if(dL){return this;}if(y.YH()==0){return this.bE.bR;}var A=bE.bL(e.Vb);var D=bE.bL(e.gl);var B=((x.XV()*D)+bE.GU)/(y*A);var C=B.XV()-(x*A);var G=(B*(x-C))-y;return new RD(bE,C,G,uO);}RD operator-(RD A){if(A.dL){return this;}return this+(-A);}RD operator-(){return new RD(bE,x,-y,uO);}}class BW extends fb{final e nB;RD HGB;BW(this.nB,e A,e B):super(A,B){HGB=new RD(this,null,null);}int get gU=>nB.bitLength();RD get bR=>HGB;zC bL(e A)=>new zC(this.nB,A);RD mu(e A,e B,[bool C=false])=>new RD(this,bL(A),bL(B),C);RD pu(int D,e G){var A=bL(G);var H=(A*((A*A)+GU))+UZ;zC B=H.sqrt();if(B==null){throw new ArgumentError("Invalid point compression");}var C=B.YH();var I=C.SJ(0)?1:0;if(I!=D){B=bL(nB-C);}return new RD(this,A,B,true);}bool operator==(A){if(A is BW){return nB==A.nB&&GU==A.GU&&UZ==A.UZ;}return false;}int get hashCode=>GU.hashCode^UZ.hashCode^nB.hashCode;}class gb implements rP{List<RD> tw;RD ox;}RD Rz(RD K,e Q,rP O){gb G=O;if((O==null)&&(O is!gb)){G=new gb();}var H=Q.bitLength();var D;var C;if(H<13){D=2;C=1;}else{if(H<41){D=3;C=2;}else{if(H<121){D=4;C=4;}else{if(H<337){D=5;C=8;}else{if(H<897){D=6;C=16;}else{if(H<2305){D=7;C=32;}else{D=8;C=127;}}}}}}var P=1;var A=G.tw;var M=G.ox;if(A==null){A=new List<RD>.filled(1,K);}else{P=A.length;}if(M==null){M=K.eV();}if(P<C){List<RD> S=A;A=new List<RD>(C);A.setAll(0,S);for(int B=P;B<C;B++ ){A[B]=M+(A[B-1]);}}var I=Sz(D,Q);var Z=I.length;var J=K.bE.bR;for(int B=Z-1;B>=0;B-- ){J=J.eV();if(I[B]!=0){if(I[B]>0){J+= A[(I[B]-1)~/2];}else{J-= A[(-I[B]-1)~/2];}}}G.tw=A;G.ox=M;K.BBB=G;return J;}List<int> Sz(int H,e C){List<int> B=new List<int>(C.bitLength()+1);int I=(1<<H);e K=new e(I);int A=0;int D=0;while(C.oG()>0){if(C.SJ(0)){e G=C.AV(K);if(G.SJ(H-1)){B[A]=G.NG()-I;}else{B[A]=G.NG();}B[A]%=0x100;if((B[A]&0x80)!=0){B[A]=B[A]-256;}C=C-new e(B[A]);D=A;}else{B[A]=0;}C=C.fa(1);A++ ;}D++ ;List<int> J=new List<int>(D);J.setAll(0,B.sublist(0,D));return J;}Uint8List hb(e C,int B){Uint8List A=new Uint8List.fromList(C.MP());if(B<A.length){return A.sublist(A.length-B);}else if(B>A.length){return new Uint8List(B)..setAll(B-A.length,A);}return A;}class CW implements Ez{YJ IGB;BM JGB;void init(cI A){sP B;if(A is tP){JGB=A.LK;B=A.parameters;}else{JGB=new BM();B=A;}IGB=B.s_;}zV rZ(){var B=IGB.Qj;var C=B.bitLength();var A;do{A=JGB.Zw(C);}while(A==e.ny||(A>=B));var D=IGB.Hg*A;return new zV(new wE(D,IGB),new UG(A,IGB));}}class sP extends yl{YJ KGB;sP(YJ A):super(A.Qj.bitLength()){KGB=A;}YJ get s_=>KGB;}abstract class yl implements cI{final int L_;yl(this.L_);}class ib extends cI{final Uint8List key;ib(this.key);}class DW<Ig extends cI> implements cI{final Uint8List Dw;final Ig parameters;DW(this.parameters,this.Dw);}class tP<Ig extends cI> implements cI{final Ig parameters;final BM LK;tP(this.parameters,this.LK);}class jb extends zl implements BM{final pl WU;Uint8List LGB;Uint8List MGB;var NGB;jb(this.WU){LGB=new Uint8List(WU.blockSize);MGB=new Uint8List(WU.blockSize);NGB=MGB.length;}void UV(DW<cI> A){NGB=MGB.length;LGB.setAll(0,A.Dw);WU.init(true,A.parameters);}int AP(){if(NGB==MGB.length){WU.iR(LGB,0,MGB,0);NGB=0;OGB();}return Am(MGB[NGB++ ]);}void OGB(){int A=LGB.length;do{A-- ;LGB[A]+=1;}while(LGB[A]==0);}}abstract class zl implements BM{int bAB(){var A=AP();var B=AP();return Xz((B<<8)|A);}e Zw(int A){return new e.jCB(1,PGB(A));}List<int> PGB(int B){if(B<0){throw new ArgumentError("numBits must be non-negative");}var A=(B+7)~/8;var C=new Uint8List(A);if(A>0){for(var D=0;D<A;D++ ){C[D]=AP();}int G=8*A-B;C[0]&=(1<<(8-G))-1;}return C;}}const kb=0x1F;const Tz=0x3F;const Uz=0xFF;const Vz=0xFFFF;const WF=0xFFFFFFFF;final Wz=[0xFFFFFFFF,0x7FFFFFFF,0x3FFFFFFF,0x1FFFFFFF,0x0FFFFFFF,0x07FFFFFF,0x03FFFFFF,0x01FFFFFF,0x00FFFFFF,0x007FFFFF,0x003FFFFF,0x001FFFFF,0x000FFFFF,0x0007FFFF,0x0003FFFF,0x0001FFFF,0x0000FFFF,0x00007FFF,0x00003FFF,0x00001FFF,0x00000FFF,0x000007FF,0x000003FF,0x000001FF,0x000000FF,0x0000007F,0x0000003F,0x0000001F,0x0000000F,0x00000007,0x00000003,0x00000001,0x00000000];int Am(int A)=>(A&Uz);int Xz(int A)=>(A&Vz);int NC(int A)=>(A&WF);int EW(int A,int B){assert((A>=0)&&(A<=WF));B&= kb;A&= Wz[B];return ((A<<B)&WF);}int lb(int A,int B){assert((A>=0)&&(A<=WF));B&= kb;return (A>>B);}int dI(int A,int B){assert(B>=0);assert((A>=0)&&(A<=WF));B&= kb;return (A>>B)|EW(A,(32-B));}void BS(int B,dynamic A,int C,Endianness D){assert((B>=0)&&(B<=WF));if(A is!ByteData){A=new ByteData.view(A.buffer);}(A as ByteData).setUint32(C,B,D);}int uP(dynamic A,int B,Endianness C){if(A is!ByteData){A=new ByteData.view(A.buffer);}return (A as ByteData).getUint32(B,C);}class AH{int QGB;int RGB;AH([dynamic A=0,int B=null]){set(A,B);}int get Kw=>RGB;int get vv=>QGB;bool operator==(AH A)=>((QGB==A.QGB)&&(RGB==A.RGB));bool operator<(AH A)=>((QGB<A.QGB)||((QGB==A.QGB)&&(RGB<A.RGB)));bool operator<=(AH A)=>((this<A)||(this==A));bool operator>(AH A)=>((QGB>A.QGB)||((QGB==A.QGB)&&(RGB>A.RGB)));bool operator>=(AH A)=>((this>A)||(this==A));void set(dynamic A,[int B=null]){if(B==null){if(A is AH){QGB=A.QGB;RGB=A.RGB;}else{assert(A<=WF);QGB=0;RGB=A;}}else{assert(A<=WF);assert(B<=WF);QGB=A;RGB=B;}}void sum(dynamic A){if(A is int){A&= WF;int B=(RGB+A);RGB=(B&WF);if(B!=RGB){QGB++ ;QGB&= WF;}}else{int B=(RGB+A.RGB);RGB=(B&WF);int C=((B!=RGB)?1:0);QGB=(((QGB+A.QGB+C) as int)&WF);}}void Rj(){BP();sum(1);}void BP(){QGB=(~QGB&WF);RGB=(~RGB&WF);}void kO(AH A){QGB&= A.QGB;RGB&= A.RGB;}void IK(AH A){QGB|= A.QGB;RGB|= A.RGB;}void Lb(AH A){QGB^= A.QGB;RGB^= A.RGB;}void fBB(int A){A&= Tz;if(A==0){}else if(A>=32){QGB=EW(RGB,(A-32));RGB=0;}else{QGB=EW(QGB,A);QGB|= RGB>>(32-A);RGB=EW(RGB,A);}}String toString(){var A=new StringBuffer();SGB(A,QGB);SGB(A,RGB);return A.toString();}void SGB(StringBuffer A,int D){var B=D.toRadixString(16);for(var C=(8-B.length);C>0;C-- ){A.write("0");}A.write(B);}}const String j5='\u001b[31m';const String Hr='\u001b[0m';abstract class aK{}class VG{static String iz(List<int> A){return ob.Zz(A);}static String gN(List<int> A,{bool urlSafe: false,bool addLineSeparator: false}){return ob.bz(A,urlSafe,addLineSeparator);}static List<int> wP(String A){return ob.cz(A);}}const tb Fm=const tb();const List<int> pb=const[-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-1,-2,-2,-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,62,-2,62,-2,63,52,53,54,55,56,57,58,59,60,61,-2,-2,-2,0,-2,-2,-2,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-2,-2,-2,-2,63,-2,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2];const String ez="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";const String fz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const int gz=76;const int hz=13;const int jz=10;const List<int> Gm=const[61];const List<int> fN=const[37,51,68];const String kz="=";const String sb="%3D";class tb extends Codec<List<int>,String>{final bool TGB;final bool UGB;final bool VGB;const tb({bool urlSafe: false,bool addLineSeparator: false,bool encodePaddingCharacter: false}):TGB=urlSafe,UGB=addLineSeparator,VGB=encodePaddingCharacter;String get name=>"base64";String encode(List<int> A,{bool urlSafe,bool addLineSeparator,bool encodePaddingCharacter}){if(urlSafe==null)urlSafe=TGB;if(addLineSeparator==null)addLineSeparator=UGB;if(encodePaddingCharacter==null){encodePaddingCharacter=VGB;}return new xP(urlSafe:urlSafe,addLineSeparator:addLineSeparator,encodePaddingCharacter:encodePaddingCharacter).convert(A);}xP get encoder=>new xP(urlSafe:TGB,addLineSeparator:UGB,encodePaddingCharacter:VGB);GS get decoder=>new GS();}class xP extends Converter<List<int>,String>{final bool TGB;final bool UGB;final bool VGB;final List<int> WGB;const xP({bool urlSafe: false,bool addLineSeparator: false,bool encodePaddingCharacter: false}):TGB=urlSafe,UGB=addLineSeparator,VGB=encodePaddingCharacter,WGB=encodePaddingCharacter==true?fN:Gm;String convert(List<int> G,[int O=0,int J]){int Q=G.length;RangeError.checkValidRange(O,J,Q);if(J==null)J=Q;int K=J-O;if(K==0){return "";}final String D=TGB?ez:fz;final int I=K.remainder(3);final int h=K-I;int p=((K~/3)*4);int P;if(VGB){P=((I>0)?6:0);}else{P=((I>0)?4:0);}int M=p+P;if(UGB){M+= ((M-1)~/gz)<<1;}List<int> B=new List<int>(M);int A=0,H=O,S=0;while(H<h){int C=((G[H++ ]<<16)&0x00FFFFFF)|((G[H++ ]<<8)&0x00FFFFFF)|G[H++ ];B[A++ ]=D.codeUnitAt(C>>18);B[A++ ]=D.codeUnitAt((C>>12)&0x3F);B[A++ ]=D.codeUnitAt((C>>6)&0x3F);B[A++ ]=D.codeUnitAt(C&0x3F);if(UGB&& ++S==19&&A<M-2){B[A++ ]=hz;B[A++ ]=jz;S=0;}}if(I==1){int C=G[H];B[A++ ]=D.codeUnitAt(C>>2);B[A++ ]=D.codeUnitAt((C<<4)&0x3F);B.setRange(A,A+WGB.length,WGB);B.setRange(A+WGB.length,A+2*WGB.length,WGB);}else if(I==2){int C=G[H];int Z=G[H+1];B[A++ ]=D.codeUnitAt(C>>2);B[A++ ]=D.codeUnitAt(((C<<4)|(Z>>4))&0x3F);B[A++ ]=D.codeUnitAt((Z<<2)&0x3F);B.setRange(A,A+WGB.length,WGB);}return new String.fromCharCodes(B);}ub startChunkedConversion(Sink<String> A){StringConversionSink B;if(A is StringConversionSink){B=A;}else{B=new StringConversionSink.from(A);}return new ub(B,TGB,UGB);}}class ub extends ChunkedConversionSink<List<int>>{final xP XGB;final ChunkedConversionSink<String> YGB;final List<int> ZGB=new List<int>();int aGB=0;ub(this.YGB,A,B):XGB=new xP(urlSafe:A,addLineSeparator:B);void add(List<int> A){var B=(A.length+aGB)%3;int C=aGB+A.length-B;if(aGB+A.length>ZGB.length){ZGB.replaceRange(aGB,ZGB.length,A.sublist(0,ZGB.length-aGB));ZGB.addAll(A.sublist(ZGB.length-aGB));}else{ZGB.replaceRange(aGB,aGB+A.length,A);}YGB.add(XGB.convert(ZGB,0,C));ZGB.removeRange(0,C);aGB=B;}void close(){if(aGB>0){YGB.add(XGB.convert(ZGB.sublist(0,aGB)));}YGB.close();}}class GS extends Converter<String,List<int>>{const GS();List<int> convert(String B){int I=B.length;if(I==0){return new Uint8List(0);}int D=0;int A=0;while(A<I){int P=B.codeUnitAt(A);int G=pb[P];if(G==-2){if(P==fN[0]&&A<I-2&&B.codeUnitAt(A+1)==fN[1]&&B.codeUnitAt(A+2)==fN[2]){D++ ;A+= 2;}else{throw new FormatException('Invalid character',B,A);}}if(G>=0)D++ ;A++ ;}if(D%4!=0){throw new FormatException('''Size of Base 64 characters in Input
          must be a multiple of 4''',B,D);}int M=0;A=I-1;while(A>=0){int O=B.codeUnitAt(A);if(O==fN[2]&&A>=2&&B.codeUnitAt(A-1)==fN[1]&&B.codeUnitAt(A-2)==fN[0]){M++ ;A-= 2;}else if(pb[O]>0){break;}else if(O==Gm[0]){M++ ;}A-- ;}int J=((D*6)>>3)-M;List<int> K=new Uint8List(J);for(int A=0,C=0;C<J;){int H=0;for(int Q=4;Q>0;){int G=pb[B.codeUnitAt(A++ )];if(G>=0){H=((H<<6)&0x00FFFFFF)|G;Q-- ;}}K[C++ ]=H>>16;if(C<J){K[C++ ]=(H>>8)&0xFF;if(C<J)K[C++ ]=H&0xFF;}}return K;}vb startChunkedConversion(Sink<List<int>> A){if(A is!ByteConversionSink){A=new ByteConversionSink.from(A);}return new vb(A);}}class vb extends ChunkedConversionSink<String>{final GS bGB=new GS();final ChunkedConversionSink<List<int>> YGB;String cGB="";vb(this.YGB);void add(String A){if(A.isEmpty)return;if(cGB.isNotEmpty){A=cGB+A;}A=A.replaceAll(sb,kz);int B=A.length;if(A.length>3&&A.contains(sb[0],A.length-2)){B=A.lastIndexOf(sb[0]);}B-= B%4;cGB=A.substring(B);if(B>0){YGB.add(bGB.convert(A.substring(0,B)));}}void close(){if(cGB.isNotEmpty){YGB.add(bGB.convert(cGB));}YGB.close();}}abstract class ob{static String Zz(List<int> C){var A=new StringBuffer();for(var B in C){A.write('${B<16?'0':''}${B.toRadixString(16)}');}return A.toString();}static String bz(List<int> A,[bool B=false,bool C=false]){return Fm.encode(A,urlSafe:B,addLineSeparator:C);}static List<int> cz(String A){return Fm.decode(A);}}const eN=0xff;const EM=0xffffffff;const az=8;const FS=4;int qb(int A,int C){var B=C&31;return ((A<<B)&EM)|((A&EM)>>(32-B));}abstract class rb implements aK{final int dGB;final int eGB;final bool fGB;final Uint32List gGB;final Uint32List hGB;int iGB=0;List<int> jGB;bool kGB=false;rb(int A,int B,bool this.fGB):jGB=[] ,gGB=new Uint32List(A),hGB=new Uint32List(B),dGB=A,eGB=B;void add(List<int> A){if(kGB){throw new StateError('Hash update method called after digest was retrieved');}iGB+= A.length;jGB.addAll(A);lGB();}List<int> close(){if(kGB){return mGB();}kGB=true;nGB();lGB();assert(jGB.length==0);return mGB();}int get blockSize{return dGB*FS;}void oGB(Uint32List A);int pGB(A,B)=>(A+B)&EM;int qGB(B,A)=>(B+A-1)&-A;List<int> mGB(){var B=[] ;for(var A=0;A<hGB.length;A++ ){B.addAll(rGB(hGB[A]));}return B;}void sGB(List<int> B,int A){assert((B.length-A)>=(dGB*FS));for(var D=0;D<dGB;D++ ){var G=fGB?B[A]:B[A+3];var H=fGB?B[A+1]:B[A+2];var I=fGB?B[A+2]:B[A+1];var J=fGB?B[A+3]:B[A];A+= 4;var C=(G&0xff)<<24;C|= (H&eN)<<16;C|= (I&eN)<<8;C|= (J&eN);gGB[D]=C;}}List<int> rGB(int B){List A=new List<int>(FS);A[0]=(B>>(fGB?24:0))&eN;A[1]=(B>>(fGB?16:8))&eN;A[2]=(B>>(fGB?8:16))&eN;A[3]=(B>>(fGB?0:24))&eN;return A;}void lGB(){var B=jGB.length;var C=dGB*FS;if(B>=C){var A=0;for(;(B-A)>=C;A+= C){sGB(jGB,A);oGB(gGB);}jGB=jGB.sublist(A,B);}}void nGB(){jGB.add(0x80);var B=iGB+9;var D=dGB*FS;var G=qGB(B,D);var H=G-B;for(var C=0;C<H;C++ ){jGB.add(0);}var A=iGB*az;assert(A<pow(2,32));if(fGB){jGB.addAll(rGB(0));jGB.addAll(rGB(A&EM));}else{jGB.addAll(rGB(A&EM));jGB.addAll(rGB(0));}}}class vP{final List<int> tGB;aK uGB;List<int> vGB;bool wGB=false;vP(aK this.uGB,List<int> this.vGB):tGB=[] ;void add(List<int> A){if(wGB)throw new StateError("HMAC is closed");tGB.addAll(A);}List<int> get n_{var B=uGB.blockSize;if(vGB.length>B){uGB=uGB.newInstance();uGB.add(vGB);vGB=uGB.close();}if(vGB.length<B){var D=new List(B);D.setRange(0,vGB.length,vGB);for(var A=vGB.length;A<B;A++ ){D[A]=0;}vGB=D;}var C=new List(B);for(var A=0;A<B;A++ ){C[A]=0x36^vGB[A];}uGB=uGB.newInstance();uGB.add(C);uGB.add(tGB);var G=uGB.close();for(var A=0;A<B;A++ ){C[A]=0x5c^vGB[A];}uGB=uGB.newInstance();uGB.add(C);uGB.add(G);return uGB.close();}List<int> close(){wGB=true;return n_;}}class ZJ extends rb{final Uint32List xGB;ZJ():xGB=new Uint32List(80),super(16,5,true){hGB[0]=0x67452301;hGB[1]=0xEFCDAB89;hGB[2]=0x98BADCFE;hGB[3]=0x10325476;hGB[4]=0xC3D2E1F0;}ZJ newInstance(){return new ZJ();}void oGB(Uint32List J){assert(J.length==16);var H=hGB[0];var B=hGB[1];var D=hGB[2];var G=hGB[3];var I=hGB[4];for(var A=0;A<80;A++ ){if(A<16){xGB[A]=J[A];}else{var K=xGB[A-3]^xGB[A-8]^xGB[A-14]^xGB[A-16];xGB[A]=qb(K,1);}var C=pGB(pGB(qb(H,5),I),xGB[A]);if(A<20){C=pGB(pGB(C,(B&D)|(~B&G)),0x5A827999);}else if(A<40){C=pGB(pGB(C,(B^D^G)),0x6ED9EBA1);}else if(A<60){C=pGB(pGB(C,(B&D)|(B&G)|(D&G)),0x8F1BBCDC);}else{C=pGB(pGB(C,B^D^G),0xCA62C1D6);}I=G;G=D;D=qb(B,30);B=H;H=C&EM;}hGB[0]=pGB(H,hGB[0]);hGB[1]=pGB(B,hGB[1]);hGB[2]=pGB(D,hGB[2]);hGB[3]=pGB(G,hGB[3]);hGB[4]=pGB(I,hGB[4]);}}class ES extends rb{final Uint32List xGB;ES():xGB=new Uint32List(64),super(16,8,true){hGB[0]=0x6a09e667;hGB[1]=0xbb67ae85;hGB[2]=0x3c6ef372;hGB[3]=0xa54ff53a;hGB[4]=0x510e527f;hGB[5]=0x9b05688c;hGB[6]=0x1f83d9ab;hGB[7]=0x5be0cd19;}ES newInstance(){return new ES();}static const List<int> dz=const[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];yGB(A,B)=>(B>>A)|((B<<(32-A))&EM);zGB(A,B,C)=>(A&B)^((~A&EM)&C);AHB(A,B,C)=>(A&B)^(A&C)^(B&C);BHB(A)=>yGB(2,A)^yGB(13,A)^yGB(22,A);CHB(A)=>yGB(6,A)^yGB(11,A)^yGB(25,A);DHB(A)=>yGB(7,A)^yGB(18,A)^(A>>3);EHB(A)=>yGB(17,A)^yGB(19,A)^(A>>10);void oGB(Uint32List O){assert(O.length==16);var A=0;for(;A<16;A++ ){xGB[A]=O[A];}for(;A<64;A++ ){xGB[A]=pGB(pGB(EHB(xGB[A-2]),xGB[A-7]),pGB(DHB(xGB[A-15]),xGB[A-16]));}var B=hGB[0];var D=hGB[1];var G=hGB[2];var K=hGB[3];var C=hGB[4];var H=hGB[5];var I=hGB[6];var M=hGB[7];for(var J=0;J<64;J++ ){var P=pGB(pGB(M,CHB(C)),pGB(zGB(C,H,I),pGB(dz[J],xGB[J])));var Q=pGB(BHB(B),AHB(B,D,G));M=I;I=H;H=C;C=pGB(K,P);K=G;G=D;D=B;B=pGB(P,Q);}hGB[0]=pGB(B,hGB[0]);hGB[1]=pGB(D,hGB[1]);hGB[2]=pGB(G,hGB[2]);hGB[3]=pGB(K,hGB[3]);hGB[4]=pGB(C,hGB[4]);hGB[5]=pGB(H,hGB[5]);hGB[6]=pGB(I,hGB[6]);hGB[7]=pGB(M,hGB[7]);}}class ln extends d{}class sH extends k{static bool f2=const bool.fromEnvironment("dglux.server.watcher",defaultValue:false);static String rn;static d WS;static int sn=0;sH(bool C,bool D,List G,String H,pS I):super(enabledQuarantine:C,acceptAllConns:D,defaultPermission:G,downstreamName:H,storage:I){Lk=(String B,dynamic A){if(n==null){return;}if(B=="quarantine"&&A is bool){n.OV=A;}if(B=="allowAllLinks"&&A is bool){n.OZ=A;}if(B=="defaultPermission"&&A is List){n.defaultPermission=A;}n.WH();};}static SD un;void ti(){super.ti();var B=new Yo("/sys/get_server_log",this);var C=new Eo("/sys/clear_server_log",this);var A=new d("/sys/build_number",this);A.L[r"$name"]="Server Build";A.L[r"$type"]="string";u("/sys/build_number",A);A.v(rn);u(B.path,B);u(C.path,C);u("/sys/links",new KM("/sys/links",this));new CG("/sys/dglux",this);if(sH.f2){var H=new vc("/sys/restart_server",this);u("/sys/restart_server",H);}var I=new LM("/sys/update_server",this);var J=new eo("/sys/update_all",this);var D=new pN("/sys/users",this);u("/sys/users",D);var G=new Gd("/sys/users/createUser",this);u("/sys/users/createUser",G);D.iB("createUser",G);u("/sys/update_server",I);WS=new d("/sys/handledRequests",this);WS.L.addAll({r"$name":"HTTP Request Count",r"$type":"number"});u(WS.path,WS);u("/sys/update_all",J);var K=new Ho("/sys/config",this,un);u("/sys/config",K);}void MBB(String G){String A="/sys/links/${G}";d H=this.DB(A,false);if(H is jI){FB B=new FB(A);d C=DB(B.gB,false);C.R.remove(B.name);C.SB(B.name);}var I=g.keys.where((D)=>D==A||D.startsWith(A+"/")).toList();I.forEach(g.remove);}void mR(String A){FB B=new FB(A);d C=DB(B.gB,false);C.R.remove(B.name);C.SB(B.name);var G=g.keys.where((D)=>D==A||D.startsWith(A+"/")).toList();G.forEach(g.remove);}void u(String G,l B){l C=g[G];FB D=new FB(G);l A=g[D.gB];if(C!=null&&A!=null){if(C is ln){C.gw();}A.Za(D.name);}if(C!=null){B.ZC.addAll(C.ZC);B.nw(C.sF);}if(A==null){A=new d(D.gB,this);u(D.gB,A);}if(B is ln){B.Na();}g[G]=B;A.iB(D.name,B);A.sF.add(r"is");}Y aU(String A,String B){if(A is String&&A.length<43&&B!=""){if(B.length==18){return new tn(this,A);}else{return new kn(this,A);}}else{return new aS(this,A);}}KBB(List<m> G)async{{Map A={};File C=new File("usernodes.json");try {String D=await C.readAsString();A=PC.CF(D);}catch (H){}for(m B in G){if(B!=null&&A[B.username] is!Map){A[B.username]={r"$is":"broker/userRoot"};}}await C.writeAsString(PC.FH(A,pretty:true));}{File C=new File("tokens.json");Map A={};try {String D=await C.readAsString();A=PC.CF(D);}catch (H){}for(m B in G){if(B!=null&&A[B.username] is!Map){A[B.username]={r"$is":"broker/tokenGroup"};}}await C.writeAsString(PC.FH(A,pretty:true));}await Fj();await Ja();}Fj()async{File D=new File("usernodes.json");try {String G=await D.readAsString();Map A=PC.CF(G);A.forEach((String B,Map A){String H='/users/${B}';cS C=DB(H,false);C.tF([[B,'config'],['default','none']]);C.load(A);hV.R[B]=C;});hV.SB(r"$is");}catch (I){}}Ja()async{super.Ja();File G=new File("tokens.json");try {String H=await G.readAsString();Map A=PC.CF(H);A.forEach((String D,Map A){String B='/sys/tokens/${D}';uH C=new uH(B,this,D);C.load(A);});}catch (I){String B='/sys/tokens/root';uH C=new uH(B,this,'root');C.init();}}}class Eo extends d{Eo(String A,k B):super(A,B){L[r"$name"]="Clear Server Log";L[r"$invokable"]="write";L[r"$result"]="values";L[r"$columns"]=[{"name":"success","type":"bool"}];}V WB(Map C,Y D,V A,KB G,[int H=b.s]){new Future(()async{var B=new File("logs/dglux_server.log");if(!(await B.exists())){A.hB([{"success":false}]);A.close(new X("logNotFound",msg:"Log file not found.",path:path));return;}try {await B.writeAsBytes([] );}catch (I){}A.hB([{"success":true}]);A.close();});return A;}}class vc extends d{static Function Go;vc(String A,k B):super(A,B){L[r"$name"]="Restart Server";L[r"$invokable"]="write";}V WB(Map B,Y C,V A,KB D,[int G=b.s]){new Future(()async{await Go();});return A..close();}}class Ho extends d{Ho(String B,k A,SD C):super(B,A){new Future(()async{AD J;AD K;AD M;AD O;AD P;AD Q;AD S;AD Z;AD h;AD p;AD H;AD EB;d G;d I;{J=new AD("port","${B}/port",A,C.port);J..L[r"$name"]="Server Port"..L[r"$type"]="int";iB("port",J);}{p=new AD("quarantine","${B}/quarantine",A,C.OV);p..L[r"$name"]="Enable Quarantine"..L[r"$type"]="bool";iB("quarantine",p);}G=new d("${B}/advanced",A);I=new d("${B}/static",A);iB("advanced",G);iB("static",I);A.u(I.path,I);if(C.TK!=null){for(String PB in C.TK.keys){var UB=Uri.encodeComponent(PB);var D=new HQ("${B}/static/${UB}",A);I.iB(UB,D);D.L[r"$name"]=PB;D.L[r"$type"]="string";D.L[r"$writable"]="write";D.v(C.TK[PB]);A.u(D.path,D);A.u("${D.path}/remove",D.SI("remove"));}}var TB=new No("/sys/config/static/add",A);I.iB("add",TB);A.u(TB.path,TB);{P=new AD("observe","${B}/advanced/observe",A,C.Sj);P..L[r"$name"]="Observatory"..L[r"$type"]="dynamic";G.iB("observe",P);}{S=new AD("distributionUrl","${B}/advanced/distributionUrl",A,C.iZ);S..L[r"$name"]="Distribution Url"..L[r"$type"]="string";G.iB("distributionUrl",S);}{Z=new AD("linkRepositoryUrl","${B}/advanced/linkRepositoryUrl",A,C.Ia);Z..L[r"$name"]="Link Repository Url"..L[r"$type"]="string";G.iB("linkRepositoryUrl",Z);}{Q=new AD("debug","${B}/advanced/debug",A,C.WL);Q..L[r"$name"]="Debug"..L[r"$type"]="bool";G.iB("debug",Q);}{K=new AD("httpsPort","${B}/httpsPort",A,C.VI);K..L[r"$name"]="Secure Port"..L[r"$type"]="int";iB("httpsPort",K);}{M=new AD("workers","${B}/workers",A,C.UP);M..L[r"$name"]="Workers"..L[r"$type"]="int";iB("workers",M);}{O=new AD("broadcast","${B}/broadcast",A,C.XZ);O..L[r"$name"]="Broadcast"..L[r"$type"]="bool";iB("broadcast",O);}{h=new AD("downstreamName","${B}/downstream",A,C.downstreamName);h..L[r"$name"]="Downstream Name"..L[r"$type"]="string";iB("downstream",h);}{H=new AD("loginRedirectPath","${B}/loginRedirectPath",A,C.XI);H..L[r"$name"]="Login Redirect"..L[r"$type"]="string";iB("loginRedirectPath",H);}{EB=new AD("guestLoginRedirectPath","${B}/guestLoginRedirectPath",A,C.lU);EB..L[r"$name"]="Guest Login Redirect"..L[r"$type"]="string";iB("guestLoginRedirectPath",H);}A.u(J.path,J);A.u(K.path,K);A.u(M.path,M);A.u(O.path,O);A.u(h.path,h);A.u(G.path,G);A.u(P.path,P);A.u(Q.path,Q);A.u(S.path,S);A.u(Z.path,Z);A.u(p.path,p);A.u(H.path,H);A.u(EB.path,EB);});}}class AD extends d{static Function Jo;final String Gv;AD(this.Gv,String A,k B,dynamic C):super(A,B){v(C);L[r"$writable"]="write";}q zB(Object A,Y C,q B,[int D=b.s]){if((L[r"$type"]=="int"||L[r"$type"]=="number")&&A is String){try {A=num.parse(A);}catch (G){}}if(L[r"$type"]=="dynamic"&&(A=="true"||A=="false")){A=A=="true";}v(A);new Future(()async{await Jo(Gv,A);});B.close();return B;}}class No extends d{No(String A,k B):super(A,B){L[r"$invokable"]="write";L[r"$result"]="values";L[r"$name"]="Add Static Directory";L[r"$params"]=[{"name":"serve","type":"string","description":"Server Path","placeholder":"/my_dir"},{"name":"target","type":"string","description":"Folder Path","placeholder":"static_dir/"}];}V WB(Map G,Y I,V H,KB J,[int K=b.s]){new Future(()async{var B=G["serve"];var C=G["target"];if(B==null||C==null){return;}if(B is String&&!B.startsWith("/")){B="/${B}";}var D=Uri.encodeComponent(B);var A=new HQ("/sys/config/static/${D}",provider);provider.yB("/sys/config/static").iB(D,A);A.L[r"$name"]=B;A.L[r"$type"]="string";A.L[r"$writable"]="write";A.v(C);provider.u(A.path,A);provider.yB("/sys/config/static").sF.add(D);provider.u("${A.path}/remove",A.SI("remove"));await HQ.iW(B,C);H.close();});return H;}}class Po extends d{Po(String A,k B):super(A,B){L[r"$invokable"]="write";L[r"$result"]="values";L[r"$name"]="Remove";}V WB(Map J,Y K,V B,KB M,[int O=b.s]){new Future(()async{var A=new FB(path);var H=Uri.decodeComponent(A.parent.name);var C=A.gB;await HQ.iW(H,null);var I=provider.g.keys.where((D)=>D==C||D.startsWith(C+"/")).toList();var G=provider.yB("/sys/config/static");G.R.remove(A.parent.name);I.forEach(provider.g.remove);G.sF.add(r"$is");B.close();});return B;}}class pN extends d{pN(String A,k B):super(A,B);List<m> uE=[] ;void LI(m A){if(R.containsKey(A.username)){nG(A.username);}uE.add(A);qN B=new qN("/sys/users/${A.username}",provider);provider.u("/sys/users/${A.username}",B);var H=new AC("${B.path}/superuser");H.L.addAll({r"$type":"string",r"$name":"Superuser"});var C=new AC("${B.path}/rootUrl");C.L.addAll({r"$type":"string",r"$name":"Login Url"});var D=new AC("${B.path}/allowDesigner");D.L.addAll({r"$type":"bool",r"$name":"Allow Designer"});var G=new AC("${B.path}/groups");G.L.addAll({r"$type":"string",r"$name":"Groups"});if(A.IB!=null&&A.IB["rootUrl"] is String){C.v(A.IB["rootUrl"]);}else{C.v("/");}if(A.IB!=null&&A.IB["allowDesigner"] is bool){D.v(A.IB["allowDesigner"]);}else{D.v(true);}if(A.IB!=null&&A.IB["groups"]!=null){var I=A.IB["groups"];if(I is String){G.v(I);}else if(I is List){G.v(I.map((P)=>P.toString()).join(","));}}H.v(A.wC);B.Ib=A;var J=new Fd("${B.path}/remove",provider);var K=new Ed("${B.path}/rename",provider);var M=new hW("${B.path}/edit",provider);var O=new Dd("${B.path}/changePassword",provider);provider.u(M.path,M);provider.u(C.path,C);provider.u(D.path,D);provider.u(O.path,O);provider.u(J.path,J);provider.u(K.path,K);provider.u(H.path,H);provider.u(G.path,G);SB(A.username);}void Wu(m A){if(e$(A.username)){provider.yB("/sys/users/${A.username}/superuser").v(A.wC);AC B=provider.yB("/sys/users/${A.username}/groups");{var C=A.IB["groups"];if(C is String){B.v(C);}else if(C is List){B.v(C.map((J)=>J.toString()).join(","));}}AC G=provider.yB("/sys/users/${A.username}/rootUrl");AC D=provider.yB("/sys/users/${A.username}/allowDesigner");if(A.IB!=null&&A.IB["rootUrl"] is String){G.v(A.IB["rootUrl"]);}else{G.v("/");}if(A.IB!=null&&A.IB["allowDesigner"] is bool){D.v(A.IB["allowDesigner"]);}else{D.v(true);}qN K=R[A.username];K.Ib=A;}else{LI(A);}qN M=provider.yB("/sys/users/${A.username}");hW H=M.R["edit"];String I="/";if(A.IB!=null&&A.IB["rootUrl"] is String){I=A.IB["rootUrl"];}AC B=provider.yB("/sys/users/${A.username}/groups");AC D=provider.yB("/sys/users/${A.username}/allowDesigner");H.L[r"$params"]=[{"name":"superuser","type":"bool","default":A.wC},{"name":"rootUrl","type":"string","default":I},{"name":"allowDesigner","type":"bool","default":D.value==true},{"name":"groups","type":"string","default":B.value.toString()}];H.SB(r"$params");}bool e$(String A){return R.containsKey(A);}void nG(String A){sH B=provider;if(R.containsKey(A)){uE.removeWhere((C)=>C.username==A);B.mR("/sys/users/${A}");}}}class Dd extends d{static Function Wo;Dd(String A,k B):super(A,B){L[r"$invokable"]="write";L[r"$name"]="Change Password";L[r"$params"]=[{"name":"password","type":"string","editor":"password"}];}V WB(Map B,Y K,V A,KB M,[int O=b.s]){new Future(()async{try {FB C=new FB(path);String D=C.parent.name;qN G=provider.yB("/sys/users/${D}");String H=B["password"];var I=Wo(G.Ib.username,H);await I;}catch (J){A.close(new X("invokeError",msg:J));return;}A.close();});return A;}}class hW extends d{static Function Xo;hW(String A,k B):super(A,B){L[r"$invokable"]="write";L[r"$name"]="Edit User";}V WB(Map A,Y M,V C,KB O,[int P=b.s]){new Future(()async{try {FB D=new FB(path);String G=D.parent.name;qN H=provider.yB("/sys/users/${G}");var B=H.Ib.oO(superuser:A["superuser"]);if(B.IB==null){B.IB={};}if(A["rootUrl"] is String){B.IB["rootUrl"]=A["rootUrl"];}if(A["allowDesigner"] is bool){B.IB["allowDesigner"]=A["allowDesigner"];}if(A["groups"] is String){B.IB["groups"]=(A["groups"] as String).split(",").map((I){return I.trim();}).toList();}var J=Xo(B);await J;}catch (K){C.close(new X("invokeError",msg:K));return;}C.close();});return C;}}class Ed extends d{static Function Zo;Ed(String A,k B):super(A,B){L[r"$invokable"]="write";L[r"$name"]="Rename User";L[r"$params"]=[{"name":"username","type":"string"}];}V WB(Map C,Y J,V A,KB K,[int M=b.s]){var B=C["username"];new Future(()async{try {if(B==null||B is!String){throw new Exception("Username not specified.");}FB D=new FB(path);String G=D.parent.name;var H=Zo(G,B);await H;}catch (I){A.close(new X("invokeError",msg:I));return;}A.close();});return A;}}class Fd extends d{static Function bo;Fd(String A,k B):super(A,B){L[r"$invokable"]="write";L[r"$name"]="Remove User";}V WB(Map H,Y I,V A,KB J,[int K=b.s]){new Future(()async{try {FB B=new FB(path);String C=B.parent.name;var D=bo(C);await D;}catch (G){A.close(new X("invokeError",msg:G));return;}A.close();});return A;}}class qN extends d{m Ib;qN(String A,k B):super(A,B);}class Gd extends d{static Function Hd;Gd(String A,k B):super(A,B){L[r"$invokable"]="write";L[r"$result"]="values";L[r"$name"]="Create User";L[r"$params"]=[{"name":"username","type":"string","placeholder":"jdoe"},{"name":"superuser","type":"bool","default":false},{"name":"password","type":"string","placeholder":"MyPassword","editor":"password"}];}V WB(Map D,Y M,V A,KB O,[int P=b.s]){new Future(()async{G(String I){A.close(new X("invokeError",msg:I));}var B=D["username"];var H=D["superuser"];var C=D["password"];if(B==null||B is!String||B.isEmpty){G("Username not provided.");return;}if(H is!bool){H=false;}if(C==null||C is!String||C.isEmpty){G("Password not provided.");return;}if(Hd==null){G("Creating Users isn't allowed right now.");return;}try {var J=Hd(B,H,C);await J;}catch (K){A.close(new X("invokeError",msg:K));return;}A.close();});return A;}}class HQ extends d{static Function iW;HQ(String A,k B):super(A,B){var C=new Po("${A}/remove",B);iB("remove",C);}q zB(Object A,Y C,q B,[int D=b.s]){v(A);new Future(()async{await iW(L[r"$name"],A);});B.close();return B;}}class kn extends aS{kn(BF A,String B):super(A,B);void wF(Map A){if(A["paths"] is List){for(Object B in A["paths"]){if(B is Map){if(B["path"] is String){CG.VS.addSubscription(B["path"].hashCode);}}}}super.wF(A);}void WB(Map A){Object B=A["path"];Object C=A["params"];if(B is String){if(C is Map){CG.VS.MZ(B,C);}else{CG.VS.MZ(B,null);}}super.WB(A);}}class tn extends aS{tn(BF A,String B):super(A,B);void wF(Map A){if(CG.oN.enabled){if(A["paths"] is List){for(Object B in A["paths"]){if(B is Map){if(B["path"] is String){CG.oN.addSubscription(B["path"].hashCode);}}}}}super.wF(A);}void WB(Map A){if(CG.oN.enabled){Object B=A["path"];Object C=A["params"];if(B is String){if(C is Map){CG.oN.MZ(B,C);}else{CG.oN.MZ(B,null);}}}super.WB(A);}}class mc{static const int nn=61;static const int d2=13;static const int qn=10;static const String e2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijk1mnopqrstuvwxyz0l23456789+/";static final List<int> pc=((){List<int> A=new List<int>(256);A.fillRange(0,256,-2);List<int> C=e2.codeUnits;int D=C.length;for(int B=0;B<D; ++B){A[C[B]]=B;}A[d2]=-1;A[qn]=-1;A[32]=-1;A[qn]=-1;A[nn]=0;return A;})();static List<int> h2(String B){int D=B.length;if(D==0){return new List<int>(0);}int K=0;for(int A=0;A<D;A++ ){int G=pc[B.codeUnitAt(A)];if(G<0){K++ ;if(G==-2){throw new FormatException('Invalid character: ${B[A]}');}}}if((D-K)%4!=0){throw new FormatException('''Size of Base 64 characters in Input
         must be a multiple of 4. Input: ${B}''');}int M=0;for(int A=D-1;A>=0;A-- ){int O=B.codeUnitAt(A);if(pc[O]>0)break;if(O==nn)M++ ;}int I=(((D-K)*6)>>3)-M;List<int> J=new List<int>(I);for(int A=0,C=0;C<I;){int H=0;for(int P=4;P>0;){int G=pc[B.codeUnitAt(A++ )];if(G>=0){H=((H<<6)&0xFFFFFF)|G;P-- ;}}J[C++ ]=H>>16;if(C<I){J[C++ ]=(H>>8)&0xFF;if(C<I)J[C++ ]=H&0xFF;}}return J;}static e xn(String A){return new e.jCB(1,h2(A));}static String i2(String I){List<int> C=LS.convert(I);int H=C.length;int B=H;for(int D=0;D<H; ++D){int A=C[D];if(A<192){if(A>63){if(A&63!=63){int G=((A&63)+B)%63+1;B=(G*5)&63;C[D]=(A&192)|(B-1);}}else if(A>32){int G=((A&31)-1+B)%31+1;B=(G*3)&31;C[D]=B+32;}}}return eK.convert(C);}}class tc{static e j2=new e((1<<16)+1);static e k2=new e('FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',16);static e l2=mc.xn('AI/2nWN7fk9EyejllOJjcLQrMOrPprnbzkOe9afgVWtHluOmlEoTCnivtr3CgLttI2aa5KEGtWWelzYVGhyUwLyvRab+pZfeflNFMGT/2asIizfbTWTwyU4kFuyZVaCdhZuQRa2sMl8XQaOyXuymQqony+MrGskc5simXwb4anR7');static e Co;static String m2;static List<String> n2;static List<String> o2;static List<String> p2;static Map Do;static String q2;static String r2(Map A,String B){if(A==null){return 'invalidLicense';}String C=dK.convert(A);List<int> D=tc.s2('DG'+C);e G=new e.jCB(1,D);Co=mc.xn(B);e H=Co.modPow(j2,l2);if(H.kO(tc.k2)==G){if(A['features'] is Map){Do=A['features'];}else{Do=null;}return null;}else{return 'invalidLicense';}}static List<int> s2(String B){aK A=new ES();A.add(LS.convert(B));return A.close();}static String t2(Map B){if(B==null||B['sig'] is!String||B['dglux'] is!Map){return 'invalidLicense';}Map A=B['dglux'];if(A['productId'] is!String){return '${'invalidLicense'} . ${'productId'} : ${A['productId']}';}m2=A['productId'];if(A['hosts'] is!List&&A['paths'] is!List&&A['projs'] is!List){return 'invalidLicense';}n2=A['hosts'];o2=A['paths'];p2=A['projs'];q2=A['hash'];String C=A['expire'];if(C!=null){DateTime D=DateTime.parse(C);if(D.millisecondsSinceEpoch<new DateTime.now().millisecondsSinceEpoch){return 'invalidLicenseExpired'+C;}}return r2(A,B['sig']);}}class CG extends VD{static const String pn='dglux-dsa-';static CG nc;static XS VS;static XS oN;static d aW;static d bW;static d cW;static String oc;static File g2=new File("www/dglicense.json");Timer IBB;CG(String B,k A):super(B,A){nc=this;VS=new XS('/sys/dglux/topicsActual',A)..L[r"$name"]="Topic Actual";oN=new XS('/sys/dglux/topicsPreview',A)..L[r"$name"]="Topic Preview";new yn('/sys/dglux/topicsPreview/reset',A)..L[r"$name"]="Reset";aW=new VD('/sys/dglux/topicsLicensed',A)..L[r'$type']='string'..L[r"$name"]="Topics Licensed";cW=new VD('/sys/dglux/expirationDate',A)..L[r'$type']='string'..L[r"$name"]="Expiration Date";bW=new VD('/sys/dglux/licenseStatus',A)..L[r'$type']='string'..L[r"$name"]="License Status";new VD('/sys/dglux/productId',A)..L[r'$type']='string'..L[r"$name"]="Product ID"..v('${pn}${oc}');new Bo('/sys/dglux/uploadLicense',A);IBB=new Timer.periodic(const Duration(minutes:10),T_);Mw(null);}int Fw=1;void T_(Timer B){int A=(new DateTime.now()).day;if(A==1&&Fw>1){VS.reset();}Fw=A;}num ua=0;bool Mw(String B){try {String C;if(B!=null){C=B;}else{C=g2.readAsStringSync();}Map D=PC.CF(C);Map A=D['dglux'];if(A['productId']!='${pn}${oc}'){throw 'invalid productId';}String G=tc.t2(D);if(G!=null){bW.v('invalid');}else{bW.v('valid');}if(A['topics'] is num){ua=A['topics'];aW.v(ua.toString());}else{ua=double.INFINITY;aW.v('unlimited');}if(A['expire'] is String){cW.v(A['expire']);}else{cW.v('none');}return G==null;}catch (H){if(B==null){ua=0;aW.v('0');bW.v('invalid');cW.v('');}return false;}}String xBB(String A){return null;}}class XS extends VD{bool enabled=true;XS(String A,k B):super(A,B){L[r'$type']='int';v(0);}HashSet<int> DC=new HashSet<int>();HashSet<int> zZ=new HashSet<int>();Timer FHB;void addSubscription(int A){if(!DC.contains(A)){DC.add(A);if(FHB==null){FHB=new Timer(const Duration(seconds:2),GHB);}}}void MZ(String G,Map B){lc C=new lc(G);if(B!=null){B.forEach((String H,Object A){if(A is String&&A.length>16){C.g$(H,A);}});}int D=C.U$();if(!zZ.contains(D)){zZ.add(D);if(FHB==null){FHB=new Timer(const Duration(seconds:2),GHB);}}}void GHB(){FHB=null;v(DC.length+zZ.length);}void reset(){DC.clear();zZ.clear();v(0);}}class yn extends VD{yn(String A,k B):super(A,B){L[r'$invokable']='config';}V WB(Map B,Y C,V A,KB D,[int G=b.s]){CG.oN.reset();return A..close();}}class Bo extends VD{Bo(String A,k B):super(A,B){L[r"$name"]="Update License";L[r'$invokable']='config';L[r'$params']=[{'name':'data','type':'string','editor':'textarea'}];}V WB(Map A,Y C,V B,KB D,[int G=b.s]){CG.nc.xBB(A["data"]);return B..close();}}class KM extends d{static KM EQ;static String ZW(String A){return A.replaceAll(" ","_");}KM(String I,k A):super(I,A){EQ=this;var B=new To("/sys/links/start_all",A);var C=new qc("/sys/links/rescan",A);var D=new sc("/sys/links/git_install",A);var G=new uc("/sys/links/zip_install",A);var H=new dW("/sys/links/install",A);iB("git_install",D);iB("zip_install",G);iB("install",H);iB("rescan",C);iB("start_all",B);new Future((){A.u("/sys/links/rescan",C);A.u("/sys/links/git_install",D);A.u("/sys/links/zip_install",G);A.u("/sys/links/install",H);A.u("/sys/links/start_all",B);});}void KU(String C,String D,String G,String H,Map I,bool J){var A=ZW(C);var B=new jI(C,D,G,"/sys/links/${A}",H,I,J,provider);B.L[r"$name"]=A;iB(A,B);provider.u(B.path,B);SB(A);}void yBB(String C,Map D){jI A=SI(ZW(C));if(A!=null){D.forEach((G,H){var B=A.ZU.SI(G);if(B!=null){B.v(H);}});}}void mG(String A){var B=ZW(A);(provider as sH).MBB(B);}void sD(String B,String C){jI A=SI(ZW(B));if(A!=null){A.sD(C);}}}class qc extends d{static Function vn;qc(String A,k B):super(A,B){L[r"$name"]="Rescan";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}V WB(Map B,Y C,V A,KB D,[int G=b.s]){new Future(()async{await vn();A.close();});return A;}}class LM extends d{static Function rc;static bool FQ=false;LM(String A,k B):super(A,B){L.addAll({r"$name":"Update Server",r"$invokable":"write",r"$params":[] ,r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values"});}V WB(Map D,Y G,V A,KB H,[int I=b.s]){if(FQ==true){A.hB([[false,"Server Update already in progress."]]);return A..close();}new Future(()async{try {var B=await rc();A.hB([B]);}catch (C){A.hB([[false,C.toString()]]);}FQ=false;A.close();});return A;}}class sc extends d{static Function wn;sc(String A,k B):super(A,B){L.addAll({r"$name":"Install Link from Git",r"$invokable":"write",r"$params":[{"name":"name","type":"string"},{"name":"url","type":"string"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values"});}V WB(Map B,Y D,V A,KB G,[int H=b.s]){if(B["name"]==null){A.hB([[false,"parameter 'name' is required"]]);return A..close();}if(B["url"]==null){A.hB([[false,"parameter 'url' is required"]]);return A..close();}new Future(()async{var C=await wn(B["url"],B["name"]);A.hB([[C[0],C[1]]]);A.close();});return A;}}class dW extends d{static Function zn;static Function Ao;Timer Wk;dW(String A,k B):super(A,B){L.addAll({r"$name":"Install Link",r"$invokable":"write",r"$params":[{"name":"name","type":"string"},{"name":"link","type":"enum[]"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values"});Wk=new Timer.periodic(const Duration(hours:3),(C)async{await hk();});new Future.delayed(const Duration(seconds:1),()async{await hk();});}bool xi=false;hk()async{if(xi){return;}xi=true;String A;try {A=await Ao();}catch (B){}Ha=A;(L[r"$params"] as List<Map<String,dynamic>>)[1]["type"]=A;SB(r"$params");Hw=new DateTime.now();xi=false;}void gR(){super.gR();if((Ha==null||Ha=="enum[]"||Ha.isEmpty)||Hw.difference(new DateTime.now()).abs().inMinutes>=1){hk();}}DateTime Hw=new DateTime.fromMillisecondsSinceEpoch(0);String Ha;V WB(Map B,Y D,V A,KB G,[int H=b.s]){if(B["name"]==null){A.hB([[false,"parameter 'name' is required"]]);return A..close();}if(B["link"]==null){A.hB([[false,"parameter 'link' is required"]]);return A..close();}new Future(()async{var C=await zn(B["name"],B["link"]);A.hB([[C[0],C[1]]]);A.close();});return A;}}class uc extends d{static Function Fo;uc(String A,k B):super(A,B){L.addAll({r"$name":"Install Link from Zip",r"$invokable":"write",r"$params":[{"name":"name","type":"string"},{"name":"url","type":"string"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values"});}V WB(Map B,Y D,V A,KB G,[int H=b.s]){if(B["name"]==null){A.hB([[false,"parameter 'name' is required"]]);return A..close();}if(B["url"]==null){A.hB([[false,"parameter 'url' is required"]]);return A..close();}new Future(()async{var C=await Fo(B["url"],B["name"]);A.hB([[C[0],C[1]]]);A.close();});return A;}}class eW extends d{static Function Io;final String OB;eW(this.OB,String A,k B):super(A,B){L.addAll({r"$name":"Update from Zip",r"$invokable":"write",r"$params":[{"name":"url","type":"string"}],r"$columns":[{"name":"message","type":"string"}],r"$result":"values"});}V WB(Map B,Y D,V A,KB G,[int H=b.s]){if(B["url"]==null){A.hB([[false,"parameter 'url' is required"]]);return A..close();}new Future(()async{var C=await Io(OB,B["url"]);A.hB([[!C.toString().contains("Error"),C.toString()]]);A.close();});return A;}}class jI extends d{final String OB;d ZU;jI(this.OB,String KC,String TC,String B,String Q,Map H,bool xC,k A):super(B,A){var Z=new fW(OB,"${B}/start",A);var h=new Ad(OB,"${B}/stop",A);var p=new Bd(OB,"${B}/restart",A);var EB=new Cd(OB,"${B}/state",A);var I=new d("${B}/description",A);var J=new d("${B}/version",A);var K=new YS(OB,"${B}/enabled",A);var PB=new zc(OB,"${B}/uninstall",A);var TB=new ao(OB,"${B}/get_log",A);var UB=new co(OB,"${B}/clear_log",A);var dB=new Uo(OB,H,"${B}/configs/get_nodes",A);var sB=new Vo(OB,H,"${B}/configs/set_nodes",A);I.L[r"$type"]="string";K.L[r"$type"]="bool";J.L[r"$type"]="string";I.v(KC);J.v(TC);K.v(xC);gW M;GQ O;eW P;if(Q=="git"){M=new gW(OB,"${B}/update_git",A);}if(Q=="repository"){O=new GQ(OB,"${B}/update_repo",A);}if(Q!="git"){P=new eW(OB,"${B}/update_zip",A);}ZU=new d("${B}/configs",A);var tB=<String,d>{};for(var C in H.keys){if(C=="get_nodes"||C=="set_nodes")continue;var S=H[C];var D=new xc(OB,"${B}/configs/${C}",A);var G=S["type"];if(C=="log"&&G=="enum"){G="enum[off,error,info,debug]";}if(G=="url")G="string";D.L[r"$type"]=G;ZU.iB(C,D);tB[D.path]=D;if(S["default"]!=null){D.v(S["default"]);}}new Future((){A.u(Z.path,Z);A.u(h.path,h);A.u(p.path,p);A.u(I.path,I);A.u(J.path,J);A.u(EB.path,EB);A.u(PB.path,PB);A.u(TB.path,TB);A.u(UB.path,UB);A.u(K.path,K);A.u(ZU.path,ZU);A.u(dB.path,dB);A.u(sB.path,sB);if(M!=null){A.u(M.path,M);}if(O!=null){A.u(O.path,O);}if(P!=null){A.u(P.path,P);}tB.forEach(A.u);});}void sD(String B){Cd D=SI("state");if(D!=null){D.v(B);if(B=="connected"){zE G=provider.ZH.dV[OB];if(G!=null){String C;for(var A in provider.sC.values){if(A is kI&&A.token!=null){var H=A.token.substring(0,16);if(H==G.id){C=A.path;break;}}}if(C!=null){qL=new d("${path}/path",provider);qL.L[r"$type"]="string";iB("path",qL);provider.u(qL.path,qL);sF.add("path");qL.v(C);}}}else if(qL!=null){R.remove("path");provider.g.remove(qL.path);sF.add("path");qL=null;}}HHB=B;}d qL;String HHB="unknown";}class fW extends d{static Function wc;final String OB;fW(this.OB,String A,k B):super(A,B){L[r"$name"]="Start Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}V WB(Map B,Y C,V A,KB D,[int G=b.s]){new Future(()async{await wc(OB);A.close();});return A;}}class xc extends d{static Function Ko;final String OB;xc(this.OB,String A,k B):super(A,B){L[r"$writable"]="write";}q zB(Object A,Y C,q B,[int D=b.s]){Ko(OB,new FB(path).name,A);v(A);B.close();return B;}}class YS extends d{final String OB;static Function Lo;static Function Mo;YS(this.OB,String A,k B):super(A,B){L[r"$writable"]="write";}q zB(Object A,Y D,q C,[int G=b.s]){if(A is bool){Future B;if(A){B=Lo(OB);}else{B=Mo(OB);}B.then((H){v(A);}).catchError((I){});}return C..close();}}class GQ extends d{static Function yc;final String OB;bool EN=false;GQ(this.OB,String A,k B):super(A,B){L[r"$name"]="Update from Repository";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[{"name":"message","type":"string"}];}V WB(Map C,Y D,V A,KB G,[int H=b.s]){new Future(()async{if(EN){A.hB([["Link Update is already in progress."]]);}else{try {EN=true;var B=await yc(OB);A.hB([[B]]);}finally {EN=false;}EN=false;}A.close();});return A;}}class gW extends d{static Function Oo;final String OB;gW(this.OB,String A,k B):super(A,B){L[r"$name"]="Update from Git";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[{"name":"message","type":"string"}];}V WB(Map C,Y D,V A,KB G,[int H=b.s]){new Future(()async{var B=await Oo(OB);A.hB([[B]]);A.close();});return A;}}class zc extends d{static Function Qo;final String OB;zc(this.OB,String A,k B):super(A,B){L[r"$name"]="Uninstall Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}V WB(Map B,Y C,V A,KB D,[int G=b.s]){new Future(()async{await Qo(OB);A.close();});return A;}}class Ad extends d{static Function Ro;final String OB;Ad(this.OB,String A,k B):super(A,B){L[r"$name"]="Stop Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}V WB(Map B,Y C,V A,KB D,[int G=b.s]){new Future(()async{await Ro(OB);A.close();});return A;}}class Bd extends d{static Function So;final String OB;Bd(this.OB,String A,k B):super(A,B){L[r"$name"]="Restart Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}V WB(Map B,Y C,V A,KB D,[int G=b.s]){new Future(()async{await So(OB);A.close();});return A;}}class Cd extends d{final String OB;Cd(this.OB,String A,k B):super(A,B){L[r"$type"]="string";new Future((){jI C=B.yB(new FB(A).gB);if(C!=null){try {v(C.HHB);}catch (D){v("unknown");}}else{v("unknown");}});}}class To extends d{To(String A,k B):super(A,B){L[r"$name"]="Start All Links";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}V WB(Map G,Y H,V B,KB I,[int J=b.s]){new Future(()async{List<jI> D=provider.g.values.where((A)=>A is jI).toList();for(var A in D){YS C=A.get("enabled");if(C.gL!=null&&C.gL.value==true){await fW.wc(A.OB);}}B.close();});return B;}}class Uo extends d{final String OB;final Map PH;File file;Uo(this.OB,this.PH,String A,k C):super(A,C){String A="nodes.json";if(PH.containsKey("nodes")){Map B=PH["nodes"];if(B.containsKey("default")){A=B["default"];}if(B.containsKey("value")){A=B["value"];}}file=new File("dslinks/${OB}/${A}");L[r"$name"]="Get Nodes JSON";L[r"$invokable"]="write";L[r"$columns"]=[{"name":"nodes","type":"string","editor":"textarea"},{"name":"success","type":"bool"}];}V WB(Map B,Y C,V A,KB D,[int G=b.s]){new Future(()async{if(!(await file.exists())){A.hB([["{}",false]]);A.close(new X("fileNotFound",msg:"Nodes file not found.",path:"/sys/links/${OB}/configs/get_nodes"));return;}A.hB([[await file.readAsString(),true]]);A.close();});return A;}}class Vo extends d{final String OB;final Map PH;File file;Vo(this.OB,this.PH,String A,k C):super(A,C){String A="nodes.json";if(PH.containsKey("nodes")){Map B=PH["nodes"];if(B.containsKey("default")){A=B["default"];}if(B.containsKey("value")){A=B["value"];}}file=new File("dslinks/${OB}/${A}");L[r"$name"]="Set Nodes JSON";L[r"$invokable"]="write";L[r"$params"]=[{"name":"nodes","description":"Proceed with caution, this advanced feature could result in data loss.","type":"string","editor":"textarea"}];L[r"$columns"]=[{"name":"success","type":"bool"}];}V WB(Map D,Y I,V A,KB C,[int J=b.s]){if(C!=null){jI G=provider.DB(new FB((C as d).path).gB);if(G.HHB!="stopped"){A.hB([[false]]);var H=new X("linkNotStopped",msg:"Link must be stopped.",path:path);A.close(H);return A;}}var B=D["nodes"];try {if(B is Map){B=dK.convert(B);}yE.convert(B);new Future(()async{if(!(await file.exists())){await file.create();}await file.writeAsString(B);});A.hB([[true]]);A.close();}catch (K){A.hB([[false]]);A.close(X.iD);}return A;}}class Yo extends d{Yo(String A,k B):super(A,B){L[r"$name"]="Get Server Log";L[r"$invokable"]="write";L[r"$params"]=[{"name":"lines","type":"number","default":100}];L[r"$result"]="values";L[r"$columns"]=[{"name":"log","type":"string","editor":"textarea"}];}V WB(Map H,Y K,V B,KB M,[int O=b.s]){new Future(()async{var A=H["lines"];try {if(A is String){A=num.parse(A);}}catch (P){A=50;}var I="logs/dglux_server.log";var D=new File(I);if(!(await D.exists())){B.hB([["Log File not Found"]]);B.close();return;}Iterable<String> C=await D.readAsLines();if(A!=null&&A>0){var J=C.length;var G=J-A;C=C.skip(G<0?0:G).take(A);}B.hB([[C.join("\n")]]);B.close();});return B;}}class ao extends d{final String OB;ao(this.OB,String A,k B):super(A,B){L[r"$name"]="Get Log";L[r"$invokable"]="write";L[r"$params"]=[{"name":"lines","type":"number","default":100}];L[r"$result"]="values";L[r"$columns"]=[{"name":"log","type":"string","editor":"textarea"}];}V WB(Map H,Y J,V B,KB K,[int M=b.s]){new Future(()async{var A=H["lines"];try {if(A is String){A=num.parse(A);}}catch (O){A=50;}var D=new File("logs/${OB}.log");if(!(await D.exists())){B.hB([["Log File not Found"]]);B.close();return;}Iterable<String> C=await D.readAsLines();if(A!=null&&A>0){var I=C.length;var G=I-A;C=C.skip(G<0?0:G).take(A);}B.hB([[C.join("\n")]]);B.close();});return B;}}class co extends d{final String OB;co(this.OB,String A,k B):super(A,B){L[r"$name"]="Clear Log";L[r"$invokable"]="write";L[r"$result"]="values";L[r"$columns"]=[{"name":"success","type":"bool"}];}V WB(Map C,Y D,V A,KB G,[int H=b.s]){new Future(()async{var B=new File("logs/${OB}.log");if(!(await B.exists())){A.hB([{"success":false}]);A.close(new X("logNotFound",msg:"Log file not found.",path:"/sys/links/${OB}/clear_log"));return;}try {await B.writeAsBytes([] );}catch (I){}A.hB([{"success":true}]);A.close();});return A;}}class eo extends d{eo(String A,k B):super(A,B){L.addAll({r"$name":"Update All Components",r"$invokable":"write",r"$params":[] ,r"$columns":[{"name":"component","type":"string"},{"name":"status","type":"string"},{"name":"message","type":"string"}],r"$result":"stream"});}V WB(Map P,Y Q,V D,KB S,[int Z=b.s]){new Future(()async{var H=<Id>[] ;var O=0;if(provider.g.containsKey("/sys/update_server")){var A=new Id();A.name="dglux-server";A.index=O++ ;A.update=()async{try {if(LM.FQ){return [false,"Server Update is already in progress."];}else{LM.FQ=true;var B=await LM.rc();LM.FQ=false;return [B[0],B[1]];}}catch (I){LM.FQ=false;return [false,"Error: ${I.toString()}"];}};H.add(A);}List<jI> K;try {K=provider.g.values.where((C)=>C is jI).toList();}catch (I){K=[] ;}for(var C in K){if(C.R.containsKey("update_repo")){GQ J=C.R["update_repo"];var A=new Id();A.name=C.OB;A.index=O++ ;A.update=()async{try {if(J.EN){return [false,"Link Update is already in progress."];}J.EN=true;String B=await GQ.yc(C.OB);J.EN=false;return [!B.startsWith("Error: "),B];}catch (I){J.EN=false;return [false,"Error: ${I.toString()}"];}};H.add(A);}}var M=<List<String>>[] ;for(var A in H){M.add(<String>[A.name,"Waiting...","N/A"]);}D.hB(M,meta:{"mode":"append"});for(var A in H){List<String> G=M[A.index];G[1]="Updating...";D.hB([G],meta:{"modify":"replace ${A.index}-${A.index}"});var B=await A.update();G[1]=B[0]==true?"Success.":"Failure.";G[2]=B[1];D.hB([G],meta:{"modify":"replace ${A.index}-${A.index}"});}D.close();});return D;}}class Id{int index;String name;Function update;}class lc{static const List<int> mn=const<int>[1031,4943,4337,3761,3209,2659,2089,1567,1061,4973,4373,3797,3253,2687,2131,1601,1093,5009,4423,3847,3301,2711,2161,1621,1123,5051,4463,3881,3329,2741,2221,1667,1171,5099,4513,3919,3361,2789,2267,1709,1213,5147,4549,3947,3407,2819,2293,1747,1237,5189,4597,4007,3461,2857,2339,1787,1283,5233,4643,4049,3499,2903,2371,1831,1303,5281,4673,4091,3533,2953,2393,1873,1361,5333,4723,4129,3559,2999,2437,1907,1409,5393,4783,4159,3607,3037,2473,1951,1439,5419,4801,4219,3637,3079,2539,1997,1471,5449,4871,4253,3677,3121,2579,2027,1493,5501,4919,4283,3719,3181,2621,2069,1543,1033,4951,4339,3767,3217,2663,2099,1571,1063,4987,4391,3803,3257,2689,2137,1607,1097,5011,4441,3851,3307,2713,2179,1627,1129,5059,4481,3889,3331,2749,2237,1669,1181,5101,4517,3923,3371,2791,2269,1721,1217,5153,4561,3967,3413,2833,2297,1753,1249,5197,4603,4013,3463,2861,2341,1789,1289,5237,4649,4051,3511,2909,2377,1847,1307,5297,4679,4093,3539,2957,2399,1877,1367,5347,4729,4133,3571,3001,2441,1913,1423,5399,4787,4177,3613,3041,2477,1973,1447,5431,4813,4229,3643,3083,2543,1999,1481,5471,4877,4259,3691,3137,2591,2029,1499,5503,4931,4289,3727,3187,2633,2081,1549,1039,4957,4349,3769,3221,2671,2111,1579,1069,4993,4397,3821,3259,2693,2141,1609,1103,5021,4447,3853,3313,2719,2203,1637,1151,5077,4483,3907,3343,2753,2239,1693,1187,5107,4519,3929,3373,2797,2273,1723,1223,5167,4567,3989,3433,2837,2309,1759,1259,5209,4621,4019,3467,2879,2347,1801,1291,5261,4651,4057,3517,2917,2381,1861,1319,5303,4691,4099,3541,2963,2411,1879,1373,5351,4733,4139,3581,3011,2447,1931,1427,5407,4789,4201,3617,3049,2503,1979,1451,5437,4817,4231,3659,3089,2549,2003,1483,5477,4889,4261,3697,3163,2593,2039,1511,5507,4933,4297,3733,3191,2647,2083,1553,1049,4967,4357,3779,3229,2677,2113,1583,1087,4999,4409,3823,3271,2699,2143,1613,1109,5023,4451,3863,3319,2729,2207,1657,1153,5081,4493,3911,3347,2767,2243,1697,1193,5113,4523,3931,3389,2801,2281,1733,1229,5171,4583,4001,3449,2843,2311,1777,1277,5227,4637,4021,3469,2887,2351,1811,1297,5273,4657,4073,3527,2927,2383,1867,1321,5309,4703,4111,3547,2969,2417,1889,1381,5381,4751,4153,3583,3019,2459,1933,1429,5413,4793,4211,3623,3061,2521,1987,1453,5441,4831,4241,3671,3109,2551,2011,1487,5479,4903,4271,3701,3167,2609,2053,1523,5519,4937,4327,3739,3203,2657,2087,1559,1051,4969,4363,3793,3251,2683,2129,1597,1091,5003,4421,3833,3299,2707,2153,1619,1117,5039,4457,3877,3323,2731,2213,1663,1163,5087,4507,3917,3359,2777,2251,1699,1201,5119,4547,3943,3391,2803,2287,1741,1231,5179,4591,4003,3457,2851,2333,1783,1279,5231,4639,4027,3491,2897,2357,1823,1301,5279,4663,4079,3529,2939,2389,1871,1327,5323,4721,4127,3557,2971,2423,1901,1399,5387,4759,4157,3593,3023,2467,1949,1433,5417,4799,4217,3631,3067,2531,1993,1459,5443,4861,4243,3673,3119,2557,2017,1489,5483,4909,4273,3709,3169,2617,2063,1531];int jj=0;int hash;lc(String A){hash=A.hashCode&0x1fffffff;}void g$(String I,String J){int C=I.hashCode&0x1fffffff;List<int> H=J.codeUnits;int K=H.length;int B=0;bool D=false;for(int G=0;G<K; ++G){int A=H[G];if(A==32||A==44||A==34||A==59||(A>=48&&A<=57)){if(D)continue;D=true;A=48;}else{D=false;}C=((C*mn[B])^A)&0x1fffffff;B++ ;if(B>=mn.length){B=0;}}jj=(jj+C)&0x1fffffff;}int U$(){return jj^hash;}}eI tm(String A){eI B;if(A=="file"||A=="json"){B=new pm();}else if(A=="ldap"){B=new rm();}else if(A=="external"){B=new i0();}else if(A=="open"){B=new h0();}else if(A.startsWith("composite[")&&A.endsWith("]")){String C=A.substring(9,A.length-1);List<String> D=C.split(",").map((G)=>G.trim()).toList();return new nm(D.map(tm).toList());}else{f.gC("Invalid Authentication Method: ${A}");}return B;}JW l0(String A){if(A=="none"){return null;}else if(A=="duo"){return new qm();}f.gC("Invalid Two-Factor Authentication Method: ${A}");return null;}abstract class JW{bool get Bk;List<String> get Nv;Future init(SD A);Future<dynamic> Lv(String A,Map B,HttpRequest C);Future<bool> Jx(Map A,HttpRequest B);}abstract class eI{Future init(SD A);Future LI(m A,String B);Future nG(String A);Future<m> UI(String A);Future<List<m>> WI();Future<bool> authenticate(String A,String B);}abstract class xE{}abstract class Hc{}abstract class sm{}abstract class k0{}abstract class cK{}class fI{final String message;fI(this.message);String toString()=>message;}class m{final String username;final bool wC;final Map IB;m(this.username,this.wC,[Map A]):IB=A is!Map?{}:A;static m um(Map A){var B=new m(A["username"],A["superuser"] is bool?A["superuser"]:false,A["metadata"]);for(String C in A.keys.where((D)=>!(const["username","superuser","metadata"]).contains(D))){B.tO[C]=A[C];}return B;}Map fx([List<String> B]){var C={"username":username,"superuser":wC,"metadata":IB};if(B!=null){for(String A in B){if(tO.containsKey(A)){C[A]=tO[A];}}}return C;}m xM(){return new m(username,wC,new Map.from(IB));}m oO({String username,bool superuser,Map meta}){if(username==null){username=this.username;}if(superuser==null){superuser=this.wC;}if(meta==null){meta=IB;}return new m(username,superuser,meta);}Map<String,dynamic> tO={};}class nm extends eI implements xE{final List<eI> iL;nm(this.iL);Future LI(m A,String B)async{for(var C in iL){try {await C.LI(A,B);break;}catch (D){}}}Future<bool> authenticate(String C,String D)async{var A;for(var G in iL){try {var B=await G.authenticate(C,D);if(B){return B;}}catch (H){A=H;}}if(A!=null){throw A;}return false;}Future<m> UI(String C)async{var A;for(var D in iL){try {var B=await D.UI(C);if(B!=null){return B;}}catch (G){A=G;}}if(A!=null){throw A;}return null;}Future init(SD A)async{for(var B in iL){await B.init(A);}}Future<List<m>> WI()async{var A;List<m> B=[] ;for(var C in iL){try {var D=await C.WI();B.addAll(D);}catch (G){A=G;}}if(A!=null){throw A;}return B;}Future nG(String A)async{for(var B in iL){try {await B.nG(A);}catch (C){}}}Future KR(String B,String C)async{for(var A in iL){if(A is xE){await (A as xE).KR(B,C);}}}Future PR(m B)async{for(var A in iL){if(A is xE){await (A as xE).PR(B);}}}}final File om=new File(CB("www","duo.html"));class qm extends JW{final bool Bk=true;final List<String> Nv=["sig_response"];String host;String si;String Ok;String uh;qm();Future init(SD B)async{var A=B.get("duo");C(String D){f.oC(D);exit(1);}if(A==null||!A.containsKey("ikey")||!A.containsKey("skey")||!A.containsKey("akey")||!A.containsKey("host")){C("Duo two-factor authentication is not properly configured.");}host=A["host"];si=A["ikey"];Ok=A["skey"];uh=A["akey"];}Future<String> Lv(String C,Map B,HttpRequest G)async{String D=a4(si,Ok,uh,C);if(!(await om.exists())){throw new StateError("duo.html does not exist, please report this to DGLogik.");}String A=await om.readAsString();A=A.replaceAll("{{HOST}}",host).replaceAll("{{SIG_REQ}}",D).replaceAll("{{USERNAME}}",B["username"]).replaceAll("{{REMEMBER}}",(B["remember"]!=null).toString());return A;}Future<bool> Jx(Map A,HttpRequest C)async{String B=A["sig_response"];return b4(si,Ok,uh,B)!=null;}}class i0 extends eI implements xE,cK{WebSocket socket;String qG;String token;bool kV;Future init(SD C)async{var A=C.get("externalAuth");B(String D){f.kB(D);exit(1);}if(A==null){B("External Authentication not configured.");}qG=A["url"];if(qG==null){B("External Authentication URL not configured.");}token=A["token"];if(token==null){B("External Authentication token not configured.");}kV=A["verifyOnStart"];if(kV==null){kV=true;}await connect(true);}Future LI(m A,String B)async{await j("addUser",{"username":A.username,"superuser":A.wC,"password":B,"metadata":A.IB});}Future nG(String A)async{await j("removeUser",{"username":A});}Future<m> UI(String B)async{try {var A=await j("getUser",{"username":B});return new m(A["username"],A["superuser"],A["metadata"]);}catch (C){return null;}}Future<List<m>> WI()async{try {var B=await j("listUsers",{});return B.map((A)=>new m(A["username"],A["superuser"],A["metadata"])).toList();}catch (C){return null;}}Future<bool> authenticate(String A,String B)async{try {return await j("authenticate",{"username":A,"password":B})==true;}catch (C){return false;}}connect([bool A=false])async{if(IHB){return;}try {socket=await nS.Jp(qG);IHB=true;JHB=0;socket.done.then((J){IHB=false;new Timer(const Duration(seconds:5),(){connect();});});socket.listen((String G){try {var B=const JsonDecoder().convert(G);if(B is!Map){return;}if(B["event"]=="changed"){for(var H in KHB){H();}return;}LHB.add(B);}catch (D){}});socket.add(const JsonEncoder().convert({"token":token}));Map C=await MHB.first.timeout(const Duration(seconds:5));if(C["error"]!=null){if(A){f.oC("External Authentcation system says '${C["error"]}'");if(kV){exit(1);}}else{throw new fI(C["error"]);}}if(A){f.kB("External Authentication System Connected.");}}catch (D,I){f.oC("Failed to connect to the External Authentication system.",D,I);if(A&&kV){exit(1);}new Timer(const Duration(seconds:5),(){connect();});}}StreamController<Map> LHB=new StreamController.broadcast();Stream<Map> get MHB=>LHB.stream;bool IHB=false;Future<dynamic> j(String C,Map D)async{if(!IHB){throw new fI("External Authentication System is not connected.");}var B=const JsonEncoder().convert({"rid":JHB,"method":C,"args":D});f.eC("External Authentication Request: ${B}");var G=JHB;JHB++ ;socket.add(B);var A=await MHB.where((H)=>H["rid"]==G).first.timeout(const Duration(seconds:10),onTimeout:()=>null);if(A==null){throw new fI("External Authentication System timed out.");}f.eC("External Authentication Response: ${A}");return A["value"];}int JHB=0;Future KR(String A,String B)async{await j("changePassword",{"username":A,"password":B});}Future PR(m A)async{await j("editUser",{"username":A.username,"superuser":A.wC,"metadata":A.IB});}void LZ(Function A){KHB.add(A);}void xj(Function A){KHB.remove(A);}List<Function> KHB=[] ;}ZX JS=new ZX();class pm extends eI implements cK,xE,Hc{static final String j0=new String.fromCharCodes(VG.wP(new String.fromCharCodes(const[90,71,100,115,100,88,103,120,77,106,77,48])));File file=new File("users.json");List<m> uE=[] ;pm();Future init(SD C)async{await load();if(!Platform.isAndroid){var A=new dQ(file.path);A.nZ.listen((cG B)async{if(B.type==pJ.lX){f.kB("Reloading Users");await load();}});}}String K$(){var A={"username":"dgSuper"};var B=[A];A["password"]=JS.qi(j0);A["superuser"]=true;A["metadata"]={};return hN.convert(B);}Future load()async{if(NHB){return;}NHB=true;try {if(!(await file.exists())){await file.create(recursive:true);await file.writeAsString(K$()+"\n");}var B=await file.readAsString();var A=const JsonDecoder().convert(B);if(A is!List){A=[] ;}List C=A;uE=C.map(m.um).toList();OHB();}on FormatException catch (D){f.gC("Failed to load Users File: ${D.toString().trim()}");}NHB=false;}bool NHB=false;Future<bool> authenticate(String C,String D)async{m B=await UI(C);if(B==null){return false;}var A=B.tO["password"];if(A==null){A="";}return JS.S_(A,D);}Future<m> UI(String A)async{return uE.firstWhere((B)=>B.username==A,orElse:()=>null);}Future<List<m>> WI()async{return new List<m>.from(uE);}Future LI(m A,String B,{bool isPasswordHashed: false})async{var C=m.um({"username":A.username,"superuser":A.wC,"password":isPasswordHashed?B:JS.qi(B)});uE.add(C);await rE();OHB();}Future nG(String A)async{uE.removeWhere((B)=>B.username==A);await rE();OHB();}rE()async{var A=const JsonEncoder.withIndent("  ");var B=A.convert(uE.map((m C){return C.fx(const["password"]);}).toList())+"\n";await file.writeAsString(B);}void LZ(Function A){KHB.add(A);}List<Function> KHB=[] ;Future PR(m A)async{Iterable<m> B=uE.where((G){return G.username==A.username;});if(B.isEmpty){return;}m C=B.first;uE.remove(C);var D=A.xM();D.tO["password"]=C.tO["password"];uE.add(D);await rE();OHB();}Future KR(String B,String C)async{List<m> A=uE.where((D){return D.username==B;}).toList();if(A.isEmpty){return;}m G=A.first;G.tO["password"]=JS.qi(C);await rE();}void xj(Function A){KHB.remove(A);}Future PBB(String G,String C)async{Iterable<m> D=uE.where((m B)=>B.username==G);if(D.isEmpty){return;}Iterable<m> H=uE.where((m B)=>B.username==C);if(H.isNotEmpty){return;}m A=D.first;uE.remove(A);A=A.oO(username:C);uE.add(A);await rE();OHB();}void OHB(){for(var A in KHB){A();}}}class mm<BB>{List<Function> PHB=<Function>[] ;bool QHB=false;bool get isCompleted=>QHB;BB RHB;void done(BB A){RHB=A;QHB=true;while(PHB.isNotEmpty){PHB.removeAt(0)(A);}}Future KCB(){if(QHB){return new Future.value(RHB);}var A=new Completer<BB>();PHB.add((B){A.complete(B);});return A.future;}}class rm extends eI implements xE,cK{zb Iw;List<String> HP;String ZR;String aI;bool QZ;Map<String,String> zU;dynamic la;Future init(SD H)async{B(String M){f.oC("Error while initializing LDAP: ${M}");exit(1);}if(H.get("ldap")==null){B("LDAP Authentication is not configured.");}var A=H.get("ldap");var I=A["url"];if(I==null){B("LDAP URL was not specified.");}Uri C;try {C=Uri.parse(I);}catch (D){B("Failed to parse LDAP URL: ${D}");}var G=new zb(C.host,port:C.port!=0?C.port:null,ssl:C.scheme=="ldaps");var J=A["dn"];if(J==null){B("LDAP DN is not configured.");}G.QU=J;var K=A["password"];if(K!=null){G.password=K;}if(A["searchBase"] is String){HP=[A["searchBase"]];}else{HP=A["searchBase"];}if(HP==null){B("LDAP Search Base is not configured.");}ZR=A["groupAttribute"];if(ZR==null){ZR="gid";}aI=A["usernameAttribute"];if(aI==null){aI="uid";}QZ=A["allowListUsers"];if(QZ==null){QZ=false;}la=A["superuserGroup"];if(la==null){la="superuser";}zU=A["metadata"];if(zU==null){zU={};}Iw=G;try {VL=await jU();f.kB("LDAP Authentication Configured.");}catch (D){B("Failed to connect to LDAP Server: ${D}");}new Timer.periodic(const Duration(seconds:10),(O){SHB.clear();});new Timer.periodic(const Duration(hours:1),(O){OHB();});THB();UHB();}bK VL;Future<bK> jU()async{if(VL!=null&&!VL.isClosed()){try {await VL.close();}catch (A){}}VL=await Iw.P$();return VL;}Future LI(m A,String B)async{throw new fI("LDAP authentication does not support adding users.");}Future nG(String A)async{throw new fI("LDAP authentication does not support removing users.");}Map<String,m> SHB=new Map<String,m>();Map<String,mm<m>> VHB={};Future<m> UI(String A)async{if(A==null){return null;}if(SHB.containsKey(A)){return SHB[A];}if(VHB.containsKey(A)){var H=VHB[A];if(H!=null&&!H.isCompleted){var Q=await H.KCB();return Q;}}var S=await jU();var Z=new mm<m>();VHB[A]=Z;try {var h=EC.yb(aI,A);List<XF> I=[] ;for(var p in HP){var M=[aI,ZR,"*"];M.addAll(zU.keys);List<XF> C=await S.ca(p,h,M).stream.toList();I.addAll(C);}if(I.isEmpty){return null;}var C=I.first;var O=false;var G={};if(C.HB.containsKey(ZR)){var D=C.HB[ZR].values;for(var EB in D){if(EB==la.toString()){O=true;}}}for(var J in zU.keys){var P=C.HB[J];if(P==null)continue;var D=P.values;if(D.isEmpty){continue;}if(D.length==1){G[J]=D.first;}else{G[J]=D.toList();}}zF B=C.HB["passwordMustChange"];if(B==null){B=C.HB["pwdMustChange"];}if(B==null){B=C.HB["pwdLastSet"];}if(B!=null&&(B.values.contains(true)||B.values.contains("on")||B.values.contains(0)||B.values.contains("0"))){G["forcePasswordChange"]=true;}if(WHB[A] is Map){G.addAll(WHB[A]);}var K=new m(A,O,G);SHB[A]=K;if(VHB[A]!=null){VHB.remove(A).done(K);}return K;}catch (PB){if(VHB[A]!=null){VHB.remove(A).done(null);}return null;}}Future<List<m>> WI()async{if(!QZ){return [] ;}var D=<m>[] ;var I=EC.yz(aI);for(var A in HP){try {var J=await jU();List<XF> K=await J.ca(A,I,[aI]).stream.toList();for(var G in K){try {var H=await UI(G.HB[aI].values.first);if(H!=null){D.add(H);}}catch (B,C){f.gC("LDAP user list failed failed for search base '${A}' and entry ${G}",B,C);}}}catch (B,C){f.gC("LDAP user list failed for search base '${A}'",B,C);}}return D;}Future<bool> authenticate(String J,String H)async{try {if(H.isEmpty){return false;}var I=await jU();var K=EC.yb(aI,J);List<XF> B=[] ;for(var M in HP){List<XF> C=await I.ca(M,K,[aI,"*"]).stream.toList();B.addAll(C);}if(B.isEmpty){return false;}else{var C=B.first;try {var D=await I.bind(C.zu,H);if(D.PK!=0){f.eC("Failed to authenticate LDAP user: " "(Message: ${D.qu}, " "Result Code: ${D.PK})");return false;}return true;}catch (A,G){if(A.toString().contains(", data 773, ")){return true;}f.eC("Failed to authenticate LDAP user.",A,G);return false;}}}catch (A,G){f.eC("Failed to authenticate LDAP user.",A,G);return false;}}static Exception m0(GM A){if(A.toString().contains("SocketException")){return null;}return A;}Future KR(String I,String O)async{bK J=await jU();var P=EC.yb(aI,I);List<XF> C=[] ;for(var Q in HP){List<XF> S=await J.ca(Q,P,[aI,"unicodePwd","*"]).stream.toList();C.addAll(S);}if(C.isEmpty){throw new fI("Unable to find user '${I}'");}XF D=C.first;String B="unicodePwd";if(!D.HB.containsKey("unicodePwd")){B=D.HB.keys.firstWhere((Z)=>Z.contains("Password"),orElse:(){return "userPassword";});}if(const["badPasswordTime","passwordMustChange"].contains(B)){B="unicodePwd";}WG A;try {var K='"'+O+'"';var G=<int>[] ;for(var H=0;H<K.length;H++ ){var M=K.codeUnitAt(H);G.add(M&0xff);G.add(M>>8);}A=await J.UAB(D.zu,[new IS.oCB(B,[new String.fromCharCodes(G)])]);}catch (h,p){f.gC("Failed to change password.",h,p);}if(A==null){throw new fI("LDAP result is null.");}else if(A.PK!=HS.Qm){throw new fI("Failed to change password: ${A.qu}" " ${HS.Tm(A.PK)} " " (${A.PK})");}OHB();}Future PR(m A)async{if(WHB[A.username] is!Map){WHB[A.username]={};}SHB.remove(A.username);WHB[A.username].addAll(A.IB);UHB();OHB();}THB(){var A=new File("ldap_meta.json");if(A.existsSync()){WHB=yE.convert(A.readAsStringSync());}}UHB(){var A=new File("ldap_meta.json");A.writeAsStringSync(hN.convert(WHB)+"\n");}Map<String,Map<String,dynamic>> WHB={};void OHB(){for(var A in KHB){A();}}List<Function> KHB=[] ;void LZ(Function A){KHB.add(A);}void xj(Function A){KHB.removeWhere((B)=>B==A);}}class h0 extends eI{Future LI(m A,String B)async{return;}Future<bool> authenticate(String A,String B)async{return true;}Future<m> UI(String A)async{return Pw;}Future init(SD A)async{}Future<List<m>> WI()async=>[Pw];Future nG(String A)async{}final m Pw=new m("dgUser",false,{"open":true});}class Gc{final String token;final eI KG;Gc(this.token,this.KG);a$(WebSocket H)async{var M=new StreamController<Map>.broadcast();H.listen((String p){try {M.add(const JsonDecoder().convert(p));}catch (B){}});var h=(){H.add(const JsonEncoder().convert({"event":"changed"}));};H.done.then((dB){if(KG is cK){(KG as cK).xj(h);}M.close();});var O=await M.stream.first.timeout(const Duration(seconds:5),onTimeout:(){return null;});if(O==null||!O.containsKey("token")){H.close();return;}var EB=O["token"];if(this.token!=EB){H.add(const JsonEncoder().convert({"error":"Bad Token"}));await new Future.delayed(const Duration(seconds:1));H.close();return;}var P=[] ;if(KG is xE){P.add("editable");}if(KG is cK){P.add("observable");(KG as cK).LZ(h);}H.add(const JsonEncoder().convert({"ok":true,"flags":P}));M.stream.listen((Map J)async{if(J["method"]==null||J["rid"]==null){return;}String I=J["method"];int PB=J["rid"];Map C=J["args"];Map A={"method":I,"rid":PB};if(I=="addUser"){var D=C["username"];var Q=C["superuser"];var S=C["metadata"];var K=C["password"];var Z=new m(D,Q,S);try {await KG.LI(Z,K);A["value"]={};}catch (B){A["error"]=B.toString();}}else if(I=="authenticate"){var D=C["username"];var K=C["password"];try {var G=await KG.authenticate(D,K);A["value"]=G;}catch (B){A["error"]=B.toString();}}else if(I=="getUser"){var D=C["username"];try {var G=await KG.UI(D);A["value"]={"username":G.username,"superuser":G.wC,"metadata":G.IB};}catch (B){A["error"]=B.toString();}}else if(I=="changePassword"&&KG is xE){var D=C["username"];var K=C["password"];try {await (KG as xE).KR(D,K);A["value"]={};}catch (B){A["error"]=B.toString();}}else if(I=="editUser"&&KG is xE){var D=C["username"];var Q=C["superuser"];var S=C["metadata"];try {m Z=new m(D,Q,S);await (KG as xE).PR(Z);A["value"]={};}catch (B){A["error"]=B.toString();}}else if(I=="listUsers"){try {var TB=await KG.WI();var UB=TB.map((G){return {"username":G.username,"superuser":G.wC,"metadata":G.IB};}).toList();A["value"]=UB;}catch (B){A["error"]=B.toString();}}else if(I=="removeUser"){var D=C["username"];try {await KG.nG(D);A["value"]={};}catch (B){A["error"]=B.toString();}}else{A["error"]="Bad Method";}H.add(const JsonEncoder().convert(A));});}bBB(String C,int B)async{var D=await HttpServer.bind(C,B);D.listen((HttpRequest A)async{if(A.uri.path!="/auth"){A.response..statusCode=HttpStatus.NOT_FOUND..writeln("Not Found");A.response.close();return;}a$(await WebSocketTransformer.upgrade(A));});f.kB("Authentication Server Started on port ${B}");}}abstract class p0<BB>{}class q0<BB> extends p0<BB>{}class SD{bool WL;int port;int VI;String wM;String iG;String VU;bool gZ;bool XZ;int UP;String host;int uR;String SU;String LG;Map<String,String> TK;Map<String,Map<String,dynamic>> vU;Map<String,Map<String,dynamic>> dE;String TU;bool TV;List<String> XL;String wx;bool OV;bool OZ;List defaultPermission;bool Hb;int lj;int mj;String XI;String lU;String TZ;String bk;String Ia;String iZ;bool ik;bool jk;String downstreamName;bool ba;bool Cv;String WV;List<String> FK;Map<String,String> proxies;Map<String,List<String>> aR;List<String> Px;List<String> Ni;List<String> yi;int kk;bool PZ;bool Wi;bool vh;bool zi;Map<String,String> xO;bool Vk;String gi;bool Vi;String HJ;Map<String,List<String>> nU;bool Aa;String Qk;dynamic Sj;dynamic get(A,[B]){if(A is!List){A=[A];}for(var C in A){if(map[C]!=null){return map[C];}}if(B is Function){return B();}else{return B;}}dynamic map;void load(Map B){this.map=B;WL=get("debug",false);port=get("port",XHB);VI=get(["httpsPort","httpsport"],YHB);iG=get("certName","");wM=get("certPassword","");VU=get("certKeyName","");gZ=get("disableFileSecurity",false);XZ=get("broadcast",false);SU=get("broadcastUrl");UP=get("workers",Platform.numberOfProcessors==1?1:2);uR=get("updateInterval",200);var A=<String,String>{"/.well-known":"${Directory.current.absolute.path}/.well-known"};TK=get("static",A);if(!TK.containsKey("/.well-known")){TK.addAll(A);}vU=get("linkConfig",{});LG=get("brokerUrl");TU=get("brokerName","broker-");XL=get("disabledLinks",[] );TV=get("runBrokerInMain",Platform.numberOfProcessors==1?true:false);wx=get("uptimeCheckUrl");Cv=get("enableUptimeChecker",true);dE=get("upstream",{});OV=get("quarantine",false);OZ=get("allowAllLinks",true);defaultPermission=get("defaultPermission",null);Hb=get("useRuntimeManager",false);ik=get("useDartRuntimeManager",false);jk=get("useJavaRuntimeManager",false);lj=get("passwordHasherIterations",1000);mj=get("passwordHasherKeyLength",32);XI=get("loginRedirectPath","/");TZ=get("authType","file");bk=get("twoFactorAuth","none");downstreamName=get("downstreamName","conns");ba=get("runPortChecks",true);Qk=get("storageDriver",'simple');Sj=get("observe",false);host=get("host","0.0.0.0");FK=get("loggers",[] );proxies=get("proxies",{});aR=get("hooks",{});iZ=get("distributionUrl",s0);Ia=get("linkRepositoryUrl",r0);Px=get("serverVmFlags",[] );Ni=get("dartRuntimeManagerVmFlags",[] );yi=get("javaRuntimeManagerVmFlags",[] );kk=get("userTimeout",525600);PZ=get("allowBrowserCaching",false);WV=get("serverLogLevel","INFO");Wi=get("enableIPv6",false);lU=get("guestLoginRedirectPath",null);vh=get("allowPasswordChanges",true);zi=get("keepCustomAssets",false);xO=get("linkManagerEnvironment",{});Vk=get("timeHttpRequests",false);gi=get("generatedCertificateSubject","/C=US/ST=California/L=Oakland/O=DGLogik Inc./OU=Customers/CN=*");Vi=get("enableCertificateGeneration",true);HJ=get("alternativeBrokerUrl",null);nU=get("httpPathClassification",{});Aa=get("isAlwaysOffline",false);}Future<bool> Lw([String A="server"])async{if(await ZS.Kd.mi(".docker").exists()){XHB=80;YHB=443;}var B=await wm(A);if(!(await B.exists())){load({"downstreamName":"downstream"});await WH(A);return true;}var C=await z0(B);load(C);var D=rE();if(const JsonEncoder().convert(C)!=const JsonEncoder().convert(D)){await WH(A);}return false;}int YHB=8443;int XHB=8080;Map rE(){var A={"debug":WL,"host":host,"port":port,"httpsPort":VI,"certName":iG,"certKeyName":VU,"certPassword":wM,"disableFileSecurity":gZ,"isAlwaysOffline":Aa,"broadcast":XZ,"workers":UP,"updateInterval":uR,"static":TK,"linkConfig":vU,"disabledLinks":XL,"uptimeCheckUrl":wx,"upstream":dE,"quarantine":OV,"allowAllLinks":OZ,"defaultPermission":defaultPermission,"useRuntimeManager":Hb,"useDartRuntimeManager":ik,"useJavaRuntimeManager":jk,"passwordHasherIterations":lj,"passwordHasherKeyLength":mj,"loginRedirectPath":XI,"guestLoginRedirectPath":lU,"authType":TZ,"twoFactorAuth":bk,"runPortChecks":ba,"storageDriver":Qk,"downstreamName":downstreamName,"enableUptimeChecker":Cv,"observe":Sj,"loggers":FK,"proxies":proxies,"hooks":aR,"distributionUrl":iZ,"linkRepositoryUrl":Ia,"serverVmFlags":Px,"userTimeout":kk,"allowBrowserCaching":PZ,"serverLogLevel":WV,"enableIPv6":Wi,"dartRuntimeManagerVmFlags":Ni,"javaRuntimeManagerVmFlags":yi,"allowPasswordChanges":vh,"keepCustomAssets":zi,"linkManagerEnvironment":xO,"timeHttpRequests":Vk,"generatedCertificateSubject":gi,"enableCertificateGeneration":Vi,"alternativeBrokerUrl":HJ,"httpPathClassification":nU};if(SU!=null){A["broadcastUrl"]=SU;}if(TU!=null){A["brokerName"]=TU;}if(LG!=null){A["brokerUrl"]=LG;}if(TV!=null){A["runBrokerInMain"]=TV;}if(map["ldap"]!=null){A["ldap"]=map["ldap"];}if(map["duo"]!=null){A["duo"]=map["duo"];}if(map["externalAuth"]!=null){A["externalAuth"]=map["externalAuth"];}if(map["authServer"]!=null){A["authServer"]=map["authServer"];}return A;}bool ZHB=false;Future WH([String A="server"])async{if(ZHB){return;}ZHB=true;var B=await wm(A);await A1(B,rE());ZHB=false;}}const String Ic="dglux_server";const String r0="https://dsa.s3.amazonaws.com/links/links.json";const String s0="https://dsa.s3.amazonaws.com/dists/dists.json";const int t0=1024;const int vm=t0*1024;const int u0=vm*1024;class v0{static const List<int> w0=const[0x00000000,0x77073096,0xee0e612c,0x990951ba,0x076dc419,0x706af48f,0xe963a535,0x9e6495a3,0x0edb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x09b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x01db7106,0x98d220bc,0xefd5102a,0x71b18589,0x06b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0x0f00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x086d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x03b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x04db2615,0x73dc1683,0xe3630b12,0x94643b84,0x0d6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0x0a00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x026d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x05005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0x0cb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0x0bdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,0x37d83bf0,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d];static int x0(List<int> B,[int A=0]){A=A^0xffffffff;for(var C in B){A=(A>>8)^w0[(A^C)&0xFF];}A=A^0xffffffff;return A;}static String y0(List<int> B,[int C=0]){var A=x0(B).toRadixString(16);while(A.length<8){A='0${A}';}return A;}}SD n;WD f;Jc(){if(f==null){LO=true;f=new WD("DGServer");f.Qa.listen((A){List<String> B=A.message.split("\n");for(String C in B){print("[${A.level.name}] ${C}");}if(A.error!=null){print(A.error);}if(A.stackTrace!=null){print(A.stackTrace);}});}}Future<IQ> wm(String A)async{var B=["${A}.json","${A}.toml","${A}.yaml"];for(var D in B){var C=ZS.Kd.mi(D);if(await C.exists()){return C;}}return ZS.Kd.mi(B.first);}Future<dynamic> z0(IQ B)async{if(!(await B.exists())){return null;}var A=await B.readAsString();var C=xe(B.path);if(C==".toml"){var D=new Sr();return zP(D.BE(A).value);}else if(C==".yaml"){return zP(O7(A));}else{if(A.trim().isEmpty||A==" "){A="{}";}return zP(yE.convert(A));}}Future A1(IQ B,dynamic C)async{if(!(await B.exists())){await B.create();}var A="";var D=xe(B.path);if(D==".toml"){var G=new I6();A=G.encode(C);}else if(D==".yaml"){A=R7(C);}else{A=hN.convert(C);}if(!A.endsWith("\n")){A=A+"\n";}await B.writeAsString(A);}JsonEncoder hN=const JsonEncoder.withIndent("  ");JsonEncoder dK=const JsonEncoder();JsonDecoder yE=const JsonDecoder();Utf8Decoder eK=const Utf8Decoder(allowMalformed:true);Utf8Encoder LS=const Utf8Encoder();dynamic zP(A){if(A is Map){var B={};for(var C in A.keys){B[zP(C)]=zP(A[C]);}return B;}else if(A is List){return A.map((D)=>zP(D)).toList();}else{return A;}}HttpClient j1=new HttpClient();class gK{static bool Qn(HttpHeaders B,String C,String D){var A=B[C];if(A==null||A.isEmpty){return false;}if(A.contains(D)||A.contains("*")){return true;}return false;}static Future Rn(HttpRequest B){var A=B.response;A.statusCode=404;A.writeln("ERROR: Not Found.");return A.close();}static Map<String,String> Sn(HttpHeaders A){var B={};A.forEach((C,D){B[C]=A.value(C);});return B;}static Future Tn(HttpRequest A,Uri M,[Map<String,String> I])async{var C=A.response;var O=j1;try {HttpClientRequest B=await O.openUrl(A.method,M);B.headers.removeAll("transfer-encoding");B.headers.removeAll("host");A.headers.forEach((G,D){if(G=="connection"&&(D.contains("Upgrade")||D.contains("upgrade"))){D.remove("keep-alive");}B.headers.set(G,D.first);});B.persistentConnection=A.persistentConnection;try {if(A.headers.value("origin")!=null){B.headers.set("X-Proxy-Origin",A.headers.value("origin"));}}catch (P){}if(I!=null){for(var J in I.keys){B.headers.set(J,I[J]);}}HttpClientResponse H=await A.pipe(B);C.statusCode=H.statusCode;H.headers.forEach((G,D){var K=G.toLowerCase();if(K=="tranfer-encoding"||K=="te"){return;}C.headers.set(G,D.first);});if(H.statusCode==HttpStatus.SWITCHING_PROTOCOLS){return await k1(A,H);}else{await H.pipe(C);}}catch (P){C.statusCode=500;C.writeln("Internal Server Error");return C.close();}}static Future k1(HttpRequest A,HttpClientResponse B)async{var C=await A.response.detachSocket();var D=await B.detachSocket();await m1.n1(C,D);}static List<String> l1(String B){List<String> D=new List<String>();int C=0;int A=0;while(A<B.length){if(B[A]==","){D.add(B.substring(C,A));C=A+1;}else if(B[A]==" "||B[A]=="\t"){C++ ;}A++ ;}D.add(B.substring(C,A));return D;}}class m1{static Future n1(Socket A,Socket B)async{if(A!=null&&B==null){A.destroy();return;}if(A==null&&B!=null){B.destroy();return;}if(A==null||B==null){return;}B.encoding=A.encoding;var G=A.listen(B.add).asFuture();var H=B.listen(A.add).asFuture();var D=new Completer();var C=(K){try {B.destroy();A.destroy();}catch (I,J){f.gC("Failed to cleanup socket proxy",I,J);}if(!D.isCompleted){D.complete();}};G.then(C).catchError(C);H.then(C).catchError(C);await D.future;}}class o1{static const String p1="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";static Future<WebSocket> q1(HttpRequest C,bool J,[G])async{if(const bool.fromEnvironment("websocket.standard",defaultValue:true)||J==true){return await WebSocketTransformer.upgrade(C,protocolSelector:G);}var A=C.response;if(!WebSocketTransformer.isUpgradeRequest(C)){A..statusCode=HttpStatus.BAD_REQUEST..close();return new Future.error(new WebSocketException("Invalid WebSocket upgrade request"));}Future H(String B){A..statusCode=HttpStatus.SWITCHING_PROTOCOLS..headers.add(HttpHeaders.CONNECTION,"Upgrade")..headers.add(HttpHeaders.UPGRADE,"websocket");String K=C.headers.value("Sec-WebSocket-Key");ZJ I=new ZJ();I.add("${K}${p1}".codeUnits);String M=VG.gN(I.close());A.headers.add("Sec-WebSocket-Accept",M);if(B!=null){A.headers.add("Sec-WebSocket-Protocol",B);}A.headers.contentLength=0;return A.detachSocket().then((O)=>new WebSocket.fromUpgradedSocket(O,protocol:B,serverSide:true));}var D=C.headers['Sec-WebSocket-Protocol'];if(D!=null&&G!=null){D=gK.l1(D.join(', '));return new Future(()=>G(D)).then((B){if(D.indexOf(B)<0){throw new WebSocketException("Selected protocol is not in the list of available protocols");}return B;}).catchError((P){A..statusCode=HttpStatus.INTERNAL_SERVER_ERROR..close();throw P;}).then(H);}else{return H(null);}}}class AQ{int start;int end;int total;int length;AQ(this.start,this.end,this.total){length=(end-start);}String toString()=>"Range(${start}-${end}, length: ${length})";}int Un(String B,int C,int D){String A=B.substring(C,D);return (A.length>0)?int.parse(A):-1;}class lN{final String oF;final ContentType type;lN(this.oF,this.type);}void eE(HttpRequest C,A){if(A==null){return;}var B=C.response;if(A is Future){A.then((G){eE(C,G);});}else if(A is String){var D=LS.convert(A);if(C.method!="HEAD"&&C.method!="OPTIONS"){B.contentLength=D.length;B.add(D);}else{B.headers.contentLength=D.length;}uD();B.close();}else if(A is Stream){if(C.method!="HEAD"&&C.method!="OPTIONS"){uD();A.pipe(B).then((H){B.close();uD();});}else{uD();B.close();}}else if(A is File){kN(C,A);}else if(A is Map||A is List){B.headers.contentType=ContentType.JSON;eE(C,hN.convert(A));}else if(A is HttpResponse){return;}else if(A is lN){B.headers.contentType=A.type;var D=LS.convert(A.oF);if(C.method!="HEAD"&&C.method!="OPTIONS"){B.contentLength=D.length;B.add(D);}else{B.headers.contentLength=D.length;}B.close();uD();}else{throw new Exception("Unknown Route Value: ${A} with type ${A.runtimeType} on path ${C.uri.path}");}}Stopwatch s1(){return Zone.current["stopwatch"];}HttpRequest t1(){return Zone.current["request"];}void uD(){var A=s1();var B=t1();if(A!=null&&B!=null){A.stop();if(f.wO(RB.YQ)){f.rD("${B.method} ${B.uri}" " took ${A.elapsedMicroseconds/1000}ms");}}}final RegExp g1=new RegExp(r"^bytes=\d*-\d*(,\d*-\d*)*$");class h1{}const int i1=512*1024*1024;q0<h1> dc;kN(HttpRequest B,File K,{bool download: false,bool enableCache: true})async{var A=B.response;var Z=K.path;var Q=mJ(Z);var H=x4(Q);if(Q.endsWith(".dg5")){H="application/json";}else if(Q.endsWith(".woff")){H="application/font-woff";}if(H==null){H="text/plain";}A.headers.contentType=ContentType.parse(H);var h=B.headers.value("Range");var p=await K.stat();if(p.type==FileSystemEntityType.NOT_FOUND){RS(B,A);return;}int D=p.size;DateTime M=p.modified;var J="${Q}_${D}_${M.millisecondsSinceEpoch}_${H}";if(B.headers.value("If-None-Match")!=null&&gK.Qn(B.headers,"If-None-Match",J)){A.headers.set(HttpHeaders.ETAG,J);if(n.PZ){A.headers.set("Cache-Control","max-age=300");}A.statusCode=HttpStatus.NOT_MODIFIED;await A.close();uD();return;}if(B.headers.ifModifiedSince!=null&&B.headers.value("If-None-Match")==null){if(B.headers.ifModifiedSince.millisecondsSinceEpoch+1000>M.millisecondsSinceEpoch){A.headers.set(HttpHeaders.ETAG,J);A.statusCode=HttpStatus.NOT_MODIFIED;await A.close();uD();return;}}if(B.headers.value("If-Match")!=null&&!gK.Qn(B.headers,"If-Match",J)){A.statusCode=HttpStatus.PRECONDITION_FAILED;await A.close();uD();return;}if(B.headers.value("If-Unmodified-Since")!=null){try {var sB=HttpDate.parse(B.headers.value("If-Unmodified-Since"));if(sB.millisecondsSinceEpoch+1000<=M.millisecondsSinceEpoch){A.statusCode=HttpStatus.PRECONDITION_FAILED;await A.close();return;}}catch (TB){A.statusCode=HttpStatus.BAD_REQUEST;A.writeln(TB);await A.close();uD();return;}}AQ EB=new AQ(0,D,D);List<AQ> G=[] ;if(h!=null){if(!g1.hasMatch(h)){A.headers.set(HttpHeaders.CONTENT_RANGE,"bytes */${D}");A.statusCode=HttpStatus.REQUESTED_RANGE_NOT_SATISFIABLE;await A.close();uD();return;}String PB=B.headers.value("If-Range");if(PB!=null&&PB!=J){try {var tB=HttpDate.parse(PB);if(tB.millisecondsSinceEpoch+1000<M.millisecondsSinceEpoch){G.add(EB);}}catch (TB){G.add(EB);}}if(G.isEmpty){for(var O in h.substring(6).split(",")){var S=Un(O,0,O.indexOf("-"));var I=Un(O,O.indexOf("-")+1,O.length);if(S==-1){S=D-I;I=D;}else if(I==-1||I>D){I=D;}if(S>I){A.headers.set(HttpHeaders.CONTENT_RANGE,"bytes */${D}");A.statusCode=HttpStatus.REQUESTED_RANGE_NOT_SATISFIABLE;await A.close();return;}G.add(new AQ(S,I,D));}}}A.headers.set("Accept-Ranges","bytes");if(enableCache){A.headers.set("ETag",J);if(n.PZ){A.headers.set("Cache-Control","max-age=300");}else{A.headers.set("Cache-Control","max-age=0, must-revalidate");}}else{var UB=new DateTime.now();A.headers.set("Last-Modified",HttpDate.format(UB));A.headers.set("Expires",HttpDate.format(UB));A.headers.set("Cache-Control","no-cache, no-store, max-age=0, must-revalidate");A.headers.set("Pragma","no-cache");}A.headers.contentType=ContentType.parse(H);if(G.isEmpty||G[0]==EB){if(B.method=="OPTIONS"){await A.close();return;}if(B.method=="HEAD"){A.headers.contentLength=D;await A.close();return;}A.contentLength=D;if(dc!=null&&dc.b$(Z)){var dB=dc.get(Z);if(M.millisecondsSinceEpoch<dB.NEB){A.add(dB.hG);await A.close();return;}}if(D>=i1){A.bufferOutput=false;}await K.openRead().listen((P){A.add(P);}).asFuture();await A.close();uD();return;}else if(G.length==1){AQ C=G[0];if(B.method=="OPTIONS"){await A.close();uD();return;}if(B.method=="HEAD"){A.headers.contentLength=C.length;await A.close();uD();return;}A.contentLength=C.length;A.statusCode=HttpStatus.PARTIAL_CONTENT;A.headers.set("Content-Range","bytes ${C.start}-${C.end-1}/${C.total}");if(B.method=="OPTIONS"||B.method=="HEAD"){await A.close();uD();return;}await K.openRead(C.start,C.start+C.length).listen((P){A.add(P);}).asFuture();await A.close();uD();return;}else{A.headers.set("Content-Type","multipart/byteranges; boundary=MULTIPART_BYTERANGES");A.statusCode=HttpStatus.PARTIAL_CONTENT;if(B.method=="OPTIONS"||B.method=="HEAD"){await A.close();return;}for(var C in G){A.writeln();A.writeln("--MULTIPART_BYTERANGES");A.writeln("Content-Type: ${H}");A.writeln("Content-Range: bytes ${C.start}-${C.end-1}/${C.total}");A.writeln();await K.openRead(C.start,C.start+C.length).listen((P){A.add(P);}).asFuture();}A.writeln();A.writeln("--MULTIPART_BYTERANGES--");await A.close();uD();}}File ec=new File("www/404.html").absolute;File r1=new File("www/access_denied.html").absolute;RS(HttpRequest B,HttpResponse A)async{if(B.method=="OPTIONS"){A.statusCode=404;await A.close();uD();return;}if(B.headers.value("Accept")!=null&&B.headers.value("Accept").contains("text/html")&&await ec.exists()){A.statusCode=404;await kN(B,ec);}else{A.statusCode=404;A.writeln("404 - Not Found.");await A.close();uD();}}dJ(HttpRequest B,HttpResponse A)async{if(B.method=="OPTIONS"){A.statusCode=HttpStatus.FORBIDDEN;await A.close();uD();return;}if(B.headers.value("Accept")!=null&&B.headers.value("Accept").contains("text/html")&&await ec.exists()){A.statusCode=HttpStatus.FORBIDDEN;await kN(B,r1);}else{A.statusCode=HttpStatus.FORBIDDEN;A.writeln("Access Denied.");await A.close();uD();}}Future<String> u1({int length: 30})async{var H=new Random();var C=new StringBuffer();for(int D=1;D<=length;D++ ){var A=new Random(H.nextInt(0x70000000)+(new DateTime.now()).millisecondsSinceEpoch);await new Future.value();var B=A.nextInt(50);if(B>=0&&B<=32){String G=BQ[A.nextInt(BQ.length)];C.write(A.nextBool()?G.toLowerCase():G);}else if(B>32&&B<=43){C.write(CQ[A.nextInt(CQ.length)]);}else if(B>43){C.write(Wn[A.nextInt(Wn.length)]);}}return C.toString();}String Vn({int length: 50}){var A=new Random();var B=new StringBuffer();for(int C=1;C<=length;C++ ){if(A.nextBool()){String D=BQ[A.nextInt(BQ.length)];B.write(A.nextBool()?D.toLowerCase():D);}else{B.write(CQ[A.nextInt(CQ.length)]);}}return B.toString();}Future<String> fc({int length: 50})async{var G=new Random();var B=new StringBuffer();for(int C=1;C<=length;C++ ){await new Future.value();var A=new Random(G.nextInt(0x70000000)+(new DateTime.now()).millisecondsSinceEpoch);if(A.nextBool()){String D=BQ[A.nextInt(BQ.length)];B.write(A.nextBool()?D.toLowerCase():D);}else{B.write(CQ[A.nextInt(CQ.length)]);}}return B.toString();}const List<String> BQ=const["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];const List<int> CQ=const[0,1,2,3,4,5,6,7,8,9];const List<String> Wn=const["@","=","_","+","-","!","."];typedef dynamic v1<BB>(BB _0);typedef void w1(Process _0);typedef void gc(String _0);class qH extends ProcessResult{final nE;qH(int A,int B,C,D,this.nE):super(A,B,C,D);}class x1{}bool Xn=false;Future<qH> ZF(String D,{List<String> args: const[] ,String workingDirectory,Map<String,String> environment,bool includeParentEnvironment: true,bool runInShell: true,stdin,w1 handler,gc stdoutHandler,gc stderrHandler,gc outputHandler,x1 controller,File outputFile,v1<int> exitHandler,bool inherit: false,bool writeToBuffer: false,bool binary: false,bool capture: true,bool inheritStdin: false,Duration timeout,bool sudo: false})async{if(sudo&&(Platform.isLinux||Platform.isMacOS)&&(await hD("sudo"))!=null){var S=D;D=await hD("sudo");args=new List<String>.from(args);args.insert(0,S);}IOSink B;if(outputFile!=null){if(!(await outputFile.exists())){await outputFile.create(recursive:true);}B=await outputFile.openWrite(mode:FileMode.APPEND);}if(workingDirectory==null){workingDirectory=Directory.current.path;}try {if(Xn){f.kB("Execute '${D} ${args.join(' ')}' in ${workingDirectory}");}Process A=await Process.start(D,args,workingDirectory:workingDirectory,environment:environment,includeParentEnvironment:includeParentEnvironment,runInShell:runInShell);if(controller!=null){controller.aHB=A;controller.bHB.complete();}if(B!=null){B.writeln("[${TS}] == Executing ${D} with arguments ${args} (pid: ${A.pid}) ==");}var H=new StringBuffer();var K=new StringBuffer();var M=new StringBuffer();var I=<int>[] ;var O=<int>[] ;var P=<int>[] ;if(capture){if(!binary){A.stdout.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((C)async{if(writeToBuffer){K.writeln(C);H.writeln(C);}if(stdoutHandler!=null){stdoutHandler(C);}if(outputHandler!=null){outputHandler(C);}if(inherit){Mb.stdout.writeln(C);}if(B!=null){await B.writeln("[${TS}] ${C}");}});A.stderr.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((C)async{if(writeToBuffer){M.writeln(C);H.writeln(C);}if(stderrHandler!=null){stderrHandler(C);}if(outputHandler!=null){outputHandler(C);}if(inherit){Mb.stderr.writeln(C);}if(B!=null){await B.writeln("[${TS}] ${C}");}});}else{A.stdout.listen((G){if(writeToBuffer){I.addAll(G);P.addAll(G);}});A.stderr.listen((G){if(writeToBuffer){I.addAll(G);O.addAll(G);}});}}if(handler!=null){handler(A);}if(stdin!=null){if(stdin is File){stdin=await stdin.openRead();}if(stdin is Stream){stdin.listen(A.stdin.add,onDone:A.stdin.close);}else if(stdin is List){A.stdin.add(stdin);}else{A.stdin.write(stdin);await A.stdin.close();}}else if(inherit&&inheritStdin){Mb.stdin.listen(A.stdin.add,onDone:A.stdin.close);}var Q=false;if(timeout!=null){new Future.delayed(timeout,(){if(!Q){A.kill(ProcessSignal.SIGKILL);}});}var J=await A.exitCode;Q=true;var Z=A.pid;await new Future.delayed(const Duration(milliseconds:5));try {if(B!=null){B.writeln("[${TS}] == Exited with status ${J} ==");await B.flush();await B.close();}}catch (h){}if(exitHandler!=null){exitHandler(J);}return new qH(Z,J,binary?P:K.toString(),binary?O:M.toString(),binary?I:H.toString());}finally {try {if(B!=null){await B.flush();await B.close();}}catch (h){}}}Map<String,String> SS={};Future<String> hD(String B)async{if(SS.containsKey(B)){var A=new File(SS[B]);if(await A.exists()){return A.path;}}if(const["dart","pub"].contains(B)){try {var I=new File(Platform.resolvedExecutable);var J=I.parent;var A=new File(CB(J.path,B));if(await A.exists()){return SS[B]=A.absolute.path;}}catch (Q){}}if(const["openssl"].contains(B)&&Platform.isWindows){var K=<String>[r"C:\OpenSSL-Win32\bin\openssl.exe",r"C:\OpenSSL-Win64\bin\openssl.exe",CB(Directory.current.path,"bin","tools","openssl","openssl.exe")];for(var M in K){var A=new File(M);if(await A.exists()){return SS[B]=A.absolute.path;}}}var O=Platform.environment["PATH"].split(Platform.isWindows?";":":");var G=[B];if(Platform.isWindows){G.addAll(["${B}.exe","${B}.bat"]);}for(var C in O){if(C.startsWith('"')&&C.endsWith('"')){C=C.substring(1,C.length-1);}if(Platform.environment.containsKey("HOME")){var D=Platform.environment["HOME"];if(!D.endsWith("/")){D+= "/";}C=C.replaceAll("~/",D);}var H=new Directory(M5(C)).absolute;if(!(await H.exists())){continue;}for(var P in G){var A=new File("${H.path}/${P}").absolute;if(await A.exists()){SS[B]=A.path;return A.path;}}}return null;}Future<bool> WW()async{if(Platform.isLinux&&await new File("/.dockerinit").exists()){return true;}if(Platform.isLinux&&await new File("/.dockerenv").exists()){return true;}if(const bool.fromEnvironment("dsa.docker",defaultValue:false)){return true;}return false;}Future<bool> y1()async{var A=await hD("node");return A!=null;}Future<bool> z1()async{var A=await hD("ruby");return A!=null;}Future<bool> Yn()async{var A=await hD("python");return A!=null;}Future<bool> A2()async{var A=await hD("virtualenv");return A!=null;}Future<bool> B2()async{var B=await hD("java");if(B!=null){return true;}String A=Platform.environment["JAVA_HOME"];if(A!=null){var C=await C2([CB(A,"bin","java"),CB(A,"bin","java.exe"),CB(A,"java"),CB(A,"java.exe")]);if(C!=null){return true;}}return false;}Future<File> C2(List<String> B)async{for(var C in B){var A=new File(C);if(await A.exists()){return A;}}return null;}Future<bool> Zn(int A,{String host: "0.0.0.0"})async{try {if((Platform.isLinux||Platform.isMacOS)&&await hD("lsof")!=null){var B=await Process.run("lsof",["-n","-i4TCP@${host}:${A}"]);if(B.exitCode==0&&B.stdout.contains("LISTEN")){return false;}else{return true;}}ServerSocket C=await ServerSocket.bind(host,A);await C.close();return true;}catch (D){return false;}}bool XW;Future<bool> an()async{if(XW!=null){return XW;}XW=(Platform.isLinux||Platform.isMacOS)&&(await hD("bsdtar")!=null);return XW;}Future<Directory> D2([String B])async{var C=await dn();if(C>=(u0)*2){return await Directory.systemTemp.createTemp(B);}else{Directory A=new Directory("tmp");if(!(await A.exists())){await A.create(recursive:true);}return await A.createTemp(B);}}Future hc(String K,Directory B,{bool handleSingleDirectory: false,List<String> exclude,bool allowSmartDownload: true,bool allowSmartExtract: true})async{if(allowSmartDownload&&allowSmartExtract&&await an()){var D=await D2("dgserver-fetch");var C=new File(CB(D.path,"file.tmp"));await C.create(recursive:true);var P=await cn.getUrl(Uri.parse(K));var Q=await P.close();IOSink G=C.openWrite();await Q.listen((S){G.add(S);}).asFuture();await G.flush();await G.close();await new Future.delayed(const Duration(milliseconds:250));var M=await hD("bsdtar");if(!(await B.exists())){await B.create(recursive:true);}var H=["-C",B.path,"-xvf${C.path}"];List<String> I=[] ;if(exclude!=null){I.addAll(exclude.map((A)=>"--exclude=${A}"));}H.addAll(I);if(handleSingleDirectory){qH Z=await ZF(M,args:["-tf${C.path}"]..addAll(I),writeToBuffer:true);List<String> O=Z.nE.split("\n");O.removeWhere((A)=>A==null||A.isEmpty||A.endsWith("/"));if(O.every((h)=>h.contains("/"))){H.addAll(["--strip-components","1"]);}}var J=await ZF(M,args:H,writeToBuffer:true);if(J.exitCode!=0){await D.delete(recursive:true);throw new Exception("Failed to extract archive." " (Exit Code: ${J.exitCode})\n${J.nE}");}await D.delete(recursive:true);}else{var p=await ic(K);await bn(p,B,handleSingleDirectory:handleSingleDirectory,exclude:exclude,allowSmartExtract:allowSmartExtract);}}Future bn(List<int> D,Directory C,{bool handleSingleDirectory: false,List<String> exclude,bool allowSmartExtract: true})async{if(allowSmartExtract&&await an()){var K=await hD("bsdtar");if(!(await C.exists())){await C.create(recursive:true);}var G=["-C",C.path,"-xvf-"];List<String> H=[] ;if(exclude!=null){H.addAll(exclude.map((A)=>"--exclude=${A}"));}G.addAll(H);if(handleSingleDirectory){qH O=await ZF(K,args:["-tf-"]..addAll(H),handler:(Process B){B.stdin.add(D);B.stdin.close();},writeToBuffer:true);List<String> M=O.nE.split("\n");M.removeWhere((A)=>A==null||A.isEmpty||A.endsWith("/"));if(M.every((P)=>P.contains("/"))){G.addAll(["--strip-components","1"]);}}var I=await ZF(K,args:G,handler:(Process B){B.stdin.add(D);B.stdin.close();});if(I.exitCode!=0){throw new Exception("Failed to extract archive. (Exit Code: ${I.exitCode})\n" "${I.nE}");}}else{List<CT> J=[] ;if(exclude!=null){for(String A in exclude){J.add(new CT(A,recursive:true));}}var Q=await F2(D).where((QD S){if(J.isEmpty){return true;}else{for(CT Z in J){if(Z.kD(S.name)){return false;}}return true;}});await E2(Q,C,handleSingleDirectory:handleSingleDirectory);}}Future E2(Stream<QD> G,Directory H,{bool handleSingleDirectory: false})async{var C=await G.toList();if(handleSingleDirectory&&C.every((A)=>A.name.split("/").length>=2)){C.forEach((B){B.name=B.name.split("/").skip(1).join("/");});C.removeWhere((D)=>D.name==""||D.name=="/");}for(QD A in C){if(!A.r$||A.name.endsWith("/"))continue;var B=new File(CB(H.path,A.name));if(!(await B.exists())){await B.create(recursive:true);}await B.writeAsBytes(A.oF);}}Stream<QD> F2(List<int> B)async*{var C=new Gl();var D=C.ou(B);for(var A in D.KF){if(A.uO){A.bU();}yield A;}}String G2(){String A;try {A=Platform.resolvedExecutable;}catch (B){try {A=Platform.executable.isNotEmpty?Platform.executable:"dart";}catch (B){A="dart";}}return A;}Future<List<int>> ic(String C,{retry: false,retryCallback(int count)})async{if(C==null||C.isEmpty){return <int>[] ;}int D=0;int B=0;if(retry==true){B=5;}else if(retry is int){B=retry;}G()async{try {var H=await cn.getUrl(Uri.parse(C));var A=await H.close();if(A.isRedirect){A=await A.redirect();}if(A.statusCode!=200){throw new Exception("Failed to fetch url: got status code ${A.statusCode}");}return await A.fold([] ,(List I,List J){return I..addAll(J);});}catch (K){if(B>0&&D<B){D++ ;if(retryCallback!=null){retryCallback(D);}await new Future.delayed(const Duration(milliseconds:250));return await G();}else{rethrow;}}}return await G();}HttpClient cn=new HttpClient()..badCertificateCallback=(A,B,C)=>true;String get TS{return new DateTime.now().toString();}Future<FileSystemEntity> DQ(String A,{bool dir: false})async{var B=await FileSystemEntity.type(A);if(B==FileSystemEntityType.FILE){return new File(A).absolute;}else if(B==FileSystemEntityType.DIRECTORY){return new Directory(A).absolute;}else{if(dir){return new Directory(A).absolute;}else{return new File(A).absolute;}}}Future jc(Directory C,Directory A)async{if(!(await A.exists())){await A.create(recursive:true);}await for(FileSystemEntity B in C.list(recursive:true)){String G=bX(B.path,from:C.path);String H=CB(A.path,G);if(B is File){File D=new File(H);await D.create(recursive:true);await B.copy(D.path);}}}final File H2=new File("/proc/meminfo");int mN;bool kc;Future<int> dn()async{if(mN!=null){return mN;}if(Platform.isMacOS){var C=await Process.run("sysctl",const["-n","hw.memsize"]);mN=int.parse(C.stdout);}else if(Platform.isLinux||Platform.isAndroid){if(kc==null){kc=Platform.isAndroid?false:(await hD("free"))!=null;}if(kc){var C=await Process.run("free",const["-b"]);List<String> D=C.stdout.split("\n");var A=D[1];var G=A.split(" ");G.removeWhere((H)=>H.trim().isEmpty);var I=num.parse(G[1]);mN=I;}else{var D=await H2.readAsLines();var A=D.firstWhere((A){return A.startsWith("MemFree:");});var B=A.replaceAll(" ","").split(":")[1];if(B.endsWith("kB")){B=B.substring(0,B.length-2);}mN=(num.parse(B)*1024).toInt();}}else{mN=await I2("ComputerSystem get TotalPhysicalMemory");}return mN;}Future<int> I2(String A)async{try {var B=await Process.run("wmic",A.split(" "));var C=B.stdout.split("\n").where((String D)=>D.isNotEmpty).skip(1).toList();return int.parse(C[0]);}catch (G){return 0;}}GZipCodec J2=new GZipCodec();Future K2(File A,File B,{bool clearOld: false})async{var G=await hD("gzip");if(!(await B.parent.exists())){await B.parent.create(recursive:true);}if(G!=null){await B.create(recursive:true);var D=await B.openWrite();var C=await ZF(G,stdin:A,handler:(Process H)async{H.stderr.drain();await D.addStream(H.stdout);},capture:false);if(C.exitCode!=0){await D.close();await B.delete();throw new Exception("Failed to GZIP Compress File ${A.path} to ${B.path}");}await new Future.delayed(const Duration(milliseconds:5));await D.close();if(clearOld){if(Platform.isWindows){await A.delete();await A.create(recursive:true);}else{await A.writeAsBytes([] ,flush:true);}}}else{var J=J2.encoder;var I=await A.readAsBytes();var C=J.convert(I);await B.writeAsBytes(C,flush:true);I=null;C=null;if(clearOld){if(Platform.isWindows){await A.delete();await A.create(recursive:true);}else{await A.writeAsBytes([] ,flush:true);}}}}Future<qH> L2(List<String> B,{bool checked: true,bool inherit: false,bool stdin: false})async{var C=<String,String>{};if(Platform.isWindows){C["OPENSSL_CONF"]=CB(Directory.current.path,"bin","tools","openssl","openssl.cfg");}var D=await hD("openssl");if(D==null){throw new Exception("OpenSSL is not installed.");}var A=await ZF(D,args:B,writeToBuffer:true,environment:C,inherit:inherit,inheritStdin:stdin);if(A.exitCode!=0){throw new Exception("Failed to run OpenSSL with arguments ${B}" " (code = ${A.exitCode}):" "\n${A.nE}");}return A;}Future M2(String B,SD A)async{String C=A.gi;if(C==null){return;}String J=await hD("openssl");String K=Platform.version.split(" ").first;pD M=new pD.PDB(K);pD O=new pD.PDB("1.13.0");if(M<O){f.gC("Certificate Generation Skipped: Dart v1.13.0+ is required.");return;}if(J==null){f.gC("Certificate Generation Skipped: OpenSSL is not installed.");return;}String H=CB(B,"server.csr");String P=CB(B,"server.pem");String D=CB(B,"key.pem");f.kB(["Generating SSL Certificate.","  Subject: ${C}"].join("\n"));Directory I=new Directory("certs");if(!(await I.exists())){await I.create(recursive:true);}Future<qH> G(List<String> Q)async{return await L2(Q,checked:true);}await G(["genrsa","-out",D,"4096"]);await G(["req","-new","-key",D,"-sha256","-subj",C,"-out",H]);await G(["req","-x509","-days","365000","-key",D,"-in",H,"-out",P]);A.iG="server.pem";A.VU="key.pem";await A.WH();f.kB("Generated SSL Certificate.");}Future<bool> en(String A){return new Directory(A).exists();}bool get N2=>!Platform.isWindows;bool O2(InternetAddress C,List<int> A){try {var B=fn(C);if(B<A[0]||B>A[1]){return false;}return true;}catch (D){return false;}}List<int> P2(String H){try {List A=H.split('/');InternetAddress D=new InternetAddress(A[0]);int G=fn(D);int B,C;switch (D.type.name){case 'IP_V4':B=32;C=0xFFFFFFFF;break;case 'IP_V6':B=128;C=0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;break;}int I=A.length>1?int.parse(A[1]):B;return [G,G+(C>>I)];}catch (J){return [-1,-1];}}int fn(InternetAddress B){var A=0;return B.rawAddress.reversed.reduce((C,D){A+= 8;return C|= D<<A;});}final bool Kn=(){try {assert(false);return false;}catch (A){return true;}}();Uri Vc(Uri A){if(n!=null&&n.HJ!=null&&n.HJ.isNotEmpty){var B=Uri.parse(n.HJ);A=A.replace(host:B.host,scheme:B.scheme,port:B.port,path:A.path,query:A.hasQuery?A.query:null);return A;}var C="http://${InternetAddress.LOOPBACK_IP_V4.address}:${TD.PW}${A.path}";if(A.query!=null&&A.query.isNotEmpty){C+= "?${A.query}";}return Uri.parse(C);}Z1(String B,A)async{f.kB("Configuration Changed: ${B} => ${A}");if(B=="workers"&&A is int){await VB.vB.j("resizeServerWorkers",A);}else if(B=="port"&&A is int){await VB.vB.j("rebindServerWorkers");}else if(B=="httpsPort"&&A is int){await VB.vB.j("rebindServerWorkers");}else if(B=="enableIPv6"&&A is bool){await VB.vB.j("rebindServerWorkers");}}int Wc;List<Process> QS=[] ;Ln()async{var A=new Directory("logs");if(!(await A.exists())){return;}try {await for(File B in A.list(recursive:true).where((C)=>C is File&&C.path.endsWith(".log"))){var G=await B.stat();if(G.size>=vm){var H=bX(B.path,from:A.path);var I=new DateTime.now();var J=(I.millisecondsSinceEpoch~/1000).toString();var K="${J}.gz";var D=new File("${B.path}.${K}");var M=bX(D.path,from:A.path);f.kB("Archiving large log ${H} to ${M}.");await K2(B,D,clearOld:true);}}}catch (O){}}Map<String,String> UW={};int Xc=0;void Yc(String A){A=A.trim().toUpperCase();if(A=="DEBUG"){A="ALL";}Map<String,RB> C={};for(var B in RB.ge){C[B.name]=B;}var B=C[A];if(B!=null){f.level=B;}}Function VW;c1()async{if(await WW()){return;}var B=Platform.script.toFilePath(windows:Platform.isWindows);var C=aX(B);var A=aX(C);var D=new File(CB(A,"bin","daemon.dart"));if(await D.exists()){Directory.current=new Directory(A);}}Timer Zc;List<Function> ac=[] ;mC eB;xm(XM A)async{return Lc(()=>L1(A));}L1(XM fD)async{Jc();wB.Ei();wB.Qa.listen((H){f.IN(H.level,H.message,H.error,H.stackTrace);});if((await dn())>(600*1024*1024)){TQ.y3();}f.kB("Starting Broker");var xC=fD.get("logLevel");if(xC is String){Yc(xC);zS(xC);}var gD=await HttpServer.bind(InternetAddress.LOOPBACK_IP_V4.address,0);var tB=gD.port;sH G;mC B;VB.vB=B=await fD.init(methods:{"getBrokerPort":(Z)=>tB,"addLink":(J)=>KM.EQ.KU(J[0],J[1],J[2],J[3],J[5],J[4]),"removeLink":(A){KM.EQ.mG(A);if(G!=null&&G.ZH!=null){G.ZH.dV.remove(A);}},"setLinkState":(J)=>KM.EQ.sD(J[0],J[1]),"getUpstreamNodes":(Z)=>TD.JM.lB.dE.Zv(),"updateLinkConfig":(Z)=>KM.EQ.yBB(Z[0],Z[1]),"setLinkConfig":(List J)async{await B.j("setLinkConfig",J);},"updateLicenseData":(String xF){return CG.nc.Mw(xF);},"getTrustedToken":(String A){return G.ZH.e_(A,G).token;},"addUser":(m M){pN I=G.yB("/sys/users");I.LI(M);},"addOrUpdateUser":(m M){pN I=G.yB("/sys/users");I.Wu(M);},"syncUsers":(List<m> dB)async{pN I=G.yB("/sys/users");List<m> EE=I.uE.where((O)=>!dB.any((TF)=>TF.username==O.username)).toList();if(EE!=null){EE.forEach((M)=>I.nG(M.username));}if(dB!=null){dB.forEach((m M){if(M!=null){I.Wu(M);}});await G.KBB(dB);}},"removeUser":(String Q){pN I=G.yB("/sys/users");I.nG(Q);},"clearUsers":(Z){pN I=G.yB("/sys/users");for(var O in I.R.keys.toList()){if(O=="createUser"){continue;}I.nG(O);}},"triggerRequestCounter":(Z){sH.sn++ ;sH.WS.v(sH.sn);},"setServerConfig":(SD mD){n=mD;TD.JM.PH=mD;}});CG.oc=await B.j("getProductId");TD.QW=(HttpRequest D,[m sB])async{var PB=D.uri.path;if(D.method=="HEAD"||D.method=="OPTIONS"){var TB=D.response;TB.headers.set("Access-Control-Allow-Methods","POST, OPTIONS, GET");TB.headers.set("Access-Control-Allow-Headers","Content-Type");String UB=D.headers.value("origin");if(D.headers.value("x-proxy-origin")!=null){UB=D.headers.value("x-proxy-origin");}if(UB==null){UB="*";}TB.headers.set('Access-Control-Allow-Origin',UB);TB.close();return;}if(D.headers.value("X-Proxy-Origin")!=null){D.response.headers.set("Access-Control-Allow-Origin",D.headers.value("X-Proxy-Origin"));D.response.headers.set("Access-Control-Allow-Methods","POST, OPTIONS, GET");D.response.headers.set("Access-Control-Allow-Headers","Content-Type");}try {if(PB=="/conn"){await TD.JM.rv(D,sB);}else if(PB=="/ws"){await TD.JM.oi(D,sB);}else if(PB.startsWith("/conn/")){await TD.JM.rv(D,sB);}else if(PB.startsWith("/icon/")){gK.Rn(D);}else{gK.Rn(D);}}catch (H){try {if(H is int){rS(D,H);}else{rS(D);}D.response.close();}catch (WJ){}}};KW.KS=await B.j("getVerificationUserToken");gD.listen(TD.QW);SD C=await B.j("getServerConfig");sH.un=C;n=C;fS KC;var h=await B.j("getCurrentBuild");if(h>=900000000000000000000||h==-1){h="unknown";}else{h=h.toString();}sH.rn=h;pS GE;if(C.Qk=="simple"){GE=new He('storage');}G=new sH(C.OV,C.OZ,C.defaultPermission,C.downstreamName,GE);B.LB("setLinkEnabled",(A)async{try {G.DB("/sys/links/${A}/enabled",false).v(true);}catch (H){}});Bd.So=(A)async{await B.j("restartLink",A);};Gd.Hd=(Q,sG,TC)async{return await B.j("createUser",[Q,sG,TC]);};hW.Xo=(m M)async{await B.j("editUser",M);};Ed.Zo=(String rG,String wG)async{await B.j("renameUser",[rG,wG]);};Fd.bo=(Q)async{return await B.j("removeUser",Q);};Dd.Wo=(Q,TC)async{return await B.j("changePassword",[Q,TC]);};AD.Jo=(String EB,S)async{var P=new SD();var p=new Map.from(C.map);p[EB]=S;P.load(p);await P.WH();await B.j("setServerConfig",P);await Z1(EB,S);};HQ.iW=(String EB,S)async{var P=new SD();var p=new Map.from(C.map);P.load(p);if(S==null){P.TK.remove(EB);}else{P.TK[EB]=S;}await P.WH();};YS.Lo=(A)async{await B.j("enableLink",A);};YS.Mo=(A)async{await B.j("disableLink",A);};Ad.Ro=(A)async{await B.j("stopLink",A);};fW.wc=(A)async{await B.j("startLink",A);};qc.vn=()async{await B.j("scanForLinks");};xc.Ko=(String vG,String A,dynamic S)async{await B.j("setLinkConfig",[vG,A,S]);};sc.wn=(String K,String A)async{return await B.j("installLinkFromGit",[K,A]);};LM.rc=()async{return await B.j("updateServer",[] );};gW.Oo=(String A)async{return await B.j("updateLinkGit",A);};GQ.yc=(String A)async{return await B.j("updateLinkRepository",A);};eW.Io=(String A,String K)async{return await B.j("updateLinkZip",[A,K]);};uc.Fo=(String K,String A)async{return await B.j("installLinkFromZip",[K,A]);};dW.zn=(String A,String uG)async{List<Map<String,dynamic>> NE;try {NE=await TW();}catch (H){return [false,"Failed to fetch link repository information." " Please try again later. Error: ${H}"];}var K=NE.firstWhere((O)=>O["displayName"]==uG,orElse:()=>{})["zip"];return await B.j("installLinkFromZip",[K,A]);};vc.Go=()async{await B.j("restart");};dW.Ao=()async{try {var tG=await TW();return "enum["+tG.map((O){return O["displayName"];}).join(",")+"]";}catch (H){return "enum[]";}};zc.Qo=(String A)async{await B.j("uninstallLink",A);};TD.JM=new KW(G,G);TD.JM.uR=C.uR;await G.CAB();if(C.LG!=null&&C.LG.isNotEmpty){TD.Rc=new dd(["--broker=${C.LG}"],C.TU!=null?C.TU:"broker-",nodeProvider:G,enableHttp:false);TD.Rc.init();TD.Rc.connect();}G.dE.YI=(p)async{await B.j("updateUpstreamNodes",p);};if(C.WL||Kn){wB.level=RB.Eq;}if(C.XZ){var xG=await Y1();var FE=C.iG!=""&&C.iG!=null&&C.wM!=null;var yF=FE?"https":"http";var tB=FE?C.VI:C.port;var K=C.SU==null?"${yF}://${xG}:${tB}/conn":C.SU;f.kB("Starting Broadcast of Broker at ${K}");KC=new fS();try {await KC.init(true);KC.RBB.listen((gS D){D.QBB(K);});}catch (H){f.gC("Failed to start broker broadcast service."+" Are you running more than one broker on this machine?");}}G.dE.DAB(C.dE);TD.JM.PH=n;await B.j("ready");}Future<int> Oc()async{var B=new File("BUILD_NUMBER");if(!(await B.exists())){return 900000000000000000000;}else{try {var A=await B.readAsString();A=A.trim();return int.parse(A);}catch (C){return -1;}}}Future<bool> IM(HttpRequest M,String C,bool O)async{var A=await QE(M);if(A!=null&&A.wC){return true;}C=C.trim();if(C.startsWith("/")){C=C.substring(1);}var H=C.split("/");if(H.length<=1){return false;}if(H[0]=="usr"){var P=H[1];if(P!=A.username){return false;}return true;}if(H[0]=="proj"){var I=H[1];var Q=CB("files","proj",I,"_proj.json");var K=new File(Q);if(!(await K.exists())){return false;}var D=yE.convert(await K.readAsString());if(A.IB!=null&&A.IB["denyProjects"] is List){List J=A.IB["denyProjects"];if(J.contains(I)){return false;}}if(A.IB!=null&&A.IB["allowProjects"] is List){List J=A.IB["allowProjects"];if(!J.contains(I)){return false;}}if(D["owner"]!=null&&D["owner"]==A.username){return true;}if(D["owners"] is List){List S=D["owners"];if(S.contains(A.username)){return true;}}List<String> G=D["canRead"];List<String> B=D["canWrite"];if(G==null){G=const[] ;}if(B==null){B=const[] ;}if(O){if(B.contains(A.username)||B.contains("all")||B.contains("*")||B.contains("guest")){return true;}else{return false;}}else{if(G.contains(A.username)||G.contains("all")||G.contains("*")||G.contains("guest")){return true;}else{if(B.contains(A.username)||B.contains("all")||B.contains("*")||B.contains("guest")){return true;}else{return false;}}}}return false;}aJ(HttpRequest A,{bool requireSuperuser: false,String user,bool useRootRedirect: false})async{if((nD()==null||nD().username==null||nD().username=="guest")){var C=A.uri.toString();Uri B;if(useRootRedirect&&n.lU!=null){B=Uri.parse(n.lU);}else{if(C!="/"){B=Uri.parse("/login?target=${Uri.encodeComponent(C)}");}else{B=Uc.U1;}}A.response.redirect(B);return false;}if(requireSuperuser){var D=await QE(A);if(D.wC||(user!=null&&D.username==user)){return true;}else{await dJ(A,A.response);return null;}}return true;}String Mc;H1(){if(Mc!=null){return Mc;}else{return Mc=dK.convert(const{"indexUrl":"index.html","viewerUrl":"viewer.html","dataUrl":"http","websocketUrl":"ws","connUrl":"conn","userUrl":"user","assetUrl":"file","sessionUrl":"session","dbUrl":"db","logoutUrl":"logout","loginUrl":"login"});}}Lc(A){if(Kn){return jD.n5((){return A();},onError:(B,jD C){return Zone.current.parent.handleUncaughtError(B,C.oa);});}else{return A();}}E1(HttpRequest A)async{try {var KC=Uri.decodeComponent(A.uri.path).substring("/file".length);if(KC.isNotEmpty&&KC.startsWith("/")){var G=KC.substring(1);AG("File Service","Get File ${G}");if(!n.gZ&&!(await IM(A,G,false))){await dJ(A,A.response);return null;}var C=new File(gq(["files"]..addAll(G.split("/"))));if(!(await C.exists())){await RS(A,A.response);return null;}return C;}var H=A.uri.queryParameters["op"];var B=A.uri.queryParameters["path"];if(H==null){A.response.statusCode=HttpStatus.BAD_REQUEST;return "File Operation Not Specified.";}if(H.endsWith("Proj")){return Kc(A);}var sG=!(const["get","list","info","watch"]).contains(H);if(B!=null&&!n.gZ&&!(await IM(A,B,sG))){await dJ(A,A.response);return null;}if(H=="get"){AG("File Service","Get File ${B}");return new File(CB("files",B));}else if(H=="list"){AG("File Service","List ${B}");var J=new Directory(CB("files",B));var M=await IM(A,B,true);if(await J.exists()){var Q=[] ;var tG=await J.list(recursive:false).toList();var GE=<File>[] ;var EE=<Directory>[] ;for(var PB in tG){var D=mJ(PB.path);if(D.startsWith(".")||D=="_proj.json")continue;if(PB is Directory){EE.add(PB);}else{GE.add(PB);}}for(var vG in EE){var D=mJ(vG.path);Q.add({"type":"folder","path":"${B}/${D}","name":D,"writable":M,"icon":"/assets/icons/folder.png"});}var p=[] ;if(A.uri.queryParameters.containsKey("filters")){p=A.uri.queryParameters["filters"].split(",");}if(A.uri.queryParameters.containsKey("filter")){p=A.uri.queryParameters["filter"].split(",");}fileLoop:for(var C in GE){var D=mJ(C.path);if(p.isNotEmpty){for(var rG in p){if(!D.contains(rG)){continue fileLoop;}}}var K=await C.stat();var TB=Nn(D);Q.add({"type":"file","path":"${B}/${D}","name":D,"icon":TB,"size":K.size,"created":K.changed.millisecondsSinceEpoch,"modified":K.modified.millisecondsSinceEpoch,"writable":M});}return Q;}else{A.response.statusCode=HttpStatus.NOT_FOUND;return "Directory Not Found";}}else if(H=="info"){AG("File Service","Stat File ${B}");var G=CB("files",B);var fD=await FileSystemEntity.type(G);if(fD==FileSystemEntityType.DIRECTORY){var J=new Directory(G);var D=mJ(J.path);var M=await IM(A,B,true);return {"type":"folder","path":B,"name":D,"writable":M,"icon":"/assets/icons/folder.png"};}else if(fD==FileSystemEntityType.FILE){var C=new File(G);var D=mJ(C.path);var K=await C.stat();var M=await IM(A,B,true);var TB=Nn(D);return {"type":"file","path":B,"name":D,"icon":TB,"size":K.size,"created":K.changed.millisecondsSinceEpoch,"modified":K.modified.millisecondsSinceEpoch,"writable":M};}else{A.response.statusCode=HttpStatus.NOT_FOUND;return "File Not Found";}}else if(H=="upload"){AG("File Service","Upload ${B}");var C=new File(CB("files",B));if(!(await C.exists())){await C.create(recursive:true);}else{if(A.uri.queryParameters["exists"]=="fail"){A.response.statusCode=HttpStatus.CONFLICT;return "file exists";}}IOSink UB;try {UB=await C.openWrite();var gD=0;await A.listen((mD){gD+= mD.length;UB.add(mD);}).asFuture();return gD.toString();}finally {try {await UB.close();}catch (FE){}}A.response.statusCode=HttpStatus.BAD_REQUEST;return "Failed.";}else if(H=="delete"){AG("File Service","Delete ${B}");var G=CB("files",B);var I=await DQ(G);if(await I.exists()){await I.delete(recursive:true);}}else if(H=="mkdir"){AG("File Service","Create Directory ${B}");var J=new Directory(CB("files",B));if(await J.exists()){A.response.statusCode=HttpStatus.CONFLICT;return "Directory already exists.";}await J.create(recursive:true);}else if(H=="rename"){var G=CB("files",B);var I=await DQ(G);var D=A.uri.queryParameters["name"];AG("File Service","Rename ${B} -> ${D}");var yF=CB("files",aX(B),D);await I.rename(yF);}else if(H=="move"){var S=A.uri.queryParameters["dest"];AG("File Service","Move ${B} -> ${S}");var EB=CB("files",S);var G=CB("files",B);var I=await DQ(G);await I.rename(EB);}else if(H=="copy"){var G=CB("files",B);var I=await DQ(G);var S=A.uri.queryParameters["dest"];AG("File Service","Copy ${B} -> ${S}");var EB=CB("files",S);var O=I is File?new File(EB):new Directory(EB);if(I is Directory&&O is Directory){Directory wG=O;await O.create(recursive:true);await (wG.list(recursive:true).asyncMap((File sB)async{if(sB is Directory){return false;}var AM=sB.path.replaceAll(I.path,O.path);var C=new File(AM);if(!(await C.exists())){await C.create(recursive:true);}var P=await sB.openRead();var h=await C.openWrite();await h.addStream(P);await h.close();return true;}));}else{await O.create(recursive:true);var P=await I.openRead();var h=await O.openWrite();await h.addStream(P);await h.close();}}else if(H=="uploadLicense"){AG("File Service","Upload License");var xF=await YM.ZM(A);var Z=xF.nF;var C=gI.Fn;var dB=Z is String?LS.convert(Z):Z;if(A.uri.queryParameters.containsKey("crc")){var TC=A.uri.queryParameters["crc"];var TF=v0.y0(dB);if(TC!=TF){A.response.statusCode=HttpStatus.NOT_ACCEPTABLE;return "Got checksum ${TF}, but expected ${TC}.";}}var tB=Z is String?Z:eK.convert(dB);var Q=await VB.vB.j("updateLicenseData",tB);if(Q==true){await C.writeAsBytes(dB);A.response.statusCode=HttpStatus.ACCEPTED;var uG=(await C.stat()).size;return uG.toString();}else{A.response.statusCode=HttpStatus.NOT_ACCEPTABLE;return "Invalid License";}}else if(H=="watch"){var G=CB("files",B);var I=await DQ(G);var xC=await WebSocketTransformer.upgrade(A);var P=I.watch(recursive:true);var xG=P.listen((FileSystemEvent NE){var WJ={"type":e1[NE.type],"path":NE.path};xC.add(dK.convert(WJ));});xC.done.then((WN){xG.cancel();});return null;}else{A.response.statusCode=HttpStatus.SERVICE_UNAVAILABLE;return "Unknown Operation: ${H}";}return "";}catch (FE){A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;var tB=FE.toString();return tB;}}const Map<int,String> e1=const{FileSystemEvent.CREATE:"create",FileSystemEvent.MODIFY:"modify",FileSystemEvent.DELETE:"delete",FileSystemEvent.MOVE:"move"};String Nn(String C){var A="/assets/icons/document.png";var B=xe(C);if(const[".jpg",".jpeg",".gif",".webp",".tiff",".png",".bmp",".svg"].contains(B)){A="/assets/icons/image.png";}else if(const[".js",".json",".dart",".java",".sh",".bash",".hs",".cs",".c",".h",".hpp",".cpp",".cc",".groovy",".d",".php",".jsp",".lua",".bat",".swift",".css",".xml"].contains(B)){A="/assets/icons/document-code.png";}else if(const[".zip",".tgz",".tar.gz",".gz",".tar",".bz2",".tar.bz2",".xz"].contains(B)){A="/assets/icons/document-zipper.png";}else if(const[".txt",".csv"].contains(B)){A="/assets/icons/document-text.png";}else if(const[".html",".xhtml"].contains(B)){A="/assets/icons/document-globe.png";}else if(const[".dg5",".dgs",".df5"].contains(B)){A="/assets/icons/blue-document-code.png";}return A;}class iN{static eI OW;static Gc Cn;static final m N1=new m("guest",false);}class TD{static KW JM;static dd Rc;static String NS;static int PW;static Function QW;}class gI{static final File O1=new File("www/update.html");static final File Fn=new File("www/dglicense.json");static final File P1=new File("www/favicon.ico");static final File Sc=new File("www/dglux5/REVISION");static final File Q1=new File(CB("www","login.html"));static final File S1=new File(CB("www","change_password.html"));static final File Gn=new File(CB("www","dglux5","index.html"));}class Uc{static final Uri Hn=Uri.parse("/");static final Uri U1=Uri.parse("/login");}class VB{static mC vB;static String SW;static List<cJ> pH=[] ;}C1(String D,B)async{if(n.aR!=null&&n.aR is Map&&n.aR.containsKey(D)){if(B is Map){B=[dK.convert(B)];}for(var C in n.aR[D]){List<String> A;if(C is List){A=C;}else{A=C.toString().split(" ");}var G=A.removeAt(0);A.addAll(B);ZF(G,args:A,inherit:true);}}}Map<String,Function> OC={};An(String B,{bool shouldStartNow: false,bool skipDuplicates: false})async{var A=new Directory(B);if(await A.exists()){await for(Directory C in A.list().where((D)=>D is Directory)){await W1(C.absolute.path,shouldStartNow,skipDuplicates);}}}RW({bool shouldStartNow: false,bool skipDuplicates: false})async{await An("links",shouldStartNow:shouldStartNow,skipDuplicates:skipDuplicates);await An("dslinks",shouldStartNow:shouldStartNow,skipDuplicates:skipDuplicates);}List<String> Tc=[] ;Future<oD> R1(String B,String C)async{var A=await V2(B,C);if(A.DE){await RW(skipDuplicates:true);}return A;}Future<oD> T1(String B,String C)async{var A=await W2(B,C);if(A.DE){await RW(skipDuplicates:true);}return A;}W1(String G,[bool WP=false,bool XP=false])async{var C=mJ(G);var P=new File("logs/${C}.log");var ZP=new Directory("${G}/.git");var xC=await hD("git");var bP=await ZP.exists();var TF=bP&&xC!=null;var fD=TF?"git":"none";if(TF){qH K=await ZF(xC,args:["pull"],workingDirectory:G,outputFile:P);if(K.exitCode!=0){f.gC("Tried to run 'git pull' in '${G}', but it failed.");}}UB(String cP)async{if(!(await P.exists())){await P.create(recursive:true);}await P.writeAsString("[${TS}] ${cP}\n",mode:FileMode.APPEND);}var KC=new File("${G}/dslink.json");var O=new Directory(G).absolute;if(!(await KC.exists())){return;}Map h;try {h=yE.convert(await KC.readAsString());}catch (H){f.oC("Error while loading dslink.json at ${KC.path}: ${H}");return;}var A=new On(C);A.aB=new vS.zCB(h);try {A.aB.Ay();}catch (H){f.oC("Error while verifying dslink.json at ${KC.path}: ${H}");return;}try {if(PS!=null&&fD=="none"){var VP=A.aB.name;if(PS.any((Q)=>Q["name"]==VP)){fD="repository";}}}catch (H){}if(Tc.contains(C)){if(!XP){f.oC("Error while loading '${C}': duplicate link found! (path: ${G})");}return;}Tc.add(C);if(!(await P.exists())){await P.create(recursive:true);}if(eB!=null){await eB.j("addLink",[C,A.aB.description,A.aB.version,fD,!n.XL.contains(C),A.aB.L]);}await A.sD("stopped");Process S;nN Z;Function PB;Function gD;gD=OC[C]=(String I,[List xF])async{AG("Link Commander","DSLink ${C} received command '${I}'");if(I=="restart"){if(!A.PJ){await gD("start");}else{A.rO=YF.bc;await gD("stop");}}else if(I=="start"){var eP=n.XL.remove(C);if(eP){await eB.j("setLinkEnabled",C);await n.WH();}if(!A.PJ&&PB!=null){PB();}}else if(I=="setLinkConfig"){String fP=xF[0];dynamic gP=xF[1];var TB=n.vU;if(TB==null){TB={};}if(TB[C]==null)TB[C]={};TB[C][fP]=gP;await n.WH();}else if(I=="stop"){if(A.rO!=YF.bc){A.rO=YF.Pn;}if(S!=null){if(Platform.isWindows){await bJ(S.pid);}else{S.kill();}}else if(Z!=null){await Z.ja(O.path).timeout(const Duration(seconds:5),onTimeout:(){});}else if(h["served"]==true){await jN.j("removeLinkStatic",[CB(O.path,A.aB.JN)]);await A.sD("stopped");A.PJ=false;}}else if(I=="enable"){n.XL.remove(C);await n.WH();}else if(I=="disable"){if(!n.XL.contains(C)){n.XL.add(C);await n.WH();}}else if(I=="update-git"){qH K=await ZF(xC,args:["pull"],workingDirectory:G,outputFile:P);if(K.exitCode!=0){return "Failed.";}else{return "Success!";}}else if(I=="uninstall"){await OC[C]("stop");var wG=0;while(A.PJ){await new Future.delayed(const Duration(milliseconds:25));wG++ ;if(wG==320){throw new Exception("Failed to uninstall: Can't stop link.");}}await eB.j("removeLink",C);Tc.remove(C);OC.remove(C);var WJ=new Directory(G);if(await WJ.exists()){await WJ.delete(recursive:true);}f.kB("DSLink '${C}' has been uninstalled.");}else if(I=="update-repo"){try {var GE=h["name"];var aP=await TW();var p=aP.firstWhere((Q)=>Q["name"]==GE,orElse:()=>null);if(p==null){return "Error: ${GE} was not found in the repository.";}var EE=new File(CB(O.path,".rev"));String tB="UNKNOWN";if(await EE.exists()){tB=await EE.readAsString();tB=tB.trim();}if(p["revision"]!=null&&p["revision"]==tB){return "Link is up-to-date.";}var jP=p["zip"];if(p["zip"]==null){return "Error: ${GE} was found in the repository," "but no ZIP file was specified.";}await OC[C]("stop");var K=await gn(O,jP,p);if(K.contains("Success!")&&p["revision"]!=null){await EE.writeAsString(p["revision"]);}return K;}catch (H){return "Error: ${H.toString()}";}}else if(I=="getLinkDirectory"){return O;}else if(I=="getLinkJson"){return h;}};var dB=h["useRuntimeManager"]!=null?h["useRuntimeManager"]:true;dB=dB&&!Platform.isWindows;if(dB&&A.aB.IF!=null&&A.aB.IF.isNotEmpty&&A.aB.IF.keys.contains("dart")&&(n.Hb||n.ik)){Z=await T2(QS,n.Ni);}if(dB&&((A.aB.IF!=null&&A.aB.IF.isNotEmpty&&A.aB.IF.keys.contains("java"))||(A.aB.name.startsWith("dslink-java-")||A.aB.name.startsWith("dslink-scala-"))&&A.aB.L.containsKey("handler_class")&&A.aB.L.containsKey("name")&&A.aB.L.containsKey("log")&&(n.Hb||n.jk))){String hP=CB("bin","runtimes","java.jar");if(await new File(hP).exists()){Z=await S2(QS,n.yi);}}PB=([D()])async{if(n.XL.contains(C)){if(D!=null){D();}return null;}if(A.aB.iU!=null&&A.aB.iU.isNotEmpty){var sB=A.aB.iU;if(A.aB.IF!=null&&A.aB.IF.isNotEmpty&&A.aB.IF.keys.first=="dart"&&sB.every((Q)=>Q.startsWith("pub "))){var WN=new File(CB(G,"pubspec.yaml"));if(!(await WN.exists())){sB=[] ;}}if(A.aB.IF!=null&&A.aB.IF.isNotEmpty&&A.aB.name.startsWith("dslink-python-")&&await Yn()&&await A2()&&A.aB.IF.keys.first=="python"){var AM=new Directory(CB(G,"packages"));if(!(await AM.exists())){var kP=await hD("virtualenv");await ZF(kP,args:["--system-site-packages","packages"],workingDirectory:G);}}if(sB.isNotEmpty){await A.sD("getting dependencies");f.kB("Fetching Dependencies for DSLink '${C}'");for(var I in sB){var sG=I.split(" ");var B=sG[0];if(!ye(B)&&!B.contains("/")&&!B.contains("\\")){var uG=await hD(B);if(A.aB.name.startsWith("dslink-python-")&&(await en(CB(G,"packages")))&&(B=="python"||B=="easy_install"||B=="pip")){if(Platform.isWindows){B=CB(G,"packages","Scripts",B+".exe");}else{B=CB(G,"packages","bin",B);}}else if(uG!=null){B=uG;}}var M=sG.skip(1).toList();qH K;try {K=await ZF(B,args:M,outputFile:P,workingDirectory:G,environment:{"DSA_LINK_NAME":C},handler:(Process iP){S=iP;},runInShell:false);}catch (H){f.oC("Error while fetching dependencies for link '${C}':\n"+"Encountered process error while running '${B}'"+" with arguments ${M}: ${H}");await A.sD("stopped");if(D!=null){D();}return null;}S=null;if(K.exitCode!=0){f.oC("Error while fetching dependencies for link '${C}':\n" "Process '${B}' with arugments ${M} exited"+" with status ${K.exitCode}");await A.sD("stopped");if(D!=null){D();}return null;}}f.kB("Fetched Dependencies for DSLink '${C}'");await A.sD("stopped");}}if(A.aB.name.startsWith("dslink-java-")){if(!(await B2())){await A.sD("install java");await UB("Java is not installed. Please install Java."+" See https://www.java.com/ for more information.");if(D!=null){D();}return null;}}if(A.aB.name.startsWith("dslink-javascript-")){if(!(await y1())){await A.sD("install nodejs");await UB("NodeJS is not installed. Please install NodeJS."+" See https://nodejs.org/ for more information.");if(D!=null){D();}return null;}}if(A.aB.name.startsWith("dslink-ruby-")){if(!(await z1())){await A.sD("install ruby");await UB("Ruby is not installed. Please install Ruby."+" See https://www.ruby-lang.org/en/documentation/installation/"+" for more information.");if(D!=null){D();}return null;}}if(A.aB.name.startsWith("dslink-python-")){if(!(await Yn())){await A.sD("install python");await UB("Python is not installed."+" Please install Python via Get DSA or https://www.python.org/downloads/");if(D!=null){D();}return null;}}await A.sD("starting");String B;var M=[] ;var J={};A.aB.L.keys.where((rG)=>A.aB.L[rG]["value"]!=null||A.aB.L[rG]["default"]!=null).forEach((Q){J[Q]=A.aB.L[Q]["value"]==null?A.aB.L[Q]["default"]:A.aB.L[Q]["value"];});J.addAll(n.vU.containsKey(C)?n.vU[C]:{});if(A.aB.L.containsKey("broker")&&!J.containsKey("broker")){J["broker"]=Vc(Uri.parse("/conn")).toString();}if(dB&&Z!=null){J["log-file"]=P.absolute.path;}if(A.aB.L.containsKey("token")&&!J.containsKey("token")&&!(n!=null&&n.HJ!=null&&n.HJ.isNotEmpty)){J["token"]=await eB.j("getTrustedToken",C);}for(var FE in A.aB.L.keys){var yF=A.aB.L[FE];if(yF["required"]==true&&yF["value"]==null&&!J.containsKey(FE)){f.oC("DSLink '${C}' requires the config '${FE}' to be specified.");if(D!=null){D();}return null;}}var lP=h["served"]==true;if(lP){var G=J["path"];if(G==null||G is!String||G.isEmpty){G="/links/${C}";}var dP=CB(O.path,A.aB.JN);await jN.j("addLinkStatic",[dP,G]);await A.sD("started");A.PJ=true;if(D!=null){D();}}else{if(A.aB.IF==null||A.aB.IF.isEmpty){B=A.aB.JN;if((B.endsWith(".bat")||B.endsWith(".exe"))&&!Platform.isWindows){B=B.substring(0,B.length-4);}else if(Platform.isWindows){if(!B.endsWith(".bat")){B="${B}.bat";}}if(Platform.isWindows){B=B.replaceAll("/","\\");}if(!ye(B)){B=CB(O.path,B);}}else{B=A.aB.IF.keys.first;if(B=="dart"){try {B=Platform.resolvedExecutable;}catch (H){B=Platform.executable;}if(B==null||B.isEmpty){B=await hD("dart");}if(B==null){B=Platform.executable;}if(B==null&&Platform.isAndroid){B="/data/local/tmp/dart";}if(n.xO!=null&&n.xO["DART_VM_FLAGS"] is String){M.addAll(n.xO["DART_VM_FLAGS"].split(" "));}}if(B=="java"){B=await hD("java");if(B==null){B="java";}M.add("-jar");}if(B=="python"){if(await en(CB(G,"packages"))){if(Platform.isWindows){B=CB(O.path,"packages","Scripts","python.exe");}else{B=CB(O.path,"packages","bin","python");}}else{B=await hD("python");}if(B==null){B="python";await UB("Warning: Python was not found.");}}M.add(A.aB.JN);}eB.j("updateLinkConfig",[C,J]);for(var EB in J.keys){if(!A.aB.L.containsKey(EB)&&EB!="log-file"){f.gC("Warning: DSLink '${C}' was configured to"+" have '${EB}' be '${J[EB]}', but that option was not"+" found for this link.");}if(EB=="handler_class"){continue;}M.addAll(["--${EB}","${J[EB]}"]);}vG()async{if(Z!=null){var YP=await Z.Pk(O.path,A.aB.JN,J);if(!YP){A.sD("errored");if(D!=null){D();D=null;}A.PJ=false;return null;}A.PJ=true;A.sD("started");f.kB("DSLink '${C}' started.");if(D!=null){D();D=null;}await Z.FV(O.path).first;if(D!=null){D();D=null;}A.PJ=false;return null;}try {var NE={"DSA_LINK_NAME":C};if(n.xO is Map){NE.addAll(n.xO);}if(A.aB.w$["sudo"]==true&&N2){M.insert(0,B);B="sudo";}var K=await ZF(B,args:M,outputFile:P,workingDirectory:G,handler:(Process TC){if(D!=null){D();}f.kB("DSLink '${C}' started.");A.PJ=true;A.sD("started");S=TC;Qc(TC.pid,C);QS.add(TC);},environment:NE,runInShell:false);if(K.exitCode==126){throw new ProcessException(B,M,"Permission denied");}K=null;}catch (H,xG){if(H is ProcessException){if((Platform.isLinux||Platform.isMacOS)&&B!="bash"){M.insert(0,B);B="bash";return await vG();}f.oC("DSLink '${C}' exception while starting",H,xG);f.gC("DSLink '${C}' errored during startup.");QS.remove(S);A.PJ=false;await A.sD("errored");A.rO=YF.cc;return null;}f.oC("DSLink '${C}' exception while starting",H,xG);}}await vG();try {if(S!=null){await bJ(S.pid);}}catch (H){}QS.remove(S);A.PJ=false;var mD=false;var tG=false;A.sD("stopped");if(A.rO==YF.bc){f.kB("DSLink '${C}' is now restarting.");mD=true;}else if(A.rO==YF.Pn){f.kB("DSLink '${C}' is now stopped.");}else{f.kB("DSLink '${C}' suddenly stopped.");mD=true;tG=true;}A.rO=YF.cc;if(tG){await new Future.delayed(const Duration(seconds:1));}if(mD){await PB();}}};if(WP){PB();}else{ac.add(PB);}}class On{final String name;On(this.name);bool PJ=false;YF rO=YF.cc;vS aB;sD(String A)async{if(eB!=null){await eB.j("setLinkState",[name,A]);}}}class YF{static const YF Pn=const YF(0);static const YF bc=const YF(1);static const YF cc=const YF(3);final int id;const YF(this.id);}AG(String A,String B){if(n!=null&&n.FK!=null&&n.FK.contains(A)){if(f!=null){f.kB("[${A}] ${B}");}else{print("[${A}] ${B}");}}}LW(HttpRequest A,{bool invalid: false})async{if(A.method=="POST"&&invalid!=true){var p=await YM.ZM(A);var B=p.nF;if(B==null||B["username"]==null){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Invalid Request";}var H=B["username"];var EB=B["remember"]!=null;JW C=await VB.vB.j("getTwoFactorAuth");if(B!=null&&C!=null&&C.Bk&&C.Nv.every((J)=>B.containsKey(J))){bool O=await C.Jx(B,A);if(!O){return await LW(A,invalid:true);}}else{var K=B["password"];if(K is String&&B["b64"]=="yes"){K=eK.convert(VG.wP(K));}var O=await VB.vB.j("authenticate",[H,K]);if(!O){return await LW(A,invalid:true);}if(C!=null){var P=await C.Lv(H,B,A);if(C.Bk){return new lN(P,ContentType.HTML);}else{if(!P){return await LW(A,invalid:true);}}}}await OS(H);if(EB){var Q=await VB.vB.j("createRememberToken",H);A.response.cookies.removeWhere((S)=>S.name=="DGTOKEN"||S.name=="DGUSER");A.response.cookies.add(new Cookie("DGTOKEN",Q));A.response.cookies.add(new Cookie("DGUSER",H));A.response.headers.set("X-DG-Token","${H} ${Q}");}var D=A.uri.queryParameters["target"];if(D==null){var I=await QE(A);if(I!=null&&I.IB!=null&&I.IB["rootUrl"] is String){D=I.IB["rootUrl"];}else{D=n.XI;}if(I!=null&&I.IB["forcePasswordChange"]==true){D="/change_password";}}if(B["machine"]==null){return A.response.redirect(Uri.parse(D));}else{A.response.writeln("Success.");return A.response.close();}}else{if(n.TZ=="open"){await OS("dgUser");String D=n.XI;return A.response.redirect(Uri.parse(D));}var J=gI.Sc;var G=await gI.Q1.readAsString();String M="4200";if(await J.exists()){M=(await J.readAsString()).trim();if(M==null){M="4200";}}var Z=A.uri.path;if(A.uri.hasQuery){Z+= "?${A.uri.query}";}G=G.replaceAll("{{DGLUX_REVISION}}",M).replaceAll("{{TARGET}}",Z);if(invalid==true){G=G.replaceAll("var invalid = false;","var invalid = true;");}if(MS!=null){var h=await MS.LEB(G);if(h!=null){G=h;}}return new lN(G,ContentType.HTML);}}a1(HttpRequest A)async{if(A.method=="POST"){var K=await YM.ZM(A);var D=K.nF;if(D==null||D["password"] is!String){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Invalid Request";}String M=D["password"];try {await VB.vB.j("changePassword",[nD().username,M]);await VB.vB.j("invalidateUserCache",nD().username);}catch (H,O){f.gC("Failed to change password for ${nD().username}.",H,O);A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;return "Failed to change password: ${H}";}var B=A.uri.queryParameters["target"];if(B==null){B=n.XI;}m I=await VB.vB.j("getUser",nD().username);if(I!=null&&I.IB["forcePasswordChange"]==true){B="/change_password";}A.response.redirect(Uri.parse(B));return null;}else{if(!(await aJ(A)))return null;var J=gI.Sc;var G=await gI.S1.readAsString();String C="4200";if(await J.exists()){C=(await J.readAsString()).trim();if(C==null){C="4200";}}G=G.replaceAll("{{DGLUX_REVISION}}",C).replaceAll("{{TARGET}}",A.uri.path);return new lN(G,ContentType.HTML);}}main(List<String> C)async{Jc();var D=(A,G){if(A is GM){A=rm.m0(A);}if(A is HttpException&&A.toString().contains("Connection closed")){A=null;}if(A is SocketException&&A.toString().contains("Write failed, port = 0")){A=null;}if(A==null){return;}f.oC("An Error Occurred in DGLux Server",A,G);Xc=2;if(VW!=null){VW();}};var B=false;var H=new ZoneSpecification(handleUncaughtError:(Zone K,ZoneDelegate M,Zone O,I,StackTrace J){if(!B){B=true;}else{return null;}D(I,J);});return await runZoned(()async{return await Lc(()async{return await V1(C);});},zoneSpecification:H);}V1(List<String> B)async{if(!B.contains("--test")&&!B.contains("--here")&&!(await WW())){await c1();}var ok=new Directory("/data");var pk=new Directory("/app");if(await WW()&&await pk.exists()&&await ok.exists()){var aP=new Directory("/data/www").absolute;var bP=new Directory("/data/files").absolute;var WJ=new Directory("/data/dslinks").absolute;if(!(await aP.exists())){await jc(new Directory("/app/www"),aP);}if(!(await bP.exists())){await jc(new Directory("/app/files"),bP);}if(!(await WJ.exists())){await jc(new Directory("/app/dslinks"),WJ);}}var cP=false;var VP=false;var uG=([J])async{if(VP){return;}if(stdioType(Mb.stdin)==StdioType.TERMINAL){print("");}VP=true;VW=null;if(!cP){new Timer(const Duration(seconds:10),()async{await bJ(Mb.pid);await new Future.delayed(const Duration(seconds:1));try {if(await hI.exists())await hI.delete();}catch (K){}if(BG is iI){await bJ((BG as iI).process.pid);}if(rH is iI){await bJ((rH as iI).process.pid);}exit(Xc);});cP=true;}if(Zc!=null){try {Zc.cancel();}catch (K){}}try {hn=true;if(BG!=null){BG.ea();}if(rH!=null){rH.ea();}for(var mD in OC.keys.toList()){OC[mD]("stop");}for(var FE in NW){await FE.j("handleShutdown");await FE.stop();}if(OC.isNotEmpty){await new Future.delayed(const Duration(seconds:1));}if(BG!=null){if(BG is iI){iI vG=BG;await bJ(vG.process.pid);}BG=null;}if(rH!=null){if(rH is iI){iI vG=rH;await bJ(vG.process.pid);}rH=null;}f.kB("Links Stopped.");if(eB!=null){await eB.stop();f.kB("Stopped Broker Worker.");}if(jN!=null){await jN.stop();await new Future.delayed(const Duration(milliseconds:50));f.kB("Server Workers Stopped.");}}catch (K){try {if(await hI.exists())await hI.delete();}catch (K){}exit(1);}await En();try {if(await hI.exists())await hI.delete();}catch (K){}exit(Xc);};VW=uG;ProcessSignal.SIGHUP.watch().listen(uG);ProcessSignal.SIGINT.watch().listen(uG);SD A=new SD();n=A;await A.Lw();Yc(A.WV);Xn=A.FK!=null&&A.FK.contains("Execute");var wG=new File("install.json");bool hP=true;if(await wG.exists()){Map xC=yE.convert(await wG.readAsString());if(xC["checked"]!=true){List<Map> WN=xC["links"];var uk=WN.map((G)=>G["name"]).toList();A.XL=uk;await A.WH();xC["checked"]=true;if(xC["ssl"]==false){hP=false;}await wG.writeAsString(hN.convert(xC)+"\n");try {for(Map mD in WN){String D=mD["name"];String AM=mD["revision"];if(AM!=null){var oV=new File("dslinks/${D}/.rev");await oV.create(recursive:true);await oV.writeAsString(AM);}}}catch (K){}}}if(A.iG.isEmpty&&A.VU.isEmpty&&hP){try {await M2("certs",A);}catch (K,sB){if(A.WL){f.gC("Attempted to generate SSL certificates, but failed.",K,sB);}else{f.gC("Attempted to generate SSL certificates, but failed.",K);A.Vi=false;await A.WH();}}}if(await hI.exists()){try {var GE=yE.convert(await hI.readAsString());var tB={};if(GE is List){for(var G in GE){tB[G is int?G:int.parse(G.toString())]=G.toString();}}else if(GE is Map){for(var P in GE.keys){tB[P is int?P:int.parse(P.toString())]=P.toString();}}fK=tB;}catch (K){}}if(Platform.isLinux||Platform.isMacOS){f.eC("Setting up Server Management Command signal handler.");var EE=new File(".signal");if(!(await EE.exists())){await EE.createSync(recursive:true);}try {EE.watch(events:FileSystemEvent.MODIFY).listen((FileSystemEvent QEB)async{var EB=await EE.readAsString();EB=EB.trim();f.eC("Received Server Management Command: ${EB}");if(EB=="rebind"&&jN!=null){await jN.j("rebind");}}).onError((K,sB){f.eC("Error in signal file watcher.",K,sB);});}catch (K,sB){f.eC("Failed to start signal file watcher.",K,sB);}}JS=new ZX(keyLength:A.mj,iterations:A.lj);eI H=tm(A.TZ);iN.OW=H;JW rG=l0(A.bk);if(H==null){exit(1);}var vk=await D1();var NCB=new Directory("www/dglux5").absolute;if(!(await NCB.exists())){f.oC("DGLux5 was not found.");exit(1);}var fP=new Directory("files/proj");var jP=new Directory("files/usr");if(!(await fP.exists())){await fP.create(recursive:true);}if(!(await jP.exists())){await jP.create(recursive:true);}if(A.ba&&A.port>0&&!(await Zn(A.port))){f.oC("The configured port for HTTP (${A.port}) is already taken.");exit(1);}if(A.ba&&A.VI>0&&!(await Zn(A.VI))){f.oC("The configured port for HTTPS (${A.VI}) is already taken.");exit(1);}await En();await Ln();Qc(Mb.pid,"dglux-server");await H.init(A);if(rG!=null){await rG.init(A);}if(A.get("authServer") is Map&&A.get("authServer")["enabled"]!=false){var xF=A.get("authServer",{});var yF=xF["host"];var gP=xF["port"];var gD=xF["token"];if(yF==null){yF="127.0.0.1";}if(gP!=null){if(gD==null){f.oC("Authentication Server token not set.");exit(1);}else{iN.Cn=new Gc(gD,H);await iN.Cn.bBB(yF,gP);}}}await J1();eB=A.TV?tp(xm):Ue(xm);eB.LB("getServerConfig",(J)=>A);eB.LB("getProductId",(J)=>VB.SW);eB.LB("restartLink",(D)async{if(OC.containsKey(D)){await OC[D]("restart");}});TD.NS=await Vn(length:80);eB.LB("getVerificationUserToken",(J)async{return TD.NS;});eB.LB("setLinkConfig",(List B)async{String eP=B[0];String D=B[1];dynamic NE=B[2];if(OC.containsKey(eP)){await OC[eP]("setLinkConfig",[D,NE]);}});eB.LB("updateUpstreamNodes",(tB)async{A.dE=tB;await A.WH();});eB.LB("getCurrentBuild",(J)async=>await Oc());eB.LB("updateServer",(J)async{var Q=await X1();return [Q.DE,Q.message];});eB.LB("scanForLinks",(J)async{await RW(skipDuplicates:true);});eB.LB("createUser",(List<dynamic> B)async{var O=B[0];var sk=B[1];var TB=B[2];var M=new m(O,sk);await H.LI(M,TB);});eB.LB("editUser",(m M)async{if(H is xE){await (H as xE).PR(M);}if(VB.pH!=null){for(cJ I in VB.pH){if(I.username==M.username){I.BK=null;}}}});eB.LB("renameUser",(List<String> KC)async{if(H is Hc){await (H as Hc).PBB(KC[0],KC[1]);}});var iP=(List<String> B)async{String O=B[0];String TB=B[1];if(H is xE){await (H as xE).KR(O,TB);}else{throw new fI("Password is not changeable.");}};eB.LB("changePassword",iP);eB.LB("removeUser",(String O)async{await H.nG(O);VB.pH.removeWhere((I){return I.username==O;});});eB.LB("startLink",(D)async{if(OC.containsKey(D)){await OC[D]("start");}});eB.LB("enableLink",(D)async{if(OC.containsKey(D)){await OC[D]("enable");}});eB.LB("disableLink",(D)async{if(OC.containsKey(D)){await OC[D]("stop");await OC[D]("disable");}});eB.LB("stopLink",(D)async{if(OC.containsKey(D)){await OC[D]("stop");}});eB.LB("uninstallLink",(D)async{if(OC.containsKey(D)){await OC[D]("uninstall");}});eB.LB("updateLinkGit",(D)async{if(OC.containsKey(D)){return await OC[D]("update-git");}else{return "Link not found.";}});eB.LB("updateLinkRepository",(D)async{if(OC.containsKey(D)){return await OC[D]("update-repo");}else{return "Link not found.";}});eB.LB("restart",(J)async{await bJ(Mb.pid);exit(0);});eB.LB("updateLinkZip",(List<String> B)async{try {var D=B[0];var wk=B[1];if(!OC.containsKey(D)){return "Link not found";}var xk=await OC[D]("getLinkDirectory");var tk=await OC[D]("getLinkJson");return await gn(xk,wk,tk);}catch (K){return "Error: ${K.toString()}";}});eB.LB("installLinkFromGit",(List<String> B)async{var Q=await R1(B[0],B[1]);return [Q.DE,Q.message];});eB.LB("installLinkFromZip",(List<String> B)async{var Q=await T1(B[0],B[1]);return [Q.DE,Q.message];});var p=new Completer();eB.LB("ready",(J)=>p.complete());eB.init();await p.future;TD.PW=await eB.j("getBrokerPort");oK C;if(A.UP<2){C=G1(A.UP<=0?1:A.UP,Pc,metadata:{"logLevel":A.WV});}else{C=Z4(A.UP,Pc,metadata:{"logLevel":A.WV});}jN=C;if(A.FK!=null&&A.FK.contains("Main Worker")){C.GV=(int qk,rk){AG("Main Worker","Received Message from Worker #${qk}: ${rk}");};}var Cl=(SD Z)async{if(Z==null){return;}A=Z;n=Z;await C.j("setServerConfig",A);await eB.j("setServerConfig",A);};eB.LB("setServerConfig",Cl);C.LB("getUsers",(J)async{return H.WI();});C.LB("getHttpAuthenticationAdapter",(J){if(H is sm){return (H as sm).IEB;}else{return null;}});C.LB("getSessionAttribute",(List B){String tG=B[0];String P=B[1];cJ I=VB.pH.firstWhere((G)=>G.id==tG,orElse:()=>null);if(I!=null){return I.cHB[P];}});C.LB("setSessionAttribute",(List B){String tG=B[0];String P=B[1];dynamic NE=B[2];cJ I=VB.pH.firstWhere((G)=>G.id==tG,orElse:()=>null);if(I!=null){if(NE==null){I.cHB.remove(P);}else{I.cHB[P]=NE;}}});C.LB("changePassword",iP);var lP=(int Bl)async{await C.TBB(Bl,Pc);};C.LB("resizeServerWorkers",lP);eB.LB("resizeServerWorkers",lP);eB.LB("rebindServerWorkers",(J)async{await C.j("rebind");});C.LB("triggerRequestCounter",(J)async{await eB.j("triggerRequestCounter");});C.LB("getVerificationUserToken",(J)async{return TD.NS;});C.LB("hasPlugins",(J)=>NW.isNotEmpty);C.LB("plugin",(dP)async{var yk=dP[0];var xG=dP[1];var fD=[] ;for(var FE in NW){var Q=await FE.j(yk,xG);if(Q!=null){fD.add(Q);}}return fD;});C.LB("getUser",(O)async{if(O==null){return null;}var M=await iN.OW.UI(O);return M==null?null:M;});C.LB("updateLicenseData",(String xG)async{return await eB.j("updateLicenseData",xG);});C.LB("createUser",(List<dynamic> G)async{m S=G[0];String TB=G[1];await H.LI(S,TB);return await H.WI();});C.LB("removeUser",(String O)async{await H.nG(O);return await H.WI();});C.LB("invalidateUserCache",(String O)async{VB.pH.where((G)=>G.username==O).forEach((G){G.BK=null;});});C.LB("authenticate",(List<String> KC)async{String M=KC[0];String YP=KC[1];if(M==null||YP==null){return false;}return await H.authenticate(M,YP);});C.LB("getServerConfig",(J){return A;});C.LB("getTwoFactorAuth",(J)=>rG);C.LB("getProductId",(J){return vk;});C.LB("getBrokerPort",(J)=>TD.PW);C.LB("createSession",(J)async{var dB=await u1(length:50);var UB=new cJ();UB.id=dB;var Z=new DateTime.now();UB.lastSeen=Z;UB.Li=Z;VB.pH.add(UB);return UB;});C.LB("getSession",(dB){var I=VB.pH.firstWhere((PB)=>PB.id==dB,orElse:()=>null);if(I!=null){I.lastSeen=new DateTime.now();}return I;});C.LB("invalidateSession",(dB)=>VB.pH.removeWhere((PB)=>PB.id==dB));C.LB("updateSession",(XP)async{var I=VB.pH.firstWhere((PB)=>PB.id==XP[0],orElse:()=>null);if(I==null){return null;}I.lastSeen=new DateTime.now();I.username=XP[1];if(I.username!=null){I.BK=await H.UI(I.username);}return I;});File TC=new File("login_tokens.json");if(!(await TC.exists())){await TC.create(recursive:true);await TC.writeAsString("{}");}Map<String,List<String>> h={};h=yE.convert(await TC.readAsString());WP()async{await TC.writeAsString(hN.convert(h)+"\n");}C.LB("createRememberToken",(String M)async{var gD=await fc(length:80);var G=h[M];if(G==null)G=[] ;G.add(gD);h[M]=G;await WP();return gD;});C.LB("checkRememberToken",(List<String> B){var S=h[B[0]];if(S==null){return false;}return S.contains(B[1]);});C.LB("removeRememberToken",(List<String> B)async{var S=h[B[0]];if(S==null||!S.contains(B[1])){return false;}S.remove(B[1]);await WP();return true;});await go(n,true);await C.Kb();var kP=()async{try {List<m> OCB=await H.WI();await eB.j("syncUsers",OCB);}catch (K){}};if(H is cK){(H as cK).LZ(kP);}kP();f.kB("DGLux Server Started on port ${A.port}");if(A.iG!=""&&A.iG!=null&&A.wM!=null){f.kB("Secure DGLux Server Started on port ${A.VI}");}var sG=0;zk()async{sG++ ;var Z=new DateTime.now();var TF=A.kk*60000;if(TF>21600000){TF=14400000;}var PCB=(cJ G)=>(Z.millisecondsSinceEpoch-G.lastSeen.millisecondsSinceEpoch)>=TF;VB.pH.removeWhere(PCB);if(sG>=360){sG=0;await Ln();VB.pH.forEach((G){G.BK=null;});}if(MW){MW=false;var fD={};for(var P in fK.keys){fD[P.toString()]=fK[P];}var QCB=dK.convert(fD);if(!(await hI.exists())){await hI.create(recursive:true);}await hI.writeAsString(QCB);}}ZP()=>Zc=new Timer(const Duration(seconds:5),()async{await zk();ZP();});ZP();if(n!=null&&!n.Aa){try {PS=await TW();}catch (K){}}else{PS=[] ;await new Future.delayed(const Duration(seconds:1));}await RW();if(Bn){await new Future.delayed(const Duration(seconds:1));}jn=(Al,EB)async{try {var D=hq(Al).last;if(OC.containsKey(D)){await OC[D](EB);}}catch (K){}};while(ac.isNotEmpty){Function Dy=ac.removeAt(0);var p=new Completer();Dy((){if(!p.isCompleted){p.complete();}});await p.future;if(Bn){await new Future.delayed(const Duration(milliseconds:250));}}f.kB("All links have been started.");await C1("ready",const[] );}bool MW=false;Qc(int A,[String B]){if(B==null){B="${A}";}if(!fK.containsKey(A)){fK[A]=B;MW=true;}}Dn(int A){if(fK.containsKey(A)){fK.remove(A);MW=true;}}Map<int,String> fK={};En()async{int B=10;if(OC!=null){B+= OC.length;}List<int> A=fK.keys.toList();A.sort((D,G)=>G.compareTo(D));if(A.length>B){A=A.take(B).toList();}if(A.isNotEmpty){f.eC("Cleaning up processes: ${A}");}for(var C in A){if(C==Mb.pid){continue;}try {await bJ(C);}catch (H){}}fK.clear();A.clear();}File hI=new File(".pids");List<mC> NW=[] ;J1()async{var C=new Directory("plugins");if(!(await C.exists())){return;}await for(FileSystemEntity A in await C.list()){if(A is!File)continue;if(!A.path.endsWith(".dart"))continue;A=A.absolute;var B=Y4(A.uri);var D=new Completer.sync();B.LB("init",(G)async{B.j("ready").then((G){D.complete();});});B.LB("listUsers",(G)async{var J=await iN.OW.WI();return J.map((K)=>K.fx()).toList();});B.LB("getUser",(String H)async{if(H==null){return null;}var I=await iN.OW.UI(H);return I==null?null:I;});NW.add(B);await D.future;}}D1()async{File A;if(await WW()||Platform.isAndroid){A=new File(".product_id");}else{var B=Platform.environment[Platform.isWindows?"APPDATA":"HOME"];if(B==null){if(Platform.isWindows){B=Platform.environment["USERPROFILE"];}else if(Platform.isMacOS){B="/Users/${Platform.environment["USER"]}";}else{var D=Platform.environment["USER"];if(D=="root"||D==null){B="/root";}else{B="/home/${D}";}}}A=new File(CB(B,".dglogik","dgluxserver","product_id"));}String C;try {await A.exists();}catch (G){A=new File(".product_id");}if(await A.exists()){C=(await A.readAsString()).trim();}else{C=await fc(length:30);await A.create(recursive:true);await A.writeAsString(C);}VB.SW=C;return C;}Kc(HttpRequest A,[String EB])async{var B=A.uri.queryParameters["op"];if(EB!=null){B=EB;}if(B=="listProj"){var gD=CB("files","proj");var mD=new Directory(gD);var sB=[] ;var EE=await mD.list().toList();for(var C in EE){if(C is Directory){var O=new File(CB(C.path,"_proj.json"));if(!(await O.exists())){continue;}try {Map H=yE.convert(await O.readAsString());var FE=H["owner"];var dB=H["canRead"];var tB=H["canWrite"];var I=await QE(A);if(I.wC||FE==I.username||dB.contains("all")||dB.contains(I.username)||tB.contains("all")||tB.contains(I.username)){H["id"]=mJ(C.path);sB.add(H);}}catch (xF,xC){f.gC("Failed to parse project file ${O.path}",xF,xC);}}}return sB;}else if(B=="createProj"){if(!(await aJ(A))){A.response.statusCode=HttpStatus.UNAUTHORIZED;return "Access Denied";}var h=A.uri.queryParameters["name"];var fD=A.uri.queryParameters["template"];var yF=CB("files","proj",fD);var J=h;var K=new Directory(CB("files","proj",J));if(await K.exists()){J+= "_"+await Vn(length:5);K=new Directory(CB("files","proj",J));}var PB=new Directory(yF);await for(var C in PB.list(recursive:true).where((C)=>C is File)){var TB=new File(C.path.replaceAll(PB.path,K.path));await TB.create(recursive:true);await C.copy(TB.path);}var P={"owner":(await QE(A)).username,"name":h,"isTemplate":false,"canRead":[] ,"canWrite":[] };await new File(CB(K.path,"_proj.json")).writeAsString(dK.convert(P));P["id"]=J;return P;}else if(B=="readProj"){var p=A.uri.queryParameters["id"];var G=CB("files","proj",p,"_proj.json");var GE=await IM(A,"proj/${p}/_proj.json",false);if(!GE){await dJ(A,A.response);return null;}return new File(G);}else if(B=="updateProj"){var Q=await YM.ZM(A);var S=Q.nF;var D=A.uri.queryParameters["id"];var G=CB("proj",D,"_proj.json");var Z=new File(CB("files",G));if(!(await IM(A,G,false))){await dJ(A,A.response);return null;}var KC=yE.convert(await Z.readAsString());var NE=yE.convert(S);var TC=await QE(A);if(NE["owner"]!=KC["owner"]){if(!TC.wC&&TC.username!=KC["owner"]){A.response.statusCode=HttpStatus.UNAUTHORIZED;return "You are not allowed to change the owner of this project.";}}await Z.writeAsString(S);return S;}else if(B=="deleteProj"){var D=A.uri.queryParameters["id"];var G=CB("proj",D,"_proj.json");if(!(await IM(A,G,false))){await dJ(A,A.response);return null;}var TF=CB("files","proj",D);await new Directory(TF).delete(recursive:true);return "";}else if(B=="exportProj"){var D=A.uri.queryParameters["id"];var M=new Set<String>();M.add(D);await Mn(D,M);var UB=await b1(M);({"Content-Type":"application/zip","Content-Disposition":"attachment; filename=${D}.zip","Content-Transfer-Encoding":"binary","Cache-Control":"no-cache, no-store, must-revalidate","Pragma":"no-cache","Expires":"0","Content-Length":UB.length}).forEach(A.response.headers.set);A.response.add(UB);A.response.close();return null;}else if(B=="importProj"){var Q=await YM.ZM(A);await d1(Q.nF,request:A);if(A.response.statusCode==HttpStatus.OK){return Kc(A,"listProj");}return null;}return "";}Future Mn(String D,Set<String> A)async{var B=new Directory(CB("files","proj",D,"lib"));if(!(await B.exists())){return;}await for(Directory G in B.list().where((H)=>H is Directory)){var C=mJ(G.path);var I=A.add(C);if(I){await Mn(C,A);}}}Future<List<int>> b1(Set<String> H)async{var I=new Directory("files/proj");var C=new ZN();for(var J in H){var G=new Directory("files/proj/${J}");if(!(await G.exists())){continue;}await for(FileSystemEntity A in G.list(recursive:true)){var B=bX(A.path,from:I.path);if(Platform.isWindows){B=B.replaceAll("\\","/");}if(A is File){var K=(await A.stat()).size;var M=await A.readAsBytes();var D=new QD(B,K,M);C.qh(D);}else if(A is Directory){if(await A.list().isEmpty){var D=new QD(B+"/.DGSERVER_KEEP_DIRECTORY",0,[] );C.qh(D);}}}}return new Fy().encode(C);}d1(List<int> O,{HttpRequest request,String owner})async{var C=new Gl().ou(O);if(C.Kv("_proj.json")!=null){var B=C.Kv("_proj.json");B.bU();var P=yE.convert(eK.convert(B.oF));var Q=P["id"];C.KF.forEach((A){A.name="${Q}/${A.name}";});}Set<String> M=C.KF.map((H)=>H.name.split("/").first).toSet();f.kB("Importing Projects ${M}");for(var D in M){var S=C.KF.where((H)=>H.name.startsWith("${D}/")).toList();for(var A in S){if(!A.name.endsWith("/")){A.bU();var I=new File("files/proj/${A.name}");if(!(await I.exists())){await I.create(recursive:true);}await I.writeAsBytes(A.oF);}else{var G=new Directory("files/proj/${A.name}");if(!(await G.exists())){await G.create(recursive:true);}}}var J=new File("files/proj/${D}/_proj.json");if(!(await J.exists())){f.gC("Skipping Import of ${D}: failed to find project file.");try {var G=new Directory("files/proj/${D}");await G.delete(recursive:true);}catch (Z){}continue;}Map B=yE.convert(await J.readAsString());var K=B["owner"];if(request!=null){K=(await QE(request)).username;}else if(owner!=null){K=owner;}B["owner"]=K;B["canWrite"]=[] ;await J.writeAsString(hN.convert(B));f.kB("Project ${D} Imported.");}}bool zm=false;k0 MS;K1(HttpRequest A)async{Stopwatch rG;if(n.Vk==true){rG=new Stopwatch();rG.start();}VB.vB.j("triggerRequestCounter");AG("Request Handler","(Worker #${Wc}) ${A.method} ${A.uri}");A.response.headers.removeAll("x-frame-options");A.response.headers.removeAll("x-content-type-options");A.response.headers.removeAll("x-xss-protection");if(A.headers["Origin"]!=null&&A.headers["Origin"].isNotEmpty){A.response.headers.set("Access-Control-Allow-Origin",A.headers.value("Origin"));}else{A.response.headers.set("Access-Control-Allow-Origin","*");}var xF=A.headers["X-Copy-Headers"];if(xF!=null&&xF.isNotEmpty){for(var P in xF){var VP=A.headers.value(P);if(VP!=null){A.response.headers.set(P,VP);}}}A.response.headers.set("Access-Control-Allow-Credentials","true");var YP=A.headers.value("Access-Control-Request-Headers");var WJ=A.headers.value("Access-Control-Request-Method");if(YP!=null){A.response.headers.set("Access-Control-Allow-Headers",YP);}else{A.response.headers.set("Access-Control-Allow-Headers","X-DG-Token, X-DG-Session, Authorization");}if(WJ!=null){A.response.headers.set("Access-Control-Allow-Method",WJ);}A.response.headers.set("Access-Control-Expose-Headers","X-DG-Token, X-DG-Session, X-DG-User");if(A.method=="OPTIONS"){await A.response.close();return;}var B=A.uri.path;if(B.startsWith("..")||B.contains("/../")){f.gC("A HTTP Client from ${A.connectionInfo.remoteAddress.address}" " attempted to access a malicious path (${B})");A.response..statusCode=HttpStatus.NOT_FOUND..writeln("404 - Not Found (Malicious Intent Detected)")..close();return;}B=eq.mL(B);if(B=="/ping"){eE(A,"Pong.");return;}var gD=A.cookies.where((qk)=>qk.name=="DGSESSION");var UB=gD.isNotEmpty?gD.first:null;if(gD.length>1){var dP=new DateTime.fromMillisecondsSinceEpoch(0);for(Cookie S in gD){try {cJ TF=await VB.vB.j("getSession",S.value);if(TF!=null&&TF.Li.isAfter(dP)){dP=TF.Li;UB=S;}}catch (K){}}}if(UB==null&&A.headers["X-DG-Session"]!=null&&A.headers["X-DG-Session"].isNotEmpty){UB=new Cookie("DGSESSION",A.headers.value("X-DG-Session"));}cJ D;String dB=A.headers.value("X-DG-Token");if(dB==null){dB=A.uri.hasQuery?A.uri.queryParameters["token"]:null;}if(UB==null){D=await VB.vB.j("createSession");if(dB==null){var S=new Cookie("DGSESSION",D.id);S.path="/";A.response.cookies.add(S);}else{A.response.headers.set("X-DG-Session",D.id);}}else{D=await VB.vB.j("getSession",UB.value);}if(D==null){D=await VB.vB.j("createSession");var S=new Cookie("DGSESSION",D.id);S.path="/";A.response.cookies.add(S);if(A.cookies.any((G)=>G.name=="DGTOKEN")&&A.cookies.any((G)=>G.name=="DGUSER")){var Z=A.cookies.firstWhere((C)=>C.name=="DGTOKEN");var M=A.cookies.firstWhere((C)=>C.name=="DGUSER");if(await VB.vB.j("checkRememberToken",[M.value,Z.value])){D.username=M.value;await VB.vB.j("updateSession",[D.id,D.username]);}}}if(dB!=null){var H=dB.split(" ");var rk=H.removeLast();var M=H.join(" ");if(await VB.vB.j("checkRememberToken",[M,rk])){D.username=M;await VB.vB.j("updateSession",[D.id,D.username]);}A.response.headers.set("X-DG-Session",D.id);A.response.headers.set("X-DG-User",D.username);}await runZoned(()async{if(D!=null&&D.username!=nD().username){await OS(nD().username);}if(zm&&B!="/session"){List<Map> sk=await VB.vB.j("plugin",["handleHttpRequest",[gK.Sn(A.headers),gK.Sn(A.response.headers),A.requestedUri.toString(),nD().username,A.method]]);for(var xC in sk){try {Map iP=xC[0];bool tk=xC[1];var GE=xC[2];var pk=xC[3];for(var P in iP.keys){A.response.headers.set(P,iP[P]);}if(tk){A.response.statusCode=pk;eE(A,GE);return null;}}catch (K){}}}var I=await QE(A);if(I!=null&&I.IB!=null){if(I.IB.containsKey("allowHttpAccess")&&!(B=="/dglicense.json"||B=="/session"||B=="/dgconfig.json"||B=="/viewer.dart.js"||B.startsWith("/js/")||B.startsWith("/themes/")||B.startsWith("/lang/")||B.startsWith("/css_tree/")||B.startsWith("/assets/")||B.startsWith("/packages/")||B=="/eula.html"||B=="/favicon.ico"||B.startsWith("/images/")||B=="/ws"||B=="/conn"||B.startsWith("/dglux.patch.js")||B.startsWith("/dglux.css")||B.startsWith("/file/")||B=="/file")){if(I.IB["allowHttpAccess"] is List){List KC=I.IB["allowHttpAccess"];RegExp tB=new RegExp(KC.join("|"));if(!KC.contains(B)&&!tB.hasMatch(B)&&!tB.hasMatch(A.uri.toString())){await dJ(A,A.response);return null;}}}if(I.IB["denyHttpAccess"] is List){List KC=I.IB["denyHttpAccess"];RegExp tB=new RegExp(KC.join("|"));if(KC.contains(B)||tB.hasMatch(B)||tB.hasMatch(A.uri.toString())){await dJ(A,A.response);return null;}}if(I.IB["ipWhitelist"] is List){bool eP=false;for(var J in I.IB["ipWhitelist"]){if(J is!String)continue;if(O2(A.connectionInfo.remoteAddress,P2(J))){eP=true;break;}}if(!eP){var ok=A.connectionInfo.remoteAddress;var mD=I.username;f.gC("Machine at ${ok.address} was blocked from logging in as the user ${mD}");await VB.vB.j("invalidateSession",nD().id);if(A.cookies.any((C)=>C.name=="DGTOKEN")){await VB.vB.j("removeRememberToken",[nD().username,A.cookies.firstWhere((C)=>C.name=="DGTOKEN").value]);}A.response.statusCode=HttpStatus.SERVICE_UNAVAILABLE;eE(A,"This user is not allowed to login on this machine.");return null;}}}String yF=A.headers.value("X-Reveal");if(yF==null){yF="";}for(String P in yF.split(",").map((J)=>J.trim())){if(P=="user"){A.response.headers.set("X-User",I.username);}else if(P=="permission"){var FE=I.IB["groups"];var O=":user";if(FE is String){O=FE;}else if(FE is List){O=FE.map((J)=>J.toString()).join(",");}A.response.headers.set("X-Permission-Group",O);}}if(MS!=null){var GE=await MS.HEB(A);if(GE!=null&&GE==true){return null;}}m mD=await QE(A);if(mD!=null&&mD.IB["forcePasswordChange"]==true){if(!(const["/change_password","/favicon.ico","/logout","/login"].contains(B)||B.startsWith("/images/")||B.startsWith("/assets/"))){A.response.redirect(Uri.parse("/change_password"));A.response.close();return null;}}try {if(B=="/login"){eE(A,LW(A));}else if(B=="/change_password"&&n.vh==true){eE(A,a1(A));}else if(B=="/"){eE(A,F1(A));}else if(B=="/index.html"){if(!(await aJ(A,useRootRedirect:true)))return null;var M=await QE(A);if(M.IB!=null&&M.IB["allowDesigner"]==false){Uri Q;if(M.IB["rootUrl"]!=null){Q=Uri.parse(M.IB["rootUrl"]);A.response.redirect(Q);}else{await dJ(A,A.response);return null;}}else{await kN(A,gI.Gn);}}else if(B=="/update.html"){if(!(await aJ(A)))return null;if(!(await QE(A)).wC){return "You do not have permission to do that.";}eE(A,ym(A,true));}else if(B=="/logout"){await VB.vB.j("invalidateSession",nD().id);if(A.cookies.any((C)=>C.name=="DGTOKEN")){await VB.vB.j("removeRememberToken",[nD().username,A.cookies.firstWhere((C)=>C.name=="DGTOKEN").value]);}A.response.redirect(Uc.Hn);}else if(B=="/dglicense.json"){kN(A,gI.Fn);}else if(B=="/dgconfig.json"){A.response.headers.contentType=ContentType.JSON;eE(A,H1());}else if(B=="/favicon.ico"){eE(A,gI.P1);}else if(B=="/images/lock.png"||B=="/images/logo.png"||B=="/images/user.png"){eE(A,new File(CB("www",A.uri.path.substring(1).replaceAll("/",Platform.pathSeparator))));}else if(B=="/file"||B.startsWith("/file/")){eE(A,E1(A));}else if(B=="/session"||f1(B,"session")){eE(A,I1(A));}else if(B=="/proj"){try {eE(A,await Kc(A));}catch (K){A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln(K);A.response.close();return null;}}else if(B=="/user"){eE(A,B1(A));}else if(B=="/conn"||B.startsWith("/conn/")||B.startsWith("/icon/")||B=="/ws"){try {if(n.TV==true&&TD.QW!=null){TD.QW(A,(await QE(A)));}else{var uG=await QE(A);var fP=uG.username;var kP=fP!=null?{"X-Username":fP,"X-Verification-Token":TD.NS}:const{};String O;if(A.uri.queryParameters["session"] is String){var fD=uG.IB["groups"];if(fD is String){O=fD;}else if(fD is List){O=fD.map((J)=>J.toString()).join();}else{O=uG.wC?":config":":user";}}if(O!=null){kP["X-Permission-Group"]=O;}var h=Vc(A.uri);if(n.HJ!=null&&n.HJ.isNotEmpty&&h.queryParameters["auth"]==null&&h.queryParameters["session"]!=null){try {SE AM=Pd();wH WN=AM.pE;String hP=WN.bv("dglux-${h.queryParameters['session']}-");var yk={"publicKey":WN.kR,"isRequester":true,"isResponder":false,"version":"1.1.2"};var jP=await nS.h3("POST",Vc(Uri.parse("/conn?dsId=${hP}")).toString(),headers:{"Content-Type":"application/json"});jP.write(dK.convert(yk));HttpClientResponse zk=await jP.close();Map aP=yE.convert(eK.convert(await zk.fold([] ,(Al,vk){return Al..addAll(vk);})));var xk=await AM.ni(aP["tempKey"]);String Bl=xk.mU(aP["salt"]);var TC=new Map.from(h.queryParameters);TC["auth"]=Bl;TC["format"]="json";TC["dsId"]=hP;TC.remove("session");h=h.replace(queryParameters:TC);}catch (K,sB){f.gC("Failed to handle DGLux /conn handshake",K,sB);}}await gK.Tn(A,h,kP);}}catch (K,sB){try {A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.write("Internal Server Error");if(n.WL){A.response.writeln("${K}\n${sB}");}}catch (K){}await A.response.close();}}else if(B=="/update"){eE(A,ym(A));}else if(B=="/p"||B=="/p/fr"){a2(A);}else{var lP=new File(gq(["www","dglux5"]..addAll(eq.split(B.substring(1)))));if(await lP.exists()){kN(A,lP);return null;}{var NE=n.proxies.keys.firstWhere((J){return J==B||B.startsWith(J+"/");},orElse:()=>null);if(NE!=null){var uk=n.proxies[NE];var vG=Uri.parse(uk);var Q=A.uri;var wG=Q.path;wG=wG.substring((NE+(NE==B?"":"/")).length);Q=Q.replace(scheme:vG.scheme,userInfo:Q.userInfo,host:vG.host,port:vG.port,path:wG);await gK.Tn(A,Q);return null;}}var EB=new Map<String,String>.from(n.TK);if(!EB.containsKey("/assets")){EB["/assets"]="www/assets";}EB.addAll(UW);var Cl=EB.keys.map((C){if(C.startsWith("!")){return C.substring(1);}else{return C;}}).map((C)=>[C,C.endsWith(Platform.pathSeparator)?C.substring(0,C.length-Platform.pathSeparator.length):C]).toList();var oV=Cl.where((C)=>B.startsWith(C[1])).toList();if(oV.isNotEmpty){var xG=oV.first;var sG=false;if(EB.keys.contains("!${xG[0]}")){sG=true;}var Z=EB[(sG?"!":"")+xG[0]];if(Z.endsWith(Platform.pathSeparator)){Z=Z.substring(0,Z.length-Platform.pathSeparator.length);}var p="${Z}${A.uri.path.replaceFirst(xG[1],"")}";if(await FileSystemEntity.isDirectory(p)){var wk=["index.html","index.htm","main.html","main.htm"];for(var XP in wk){if(!((await FileSystemEntity.type("${p}/${XP}"))==FileSystemEntityType.NOT_FOUND)){p="${p}/${XP}";}}if(await new File(p).exists()){if(!A.uri.path.endsWith("/")){A.response.redirect(Uri.parse(A.uri.path+"/"));return null;}}}if(sG&&(await QE(A)).username=="guest"){A.response.redirect(Uri.parse("/login?target=${Uri.encodeComponent(A.uri.toString())}"));return null;}var EE=new File(p);kN(A,EE);return null;}var ZP=new Directory("files/proj");if(!(await ZP.exists())){RS(A,A.response);return null;}List<String> bP=await ZP.list().where((C)=>C is Directory).map((C)=>mJ(C.path)).toList();var H=hq(B).skip(1).toList();var tG=H.length>=2&&H[0]=="project";if(tG?(bP.contains(H[1])):(H.length>=1&&bP.contains(H[0]))){if(B.endsWith("/")){A.response.redirect(Uri.parse(B.substring(0,B.length-1)));return null;}var WP=tG?H[1]:H[0];var PB=tG?H.skip(2).join("/"):H.skip(1).join("/");if(PB==WP||PB.isEmpty){PB=null;}var EE=new File("www/dglux5/viewer.html");if(!(await EE.exists())){RS(A,A.response);return null;}var TB='../'*'/'.allMatches(A.uri.path,1).length;var G=await EE.readAsString();var cP='''
          <body>
          <input hidden id="defaultproj" value="${WP}">
          <input hidden id="defaulthost" value="${TB}">
          ''';if(PB!=null){cP+= '<input hidden id="defaultpath" value="${PB}">';}G=G.replaceAll("<body>",cP);G=G.replaceAll('href="','href="${TB}');G=G.replaceAll('"dglux.patch.js"','"${TB}dglux.patch.js"');G=G.replaceAll('"viewer.dart','"${TB}viewer.dart');G=G.replaceAll("themesPrefix = 'themes/'","themesPrefix = '${TB}themes/'");eE(A,new lN(G,ContentType.HTML));}else{RS(A,A.response);return null;}}}catch (gP){if(gP is int){try {rS(A,gP);A.response.close();}catch (Dy){}}else{rethrow;}}},zoneValues:{"session":D,"stopwatch":rG,"request":A},onError:(K,sB){try {A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln("Internal Server Error");A.response.writeln(K.toString());if(n.WL){A.response.writeln(sB.toString());}}catch (K){}A.response.close();});}bool f1(String B,String A){if(n!=null&&n.nU!=null&&n.nU[A] is List){return n.nU[A].contains(B);}return false;}F1(HttpRequest A)async{if(!(await aJ(A,useRootRedirect:true)))return null;var B=await QE(A);if(Jn(B.IB,"rootUrl","/",not:true)){A.response.redirect(Uri.parse(B.IB["rootUrl"]));return null;}else if(Jn(B.IB,"allowDesigner",false)){if(In(n.XI)&&n.XI!="/"){A.response.redirect(Uri.parse(n.XI));return null;}else{await dJ(A,A.response);}return null;}else if(n!=null&&!B.wC&&In(n.XI)&&n.XI!="/"){A.response.redirect(Uri.parse(n.XI));return null;}else{return gI.Gn;}}oK jN;Pc(XM A)async{return Lc(()=>M1(A));}M1(XM J)async{Jc();var G=J.get("workerId");var p=J.get("logLevel");if(p is String){Yc(p);}Wc=G;f.kB("Server Worker #${G} Started.");mC B=await J.nu();SD A=await B.j("getServerConfig");if(A.FK!=null&&A.FK.contains("Server Workers")){B.HV=(dB){AG("Server Worker #${G}","Received Message from Main Worker: ${dB}");};}B.LB("setServerConfig",(SD EB){if(EB!=null){n=A=EB;}});B.LB("addLinkStatic",(I){String K=I[0];String sB=I[1];UW[sB]=K;});B.LB("removeLinkStatic",(I){String K=I[0];var PB=[] ;UW.forEach((tB,KC){if(KC==K){PB.add(tB);}});PB.forEach(UW.remove);});ce D;n=A;MS=await B.j("getHttpAuthenticationAdapter");VB.SW=await B.j("getProductId");TD.PW=await B.j("getBrokerPort");TD.NS=await B.j("getVerificationUserToken");String M;var O=await Oc();if(O>=900000000000000000000||O==-1){M="unknown";}else{M=O.toString();}zm=await B.j("hasPlugins");B.done.then((TC){f.kB("Server Worker #${G} Stopped.");if(D!=null){D.close(force:true);}});VB.vB=B;var TB=()async{if(D!=null){await D.close();}await runZoned(()async{var UB=await go(n);var P=<HttpServer>[] ;var H=A.Wi?InternetAddress.ANY_IP_V6:A.host;HttpServer Q;try {Q=await HttpServer.bind(H,A.port,shared:true);}catch (C){if(C is SocketException&&C.toString().contains("Failed to start accept")||C.toString().contains("Address family not supported")){H=InternetAddress.ANY_IP_V4;Q=await HttpServer.bind(H,A.port,shared:true);}else{rethrow;}}P.add(Q);if(A.iG!=null&&A.iG.isNotEmpty&&A.VI!=null&&A.VI>0){Future S;if(UB!=false){var Z=HttpServer.bindSecure;S=Function.apply(Z,[H,A.VI,UB],{#shared:true});}else{var Z=HttpServer.bindSecure;S=Function.apply(Z,[H,A.VI],{#shared:true,#certificateName:A.iG});}P.add(await S);}D=new ce(P);D.serverHeader="dglux_server/${M}";D.listen(K1,onError:(C){},cancelOnError:false);},onError:(C,h){if(n.WL){f.gC("Warning in Server Worker #${G}",C,h);}else{f.gC("Warning in Server Worker #${G}: ${C}");}});};B.LB("rebind",(TC)async{try {await A.Lw();}catch (C,h){f.gC("Rebind Config Reload Failed",C,h);}await TB();f.kB("Server Worker #${Wc} Rebound.");});await TB();}String Nc;I1(HttpRequest A)async{String H;if(A.method=="POST"){var P=await YM.ZM(A);var I=P.nF;var B=I["username"];var G=I["password"];var Q=I["remember"]!=null;var M=I["token"]!=null;if(M&&G.startsWith("!token!:")){G=G.substring(8);}if(M){if(await VB.vB.j("checkRememberToken",[B,G])){await OS(B);H=B;A.response.headers.set("X-DG-Session",nD().id);}}else{var S=await VB.vB.j("authenticate",[B,G]);if(S){await OS(B);if(Q==true){var Z=await VB.vB.j("createRememberToken",B);A.response.cookies.removeWhere((O)=>O.name=="DGTOKEN"||O.name=="DGUSER");A.response.cookies.add(new Cookie("DGTOKEN",Z));A.response.cookies.add(new Cookie("DGUSER",B));A.response.headers.set("X-DG-Session",nD().id);}H=B;}}}if(Nc==null){var J=new DateTime.now().timeZoneOffset.inHours;Nc="${J.isNegative?"-":""}${J>10?J:"0${J.abs()}"}:00";}var C={"dist":"DGLogik","type":"dglux-dsa","serverTimezone":Nc,"connection":"dslink","version":KX,"formats":(n!=null&&n.HJ!=null&&n.HJ.isNotEmpty)?const["json"]:const["msgpack","json"]};if(A.uri.queryParameters.containsKey("salt")){var h=await fc(length:4);var p=A.uri.queryParameters["salt"];var D=VB.SW;if(D.startsWith("dglux-dsa-"))D=D.substring("dglux-dsa-".length);else if(D.startsWith("dgserver-"))D=D.substring("dgserver-".length);var EB=mc.i2(h+p+D);C["productCode"]=EB;}var K=await QE(A);if(H!=null){C["user"]=H;C["session"]=nD().id;C["superUser"]=true;}else if(K!=null){C["user"]=K.username;C["session"]=nD().id;if(K.wC){C["superUser"]=true;}}return C;}Future<m> QE(HttpRequest D)async{var A=nD();if(A.BK is m){return A.BK;}var C=nD().username;m B=await VB.vB.j("getUser",C);if(B!=null){return A.BK=B;}else{return A.BK=iN.N1;}}cJ nD()=>Zone.current["session"];OS(String B)async{cJ A=await VB.vB.j("updateSession",[nD().id,B]);if(A!=null){nD().BK=A.BK;}}class cJ{String username;String id;DateTime lastSeen;DateTime Li;m BK;Map cHB={};Future<dynamic> Yv(String A)async{return await VB.vB.j("getSessionAttribute",[id,A]);}}ym(HttpRequest A,[bool H=false])async{if(!(await aJ(A)))return null;if(!(await QE(A)).wC){return "You do not have permission to do that.";}if(A.method=="GET"){var G=gI.Sc;var C=await gI.O1.readAsString();String B="4200";if(await G.exists()){B=(await G.readAsString()).trim();if(B==null){B="4200";}}C=C.replaceAll("{{DGLUX_REVISION}}",B);return new lN(C,ContentType.HTML);}else if(A.method=="POST"&&!H){var D=new Directory("www/dglux5");if(!(await D.exists())){await D.create(recursive:true);}XQ I=await YM.ZM(A);var J=(I.nF["fn"] as Aq).oF;await bn(J,D);await A.response.redirect(Uc.Hn);uD();}A.response.statusCode=HttpStatus.BAD_REQUEST;return "Invalid Request.";}Future<oD> X1()async{List<int> I;try {I=await ic(n.iZ);}catch (A){return new oD.sCB("Failed to fetch distribution information: ${A}");}var M=eK.convert(I);Map J;try {J=yE.convert(M);}catch (A){return new oD.sCB("Failed to decode distribution information: ${A}");}int O=await Oc();int D;Map K=J["dists"];if(K is!Map){return new oD.sCB("Failed to handle distribution information: dists key not found");}Map B=K[Ic];if(B is!Map){return new oD.sCB("Failed to handle distribution information: dist ${Ic} not found");}try {D=int.parse(B["latest"]);}catch (A){return new oD.sCB("Failed to determine the latest build number: ${A}");}if(O>=D){return new oD.rCB("Server is up-to-date.");}try {var P=B["file"];var C=B["update"];if(C==null){C={};}List<String> G=[] ;if(C.containsKey("ignore")){G.addAll(C["ignore"]);}if(n.zi==true){G.addAll(const["www/*.html","www/*.css","www/*.png","www/*.jpg","www/*.js","www/*.ico","www/css","www/js","www/img","www/images"]);}String H;if(B["url"] is String){H=B["url"];}else{H="https://dsa.s3.amazonaws.com/dists/${Ic}/${D}/${P}";}await hc(H,Directory.current,exclude:G);return new oD.rCB("Updated!");}catch (A){return new oD.sCB("Failed to update: ${A}");}}List<Map<String,dynamic>> PS;Future<List<Map<String,dynamic>>> TW()async{if(n!=null&&n.Aa){return [] ;}var A=yE.convert(eK.convert(await ic(n.Ia,retry:3)));if(A is List){A.sort((B,C){if(B is Map&&C is Map&&B["displayName"]!=null&&C["displayName"]!=null){return B["displayName"].compareTo(C["displayName"]);}return 0;});PS=A;f.eC("Updated Link Repository Data (${A.length} links)");}return A;}B1(HttpRequest A)async{try {var D=A.uri.queryParameters["op"];if(D=="listUser"){if(!(await aJ(A,requireSuperuser:true))){return null;}List<m> S=await VB.vB.j("getUsers");return S.map((m C)=>{"name":C.username,"superUser":C.wC,"metadata":C.IB}).toList();}else if(D=="getUser"){var B=A.uri.queryParameters["name"];var G=await QE(A);if(B==null&&G.username=="guest"){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Username is required.";}B=G.username;if(!(await aJ(A,requireSuperuser:true,user:B)))return null;m H=B==G.username?G:await VB.vB.j("getUser",B);if(H==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "User not found.";}return {"name":H.username,"superUser":H.wC,"metadata":H.IB};}else if(D=="putUser"){if(A.method!="POST"){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Method not supported.";}var B=A.uri.queryParameters["name"];if(!(await aJ(A,requireSuperuser:true,user:B))){return null;}if(B==null||B.isEmpty){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Username is required.";}List<m> Z=await VB.vB.j("getUsers");if(Z.any((m M)=>M!=null&&M.username==B)){A.response.statusCode=HttpStatus.BAD_REQUEST;return "User already exists.";}XQ O=await YM.ZM(A);if(O.type!="json"){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Body should be JSON.";}var I=O.nF;var J=I["password"];if(J==null||J.isEmpty){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Password is required.";}bool P=false;if((await QE(A)).wC){P=I["superUser"]==null?false:I["superUser"];}var K=await VB.vB.j("createUser",[new m(B,P),J]);return K.map((m C)=>{"name":C.username,"superUser":C.wC,"metadata":C.IB}).toList();}else if(D=="removeUser"){var B=A.uri.queryParameters["name"];if(!(await aJ(A,requireSuperuser:true,user:B))){return null;}if(B==null||B.isEmpty){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Username is required.";}var K=await VB.vB.j("removeUser",B);return K.map((m C)=>{"name":C.username,"superUser":C.wC}).toList();}else{A.response.statusCode=HttpStatus.SERVICE_UNAVAILABLE;return "Unknown Operation: ${D}";}}on fI catch (Q){if(Q.message.contains("not support")){A.response.statusCode=HttpStatus.NOT_IMPLEMENTED;}else{A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;}A.response.writeln(Q.message);A.response.close();return null;}}bool get Bn=>Platform.numberOfProcessors<2;Future<bool> bJ(int A,{bool asRoot: false})async{try {Dn(A);}catch (C){}if(Platform.isWindows){var B=await ZF("taskkill",args:["/F","/T","/PID",A.toString()],timeout:const Duration(seconds:3));return B.exitCode==0;}else{try {await ZF("pkill",args:["-TERM","-P",A.toString()],timeout:const Duration(seconds:3),sudo:asRoot);}catch (C){}qH B=await ZF("kill",args:["-TERM",A.toString()],timeout:const Duration(seconds:3),sudo:asRoot,writeToBuffer:true);if(!asRoot&&B.nE.toString().contains("not permitted")){f.eC("Unable to kill PID ${A} without root," " attempting sudo kill.");var D=await bJ(A,asRoot:true);if(D){f.eC("Killed PID ${A} as root.");}else{f.eC("Failed to kill PID ${A} as root.");}}return B.exitCode==0;}return false;}Future<String> Y1()async{List<NetworkInterface> A=await NetworkInterface.list();if(A==null||A.isEmpty){return null;}NetworkInterface D=A.first;List<InternetAddress> B=D.addresses.where((C)=>!C.isLinkLocal&&!C.isLoopback).toList();if(B.isEmpty){return null;}return B.first.address;}bool In(A)=>A is String&&A.isNotEmpty;bool Jn(A,B,C,{bool not: false}){if(A==null){return false;}if(not){if(A[B]==null){return false;}if(A[B]==""&&C!=""){return false;}if(A[B]!=C){return true;}}else{if(A[B]==C){return true;}}return false;}oK G1(int C,BT D,{Map<String,dynamic> metadata}){var B=[] ;for(var A=1;A<=C;A++ ){B.add(tp(D,metadata:{"workerId":A}..addAll(metadata==null?{}:metadata)));}return new oK(B);}bool hn=false;Function jn;abstract class nN{Stream FV(String A);Stream Oa(String A);Set<String> get sC;void ea();Future Pk(String A,String B,Map<String,dynamic> C);Future ja(String A);}const bool Q2=const bool.fromEnvironment("dsa.runtime_manager.dart.merged",defaultValue:false);nN BG;bool US=false;Future<nN> T2(List<Process> K,List<String> B)async{if(Q2){if(BG!=null){return BG;}var D=new U2();BG=D;US=false;return D;}if(US){f.kB("Waiting for Dart Runtime Manager to start.");while(true){if(!US){break;}await new Future.delayed(const Duration(milliseconds:5));}return BG;}if(BG!=null){return BG;}US=true;String M=await G2();String A=CB("bin","runtime.dart");if(!(await new File(A).exists())){A=CB("bin","helpers","runtime.dart");}var G=new File(CB(aX(A),L5(A)+".snapshot")).absolute;if(await G.exists()){A=G.path;}var H=()async{var C=[] ;if(B!=null&&B.isNotEmpty){C.addAll(B);}C.addAll(["-Ddslink.runtime.manager=true",A]);var I=await Process.start(M,C);K.add(I);return I;};var J=new iI(await H(),logFile:new File("logs/runtime-dart.log"),restart:H,name:"Dart");BG=J;US=false;return J;}class iI implements nN{Process process;bool Vx=false;Stream FV(String A){return dHB.stream.where((String B)=>B==A);}Stream Oa(String A){return eHB.stream.where((B)=>B==A||"!${A}"==B);}StreamController<String> dHB=new StreamController.broadcast();StreamController<String> eHB=new StreamController.broadcast();IOSink tL;iI(this.process,{String name,File logFile,Future<Process> restart()}){B()async{if(tL!=null){tL.close();tL=null;}var D="runtime-${name==null?'unknown':name.toLowerCase()}";Qc(process.pid,D);if(logFile!=null){if(!(await logFile.exists())){await logFile.create(recursive:true);}tL=await logFile.openWrite(mode:FileMode.APPEND);}process.exitCode.then((G)async{fHB=false;Dn(process.pid);if(!Vx){f.oC("${name==null?"A":name} runtime manager died: ${G}");}try {tL.close();}catch (C){}if(sC.isNotEmpty&&jn!=null){var H=new List.from(sC);sC.clear();for(var I in H){dHB.add(I);}}if(restart!=null&&!hn){process=await restart();B();}});process.stdout.transform(eK).listen((String A){if(A.startsWith("\u0002")&&A.trim().endsWith("\u0003")){A=A.trim();var J=A.substring(1,A.length-1);var K=yE.convert(J);Z$(K);}else{if(tL!=null){try {tL.write(A);}catch (C){}}else{Mb.stdout.write(A);}}});process.stderr.transform(eK).listen((String A){if(tL!=null){try {tL.write(A);}catch (C){}}else{Mb.stderr.write(A);}});}B();}Set<String> sC=new Set<String>();List<String> gHB=[] ;Z$(Map A)async{f.eC("Runtime Manager Received: ${A}");var B=A["event"];if(B=="fail"){if(!sC.contains(A["path"])){eHB.add("!${A["path"]}");}else{dHB.add(A["path"]);sC.remove(A["path"]);}}else if(B=="stopped"){dHB.add(A["path"]);sC.remove(A["path"]);}else if(B=="ready"||B=="started"){eHB.add(A["path"]);}else if(B=="runtime.ready"){f.eC("Runtime Manager - Flushing Write Queue: ${gHB.length}");fHB=true;while(gHB.isNotEmpty){write(gHB.removeAt(0));}}}Future Pk(String A,String B,Map<String,dynamic> C)async{write({"event":"start","path":A,"main":B,"configs":C});return Oa(A).first.then((String D){if(D.startsWith("!")){return false;}sC.add(A);return true;});}Future ja(String A){write({"event":"stop","path":A});return FV(A).first;}int hHB;bool fHB=false;bool iHB=true;bool jHB=false;void write(A){if(jHB&&A is Map&&A["event"]!="stop"){return;}if(!fHB){gHB.add(A);return;}if(iHB){var B=new DateTime.now().millisecondsSinceEpoch;if(hHB!=null&&(B-hHB)<500){new Future.delayed(Platform.numberOfProcessors==1?const Duration(milliseconds:500):const Duration(milliseconds:250),(){write(A);});return;}hHB=B;}if(f.wO(RB.VX)){f.eC("Runtime Manager Write: ${A}");}var C=dK.convert(A);process.stdin.write("\u0002"+C+"\u0003");}void ea(){Vx=true;iHB=false;jHB=true;}}Future<String> gn(Directory C,String O,Map P)async{try {var A=P["update"];var H=A!=null&&A["backupForUpdate"]==true;var G={};if(H){var I=["nodes.json",".dslink.key"];if(A!=null&&A["protectedFiles"]!=null){I.addAll(A["protectedFiles"]);}for(var B in I){var D=new File(CB(C.path,B));if(await D.exists()){G[B]=await D.readAsBytes();}}}if(A!=null&&A is Map&&A["delete"] is List&&A["delete"].isNotEmpty){for(var J in A["delete"]){if(J is!String)continue;try {var K=await DQ("${C.path}/${J}");if(await K.exists()){await K.delete(recursive:true);}}catch (M){}}}await hc(O,C,handleSingleDirectory:true);if(H){for(var B in G.keys.toList()){var Q=G.remove(B);var D=new File(CB(C.path,B));await D.writeAsBytes(Q);}}return "Success!";}catch (M){return "Error: ${M.toString()}";}}Future<oD> V2(String I,String C)async{var D=new Directory("dslinks");if(!(await D.exists())){await D.create(recursive:true);}var G=new Directory("dslinks/${C}").absolute;if(await G.exists()){return new oD.sCB("A link of the name '${C}' already exists!");}var H=await hD("git");if(H==null){return new oD.sCB("Git is not installed.");}qH A=await ZF(H,args:["clone",I,G.path],outputFile:new File("logs/installer.log"),writeToBuffer:true);if(A.exitCode!=0){String B;if(A.stderr.contains("Could not resolve host")){B="Failed to resolve host. Either this site does " " not exist, or you are not connected to the internet.";}else if(A.stderr.contains("does not exist")){B="Repository does not exist.";}else{B=A.stderr.toString();}return new oD.sCB(B);}else{return new oD.rCB("Success!");}}Future<oD> W2(String D,String B)async{var C=new Directory("dslinks");if(!(await C.exists())){await C.create(recursive:true);}var A=new Directory("dslinks/${B}").absolute;if(await A.exists()){return new oD.sCB("A link of the name '${B}' already exists!");}await A.create(recursive:true);try {await hc(D,A,handleSingleDirectory:true);return new oD.rCB("Success!");}catch (G){return new oD.sCB(G.toString());}}class oD{final bool DE;final String message;oD.rCB(this.message):DE=true;oD.sCB(this.message):DE=false;}nN rH;bool YW=false;Future<nN> S2(List<Process> I,List<String> A)async{if(YW){f.kB("Waiting for Java Runtime Manager to start.");while(true){if(!YW){break;}await new Future.delayed(const Duration(milliseconds:5));}return rH;}if(rH!=null){return rH;}YW=true;String B=await hD("java");if(B==null){B="java";}String J=CB("bin","runtimes","java.jar");var D=()async{var C=[] ;if(A!=null&&A.isNotEmpty){C.addAll(A);}C.addAll(["-jar",J]);var G=await Process.start(B,C);I.add(G);return G;};var H=new iI(await D(),logFile:new File("logs/runtime-java.log"),restart:D,name:"Java");rH=H;YW=false;return H;}const String R2=r"""
import "dart:async";
import "dart:io";
import "dart:isolate";
import "{{uri}}" as run;

main(List<String> args, msg) async {
  var rp = new ReceivePort();
  SendPort sp;
  if (msg is SendPort) {
    sp = msg;
  } else {
    sp = rp.sendPort;
  }

  var rcfg = {};

  rp.listen((x) {
    if (x == "STOP") {
      if (rcfg != null && rcfg["closeHandler"] is Function) {
        rcfg["closeHandler"]();
      }
      rp.close();
    }
  });

  sp.send(rp.sendPort);

  var file = new File("{{log_file}}");
  if (!(await file.exists())) {
    await file.create(recursive: true);
  }
  var raf = await file.openWrite(mode: FileMode.APPEND);
  var spec = new ZoneSpecification(print: (Zone self, ZoneDelegate parent, Zone zone, String line) {
    raf.writeln("[${currentTimestamp}] ${line}");
  }, handleUncaughtError: (Zone self, ZoneDelegate parent, Zone zone, error, StackTrace stackTrace) {
    var out = [];
    out.addAll(error.toString().split("\n"));
    out.addAll(stackTrace.toString().split("\n"));

    for (var line in out) {
      raf.writeln("[${currentTimestamp}] ${line}");
    }
    out.clear();
  });

  return await runZoned(() async {
    return await run.main(args);
  }, zoneSpecification: spec, zoneValues: {
    "dslink.runtime.config": rcfg
  });
}

String get currentTimestamp => new DateTime.now().toString();
""";class U2 extends nN{Map<String,StreamController> kHB={};Map<String,StreamController> lHB={};Set<String> sC=new Set<String>();Stream FV(String A){if(lHB[A] is StreamController){return lHB[A].stream;}var B=lHB[A]=new StreamController.broadcast();return B.stream;}Stream Oa(String A){if(kHB[A] is StreamController){return kHB[A].stream;}var B=kHB[A]=new StreamController.broadcast();return B.stream;}void ea(){}Future Pk(String A,String Z,Map<String,dynamic> C){new Future(()async{if(sC.contains(A)){await ja(A);}try {var I=new Directory(A);var J=[] ;for(var D in C.keys){if(C[D] is Map){C[D]=C[D]["value"];}if(D=="log-file"){continue;}J.add("--${D}=${C[D]}");}J.add("--base-path=${I.path}");var M=new File(CB(I.path,Z)).absolute;var G=R2;G=G.replaceAll("{{uri}}",M.uri.toString());G=G.replaceAll("{{log_file}}",C["log-file"].toString());var O=new File(CB(I.path,".rtm_stub"));await O.writeAsString(G);var P=new ReceivePort();var Q=new Directory(CB(M.parent.path,"packages"));Uri S;if(await Q.exists()){S=Q.uri;}var B=await Isolate.spawnUri(O.uri,J,P.sendPort,paused:true,packageRoot:S);var K=new ReceivePort();K.listen((H){if(H=="EXIT"){if(lHB[A] is StreamController){lHB[A].add(A);}Ea.remove(A);K.close();P.close();}});B.addOnExitListener(K.sendPort,response:"EXIT");Ea[A]=B;B.resume(B.pauseCapability);if(kHB[A] is StreamController){kHB[A].add(A);}}catch (H){Isolate B=Ea.remove(A);if(B!=null){B.kill();}Wa.remove(A);if(kHB[A] is StreamController){kHB[A].add("!${A}");}try {kHB.remove(A).close();}catch (H){}try {lHB.remove(A).close();}catch (H){}sC.remove(A);return new Future.value();}});return Oa(A).first.then((h){if(h.startsWith("!")){return false;}sC.add(A);return true;});}Future ja(String A)async{new Future(()async{if(Wa[A] is SendPort){Wa[A].send("STOP");}await new Future.delayed(const Duration(milliseconds:200));var B=Ea.remove(A);if(B!=null){B.kill(priority:Isolate.IMMEDIATE);}Wa.remove(A);try {kHB.remove(A).close();}catch (D){}try {var C=lHB.remove(A);C.add(A);C.close();}catch (D){}sC.remove(A);});return FV(A).first;}Map<String,Isolate> Ea={};Map<String,SendPort> Wa={};}const List<String> X2=const["host","connection","keep-alive","public","proxy-authenticate","proxy-authorization","trailers","upgrade","transfer-encoding","te","content-encoding"];const List<String> Y2=const["host","connection","keep-alive","public","proxy-authenticate","proxy-authorization","trailers","upgrade","transfer-encoding","te","content-encoding","content-length"];HttpClient Z2=new HttpClient()..badCertificateCallback=(A,B,C)=>true;a2(HttpRequest A)async{var H=A.uri.path.contains("/fr");var G=A.uri.query;if(G==null){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("No URL Specified");A.response.close();return;}try {var I=Uri.parse(Uri.decodeComponent(G));HttpClientRequest B=await Z2.openUrl(A.method,I);B.followRedirects=H;b2(A,B);await A.pipe(B);HttpClientResponse D=await B.close();var C=A.response;C.statusCode=D.statusCode;c2(D,C);await D.pipe(C);await C.close();}catch (J,K){A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln(J);A.response.writeln();A.response.writeln(K);A.response.close();return;}}b2(HttpRequest A,HttpClientRequest B){A.headers.forEach((C,D){if(X2.contains(C.toLowerCase())){return;}B.headers.removeAll(C);for(var G in D){B.headers.add(C,G);}});if(A.headers["C00kie"]!=null&&A.headers["C00kie"].isNotEmpty){B.headers.add("Cookie",A.headers.value("C00kie"));}}c2(HttpClientResponse C,HttpResponse B){C.headers.forEach((A,D){if(Y2.contains(A.toLowerCase())){return;}B.headers.removeAll(A);for(var G in D){B.headers.add(A,G);}});}Function u2(){return WSB;}bool fo=false;go(SD A,[bool C=false])async{if(A!=null&&A.iG!=""&&A.iG!=null){String D="certs";if(C){if(fo){return false;}bool B=true;try {var G=u2();Function.apply(G,[] ,{#database:D,#password:A.wM});}on NoSuchMethodError {B=false;}on TlsException catch (H){if(H.message.contains("Called SecureSocket.initialize more than once")){return false;}rethrow;}if(B){fo=true;return false;}}try {return w2(A);}on TypeError {return false;}}return false;}typedef dynamic v2({String directory,String file,String password});w2(SD A){String D="certs";var B=new SecurityContext();String G=CB(D,A.iG);String I=CB(D,A.VU);String H=(A.wM!=null&&A.wM.isNotEmpty)?A.wM:null;B.usePrivateKey(I,password:H);var C=B.useCertificateChain;if(C is v2){Function.apply(C,[] ,{#file:G,#password:H});}else{Function.apply(C,[G]);}return B;}abstract class Jd{}abstract class IQ implements Jd{}abstract class jW implements Jd{}abstract class ZS{static ZS Kd=new x2();jW get ZB;IQ mi(String A){return ZB.Di(A);}}class ho implements IQ{final File file;ho(this.file);Future create()async{await file.create(recursive:true);}Future delete()async{await file.delete(recursive:true);}Future<bool> exists(){return file.exists();}Jd get parent{return new kW(file.parent);}String get path=>file.path;Future<List<int>> readAsBytes(){return file.readAsBytes();}Future<String> readAsString(){return file.readAsString();}Future writeAsBytes(List<int> A){return file.writeAsBytes(A);}Future writeAsString(String A){return file.writeAsString(A);}}class kW implements jW{final Directory GD;kW(this.GD);IQ Di(String A){var B=CB(GD.path,A);return new ho(new File(B));}Future create(){return GD.create(recursive:true);}Future delete(){return GD.delete(recursive:true);}Future<bool> exists(){return GD.exists();}jW get parent=>new kW(GD.parent);String get path=>GD.path;}class x2 extends ZS{jW get ZB=>new kW(Directory.current);}class F3{static String G3="dart";}SE Pd({bool save: true}){File D=new File(".dslink.key");SE B;String A;try {A=D.readAsStringSync();B=new SE.yCB(A);}catch (J){}if(A==null||A.length!=131){if(mK.CO.Xw){String C;if(Platform.isWindows){C=Process.runSync("getmac",[] ).stdout.toString();}else{try {C=Process.runSync("arp",["-an"]).stdout.toString();}catch (I){try {var G="";for(var H in Platform.environment.keys){G+= "${H}=${Platform.environment[H]}\n";}C=G;}catch (I){}}}mK.CO.Uu(C);}B=new SE.xCB();A=B.Ix();if(save==true){D.writeAsStringSync(A);}}return B;}class d extends iJ with aF{final k provider;SQ mHB;d(String A,this.provider):super(A){if(A!=null&&provider.yh!=null){mHB=provider.yh.YR(A);mHB.pv().then((B){if(B is Map){HB.addAll(B);}});}}void load(Map A){super.load(A);if(A["?permissions"] is List){tF(A["?permissions"]);}}Map XH(bool C){Map A=super.XH(C);List B=this.Kk();if(B!=null){A["?permissions"]=B;}return A;}aF kU(String A){if(R[A] is aF){return R[A] as aF;}return null;}q RN(String A,Object B,Y C,q D){var G=super.RN(A,B,C,D);provider.XBB(this);return G;}bool lG(){return false;}}class VD extends d{VD(String A,k B):super(A,B){B.u(A,this);}}class no extends VD{no(String A,k B,String C):super(A,B){L[r"$name"]="DSA Version";L[r"$type"]="string";v(C);}}class qo extends VD{qo(String A,k B,String C):super(A,B){L[r"$name"]="Distribution";L[r"$type"]="string";v(C);}}class ro extends VD{ro(String A,k B):super(A,B){L[r"$name"]="Start Time";L[r"$type"]="time";v(GB.LQ());}}class to extends VD{to(String A,k B):super(A,B){L[r"$name"]="Clear Conns";L[r"$invokable"]="config";}V WB(Map B,Y C,V A,l D,[int G=b.s]){provider.V_();return A..close();}}class oW extends d{oW(String B,k A):super(B,A){L[r"$is"]="dsa/broker";if(A!=null){L[r"$uid"]=A.px;}}bool nHB=false;void load(Map D){if(nHB){throw "root node can not be initialized twice";}D.forEach((String A,C){if(A.startsWith(r"$")){L[A]=C;}else if(A.startsWith("@")){HB[A]=C;}else if(C is Map){d B;if(C=="defs"){B=new eS("/${A}",provider);}else{B=new d("/${A}",provider);}B.load(C);provider.g[B.path]=B;R[A]=B;}});}}class eS extends d{eS(String A,k B):super(A,B){L[r"$hidden"]=true;}Map TI(){Map A={r"$hidden":true};if(L.containsKey(r"$is")){A[r"$is"]=L[r"$is"];}if(L.containsKey(r"$type")){A[r"$type"]=L[r"$type"];}if(L.containsKey(r"$name")){A[r"$name"]=L[r"$name"];}if(L.containsKey(r"$invokable")){A[r"$invokable"]=L[r"$invokable"];}if(L.containsKey(r"$writable")){A[r"$writable"]=L[r"$writable"];}return A;}}typedef void z2<BB>(String _0,BB _1);class k extends xd implements kS{final Map<String,l> g=new Map<String,l>();final Map<String,BD> jG=new Map<String,BD>();Rd oE;pS SC;String downstreamName;String jZ;String YL;oW ZB;d GF;sN OI;d hV;eS cU;d ax;d VN;d NN;d UK;z2 Lk;String px;Md Ux;Map Ek={"users":{},"sys":{"tokens":{},"quarantine":{}},"upstream":{}};bool ga=true;bool enabledQuarantine=false;bool enabledDataNodes=false;bool acceptAllConns=true;jo pa;Nd mx;rN dE;RQ yh;RQ bj;Ld ZH;Od RZ;Qd Bj;Ud gk;List defaultPermission;k({this.enabledQuarantine: false,this.acceptAllConns: true,this.defaultPermission,this.downstreamName: "conns",pS storage,this.enabledDataNodes: true}){if(storage==null){storage=new He("storage");}yh=storage.ji("brokerAttributes");px=X4();this.SC=storage;pa=new jo();oE=new Rd();mx=new Nd(this);ZH=new Ld(this);ZB=new oW("/",this);g["/"]=ZB;if(downstreamName==null||downstreamName==""||Ek.containsKey(downstreamName)||downstreamName.contains(FB.lS)){throw "invalid downstreamName";}jZ="/${downstreamName}";YL="${jZ}/";Ek[downstreamName]={};ZB.load(Ek);cU=new eS("/defs",this);ZB.iB("defs",cU);GF=g[jZ];GF.L[r"$downstream"]=true;ZB.L[r"$downstream"]=jZ;hV=g["/users"];OI=g["/data"];ax=g["/sys"];NN=g["/sys/quarantine"];VN=g["/upstream"];UK=g["/sys/tokens"];new ko("/sys/query",this);if(defaultPermission!=null){xo(defaultPermission);ZB.tF(defaultPermission);}cU.tF([["default","read"]]);ax.tF([[":config","config"],["default","none"]]);NN.tF([[":config","config"],["default","none"]]);oE.ZB=ZB;}void uBB(List A){ZB.tF(A);RZ.VJ(A);dE.cZ.VJ(A);gk.VJ(A);}static void xo(List D){Map B={":trustedLink":"config",":user":"read",":config":"config",":write":"write",":read":"read"};for(List G in D){B.forEach((String A,String C){if(G[0]==A){B[A]=null;}});}B.forEach((String A,String C){if(C!=null){D.insert(0,[A,C]);}});}CAB()async{List<List<EG>> A;if(SC!=null){A=await SC.LAB();}await GAB();tj(L3);tj(P3);ti();await EAB();await Fj();await Ja();if(enabledDataNodes){await FAB();tj(Q3);}if(SC!=null){JAB();}if(A!=null){for(List<EG> B in A){if(B.length>0){var C=B[0].SC;String D=C.QN;if(D!=null&&jG.containsKey(D)){jG[D].VR(this,null).j$(C,B);}else{C.destroy();}}}}}void ti(){new no("/sys/version",this,KX);new ro("/sys/startTime",this);new qo("/sys/dist",this,F3.G3);new to("/sys/clearConns",this);new lo("/sys/updatePermissions",this);pa.i$(this);dE=new rN("/sys/upstream",this);mx.init();Ux=new Md(this);Ux.init();RZ=new Od("/sys/quarantine/authorize",this);if(defaultPermission!=null){RZ.VJ(defaultPermission);}Bj=new Qd("/sys/quarantine/deauthorize",this);gk=new Ud("/sys/updateGroup",this);new mo("/sys/updateDefaultPermission",this)..sx(defaultPermission);new oo("/sys/allowAllLinks",this);new so("/sys/enableQuarantine",this);}GAB()async{QM G=DB("/defs/profile",false);cU.R["profile"]=G;U3.forEach((String A,Map C){String D="/defs/profile/${A}";QM B=DB(D,false);B.load(C);G.R[A]=B;});B3.forEach((String A,Map C){String D="/defs/profile/${A}";QM B=DB(D,false);B.load(C);G.R[A]=B;});File H=new File("defs.json");try {String I=await H.readAsString();Map C=PC.CF(I);C.forEach((String A,Map C){String D="/defs/${A}";QM B=DB(D,false);B.load(C);cU.R[A]=B;});}catch (J){}}void tj(Map B){void C(Map B,String D){B.forEach((String G,Object A){if(A is Map){C(A,"${D}${G}/");}else if(A is yd){(DB("${D}${G}",false) as QM).dBB(A);}});}C(B,"/defs/profile/");}Fj()async{File D=new File("usernodes.json");try {String G=await D.readAsString();Map A=PC.CF(G);A.forEach((String B,Map A){String H="/users/${B}";cS C=DB(H,false);C.tF([[B,"config"],["default","none"]]);C.load(A);hV.R[B]=C;});}catch (I){}}Future<Map> Hk()async{Map A={};hV.R.forEach((String B,iJ C){A[B]=C.XH(true);});File D=new File("usernodes.json");if(ga){await D.writeAsString(PC.FH(A));}return A;}EAB()async{File H=new File("conns.json");try {String I=await H.readAsString();Map C=PC.CF(I);List G=[] ;C.forEach((String B,Map C){String D="${YL}${B}";eJ A=DB(D,false);GF.R[B]=A;BD J=A.oHB;J.TH=true;GF.SB(B);A.load(C);if(A.L[r"$$dsId"] is String){pHB[A.L[r"$$dsId"]]=D;qHB[D]=A.L[r"$$dsId"];}G.add(B);});Bj.Cb(G);}catch (K){}}JAB()async{RQ A=SC.ji("attribute");bj=A;wB.rD("Loading Proxy Attributes");Map D=await A.load();D.forEach((C,G){l B=this.DB(C,false);if(B is iC&&B.oHB.TH){B.zBB(G);}else{A.YR(C).destroy();}});}FAB()async{wB.rD("Loading Data Nodes");OI=new sN("/data",this);if(SC!=null){OI.rR=SC.ji("data");}OI.init();ZB.R["data"]=OI;g["/data"]=OI;File C=new File("data.json");try {String D=await C.readAsString();Map A=PC.CF(D);A.forEach((String G,Map A){String H="/data/${G}";UD I=DB(H,true);I.load(A);});}catch (M){}if(SC!=null){Map J=await OI.rR.load();J.forEach((B,K){if(g[B] is UD){g[B].v(K);}else{OI.rR.YR(B).destroy();}});}}Future<Map> pR()async{Map A={};OI.R.forEach((String B,UD C){A[B]=C.XH(true);});File D=new File("data.json");if(ga){await D.writeAsString(PC.FH(A));}return A;}Ja()async{File G=new File("tokens.json");try {String H=await G.readAsString();Map A=PC.CF(H);A.forEach((String D,Map A){String B="/sys/tokens/${D}";uH C=new uH(B,this,D);C.load(A);});}catch (I){String B="/sys/tokens/root";uH C=new uH(B,this,"root");C.init();}}Future<Map> Gk()async{Map A={};UK.R.forEach((String B,uH C){A[B]=C.XH(true);});File D=new File("tokens.json");if(ga){await D.writeAsString(PC.FH(A));}return A;}Future<Map> RK()async{Map A={};List B=[] ;GF.R.forEach((String C,iC D){B.add(C);BD G=D.oHB;A[C]=G.dD.XH(false);});File H=new File("conns.json");if(ga){await H.writeAsString(PC.FH(A));}Bj.Cb(B);gk.Cb(B);return A;}void Db(){List A=[] ;NN.R.forEach((String D,d C){Object B=C.L[r"$$dsId"];if(B is String){A.add(B);}});RZ.vBB(A);}void V_(){List D=GF.R.keys.toList();for(String B in D){iC G=GF.R[B];BD A=G.oHB;if(A.QI!=null){String C=qHB[A.path];qHB.remove(A.path);pHB.remove(C);GF.R.remove(B);A.TH=false;if(rHB.containsKey(C)){rHB.remove(C).close();}GF.SB(B);}}FC.ID(RK,300);}void Y_(){List G=VN.R.keys.toList();for(String A in G){var D=VN.R[A];if(D is!iC){continue;}iC H=D;BD B=H.oHB;if(B.QI!=null||!dE.R.containsKey(A)){String C=qHB[B.path];qHB.remove(B.path);pHB.remove(C);VN.R.remove(A);B.TH=false;if(rHB.containsKey(C)){rHB.remove(C);}VN.SB(A);}}FC.ID(RK,300);}void u(String A,l B){l G=g[A];if(G!=null){wB.oC("error, BrokerNodeProvider.setNode same node can not be set twice");return;}FB C=new FB(A);l D=g[C.gB];if(D==null){wB.oC("error, BrokerNodeProvider.setNode parentNode is null");return;}g[A]=B;D.iB(C.name,B);}l yB(String A){return g[A];}UD sHB(String B,[bool H=true]){UD A=g[B];if(A==null){A=new UD(B,this);A.L[r"$type"]="dynamic";g[B]=A;}if(H&&A.parent==null){int D=B.lastIndexOf("/");String I=B.substring(0,D);String G=B.substring(D+1);UD C=sHB(I,true);C.R[G]=A;A.parent=C;C.SB(G);}return A;}l DB(String A,[bool M=true]){if(A.startsWith("/data/")){return sHB(A,M);}l D=g[A];if(D!=null){return D;}if(A.startsWith("/users/")){List G=A.split("/");String J=A.split("/")[2];if(G.length==3){D=new cS(A,J,this);}else{int H=A.indexOf("/#");if(H<0){D=new tH(A,this,J);}else{String C;int K=A.indexOf("/",H+1);if(K<0){C=A;}else{C=A.substring(0,K);}BD B=jG[C];if(B==null){B=new BD(this,C,this);jG[C]=B;g[C]=B.dD;B.dD.pL=DB(A.substring(0,H),false);}D=B.DB(A,false);}}}else if(A.startsWith(YL)){String I=A.split("/")[2];String C="${YL}${I}";BD B=jG[C];if(B==null){B=new BD(this,C,this);jG[C]=B;g[C]=B.dD;B.dD.pL=GF;}D=B.DB(A,false);}else if(A.startsWith("/upstream/")){String O=A.split("/")[2];String C="/upstream/${O}";BD B=jG[C];if(B==null){B=new BD(this,C,this);jG[C]=B;g[C]=B.dD;B.dD.pL=VN;}D=B.DB(A,false);}else if(A.startsWith("/sys/quarantine/")){List G=A.split("/");if(G.length>3){String I=G[3];String C="/sys/quarantine/${I}";BD B=jG[C];if(B==null){B=new BD(this,C,this);jG[C]=B;g[C]=B.dD;B.dD.pL=NN;FC.ID(Db,300);}D=B.DB(A,false);}else{D=new d(A,this);}}else if(A.startsWith("/defs/")){D=new QM(A,this);}else{D=new d(A,this);}if(D!=null){g[A]=D;}return D;}bool W_(d A){if(g[A.path]==A){g.remove(A);}return true;}final Map<String,hK> rHB=new Map<String,hK>();final Map<String,String> pHB=new Map<String,String>();final Map<String,String> qHB=new Map<String,String>();Map<String,hK> get sC=>rHB;String yO(String B,[bool H=false]){if(pHB.containsKey(B)){return pHB[B];}if(B.startsWith("@upstream@")){String I=B.substring(10);String A="/upstream/${I}";qHB[A]=B;pHB[B]=A;return A;}if(B.length<43){String A="${YL}${B}";int J=0;while(qHB.containsKey(A)){A="${YL}${B}-${J++ }";}qHB[A]=B;pHB[B]=A;return A;}else if(acceptAllConns||H){String A;String D=YL;String G=B;int C=43;if(G.length==43)C=42;for(;C>=0; --C){A="${D}${G.substring(0,G.length-C)}";if(C==43&&A.length>8&&A.endsWith("-")){A=A.substring(0,A.length-1);}if(!qHB.containsKey(A)){qHB[A]=B;pHB[B]=A;break;}}FC.ID(RK,300);return A;}else if(enabledQuarantine){String A;String D="/sys/quarantine/";A="${D}${B}";if(!qHB.containsKey(A)){qHB[A]=B;pHB[B]=A;}return A;}else{return null;}}String dv(String B,String G){if(pHB.containsKey(B)){return pHB[B];}if(G!=null&&G!=""){zE C=ZH.E$(G,B);if(C!=null){d J=C.X$();String A;String K="${J.path}/";String H=B;int D=43;if(H.length==43)D=42;for(;D>=0; --D){A="${K}${H.substring(0,H.length-D)}";if(D==43&&A.length>8&&A.endsWith("-")){A=A.substring(0,A.length-1);}if(!qHB.containsKey(A)){qHB[A]=B;pHB[B]=A;break;}}if(C.ECB(A)){KB I=DB(A,false);I.L[r"$$token"]=C.id;}if(C.group is String){KB I=DB(A,false);I.L[r"$$group"]=C.group;}FC.ID(RK,300);return A;}}return yO(B);}BD Xu(nd K,String B){String C="@upstream@${B}";BD A;if(rHB.containsKey(C)){return null;}else{rHB[C]=K;String D="/upstream/${B}";qHB[D]=C;pHB[C]=D;iC H=DB(D,false);VN.R[B]=H;VN.SB(B);A=H.oHB;A.TH=true;wB.kB("Link connected at ${D}");}if(!A.TH){List I=A.path.split("/");String J=I.removeLast();d G=DB(I.join("/"),false);G.R[J]=A.dD;A.dD.pL=G;A.TH=true;G.SB(J);FC.ID(RK,300);}return A;}bool KU(gJ A){String B=A.ZD;if(A.session!=""&&A.session!=null){B="${B} ${A.session}";}String C;if(rHB.containsKey(B)){}else{if(B.length>=43&&(A.session==null||A.session=="")){C=yO(B);if(C!=null){l D=DB(C,false)..L[r"$$dsId"]=B;if(D is eJ){D.oHB.QI=null;}wB.kB("Link connected at ${C}");}else{return false;}}rHB[B]=A;}return true;}gJ vZ(String D,{String sessionId: ""}){if(sessionId==null)sessionId="";String B=D;if(sessionId!=null&&sessionId!=""){B="${D} ${sessionId}";}else if(rHB[B]!=null){String G=yO(B);if(G==null){return null;}iC J=DB(G,false);BD A=J.oHB;if(!A.TH){List H=A.path.split("/");String I=H.removeLast();d C=DB(H.join("/"),false);C.R[I]=A.dD;A.dD.pL=C;A.TH=true;C.SB(I);if(A.path.startsWith(YL)){FC.ID(RK,300);}else if(A.path.startsWith("/sys/quarantine/")){FC.ID(Db,300);}}}return rHB[B];}void Xj(gJ A){if(rHB[A.ZD]==A){String B=pHB[A.ZD];if(B!=null&&B.startsWith("/sys/quarantine/")){qHB.remove(B);if(pHB[A.ZD]==B){pHB.remove(A.ZD);}NN.R.remove(A.ZD);jG[B].TH=false;NN.SB(A.ZD);FC.ID(Db,300);rHB.remove(A.ZD);}}}void mG(hK A,String C,{bool force: false}){if(rHB[C]==A||force){if(A is gJ){Xj(A);}A.close();rHB.remove(C);if(A is kI&&A.session!=""&&A.session!=null){String D=pHB[A.ZD];if(D!=null){BD B=jG[D];if(B!=null){if(B.MK.containsKey(A.session)){B.MK.remove(A.session);}if(A.VK!=null){A.VK=null;}if(A.connection!=null){A.connection=null;}}}}}}void LBB(String B){KB C=g[B];if(C is eJ){BD G=C.oHB;String A=qHB[B];if(A!=null){hK H=rHB[A];qHB.remove(B);pHB.remove(A);H.close();rHB.remove(A);FC.ID(RK,300);}String D=C.path.split("/").last;GF.R.remove(D);G.TH=false;GF.SB(D);}}void tx(String A,Map B){if(pHB.containsKey(A)){var C=DB(pHB[A],false);C.L[r"$linkData"]=B;}}pB li(String B){String A=yO(B);if(A==null)return null;if(jG.containsKey(A)){return jG[A].JB;}iC C=DB(A,false);return C.oHB.JB;}Y VR(String D,BF H,[String G="",bool I=false]){String B=yO(D);if(B==null)return null;iC C=DB(B,false);Y A=C.oHB.VR(H,D,G);if(B.startsWith("/sys/quarantine/")){A.uu=true;FC.ID(Db,300);}else if(C.L[r"$$group"] is String){List J=(C.L[r"$$group"] as String).split(",");A.VJ(J);}else if(I){A.VJ([":trustedLink"]);}if(SC!=null&&G==""&&A.SC==null){A.SC=SC.T$(B);}return A;}Y aU(String A,String B){return new aS(this,A);}void fk(String A,dynamic B){if(Lk!=null){Lk(A,B);}}void XBB(d A){if(A.mHB!=null){A.mHB.zB(A.HB);}}}class bS{String group;int oj;bool Aw;bS(this.group,this.oj){Aw=(group=='default');}}abstract class aF{List<bS> UH;aF kU(String A);void rF(Iterator<String> B,List<String> C,List<int> G){if(UH!=null){int J=C.length;for(int A=0;A<J; ++A){String K=C[A];for(bS D in UH){if(D.Aw||D.group==K){int H=D.oj;G[A]=H;if(H==b.s){return;}break;}}}}if(B.moveNext()){aF I=kU(B.current);if(I!=null){I.rF(B,C,G);}}}void tF(List B){if(B!=null&&B.length>0){if(UH==null){UH=new List<bS>();}else{UH.clear();}for(var A in B){if(A is List&&A.length==2&&A[0] is String&&A[1] is String){String D=A[0];String G=A[1];int C=b.vH(G);if(C==b.jS){continue;}UH.add(new bS(D,C));}}if(UH.isEmpty){UH=null;}}else{UH=null;}}List Kk(){if(UH==null){return null;}List A=[] ;if(UH!=null){for(var B in UH){A.add([B.group,b.fd[B.oj]]);}}return A;}}class fJ extends aF{Map<String,fJ> R=new Map<String,fJ>();aF kU(String A){return R[A];}void load(Map A){A.forEach((String C,Object B){if(B is Map){R[C]=new fJ()..load(B);}});if(A['?permissions'] is List){tF(A['?permissions']);}}Map XH(){Map A={};R.forEach((String C,fJ D){A[C]=D.XH();});List B=this.Kk();if(B!=null){A['?permissions']=B;}return A;}}class Rd implements oS{oW ZB;Rd();int rF(String H,Y B){if(ZB!=null&&ZB.UH!=null){List<int> C=new List<int>.filled(B.groups.length,b.iS);var D=H.split('/').iterator;D.moveNext();ZB.rF(D,B.groups,C);int A=b.iS;for(int G in C){if(G>A){A=G;}}return A;}return b.s;}}Map<String,dynamic> B3={"broker":{"userNode":{"addChild":{r"$invokable":"config",r"$params":[{"name":"Name","type":"string"}]},"removeNode":{r"$invokable":"config",r"$params":[{"name":"Recursive","type":"bool"}]}},"userRoot":{"addChild":{r"$invokable":"config",r"$params":[{"name":"Name","type":"string"}]},"addLink":{r"$invokable":"config",r"$params":[{"name":"Name","type":"string"},{"name":"Id","type":"string"}]}},"dataNode":{"addNode":{r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}]},"addValue":{r"$invokable":"write",r"$params":[{"name":"Name","type":"string"},{"name":"Type","type":"enum[string,number,bool,array,map,binary,dynamic]"},{"name":"Editor","type":"enum[none,textarea,password,daterange,date]"}]},"deleteNode":{r"$invokable":"write",r"$params":[{"name":"Recursive","type":"bool"}]},"renameNode":{r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}]},"duplicateNode":{r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}]}},"dataRoot":{"addNode":{r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}]},"addValue":{r"$invokable":"write",r"$params":[{"name":"Name","type":"string"},{"name":"Type","type":"enum[string,number,bool,array,map,binary,dynamic]"},{"name":"Editor","type":"enum[none,textarea,password,daterange,date]"}]},"publish":{r"$invokable":"write",r"$params":[{"name":"Path","type":"string"},{"name":"Value","type":"dynamic"},{"name":"Timestamp","type":"string"},{"name":"CloseStream","type":"bool"}]}},"token":{"delete":{r"$invokable":"config",r"$params":[] }},"tokenGroup":{"add":{r"$invokable":"config",r"$params":[{"name":"TimeRange","type":"string","editor":"daterange"},{"name":"Count","type":"number","description":"how many times this token can be used"},{"name":"Managed","type":"bool","description":"when a managed token is deleted, server will delete" " all the dslinks associated with the token"},{"name":"Group","type":"string","description":"default permission group"}],r"$columns":[{"name":"tokenName","type":"string"}]}}}};class mo extends VD{List AE;mo(String A,k B):super(A,B){AE=[{"name":"Data","type":"string","editor":"textarea","default":"[\n]"}];L[r"$name"]="Update Default Permission";L[r"$invokable"]="config";L[r'$params']=AE;}void sx(List C){if(C==null){return;}StringBuffer A=new StringBuffer();A.write('[\n');bool D=true;if(C!=null){for(List B in C){if(D){D=false;A.write('  ["${B[0]}","${B[1]}"]');}else{A.write(',\n  ["${B[0]}","${B[1]}"]');}}}A.write('\n]');AE[0]={"name":"Data","type":"string","editor":"textarea","default":A.toString()};SB(r'$params');}V WB(Map C,Y G,V B,l H,[int I=b.s]){if(C['Data'] is String){String D=C['Data'];List A;try {A=JSON.decode(D);k.xo(A);}catch (J){return B..close(X.iD);}sx(A);provider.uBB(A);provider.fk("defaultPermission",A);}else{return B..close(X.iD);}return B..close();}}class oo extends VD{oo(String B,k A):super(B,A){L[r"$name"]="Allow All Links";L[r"$writable"]="config";L[r"$type"]="bool";v(A.acceptAllConns);}q zB(Object A,Y C,q B,[int D=b.s]){if(A is!bool){return B..close(X.iD);}if(A!=provider.acceptAllConns){provider.acceptAllConns=A;provider.fk("allowAllLinks",A);}return super.zB(A,C,B,D);}}class so extends VD{so(String B,k A):super(B,A){L[r"$name"]="Enable Quarantine";L[r"$writable"]="config";L[r"$type"]="bool";v(A.enabledQuarantine);}q zB(Object A,Y C,q B,[int D=b.s]){if(A is!bool){return B..close(X.iD);}if(A!=provider.enabledQuarantine){provider.enabledQuarantine=A;provider.fk("quarantine",A);}return super.zB(A,C,B,D);}}class UD extends d{SQ SC;d parent;UD(String B,k A):super(B,A){if(A.OI!=null&&A.OI.rR!=null){SC=A.OI.rR.YR(B);}L[r'$is']='broker/dataNode';tC=A.DB('/defs/profile/broker/dataNode',false);L[r'$writable']='write';}q zB(Object A,Y B,q C,[int D=b.s]){if(parent==null){provider.DB(path,true);FC.ID((B.lB as k).pR,1000);}if(SC!=null&&(gL==null||gL.value!=A)){SC.zB(A);}return super.zB(A,B,C,D);}void load(Map B){super.load(B);R.forEach((String C,KB A){if(A is UD){A.parent=this;}});}q RN(String A,Object B,Y D,q C){if(!HB.containsKey(A)||HB[A]!=B){HB[A]=B;SB(A);lG();}return C..close();}bool lG(){FC.ID(provider.pR,1000);return true;}}class sN extends UD{RQ rR;d parent;sN(String B,k A):super(B,A){L[r'$is']='broker/dataRoot';L.remove(r'$writable');tC=A.DB('/defs/profile/broker/dataRoot',false);parent=this;}void init(){SC=rR.YR(path);}}V mW(Map D,Y I,V G,l B){Object A=D['Name'];Object H=D['Type'];Object J=D['Editor'];if(B is UD&&B.parent!=null&&A is String&&A!=''&&!A.contains(FB.lS)&&!A.startsWith(r'$')&&!A.startsWith(r'!')){if(B.R.containsKey(A)){return G..close(new X('invalidParameter',msg:'node already exist'));}UD C=I.lB.DB('${B.path}/${A}',false);if(H is String&&const['string','number','bool','array','map','binary','dynamic'].contains(H)){C.L[r'$type']=H;if(J is String){C.L[r'$editor']=J;}C.v(null);}B.R[A]=C;C.parent=B;B.SB(A);FC.ID((I.lB as k).pR,1000);return G..close();}return G..close(X.iD);}V H3(Map G,Y H,V B,l A){Object I=G['Recursive'];if(A is UD&&A is!sN&&A.parent!=null){if(I==true){Yd(A,A.path.substring(A.path.lastIndexOf('/')+1));}else{if(A.R.isEmpty){UD C=A.parent;String D=A.path.substring(A.path.lastIndexOf('/')+1);A.parent=null;A.HB.clear();if(A.SC!=null){A.SC.destroy();}C.R.remove(D);C.SB(D);A.XU();}else{return B..close(X.iD);}}FC.ID((H.lB as k).pR,1000);return B..close();}return B..close(X.iD);}V J3(Map D,Y G,V C,l A){Object B=D['Name'];if(A is UD&&A is!sN&&A.parent!=null&&B is String&&B!=''&&!A.R.containsKey(B)){Wd(A,A.parent,B);Yd(A,A.path.substring(A.path.lastIndexOf('/')+1));FC.ID((G.lB as k).pR,1000);return C..close();}return C..close(X.iD);}V K3(Map D,Y G,V C,l A){Object B=D['Name'];if(A is UD&&A is!sN&&A.parent!=null&&B is String&&B!=''&&!A.R.containsKey(B)){Wd(A,A.parent,B);FC.ID((G.lB as k).pR,1000);return C..close();}return C..close(X.iD);}UD Wd(UD D,UD C,String G){UD A=C.provider.DB('${C.path}/${G}',false);C.R[G]=A;A.parent=C;D.R.forEach((B,J){Wd(J,A,B);});D.L.forEach((B,H){A.L[B]=H;A.SB(B);});D.HB.forEach((B,H){A.HB[B]=H;A.SB(B);});Object I=D.value;if(I!=null){A.v(I);if(A is UD&&A.SC!=null){A.SC.zB(I);}}C.SB(G);return A;}void Yd(UD A,String B){for(String B in A.R.keys.toList()){Yd(A.R[B],B);}A.HB.clear();if(A.SC!=null){A.SC.destroy();}UD C=A.parent;A.parent=null;C.R.remove(B);C.SB(B);A.XU();}V O3(Map O,Y Q,V B,l I){bool J(V S,Map C){Object D=C['Path'];Object K=C['Value'];Object A=C['Timestamp'];Object P=C['CloseStream'];if(P==true){B..close();}if(D is String&&D.startsWith('/data/')){FB G=new FB(D);if(!G.Ba||!G.wR){return false;}UD M=(I.provider as k).sHB(G.path);if(A is String&&A.length>22){int H=(A as String).length;if(H>29&&H<35){A='${(A as String).substring(0,23)}${(A as String).substring(H-6)}';}try {DateTime.parse(A);M.v(new GB(K,ts:A));}catch (Z){return false;}}M.v(K);return true;}return false;}if(I is sN&&J(B,O)){B.Ra=J;return B;}return B..close(X.iD);}final Map<String,dynamic> Q3=<String,dynamic>{"broker":{"dataNode":{"addNode":mW,"addValue":mW,"deleteNode":H3,"renameNode":J3,"duplicateNode":K3},"dataRoot":{"addNode":mW,"addValue":mW,"publish":O3}}};class lo extends VD{lo(String A,k B):super(A,B){L[r"$name"]="Update Permissions";L[r"$invokable"]="read";L[r"$params"]=[{"name":"Path","type":"string"},{"name":"Permissions","type":"dynamic","editor":"textarea"}];}V WB(Map B,Y I,V G,l M,[int J=b.s]){if(J==b.s&&B!=null&&B["Path"] is String){List C;if(B["Permissions"] is List){C=B["Permissions"];}else if(B["Permissions"] is String){try {C=JSON.decode(B["Permissions"]);}catch (O){return G..close(X.iD);}}String H=B["Path"];int K=provider.oE.rF(H,I);if(K==b.s){if(C==null){l A=provider.yB(H);if(A is d){A.tF(null);if(!A.lG()){A.tF(null);G.close(X.DH);}}else if(A is iC){aF D=A.oHB.dD.jv(A.BC,false);if(D!=null){D.tF(null);A.oHB.dD.lG();}}}else{l A=provider.DB(H);if(A is d){A.tF(C);if(!A.lG()){A.tF(null);G.close(X.DH);}}else if(A is iC){aF D=A.oHB.dD.jv(A.BC,true);if(D!=null){D.tF(C);A.oHB.dD.lG();}}}}}return G..close();}Map TI(){var A=super.TI();A[r"$hidden"]=true;return A;}}class Od extends VD{List EEB=[] ;List GEB=[] ;List AE;Od(String A,k B):super(A,B){L[r"$name"]="Authorize";AE=[{"name":"DsId","type":"enum"},{"name":"Group","type":"string"},{"name":"Name","type":"string"}];L[r"$invokable"]="config";L[r"$params"]=AE;}void VJ(List B){if(B==null){return;}List A=[] ;for(List C in B){A.add(C[0]);}A.sort();AE[1]={"name":"Group","type":"string","editor":"enum[${A.join(',')}]"};SB(r'$params');}void vBB(List A){A.sort();AE[0]={"name":"DsId","type":"enum[${A.join(',')}]"};SB(r'$params');}V WB(Map C,Y J,V H,l K,[int M=b.s]){if(C['DsId'] is String){String A=C['DsId'];iC I=provider.NN.R[A];if(I!=null){String G;String B;String D;if(C['Group'] is String){G=C['Group'];}if(C['Name'] is String){B=C['Name'];}if(B!=null&&B!=''){if(provider.NN.R.containsKey(B)){return H..close(new X("invalidParameter",msg:"name already exists"));}}if(provider.rHB.containsKey(A)){provider.mG(provider.rHB[A],A);}if(B!=null&&B!=''){D=provider.YL+B;provider.qHB[D]=A;provider.pHB[A]=D;}else{provider.pHB.remove(A);D=provider.yO(A,true);}if(G!=null&&G!=''){provider.DB(D,false).L[r'$$group']=G;}}}else{return H..close(X.iD);}return H..close();}}class Qd extends VD{List AE;Qd(String A,k B):super(A,B){L[r"$name"]="Deauthorize";L[r"$invokable"]="config";AE=[{"name":"Name","type":"enum"}];L[r'$params']=AE;}void Cb(List A){AE[0]={"name":"Name","type":"enum[${A.join(',')}]"};SB(r'$params');}V WB(Map D,Y I,V G,l J,[int K=b.s]){if(D['Name'] is String){String B=D['Name'];iC H=provider.GF.R[B];if(H!=null){BD C=H.oHB;String A=provider.qHB[C.path];if(provider.rHB.containsKey(A)){provider.mG(provider.rHB[A],A);}provider.qHB.remove(C.path);provider.pHB.remove(A);provider.GF.R.remove(B);C.TH=false;provider.GF.SB(B);FC.ID(provider.RK,300);}}else{return G..close(X.iD);}return G..close();}}class Ud extends VD{List AE;Ud(String A,k B):super(A,B){L[r"$name"]="Update Permission Group";L[r"$invokable"]="config";AE=[{"name":"Name","type":"enum"},{"name":"Group","type":"group"}];L[r"$params"]=AE;}void Cb(List A){AE[0]={"name":"Name","type":"enum[${A.join(',')}]"};SB(r'$params');}void VJ(List B){if(B==null){return;}List A=[] ;for(List C in B){A.add(C[0]);}A.sort();AE[1]={"name":"Group","type":"string","editor":"enum[${A.join(',')}]"};SB(r'$params');}V WB(Map A,Y I,V D,l J,[int K=b.s]){if(A['Name'] is String){String H=A['Name'];iC B=provider.GF.R[H];if(B!=null){String G;if(A['Group'] is String){G=A['Group'];}B.L[r'$$group']=G;String C=provider.qHB[B.path];if(provider.rHB.containsKey(C)){provider.mG(provider.rHB[C],C);}FC.ID(provider.RK,300);}}else{return D..close(X.iD);}return D..close();}}class ko extends VD{MQ tHB;ko(String B,k A):super(B,A){tHB=new MQ(A);L[r"$name"]="Query";L[r"$invokable"]="write";L[r"$result"]="stream";L[r"$params"]=[{"name":"query","type":"string","editor":"textarea"}];}V WB(Map D,Y G,V C,KB H,[int I=b.s]){Object A=D["query"];fE B;if(A is String){B=tHB.yAB(A);}if(A is List){B=tHB.qw(A);}if(B==null){return C..close(X.iD);}B.KI(C);return C;}}class BD implements BF,xN{final Map<String,iC> g=new Map<String,iC>();final String path;final k TL;pB JB;eJ dD;bool TH=false;String QI=GB.LQ();BD(this.TL,this.path,xd B,[Map A]){JB=new io(this,path);dD=new eJ(path,'/',this);g['/']=dD;if(A!=null){dD.load(A);}}Map<String,Y> MK;Y VR(BF D,String B,[String A='']){if(MK==null){MK={};}if(MK.containsKey(A)){return MK[A]..nR=B;}else{var C=D.aU(B,A);C.nR=B;MK[A]=C;return C;}}l yB(String B){String A=B.replaceFirst(path,'');if(A==''){A='/';}return g[A];}l DB(String C,[bool D=true]){if(D==true){throw 'not supported';}String A=C.replaceFirst(path,'');if(A==''){A='/';}iC B=g[A];if(B==null){B=new iC(C,TL,A,this);g[A]=B;}return B;}l operator[](String A){return yB(A);}LC CK(String A){String C=path+A;if(A==''){A='/';}iC B=g[A];if(B==null){B=new iC(C,TL,A,this);g[A]=B;}return B;}KB av(String A,String C){if(uW.wW.containsKey(C)){return uW.wW[C];}if(A.startsWith('/defs/')&&TL.g.containsKey(A)){l B=TL.g[A];if(B is iJ&&B.Nw){return B;}}return CK(A);}LC Eb(LC A,String C,Map G){String B;if(A.BC=='/'){B='/${C}';}else{B='${A.BC}/${C}';}if(A is iC){iC D=A.oHB.CK(B);D.vR(G,this);return D;}return null;}l operator~()=>this['/'];oS get oE=>TL.oE;Y aU(String A,String B){throw 'not implemented';}void clear(){g.clear();}}class iC extends LC implements l{final k provider;jK Ji(pB A){return new Ap(this,A);}mI<String> uHB;mI<String> get sF{if(uHB==null){uHB=new mI<String>(gR,Uj);}return uHB;}Stream<String> get Ej=>sF.stream;StreamSubscription vHB;void gR(){if(vHB==null){vHB=oHB.JB.list(BC).listen(wHB);}}void Uj(){if(vHB!=null){vHB.cancel();vHB=null;}xHB=false;}void wHB(XG A){for(var B in A.dC){sF.add(B);}xHB=true;}Map<Function,int> ZC=new Map<Function,int>();kK wF(A(ValueUpdate),[int B=0]){ZC[A]=B;var C=new kK(this,A);if(Jb){A(yHB);}oHB.JB.wF(BC,v,B);return C;}void UJ(A(ValueUpdate)){if(ZC.containsKey(A)){ZC.remove(A);}if(ZC.isEmpty){oHB.JB.UJ(BC,v);zHB=false;}}GB yHB;GB get gL{return yHB;}dynamic get value{if(yHB!=null){return yHB.value;}return null;}void v(Object A,{bool force: false}){if(A is GB){yHB=A;ZC.forEach((B,C){B(yHB);});}else if(yHB==null||yHB.value!=A||force){yHB=new GB(A);ZC.forEach((B,C){B(yHB);});}zHB=true;}void XU(){zHB=false;yHB=null;}final String path;BD oHB;iC(this.path,this.provider,String A,this.oHB):super(A){}bool xHB=false;bool get Jw=>xHB;String get QI=>oHB.QI;bool zHB=false;bool get Jb=>zHB;bool get exists=>true;V WB(Map C,Y H,V A,l I,[int D=b.s]){if(oHB.QI!=null){return A..close(X.Fp);}StreamSubscription G=oHB.JB.WB(BC,C,D).listen((iK B){if(B.error!=null){A.close(B.error);}else{A.hB(B.RP,streamStatus:B.cE,columns:B.yw,meta:B.meta);}},onDone:(){A.close();});A.Ra=(V J,Map K){};A.mE=(V M){G.cancel();};return A;}KB SI(String A){return oHB.DB('${path}/${A}',false);}int tZ(){return b.vH(qF(r'$invokable'),b.pW);}int nv(){return b.vH(qF(r'$writable'),b.KQ);}q wj(String B,Y G,q A){if(!oHB.dD.yv){mw(B,value,true);return A..close();}String C;if(BC=='/'){C='/${B}';}else{C='${BC}/${B}';}oHB.JB.remove(C).then((H){A.close();}).catchError((D){if(D is X){A.close(D);}else{A.close(new X('internalError',detail:'${D}'));}});return A;}q FP(String D,Y G,q A){String B;if(BC=='/'){B='/${D}';}else{B='${BC}/${D}';}oHB.JB.remove(B).then((H){A.close();}).catchError((C){if(C is X){A.close(C);}else{A.close(new X('internalError',detail:'${C}'));}});return A;}q RN(String C,Object B,Y H,q A){if(!oHB.dD.yv||(B is Map&&B['@']!=null)){mw(C,B,false);return A..close();}String D;if(BC=='/'){D='/${C}';}else{D='${BC}/${C}';}oHB.JB.set(D,B).then((I){A.close();}).catchError((G){if(G is X){A.close(G);}else{A.close(new X('internalError',detail:'${G}'));}});return A;}q yL(String D,Object G,Y H,q A){String B;if(BC=='/'){B='/${D}';}else{B='${BC}/${D}';}oHB.JB.set(B,G).then((I){A.close();}).catchError((C){if(C is X){A.close(C);}else{A.close(new X('internalError',detail:'${C}'));}});return A;}q zB(Object C,Y G,q A,[int D=b.s]){oHB.JB.set(BC,C,D).then((H){A.close();}).catchError((B){if(B is X){A.close(B);}else{A.close(new X('internalError',detail:'${B}'));}});return A;}Map AIB;void vR(Map A,xN B){AIB=A;super.vR(A,B);}Map TI(){Map B=super.TI();if(AIB!=null){AIB.forEach((String A,C){if(A.startsWith(r'$')){B[A]=this.L[A];}});}return B;}bool get hasSubscriber{return ZC.isNotEmpty;}operator[](String A){return get(A);}operator[]=(String A,Object B){if(A.startsWith(r"$")){L[A]=B;}else if(A.startsWith(r"@")){HB[A]=B;}else if(B is KB){iB(A,B);}}SQ BIB;Map kG={};Map eU={};Object ki(String A){return kG[A];}void mw(String A,Object B,bool C){if(!C&&B is Map&&B['@']=='clear'){C=true;}if(BIB==null&&provider.bj!=null){BIB=provider.bj.YR(path);}if(C){if(kG.containsKey(A)){kG.remove(A);if(kG.containsKey(A)){HB[A]=kG[A];}else{HB.remove(A);}if(BIB!=null){if(kG.isEmpty){BIB.destroy();}else{BIB.zB(kG);}}sF.add(A);}}else if(B!=kG[A]){kG[A]=B;HB[A]=B;if(BIB!=null){BIB.zB(kG);}sF.add(A);}}bool Av(String A,Object B,bool C){if(C){if(eU.containsKey(A)){eU.remove(A);if(!kG.containsKey(A)){HB.remove(A);return true;}}}else if(eU[A]!=B){eU[A]==B;if(!kG.containsKey(A)){HB[A]=B;return true;}}return false;}void zBB(Map A){kG=A;A.forEach((B,C){HB[B]=C;});}void SV(){L.clear();HB.clear();eU.clear();R.clear();kG.forEach((A,B){HB[A]=B;});}void nw(mI<String> A){uHB=A;}void load(Map<String,dynamic> A){}}class Ap extends jK{Ap(LC A,pB B):super(A,B);void YI(String I,List G,List J,Map K,X M){bool H=false;if(G!=null){for(Object B in G){String A;Object C;bool D=false;if(B is Map){if(B['name'] is String){A=B['name'];}else{continue;}if(B['change']=='remove'){D=true;}else{C=B['value'];}}else if(B is List){if(B.length>0&&B[0] is String){A=B[0];if(B.length>1){C=B[1];}}else{continue;}}else{continue;}if(A.startsWith(r'$')){if(!H&&(A==r'$is'||A==r'$base'||(A==r'$disconnectedTs'&&C is String))){H=true;W.SV();}if(A==r'$base'&&C is String){C=(W as iC).oHB.path+C;}if(A==r'$is'&&!W.L.containsKey(r'$base')){W.L[r'$base']=(W as iC).oHB.path;dC.add(r'$base');}dC.add(A);if(D){W.L.remove(A);}else{W.L[A]=C;}}else if(A.startsWith('@')){if(D){if((W as iC).Av(A,null,true)){dC.add(A);}}else{if((W as iC).Av(A,C,false)){dC.add(A);}}}else{dC.add(A);if(D){W.R.remove(A);}else if(C is Map){W.R[A]=JB.lL.Eb(W,A,C);}}}if(qE.cE!=oB.OM){W.wU=true;}Pa();}}}class io extends pB implements Ae{final BD oHB;String QN;io(BD A,this.QN):super(A),oHB=A;void OJ(){oHB.QI=GB.LQ();super.OJ();}void KN(){oHB.QI=null;super.KN();}}const List<String> A3=const[r"$uid"];class eJ extends iC with aF implements d{eJ(String B,String C,BD A):super(B,A.TL,C,A);bool get Nw=>true;bool get yv{return L[r'$is']=='dsa/broker';}l pL;jK Ji(pB A){return new wo(this,A);}q yL(String A,Object B,Y C,q D){var G=QQ.AX(A,tC);return D..close(G.yL(B,this,C));}q FP(String A,Y B,q C){var D=QQ.AX(A,tC);return C..close(D.FP(this,B));}void load(Map C){C.forEach((String A,Object B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){HB[A]=B;}else if(B is Map){Ta[A]=new fJ()..load(B);}});if(C['?permissions'] is List){tF(C['?permissions']);}}Map XH(bool G){Map A={};L.forEach((String B,Object C){A[B]=C;});HB.forEach((String B,Object C){A[B]=C;});Ta.forEach((String B,fJ C){A[B]=C.XH();});List D=this.Kk();if(D!=null){A['?permissions']=D;}return A;}void SB(String A,[int B=b.pW]){sF.add(A);}void SV(){R.clear();L.remove(r'$disconnectedTs');}Map<String,fJ> Ta=new Map<String,fJ>();aF kU(String A){return Ta[A];}aF jv(String A,bool B){if(A=='/'){return this;}List C=A.split('/');return uo(this,C,1,B);}static aF uo(aF A,List D,int G,bool H){if(G>=D.length){return A;}String C=D[G];aF B;if(C==''){B=A;}else{B=A.kU(C);if(B==null){if(H){B=new fJ();if(A is eJ){A.Ta[C]=B;}else if(A is fJ){A.R[C]=B;}else{return null;}}else{return null;}}}return uo(B,D,G+1,H);}Map TI(){Map A=super.TI();if(L.containsKey(r'$linkData')){A[r'$linkData']=L[r'$linkData'];}return A;}bool lG(){FC.NX(provider.RK,3000);return true;}SQ mHB=null;}class wo extends jK{wo(LC A,pB B):super(A,B);void YI(String J,List G,List K,Map M,X O){bool H=false;if(G!=null){for(Object B in G){String A;Object C;bool D=false;if(B is Map){if(B['name'] is String){A=B['name'];}else{continue;}if(B['change']=='remove'){D=true;}else{C=B['value'];}}else if(B is List){if(B.length>0&&B[0] is String){A=B[0];if(B.length>1){C=B[1];}}else{continue;}}else{continue;}if(A3.contains(A)&&(A.startsWith(r"$")||A.startsWith("@"))){Map I=A.startsWith(r"$")?W.L:W.HB;if(D){I.remove(A);}else{I[A]=C;}dC.add(A);}if(A.startsWith(r'$')){if(!H&&(A==r'$is'||A==r'$base'||(A==r'$disconnectedTs'&&C is String))){if(A==r'$is'){if(C=='dsa/broker'){W.L[r'$is']='dsa/broker';}else{W.L[r'$is']='dsa/link';}}H=true;W.SV();dC.add(A);}else if(A.startsWith(r'$link_')){W.L[A]=C;dC.add(A);}}else if(A.startsWith('@')){W.HB[A]=C;dC.add(A);}else{dC.add(A);if(D){W.R.remove(A);}else if(C is Map){W.R[A]=JB.lL.Eb(W,A,C);}}}if(qE.cE!=oB.OM){W.wU=true;}Pa();}}}class aS extends Y{aS(BF A,String B):super(A,B);void WB(Map A){FB B=FB.sW(A['path']);if(B!=null&&B.isAbsolute){int K=A['rid'];l D=lB.DB(B.gB,false);l C;bool I=false;if(B.name=='getHistory'&&D.ki('@@getHistory') is Map){Map A=D.ki('@@getHistory');if(A['val'] is List&&(A['val'] as List).length>0){String B=A['val'][0];C=lB.DB(B,false);I=true;}else{C=D.SI(B.name);}}else{C=D.SI(B.name);}if(C==null){cC(A['rid'],error:X.DH);return;}int G=lB.oE.rF(B.path,this);int J=b.vH(A['permit']);if(J<G){G=J;}if(I){int H=lB.oE.rF(C.path,this);if(H<H){G=H;}}if(C.tZ()<=G){C.WB(A['params'],this,KI(new V(this,K,D,C,B.name)),D,G);}else{cC(A['rid'],error:X.DH);}}else{cC(A['rid'],error:X.mS);}}}class Md{final k provider;Md(this.provider);dS Sa;dS KZ;Re Xa;void init(){dS B(String C,String D){var A=new dS("/sys/${D}",provider);A.L.addAll({r"$name":C,r"$type":"number"});provider.u(A.path,A);return A;}Sa=B("Open Requests","openRequestsCount");KZ=B("Active Subscriptions","activeSubscriptionsCount");start();}void start(){Xa=U4.V4(WQ.T4,(){BCB();});}void BCB(){if(Sa!=null&&Sa.hasSubscriber){var A=provider.sC.values.fold(0,(int B,hK C)=>B+C.CC.vAB);Sa.v(A);}if(KZ!=null&&KZ.hasSubscriber){var A=provider.sC.values.fold(0,(int B,hK C)=>B+C.CC.Zx);KZ.v(A);}}void stop(){if(Xa!=null){Xa.xu();Xa=null;}}}class dS extends d{dS(String A,k B):super(A,B);}class jo{BH Mj;BH Pi;BH Qv;BH Lj;BH Oi;BH Pv;void i$(BF A){Mj=new BH("/sys/messagesOutPerSecond",A)..L[r"$type"]="number";Lj=new BH("/sys/messagesInPerSecond",A)..L[r"$type"]="number";Qv=new BH("/sys/frameOutPerSecond",A)..L[r"$type"]="number";Pv=new BH("/sys/frameInPerSecond",A)..L[r"$type"]="number";Pi=new BH("/sys/dataOutPerSecond",A)..L[r"$type"]="number"..L[r"@unit"]="bytes";Oi=new BH("/sys/dataInPerSecond",A)..L[r"$type"]="number"..L[r"@unit"]="bytes";}Timer CIB;void R_(Timer A){Lj.v(lC.DO,force:true);Oi.v(lC.tS,force:true);Mj.v(lC.EO,force:true);Pi.v(lC.uS,force:true);Pv.v(lC.EX,force:true);Qv.v(lC.FX,force:true);lC.DO=0;lC.tS=0;lC.EX=0;lC.EO=0;lC.uS=0;lC.FX=0;}void set TJ(bool A){if(A==lC.lI){return;}if(A){lC.lI=true;if(CIB==null){lC.DO=0;lC.tS=0;lC.EO=0;lC.uS=0;lC.FX=0;lC.EX=0;CIB=new Timer.periodic(const Duration(seconds:1),R_);}}else{lC.lI=Mj.TJ||Pi.TJ||Lj.TJ||Oi.TJ;if(!lC.lI&&CIB!=null){CIB.cancel();CIB=null;}}}}class BH extends VD{BH(String A,k B):super(A,B);bool TJ=false;kK wF(A(GB update),[int B=0]){if(!TJ){TJ=true;provider.pa.TJ=true;}return super.wF(A,B);}void UJ(A(GB update)){super.UJ(A);if(TJ&&ZC.isEmpty){TJ=false;provider.pa.TJ=false;}}}class Ld{final k TL;Ld(this.TL);Map<String,zE> UK=new Map<String,zE>();Map<String,zE> DIB={};Map<String,zE> get dV=>DIB;zE e_(String B,k G){if(DIB.containsKey(B)){return DIB[B];}String C=Ij();String D=C.substring(0,16);zE A=new zE(null,G,null,D);A.L[r'$$token']=C;A.init();UK[D]=A;DIB[B]=A;return A;}String Ij(){List<int> C=new List<int>(48);int B=0;while(B<48){int A=mK.CO.AP();if((A>=0x30&&A<=0x39)||(A>=0x41&&A<=0x5A)||(A>=0x61&&A<=0x7A)){C[B]=A;B++ ;}}String D=new String.fromCharCodes(C);String G=D.substring(0,16);if(UK.containsKey(G)){return Ij();}return D;}zE E$(String B,String G){if(B.length<16){return null;}String C=B.substring(0,16);String H=B.substring(16);if(!UK.containsKey(C)){return null;}zE A=UK[C];if(A.token==null||A.count==0){return null;}if(A.va>=0&&A.OP>=0){int D=new DateTime.now().millisecondsSinceEpoch;if(D<A.va||D>=A.OP){return null;}}String I=DX.cp(const Utf8Encoder().convert('${G}${A.token}'));if(I==H){return A;}return null;}}class uH extends VD{String qv;uH(String B,k A,this.qv):super(B,A){L[r'$is']='broker/tokenGroup';tC=A.DB('/defs/profile/broker/tokenGroup',false);}void init(){}bool nHB=false;void load(Map D){if(nHB){L.clear();HB.clear();R.clear();}D.forEach((String A,B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){HB[A]=B;}else if(B is Map){zE C=new zE('${path}/${A}',provider,this,A);provider.ZH.UK[A]=C;C.load(B);R[A]=C;}});nHB=true;}}class zE extends d{int va=-1;int OP=-1;int count=-1;Timer Wk;bool Jj=false;List sC;uH parent;String id;String token;String group;zE(String A,k B,this.parent,this.id):super(A,B){L[r'$is']='broker/token';tC=B.DB('/defs/profile/broker/token',false);if(A!=null){B.u(A,this);}}void load(Map A){super.load(A);init();}void init(){if(L[r'$$timeRange'] is String){String C=L[r'$$timeRange'];List A=C.split('/');if(A.length==2){try {va=DateTime.parse(A[0]).millisecondsSinceEpoch;OP=DateTime.parse(A[1]).millisecondsSinceEpoch;}catch (D){va=-1;OP=-1;}if(OP>-1){int B=new DateTime.now().millisecondsSinceEpoch;if(B<OP){Wk=new Timer(new Duration(milliseconds:OP-B),delete);}else{FC.TM(delete);}}}}if(L[r'$$count'] is num){count=(L[r'$$count'] as num).toInt();}if(L[r'$$managed']==true){Jj=true;if(L[r'$$links'] is List){sC=L[r'$$links'];}}if(L[r'$$token'] is String){token=L[r'$$token'];}if(L[r'$$group'] is String){group=L[r'$$group'];}}d X$(){return provider.GF;}bool ECB(String A){if(count>0||Jj){FC.ID(provider.Gk,1000);}if(count>0){count-- ;L[r'$$count']=count;SB(r'$$count');}if(Jj){if(sC==null){sC=[] ;L[r'$$links']=sC;}if(!sC.contains(A)){sC.add(A);}SB(r'$$links');return true;}return false;}void delete(){m_();parent.R.remove(id);provider.ZH.UK.remove(id);parent.SB(id);provider.W_(this);FC.ID(provider.Gk,1000);}void m_(){if(sC!=null){for(Object B in sC){if(B is String){Object A=provider.yB(B);if(A is eJ){Object C=A.L[r'$$token'];if(C==id){provider.LBB(A.path);}}}}}sC=null;}}V M3(Map C,Y D,V A,l B){if(B is zE){B.delete();return A..close();}return A..close(X.iD);}V N3(Map C,Y I,V G,l A){if(C==null){C={};}if(A is uH){String H=A.provider.ZH.Ij();String D=H.substring(0,16);zE B=new zE('${A.path}/${D}',A.provider,A,D);B.L[r'$$timeRange']=C['TimeRange'];B.L[r'$$count']=C['Count'];B.L[r'$$managed']=C['Managed'];B.L[r'$$group']=C['Group'];B.L[r'$$token']=H;B.init();A.provider.ZH.UK[D]=B;A.R[D]=B;A.SB(D);G.hB([[H]],streamStatus:oB.CD);FC.ID((I.lB as k).Gk,1000);return G;}return G..close(X.iD);}final Map<String,dynamic> P3=<String,dynamic>{"broker":{"token":{"delete":M3},"tokenGroup":{"add":N3}}};class Nd extends eS{void init(){provider.u("/sys/trace",this);provider.u("/sys/trace/traceRequester",ak);provider.u("/sys/trace/traceConnection",Zk);}Nd(k A):super("/sys/trace",A){ak=new nW(A);Zk=new Td(A);R["traceRequester"]=ak;R["traceConnection"]=Zk;}nW ak;Td Zk;}class lW{final String path;final String cBB;final nW W;final Y CC;lW(this.path,this.cBB,this.W,this.CC){CC.sh(sAB);VH=[] ;}Map<String,vD> Ai=new Map<String,vD>();Map<int,vD> zh=new Map<int,vD>();List<V> VH;void destroy(){W.EIB.remove(path);}void sAB(vD A){if(A==null)return;if(A.oO=="+"){if(A.type=="subscribe"){Ai[A.path]=A;}else{zh[A.cD]=A;}}else if(A.oO=="-"){if(A.type=="subscribe"){Ai.remove(A.path);}else{zh.remove(A.cD);}}if(VH!=null){for(V B in VH){B.hB([A.Fk]);}}}void add(V A){VH.add(A);A.mE=remove;A.hB(Ai.values.map((B)=>B.Fk).toList());A.hB(zh.values.map((B)=>B.Fk).toList());}void remove(V A){VH.remove(A);if(VH.isEmpty){destroy();}}}class nW extends d{nW(k A):super("/sys/trace/traceRequester",A){L[r"$invokable"]="config";L[r"$result"]="stream";L[r"$params"]=[{"name":"requester","type":"string","placeholder":"full path to the requester dslink"},{"name":"sessionId","type":"string"}];L[r"$columns"]=[{"name":"path","type":"string"},{"name":"type","type":"string"},{"name":"rid","type":"number"},{"name":"action","type":"string"},{"name":"change","type":"string"}];}Map<String,lW> EIB=new Map<String,lW>();V WB(Map G,Y H,V D,l I,[int J=b.s]){Object A=G["requester"];Object B=G["sessionId"];if(B==null)B="";KB C=provider.DB(A,false);if(A is String&&B is String&&C is eJ){if(C.oHB.MK!=null&&C.oHB.MK.containsKey(B)){if(!EIB.containsKey(A)){EIB[A]=new lW(A,B,this,C.oHB.MK[B]);}EIB[A].add(D);return D;}}return D..close(X.iD);}}class Td extends d{Td(k A):super("/sys/trace/traceConnection",A){L[r"$invokable"]="config";}}class rN extends VD{Sd cZ;rN(String B,k A):super(B,A){new Future((){cZ=new Sd("/sys/upstream/add_connection",A);A.u("/sys/upstream/add_connection",cZ);cZ.VJ(A.defaultPermission);});}void th(String A,String D,String G,String H,String I,[bool B=true]){if(B==null){B=true;}var C=new CH("/sys/upstream/${A}",A,D,G,H,I,provider);provider.u("/sys/upstream/${A}",C);(provider.DB("/sys/upstream",false) as d).SB(A);C.enabled=B;C.start();}void VAB(String B,String C){d A=provider.DB("/sys/upstream/${B}",false);if(A is CH){bool D=A.enabled;Bx(B);th(C,A.qG,A.hR,A.token,A.group,D);}}void Bx(String A){l B=provider.DB("/sys/upstream/${A}",false);if(B is CH){B.stop();B.dx=true;R.remove(A);var C="/sys/upstream/${A}/";provider.g.remove(C.substring(0,C.length-1));List<String> D=provider.g.keys.where((G)=>G.startsWith(C)).toList();D.forEach(provider.g.remove);SB(A);provider.Y_();}}void DAB(Map B){for(var C in B.keys){var A=B[C];th(C,A["url"],A["name"],A["token"],A["group"],A["enabled"]);}}Map Zv(){List<CH> C=provider.g.keys.where((A){try {if(A.startsWith("/sys/upstream/")&&A!="/sys/upstream/add_connection"){return A.codeUnits.where((D)=>D=="/".codeUnitAt(0)).length==3;}else{return false;}}catch (G){return false;}}).map((A)=>provider.DB(A,false)).where((A)=>A!=null).where((A)=>A is CH).where((CH A)=>!A.dx).toList();var B={};C.forEach((A){B[A.name]={"name":A.hR,"url":A.qG,"enabled":A.enabled,"token":A.token,"group":A.group};});return B;}void update(){if(YI!=null){YI(Zv());}}Function YI;}class Sd extends d{List AE;Sd(String A,k B):super(A,B){L[r"$name"]="Add Upstream Connection";L[r"$invokable"]="write";AE=[{"name":"Name","type":"string","description":"Upstream Broker Name","placeholder":"UpstreamBroker"},{"name":"Url","type":"string","description":"Url to the Upstream Broker","placeholder":"http://upstream.broker.com/conn"},{"name":"Broker Name","type":"string","description":"The name of the link when connected to the Upstream Broker","placeholder":"ThisBroker"},{"name":"Token","type":"string","description":"Broker Token (if needed)","placeholder":"OptionalAuthToken"},{"name":"Group","type":"string"}];L[r"$params"]=AE;L[r"$result"]="values";}void VJ(List B){if(B==null){return;}List A=[] ;for(List C in B){A.add(C[0]);}A.sort();AE[4]={"name":"Group","type":"string","editor":"enum[${A.join(',')}]"};SB(r'$params');}V WB(Map A,Y K,V B,KB M,[int O=b.s]){var C=A["Name"];var D=A["Broker Name"];var G=A["Url"];var H=A["Token"];var I=A["Group"];rN J=provider.DB("/sys/upstream",false) as rN;J.th(C,G,D,H,I);provider.dE.update();return B..close();}}class yo extends d{final String name;yo(String A,this.name,k B):super(A,B){L[r"$name"]="Remove";L[r"$invokable"]="write";L[r"$result"]="values";}V WB(Map C,Y D,V A,KB G,[int H=b.s]){var B=provider.DB("/sys/upstream",false) as rN;B.Bx(name);provider.dE.update();return A..close();}}class Vd extends d{Vd(String A,k B):super(A,B);q zB(Object B,Y D,q C,[int G=b.s]){if(B!=null&&B.toString().length>0){var H=new FB(path).gB;CH A=provider.DB(H,false);A.provider.mG(A.fC,"@upstream@${A.name}",force:true);A.stop();A.qG=B.toString();A.enabled=true;A.start();provider.dE.update();return super.zB(B,D,C,G);}return C..close();}}class Xd extends d{Xd(String A,k B):super(A,B);q zB(Object B,Y D,q C,[int G=b.s]){if(B!=null&&B.toString().length>0){var H=new FB(path).gB;CH A=provider.DB(H,false);A.provider.mG(A.fC,"@upstream@${A.name}",force:true);A.stop();A.hR=B.toString();A.enabled=true;A.start();provider.dE.update();return super.zB(B,D,C,G);}return C..close();}}class Zd extends d{Zd(String A,k B):super(A,B);q zB(Object A,Y H,q B,[int I=b.s]){if(A!=null&&A.toString().length>0&&provider.yB("/sys/upstream/${A}")==null){var C=new FB(path).gB;CH D=provider.DB(C,false);var G=provider.DB("/sys/upstream",false) as rN;G.VAB(D.name,A.toString());}provider.dE.update();return B..close();}}class ad extends d{ad(String A,k B):super(A,B);q zB(Object B,Y D,q C,[int G=b.s]){if(B!=null&&B.toString().length>0){var H=new FB(path).gB;CH A=provider.DB(H,false);A.provider.mG(A.fC,"@upstream@${A.name}",force:true);A.stop();A.token=B.toString();A.enabled=true;A.start();provider.dE.update();return super.zB(B,D,C,G);}return C..close();}}class bd extends d{bd(String A,k B):super(A,B);q zB(Object B,Y D,q C,[int G=b.s]){if(B!=null&&B.toString().length>0){var H=new FB(path).gB;CH A=provider.DB(H,false);A.provider.mG(A.fC,"@upstream@${A.name}",force:true);A.stop();A.group=B.toString();A.enabled=true;A.start();provider.dE.update();return super.zB(B,D,C,G);}return C..close();}}class cd extends d{cd(String A,k B):super(A,B);q zB(Object B,Y C,q D,[int G=b.s]){var H=new FB(path).gB;CH A=provider.DB(H,false);if(B&&A.enabled==false){A.enabled=true;A.start();}else{A.enabled=false;A.stop();}provider.dE.update();return super.zB(B,C,D,G);}}class CH extends d{String name;String qG;String token;String group;String hR;cd ZL;Vd TP;Zd zO;ad NP;bd sO;Xd mO;bool enabled=false;bool dx=false;JQ fC;CH(String C,this.name,this.qG,this.hR,this.token,this.group,k A):super(C,A){ZL=new cd("/sys/upstream/${name}/enabled",A);ZL.L[r"$type"]="bool";ZL.L[r"$writable"]="write";ZL.v(enabled);TP=new Vd("/sys/upstream/${name}/url",A);TP.L[r"$type"]="string";TP.L[r"$writable"]="write";TP.v(qG);zO=new Zd("/sys/upstream/${name}/name",A);zO.L[r"$type"]="string";zO.L[r"$writable"]="write";zO.v(name);mO=new Xd("/sys/upstream/${name}/brokerName",A);mO.L[r"$type"]="string";mO.L[r"$writable"]="write";mO.v(hR);NP=new ad("/sys/upstream/${name}/token",A);NP.L[r"$type"]="string";NP.L[r"$writable"]="write";NP.v(token);sO=new bd("/sys/upstream/${name}/group",A);sO.L[r"$type"]="string";sO.L[r"$writable"]="write";sO.v(group);new Future((){var B=new yo("/sys/upstream/${name}/delete",name,A);A.u("/sys/upstream/${name}/delete",B);A.u(ZL.path,ZL);A.u(TP.path,TP);A.u(zO.path,zO);A.u(mO.path,mO);A.u(NP.path,NP);A.u(sO.path,sO);iB("delete",B);iB("enabled",ZL);iB("url",TP);iB("name",zO);iB("brokerName",mO);iB("token",NP);iB("group",sO);});}void start(){if(!enabled){return;}k A=provider;String C="@upstream@${name}";String D=provider.yO(C);if(D!=null){iC G=provider.DB(D,false);G.L[r'$$group']=group;}pB H=provider.li(C);Y I=provider.VR(C,provider);SE J=Pd();fC=new JQ(qG,"${hR}-",J,nodeProvider:A,isRequester:true,isResponder:true,overrideRequester:H,overrideResponder:I,token:(token!=null&&token.isNotEmpty)?token:null);fC.uF="Upstream at /upstream/${name}";fC.connect();BD B=A.Xu(fC,name);if(B==null){A.mG(fC,"@upstream@${name}",force:true);B=A.Xu(fC,name);}ZL.v(true);enabled=true;fC.LN.then((pB K){if(fC.BC!=null){B.dD.L[r"$remotePath"]=fC.BC;B.dD.SB(r"$remotePath");}});}void stop(){if(fC==null){return;}fC.close();k A=provider;A.mG(fC,"@upstream@${name}",force:true);ZL.v(false);enabled=false;}}class tH extends d{final String username;tH(String B,k A,this.username):super(B,A){L[r'$is']='broker/userNode';tC=A.DB('/defs/profile/broker/userNode',false);}d parent;bool nHB=false;void load(Map I){if(nHB){L.clear();HB.clear();R.clear();}String D;if(path=='/'){D='/';}else{D='${path}/';}I.forEach((String B,C){if(B.startsWith(r'$')){L[B]=C;}else if(B.startsWith('@')){HB[B]=C;}else if(C is Map){String G='${D}${B}';l A=provider.DB(G,false);if(A is tH){A.parent=this;}R[B]=A;if(A is tH){A.load(C);}else if(A is eJ){A.load(C);A.oHB.TH=true;if(A.L[r'$$dsId'] is String){String H='${username}:${A.L[r'$$dsId']}';provider.pHB[H]=G;provider.qHB[G]=H;}}}});nHB=true;}}class cS extends tH{cS(String B,String C,k A):super(B,A,C){L[r'$is']='broker/userRoot';tC=A.DB('/defs/profile/broker/userRoot',false);}}V po(Map H,Y C,V D,l B){Object A=H['Name'];if(B is tH&&A is String&&A!=''&&!A.contains(FB.lS)&&!A.startsWith(r'$')&&!A.startsWith(r'!')&&!A.startsWith(r'#')){if(B.R.containsKey(A)){return D..close(new X('invalidParameter',msg:'node already exist'));}tH G=C.lB.DB('${B.path}/${A}',false);G.parent=B;B.R[A]=G;B.SB(A);FC.ID((C.lB as k).Hk,1000);}return D..close(X.iD);}V vo(Map I,Y J,V G,l B){Object A=I['Name'];Object K=I['Id'];if(B is tH&&A is String&&A!=''&&!A.contains(FB.lS)&&!A.startsWith(r'$')&&!A.startsWith('!')){if(!(A as String).startsWith('#')){A='#${A}';}if(B.R.containsKey(A)){return G..close(new X('invalidParameter',msg:'node already exist'));}String C='${B.username}:${K}';String M=B.provider.pHB[C];if(M!=null&&M.startsWith('/users/')){return G..close(new X('invalidParameter',msg:'id already in use'));}String H='${B.path}/${A}';B.provider.pHB[C]=H;B.provider.qHB[H]=C;gJ D=B.provider.vZ(C);if(D!=null){D.close();B.provider.mG(D,D.ZD);}l O=J.lB.DB(H,false);O.L[r'$$dsId']=K;B.R[A]=O;B.SB(A);FC.ID((J.lB as k).Hk,1000);}return G..close(X.iD);}V I3(Map G,Y H,V B,l A){Object I=G['Recursive'];if(A is tH&&A is!cS&&A.parent!=null){if(I==true){zo(A,A.path.substring(A.path.lastIndexOf('/')+1));}else{if(A.R.isEmpty){tH C=A.parent;String D=A.path.substring(A.path.lastIndexOf('/')+1);A.parent=null;A.HB.clear();C.R.remove(D);C.SB(D);A.XU();}else{return B..close(X.iD);}}FC.ID((H.lB as k).Hk,1000);return B..close();}return B..close(X.iD);}void zo(tH A,String B){for(String B in A.R.keys.toList()){zo(A.R[B],B);}A.HB.clear();tH C=A.parent;A.parent=null;C.R.remove(B);C.SB(B);A.XU();}final Map<String,dynamic> L3=<String,dynamic>{"broker":{"userNode":{"addChild":po,"addLink":vo,"removeNode":I3},"userRoot":{"addChild":po,"addLink":vo}}};class y2 implements kS{final Map<String,kI> rHB=new Map<String,kI>();bool KU(gJ A){rHB[A.ZD]=A;return true;}gJ vZ(String A,{String sessionId: ""}){return rHB[A];}void mG(gJ B,String A){if(rHB[A]==B){rHB.remove(A);}}pB li(String A){return new pB();}Y VR(String B,BF A,[String C="",bool D=false]){return new Y(A);}void tx(String A,Map B){}String dv(String A,String B){return "/${A}";}void Xj(gJ A){}}typedef Future<WebSocket> C3(HttpRequest _0,bool _1,[_2(List<String> _0)]);typedef void D3(kI _0);class kI implements gJ{static const bool E3=const bool.fromEnvironment("dsa.msgpack.enabled",defaultValue:true);final String ZD;final String session;final String token;final wH pE;String path;String PEB;String uF;D3 onDisconnect;Completer<pB> Zj=new Completer<pB>();Future<pB> get LN=>Zj.future;pB JB;Y CC;hE sR;hE jV;hE get nonce=>jV;gd connection;final bool enableTimeout;final bool enableAck;final List<String> FIB=new List<String>(3);final List<int> GIB=<int>[0,0,0];final List<String> QJ=new List<String>(3);void HIB(int A){GIB[A]+=mK.CO.bAB();QJ[A]='${FIB[A]}${GIB[A].toRadixString(16)}';}kI(String A,this.pE,kS C,{BF nodeProvider,this.session,this.token,this.enableTimeout: false,this.enableAck: true,this.onDisconnect,bool trusted: false}):ZD=A{path=C.dv(A,token);if(path!=null){JB=C.li(A);if(nodeProvider!=null){CC=C.VR(A,nodeProvider,session,trusted);}}for(int B=0;B<3; ++B){List<int> G=new List<int>(12);for(int D=0;D<12; ++D){G[D]=mK.CO.AP();}FIB[B]=bG.UM(G);HIB(B);}}bool get q${return pE.HCB(ZD);}bool isRequester=false;bool Xi;bool isResponder=true;Map Ua;h$(HttpRequest C,bool D,bool G,String H,String I,{String wsUri: '/ws',String httpUri: '/http',int updateInterval: 200,Map linkData,List formats,bool trusted: false,bool enableCompression: false})async{isRequester=G;isResponder=D;Ua=linkData;Map A={"id":H,"publicKey":I,"wsUri":wsUri,"httpUri":httpUri,"updateInterval":updateInterval,"version":KX};if(!trusted){sR=await hE.C4(pE,jV);A["tempKey"]=sR.Zi;A["salt"]=QJ[0];A["saltS"]=QJ[1];A["saltL"]=QJ[2];}if(JB is Ae){A["path"]=(JB as Ae).QN;}if(formats!=null){if(formats.contains('msgpack')&&E3){A['format']='msgpack';}else{A['format']='json';}}else{A['format']='json';}if(enableCompression==true){Xi=true;}{String J="Handshake Response: ${A}";String B;if(uF!=null){B=uF;}else if(path!=null){B="Link at ${path}";}else{B="Link ${ZD}";}wB.eC("[${B}] ${J}]");}rS(C);C.response.write(PC.FH(A));C.response.close();}bool lV(int A,String B){if(B==null){return false;}if(jV!=null&&jV.lV(QJ[A],B)){HIB(A);return true;}else if(sR!=null&&sR.lV(QJ[A],B)){HIB(A);cAB();return true;}return false;}void cAB(){jV=sR;sR=null;if(connection!=null){connection.close();connection=null;}}lC VK;void oi(HttpRequest A,bool D,[C3 B]){if(B==null){B=(A,G,[H])=>nS.i3(A,H,G);}if(!D&&!lV(0,A.uri.queryParameters['auth'])){wB.gC("${ZD} was rejected due to an improper auth value");throw HttpStatus.UNAUTHORIZED;}if(VK!=null){VK.close();}rS(A,null,null,true);B(A,Xi,(J)=>null).then((WebSocket I){VK=f_(I,A.uri.queryParameters['format']);VK.JU('salt',QJ[0]);if(connection!=null){connection.close();}connection=VK;if(CC!=null&&isResponder){CC.connection=connection.Ck;}if(JB!=null&&isRequester){JB.connection=connection.Cx;if(!Zj.isCompleted){Zj.complete(JB);}}}).catchError((C){try {if(C is WebSocketException){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("Failed to upgrade to a WebSocket.");}else{A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln("Internal Server Error");}}catch (C){}if(onDisconnect!=null){onDisconnect(this);}return A.response.close();});}void close(){if(VK!=null){VK.close();VK=null;connection=null;}}lC f_(WebSocket B,String C){var A=new lC(B,enableTimeout:enableTimeout,enableAck:enableAck,useCodec:nI.jp(C));B.done.then((D){close();});if(onDisconnect!=null){A.OJ.then((D){onDisconnect(this);close();});}A.vw=false;if(uF!=null){A.uF=uF;}else if(path!=null){A.uF="Link at ${path}";}else{A.uF="Link ${ZD}";}return A;}}class fS{RawDatagramSocket IIB;fS();Future init([bool D=false])async{IIB=await RawDatagramSocket.bind("0.0.0.0",D?1900:0);IIB.multicastHops=10;IIB.broadcastEnabled=true;IIB.listen((RawSocketEvent B){if(B==RawSocketEvent.READ){var A=IIB.receive();IIB.writeEventsEnabled=true;if(A==null){return;}var G=UTF8.decode(A.data);JIB(A,G);}else if(B==RawSocketEvent.CLOSED){if(!KIB.isClosed){KIB.close();}}});IIB.writeEventsEnabled=true;var H=await NetworkInterface.list();try {for(var C in H){try {IIB.joinMulticast(new InternetAddress("239.255.255.230"),interface:C);}catch (I){IIB.joinMulticast(new InternetAddress("239.255.255.230"),interface:C);}}}catch (I){IIB.joinMulticast(new InternetAddress("239.255.255.230"));}}Stream<String> p_({Duration timeout: const Duration(seconds:5)}){LIB("DISCOVER","239.255.255.230",1900);Stream<String> A=KIB.stream;new Future.delayed(timeout,(){close();});return A;}void LIB(String A,String B,int C){IIB.send(UTF8.encode(A),new InternetAddress(B),C);}Stream<gS> get RBB=>MIB.stream;void JIB(Datagram C,String D){var A=D.split(" ");var B=A[0];var G=A.skip(1).join(" ");if(B=="BROKER"){KIB.add(G);}else if(B=="DISCOVER"){MIB.add(new gS(this,C));}}StreamController<gS> MIB=new StreamController.broadcast();StreamController<String> KIB=new StreamController.broadcast();void close(){IIB.close();}}class gS{final fS gu;final Datagram ij;gS(this.gu,this.ij);void QBB(String A){gu.LIB("BROKER ${A}",ij.address.address,ij.port);}}typedef void R3(YK _0);typedef dynamic S3(String _0,aG _1);class dd{JQ fC;BF provider;SE CE;String LG;File NIB;String vF;List<String> aE;bool isRequester=false;String command="link";bool isResponder=true;Map<String,dynamic> defaultNodes;Map<String,Function> profiles;bool enableHttp=true;bool encodePrettyJson=false;bool strictOptions=false;bool exitOnFailure=true;bool loadNodesJson=true;String defaultLogLevel="INFO";String MAB;bool savePrivateKey=false;pB overrideRequester;Y overrideResponder;Map linkData;String home;String token;dd(this.aE,this.vF,{this.isRequester: false,this.command: "link",this.isResponder: true,this.defaultNodes,Map<String,dynamic> nodes,this.profiles,this.provider,this.enableHttp: true,this.encodePrettyJson: false,bool autoInitialize: true,this.strictOptions: false,this.exitOnFailure: true,this.loadNodesJson: true,this.defaultLogLevel: "INFO",this.savePrivateKey: true,this.overrideRequester,this.overrideResponder,BF nodeProvider,this.linkData}){exitOnFailure=Zone.current["dslink.runtime.config"] is!Map;if(nodeProvider!=null){provider=nodeProvider;}if(nodes!=null){defaultNodes=nodes;}if(autoInitialize){init();}}String OIB=Directory.current.path;String PIB;String QIB;bool RIB=false;String SIB(RB A){return A.name.toLowerCase();}bool a_({dH argp,R3 optionsHandler}){RIB=true;if(fC!=null){fC.close();fC=null;}if(argp==null){argp=new dH(allowTrailingOptions:!strictOptions);}argp.JI("broker",abbr:"b",help:"Broker URL",defaultsTo:"http://127.0.0.1:8080/conn");argp.JI("name",abbr:"n",help:"Link Name");argp.JI("home",help:"Home");argp.JI("token",help:"Token");argp.JI("base-path",help:"Base Path for DSLink");argp.JI("watch-file",help:"Watch File for DSLink",hide:true);argp.JI("log-file",help:"Log File for DSLink");List<String> P=RB.ge.map(SIB).toList();P.addAll(["auto","debug"]);argp.JI("log",abbr:"l",allowed:P,help:"Log Level",defaultsTo:"AUTO");argp.Vu("help",abbr:"h",help:"Displays this Help Message",negatable:false);argp.Vu("discover",abbr:"d",help:"Automatically Discover a Broker",negatable:false);YK A=argp.BE(aE);if(A["log"]=="auto"){if(O4){zS("all");}else{zS(defaultLogLevel);}}else{zS(A["log"]);}if(A["base-path"]!=null){OIB=A["base-path"];if(OIB.endsWith("/")){OIB=OIB.substring(0,OIB.length-1);}}if(A["watch-file"]!=null){PIB=A["watch-file"];}QIB=A["log-file"];if(QIB!=null){var G=new File(QIB);if(!G.existsSync()){G.createSync(recursive:true);}wB.Ei();IOSink I=TIB=G.openWrite(mode:FileMode.APPEND);wB.Qa.listen((B){I.writeln("[${new DateTime.now()}][${B.level.name}] ${B.message}");if(B.error!=null){I.writeln(B.error);}if(B.stackTrace!=null){I.writeln(B.stackTrace);}I.flush();});}if(PIB!=null){var G=new File(PIB);StreamSubscription Q;Q=G.watch(events:FileSystemEvent.DELETE).listen((tB){close();Q.cancel();if(TIB!=null){try {TIB.close();}catch (C){}}});}if(const bool.fromEnvironment("dslink.debugger.console",defaultValue:false)){f3().listen((String S){if(S=="list-stored-nodes"){if(provider is aG){aG H=provider;print(H.g.keys.join("\n"));}else{print("Not a SimpleNodeProvider.");}}else if(S=="list-stub-nodes"){if(provider is aG){aG H=provider;for(var M in H.g.values){FB O=new FB(M.path);if(H.g[O.gB]==null){print(M.path);}else if(!H.g[O.gB].R.containsKey(O.name)){print(M.path);}}}else{print("Not a SimpleNodeProvider.");}}});}{var Z=Zone.current["dslink.runtime.config"];if(Z!=null){var dB=(){close();if(TIB!=null){try {TIB.close();}catch (C){}}};Z["closeHandler"]=dB;}}String h="usage: ${command} [--broker URL] [--log LEVEL] [--name NAME] [--discover]";if(A["help"]){print(h);print(argp.xx);if(exitOnFailure){exit(1);}else{return false;}}LG=A["broker"];if(LG==null&&!A["discover"]){print("No Broker URL Specified. One of [--broker, --discover] is required.");print(h);print(argp.xx);if(exitOnFailure){exit(1);}else{return false;}}String J=A["name"];home=A["home"];token=A["token"];if(J!=null){if(J.endsWith("-")){vF=J;}else{vF="${J}-";}}File p=new File("${OIB}/dslink.json");if(p.existsSync()){var C;try {String sB=p.readAsStringSync();BN=PC.CF(sB);}catch (EB){C=EB;}if(BN==null){wB.oC("Invalid dslink.json",C);if(exitOnFailure){exit(1);}else{return false;}}}else{BN={};}if(LG!=null){if(!LG.startsWith("http")){LG="http://${LG}";}}File PB=qF("key")==null?new File("${OIB}/.dslink.key"):new File.fromUri(Uri.parse(qF("key")));String D;try {D=PB.readAsStringSync();CE=new SE.yCB(D);}catch (EB){}if(D==null||D.length!=131){if(mK.CO.Xw){String K;if(Platform.isWindows){K=Process.runSync("getmac",[] ).stdout.toString();}else{try {K=Process.runSync("arp",["-an"]).stdout.toString();}catch (C){try {var TB="";for(var UB in Platform.environment.keys){TB+= "${UB}=${Platform.environment[UB]}\n";}K=TB;}catch (C){}}}mK.CO.Uu(K);}CE=new SE.xCB();D=CE.Ix();if(savePrivateKey){PB.writeAsStringSync(D);}}if(A["discover"]){UIB=true;}if(optionsHandler!=null){optionsHandler(A);}return true;}Future<String> U_(Stream<String> A)async{return await A.first;}bool UIB=false;String get BC=>fC.BC;IOSink TIB;bool VIB=false;void init(){if(!RIB){if(!a_()){return;}}if(WIB){return;}WIB=true;if(profiles!=null){for(var A in profiles.keys.toList()){var B=profiles[A];if(B is S3){profiles[A]=(String H){return B(H,provider);};}}}if(provider==null){provider=new aG(null,profiles);(provider as aG).eBB(WBB);}IAB();void C(){fC=c_();XIB=true;if(YIB){connect();}}if(UIB){var D=new fS();new Future(()async{await D.init();try {var G=await U_(D.p_());wB.kB("Discovered Broker at ${G}");LG=G;C();}catch (I,J){wB.oC("Failed to discover a broker.",I,J);exit(1);}});}else{C();}}JQ c_(){var A=new JQ(LG,vF,CE,isRequester:isRequester,isResponder:isResponder,nodeProvider:provider,overrideRequester:overrideRequester,overrideResponder:overrideResponder,home:home,token:token,linkData:linkData);A.uF=MAB;return A;}void IAB(){if(provider is cF&&!VIB){NIB=qF("nodes")==null?new File("${OIB}/nodes.json"):new File.fromUri(Uri.parse(qF("nodes")));Map<String,dynamic> A;if(loadNodesJson){NIB=qF("nodes")==null?new File("${OIB}/nodes.json"):new File.fromUri(Uri.parse(qF("nodes")));try {String C=NIB.readAsStringSync();var B=PC.CF(C);if(B is Map<String,dynamic>){A=B;}}catch (D){}}if(A!=null){kAB(A);(provider as cF).init(A);}else if(defaultNodes!=null){(provider as cF).init(defaultNodes);}}}Map BN;Object qF(String A){if(BN!=null&&BN["configs"] is Map&&BN["configs"][A] is Map&&BN["configs"][A].containsKey("value")){return BN["configs"][A]["value"];}return null;}void kAB(Map A){}bool WIB=false;bool XIB=false;bool YIB=false;Future connect(){if(ZIB==null){ZIB=new Completer();}if(!RIB||!WIB){init();}if(XIB){fC.Wj.then(ZIB.complete);if(fC!=null)fC.connect();}else{YIB=true;}return ZIB.future;}Completer ZIB;pB get JB=>fC.JB;Future<pB> get LN=>fC.LN;void close(){ZIB=null;if(fC!=null){fC.close();fC=null;WIB=false;VIB=true;}}void stop()=>close();void rE(){if(NIB!=null&&provider!=null){if(provider is!cF){return;}NIB.writeAsStringSync(PC.FH((provider as cF).rE(),pretty:encodePrettyJson));}}Future WBB()async{if(NIB!=null&&provider!=null){if(provider is!cF){return;}var A=0;while(aIB){await new Future.delayed(const Duration(milliseconds:5));A++ ;if(A==100){break;}}var B=PC.FH((provider as cF).rE(),pretty:encodePrettyJson);aIB=true;await NIB.writeAsString(B);aIB=false;}}bool aIB=false;l yB(String A){return provider.yB(A);}l NZ(String A,Map B){if(provider is!AO){throw new Exception("Unable to Modify Node Provider: It is not mutable.");}return (provider as AO).NZ(A,B);}void mR(String A){if(provider is!AO){throw new Exception("Unable to Modify Node Provider: It is not mutable.");}(provider as AO).mR(A);}void v(String A,dynamic B){if(provider is!AO){throw new Exception("Unable to Modify Node Provider: It is not mutable.");}(provider as AO).v(A,B);}l operator[](String A)=>provider[A];l operator~()=>this["/"];}class JQ extends nd{Completer<pB> bIB=new Completer<pB>();Completer cIB=new Completer();Future<pB> get LN=>bIB.future;Future get Wj=>cIB.future;String BC;final String ZD;final String home;final String token;final SE CE;String bV;pB JB;Y CC;bool DCB=true;String uF;hE dIB;hE get nonce=>dIB;lC eIB;static const Map<String,int> T3=const{'salt':0,'saltS':1,'saltL':2};final List<String> QJ=new List<String>(3);vx(String A,[int B=0]){QJ[B]=A;}String fIB;String gIB;bool enableAck=false;Map linkData;List Ov=['msgpack','json'];String ei='json';JQ(this.gIB,String B,SE A,{BF nodeProvider,bool isRequester: true,bool isResponder: true,pB overrideRequester,Y overrideResponder,this.home,this.token,this.linkData,List formats}):CE=A,ZD='${FB.b3(B)}${A.pE.MV}'{if(isRequester){if(overrideRequester!=null){JB=overrideRequester;}else{JB=new pB();}}if(formats==null&&const String.fromEnvironment("dsa.codec.formats")!=null){var C=const String.fromEnvironment("dsa.codec.formats");formats=C.split(",");}if(formats!=null){this.Ov=formats;}if(isResponder){if(overrideResponder!=null){CC=overrideResponder;}else if(nodeProvider!=null){CC=new Y(nodeProvider);}}if(token!=null&&token.length>16){String D=token.substring(0,16);String G=DX.cp(Te('${ZD}${token}'));bV='&token=${D}${G}';}}int hIB=0;connect()async{if(iIB){return;}B4();FC.S4(wZ);HttpClient D=new HttpClient();D.badCertificateCallback=(X509Certificate Q,String S,int Z){return true;};String B='${gIB}?dsId=${Uri.encodeComponent(ZD)}';if(home!=null){B='${B}&home=${home}';}if(bV!=null){B='${B}${bV}';}Uri G=Uri.parse(B);wB.kB(MG("Connecting to ${gIB}"));try {HttpClientRequest H=await D.postUrl(G);Map C={'publicKey':CE.pE.kR,'isRequester':JB!=null,'isResponder':CC!=null,'formats':Ov,'version':KX,'enableWebSocketCompression':true};if(linkData!=null){C['linkData']=linkData;}wB.rD(MG("Handshake Request: ${C}"));wB.eC(MG("ID: ${ZD}"));H.add(Te(PC.FH(C)));HttpClientResponse J=await H.close();List<int> K=await J.fold(<int>[] ,ip);String M=const Utf8Decoder().convert(K);Map A=PC.CF(M);wB.rD(MG("Handshake Response: ${A}"));T3.forEach((O,P){QJ[P]=A[O];});String I=A['tempKey'];if(I==null){dIB=const dp();}else{dIB=await CE.ni(I);}enableAck=A.containsKey('version');BC=A['path'];if(A['wsUri'] is String){fIB='${G.resolve(A['wsUri'])}?dsId=${Uri.encodeComponent(ZD)}'.replaceFirst('http','ws');if(home!=null){fIB='${fIB}&home=${home}';}}if(A['format'] is String){ei=A['format'];}wZ(false);hIB=0;jIB=0;}catch (h){FC.NX(connect,(hIB==0?20:hIB*500));if(hIB<30)hIB++ ;}}int jIB=0;wZ([bool C=true])async{if(iIB)return;try {String B='${fIB}&auth=${dIB.mU(QJ[0])}&format=${ei}';if(bV!=null){B='${B}${bV}';}var D=await nS.Jp(B,useStandardWebSocket:DCB);eIB=new lC(D,clientLink:this,enableTimeout:true,enableAck:enableAck,useCodec:nI.jp(ei));wB.kB(MG("Connected"));if(!cIB.isCompleted){cIB.complete();}if(CC!=null){CC.connection=eIB.Ck;}if(JB!=null){eIB.LN.then((G){JB.connection=G;if(!bIB.isCompleted){bIB.complete(JB);}});}eIB.OJ.then((I){wZ();});}catch (A,H){wB.eC(MG("Error while initializing WebSocket"),A,H);if(A is WebSocketException&&(A.message.contains('not upgraded to websocket')||A.message.contains('(401)'))){FC.NX(connect,20);}else if(C){FC.NX(wZ,jIB==0?20:jIB*500);if(jIB<30)jIB++ ;}}}bool iIB=false;void close(){if(iIB)return;cIB=new Completer();iIB=true;if(eIB!=null){eIB.close();eIB=null;}}}abstract class gd{RE get Cx;RE get Ck;Future<RE> get LN;Future<bool> get OJ;void zj();void JU(String A,Object B);void close();nI YU=nI.hp;ListQueue<tN> nj=new ListQueue<tN>();void Su(int C){tN B;for(tN A in nj){if(A.JZ==C){B=A;break;}else if(A.JZ<C){B=A;}}if(B!=null){int D=(new DateTime.now()).millisecondsSinceEpoch;do{tN A=nj.removeFirst();A.F_(C,D);if(A==B){break;}}while(B!=null);}}}class NM{List<Map> hL;List<DG> MN;NM(this.hL,this.MN);}class tN{int JZ;int Sx;int FEB;List<DG> MN;tN(this.JZ,this.Sx,this.MN);void F_(int C,int A){for(DG B in MN){B.IU(JZ,Sx,A);}}}abstract class RE{}abstract class hK{pB get JB;Y get CC;hE get nonce;Future<pB> get LN;void close();}abstract class gJ extends hK{}abstract class nd extends hK{SE get CE;vx(String A,[int B=0]);String get uF=>null;String MG(String A){if(uF!=null){return "[${uF}] ${A}";}return A;}connect();}abstract class kS{}class oB{static const String OM="initialize";static const String uN="open";static const String CD="closed";}class rW{static const String od="request";static const String a3="response";}class X{String type;String detail;String msg;String path;String phase;X(this.type,{this.msg,this.detail,this.path,this.phase: rW.a3});X.uCB(Map A){if(A["type"] is String){type=A["type"];}if(A["msg"] is String){msg=A["msg"];}if(A["path"] is String){path=A["path"];}if(A["phase"] is String){phase=A["phase"];}if(A["detail"] is String){detail=A["detail"];}}Map XH(){Map A={};if(msg!=null){A["msg"]=msg;}if(type!=null){A["type"]=type;}if(path!=null){A["path"]=path;}if(phase==rW.od){A["phase"]=rW.od;}if(detail!=null){A["detail"]=detail;}return A;}static final X DH=new X("permissionDenied");static final X pd=new X("invalidMethod");static final X c3=new X("notImplemented");static final X mS=new X("invalidPath");static final X Ep=new X("invalidPaths");static final X d3=new X("invalidValue");static final X iD=new X("invalidParameter");static final X Fp=new X("disconnected",phase:rW.od);}class hS implements RE{final StreamController<List> nL=new StreamController<List>();Stream<List> get mAB=>nL.stream;List<Function> kIB=[] ;final gd VL;hS(this.VL,[this.ku=false]){}qW handler;void Jk(qW A){this.handler=A;VL.zj();}NM WR(int A,int B){if(handler!=null){NM C=handler.WR(A,B);return C;}return null;}bool lIB=false;bool ku=true;final Completer<RE> EV=new Completer<RE>();Future<RE> get OJ=>EV.future;final Completer<RE> gAB=new Completer<RE>();Future<RE> get Wj=>gAB.future;}abstract class DG{static const int ed=64;static const int V3=1024;}abstract class qW{RE mIB;StreamSubscription nIB;RE get connection=>mIB;set connection(RE A){if(nIB!=null){nIB.cancel();nIB=null;oIB(mIB);}mIB=A;nIB=mIB.mAB.listen(onData);mIB.OJ.then(oIB);if(mIB.ku){KN();}else{mIB.Wj.then((A)=>KN());}}void oIB(RE A){if(mIB==A){if(nIB!=null){nIB.cancel();nIB=null;}OJ();mIB=null;}}void OJ();void KN(){if(pIB){mIB.Jk(this);}}void onData(List A);List<Map> qIB=<Map>[] ;void OU(Map A){qIB.add(A);if(!pIB){if(mIB!=null){mIB.Jk(this);}pIB=true;}}List<DG> kIB=[] ;void MU(DG A){kIB.add(A);if(!pIB){if(mIB!=null){mIB.Jk(this);}pIB=true;}}bool pIB=false;NM WR(int B,int C){pIB=false;List<DG> A=kIB;kIB=[] ;for(DG D in A){D.qR(B,C);}List<Map> G=qIB;qIB=[] ;return new NM(G,A);}void X_(){kIB.length=0;pIB=false;}}Map U3={"node":{},"static":{},"getHistory":{r"$invokable":"read",r"$result":"table",r"$params":[{"name":"Timerange","type":"string","editor":"daterange"},{"name":"Interval","type":"enum","editor":OX(["default","none","1Y","3N","1N","1W","1D","12H","6H","4H","3H","2H","1H","30M","15M","10M","5M","1M","30S","15S","10S","5S","1S"])},{"name":"Rollup","type":OX(["avg","min","max","sum","first","last","and","or","count","auto"])}],r"$columns":[{"name":"timestamp","type":"time"},{"name":"value","type":"dynamic"}]}};class KB{KB tC;Map<String,Object> HB={};Object ki(String A){return HB[A];}KB();Object Yv(String A){if(HB.containsKey(A)){return HB[A];}if(tC!=null&&tC.HB.containsKey(A)){return tC.HB[A];}return null;}Map<String,Object> L={r'$is':'node'};Object qF(String A){if(L.containsKey(A)){return L[A];}if(tC!=null&&tC.L.containsKey(A)){return tC.L[A];}return null;}Map<String,KB> R={};void iB(String A,KB B){R[A]=B;}String Za(dynamic A){if(A is String){R.remove(SI(A));return A;}else if(A is KB){R.remove(A);}else{throw new Exception("Invalid Input");}return null;}KB SI(String A){if(R.containsKey(A)){return R[A];}if(tC!=null&&tC.R.containsKey(A)){return tC.R[A];}return null;}Object get(String A){if(A.startsWith(r'$')){return qF(A);}if(A.startsWith('@')){return Yv(A);}return SI(A);}Map<String,dynamic> TI(){var A=<String,dynamic>{};if(L.containsKey(r'$is')){A[r'$is']=L[r'$is'];}if(L.containsKey(r'$type')){A[r'$type']=L[r'$type'];}if(L.containsKey(r'$name')){A[r'$name']=L[r'$name'];}if(L.containsKey(r'$invokable')){A[r'$invokable']=L[r'$invokable'];}if(L.containsKey(r'$writable')){A[r'$writable']=L[r'$writable'];}return A;}}class FB{static final RegExp Z3=new RegExp(r'[\\\?\*|"<>:]');static final RegExp lS=new RegExp(r'[\/\\\?\*|"<>:]');static String b3(String A){if(A.contains(lS)){return Uri.encodeComponent(A);}return A;}static FB Dp(Object A,[String C]){if(A is String){FB B=new FB(A);if(B.wR){return B..Rw(C);}}return null;}static FB sW(Object B,[String C]){if(B is String){FB A=new FB(B);if(A.wR&&A.Ba){return A..Rw(C);}}return null;}String path;String gB;FB get parent=>new FB(gB);FB Di(String A)=>new FB((path.endsWith("/")?path.substring(0,path.length-1):path)+"/"+(A.startsWith("/")?A.substring(1):A));String name;bool wR=true;FB(this.path){rIB();}void rIB(){if(path==''||path.contains(Z3)||path.contains('//')){wR=false;}if(path=='/'){wR=true;name='/';gB='';return;}if(path.endsWith('/')){path=path.substring(0,path.length-1);}int A=path.lastIndexOf('/');if(A<0){name=path;gB='';}else if(A==0){gB='/';name=path.substring(1);}else{gB=path.substring(0,A);name=path.substring(A+1);if(gB.contains(r'/$')||gB.contains('/@')){wR=false;}}}bool get isAbsolute{return name=='/'||gB.startsWith('/');}bool get u${return name=='/';}bool get zv{return name.startsWith(r'$');}bool get xv{return name.startsWith(r'@');}bool get Ba{return !name.startsWith(r'@')&&!name.startsWith(r'$');}void Rw(String A,[bool B=false]){if(A==null){return;}if(!isAbsolute){if(gB==''){gB=A;}else{gB='${A}/${gB}';}path='${gB}/${name}';}else if(B){if(name==''){path=A;rIB();}else{gB='${A}${gB}';path='${gB}/${name}';}}}}class b{static const int iS=0;static const int W3=1;static const int pW=2;static const int KQ=3;static const int s=4;static const int jS=5;static const List<String> fd=const['none','list','read','write','config','never'];static const Map<String,int> Bp=const{'none':iS,'list':W3,'read':pW,'write':KQ,'config':s,'never':jS};static int vH(Object A,[int B=jS]){if(A is String&&Bp.containsKey(A)){return Bp[A];}return B;}}class bF{String type;String name;Object HF;bF(this.name,this.type,[this.HF]);Map<String,dynamic> hU(){var A=<String,dynamic>{"type":type,"name":name};if(HF!=null){A["default"]=HF;}return A;}static List<Map<String,dynamic>> Y3(List C){var B=<Map<String,dynamic>>[] ;for(Object A in C){if(A is Map<String,dynamic>){B.add(A);}else if(A is bF){B.add(A.hU());}}return B;}static List<bF> jd(List D){List<bF> B=<bF>[] ;for(Object A in D){if(A is Map&&A["name"] is String){String C="string";if(A["type"] is String){C=A["type"];}B.add(new bF(A["name"],C,A["default"]));}else if(A is bF){B.add(A);}else{return null;}}return B;}}class kd{}class ld{}class md{}typedef BB MM<BB>(GB _0);class GB{static final String X3=(){int A=(new DateTime.now()).timeZoneOffset.inMinutes;String B="+";if(A<0){A=-A;B="-";}int C=A~/60;int D=A%60;return "${B}${C<10?'0':''}${C}:${D<10?"0":''}${D}";}();static String hd;static int Cp=0;static String LQ(){DateTime A=new DateTime.now();if(A.millisecondsSinceEpoch==Cp){return hd;}Cp=A.millisecondsSinceEpoch;hd="${A.toIso8601String()}${X3}";return hd;}int nV=-1;Object value;String ts;DateTime sIB;String status;int count;num sum;num min;num max;DateTime Ki;GB(this.value,{this.ts,Map meta,this.status,this.count: 1,this.sum: double.NAN,this.min: double.NAN,this.max: double.NAN}){if(ts==null){ts=LQ();}Ki=new DateTime.now();if(meta!=null){if(meta["count"] is int){count=meta["count"];}else if(value==null){count=0;}if(meta["status"] is String){status=meta["status"];}if(meta["sum"] is num){sum=meta["sum"];}if(meta["max"] is num){max=meta["max"];}if(meta["min"] is num){min=meta["min"];}}if(value is num&&count==1){if(sum!=sum)sum=value;if(max!=max)max=value;if(min!=min)min=value;}}GB.tCB(GB B,GB A){value=A.value;ts=A.ts;status=A.status;count=B.count+A.count;sum=B.sum;if(!A.sum.isNaN){if(sum==sum){sum=A.sum;}else{sum+= A.sum;}}min=B.min;if(min.isNaN||A.min<min){min=A.min;}max=B.min;if(max.isNaN||A.max>max){max=A.max;}Ki=A.Ki;}Duration tIB;void RAB(GB A){value=A.value;ts=A.ts;status=A.status;count+= A.count;if(!A.sum.isNaN){if(sum==sum){sum+= A.sum;}else{sum=A.sum;}}if(min!=min||A.min<min){min=A.min;}if(max!=max||A.max>max){max=A.max;}}bool JF(GB A){if(value is Map){if(A.value is!Map){return false;}}else if(value is List){if(A.value is!List){return false;}}else if(value!=A.value){return false;}if(A.ts!=ts||A.count!=count){return false;}if(count==1){return true;}return A.sum==sum&&A.min==min&&A.max==max;}Map Xk(){Map A={"ts":ts,"value":value};if(count==0){A["count"]=0;}else if(count>1){A["count"]=count;if(sum.isFinite){A["sum"]=sum;}if(max.isFinite){A["max"]=max;}if(min.isFinite){A["min"]=min;}}return A;}Object YV;}class lC extends gd{hS uIB;RE get Ck=>uIB;hS vIB;RE get Cx=>vIB;Completer<RE> Yj=new Completer<RE>();Future<RE> get LN=>Yj.future;Completer<bool> wIB=new Completer<bool>();Future<bool> get OJ=>wIB.future;final nd clientLink;final WebSocket socket;bool xIB=false;lC(this.socket,{this.clientLink,bool enableTimeout: false,bool enableAck: true,nI useCodec}){if(useCodec!=null){YU=useCodec;}uIB=new hS(this,true);vIB=new hS(this,true);socket.listen(onData,onDone:yIB);socket.add(YU.M_);if(!enableAck){kL=-1;}if(enableTimeout){pj=new Timer.periodic(const Duration(seconds:20),lAB);}}Timer pj;bool zIB=false;int AJB=0;static bool lI=false;static int tS=0;static int DO=0;static int uS=0;static int EO=0;static int EX=0;static int FX=0;void lAB(Timer A){if(AJB>=3){this.close();return;}AJB++ ;if(zIB){zIB=false;return;}this.JU(null,null);}void zj(){if(!BJB){BJB=true;FC.TM(CJB);}}Map DJB;void JU(String A,Object B){if(DJB==null){DJB={};}if(A!=null){DJB[A]=B;}zj();}void onData(dynamic B){EX++ ;if(wIB.isCompleted){return;}if(!Yj.isCompleted){Yj.complete(vIB);}AJB=0;Map A;if(B is List<int>){try {A=YU.Ri(B as List<int>);if(wB.wO(RB.YQ)){wB.rD(MG("receive: ${A}"));}}catch (G,H){wB.eC(MG("Failed to decode binary data in WebSocket Connection"),G,H);close();return;}if(lI){tS+= B.length;}B=null;bool C=false;if(A["responses"] is List&&(A["responses"] as List).length>0){C=true;vIB.nL.add(A["responses"]);}if(A["requests"] is List&&(A["requests"] as List).length>0){C=true;uIB.nL.add(A["requests"]);}if(A["ack"] is int){Su(A["ack"]);}if(C){Object D=A["msg"];if(D!=null){JU("ack",D);}}}else if(B is String){try {A=YU.fZ(B);if(wB.wO(RB.YQ)){wB.rD(MG("receive: ${A}"));}}catch (G,H){wB.oC(MG("Failed to decode string data from WebSocket Connection"),G,H);close();return;}if(lI){tS+= B.length;}if(A["salt"] is String&&clientLink!=null){clientLink.vx(A["salt"]);}bool C=false;if(A["responses"] is List&&(A["responses"] as List).length>0){C=true;vIB.nL.add(A["responses"]);if(lI){for(Map I in A["responses"]){if(I["updates"] is List){int J=I["updates"].length;if(J>0){DO+= J;}else{DO+= 1;}}else{DO+= 1;}}}}if(A["requests"] is List&&(A["requests"] as List).length>0){C=true;uIB.nL.add(A["requests"]);if(lI){DO+= A["requests"].length;}}if(A["ack"] is int){Su(A["ack"]);}if(C){Object D=A["msg"];if(D!=null){JU("ack",D);}}}}int kL=1;bool BJB=false;void CJB(){BJB=false;bool C=false;Map B;if(DJB!=null){B=DJB;DJB=null;C=true;}else{B={};}var D=<DG>[] ;int G=(new DateTime.now()).millisecondsSinceEpoch;NM A=uIB.WR(G,kL);if(A!=null){if(A.hL.length>0){B["responses"]=A.hL;C=true;if(lI){for(Map H in A.hL){if(H["updates"] is List){int I=H["updates"].length;if(I>0){EO+= I;}else{EO+= 1;}}else{EO+= 1;}}}}if(A.MN.length>0){D.addAll(A.MN);}}A=vIB.WR(G,kL);if(A!=null){if(A.hL.length>0){B["requests"]=A.hL;C=true;if(lI){EO+= A.hL.length;}}if(A.MN.length>0){D.addAll(A.MN);}}if(C){if(kL!=-1){if(D.length>0){nj.add(new tN(kL,G,D));}B["msg"]=kL;if(kL<0x7FFFFFFF){ ++kL;}else{kL=1;}}G_(B);zIB=true;FX++ ;}}void G_(Map B){Object A=YU.lZ(B);if(wB.wO(RB.YQ)){wB.rD(MG("send: ${B}"));}if(lI){if(A is String){uS+= A.length;}else if(A is List<int>){uS+= A.length;}else{wB.gC(MG("invalid data frame"));}}socket.add(A);}bool vw=true;void yIB(){if(xIB){return;}xIB=true;if(vw){wB.kB(MG("Disconnected"));}if(!vIB.nL.isClosed){vIB.nL.close();}if(!vIB.EV.isCompleted){vIB.EV.complete(vIB);}if(!uIB.nL.isClosed){uIB.nL.close();}if(!uIB.EV.isCompleted){uIB.EV.complete(uIB);}if(!wIB.isCompleted){wIB.complete(false);}if(pj!=null){pj.cancel();}}String MG(String A){if(clientLink!=null){return clientLink.MG(A);}if(uF!=null){return "[${uF}] ${A}";}return A;}String uF;void close(){if(socket.readyState==WebSocket.OPEN||socket.readyState==WebSocket.CONNECTING){socket.close();}yIB();}}const bool Gp=const bool.fromEnvironment("dsa.io.tcpNoDelay",defaultValue:true);Stream<String> e3(){return const Utf8Decoder().bind(Mb.stdin);}Stream<String> f3(){var A=e3();return const LineSplitter().bind(A);}class nS{static HttpClient g3=new HttpClient();static Future<HttpClientRequest> h3(String B,String C,{Map<String,String> headers})async{var A=await g3.openUrl(B,Uri.parse(C));if(headers!=null){headers.forEach(A.headers.set);}return A;}static const String Hp="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";static const bool Ip=const bool.fromEnvironment("calzone.build",defaultValue:false)||const bool.fromEnvironment("websocket.standard",defaultValue:true);static Future<WebSocket> Jp(String M,{Iterable<String> protocols,Map<String,dynamic> headers,HttpClient httpClient,bool useStandardWebSocket})async{Uri A=Uri.parse(M);if(useStandardWebSocket==null){useStandardWebSocket=Ip;}if(useStandardWebSocket==true&&A.scheme!="wss"){return await WebSocket.connect(M,protocols:protocols,headers:headers);}if(A.scheme!="ws"&&A.scheme!="wss"){throw new WebSocketException("Unsupported URL scheme '${A.scheme}'");}Random h=new Random();Uint8List O=new Uint8List(16);for(int C=0;C<16;C++ ){O[C]=h.nextInt(256);}String P=VG.gN(O);int I=A.port;if(I==0){I=A.scheme=="wss"?443:80;}A=new Uri(scheme:A.scheme=="wss"?"https":"http",userInfo:A.userInfo,host:A.host,port:I,path:A.path,query:A.query);HttpClient p=httpClient==null?(new HttpClient()..badCertificateCallback=(dB,sB,tB)=>true):httpClient;return p.openUrl("GET",A).then((HttpClientRequest D)async{if(A.userInfo!=null&&!A.userInfo.isEmpty){String EB=VG.gN(UTF8.encode(A.userInfo));D.headers.set(HttpHeaders.AUTHORIZATION,"Basic ${EB}");}if(headers!=null){headers.forEach((PB,J)=>D.headers.add(PB,J));}D.headers..set(HttpHeaders.CONNECTION,"Upgrade")..set(HttpHeaders.UPGRADE,"websocket")..set("Sec-WebSocket-Key",P)..set("Cache-Control","no-cache")..set("Sec-WebSocket-Version","13");if(protocols!=null){D.headers.add("Sec-WebSocket-Protocol",protocols.toList());}return D.close();}).then((B){return B;}).then((HttpClientResponse B){void G(String TB){B.detachSocket().then((Socket H){H.destroy();});throw new WebSocketException(TB);}if(B.statusCode!=HttpStatus.SWITCHING_PROTOCOLS||B.headers[HttpHeaders.CONNECTION]==null||!B.headers[HttpHeaders.CONNECTION].any((J)=>J.toLowerCase()=="upgrade")||B.headers.value(HttpHeaders.UPGRADE).toLowerCase()!="websocket"){G("Connection to '${A}' was not upgraded to websocket");}String Q=B.headers.value("Sec-WebSocket-Accept");if(Q==null){G("Response did not contain a 'Sec-WebSocket-Accept' header");}ZJ S=new ZJ();S.add("${P}${Hp}".codeUnits);List<int> K=S.close();List<int> Z=VG.wP(Q);if(K.length!=Z.length){G("Response header 'Sec-WebSocket-Accept' is the wrong length");}for(int C=0;C<K.length;C++ ){if(K[C]!=Z[C]){G("Bad response 'Sec-WebSocket-Accept' header");}}var UB=B.headers.value('Sec-WebSocket-Protocol');return B.detachSocket().then((H){H.setOption(SocketOption.TCP_NODELAY,Gp);return new WebSocket.fromUpgradedSocket(H,protocol:UB,serverSide:false);});});}static Future<WebSocket> i3(HttpRequest C,[H(List<String> protocols),bool I]){if(I==null){I=Ip;}if(I){return WebSocketTransformer.upgrade(C,protocolSelector:H);}var A=C.response;if(!WebSocketTransformer.isUpgradeRequest(C)){A..statusCode=HttpStatus.BAD_REQUEST..close();return new Future.error(new WebSocketException("Invalid WebSocket upgrade request"));}Future<WebSocket> J(String B){A..statusCode=HttpStatus.SWITCHING_PROTOCOLS..headers.add(HttpHeaders.CONNECTION,"Upgrade")..headers.add(HttpHeaders.UPGRADE,"websocket");String O=C.headers.value("Sec-WebSocket-Key");ZJ K=new ZJ();K.add("${O}${Hp}".codeUnits);String P=VG.gN(K.close());A.headers.add("Sec-WebSocket-Accept",P);if(B!=null){A.headers.add("Sec-WebSocket-Protocol",B);}A.headers.contentLength=0;return A.detachSocket().then((G){G.setOption(SocketOption.TCP_NODELAY,Gp);return new WebSocket.fromUpgradedSocket(G,protocol:B,serverSide:true);});}var D=C.headers['Sec-WebSocket-Protocol'];if(D!=null&&H!=null){D=nS.j3(D.join(', '));return new Future(()=>H(D)).then((String B){if(D.indexOf(B)<0){throw new WebSocketException("Selected protocol is not in the list of available protocols");}return B;}).catchError((Q){A..statusCode=HttpStatus.INTERNAL_SERVER_ERROR..close();throw Q;return null;}).then((M){if(M is String){return J(M);}return null;}).then((WebSocket G){return G;});}else{return J(null);}}static List<String> j3(String B){List<String> D=new List<String>();int C=0;int A=0;while(A<B.length){if(B[A]==","){D.add(B.substring(C,A));C=A+1;}else if(B[A]==" "||B[A]=="\t"){C++ ;}A++ ;}D.add(B.substring(C,A));return D;}}DX UQ=BX.ap;bool A4=false;B4()=>A4=true;abstract class DX{static String cp(List<int> A){Uint8List B=GX.fp(A);return UQ.K_(B);}}abstract class hE{String get Zi;static Future<hE> C4(wH A,hE B)async=>UQ.I_(A,B);String mU(String A);bool lV(String A,String B){return mU(A)==B;}}abstract class wH{String get kR;String get MV;wH();factory wH.wCB(Uint8List A)=>UQ.Q$(A);String bv(String A){return '${A}${MV}';}bool HCB(String A){return (A.length>=43&&A.substring(A.length-43)==MV);}}abstract class SE{factory SE.xCB()=>UQ.Vv();factory SE.yCB(String A)=>UQ.HAB(A);}abstract class mK{static mK get CO=>UQ.LK;}class dp implements hE{final String Zi="";const dp();String mU(String A){return '';}bool lV(String A,String B){return true;}}UG Tp;wE Up;int Vp=-1;String Wp;List<dynamic> w3(List<int> I,String C){bN J=gE.bE.qO(I);UG A;wE D;int G=(new DateTime.now()).millisecondsSinceEpoch;if(Wp==null||G-Vp>60000||C==Wp||C==''){var H=new CW();var K=new sP(gE);var M=new tP(K,BX.ap.LK);H.init(M);var B=H.rZ();A=B.CE;D=B.pE;if(C!=''){Tp=B.CE;Up=B.pE;Vp=G;}}else{A=Tp;D=Up;}var O=J*A.NI;return [A.NI.MP(),D.sI.UR(false),O.UR(false)];}void x3(SendPort B){var C=new ReceivePort();B.send(C.sendPort);C.listen((A){if(A is List&&A.length==2){B.send(w3(A[0] as List<int>,A[1].toString()));}});}class TQ{static bool get Yp=>Be!=null;static Isolate Be;static y3()async{if(Be!=null)return;var A=new ReceivePort();Be=await Isolate.spawn(x3,A.sendPort);A.listen(z3);Ce();}static SendPort Zp;static void z3(A){if(A is SendPort){Zp=A;}else if(A is List){if(BO!=null&&A.length==3){var B=new e.jCB(1,A[0] as List<int>);var C=gE.bE.qO(A[1] as List<int>);var D=gE.bE.qO(A[2] as List<int>);var G=new RM(new UG(B,gE),new wE(C,gE),D);BO.EJB.complete(G);BO=null;}}Ce();}static sS BO;static void Ce(){if(BO==null&&De.length>0){BO=De.removeFirst();Zp.send([BO.ww.LJ.sI.UR(false),BO.ew]);}}static ListQueue<sS> De=new ListQueue<sS>();static Future<hE> Ee(wH B,String C){var A=new sS(B,C);De.add(A);Ce();return A.future;}}class sS{SM ww;String ew;sS(this.ww,this.ew);Completer<hE> EJB=new Completer<hE>();Future<hE> get future=>EJB.future;}YJ Xp;YJ get gE{if(Xp!=null){return Xp;}e B=new e("ffffffff00000001000000000000000000000000ffffffffffffffffffffffff",16);e C=new e("ffffffff00000001000000000000000000000000fffffffffffffffffffffffc",16);e D=new e("5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b",16);e G=new e("046b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c2964fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5",16);e H=new e("ffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",16);e I=new e("1",16);e J=new e("c49d360886e704936a6678e1139d26b7819f7e90",16);var K=J.MP();var A=new BW(B,C,D);return new xl("secp256r1",A,A.qO(G.MP()),H,I,K);}class BX implements DX{static final BX ap=new BX();final Fe LK=new Fe();UG FJB;wE GJB;int HJB=-1;Future<hE> I_(wH A,hE B)async{if(TQ.Yp){if(B is RM){return TQ.Ee(A,B.IJB.NI.Yk(16));}else{return TQ.Ee(A,null);}}int D=(new DateTime.now()).millisecondsSinceEpoch;if(FJB==null||D-HJB>60000||(B is RM&&B.IJB==FJB)){var G=new CW();var I=new sP(gE);var J=new tP(I,LK);G.init(J);var H=G.rZ();FJB=H.CE;GJB=H.pE;HJB=D;}SM C;if(A is!SM){throw "Not a PublicKeyImpl: ${C}";}else{C=A;}var K=C.LJ.sI*FJB.NI;return new RM(FJB,GJB,K);}Future<hE> ni(wH A)async{if(TQ.Yp){return TQ.Ee(A,"");}var D=new CW();var G=new sP(gE);var H=new tP(G,LK);D.init(H);var B=D.rZ() as zV<wE,UG>;SM C;if(A is!SM){throw "Not a PublicKeyImpl: ${C}";}else{C=A;}var I=C.LJ.sI*B.CE.NI;return new RM(B.CE,B.pE,I);}Future<SE> Uv()async{return Vv();}SE Vv(){var A=new CW();var C=new sP(gE);var D=new tP(C,LK);A.init(D);var B=A.rZ();return new CX(B.CE,B.pE);}SE HAB(String A){if(A.contains(" ")){List D=A.split(" ");var B=new e.jCB(1,bG.VQ(D[0]));UG C=new UG(B,gE);var G=gE.bE.qO(bG.VQ(D[1]));wE H=new wE(G,gE);return new CX(C,H);}else{var B=new e.jCB(1,bG.VQ(A));UG C=new UG(B,gE);return new CX(C);}}wH Q$(Uint8List A){bN B=gE.bE.qO(A);return new SM(new wE(B,gE));}String K_(Uint8List A){cN B=new cN();Uint8List C=B.process(new Uint8List.fromList(A));return bG.UM(C);}}class RM extends hE{String get Zi=>bG.UM(JJB.sI.UR(false));Uint8List hG;UG IJB;wE JJB;RM(this.IJB,this.JJB,bN D){hG=bp(D.x.YH());if(hG.length>32){hG=hG.sublist(hG.length-32);}else if(hG.length<32){var B=new Uint8List(32);int C=32-hG.length;for(int A=0;A<hG.length; ++A){B[A+C]=hG[A];}for(int A=0;A<C; ++A){B[A]=0;}hG=B;}}String mU(String G){Uint8List B=Te(G);Uint8List C=new Uint8List(B.length+hG.length);int A;for(A=0;A<B.length;A++ ){C[A]=B[A];}for(var D=0;D<hG.length;D++ ){C[A]=hG[D];A++ ;}cN H=new cN();var I=H.process(C);return bG.UM(I);}}class SM extends wH{wE LJ;String kR;String MV;SM(this.LJ){List<int> A=LJ.sI.UR(false);kR=bG.UM(A);cN B=new cN();MV=bG.UM(B.process(A));}}class CX implements SE{wH pE;UG OR;wE LJ;CX(this.OR,[this.LJ]){if(LJ==null){LJ=new wE(gE.Hg*OR.NI,gE);}pE=new SM(LJ);}String Ix(){return "${bG.UM(bp(OR.NI))} ${pE.kR}";}Future<RM> ni(String A)async{bN B=OR.parameters.bE.qO(bG.VQ(A));wE C=new wE(B,gE);var D=C.sI*OR.NI;return new RM(OR,LJ,D);}}class Fe extends zl implements mK{bool get Xw=>true;jb KJB;tl LJB;Fe([int H=-1]){LJB=new tl();KJB=new jb(LJB);Random A=new Random();final B=[A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256)];final C=new ib(new Uint8List.fromList(B));A=new Random((new DateTime.now()).millisecondsSinceEpoch);final D=new Uint8List.fromList([A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256)]);final G=new DW<cI>(C,D);KJB.UV(G);}void UV(cI A){if(A is DW<cI>){KJB.UV(A);}else{throw "${A} is not a ParametersWithIV implementation.";}}void Uu(String G){List<int> A=const Utf8Encoder().convert(G);int C=(A.length).ceil()*16;if(C>A.length){A=A.toList();while(C>A.length){A.add(0);}}final D=new Uint8List.fromList(A);final H=new Uint8List(16);for(var B=0;B<D.lengthInBytes;){var I=LJB.iR(D,B,H,0);B+= I;}}int AP(){return KJB.AP();}}Uint8List bp(e C){List<int> A=C.MP();if(A.length>32&&A[0]==0){A=A.sublist(1);}int D=A.length;for(int B=0;B<D; ++B){if(A[B]<0){A[B]&=0xff;}}return new Uint8List.fromList(A);}abstract class fE{final MQ MJB;fE(this.MJB){}fE lO;Set<fE> DV=new Set<fE>();Set<V> VH=new Set<V>();void KI(V A){A.mE=NJB;VH.add(A);}void NJB(V A){VH.remove(A);if(VH.isEmpty&&DV.isEmpty){destroy();}}void rh(fE A){DV.add(A);}void NBB(fE A){DV.remove(A);if(DV.isEmpty&&VH.isEmpty){destroy();}}void init(){}void gV(List A);void destroy(){for(V A in VH){A.close;}if(lO!=null){lO.NBB(this);}MJB.OJB.remove(kv());}String PJB;String kv(){if(PJB==null){if(lO!=null){PJB='${lO}|${this}';}else{PJB=toString();}}return PJB;}}class PM{static const int qd=1;static const int rd=0;static const int Kp=3;static const int Lp=2;String vF;String LV;bool Ww=false;bool JEB=false;String nF;PM(String B){if(B==''){return;}List A;if(B.contains('?')){A=B.split('?');}else if(B.contains('*')){A=B.split('*');Ww=true;}if(A!=null){if(A.length!=2){throw 'invalid path "${B}"';}if(A[0]!=''){vF=A[0];}if(A[1]!=''){LV=A[1];}}else{nF=B;}}int NAB(String A,bool B){if(nF!=null){if(A==nF){return qd;}else{return rd;}}else{if(B&&vF!=null&&!A.startsWith(vF)){return rd;}if(Ww){if(LV==null||A.endsWith(LV)){return Kp;}else{return Lp;}}else{if(LV!=null&&!A.startsWith(LV)){return rd;}return qd;}}}}class hJ{tW command;List<PM> JK;Set<int> Kj=new Set<int>();l W;StreamSubscription EK;hJ(this.command,this.W,this.JK){}void LU(int A){if(!Kj.contains(A)){Kj.add(A);int B=A.abs();if(B==JK.length){Kx=true;}else if(B<JK.length){if(EK==null){EK=W.Ej.listen(iAB);}W.R.forEach((String D,KB C){if(C is l){eu(D,C,A);}});}}}bool QJB=false;void set Kx(bool A){if(QJB!=A){QJB=A;if(QJB){command.Gb([W,'+']);}else{command.Gb([W,'-']);}}}void iAB(String A){if(A.startsWith('@')||A.startsWith(r'$')){return;}l B=W.R[A];if(B==null){l_(A);}else{for(int C in Kj){eu(A,B,C);}}}void eu(String H,l D,int G){int B=G.abs();if(B>=JK.length){return;}bool I=G>0;int C=JK[B].NAB(H,I);if(C>0){hJ A=command.OJB[D.path];if(A==null){A=new hJ(command,D,JK);command.OJB[D.path]=A;}if(C==PM.qd){A.LU(B+1);}else if(C==PM.Lp){A.LU(-B);}else if(C==PM.Kp){A.LU(-B);A.LU(B+1);}}}void l_(String B){String C='${W.path}/${B}';hJ A=command.OJB[C];if(A!=null){A.Kx=false;A.destroy();command.OJB.remove(A.W.path);}}void destroy(){if(EK!=null){EK.cancel();}}}class tW extends fE{List<String> lR;List<PM> JK;tW(Object A,MQ B):super(B){if(A is String){lR=A.split('/');}else if(A is List<String>){lR=A;}}void init(){JK=new List<PM>(lR.length);for(int A=0;A<lR.length; ++A){JK[A]=new PM(lR[A]);}}Map<String,hJ> OJB=new Map<String,hJ>();Set<String> RJB=new Set<String>();bool SJB=false;void Gb(List A){for(var B in DV){B.gV([A]);}}void rh(fE A){super.rh(A);List B=[] ;OJB.forEach((String D,hJ C){if(C.QJB){B.add([C.W,'+']);}});A.gV(B);}void gV(List D){for(List A in D){if(A[0] is l){l B=A[0];if(A[1]=='+'){if(OJB.containsKey(B.path)){print('not implemented');}else{hJ C=new hJ(this,B,JK);OJB[B.path]=C;C.LU(1);}}else if(A[1]=='-'){print('not implemented');}}}}String toString(){return 'list ${lR.join("/")}';}void destroy(){super.destroy();OJB.forEach((String B,hJ A){A.destroy();});}}class MQ{BF provider;MQ(this.provider){}fE qw(List A){return null;}fE yAB(String D){if(D.startsWith('[')){return qw(PC.CF(D));}List<String> A=D.split('|').map((G)=>G.trim()).toList();if(A.length==2&&A[0].startsWith('list /data')&&A[1].startsWith('subscribe')){String H=A[0].substring(5);fE B=new tW(H,this);B=TJB(B);if(B==null){return null;}fE C=new sd(this);C.lO=B;C=TJB(C);return C;}return null;}Map<String,fE> OJB=new Map<String,fE>();fE TJB(fE A){String B=A.kv();if(OJB.containsKey(B)){return OJB[B];}try {A.init();}catch (C){A.destroy();return null;}if(A.lO!=null){A.lO.rh(A);}else if(A is tW){A.gV([[provider.yB('/'),'+']]);}OJB[B]=A;return A;}}class vN{final sd command;final l W;kK EK;bool GP=false;bool Fa=true;vN(this.command,this.W){if(W.Jb){yx(W.gL);}EK=W.wF(yx);}GB fL;void yx(GB A){fL=A;command.Gb(mv());}List mv(){if(!GP&&fL!=null){if(Fa){Fa=false;return [W.path,'+',fL.value,fL.ts];}else{return [W.path,'',fL.value,fL.ts];}}return null;}List V$(){if(!GP&&!Fa&&fL!=null){return [W.path,'+',fL.value,fL.ts];}return null;}void destroy(){EK.cancel();}}class sd extends fE{static List k3=[{'name':'path','type':'string'},{'name':'change','type':'string'},{'name':'value','type':'string'},{'name':'ts','type':'string'}];sd(MQ A):super(A);void KI(V A){if(SJB){UJB();}super.KI(A);List B=[] ;DC.forEach((String G,vN D){List C=D.V$();if(C!=null){B.add(C);}});A.hB(B,columns:k3);}Set<String> RJB=new Set<String>();Map<String,vN> DC=new Map<String,vN>();bool SJB=false;void ACB(String A){RJB.add(A);if(!SJB){SJB=true;FC.TM(UJB);}}List VJB=[] ;void Gb(List A){VJB.add(A);if(!SJB){SJB=true;FC.TM(UJB);}}void UJB(){if(!SJB){return;}SJB=false;List B=VJB;VJB=[] ;for(String C in RJB){vN A=DC[C];if(A!=null){if(A.GP){if(!A.Fa){B.add([C,'-',null,GB.LQ()]);}DC.remove(C);A.destroy();}else{List D=A.mv();if(D!=null){B.add(D);}}}}RJB.clear();for(var G in VH){G.hB(B);}}void gV(List C){for(List B in C){if(B[0] is l){l A=B[0];if(B[1]=='+'){if(!DC.containsKey(A.path)){DC[A.path]=new vN(this,A);}else{DC[A.path].GP=false;}}else if(B[1]=='-'){if(DC.containsKey(A.path)){DC[A.path].GP=true;ACB(A.path);}}}}}String toString(){return r'subscribe $value';}void destroy(){super.destroy();DC.forEach((String B,vN A){A.destroy();});}}class uW{static final Map l3={"node":{},"static":{},"getHistory":{r"$invokable":"read",r"$result":"table",r"$params":[{"name":"Timerange","type":"string","editor":"daterange"},{"name":"Interval","type":"enum","default":"none","editor":OX(["default","none","1Y","3N","1N","1W","1D","12H","6H","4H","3H","2H","1H","30M","15M","10M","5M","1M","30S","15S","10S","5S","1S"])},{"name":"Rollup","default":"none","type":OX(["none","avg","min","max","sum","first","last","count","delta"])}],r"$columns":[{"name":"timestamp","type":"time"},{"name":"value","type":"dynamic"}]}};static final Map<String,KB> wW=(){var C=new Map<String,KB>();l3.forEach((String D,Map H){String I='/defs/profile/${D}';xW A=new xW(I);H.forEach((String B,Object G){if(B.startsWith(r'$')){A.L[B]=G;}else if(B.startsWith('@')){A.HB[B]=G;}});A.wU=true;C[D]=A;});return C;}();}class xN{Map<String,LC> WJB=new Map<String,LC>();xN(){}LC CK(String A){if(!WJB.containsKey(A)){if(A.startsWith('defs')){WJB[A]=new xW(A);}else{WJB[A]=new LC(A);}}return WJB[A];}void clear(){WJB.clear();}KB av(String B,String A){if(uW.wW.containsKey(A)){return uW.wW[A];}return CK(B);}LC Eb(LC C,String D,Map G){String A;if(C.BC=='/'){A='/${D}';}else{A='${C.BC}/${D}';}LC B;if(WJB.containsKey(A)){B=WJB[A];B.vR(G,this);}else{B=new LC(A);WJB[A]=B;B.vR(G,this);}return B;}}class LC extends KB{final String BC;bool wU=false;String name;jK XJB;ZG YJB;bool get f${if(YJB==null){return false;}return YJB.ZJB!=null;}GB get gL{if(f$){return YJB.ZJB;}else{return null;}}LC(this.BC){aJB();}void aJB(){if(BC=='/'){name='/';}else{name=BC.split('/').last;}}Stream<XG> bJB(pB A){if(XJB==null){XJB=Ji(A);}return XJB.stream;}jK Ji(pB A){return new jK(this,A);}void cJB(pB A,B(GB update),int C){if(YJB==null){YJB=new ZG(this,A);}YJB.listen(B,C);}void dJB(pB B,A(GB update)){if(YJB!=null){YJB.mBB(A);}}Stream<iK> eJB(Map A,pB B,[int C=b.s,ud D]){return new Op(this,B,A,C,D).fJB;}void vR(Map H,xN G){String C;if(BC=='/'){C='/';}else{C='${BC}/';}H.forEach((String A,B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){HB[A]=B;}else if(B is Map){KB D=G.CK('${C}/${A}');R[A]=D;if(D is LC){D.vR(B,G);}}});}void SV(){L.clear();HB.clear();R.clear();}Map rE({bool includeValue: true}){var A={};A.addAll(L);A.addAll(HB);for(String C in R.keys){KB B=R[C];A[C]=B is LC?B.rE():B.TI();}if(includeValue&&YJB!=null&&YJB.ZJB!=null){A["?value"]=YJB.ZJB.value;A["?value_timestamp"]=YJB.ZJB.ts;}return A;}}class xW extends LC{xW(String A):super(A);}class YG{final pB JB;final int cD;final Map data;final wN QP;bool gJB=false;bool get isClosed=>gJB;YG(this.JB,this.cD,this.QP,this.data);String cE=oB.OM;void Dx(){JB.OU(data);}void hJB(Map A){if(A["stream"] is String){cE=A["stream"];}List C;List D;Map G;if(A["updates"] is List){C=A["updates"];}if(A["columns"] is List){D=A["columns"];}if(A["meta"] is Map){G=A["meta"];}if(cE==oB.CD){JB.iJB.remove(cD);}X B;if(A.containsKey("error")&&A["error"] is Map){B=new X.uCB(A["error"]);JB.jJB.add(B);}QP.YI(cE,C,D,G,B);}void kJB([X A]){if(cE!=oB.CD){cE=oB.CD;QP.YI(oB.CD,null,null,null,A);}}void close(){JB.hu(this);}}class iK extends EH{List yw;List<bF> FD;List RP;X error;Map meta;iK(this.RP,this.yw,this.FD,String A,{this.meta,this.error}):super(A);List<List> lJB;List<List> get QK{int C=-1;if(FD!=null){C=FD.length;}if(lJB==null){lJB=[] ;if(RP==null){return lJB;}for(Object A in RP){List<dynamic> B;if(A is List){if(A.length<C){B=A.toList();for(int D=A.length;D<C; ++D){B.add(FD[D].HF);}}else if(A.length>C){if(C==-1){B=A.toList();}else{B=A.sublist(0,C);}}else{B=A;}}else if(A is Map){B=[] ;if(FD==null){Map H=A;List<String> I=H.keys.map((J)=>J.toString()).toList();FD=I.map((K)=>new bF(K,"dynamic")).toList();}if(FD!=null){for(bF G in FD){if(A.containsKey(G.name)){B.add(A[G.name]);}else{B.add(G.HF);}}}}lJB.add(B);}}return lJB;}}class Op implements wN{static List<bF> m3(LC B){Object A=B.qF(r'$columns');if(A is!List&&B.tC!=null){A=B.tC.qF(r'$columns');}if(A is List){return bF.jd(A);}return null;}final LC W;final pB JB;StreamController<iK> mJB;Stream<iK> fJB;YG nJB;List<bF> oJB;String mode='stream';String Gw=oB.OM;Op(this.W,this.JB,Map D,[int A=b.s,ud B]){mJB=new StreamController<iK>();mJB.done.then(pJB);fJB=mJB.stream;var C=<String,dynamic>{'method':'invoke','path':W.BC,'params':D};if(A!=b.s){C['permit']=b.fd[A];}nJB=JB.qJB(C,this);if(B!=null){B(nJB);}}void pJB(A){if(nJB!=null&&nJB.cE!=oB.CD){nJB.close();}}void YI(String A,List D,List C,Map B,X G){if(B!=null&&B['mode'] is String){mode=B['mode'];}if(C!=null){if(oJB==null||mode=='refresh'){oJB=bF.jd(C);}else{oJB.addAll(bF.jd(C));}}else if(oJB==null){oJB=m3(W);}if(G!=null){A=oB.CD;mJB.add(new iK(null,null,null,A,error:G,meta:B));}else if(D!=null||B!=null||A!=Gw){mJB.add(new iK(D,C,oJB,A,meta:B));}Gw=A;if(A==oB.CD){mJB.close();}}void onDisconnect(){}void IV(){}}class XG extends EH{List<String> dC;LC W;XG(this.W,this.dC,String A):super(A);}class vd{final LC W;final pB JB;StreamSubscription EK;bool QV=false;vd(this.W,this.JB,void B(RequesterListUpdate)){EK=JB.list(W.BC).listen((XG A){QV=A.cE!=oB.OM;B(A);});}void cancel(){EK.cancel();}}class jK implements wN,DG{final LC W;final pB JB;mI<XG> mJB;Stream<XG> get stream=>mJB.stream;YG qE;jK(this.W,this.JB){mJB=new mI<XG>(qAB,rJB,sJB);}String hZ;void onDisconnect(){hZ=GB.LQ();W.L[r'$disconnectedTs']=hZ;mJB.add(new XG(W,[r'$disconnectedTs'],qE.cE));}void IV(){if(hZ!=null){W.L.remove(r'$disconnectedTs');hZ=null;dC.add(r'$disconnectedTs');}}LinkedHashSet<String> dC=new LinkedHashSet<String>();void YI(String I,List G,List J,Map K,X M){bool H=false;if(G!=null){for(Object B in G){String A;Object C;bool D=false;if(B is Map){if(B['name'] is String){A=B['name'];}else{continue;}if(B['change']=='remove'){D=true;}else{C=B['value'];}}else if(B is List){if(B.length>0&&B[0] is String){A=B[0];if(B.length>1){C=B[1];}}else{continue;}}else{continue;}if(A.startsWith(r'$')){if(!H&&(A==r'$is'||A==r'$base'||(A==r'$disconnectedTs'&&C is String))){H=true;W.SV();}if(A==r'$is'){KAB(C);}dC.add(A);if(D){W.L.remove(A);}else{W.L[A]=C;}}else if(A.startsWith('@')){dC.add(A);if(D){W.HB.remove(A);}else{W.HB[A]=C;}}else{dC.add(A);if(D){W.R.remove(A);}else if(C is Map){W.R[A]=JB.lL.Eb(W,A,C);}}}if(qE.cE!=oB.OM){W.wU=true;}if(tJB){uJB();}Pa();}}vd vJB;void KAB(String B){wJB=true;String A=B;if(!A.startsWith('/')){Object C=W.L[r'$base'];if(C is String){A='${C}/defs/profile/${A}';}else{A='/defs/profile/${A}';}}if(W.tC is LC&&(W.tC as LC).BC==A){return;}W.tC=JB.lL.av(A,B);if(B=='node'){return;}if((W.tC is LC)&&!(W.tC as LC).wU){wJB=false;vJB=new vd(W.tC,JB,xJB);}}static const List<String> n3=const[r'$is',r'$permission',r'$settings'];void xJB(XG A){if(vJB==null){wB.rD('warning, unexpected state of profile loading');return;}vJB.cancel();vJB=null;dC.addAll(A.dC.where((B)=>!n3.contains(B)));wJB=true;Pa();}bool wJB=true;void Pa(){if(wJB){if(qE.cE!=oB.OM){mJB.add(new XG(W,dC.toList(),qE.cE));dC.clear();}if(qE.cE==oB.CD){mJB.close();}}}bool tJB=false;void uJB(){tJB=false;}void qAB(){if(qE==null&&!mV){mV=true;JB.MU(this);}}bool mV=false;void qR(int A,int B){if(!mV){return;}qE=JB.qJB({'method':'list','path':W.BC},this);mV=false;}void IU(int A,int B,int C){}void sJB(B(XG update)){if(wJB&&qE!=null){FC.TM((){var A=<String>[] ;A..addAll(W.L.keys)..addAll(W.HB.keys)..addAll(W.R.keys);XG C=new XG(W,A,qE.cE);B(C);});}}void rJB(){yJB();}void yJB(){mV=false;if(vJB!=null){vJB.cancel();vJB=null;}if(qE!=null){JB.hu(qE);qE=null;}mJB.close();W.XJB=null;}}class Np implements wN{final Completer<EH> UL=new Completer<EH>();Future<EH> get future=>UL.future;final pB JB;final String path;YG nJB;Np(this.JB,this.path){var A=<String,dynamic>{'method':'remove','path':path};nJB=JB.qJB(A,this);}void YI(String A,List B,List C,Map D,X G){UL.complete(new EH(A));}void onDisconnect(){}void IV(){}}class Mp implements wN{final Completer<EH> UL=new Completer<EH>();Future<EH> get future=>UL.future;final pB JB;final String path;final Object value;YG nJB;Mp(this.JB,this.path,this.value,[int A=b.s]){var B=<String,dynamic>{'method':'set','path':path,'value':value};if(A!=b.s){B['permit']=b.fd[A];}nJB=JB.qJB(B,this);}void YI(String A,List B,List C,Map D,X G){UL.complete(new EH(A));}void onDisconnect(){}void IV(){}}class td implements StreamSubscription{MM callback;pB JB;String path;td(this.JB,this.path,this.callback);Future cancel(){if(callback!=null){JB.UJ(path,callback);callback=null;}return null;}Future asFuture([A]){return null;}bool get isPaused=>false;void onData(void A(data)){}void onDone(void A()){}void onError(Function A){}void pause([Future A]){}void resume(){}}class wd implements wN{vW qE;wd();void onDisconnect(){}void IV(){}void YI(String A,List B,List C,Map D,X G){}}class vW extends YG implements DG{int tU=0;int S$(){do{if(tU<0x7FFFFFFF){ ++tU;}else{tU=1;}}while(aV.containsKey(tU));return tU;}final Map<String,ZG> DC=new Map<String,ZG>();final Map<int,ZG> aV=new Map<int,ZG>();vW(pB A,int B):super(A,B,new wd(),null){(QP as wd).qE=this;}void Dx(){QG();}void kJB([X A]){if(DC.isNotEmpty){zJB.addAll(DC.keys);}AKB=0;BKB=-1;CKB=false;}void hJB(Map K){List I=K['updates'];if(I is List){for(Object A in I){String B;int C=-1;Object G;String H;Map J;if(A is Map){if(A['ts'] is String){B=A['path'];H=A['ts'];if(A['path'] is String){B=A['path'];}else if(A['sid'] is int){C=A['sid'];}else{continue;}}G=A['value'];J=A;}else if(A is List&&A.length>2){if(A[0] is String){B=A[0];}else if(A[0] is int){C=A[0];}else{continue;}G=A[1];H=A[2];}else{continue;}ZG D;if(B!=null){D=DC[B];}else if(C>-1){D=aV[C];}if(D!=null){var M=new GB(G,ts:H,meta:J);D.vM(M);}}}}HashSet<String> zJB=new HashSet<String>();void addSubscription(ZG A,int C){String B=A.W.BC;DC[B]=A;aV[A.sE]=A;QG();zJB.add(B);}void OBB(ZG A){String B=A.W.BC;if(DC.containsKey(B)){sa[DC[B].sE]=DC[B];QG();}else if(aV.containsKey(A.sE)){wB.oC('unexpected remoteSubscription in the requester, sid: ${A.sE}');}}Map<int,ZG> sa=new Map<int,ZG>();void qR(int K,int D){DKB=false;if(D!=-1){AKB++ ;BKB=D;}if(JB.connection==null){return;}List B=[] ;HashSet<String> I=zJB;zJB=new HashSet<String>();for(String C in I){if(DC.containsKey(C)){ZG A=DC[C];Map G={'path':C,'sid':A.sE};if(A.KJ>0){G['qos']=A.KJ;}B.add(G);}}if(!B.isEmpty){JB.qJB({'method':'subscribe','paths':B},null);}if(!sa.isEmpty){List H=[] ;sa.forEach((int J,ZG A){if(A.ZC.isEmpty){H.add(J);DC.remove(A.W.BC);aV.remove(A.sE);A.yJB();}});JB.qJB({'method':'unsubscribe','sids':H},null);sa.clear();}}bool DKB=false;int AKB=0;int BKB=-1;void IU(int A,int B,int C){if(A==BKB){AKB=0;}else{AKB-- ;}if(CKB){CKB=false;QG();}}bool CKB=false;void QG(){if(CKB){return;}if(AKB>DG.ed){CKB=true;return;}if(!DKB){DKB=true;JB.MU(this);}}}class ZG{final LC W;final pB JB;Map<Function,int> ZC=new Map<Function,int>();int KJ=-1;int sE;ZG(this.W,this.JB){sE=JB.EKB.S$();}void listen(B(GB update),int A){if(A<0||A>3){A=0;}bool C=false;if(ZC.containsKey(B)){if(ZC[B]!=0){ZC[B]=A;C=ux();}else{ZC[B]=A;}}else{ZC[B]=A;int D=A;if(KJ>-1){D|= KJ;}C=D>KJ;KJ=D;if(ZJB!=null){B(ZJB);}}if(C){JB.EKB.addSubscription(this,KJ);}}void mBB(A(GB update)){if(ZC.containsKey(A)){int B=ZC.remove(A);if(ZC.isEmpty){JB.EKB.OBB(this);}else if(B==KJ&&KJ>1){ux();}}}bool ux(){int A=0;for(var B in ZC.values){A|= B;}if(A!=KJ){KJ=A;return true;}return false;}GB ZJB;void vM(GB A){ZJB=A;for(Function B in ZC.keys.toList()){B(ZJB);}}void yJB(){ZC.clear();W.YJB=null;}}typedef BB ud<BB>(YG _0);abstract class wN{}class EH{final String cE;EH(this.cE);}class pB extends qW{Map<int,YG> iJB=new Map<int,YG>();final xN lL;vW EKB;pB([xN A]):lL=A!=null?A:new xN(){EKB=new vW(this,0);iJB[0]=EKB;}int get Zx{return EKB.DC.length;}void onData(List B){for(Object A in B){if(A is Map){FKB(A);}}}void FKB(Map A){if(A['rid'] is int&&iJB.containsKey(A['rid'])){iJB[A['rid']].hJB(A);}}StreamController<X> jJB=new StreamController<X>.broadcast();Stream<X> get onError=>jJB.stream;int GN=0;int R$(){do{if(GN<0x7FFFFFFF){ ++GN;}else{GN=1;}}while(iJB.containsKey(GN));return GN;}NM WR(int A,int B){NM C=super.WR(A,B);return C;}YG qJB(Map<String,dynamic> A,wN C){A['rid']=R$();YG B;if(C!=null){B=new YG(this,GN,C,A);iJB[GN]=B;}OU(A);return B;}td wF(String A,B(GB update),[int C=0]){LC D=lL.CK(A);D.cJB(this,B,C);return new td(this,A,B);}Future<LC> CK(String C){var A=new Completer<LC>();StreamSubscription B;B=list(C).listen((D){if(!A.isCompleted){A.complete(D.W);}if(B!=null){B.cancel();}},onError:(G,H){if(!A.isCompleted){A.completeError(G,H);}},cancelOnError:true);return A.future;}void UJ(String A,B(GB update)){LC C=lL.CK(A);C.dJB(this,B);}Stream<XG> list(String A){LC B=lL.CK(A);return B.bJB(this);}Stream<iK> WB(String A,[Map B=const{},int C=b.s,ud D]){LC G=lL.CK(A);return G.eJB(B,this,C,D);}Future<EH> set(String A,Object B,[int C=b.s]){return new Mp(this,A,B,C).future;}Future<EH> remove(String A){return new Np(this,A).future;}void hu(YG A){if(iJB.containsKey(A.cD)){if(A.cE!=oB.CD){OU({'method':'close','rid':A.cD});}iJB.remove(A.cD);A.kJB();}}bool GKB=false;void OJ(){if(!GKB)return;GKB=false;var B=new Map<int,YG>();B[0]=EKB;iJB.forEach((C,A){if(A.cD<=GN&&A.QP is!jK){A.kJB(X.Fp);}else{B[A.cD]=A;A.QP.onDisconnect();}});iJB=B;}void KN(){if(GKB)return;GKB=true;super.KN();iJB.forEach((B,A){A.QP.IV();A.Dx();});}}class NQ{final String name;final String type;final Object HF;NQ.vCB(this.name,Map A):type=A.containsKey('type')?A['type']:'string',HF=A.containsKey('default')?A['default']:null{}X yL(Object B,iJ A,Y C){if(A.L[name]!=B){A.L[name]=B;A.SB(name);}return null;}X FP(iJ A,Y B){if(A.L.containsKey(name)){A.L.remove(name);A.SB(name);}return null;}}class QQ{static const Map t3=const{r'$is':const{'type':'profile'},r'$interface':const{'type':'interface'},r'$permissions':const{'type':'list','require':b.s,'writable':b.s},r'$name':const{'type':'string'},r'$type':const{'type':'type'},r'$invokable':const{'type':'permission','default':'read'},r'$writable':const{'type':'permission','default':'never'},r'$settings':const{'type':'map'},r'$params':const{'type':'list'},r'$columns':const{'type':'list'},r'$streamMeta':const{'type':'list'}};static final QQ Rp=new QQ()..load(t3);static final NQ u3=new NQ.vCB('',const{});static NQ AX(String A,KB B){if(Rp.L.containsKey(A)){return Rp.L[A];}if(B is QM&&B.L.containsKey(A)){return B.L[A];}return u3;}Map<String,NQ> L={};void load(Map C){C.forEach((A,B){if(B is Map){L[A]=new NQ.vCB(A,B);}});}}typedef V yd(Map _0,Y _1,V _2,l _3);class QM extends iJ{final BF provider;QM(String A,this.provider):super(A){this.L[r"$is"]="static";}yd HKB;void dBB(yd A){HKB=A;}V WB(Map<String,dynamic> H,Y B,V A,KB C,[int G=b.s]){if(HKB==null){return A..close(X.c3);}String I=C is l?C.path:null;int D=B.lB.oE.rF(I,B);if(G<D){D=G;}if(tZ()<=D){HKB(H,B,A,C);return A;}else{return A..close(X.DH);}return A..close();}}abstract class xd extends BF{Map<String,l> get g;}abstract class iJ extends l{iJ(String A):super(A);Map XH(bool D){var C={};L.forEach((B,A){C[B]=A;});HB.forEach((B,A){C[B]=A;});R.forEach((B,A){if(D){if(A is iJ){C[B]=A.XH(true);}else{C[B]=A.TI();}}});return C;}bool IKB=false;bool get Nw=>IKB;void load(Map G){if(IKB){L.clear();HB.clear();R.clear();}String C;if(path=='/'){C='/';}else{C='${path}/';}G.forEach((String A,B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){HB[A]=B;}else if(B is Map){KB D=provider.DB('${C}${A}',false);if(D is iJ){D.load(B);}R[A]=D;}});IKB=true;}void SB(String A){sF.add(A);}q RN(String A,Object B,Y D,q C){if(!HB.containsKey(A)||HB[A]!=B){HB[A]=B;SB(A);if(provider is cF){(provider as cF).lG();}}return C..close();}q wj(String A,Y C,q B){if(HB.containsKey(A)){HB.remove(A);SB(A);if(provider is cF){(provider as cF).lG();}}return B..close();}q yL(String B,Object C,Y D,q A){var G=QQ.AX(B,tC);A.close(G.yL(C,this,D));return A;}q FP(String A,Y B,q C){var D=QQ.AX(A,tC);return C..close(D.FP(this,B));}q zB(Object A,Y C,q B,[int D=b.s]){v(A);return B..close();}}abstract class oS{}class q3 implements oS{int rF(String A,Y B){return b.s;}}abstract class pS{}abstract class zN{String get QN;EG hv(String A);void Ti(String A);Future<List<EG>> load();void destroy();}abstract class EG{final String path;final zN SC;int NV;EG(this.path,this.SC);void vM(GB A);void zB(Iterable<GB> A,GB B);void yj(GB A);void zx(Iterable<GB> A){}void destroy();List<GB> ev();}abstract class RQ{}abstract class SQ{String get key;void zB(Object A);Future pv();void destroy();}typedef dynamic lK(vD _0);class vD{String path;String type;String oO;String Tu;int cD;List get Fk=>[path,type,cD,Tu,oO];vD(this.path,this.type,this.cD,[this.oO='',this.Tu]);}abstract class l extends KB{mI<String> JKB;mI<String> get sF{if(JKB==null){JKB=new mI<String>((){KKB=true;gR();},(){KKB=false;Uj();},null,true);}return JKB;}void nw(mI<String> A){JKB=A;}Stream<String> get Ej=>sF.stream;void gR(){}void Uj(){}bool KKB=false;BF get provider;final String path;l(this.path);Map<MM,int> ZC=new Map<MM,int>();kK wF(A(GB update),[int B=0]){ZC[A]=B;return new kK(this,A);}void UJ(MM A){if(ZC.containsKey(A)){ZC.remove(A);}}GB LKB;GB get gL{if(LKB==null){LKB=new GB(null);}return LKB;}dynamic get value{if(LKB!=null){return LKB.value;}return null;}bool MKB=false;bool get Jb=>MKB;void v(Object A,{bool force: false}){MKB=true;if(A is GB){LKB=A;ZC.forEach((B,C){B(LKB);});}else if(LKB==null||LKB.value!=A||force){LKB=new GB(A);ZC.forEach((B,C){B(LKB);});}}void XU(){MKB=false;LKB=null;}bool get exists=>true;bool get Jw=>true;String get QI=>null;bool get hasSubscriber=>ZC.isNotEmpty;int tZ(){return b.vH(qF(r'$invokable'));}int nv(){return b.vH(qF(r'$writable'));}V WB(Map<String,dynamic> B,Y C,V A,KB D,[int G=b.s]){return A..close();}q RN(String A,Object C,Y D,q B){if(B!=null){return B..close();}else{if(!A.startsWith("@")){A="@${A}";}HB[A]=C;if(provider is cF){(provider as cF).lG();}return null;}}q wj(String A,Y C,q B){if(B!=null){return B..close();}else{if(!A.startsWith("@")){A="@${A}";}HB.remove(A);if(provider is cF){(provider as cF).lG();}return null;}}q yL(String A,Object C,Y D,q B){if(B!=null){return B..close();}else{if(!A.startsWith(r"$")){A="\$${A}";}L[A]=C;return null;}}q FP(String A,Y C,q B){if(B!=null){return B..close();}else{if(!A.startsWith(r"$")){A="\$${A}";}L.remove(A);return null;}}q zB(Object B,Y C,q A,[int D=b.s]){return A..close();}operator[](String A){return get(A);}operator[]=(String A,Object B){if(A.startsWith(r"$")){L[A]=B;}else if(A.startsWith(r"@")){HB[A]=B;}else if(B is KB){iB(A,B);}}void load(Map<String,dynamic> A){}}abstract class BF{l yB(String A);l DB(String A,[bool B=true]);l operator[](String A){return yB(A);}l operator~()=>DB("/",false);Y aU(String A,String B);oS get oE;}class Y extends qW{String nR;int QAB=DG.V3;zN SC;void j$(zN D,List<EG> B){if(SC!=null){SC.destroy();}SC=D;if(SC!=null&&B!=null){for(EG A in B){var C=A.ev();l G=lB.DB(A.path,false);AF H=NKB.add(A.path,G,-1,A.NV);if(C.isNotEmpty){H.SBB(C);}}}}List<String> groups=[] ;void VJ(List<String> B,[bool C=false]){if(C){groups=B.where((A)=>A!='').toList();}else{groups=[nR]..addAll(B.where((A)=>A!=''));}}final Map<int,q> OKB=new Map<int,q>();int get vAB{return OKB.length;}int get Zx{return NKB.DC.length;}zW NKB;final BF lB;Y(this.lB,[this.nR]){NKB=new zW(this,0);OKB[0]=NKB;if(nR!=null){groups=[nR];}}q KI(q A){if(A.PKB!=oB.CD){OKB[A.cD]=A;if(QKB!=null){vD B=A.XR();for(lK C in QKB){C(B);}}}else{if(QKB!=null){vD B=A.XR('');for(lK C in QKB){C(B);}}}return A;}void nx(q A){vD B=A.XR('-');for(lK C in QKB){C(B);}}bool uu=false;void onData(List B){if(uu){return;}for(Object A in B){if(A is Map){RKB(A);}}}void RKB(Map A){Object B=A['method'];if(A['rid'] is int){if(B==null){wBB(A);return;}else{if(OKB.containsKey(A['rid'])){if(B=='close'){close(A);}return;}switch (B){case 'list':list(A);return;case 'subscribe':wF(A);return;case 'unsubscribe':UJ(A);return;case 'invoke':WB(A);return;case 'set':set(A);return;case 'remove':remove(A);return;}}}cC(A['rid'],error:X.pd);}void cC(int A,{q response,X error}){if(response!=null){if(OKB[response.cD]!=response){return;}response.PKB=oB.CD;A=response.cD;}Map B={'rid':A,'stream':oB.CD};if(error!=null){B['error']=error.XH();}OKB.remove(A);OU(B);}void Fb(q A,List C,{String streamStatus,List<dynamic> columns,Map meta,void handleMap(Map m)}){if(OKB[A.cD]==A){Map B={'rid':A.cD};if(streamStatus!=null&&streamStatus!=A.PKB){A.PKB=streamStatus;B['stream']=streamStatus;}if(columns!=null){B['columns']=columns;}if(C!=null){B['updates']=C;}if(meta!=null){B['meta']=meta;}if(handleMap!=null){handleMap(B);}OU(B);if(A.PKB==oB.CD){OKB.remove(A.cD);if(QKB!=null){nx(A);}}}}void list(Map A){FB B=FB.sW(A['path']);if(B!=null&&B.isAbsolute){int C=A['rid'];SKB(B,(l D){KI(new Pp(this,C,D));},(G,H){var I=new X("nodeError",msg:G.toString(),detail:H.toString());cC(A['rid'],error:I);});}else{cC(A['rid'],error:X.mS);}}void wF(Map B){if(B['paths'] is List){for(Object A in B['paths']){String D;int G=0;int H=-1;if(A is Map){if(A['path'] is String){D=A['path'];}else{continue;}if(A['sid'] is int){H=A['sid'];}else{continue;}if(A['qos'] is int){G=A['qos'];}}FB C=FB.sW(D);if(C!=null&&C.isAbsolute){SKB(C,(l I){NKB.add(C.path,I,H,G);cC(B['rid']);},(J,K){var M=new X("nodeError",msg:J.toString(),detail:K.toString());cC(B['rid'],error:M);});}else{cC(B['rid']);}}}else{cC(B['rid'],error:X.Ep);}}void SKB(FB I,HO<l> G,[L4<dynamic,dynamic> B]){try {l A=lB.DB(I.path,false);if(A is PQ){(A as PQ).fw.then((H){if(H is l){A=H;}G(A);}).catchError((C,D){if(B!=null){B(C,D);}});}else{G(A);}}catch (C,D){if(B!=null){B(C,D);}else{rethrow;}}}void UJ(Map A){if(A['sids'] is List){for(Object B in A['sids']){if(B is int){NKB.remove(B);}}cC(A['rid']);}else{cC(A['rid'],error:X.Ep);}}void WB(Map A){FB C=FB.sW(A['path']);if(C!=null&&C.isAbsolute){int M=A['rid'];l D;D=lB.DB(C.gB,false);G([l J]){l B=J==null?lB.yB(C.path):J;if(B==null){if(J==null){B=D.SI(C.name);if(B==null){cC(A['rid'],error:X.DH);return;}if(B is PQ){(B as PQ).fw.then((O)=>G(B));return;}else{G(B);return;}}else{cC(A['rid'],error:X.DH);return;}}int H=lB.oE.rF(C.path,this);int K=b.vH(A['permit']);if(K<H){H=K;}Map<String,dynamic> I;if(A["params"] is Map<String,dynamic>){I=A["params"] as Map<String,dynamic>;}if(I==null){I={};}if(B.tZ()<=H){B.WB(I,this,KI(new V(this,M,D,B,C.name)),D,H);}else{cC(A['rid'],error:X.DH);}}if(D is PQ){(D as PQ).fw.then((O){G();}).catchError((P,Q){var S=new X("nodeError",msg:P.toString(),detail:Q.toString());cC(A['rid'],error:S);});}else{G();}}else{cC(A['rid'],error:X.mS);}}void wBB(Map A){int B=A['rid'];if(OKB[B] is V){if(A['params'] is Map){(OKB[B] as V).CCB(A['params']);}}else{cC(A['rid'],error:X.pd);}}void set(Map A){FB C=FB.Dp(A['path']);if(C==null||!C.isAbsolute){cC(A['rid'],error:X.mS);return;}if(!A.containsKey('value')){cC(A['rid'],error:X.d3);return;}Object G=A['value'];int H=A['rid'];if(C.Ba){SKB(C,(l B){int D=lB.oE.rF(B.path,this);int I=b.vH(A['permit']);if(I<D){D=I;}if(B.nv()<=D){B.zB(G,this,KI(new q(this,H)));}else{cC(A['rid'],error:X.DH);}cC(A['rid']);},(J,K){var M=new X("nodeError",msg:J.toString(),detail:K.toString());cC(A['rid'],error:M);});}else if(C.zv){l B;B=lB.DB(C.gB,false);int D=lB.oE.rF(B.path,this);if(D<b.s){cC(A['rid'],error:X.DH);}else{B.yL(C.name,G,this,KI(new q(this,H)));}}else if(C.xv){l B;B=lB.DB(C.gB,false);int D=lB.oE.rF(B.path,this);if(D<b.KQ){cC(A['rid'],error:X.DH);}else{B.RN(C.name,G,this,KI(new q(this,H)));}}else{throw 'unexpected case';}}void remove(Map C){FB A=FB.Dp(C['path']);if(A==null||!A.isAbsolute){cC(C['rid'],error:X.mS);return;}int G=C['rid'];if(A.Ba){cC(C['rid'],error:X.pd);}else if(A.zv){l B;B=lB.DB(A.gB,false);int D=lB.oE.rF(B.path,this);if(D<b.s){cC(C['rid'],error:X.DH);}else{B.FP(A.name,this,KI(new q(this,G)));}}else if(A.xv){l B;B=lB.DB(A.gB,false);int D=lB.oE.rF(B.path,this);if(D<b.KQ){cC(C['rid'],error:X.DH);}else{B.wj(A.name,this,KI(new q(this,G)));}}else{throw 'unexpected case';}}void close(Map B){if(B['rid'] is int){int A=B['rid'];if(OKB.containsKey(A)){OKB[A].TKB();q C=OKB.remove(A);if(QKB!=null){nx(C);}}}}void OJ(){X_();OKB.forEach((B,A){A.TKB();});OKB.clear();OKB[0]=NKB;}void KN(){super.KN();}List<lK> QKB;void sh(lK A){NKB.sh(A);OKB.forEach((int C,q B){A(B.XR());});if(QKB==null)QKB=new List<lK>();QKB.add(A);}}class q implements DG{final Y CC;final int cD;String PKB=oB.OM;q(this.CC,this.cD);void close([X A=null]){PKB=oB.CD;CC.cC(cD,error:A,response:this);}void TKB(){}void QG(){if(!UKB){UKB=true;CC.MU(this);}}bool UKB=false;void qR(int A,int B){UKB=false;}void IU(int A,int B,int C){}vD XR([String A='+']){return null;}}typedef void Qp(V _0);typedef void p3(V _0,Map _1);typedef bool r3(V _0,Map _1);class OQ{String status;List FD;List RP;Map meta;OQ(this.status,this.RP,this.FD,this.meta);}class V extends q{final l pL;final l W;final String name;V(Y A,int B,this.pL,this.W,this.name):super(A,B);List<OQ> DP=new List<OQ>();bool VKB=false;void hB(List A,{List columns,String streamStatus: oB.uN,Map meta,bool autoSendColumns: true}){if(meta!=null&&meta['mode']=='refresh'){DP.length=0;}if(!VKB){if(columns==null&&autoSendColumns&&W!=null&&W.L[r"$columns"] is List){columns=W.L[r"$columns"];}}if(columns!=null){VKB=true;}DP.add(new OQ(streamStatus,A,columns,meta));QG();}r3 Ra;void CCB(Map A){if(Ra!=null){Ra(this,A);}}void qR(int D,int G){UKB=false;if(WKB!=null){CC.cC(cD,response:this,error:WKB);if(PKB==oB.CD){TKB();}return;}for(OQ A in DP){List<Map<String,dynamic>> B;if(A.FD!=null){B=bF.Y3(A.FD);}CC.Fb(this,A.RP,streamStatus:A.status,columns:B,meta:A.meta,handleMap:(C){if(hw!=null){hw(this,C);}});if(PKB==oB.CD){TKB();break;}}DP.length=0;}void close([X A=null]){if(A!=null){WKB=A;}if(!DP.isEmpty){DP.last.status=oB.CD;}else{DP.add(new OQ(oB.CD,null,null,null));QG();}}X WKB;Qp mE;p3 hw;void TKB(){if(mE!=null){mE(this);}}vD XR([String A='+']){return new vD(pL.path,'invoke',cD,A,name);}}class Pp extends q{final l W;StreamSubscription XKB;int YKB;Pp(Y A,int B,this.W):super(A,B){YKB=A.lB.oE.rF(W.path,A);XKB=W.Ej.listen(changed);if(W.Jw){QG();}else if(W.QI!=null){QG();}}LinkedHashSet<String> dC=new LinkedHashSet<String>();bool wv=true;void changed(String A){if(YKB==b.iS){return;}if(A.startsWith(r'$$')){if(YKB<b.s){return;}if(A.startsWith(r'$$$')){return;}}if(dC.isEmpty){dC.add(A);QG();}else{dC.add(A);}}bool ZKB=false;void qR(int S,int Q){UKB=false;if(Q!=-1){aKB++ ;bKB=Q;}Object I;Object M;List G=[] ;List O=[] ;List P=[] ;if(W.QI!=null){CC.Fb(this,[[r'$disconnectedTs',W.QI]],streamStatus:oB.uN);ZKB=true;dC.clear();return;}else if(ZKB&&!dC.contains(r'$disconnectedTs')){ZKB=false;G.add({'name':r'$disconnectedTs','change':'remove'});if(W.L.containsKey(r'$disconnectedTs')){W.L.remove(r'$disconnectedTs');}}if(wv||dC.contains(r'$is')){wv=false;if(YKB==b.iS){return;}else{W.L.forEach((C,J){Object B=[C,J];if(C==r'$is'){I=B;}else if(C==r'$base'){M=B;}else if(C.startsWith(r'$$')){if(YKB==b.s&&!C.startsWith(r'$$$')){G.add(B);}}else{if(YKB!=b.s){if(C==r'$writable'){if(YKB<b.KQ){return;}}if(C==r'$invokable'){int D=b.vH(W.qF(r'$invokable'));if(D>YKB){G.add([r'$invokable','never']);return;}}}G.add(B);}});W.HB.forEach((C,J){O.add([C,J]);});W.R.forEach((C,KB J){Map H=J.TI();if(YKB!=b.s){int D=b.vH(H[r'$invokable']);if(D!=b.jS&&D>YKB){H[r'$invokable']='never';}}P.add([C,H]);});}if(I==null){I=[r'$is','node'];}}else{for(String A in dC){Object B;if(A.startsWith(r'$')){if(YKB!=b.s){if(A==r'$writable'){if(YKB<b.KQ){continue;}}if(A==r'$invokable'){int D=b.vH(W.qF(r'$invokable'));if(D>YKB){G.add([r'$invokable','never']);continue;}}}if(W.L.containsKey(A)){B=[A,W.L[A]];}else{B={'name':A,'change':'remove'};}if(YKB==b.s||!A.startsWith(r'$$')){G.add(B);}}else if(A.startsWith(r'@')){if(W.HB.containsKey(A)){B=[A,W.HB[A]];}else{B={'name':A,'change':'remove'};}O.add(B);}else{if(W.R.containsKey(A)){Map H=W.R[A].TI();if(YKB!=b.s){int D=b.vH(H[r'$invokable']);if(D!=b.jS&&D>YKB){H[r'$invokable']='never';}}B=[A,H];}else{B={'name':A,'change':'remove'};}P.add(B);}}}dC.clear();List K=[] ;if(M!=null){K.add(M);}if(I!=null){K.add(I);}K..addAll(G)..addAll(O)..addAll(P);CC.Fb(this,K,streamStatus:oB.uN);}int aKB=0;int bKB=-1;void IU(int A,int B,int C){if(A==bKB){aKB=0;}else{aKB-- ;}if(cKB){cKB=false;QG();}}bool cKB=false;void QG(){if(cKB){return;}if(aKB>DG.ed){cKB=true;return;}if(!UKB){UKB=true;CC.MU(this);}}void TKB(){XKB.cancel();}vD XR([String A='+']){return new vD(W.path,'list',cD,A,null);}}class kK{MM callback;l W;kK(this.W,this.callback);void cancel(){if(callback!=null){W.UJ(callback);callback=null;}}}class zW extends q{zW(Y A,int B):super(A,B);final Map<String,AF> DC=new Map<String,AF>();final Map<int,AF> SN=new Map<int,AF>();final LinkedHashSet<AF> changed=new LinkedHashSet<AF>();AF add(String C,l D,int B,int G){AF A;if(DC[C]!=null){A=DC[C];if(A.sE!=B){if(A.sE>=0){SN.remove(A.sE);}A.sE=B;if(B>=0){SN[B]=A;}}A.xw=G;if(B>-1&&A.aD!=null){Yx(A);}}else{int H=CC.lB.oE.rF(D.path,CC);A=new AF(this,D,B,H>=b.pW,G);DC[C]=A;if(B>=0){SN[B]=A;}if(CC.QKB!=null){vD I=new vD(C,'subscribe',0,'+');for(lK J in CC.QKB){J(I);}}}return A;}void remove(int A){if(SN[A]!=null){AF B=SN[A];SN[A].destroy();SN.remove(A);DC.remove(B.W.path);if(CC.QKB!=null){vD C=new vD(B.W.path,'subscribe',0,'-');for(lK D in CC.QKB){D(C);}}}}void Yx(AF A){changed.add(A);QG();}void qR(int D,int A){UKB=false;if(A!=-1){aKB++ ;dKB=A;}List B=new List();for(AF C in changed){B.addAll(C.process(A));}CC.Fb(this,B);changed.clear();}int aKB=0;int dKB=-1;void IU(int A,int C,int D){if(A==dKB){aKB=0;}else{aKB-- ;}DC.forEach((String G,AF B){if(B.eKB>0){B.eAB(A);}});if(cKB){cKB=false;QG();}}bool cKB=false;void QG(){if(cKB){return;}if(aKB>DG.ed){cKB=true;return;}if(CC.connection==null){return;}if(!UKB){UKB=true;CC.MU(this);}}void TKB(){List B;DC.forEach((C,AF A){if(A.eKB==0){A.destroy();}else{A.sE=-1;if(B==null){B=new List();}B.add(A);}});DC.clear();if(B!=null){for(AF A in B){DC[A.W.path]=A;}}SN.clear();aKB=0;dKB=-1;cKB=false;}void sh(lK A){DC.forEach((D,B){vD C=new vD(B.W.path,'subscribe',0,'+');A(C);});}}class AF{final l W;final zW response;kK fKB;int sE;bool gKB=true;List<GB> PG=new List<GB>();ListQueue<GB> eD;GB aD;int eKB=-1;EG hKB;void set xw(int A){if(A<0||A>3)A=0;if(eKB==A)return;eKB=A;if(eD==null&&eKB>0){eD=new ListQueue<GB>();}P_=(A&1)==1;lG=(A&2)==2;}bool iKB=false;void set P_(bool A){if(A==iKB)return;iKB=A;if(!iKB){PG.length=0;}}bool jKB=false;void set lG(bool B){if(B==jKB)return;jKB=B;zN A=response.CC.SC;if(A!=null){if(jKB){hKB=A.hv(W.path);}else if(hKB!=null){A.Ti(W.path);hKB=null;}}}AF(this.response,this.W,this.sE,this.gKB,int A){this.xw=A;fKB=W.wF(vM,eKB);if(W.Jb&&W.gL!=null){vM(W.gL);}}bool kKB=true;void vM(GB A){if(iKB&&kKB){PG.add(A);if(PG.length>response.CC.QAB){kKB=false;aD=new GB(null,ts:'');for(GB B in PG){aD.RAB(B);}PG.length=0;if(eKB>0){if(hKB!=null){hKB.zB(eD,aD);}eD..clear()..add(aD);}}else{aD=A;if(eKB>0){eD.add(aD);if(hKB!=null){hKB.vM(aD);}}}}else{if(aD!=null){aD=new GB.tCB(aD,A);}else{aD=A;}if(eKB>0){if(hKB!=null){hKB.zB(eD,aD);}eD..clear()..add(aD);}}if(gKB&&sE>-1){response.Yx(this);}}List process(int B){List A=new List();if(iKB&&kKB){for(GB C in PG){A.add([sE,C.value,C.ts]);}if(eKB>0){for(GB G in PG){G.nV=B;}}PG.length=0;}else{if(aD.count>1||aD.status!=null){Map D=aD.Xk();D['sid']=sE;A.add(D);}else{A.add([sE,aD.value,aD.ts]);}if(eKB>0){aD.nV=B;}kKB=true;}aD=null;return A;}void eAB(int A){if(eD.isEmpty){return;}bool B=false;if(!eD.isEmpty&&eD.first.nV!=A){GB C;for(GB G in eD){if(G.nV==A){C=G;break;}}if(C!=null){while(!eD.isEmpty&&eD.first!=C){GB D=eD.removeFirst();if(hKB!=null){hKB.yj(D);B=true;}}}}while(!eD.isEmpty&&eD.first.nV==A){GB D=eD.removeFirst();if(hKB!=null){hKB.yj(D);B=true;}}if(B&&hKB!=null){hKB.zx(eD);}}void SBB(List<GB> A){if(this.iKB){if(PG.length>0&&PG.first.JF(A.last)){PG.removeAt(0);}PG=A..addAll(PG);if(eD!=null){eD.clear();eD.addAll(PG);}}else{PG.length=0;if(eD!=null){eD.clear();eD.add(A.last);}}aD=A.last;}void destroy(){if(hKB!=null){zN A=response.CC.SC;A.Ti(W.path);hKB=null;}fKB.cancel();}}typedef l yW(String _0);typedef AC o3(String _0);class s3{}abstract class PQ{}class yN{V response;List FD;List QK;String status=oB.uN;Map meta;Qp mE;yN([this.FD]);void update(List A,[String B,Map C]){if(this.QK==null){this.QK=A;}else{this.QK.addAll(A);}this.meta=C;if(B!=null){status=B;}if(response==null){new Future(write);}else{write();}}void write([V A]){if(A!=null){if(response==null){response=A;}else{wB.gC("can not use same AsyncTableResult twice");}}if(response!=null&&(QK!=null||meta!=null||status==oB.CD)){response.hB(QK,columns:FD,streamStatus:status,meta:meta);QK=null;FD=null;}}void close(){if(response!=null){response.close();}else{status=oB.CD;}}}class Sp{}abstract class cF{}abstract class AO{}class aG extends xd implements cF,AO{static aG zd;JX jKB;final Map<String,l> g=new Map<String,l>();List<o3> lKB=[] ;l yB(String A){return SKB(A);}l SKB(String B,{bool allowStubs: false}){if(g.containsKey(B)){AC A=g[B];if(allowStubs||A.mKB==false){return A;}}if(lKB.isNotEmpty){for(var C in lKB){var A=C(B);if(A!=null){return A;}}}return null;}l DB(String B,[bool G=true,bool H=true]){l A=SKB(B,allowStubs:true);if(A!=null){if(G){FB C=new FB(B);if(!C.u$){l D=yB(C.gB);if(D!=null&&!D.R.containsKey(C.name)){D.iB(C.name,A);D.sF.add(C.name);A.sF.add(r"$is");}}if(A is AC){A.mKB=false;}}return A;}if(G){return d_(B,H);}else{A=new AC(B,this)..mKB=true;g[B]=A;return A;}}void eBB(JX A){jKB=A;}void lG([bool A=false]){if(A){if(jKB==null){return;}jKB();}else{new Future.delayed(const Duration(seconds:5),(){if(jKB==null){return;}jKB();});}}AC d_(String A,[bool H=true]){FB C=new FB(A);l B=g[A];if(B!=null){if(B is AC){if(B.mKB!=true){throw new Exception("Node at ${A} already exists.");}else{B.mKB=false;}}else{throw new Exception("Node at ${A} already exists.");}}AC D=B==null?new AC(A,this):B;g[A]=D;if(H){D.Na();}AC G;if(C.gB!=""){G=yB(C.gB);}if(G!=null){G.R[C.name]=D;G.Vj(C.name,D);G.SB(C.name);}return D;}aG([Map<String,dynamic> A,Map<String,yW> B]){if(zd==null){zd=this;}ZB=new AC("/",this);g["/"]=ZB;Si=new qS('/defs',this);g[Si.path]=Si;Sk=new qS('/sys',this);g[Sk.path]=Sk;init(A,B);}AC ZB;qS Si;qS Sk;void init([Map<String,dynamic> B,Map<String,yW> A]){if(A!=null){if(A.isNotEmpty){nKB.addAll(A);}else{nKB=A;}}if(B!=null){ZB.load(B);}}Map rE(){return ZB.rE();}void v(String A,Object B){AC C=yB(A);C.v(B);}void u(String B,AC A,{bool registerChildren: false}){if(B=='/'||!B.startsWith('/'))return null;FB C=new FB(B);AC D=yB(C.gB);g[B]=A;A.Na();if(D!=null){D.R[C.name]=A;D.Vj(C.name,A);D.SB(C.name);}if(registerChildren){for(AC G in A.R.values){u(G.path,G);}}}AC NZ(String B,Map H){if(B=='/'||!B.startsWith('/'))return null;FB G=new FB(B);AC C=SKB(B,allowStubs:true);AC D=yB(G.gB);AC A;if(D!=null){A=D.jAB(G.name,H,this);}if(A==null){String I=H[r'$is'];if(nKB.containsKey(I)){A=nKB[I](B);}else{A=DB(B,true,false);}}if(C!=null){wB.eC("Found old node for ${B}: Copying subscriptions.");for(MM J in C.ZC.keys){A.wF(J,C.ZC[J]);}if(A is AC){try {A.JKB=C.JKB;}catch (K){}if(A.KKB){A.gR();}}}g[B]=A;A.load(H);A.Na();if(D!=null){D.iB(G.name,A);D.Vj(G.name,A);D.SB(G.name);}A.SB(r"$is");if(C!=null){C.SB(r"$is");}return A;}void mR(String A,{bool recurse: true}){if(A=='/'||!A.startsWith('/'))return;AC B=yB(A);if(B==null){return;}if(recurse){String C=A;if(!C.endsWith("/")){C+= "/";}int I=kp(C,"/");List<String> J=g.keys.where((String H){return H.startsWith(C)&&I==kp(H,"/");}).toList();for(String K in J){mR(K);}}FB D=new FB(A);AC G=yB(D.gB);B.gw();B.GP=true;if(G!=null){G.R.remove(D.name);G.fAB(D.name,B);G.SB(D.name);}g.remove(A);}Map<String,yW> nKB=new Map<String,yW>();oS oE=new q3();Y aU(String A,String B){return new Y(this,A);}String toString({bool showInstances: false}){var A=new StringBuffer();void C(l B,[int D=0]){FB G=new FB(B.path);A.write("${'  '*D}- ${G.name}");if(showInstances){A.write(": ${B}");}A.writeln();for(var H in B.R.values){C(H,D+1);}}C(ZB);return A.toString().trim();}}class AC extends iJ{final aG provider;bool mKB=false;AC(String B,[aG A]):provider=A==null?aG.zd:A,super(B);bool GP=false;bool aBB=true;void load(Map D){if(IKB){L.clear();HB.clear();R.clear();}String C;if(path=='/'){C='/';}else{C='${path}/';}D.forEach((String A,B){if(A.startsWith('?')){if(A=='?value'){v(B);}}else if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){HB[A]=B;}else if(B is Map){String G='${C}${A}';provider.NZ(G,B);}});IKB=true;}Map rE(){Map A={};L.forEach((B,C){A[B]=C;});HB.forEach((B,C){A[B]=C;});if(LKB!=null&&LKB.value!=null){A['?value']=LKB.value;}R.forEach((B,KB D){if(D is AC&&D.aBB==true){A[B]=D.rE();}});return A;}V WB(Map<String,dynamic> PB,Y TB,V A,KB UB,[int dB=b.s]){Object D;try {D=hAB(PB);}catch (G,K){var H=new X("invokeException",msg:G.toString());try {H.detail=K.toString();}catch (G){}A.close(H);return A;}var O="values";if(L.containsKey(r"$result")){O=L[r"$result"];}if(D==null){if(O=="values"){D={};}else if(O=="table"){D=[] ;}else if(O=="stream"){D=[] ;}}if(D is Iterable){A.hB(D.toList(),streamStatus:oB.CD);}else if(D is Map){var h=[] ;var p=[] ;for(var J in D.keys){h.add({"name":J,"type":"dynamic"});p.add(D[J]);}A.hB([p],columns:h,streamStatus:oB.CD);}else if(D is s3){A.hB(D.QK,columns:D.FD,streamStatus:oB.CD);}else if(D is yN){(D as yN).write(A);A.mE=(var A){if((D as yN).mE!=null){(D as yN).mE(A);}};return A;}else if(D is kd){A.hB(D.QK,columns:D.FD,streamStatus:oB.CD);}else if(D is Stream){var B=new yN();A.mE=(var A){if(B.mE!=null){B.mE(A);}};Stream Q=D;if(O=="stream"){StreamSubscription I;B.mE=(EB){if(I!=null){I.cancel();}};I=Q.listen((C){if(C is md){B.meta=C.meta;return;}else if(C is ld){B.FD=C.FD.map((J)=>J.hU()).toList();return;}if(C is Iterable){B.update(C.toList(),oB.uN);}else if(C is Map){var P;if(C.containsKey("__META__")){P=C["__META__"];}B.update([C],oB.uN,P);}else{throw new Exception("Unknown Value from Stream");}},onDone:(){B.close();},onError:(G,K){var H=new X("invokeException",msg:G.toString());try {H.detail=K.toString();}catch (G){}A.close(H);},cancelOnError:true);B.write(A);return A;}else{var S=[] ;StreamSubscription I;B.mE=(EB){if(I!=null){I.cancel();}};I=Q.listen((C){if(C is md){B.meta=C.meta;return;}else if(C is ld){B.FD=C.FD.map((J)=>J.hU()).toList();return;}if(C is Iterable){S.addAll(C);}else if(C is Map){S.add(C);}else{throw new Exception("Unknown Value from Stream");}},onDone:(){B.update(S);B.close();},onError:(G,K){var H=new X("invokeException",msg:G.toString());try {H.detail=K.toString();}catch (G){}A.close(H);},cancelOnError:true);}B.write(A);return A;}else if(D is Future){var B=new yN();A.mE=(var A){if(B.mE!=null){B.mE(A);}};D.then((M){if(M is Sp){B=null;M.ZBB(A);}else if(M is Stream){Stream Q=M;StreamSubscription I;B.mE=(EB){if(I!=null){I.cancel();}};I=Q.listen((C){if(C is md){B.meta=C.meta;return;}else if(C is ld){B.FD=C.FD.map((J)=>J.hU()).toList();return;}if(C is Iterable){B.update(C.toList());}else if(C is Map){var P;if(C.containsKey("__META__")){P=C["__META__"];}B.update([C],oB.uN,P);}else{throw new Exception("Unknown Value from Stream");}},onDone:(){B.close();},onError:(G,K){var H=new X("invokeException",msg:G.toString());try {H.detail=K.toString();}catch (G){}A.close(H);},cancelOnError:true);}else if(M is kd){kd Z=M;B.FD=Z.FD.map((J)=>J.hU()).toList();B.update(Z.QK,oB.CD,Z.meta);B.close();}else{B.update(M is Iterable?M.toList():[M]);B.close();}}).catchError((G,K){var H=new X("invokeException",msg:G.toString());try {H.detail=K.toString();}catch (G){}A.close(H);});B.write(A);return A;}else if(D is Sp){D.ZBB(A);}else{A.close();}return A;}dynamic hAB(Map<String,dynamic> A){return null;}AC get parent=>provider.yB(new FB(path).gB);bool pAB(Object A)=>false;bool oAB(String A,String B)=>false;bool nAB(String A,String B)=>false;void rAB(){}void tAB(){}void Na(){}void gw(){}void fAB(String A,KB B){}void Vj(String A,KB B){}kK wF(MM A,[int B=0]){rAB();return super.wF(A,B);}void UJ(MM A){tAB();super.UJ(A);}AC jAB(String A,Map B,aG C){return null;}AC b_(String B,[Map A]){var C=new FB(path).Di(B).path;return provider.NZ(C,A==null?{}:A);}String get name=>new FB(path).name;String get type=>L[r"$type"];set type(String A){if(A==null){L.remove(r"$type");}else{L[r"$type"]=A;}SB(r"$type");}void remove(){provider.mR(path);}void iB(String A,KB B){super.iB(A,B);SB(A);}String Za(dynamic B){String A=super.Za(B);if(A!=null){SB(A);}return A;}q RN(String A,Object B,Y D,q C){if(nAB(A,B)!=true){super.RN(A,B,D,C);}return C;}q yL(String A,Object B,Y D,q C){if(oAB(A,B)!=true){super.yL(A,B,D,C);}return C;}q zB(Object A,Y C,q B,[int D=b.s]){if(pAB(A)!=true)super.zB(A,C,B,D);return B;}operator[](String A)=>get(A);operator[]=(String A,B){if(A.startsWith(r"$")||A.startsWith(r"@")){if(A.startsWith(r"$")){L[A]=B;}else{HB[A]=B;}}else{if(B==null){return Za(A);}else if(B is Map){return b_(A,B);}else{iB(A,B);return B;}}}}class qS extends AC{qS(String A,aG B):super(A,B){L[r'$hidden']=true;}Map<String,dynamic> TI(){var A=<String,dynamic>{r'$hidden':true};if(L.containsKey(r'$is')){A[r'$is']=L[r'$is'];}if(L.containsKey(r'$type')){A[r'$type']=L[r'$type'];}if(L.containsKey(r'$name')){A[r'$name']=L[r'$name'];}if(L.containsKey(r'$invokable')){A[r'$invokable']=L[r'$invokable'];}if(L.containsKey(r'$writable')){A[r'$writable']=L[r'$writable'];}return A;}}abstract class Ae{}ContentType v3=new ContentType("application","json",charset:"utf-8");void rS(HttpRequest B,[int G=HttpStatus.OK,ContentType D,bool H=false]){var A=B.response;if(G!=null){A.statusCode=G;}A.headers.set("Access-Control-Allow-Methods","POST, OPTIONS, GET");A.headers.set("Access-Control-Allow-Headers","Content-Type");String C=B.headers.value("origin");if(B.headers.value("x-proxy-origin")!=null){C=B.headers.value("x-proxy-origin");}if(C==null){C="*";}A.headers.set("Access-Control-Allow-Origin",C);if(!H){if(D==null){D=v3;}A.headers.contentType=D;}}void Ge(Object A){}class He implements pS{Map<String,nK> oR=new Map<String,nK>();Directory GD;Directory ZV;He(String A){GD=new Directory(A);if(!GD.existsSync()){GD.createSync(recursive:true);}ZV=new Directory("${A}/resp_subscription");if(!ZV.existsSync()){ZV.createSync(recursive:true);}}zN T$(String A){if(oR.containsKey(A)){return oR[A];}nK B=new nK("${ZV.path}/${Uri.encodeComponent(A)}",A);oR[A]=B;return B;}void destroy(){oR.forEach((String C,nK A){A.destroy();});oR.clear();values.forEach((String D,GO B){B.destroy();});values.clear();}Future<List<List<EG>>> LAB()async{List<Future<List<EG>>> B=[] ;for(FileSystemEntity A in ZV.listSync()){if(await FileSystemEntity.type(A.path)==FileSystemEntityType.DIRECTORY){String C=HX.IX(A.path.substring(A.path.lastIndexOf(Platform.pathSeparator)+1));nK D=new nK(A.path,C);oR[C]=D;B.add(D.load());}}return Future.wait(B);}Map<String,GO> values=new Map<String,GO>();RQ ji(String A){if(values.containsKey(A)){return values[A];}GO B=new GO(A,"${GD.path}/${Uri.encodeComponent(A)}");values[A]=B;return B;}}class nK extends zN{Map<String,FO> values=new Map<String,FO>();Directory GD;String QN;nK(String A,[this.QN]){if(QN==null){QN=HX.IX(A.substring(A.lastIndexOf(Platform.pathSeparator)+1));}GD=new Directory(A);if(!GD.existsSync()){GD.createSync(recursive:true);}}EG hv(String A){if(values.containsKey(A)){return values[A];}FO B=new FO(A,Uri.encodeComponent(A),GD.path,this);values[A]=B;return B;}Future<List<EG>> load()async{List<Future<EG>> B=[] ;for(FileSystemEntity C in GD.listSync()){String D=C.path.substring(C.path.lastIndexOf(Platform.pathSeparator)+1);String A=HX.IX(D);values[A]=new FO(A,D,GD.path,this);B.add(values[A].load());}return Future.wait(B);}void Ti(String A){if(values.containsKey(A)){values[A].destroy();values.remove(A);}}void destroy(){values.forEach((String B,FO A){A.destroy();});values.clear();}}class FO extends EG{File file;String MJ;FO(String A,this.MJ,String B,nK C):super(A,C){file=new File("${B}/${MJ}");}void vM(GB A){NV=3;A.YV="${PC.FH(A.Xk())}\n";file.openSync(mode:FileMode.APPEND)..writeStringSync(A.YV)..closeSync();}void zB(Iterable<GB> B,GB A){NV=2;A.YV=" ${PC.FH(A.Xk())}\n";file.writeAsStringSync(A.YV);}void yj(GB A){}void zx(Iterable<GB> A){file.writeAsStringSync(A.map((B)=>B.YV).join());}void destroy(){file.delete().catchError(Ge);}List<GB> oKB;Future<EG> load()async{String B=file.readAsStringSync();List<String> C=B.split("\n");if(C.length==1&&B.startsWith(" ")){NV=2;}else{NV=3;}List<GB> D=new List<GB>();for(String G in C){if(G.length<18){continue;}try {Map A=PC.CF(G);GB H=new GB(A["value"],ts:A["ts"],meta:A);D.add(H);}catch (I){}}oKB=D;return this;}List<GB> ev(){return oKB;}}class GO implements RQ{String category;Directory GD;GO(this.category,String A){GD=new Directory(A);if(!GD.existsSync()){GD.createSync(recursive:true);}}SQ YR(String A){return new ep(this,A);}void destroy(){GD.delete(recursive:true).catchError(Ge);}Future<Map> load()async{Map B={};for(FileSystemEntity A in GD.listSync()){String C=HX.IX(A.path.substring(A.path.lastIndexOf(Platform.pathSeparator)+1));File D=new File(A.path);String G=D.readAsStringSync();try {B[C]=PC.CF(G);}catch (H){wB.eC(H);}}return B;}}class ep extends SQ{String key;GO bu;File pKB;ep(this.bu,this.key){pKB=new File("${bu.GD.path}/${Uri.encodeComponent(key)}");}bool qKB=false;Object rKB;Object sKB;void zB(Object A){rKB=A;if(qKB){return;}sKB=A;qKB=true;pKB.writeAsString(PC.FH(A)).then(iw).catchError(iw);}void iw(Object A){qKB=false;if(sKB!=rKB){zB(rKB);}}void destroy(){rKB=null;sKB=null;pKB.delete().catchError(Ge);}pv()async{if(rKB!=null){return rKB;}try {return PC.CF(await pKB.readAsString());}catch (A){}return null;}}class bG{static const int gp=61;static const int H4=13;static const int Je=10;static const int Ke=32;static const int I4=43;static const int J4=47;static const String jJ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";static final List<int> Me=((){List<int> A=new List<int>(256);A.fillRange(0,256,-2);List<int> C=jJ.codeUnits;int D=C.length;for(int B=0;B<D; ++B){A[C[B]]=B;}A[I4]=62;A[J4]=63;A[H4]=-1;A[Je]=-1;A[Ke]=-1;A[Je]=-1;A[gp]=0;return A;})();static String UM(List<int> G,[int Q=0,int I=0]){int J=G.length;if(J==0){return "";}final int K=J.remainder(3);final int S=J-K;int H=((J~/3)*4)+((K>0)?4:0)+I;int M=Q>>2;if(M>0){H+= ((H-1)~/(M<<2))*(1+I);}List<int> A=new List<int>(H);int B=0,C=0,O=0;for(int C=0;C<I; ++C){A[B++ ]=Ke;}while(C<S){int D=(((G[C++ ]%256)<<16)&0xFFFFFF)|(((G[C++ ]%256)<<8)&0xFFFFFF)|(G[C++ ]%256);A[B++ ]=jJ.codeUnitAt(D>>18);A[B++ ]=jJ.codeUnitAt((D>>12)&0x3F);A[B++ ]=jJ.codeUnitAt((D>>6)&0x3F);A[B++ ]=jJ.codeUnitAt(D&0x3f);if(M>0&& ++O==M&&B<H-2){A[B++ ]=Je;for(int C=0;C<I; ++C){A[B++ ]=Ke;}O=0;}}if(K==1){int D=G[C]%256;A[B++ ]=jJ.codeUnitAt(D>>2);A[B++ ]=jJ.codeUnitAt((D<<4)&0x3F);return new String.fromCharCodes(A.sublist(0,H-2));}else if(K==2){int D=G[C]%256;int P=G[C+1]%256;A[B++ ]=jJ.codeUnitAt(D>>2);A[B++ ]=jJ.codeUnitAt(((D<<4)|(P>>4))&0x3F);A[B++ ]=jJ.codeUnitAt((P<<2)&0x3F);return new String.fromCharCodes(A.sublist(0,H-1));}return new String.fromCharCodes(A);}static Uint8List VQ(String A){if(A==null){return null;}int C=A.length;if(C==0){return new Uint8List(0);}int K=0;for(int B=0;B<C;B++ ){int G=Me[A.codeUnitAt(B)];if(G<0){K++ ;if(G==-2){return null;}}}int M=(C-K)%4;if(M==2){A='${A}==';C+= 2;}else if(M==3){A='${A}=';C+= 1;}else if(M==1){return null;}int O=0;for(int B=C-1;B>=0;B-- ){int P=A.codeUnitAt(B);if(Me[P]>0)break;if(P==gp)O++ ;}int I=(((C-K)*6)>>3)-O;Uint8List J=new Uint8List(I);for(int B=0,D=0;D<I;){int H=0;for(int Q=4;Q>0;){int G=Me[A.codeUnitAt(B++ )];if(G>=0){H=((H<<6)&0xFFFFFF)|G;Q-- ;}}J[D++ ]=H>>16;if(D<I){J[D++ ]=(H>>8)&0xFF;if(D<I)J[D++ ]=H&0xFF;}}return J;}}typedef Object D4(Object _0);typedef Object E4(String _0,Object _1);abstract class nI{static final Map<String,nI> K4={"json":PC.LX,"msgpack":Qe.R4};static final nI hp=PC.LX;static nI jp(String B){nI A=K4[B];if(A==null){return hp;}return A;}Object tKB;Object get M_{if(tKB==null){tKB=lZ({});}return tKB;}Object lZ(Map A);Map fZ(String A);Map Ri(List<int> A);}abstract class PC{static lp LX=new lp();static String FH(Object A,{bool pretty: false}){return LX.w_(A,pretty:pretty);}static dynamic CF(String A){return LX.j_(A);}}class lp extends nI implements PC{static dynamic mp(A){return null;}JsonEncoder encoder=new JsonEncoder(mp);JsonDecoder decoder=new JsonDecoder();JsonEncoder uKB;dynamic j_(String A){return decoder.convert(A);}String w_(B,{bool pretty: false}){JsonEncoder A=encoder;if(pretty){if(uKB==null){uKB=encoder=new JsonEncoder.withIndent("  ",mp);}A=uKB;}return A.convert(B);}JsonDecoder vKB;Map Ri(List<int> A){return fZ(const Utf8Decoder().convert(A));}Map fZ(String B){if(wKB==null){wKB=(D,A){if(A is String&&A.startsWith("\u001Bbytes:")){try {return GX.M4(bG.VQ(A.substring(7)));}catch (G){return null;}}return A;};}if(vKB==null){vKB=new JsonDecoder(wKB);}var C=vKB.convert(B);return C;}E4 wKB;D4 xKB;Object lZ(Object C){if(xKB==null){xKB=(A){if(A is ByteData){return "\u001Bbytes:${bG.UM(GX.N4(A))}";}return null;};}JsonEncoder B;if(yKB==null){yKB=new JsonEncoder(xKB);}B=yKB;var D=B.convert(C);return D;}JsonEncoder yKB;}class Qe extends nI{static Qe R4=new Qe();Map Ri(List<int> C){Uint8List A=GX.fp(C);if(zKB==null){zKB=new ve(A.buffer,A.offsetInBytes);}else{zKB.reset(A.buffer);zKB.offset=A.offsetInBytes;}Object B=zKB.wa();if(B is Map){return B;}zKB.data=null;return {};}ve zKB;Map fZ(String A){return {};}Object lZ(Map A){return z4(A);}}class vS{Map ALB;Map get w$=>ALB;String name;String version;String description;String JN;Map<String,dynamic> IF={};Map<String,Map<String,dynamic>> L={};List<String> iU=[] ;vS();factory vS.zCB(Map<String,dynamic> B){var A=new vS();A.ALB=B;A.name=B["name"];A.version=B["version"];A.description=B["description"];A.JN=B["main"];A.IF=B["engines"] as Map<String,dynamic>;A.L=B["configs"] as Map<String,Map<String,dynamic>>;A.iU=B["getDependencies"] as List<String>;return A;}void Ay(){if(name==null){throw new Exception("DSLink Name is required.");}if(JN==null){throw new Exception("DSLink Main Script is required.");}}Map rE(){Ay();var A=new Map<String,dynamic>.from(ALB!=null?ALB:{});A["name"]=name;A["version"]=version;A["description"]=description;A["main"]=JN;A["engines"]=IF;A["configs"]=L;A["getDependencies"]=iU;for(var B in A.keys.toList()){if(A[B]==null){A.remove(B);}}return A;}}class GX{static Uint8List fp(List<int> A){if(A is Uint8List){return A;}return new Uint8List.fromList(A);}static ByteData M4(Uint8List A){return A.buffer.asByteData(A.offsetInBytes,A.lengthInBytes);}static Uint8List N4(ByteData A){return A.buffer.asUint8List(A.offsetInBytes,A.lengthInBytes);}}class mI<BB> implements StreamController<BB>{StreamController<BB> BLB;Pe<BB> CLB;Stream<BB> get stream=>CLB;Function DLB;Function ELB;mI([void A(),void B(),void C(callback(BB value)),bool D=false]){BLB=new StreamController<BB>(sync:D);CLB=new Pe(BLB.stream.asBroadcastStream(onListen:FLB,onCancel:GLB),C);DLB=A;ELB=B;}bool HLB=false;bool ILB=false;void FLB(StreamSubscription<BB> A){if(!ILB){if(DLB!=null){DLB();}ILB=true;}HLB=true;}void GLB(StreamSubscription<BB> A){HLB=false;if(ELB!=null){if(!JLB){JLB=true;FC.TM(k_);}}else{ILB=false;}}bool JLB=false;void k_(){JLB=false;if(!HLB&&ILB){ELB();ILB=false;}}void add(BB A){BLB.add(A);CLB.aD=A;}void addError(Object A,[StackTrace B]){BLB.addError(A,B);}Future addStream(Stream<BB> A,{bool cancelOnError: true}){return BLB.addStream(A,cancelOnError:cancelOnError);}Future close(){return BLB.close();}Future get done=>BLB.done;bool get hasListener=>BLB.hasListener;bool get isClosed=>BLB.isClosed;bool get isPaused=>BLB.isPaused;StreamSink<BB> get sink=>BLB.sink;void set onCancel(A()){throw ('BroadcastStreamController.onCancel not implemented');}void set onListen(void A()){throw ('BroadcastStreamController.onListen not implemented');}void set onPause(void A()){throw ('BroadcastStreamController.onPause not implemented');}void set onResume(void A()){throw ('BroadcastStreamController.onResume not implemented');}ControllerCancelCallback get onCancel=>null;ControllerCallback get onListen=>null;ControllerCallback get onPause=>null;ControllerCallback get onResume=>null;}class Pe<BB> extends Stream<BB>{BB aD;final Stream<BB> CLB;final Function FLB;Pe(this.CLB,this.FLB);Stream<BB> asBroadcastStream({void onListen(StreamSubscription<BB> subscription),void onCancel(StreamSubscription<BB> subscription)}){return this;}bool get isBroadcast=>true;StreamSubscription<BB> listen(void A(BB event),{Function onError,void onDone(),bool cancelOnError}){if(FLB!=null){FLB(A);}return CLB.listen(A,onError:onError,onDone:onDone,cancelOnError:cancelOnError);}}class UE extends LinkedListEntry<UE>{final int TN;List<Function> KLB=new List<Function>();UE(this.TN);void add(Function A){if(!KLB.contains(A)){KLB.add(A);}}void remove(Function A){KLB.remove(A);}}class FC{static List<Function> Le=[] ;static void Ne(){Timer.run(qp);AT=true;}static void TM(Function A){if(!AT){Ne();}Le.add(A);}static LinkedList<UE> kJ=new LinkedList<UE>();static Map<int,UE> Oe=new Map<int,UE>();static Map<Function,UE> VM=new Map<Function,UE>();static UE np(int C){UE B=Oe[C];if(B!=null){return B;}B=new UE(C);Oe[C]=B;UE A;if(kJ.isNotEmpty){A=kJ.first;}while(A!=null){if(A.TN>C){A.insertBefore(B);break;}else if(A.next!=kJ){A=A.next;}else{A=null;}}if(A==null){kJ.add(B);}if(!AT){Ne();}return B;}static UE Q4(int C){if(kJ.isNotEmpty&&kJ.first.TN<=C){UE A=kJ.first;Oe.remove(A.TN);A.unlink();for(Function B in A.KLB){VM.remove(B);B();}return A;}return null;}static int MX=-1;static void ID(Function A,int G){int B=(((new DateTime.now()).millisecondsSinceEpoch+G)/50).ceil();if(VM.containsKey(A)){UE C=VM[A];if(C.TN<=B){return;}else{C.remove(A);}}if(B<=MX){TM(A);return;}UE D=np(B);D.add(A);VM[A]=D;}static void NX(Function A,int G){int B=(((new DateTime.now()).millisecondsSinceEpoch+G)/50).ceil();if(VM.containsKey(A)){UE C=VM[A];if(C.TN>=B){return;}else{C.remove(A);}}if(B<=MX){TM(A);return;}UE D=np(B);D.add(A);VM[A]=D;}static void S4(Function A){UE B=VM[A];if(B!=null){B.remove(A);}}static bool AT=false;static bool op=false;static bool pp=false;static void qp(){AT=false;op=true;List<Function> B=Le;Le=new List();for(var C in B){C();}int A=(new DateTime.now()).millisecondsSinceEpoch;MX=(A/50).floor();while(Q4(MX)!=null){}op=false;if(pp){pp=false;qp();}if(kJ.isNotEmpty){if(!AT){if(Se!=kJ.first.TN){Se=kJ.first.TN;if(WM!=null&&WM.isActive){WM.cancel();}var D=new Duration(milliseconds:Se*50+1-A);WM=new Timer(D,Ne);}}}else if(WM!=null){if(WM.isActive){WM.cancel();}WM=null;}}static int Se=-1;static Timer WM;}class HX{static const int F4=0x20;static const int Ie=0x25;static const int G4=0x2B;static String IX(String D){List<int> C=new List<int>();List<int> A=new List<int>();int I=D.length;for(int B=0;B<I;B++ ){var G=D.codeUnitAt(B);if(G==Ie){if(B+3>D.length){A.add(Ie);continue;}int H=P4(D,B+1);if(H>0){A.add(H);B+= 2;}else{A.add(Ie);}}else{if(!A.isEmpty){C.addAll(const Utf8Decoder(allowMalformed:true).convert(A).codeUnits);A.clear();}if(G==G4){C.add(F4);}else{C.add(G);}}}if(!A.isEmpty){C.addAll(const Utf8Decoder().convert(A).codeUnits);A.clear();}return new String.fromCharCodes(C);}static int P4(String D,int G){int B=0;for(int C=0;C<2;C++ ){int A=D.codeUnitAt(G+C);if(0x30<=A&&A<=0x39){B=B*16+A-0x30;}else if((A>=0x41&&A<=0x46)||(A>=0x61&&A<=0x66)){A|= 0x20;B=B*16+A-0x57;}else{return -1;}}return B;}}typedef dynamic JX();typedef dynamic HO<BB>(BB _0);typedef dynamic L4<X7,Gg>(X7 _0,Gg _1);const String KX="1.1.2";WD wS;bool xS;List<int> ip(List<int> A,List<int> B){return A..addAll(B);}int kp(String A,String B){var C=B.codeUnitAt(0);return A.codeUnits.where((D)=>C==D).length;}bool get O4{if(xS!=null){return xS;}try {assert(false);xS=false;}catch (A){xS=true;}return xS;}bool yS(rK B,String A,[bool D=false]){try {bool C=new bool.fromEnvironment(A,defaultValue:null);if(C!=null){return C;}}catch (G){}if(B.zone[A] is bool){return B.zone[A];}return D;}WD get wB{if(wS!=null){return wS;}LO=true;wS=new WD("DSA");wS.Qa.listen((A){List<String> D=A.message.split("\n");bool G=yS(A,"dsa.logger.inline_errors",true);bool H=yS(A,"dsa.logger.sequence",false);if(G){if(A.error!=null){D.addAll(A.error.toString().split("\n"));}if(A.stackTrace!=null){D.addAll(A.stackTrace.toString().split("\n").where((I)=>I.isNotEmpty).toList());}}String C=A.Hj;if(A.zone["dsa.logger.name"] is String){C=A.zone["dsa.logger.name"];}bool J=yS(A,"dsa.logger.show_timestamps",false);if(!yS(A,"dsa.logger.show_name",true)){C=null;}for(String K in D){String B="";if(H){B+= "[${A.Mx}]";}if(J){B+= "[${A.cx}]";}B+= "[${A.level.name}]";if(C!=null){B+= "[${C}]";}B+= " ";B+= K;if(yS(A,"dsa.logger.print",true)){print(B);}}if(!G){if(A.error!=null){print(A.error);}if(A.stackTrace!=null){print(A.stackTrace);}}});zS(const String.fromEnvironment("dsa.logger.default_level",defaultValue:"INFO"));return wS;}void zS(String A){A=A.trim().toUpperCase();if(A=="DEBUG"){A="ALL";}Map<String,RB> C={};for(var B in RB.ge){C[B.name]=B;}var B=C[A];if(B!=null){wB.level=B;}}class WQ{static final WQ T4=new WQ.ADB(250);final Duration duration;const WQ(this.duration);WQ.ADB(int A):this(new Duration(milliseconds:A));}abstract class Re{void xu();}class rp extends Re{final JX function;rp(this.function);void xu(){if(function!=null){function();}}}class U4{static Re V4(A,H()){Duration B;if(A is Duration){B=A;}else if(A is int){B=new Duration(milliseconds:A);}else if(A is WQ){B=A.duration;}else{throw new Exception("Invalid Interval: ${A}");}JX C;Timer D;bool G=false;C=()async{await H();if(!G){new Timer(B,C);}};D=new Timer(B,C);return new rp((){if(D!=null){D.cancel();}G=true;});}}String OX(Iterable<String> A)=>"enum[${A.join(",")}]";String W4({int length: 30}){var H=new Random();var C=new StringBuffer();for(int D=1;D<=length;D++ ){var A=new Random(H.nextInt(0x70000000)+(new DateTime.now()).millisecondsSinceEpoch);var B=A.nextInt(50);if(B>=0&&B<=32){String G=PX[A.nextInt(PX.length)];C.write(A.nextBool()?G.toLowerCase():G);}else if(B>32&&B<=43){C.write(QX[A.nextInt(QX.length)]);}else if(B>43){C.write(sp[A.nextInt(sp.length)]);}}return C.toString();}String X4({int length: 50}){var G=new Random();var B=new StringBuffer();for(int C=1;C<=length;C++ ){var A=new Random(G.nextInt(0x70000000)+(new DateTime.now()).millisecondsSinceEpoch);if(A.nextBool()){String D=PX[A.nextInt(PX.length)];B.write(A.nextBool()?D.toLowerCase():D);}else{B.write(QX[A.nextInt(QX.length)]);}}return B.toString();}const List<String> PX=const["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];const List<int> QX=const[0,1,2,3,4,5,6,7,8,9];const List<String> sp=const["@","=","_","+","-","!","."];Uint8List Te(String B){int C=B.length;Uint8List D=new Uint8List(C);for(int A=0;A<C;A++ ){int G=B.codeUnitAt(A);if(G>=128){return new Uint8List.fromList(const Utf8Encoder().convert(B));}D[A]=G;}return D;}typedef void BT(XM _0);mC Ue(BT C,{Map<String,dynamic> metadata}){var A=new ReceivePort();var B=new mC.BDB(A);Isolate.spawn(C,new XM(A.sendPort,metadata)).then((D){B.LLB=D;});return B;}mC tp(BT D,{Map<String,dynamic> metadata}){var A=new ReceivePort();var B=new mC.BDB(A);Timer.run((){var C=new XM(A.sendPort,metadata);C.MLB=B;D(C);});return B;}mC Y4(A,{List<String> args,Map<String,dynamic> metadata}){var C=new ReceivePort();var D=new mC.BDB(C);Uri B;if(A is Uri){B=A;}else if(A is String){B=Uri.parse(A);}else{throw new ArgumentError.value(A,"script","should be either a Uri or a String.");}Isolate.spawnUri(B,[] ,{"port":C.sendPort,"metadata":metadata}).then((G){D.LLB=G;});return D;}oK Z4(int C,BT D,{Map<String,dynamic> metadata}){var B=<mC>[] ;for(var A=1;A<=C;A++ ){B.add(Ue(D,metadata:{"workerId":A}..addAll(metadata==null?{}:metadata)));}return new oK(B);}class oK{final List<mC> tE;Map<String,HO> NLB={};oK(this.tE){UBB();}Function GV;Future Kb(){return Future.wait(tE.map((A)=>A.Kb()).toList());}Future stop(){return Future.wait(tE.map((A)=>A.stop()).toList());}HBB(int A)async{if(tE.length>A){var C=tE.length-A;List<mC> D=tE.skip(A).take(C).toList();for(var B in D){await B.close();B.kill();tE.remove(B);}}}TBB(int C,BT D,{Map<String,dynamic> metadata})async{if(tE.length<C){for(var A=tE.length+1;A<=C;A++ ){var B=Ue(D,metadata:{"workerId":A}..addAll(metadata==null?{}:metadata));B.OLB=this;B.HV=(G){if(GV!=null){GV(A,G);}};await B.init();tE.add(B);}}else{await HBB(C);}}void send(dynamic A){forEach((B)=>B.send(A));}void listen(void B(int worker,event)){var A=0;for(var C in tE){var D=A;C.listen((G){B(D,G);});A++ ;}}Future<oK> init()=>Future.wait(tE.map((A)=>A.init()).toList()).then((B)=>this);void forEach(void A(mC socket)){tE.forEach(A);}void LB(String A,HO B){NLB[A]=B;}Future<List<dynamic>> j(String A,[B]){return Future.wait(tE.map((C)=>C.j(A,B)).toList());}Future<pK> createSession([dynamic A]){return N$().createSession(A);}StreamController<pK> PLB=new StreamController<pK>.broadcast();bool QLB=false;int O$(){var B=RLB.keys.toList();B.sort((C,D)=>RLB[C].compareTo(RLB[D]));var A=B.first;RLB[A]=RLB[A]+1;return A;}mC N$(){return By(O$());}void UBB(){for(var A=0;A<tE.length;A++ ){RLB[A]=0;tE[A].OLB=this;tE[A].HV=(B){if(GV!=null){GV(A,B);}};}}Map<int,int> RLB={};mC By(int A)=>tE[A];mC operator[](int A)=>By(A);}class XM{final SendPort port;final Map<String,dynamic> IB;XM(this.port,[Map<String,dynamic> A]):IB=A==null?{}:A;mC nu(){var A=new mC.CDB(port);if(MLB!=null){A.MLB=MLB;MLB.SLB=A;}return A;}Future<mC> init({Map<String,HO> methods})async=>await nu().init(methods:methods);dynamic get(String A)=>IB[A];bool b$(String A)=>IB.containsKey(A);mC MLB;}class mC extends Stream implements StreamSink{final ReceivePort PN;SendPort TLB;mC.BDB(this.PN):rU=false{PN.listen(sv);}mC.CDB(SendPort A):TLB=A,PN=new ReceivePort(),rU=true{TLB.send({"t":"send_port","port":PN.sendPort});PN.listen(sv);}Function HV;oK OLB;sv(B){if(HV!=null){HV(B);}if(B==null||B is!Map){return;}String C=B["t"];if(C==null){C=B["type"];}if(C==null){return;}if(C=="send_port"){TLB=B["port"];if(!ULB.isCompleted){ULB.complete();}}else if(C=="data"){VLB.add(B["d"]);}else if(C=="error"){VLB.addError(B["e"]);}else if(C=="ping"){TLB.send({"t":"pong","i":B["i"]});}else if(C=="pong"){var A=B["i"];if(WLB.containsKey(A)){WLB[A].complete();WLB.remove(A);}}else if(C=="req"){XLB(B["n"],B["i"],B["a"]);}else if(C=="res"){var A=B["i"];var H=B["r"];var G=B["e"];if(G!=null){if(YLB.containsKey(A)){YLB.remove(A).completeError(G,new StackTrace.fromString(B["s"]));}else{throw new Exception("Invalid Request ID: ${A}");}}else{if(YLB.containsKey(A)){YLB.remove(A).complete(H);}else{throw new Exception("Invalid Request ID: ${A}");}}}else if(C=="stop"){if(!ZLB.isCompleted){ZLB.complete();}TLB.send({"t":"stopped"});}else if(C=="stopped"){if(!ZLB.isCompleted){ZLB.complete();}}else if(C=="session.created"){var A=B["s"];aLB[A]=new IO(this,A,false,B["n"]);TLB.send({"t":"session.ready","s":A});PLB.add(aLB[A]);}else if(C=="session.ready"){var A=B["s"];if(bLB.containsKey(A)){bLB[A].complete();bLB.remove(A);}}else if(C=="session.data"){var A=B["s"];if(cLB.containsKey(A)){(cLB[A] as IO).dLB.add(B["d"]);}else if(aLB.containsKey(A)){(aLB[A] as IO).dLB.add(B["d"]);}}else if(C=="session.done"){var A=B["s"];if(cLB.containsKey(A)){var D=(cLB[A] as IO).eLB;if(!D.isCompleted){D.complete();}cLB.remove(A);}else if(aLB.containsKey(A)){var D=(aLB[A] as IO).eLB;if(!D.isCompleted){D.complete();}aLB.remove(A);}}else{throw new Exception("Unknown message: ${B}");}}Map<int,Completer> WLB={};final bool rU;bool get s$=>!rU;Future Kb(){if(rU){return new Future.value();}else{return ULB.future;}}Future<mC> init({Map<String,HO> methods}){if(methods!=null){for(var A in methods.keys){LB(A,methods[A]);}}return Kb().then((B)=>this);}void LB(String A,HO B){fLB[A]=B;}mC MLB;mC SLB;Future j(String C,[G]){if(rU&&MLB!=null){var A=MLB.fLB[C];if(A==null){A=MLB.OLB.NLB[C];}var B=A(G);if(B is!Future){return new Future.value(B);}else{return B;}}else if(SLB!=null){var A=SLB.fLB[C];if(A==null){A=SLB.OLB.NLB[C];}var B=A(G);if(B is!Future){return new Future.value(B);}else{return B;}}var H=new Completer();var D=0;while(YLB[D]!=null){D++ ;}YLB[D]=H;if(G==null){TLB.send({"t":"req","i":D,"n":C});}else{TLB.send({"t":"req","i":D,"n":C,"a":G});}return H.future;}XLB(String A,int C,H)async{try {if((OLB!=null&&OLB.NLB.containsKey(A))||fLB.containsKey(A)){var I=(OLB!=null&&OLB.NLB.containsKey(A))?OLB.NLB[A]:fLB[A];var B=I(H);if(B is Future){B=await B;}if(B==null){TLB.send({"t":"res","i":C});}else{TLB.send({"t":"res","i":C,"r":B});}}else{throw new Exception("Invalid Method: ${A}");}}catch (D,G){TLB.send({"t":"res","i":C,"e":D!=null?D.toString():null,"s":G!=null?G.toString():null});}}Map<int,Completer> YLB={};Map<String,HO> fLB={};Completer ULB=new Completer();int gLB=0;void add(A){TLB.send({"t":"data","d":A});}void send(A)=>add(A);void addError(A,[StackTrace B]){TLB.send({"t":"error","e":A});}Future addStream(Stream A){return A.listen((B){add(B);}).asFuture();}Future stop()=>close();Future close(){TLB.send({"t":"stop"});return ZLB.future.then((A){if(s$){PN.close();}else{return new Future.delayed(new Duration(seconds:1),(){PN.close();});}});}Future<pK> createSession([B])async{var A=W4(length:25);var C=new IO(this,A,true,B);TLB.send({"t":"session.created","s":A,"n":B});await ((bLB[A]=new Completer.sync()).future);cLB[A]=C;return C;}Map<String,Completer> bLB={};Map<String,pK> cLB={};Map<String,pK> aLB={};StreamController<pK> PLB=new StreamController<pK>.broadcast();Future get done=>ZLB.future;Completer ZLB=new Completer();StreamSubscription listen(void A(event),{Function onError,void onDone(),bool cancelOnError}){return VLB.stream.listen(A,onError:onError,onDone:onDone,cancelOnError:cancelOnError);}bool kill(){PN.close();if(LLB!=null){LLB.kill();return true;}else{return false;}}Isolate LLB;StreamController VLB=new StreamController.broadcast();}abstract class pK{String get id;void send(A);Future close();Future get done;bool get isClosed;Stream get hL;}class IO extends pK{final bool g_;final String id;final mC hLB;Completer eLB=new Completer.sync();StreamController dLB=new StreamController();Stream iLB;IO(this.hLB,this.id,this.g_,this.jLB);Future close(){hLB.TLB.send({"t":"session.done","s":id});new Future((){if(!eLB.isCompleted){eLB.complete();}hLB.aLB.remove(id);hLB.cLB.remove(id);dLB.close();});return done;}Future get done=>eLB.future;Stream get hL{if(iLB==null){iLB=dLB.stream.asBroadcastStream();}return iLB;}void send(A){hLB.TLB.send({"t":"session.data","s":id,"d":A});}bool get isClosed=>eLB.isCompleted;dynamic jLB;}String RX(String B,String C){vP A=new vP(new ZJ(),UTF8.encode(B));A.add(UTF8.encode(C));return VG.iz(A.close());}String up(String B,String C,String D,int G){num H=(new DateTime.now().millisecondsSinceEpoch/1000).round()+G;String I="${C}|${H}";String J=VG.gN(UTF8.encode(I));String A="${D}|${J}";return "${A}|${RX(B,A)}";}String vp(String C,String H,String I,String J){num K=(new DateTime.now().millisecondsSinceEpoch/1000).round();List<String> A=H.split("|");if(A.length!=3){return null;}String D=A[0];String G=A[1];String M=A[2];String O=RX(C,"${D}|${G}");if(RX(C,O)!=RX(C,M))return null;if(D!=I)return null;List<String> B=UTF8.decode(VG.wP(G)).split("|");if(B.length!=3)return null;String P=B[0];String Q=B[1];String S=B[2];if(Q!=J)return null;if(K>=int.parse(S))return null;return P;}String a4(String B,String C,String D,String G){String A="${G}|${B}";var H=up(C,A,"TX",300);var I=up(D,A,"APP",3600);return "${H}:${I}";}String b4(String B,String D,String G,String H){List<String> A=H.split(":");if(A.length!=2)return null;String I=A[0];String J=A[1];String C=vp(D,I,"AUTH",B);String K=vp(G,J,"APP",B);if(C!=K)return null;return C;}final Or=new RegExp(r"\r\n?|\n");class Uf extends cQ{int get HD=>kLB;int kLB=0;int get RC=>lLB;int lLB=0;fM get state=>new Pr(this,position,HD,RC);bool get mLB=>mB(-1)==nl&&mB()==Zb;set position(int A){var C=position;super.position=A;if(A>C){var B=nLB(string.substring(C,A));kLB+= B.length;if(B.isEmpty){lLB+= A-C;}else{lLB=A-B.last.end;}}else{var B=nLB(string.substring(A,C));if(mLB)B.removeLast();kLB-= B.length;if(B.isEmpty){lLB-= C-A;}else{lLB=A-string.lastIndexOf(Or,A)-1;}}}Uf(String A,{sourceUrl,int position}):super(A,sourceUrl:sourceUrl,position:position);int cB(){var A=super.cB();oLB(A);return A;}void oLB(int A){if(A==Zb||(A==nl&&mB()!=Zb)){kLB+= 1;lLB=0;}else{lLB+= 1;}}bool GC(Pattern B){if(!super.GC(B))return false;var A=nLB(FN[0]);kLB+= A.length;if(A.isEmpty){lLB+= FN[0].length;}else{lLB=FN[0].length-A.last.end;}return true;}List<Match> nLB(String B){var A=Or.allMatches(B).toList();if(mLB)A.removeLast();return A;}}class Pr implements fM{final Uf pLB;final int position;final int HD;final int RC;Pr(this.pLB,this.position,this.HD,this.RC);}const int dN=0x7fffffff;abstract class DM<XB>{}class FW<XB> implements DM<XB>{const FW();bool JF(XB A,XB B)=>A==B;int hash(XB A)=>A.hashCode;bool Da(Object A)=>true;}class CS<XB> implements DM<Iterable<XB>>{final DM<XB> qLB;const CS([DM<XB> A=const FW()]):qLB=A;bool JF(Iterable<XB> A,Iterable<XB> B){if(identical(A,B))return true;if(A==null||B==null)return false;var C=A.iterator;var D=B.iterator;while(true){bool G=C.moveNext();if(G!=D.moveNext())return false;if(!G)return true;if(!qLB.JF(C.current,D.current))return false;}}int hash(Iterable<XB> B){int A=0;for(XB C in B){int D=qLB.hash(C);A=(A+D)&dN;A=(A+(A<<10))&dN;A^= (A>>6);}A=(A+(A<<3))&dN;A^= (A>>11);A=(A+(A<<15))&dN;return A;}bool Da(Object A)=>A is Iterable<XB>;}abstract class mb<XB,BB extends Iterable<XB>> implements DM<BB>{final DM<XB> qLB;const mb(this.qLB);bool JF(BB D,BB G){if(identical(D,G))return true;if(D==null||G==null)return false;HashMap<XB,int> C=new HashMap(equals:qLB.JF,hashCode:qLB.hash,isValidKey:qLB.Da);int H=0;for(var B in D){int A=C[B];if(A==null)A=0;C[B]=A+1;H++ ;}for(var B in G){int A=C[B];if(A==null||A==0)return false;C[B]=A-1;H-- ;}return H==0;}int hash(BB B){int A=0;for(XB C in B){int D=qLB.hash(C);A=(A+D)&dN;}A=(A+(A<<3))&dN;A^= (A>>11);A=(A+(A<<15))&dN;return A;}}class GW<XB> extends mb<XB,Iterable<XB>>{const GW([DM<XB> A=const FW()]):super(A);bool Da(Object A)=>A is Iterable<XB>;}class nb<XB> extends mb<XB,Set<XB>>{const nb([DM<XB> A=const FW()]):super(A);bool Da(Object A)=>A is Set<XB>;}class jX extends Sf{String get source=>super.source;Uri get JC=>c.JC;jX(String A,qD B,String C):super(A,B,C);}const int Qf=10;const int k5=13;class PO{final Uri qG;final rLB=<int>[0];final Uint32List sLB;int get length=>sLB.length;int get cR=>rLB.length;int tLB;PO(String A,{url}):this.RDB(A.runes,url:url);PO.RDB(Iterable<int> D,{url}):qG=url is String?Uri.parse(url):url,sLB=new Uint32List.fromList(D.toList()){for(var A=0;A<sLB.length;A++ ){var B=sLB[A];if(B==k5){var C=A+1;if(C>=sLB.length||sLB[C]!=Qf)B=Qf;}if(B==Qf)rLB.add(A+1);}}DD c(int B,[int A]){if(A==null)A=length-1;return new xK(this,B,A);}dM location(int A)=>new dM.SDB(this,A);int uZ(int A){if(A<0){throw new RangeError("Offset may not be negative, was ${A}.");}else if(A>length){throw new RangeError("Offset ${A} must not be greater than the number " "of characters in the file, ${length}.");}if(A<rLB.first)return -1;if(A>=rLB.last)return rLB.length-1;if(uLB(A))return tLB;tLB=vLB(A)-1;return tLB;}bool uLB(int A){if(tLB==null)return false;if(A<rLB[tLB])return false;if(tLB>=rLB.length-1||A<rLB[tLB+1]){return true;}if(tLB>=rLB.length-2||A<rLB[tLB+2]){tLB++ ;return true;}return false;}int vLB(int D){int A=0;int B=rLB.length-1;while(A<B){var C=A+((B-A)~/2);if(rLB[C]>D){B=C;}else{A=C+1;}}return B;}int hi(int A,{int line}){if(A<0){throw new RangeError("Offset may not be negative, was ${A}.");}else if(A>length){throw new RangeError("Offset ${A} must be not be greater than the " "number of characters in the file, ${length}.");}if(line==null){line=uZ(A);}else if(line<0){throw new RangeError("Line may not be negative, was ${line}.");}else if(line>=cR){throw new RangeError("Line ${line} must be less than the number of " "lines in the file, ${cR}.");}var B=rLB[line];if(B>A){throw new RangeError("Line ${line} comes after offset ${A}.");}return A-B;}int gv(int A,[int B]){if(B==null)B=0;if(A<0){throw new RangeError("Line may not be negative, was ${A}.");}else if(A>=cR){throw new RangeError("Line ${A} must be less than the number of " "lines in the file, ${cR}.");}else if(B<0){throw new RangeError("Column may not be negative, was ${B}.");}var C=rLB[A]+B;if(C>length||(A+1<cR&&C>=rLB[A+1])){throw new RangeError("Line ${A} doesn't have ${B} columns.");}return C;}String ov(int A,[int B])=>new String.fromCharCodes(sLB.sublist(A,B));}class dM extends l5 implements GH{final PO file;final int offset;Uri get JC=>file.qG;int get HD=>file.uZ(offset);int get RC=>file.hi(offset);dM.SDB(this.file,this.offset){if(offset<0){throw new RangeError("Offset may not be negative, was ${offset}.");}else if(offset>file.length){throw new RangeError("Offset ${offset} must not be greater than the number " "of characters in the file, ${file.length}.");}}DD QF()=>new xK(file,offset,offset);}abstract class DD implements gX{}class xK extends Jr implements DD{final PO file;final int wLB;final int xLB;Uri get JC=>file.qG;int get length=>xLB-wLB;dM get start=>new dM.SDB(file,wLB);dM get end=>new dM.SDB(file,xLB);String get PD=>file.ov(wLB,xLB);String get context=>file.ov(file.gv(start.HD),end.HD==file.cR-1?null:file.gv(end.HD+1));xK(this.file,this.wLB,this.xLB){if(xLB<wLB){throw new ArgumentError('End ${xLB} must come after start ${wLB}.');}else if(xLB>file.length){throw new RangeError("End ${xLB} must not be greater than the number " "of characters in the file, ${file.length}.");}else if(wLB<0){throw new RangeError("Start may not be negative, was ${wLB}.");}}int compareTo(qD A){if(A is!xK)return super.compareTo(A);xK B=A;var C=wLB.compareTo(B.wLB);return C==0?xLB.compareTo(B.xLB):C;}bool operator==(A){if(A is!DD)return super==A;if(A is!xK){return super==A&&JC==A.JC;}return wLB==A.wLB&&xLB==A.xLB&&JC==A.JC;}int get hashCode=>super.hashCode;DD expand(DD A){if(JC!=A.JC){throw new ArgumentError("Source URLs \"${JC}\" and " " \"${A.JC}\" don't match.");}if(A is xK){var B=bI.min(this.wLB,A.wLB);var C=bI.max(this.xLB,A.xLB);return new xK(file,B,C);}else{var B=bI.min(this.wLB,A.start.offset);var C=bI.max(this.xLB,A.end.offset);return new xK(file,B,C);}}}abstract class dQ implements cf{factory dQ(String A,{Duration pollingDelay}){if(FileSystemEntity.isWatchSupported&&!Platform.isWindows){return new Tr(A);}return new Vr(A,pollingDelay:pollingDelay);}}final o5=new RegExp(r'^#\d+\s+(\S.*) \((.+?)((?::\d+){0,2})\)$');final p5=new RegExp(r'^\s*at (?:(\S.*?)(?: \[as [^\]]+\])? \((.*)\)|(.*))$');final q5=new RegExp(r'^(.*):(\d+):(\d+)|native$');final Lr=new RegExp(r'^eval at (?:\S.*?) \((.*)\)(?:, .*?:\d+:\d+)?$');final r5=new RegExp(r'^' r'(?:' r'([^@(/]*)' r'(?:\(.*\))?' r'((?:/[^/]*)*)' r'(?:\(.*\))?' r'@' r')?' r'(.*?)' r':' r'(\d*)' r'(?::(\d*))?' r'$');final s5=new RegExp(r'^(\S+)(?: (\d+)(?::(\d+))?)?\s+([^\d]\S*)$');final t5=new RegExp(r'<(<anonymous closure>|[^>]+)_async_body>');final u5=new RegExp(r"^\.");class WC{final Uri uri;final int HD;final int RC;final String GK;bool get vi=>uri.scheme=='dart';String get uU{if(uri.scheme=='data')return "data:...";return iq(uri);}String get ow{if(uri.scheme!='package')return null;return uri.path.split('/').first;}String get location{if(HD==null)return uU;if(RC==null)return '${uU} ${HD}';return '${uU} ${HD}:${RC}';}factory WC.VDB(String A)=>hX(A,(){if(A=='...'){return new WC(new Uri(),null,null,'...');}var B=o5.firstMatch(A);if(B==null)return new yK(A);var D=B[1].replaceAll(t5,"<async>").replaceAll("<anonymous closure>","<fn>");var G=Uri.parse(B[2]);var C=B[3].split(':');var H=C.length>1?int.parse(C[1]):null;var I=C.length>2?int.parse(C[2]):null;return new WC(G,H,I,D);});factory WC.WDB(String C)=>hX(C,(){var A=p5.firstMatch(C);if(A==null)return new yK(C);H(B,I){var G=Lr.firstMatch(B);while(G!=null){B=G[1];G=Lr.firstMatch(B);}if(B=='native'){return new WC(Uri.parse('native'),null,null,I);}var D=q5.firstMatch(B);if(D==null)return new yK(C);return new WC(Mr(D[1]),int.parse(D[2]),int.parse(D[3]),I);}if(A[2]!=null){return H(A[2],A[1].replaceAll("<anonymous>","<fn>").replaceAll("Anonymous function","<fn>"));}else{return H(A[3],"<fn>");}});factory WC.XDB(String C)=>hX(C,(){var A=r5.firstMatch(C);if(A==null)return new yK(C);var D=Mr(A[3]);var B;if(A[1]!=null){B=A[1];B+= new List.filled('/'.allMatches(A[2]).length,".<fn>").join();if(B=='')B='<fn>';B=B.replaceFirst(u5,'');}else{B='<fn>';}var G=A[4]==''?null:int.parse(A[4]);var H=A[5]==null||A[5]==''?null:int.parse(A[5]);return new WC(D,G,H,B);});factory WC.YDB(String C)=>hX(C,(){var A=s5.firstMatch(C);if(A==null){throw new FormatException("Couldn't parse package:stack_trace stack trace line '${C}'.");}var B=Uri.parse(A[1]);if(B.scheme==''){B=O5(K5(N5(B)));}var D=A[2]==null?null:int.parse(A[2]);var G=A[3]==null?null:int.parse(A[3]);return new WC(B,D,G,A[4]);});static final v5=new RegExp(r'^[a-zA-Z][-+.a-zA-Z\d]*://');static final w5=new RegExp(r'^([a-zA-Z]:[\\/]|\\\\)');static Uri Mr(String A){if(A.contains(v5)){return Uri.parse(A);}else if(A.contains(w5)){return new Uri.file(A,windows:true);}else if(A.startsWith('/')){return new Uri.file(A,windows:false);}if(A.contains('\\'))return J5.hx(A);return Uri.parse(A);}static WC hX(String A,WC B()){try {return B();}on FormatException catch (C){return new yK(A);}}WC(this.uri,this.HD,this.RC,this.GK);String toString()=>'${location} in ${GK}';}class CT implements Pattern{final String pattern;final wD context;final bool recursive;final VE yLB;TX zLB;bool get AMB{if(BMB==null){BMB=context.isAbsolute(context.current);}return BMB;}bool BMB;bool get CMB{if(DMB==null){DMB=yLB.nO;}return DMB;}bool DMB;bool get EMB{if(FMB==null){FMB=yLB.JR;}return FMB;}bool FMB;CT(String A,{wD context,bool recursive: false}):this.DDB(A,context==null?jE:context,recursive);CT.DDB(String A,wD B,bool C):pattern=A,context=B,recursive=C,yLB=new yp(A+(C?"{,/**}":""),B).BE();Stream<FileSystemEntity> list({String root,bool followLinks: true}){if(context.MB!=JT){throw new StateError("Can't list glob \"${this}\"; it matches " "${context.MB} paths, but this platform uses ${JT} paths.");}if(zLB==null)zLB=new TX(yLB);return zLB.list(root:root,followLinks:followLinks);}List<FileSystemEntity> listSync({String root,bool followLinks: true}){if(context.MB!=JT){throw new StateError("Can't list glob \"${this}\"; it matches " "${context.MB} paths, but this platform uses ${JT} paths.");}if(zLB==null)zLB=new TX(yLB);return zLB.listSync(root:root,followLinks:followLinks);}bool kD(String A)=>matchAsPrefix(A)!=null;Match matchAsPrefix(String A,[int B=0]){if(B!=0)return null;if(CMB&&(AMB||context.isAbsolute(A))){var C=context.mL(context.absolute(A));if(yLB.kD(be(context,C))){return new Ze(A,this);}}if(EMB){var D=context.uj(A);if(yLB.kD(be(context,D))){return new Ze(A,this);}}return null;}Iterable<Match> allMatches(String B,[int C=0]){var A=matchAsPrefix(B,C);return A==null?[] :[A];}String toString()=>pattern;}const c4=0x2F;abstract class VE{RegExp GMB;final bool nO=false;final bool JR=true;dF CN()=>new dF([new iE([this])]);bool kD(String A){if(GMB==null)GMB=new RegExp('^${HMB()}\$');return GMB.hasMatch(A);}String HMB();}class iE extends VE{final List<VE> g;bool get nO=>g.first.nO;bool get JR=>g.first.JR;iE(Iterable<VE> A):g=A.toList();dF CN(){if(g.isEmpty)return new dF([this]);var D=g.first.CN().bD.map((B)=>B.g);for(var C in g.skip(1)){var G=C.CN().bD;D=D.expand((B){return G.map((H){return B.toList()..addAll(H.g);});});}return new dF(D.map((B){return new iE(B.fold([] ,(A,C){if(A.isEmpty||A.last is!FG||C is!FG){return A..add(C);}A[A.length-1]=new FG(A.last.PD+C.PD);return A;}));}));}List<iE> split(wD D){var I=[] ;var B;G(C){if(B==null)B=[] ;B.add(C);}H(){if(B==null)return;I.add(new iE(B));B=null;}for(var C in g){if(C is!FG||!C.PD.contains('/')){G(C);continue;}var J=C.PD;if(D.MB==VC.nJ)J=J.replaceAll("/","\\");var A=D.split(J);if(D.isAbsolute(A.first)){if(I.isEmpty&&B==null){var K=A.first;if(D.MB==VC.nJ){K=K.replaceAll("\\","/");}G(new FG(K));}H();A=A.skip(1);if(A.isEmpty)continue;}for(var M in A.take(A.length-1)){G(new FG(M));H();}G(new FG(A.last));if(C.PD.endsWith('/'))H();}H();return I;}String HMB()=>g.map((A)=>A.HMB()).join();bool operator==(Object A)=>A is iE&&const CS().JF(g,A.g);int get hashCode=>const CS().hash(g);String toString()=>g.join();}class Ve extends VE{Ve();String HMB()=>'[^/]*';bool operator==(Object A)=>A is Ve;int get hashCode=>0;String toString()=>'*';}class SX extends VE{final wD IMB;SX(this.IMB);String HMB(){var A=new StringBuffer()..write(r'(?!^(?:\.\./|');if(IMB.MB==VC.kq){A.write(r'/');}else if(IMB.MB==VC.nJ){A.write(r'//|[A-Za-z]:/');}else{assert(IMB.MB==VC.uK);A.write(r'[a-zA-Z][-+.a-zA-Z\d]*://|/');}A.write(r'))[^]*');return A.toString();}bool operator==(Object A)=>A is SX;int get hashCode=>1;String toString()=>'**';}class We extends VE{We();String HMB()=>'[^/]';bool operator==(Object A)=>A is We;int get hashCode=>2;String toString()=>'?';}class DT extends VE{final Set<qK> uL;final bool negated;DT(Iterable<qK> A,{this.negated}):uL=A.toSet();dF CN(){if(negated||uL.any((A)=>!A.wi)){return super.CN();}return new dF(uL.map((A){return new iE([new FG(new String.fromCharCodes([A.min]))]);}));}String HMB(){var A=new StringBuffer();var C=uL.any((B)=>B.contains(c4));if(!negated&&C){A.write('(?!/)');}A.write('[');if(negated){A.write('^');if(!C)A.write('/');}for(var B in uL){var D=new String.fromCharCodes([B.min]);A.write(ae(D));if(B.wi)continue;A.write('-');A.write(ae(new String.fromCharCodes([B.max])));}A.write(']');return A.toString();}bool operator==(Object A){if(A is!DT)return false;if((A as DT).negated!=negated)return false;return const nb().JF(uL,(A as DT).uL);}int get hashCode=>(negated?1:3)*const nb().hash(uL);String toString(){var A=new StringBuffer()..write('[');for(var B in uL){A.writeCharCode(B.min);if(B.wi)continue;A.write('-');A.writeCharCode(B.max);}A.write(']');return A.toString();}}class dF extends VE{final List<iE> bD;bool get nO=>bD.any((A)=>A.nO);bool get JR=>bD.any((A)=>A.JR);dF(Iterable<iE> A):bD=A.toList();dF CN()=>new dF(bD.expand((A)=>A.CN().bD));String HMB()=>'(?:${bD.map((A)=>A.HMB()).join("|")})';bool operator==(Object A)=>A is dF&&const GW().JF(bD,A.bD);int get hashCode=>const GW().hash(bD);String toString()=>'{${bD.join(',')}}';}class FG extends VE{final String PD;final wD IMB;bool get nO{var A=IMB.MB==VC.nJ?PD.replaceAll('/','\\'):PD;return IMB.isAbsolute(A);}bool get JR=>!nO;FG(this.PD,[this.IMB]);String HMB()=>ae(PD);bool operator==(Object A)=>A is FG&&A.PD==PD;int get hashCode=>PD.hashCode;String toString()=>PD;}const wp=2;const xp=3;class TX{final JMB=new Map<String,lJ>();bool KMB;TX(VE G){var H=G.CN();for(var I in H.bD){var A=I.split(jE);var B=A.first.g.first;var C='.';if(B is FG){var D=B.PD;if(Platform.isWindows)D.replaceAll("/","\\");if(ye(D)){assert(A.first.g.length==1);C=B.PD;A.removeAt(0);}}LMB(C,A);}KMB=MMB();}void LMB(String C,List<VE> G){var A=JMB[C];for(var D=0;D<G.length;D++ ){var B=G[D];var H=B.g.any((J)=>J is SX);var I=D==G.length-1;if(A!=null){if(A.pU||H){A.Qw();A.JI(Xe(G.sublist(D)));return;}else if(I){A.JI(B);}else{if(!A.R.containsKey(B)){A.R[B]=new lJ();}A=A.R[B];}}else if(H){JMB[C]=new lJ.EDB(Xe(G.sublist(D)));return;}else if(I){JMB[C]=new lJ()..JI(B);}else{JMB[C]=new lJ();JMB[C].R[B]=new lJ();A=JMB[C].R[B];}}}bool MMB(){if(JMB.length>1&&JMB.containsKey('.'))return true;return JMB.values.any((A)=>A.cu);}Stream<FileSystemEntity> list({String root,bool followLinks: true}){if(root==null)root='.';var A=new Ye();for(var B in JMB.keys){var G=B=='.'?root:B;A.add(JMB[B].list(G,followLinks:followLinks));}A.Fi();if(!KMB)return A.stream;var C=new Set();return A.stream.where((D){if(C.contains(D.path))return false;C.add(D.path);return true;});}List<FileSystemEntity> listSync({String root,bool followLinks: true}){if(root==null)root='.';var B=JMB.keys.expand((A){var G=A=='.'?root:A;return JMB[A].listSync(G,followLinks:followLinks);});if(!KMB)return B.toList();var C=new Set();return B.where((D){if(C.contains(D.path))return false;C.add(D.path);return true;}).toList();}}class lJ{Map<iE,lJ> R;dF NMB;bool get pU=>R==null;bool get OMB{if(NMB!=null)return false;return R.keys.every((A)=>A.g.length==1&&A.g.first is FG);}bool get cu{if(pU)return false;if(R.length>1&&R.keys.any((A)=>A.g.length>1||A.g.single is!FG)){return true;}return R.values.any((B)=>B.cu);}lJ():R=new Map<iE,lJ>(),NMB=null;lJ.EDB(iE A):R=null,NMB=new dF([A]);void Qw(){if(pU)return;NMB=new dF(R.keys.map((A){var B=R[A];B.Qw();return Xe([A,B.NMB]);}));R=null;}void JI(iE A){if(NMB==null){NMB=new dF([A]);}else{NMB.bD.add(A);}}Stream<FileSystemEntity> list(String B,{bool followLinks: true}){if(pU){return new Directory(B).list(recursive:true,followLinks:followLinks).where((C)=>PMB(C.path.substring(B.length+1)));}var A=new Ye();if(OMB){R.forEach((G,H){A.add(H.list(CB(B,G.g.single.PD),followLinks:followLinks));});A.Fi();return A.stream;}var D=new StreamController(sync:true);A.add(D.stream);new Directory(B).list(followLinks:followLinks).listen((C){var I=C.path.substring(B.length+1);if(PMB(I))D.add(C);R.forEach((G,H){if(C is!Directory)return;if(!G.kD(I))return;var K=H.list(CB(B,I),followLinks:followLinks).handleError((M){},test:(J){return J is FileSystemException&&(J.osError.errorCode==wp||J.osError.errorCode==xp);});A.add(K);});},onError:D.addError,onDone:D.close);A.Fi();return A.stream;}Iterable<FileSystemEntity> listSync(String A,{bool followLinks: true}){if(pU){return new Directory(A).listSync(recursive:true,followLinks:followLinks).where((C)=>PMB(C.path.substring(A.length+1)));}if(OMB){return R.keys.expand((B){return R[B].listSync(CB(A,B.g.single.PD),followLinks:followLinks);});}return new Directory(A).listSync(followLinks:followLinks).expand((C){var D=[] ;var G=C.path.substring(A.length+1);if(PMB(G))D.add(C);if(C is!Directory)return D;D.addAll(R.keys.where((B)=>B.kD(G)).expand((B){try {return R[B].listSync(CB(A,G),followLinks:followLinks).toList();}on FileSystemException catch (H){if(H.osError.errorCode==wp||H.osError.errorCode==xp){return const[] ;}else{rethrow;}}}));return D;});}bool PMB(String A){if(NMB==null)return false;return NMB.kD(be(jE,A));}String toString()=>"(${NMB}) ${R}";}iE Xe(Iterable<VE> C){var B=C.toList();var A=[B.removeAt(0)];for(var D in B){A.add(new FG('/'));A.add(D);}return new iE(A);}const d4=0x2D;const e4=0x2F;class yp{final PT QMB;final wD RMB;yp(String A,this.RMB):QMB=new PT(A);iE BE()=>SMB();iE SMB({bool inOptions: false}){var A=[] ;if(QMB.NJ){QMB.error('expected a glob.',position:0,length:0);}while(!QMB.NJ){if(inOptions&&(QMB.kD(',')||QMB.kD('}')))break;A.add(TMB(inOptions:inOptions));}return new iE(A);}VE TMB({bool inOptions: false}){var A=UMB();if(A!=null)return A;var B=VMB();if(B!=null)return B;var C=WMB();if(C!=null)return C;var D=XMB();if(D!=null)return D;return YMB(inOptions:inOptions);}VE UMB(){if(!QMB.GC('*'))return null;return QMB.GC('*')?new SX(RMB):new Ve();}VE VMB(){if(!QMB.GC('?'))return null;return new We();}VE WMB(){if(!QMB.GC('['))return null;if(QMB.kD(']'))QMB.error('unexpected "]".');var C=QMB.GC('!')||QMB.GC('^');D(){var A=QMB.cB();if(C||A!=e4)return A;QMB.error('"/" may not be used in a range.',position:QMB.position-1);}var B=[] ;while(!QMB.GC(']')){var G=QMB.position;QMB.GC('\\');var A=D();if(QMB.GC('-')){if(QMB.kD(']')){B.add(new qK.FDB(A));B.add(new qK.FDB(d4));continue;}QMB.GC('\\');var H=D();if(H<A){QMB.error("Range out of order.",position:G,length:QMB.position-G);}B.add(new qK(A,H));}else{B.add(new qK.FDB(A));}}return new DT(B,negated:C);}VE XMB(){if(!QMB.GC('{'))return null;if(QMB.kD('}'))QMB.error('unexpected "}".');var A=[] ;do{A.add(SMB(inOptions:true));}while(QMB.GC(','));if(A.length==1)QMB.QR(',');QMB.QR('}');return new dF(A);}VE YMB({bool inOptions: false}){var B=new RegExp(inOptions?r'[^*{[?\\}\],()]*':r'[^*{[?\\}\]()]*');QMB.GC(B);var A=new StringBuffer()..write(QMB.FN[0]);while(QMB.GC('\\')){A.writeCharCode(QMB.cB());QMB.GC(B);A.write(QMB.FN[0]);}for(var C in const[']','(',')']){if(QMB.kD(C))QMB.error('unexpected "${C}"');}if(!inOptions&&QMB.kD('}'))QMB.error('unexpected "}"');return new FG(A.toString(),RMB);}}class Ye<BB>{Stream<BB> get stream=>ZMB.stream;final StreamController<BB> ZMB;final aMB=new Map<Stream<BB>,StreamSubscription<BB>>();bool bMB=false;Ye():ZMB=new StreamController<BB>(sync:true);void add(Stream<BB> A){if(aMB.containsKey(A))return;aMB[A]=A.listen(ZMB.add,onError:ZMB.addError,onDone:()=>remove(A));}void remove(Stream<BB> B){var A=aMB.remove(B);if(A!=null)A.cancel();if(bMB&&aMB.isEmpty)close();}void close(){for(var A in aMB.values){A.cancel();}aMB.clear();ZMB.close();}void Fi(){if(aMB.isEmpty)close();bMB=true;}}class qK{final int min;final int max;bool get wi=>min==max;qK(this.min,this.max);qK.FDB(int A):this(A,A);bool contains(int A)=>A>=min&&A<=max;bool operator==(Object A)=>A is qK&&A.min==min&&A.max==max;int get hashCode=>3*min+7*max;}class Ze implements Match{final String input;final Pattern pattern;final int start=0;int get end=>input.length;int get groupCount=>0;Ze(this.input,this.pattern);String operator[](int A)=>this.group(A);String group(int A){if(A!=0)throw new RangeError.range(A,0,0);return input;}List<String> groups(List<int> A)=>A.map((B)=>group(B)).toList();}final f4=new RegExp(r"[+*?{}|[\]\\().^$-]");String ae(String A)=>A.replaceAllMapped(f4,(B)=>"\\${B[0]}");String be(wD B,String A){if(B.MB==VC.nJ)return A.replaceAll('\\','/');if(B.MB==VC.uK)return Uri.decodeFull(A);return A;}class ce extends StreamView<HttpRequest> implements HttpServer{final Set<HttpServer> cMB;String get serverHeader=>cMB.first.serverHeader;set serverHeader(String A){for(var B in cMB){B.serverHeader=A;}}final HttpHeaders defaultResponseHeaders;Duration get idleTimeout=>cMB.first.idleTimeout;set idleTimeout(Duration A){for(var B in cMB){B.idleTimeout=A;}}bool get autoCompress=>cMB.first.autoCompress;int get port=>cMB.first.port;InternetAddress get address=>cMB.first.address;set sessionTimeout(int A){for(var B in cMB){B.sessionTimeout=A;}}ce(Iterable<HttpServer> A):cMB=A.toSet(),defaultResponseHeaders=new zp(A.map((B)=>B.defaultResponseHeaders)),super(Ub.my(A));Future close({bool force: false})=>Future.wait(cMB.map((A)=>A.close(force:force)));HttpConnectionsInfo connectionsInfo(){var A=new HttpConnectionsInfo();for(var C in cMB){var B=C.connectionsInfo();A.total+= B.total;A.active+= B.active;A.idle+= B.idle;A.closing+= B.closing;}return A;}}class YM implements StreamTransformer<HttpRequest,XQ>{static Future<XQ> ZM(HttpRequest A,{Encoding defaultEncoding: UTF8}){return g4.h4(A,defaultEncoding);}}abstract class JO{}abstract class XQ extends JO{}abstract class Aq{}class g4{static Future<XQ> h4(HttpRequest A,Encoding B){return i4(A,A.headers,B).then((C)=>new Cq(A,C),onError:(D){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.close();throw D;});}static Future<JO> i4(Stream<List<int>> K,HttpHeaders TB,Encoding G){ContentType C=TB.contentType;Future<JO> Z(){return K.fold(new BytesBuilder(),(M,A)=>M..add(A)).then((M)=>new KO("binary",M.takeBytes()));}Future<JO> O(Encoding G){var I;var h=C.charset;if(h!=null)I=Encoding.getByName(h);if(I==null)I=G;return K.transform(I.decoder).fold(new StringBuffer(),(P,A)=>P..write(A)).then((P)=>new KO("text",P.toString()));}Future<JO> UB(){return K.transform(new Xq(C.parameters['boundary'])).map((J)=>UX.j4(J,defaultEncoding:G)).map((D){var Q;if(D.v$){Q=D.fold(new StringBuffer(),(B,dB)=>B..write(dB)).then((B)=>B.toString());}else{Q=D.fold(new BytesBuilder(),(B,sB)=>B..add(sB)).then((B)=>B.takeBytes());}return Q.then((A){var p=D.Gi.parameters['filename'];if(p!=null){A=new Bq(D.contentType,p,A);}return [D.Gi.parameters['name'],A];});}).fold([] ,(tB,KC)=>tB..add(KC)).then(Future.wait).then((TC){Map<String,dynamic> H=new Map<String,dynamic>();for(var J in TC){H[J[0]]=J[1];}return new KO('form',H);});}if(C==null){return Z();}switch (C.primaryType){case "text":return O(G);case "application":switch (C.subType){case "json":return O(UTF8).then((S)=>new KO("json",JSON.decode(S.nF)));case "x-www-form-urlencoded":return O(ASCII).then((S){var H=Uri.splitQueryString(S.nF,encoding:G);var EB={};for(var PB in H.keys){EB[PB]=H[PB];}return new KO("form",EB);});default:break;}break;case "multipart":switch (C.subType){case "form-data":return UB();default:break;}break;default:break;}return Z();}}class Bq implements Aq{final ContentType contentType;final String MJ;final dynamic oF;Bq(this.contentType,this.MJ,this.oF);}class KO implements JO{final String type;final dynamic nF;KO(this.type,this.nF);}class Cq extends KO implements XQ{final HttpRequest qE;Cq(this.qE,JO A):super(A.type,A.nF);}abstract class UX implements Stream{static UX j4(aM A,{Encoding defaultEncoding: UTF8})=>de.k4(A,defaultEncoding);}class de extends Stream implements UX{final ContentType contentType;final HeaderValue Gi;final HeaderValue Hi;final aM dMB;bool eMB=false;Stream fMB;de(ContentType this.contentType,HeaderValue this.Gi,HeaderValue this.Hi,aM this.dMB,Encoding B){fMB=dMB;if(Hi!=null){throw new HttpException("Unsupported contentTransferEncoding: " "${Hi.value}");}if(contentType==null||contentType.primaryType=='text'||contentType.mimeType=='application/json'){eMB=true;Encoding A;if(contentType!=null&&contentType.charset!=null){A=Encoding.getByName(contentType.charset);}if(A==null)A=B;fMB=fMB.transform(A.decoder);}}bool get v$=>eMB;static UX k4(aM A,Encoding H){var D;var G;var C;var I=new Map<String,String>();for(String B in A.headers.keys){switch (B){case 'content-type':D=ContentType.parse(A.headers[B]);break;case 'content-transfer-encoding':G=HeaderValue.parse(A.headers[B]);break;case 'content-disposition':C=HeaderValue.parse(A.headers[B],preserveBackslash:true);break;default:I[B]=A.headers[B];break;}}if(C==null){throw new HttpException("Mime Multipart doesn't contain a Content-Disposition header value");}return new de(D,C,G,A,H);}StreamSubscription listen(void A(data),{void onDone(),Function onError,bool cancelOnError}){return fMB.listen(A,onDone:onDone,onError:onError,cancelOnError:cancelOnError);}String value(String A){return dMB.headers[A];}}typedef qB x5();class OT implements qB{final x5 gMB;qB hMB;OT(this.gMB);qB get iMB{if(hMB==null)hMB=gMB();return hMB;}List<WC> get RH=>iMB.RH;qB get oa=>new OT(()=>iMB.oa);qB SR(bool A(WC frame),{bool terse: false})=>new OT(()=>iMB.SR(A,terse:terse));String toString()=>iMB.toString();}class zF{String jMB;Set kMB=new Set();String get name=>jMB;Set get values=>kMB;zF(this.jMB,dynamic A){if(A is Iterable){kMB.addAll(A);}else{kMB.add(A);}}vM(dynamic A)=>kMB.add(A);String toString()=>"${kMB}";bool operator==(zF A)=>(jMB==A.jMB)&&kMB.containsAll(A.kMB)&&A.kMB.containsAll(kMB);static Map<String,zF> lz(Map<String,dynamic> D){var B=new Map<String,zF>();D.forEach((C,A){B[C]=(A is zF?A:new zF(C,A));});return B;}}WD hC=new WD("LDAP");class zb{static const String zz="localhost";static const int A0=389;static const int B0=636;String host;int port;bool ia;String QU;String password;bool lMB;String mMB;String nMB;bK oMB;void pMB(String A,int B,bool C,String D,String G){this.host=(A!=null)?A:zz;this.ia=(C!=null)?C:false;this.port=(B!=null)?B:((this.ia)?B0:A0);this.QU=(D!=null)?D:"";this.password=(G!=null)?G:"";}zb(String A,{int port,bool ssl: false,String bindDN,String password}){pMB(A,port,ssl,bindDN,password);lMB=false;}Future qMB()async{if(lMB==false){}else{}}Future<bK> P$([bool B=true])async{if(oMB!=null&&!oMB.isClosed()){return oMB;}await qMB();hC.kB(this.toString());oMB=new bK(host,port,ia,QU,password);await oMB.connect();if(B){var A=await oMB.bind();if(A.PK!=0)throw new GM("BIND Failed",A);}return oMB;}Future close([bool A=false]){if(oMB!=null){var B=oMB.close(A);oMB=null;return B;}else{assert(oMB!=null);return null;}}String toString(){return "${ia?"ldaps://":"ldap://"}${host}:${port}${(QU!=null)?"/${QU}":""}";}}class bK{HW rMB;String sMB;String tMB;Function onError;bool isClosed()=>(rMB==null||rMB.isClosed());bK(String A,int B,[bool C=false,this.sMB,this.tMB]){rMB=new HW(A,B,C);}Future<bK> connect(){var A=new Completer<bK>();rMB.connect().then((C){A.complete(this);}).catchError((B){hC.oC("Connect error ${B}");A.completeError(B);});return A.future;}Future<WG> bind([String A=null,String B=null]){if(A!=null)return rMB.process(new Ac(A,B));else return rMB.process(new Ac(sMB,tMB));}yP ca(String A,EC B,List<String> C,{int scope: km.lm,int sizeLimit: 0,List<nH> controls: null})=>rMB.DBB(new Fc(A,B,C,scope,sizeLimit),controls);Future<WG> add(String A,Map<String,dynamic> B)=>rMB.process(new Vm(A,zF.lz(B)));Future<WG> delete(String A)=>rMB.process(new Um(A));Future<WG> UAB(String A,Iterable<IS> B)=>rMB.process(new Wm(A,B));close([bool A=false])async{await rMB.close(A);rMB=null;}}abstract class FM{Stopwatch uMB=new Stopwatch()..start();PE message;FM(this.message);String toString()=>"PendingOp m=${message}";bool qj(oH A);done(){var A=uMB.elapsedMilliseconds;hC.eC("Request ${message} serviced in ${A} ms");}}class Hm extends FM{StreamController<XF> vMB=new StreamController<XF>();yP wMB;yP get YBB=>wMB;Hm(PE A):super(A){wMB=new yP(vMB.stream);}bool qj(oH B){if(B is Bc){vMB.add(B.Ik);return false;}else{var A=(B as Cc);if(A.HN.PK!=0)vMB.addError(A.HN);wMB.bZ=A.bZ;wMB.HN=A.HN;vMB.close();done();}return true;}}class Im extends FM{Completer UL=new Completer();Im(PE A):super(A);bool qj(oH B){var A=B.HN;if(xMB(A.PK)){UL.completeError(A);}else{UL.complete(A);}done();return true;}bool xMB(int A){switch (A){case 0:case HS.Sm:case HS.Rm:return false;}return true;}}class HW{Queue<FM> yMB=new Queue<FM>();Map<int,FM> zMB=new Map();static const mz=const Duration(seconds:3);bool ANB=false;Socket BNB;bool isClosed()=>BNB==null;int CNB=1;int DNB;String ENB;bool FNB;HW(this.ENB,this.DNB,this.FNB);Future<HW> connect()async{hC.rD("Creating socket to ${ENB}:${DNB} ssl=${FNB}");BNB=await (FNB?SecureSocket.connect(ENB,DNB,onBadCertificate:GNB):Socket.connect(ENB,DNB));hC.eC("Connected to ${ENB}:${DNB}");BNB.transform(nz()).listen((C)=>HNB(C),onError:(A,B){hC.oC("Socket error = ${A}  stacktrace=${B}");throw new GM("Socket error = ${A} stacktrace=${B}");});return this;}bool GNB(X509Certificate A){hC.gC("Invalid Certificate issuer= ${A.issuer} subject=${A.subject}");hC.gC("SSL Connection will proceed. Please fix the certificate");return true;}yP DBB(Fc B,List<nH> C){var D=new PE( ++CNB,B,C);var A=new Hm(D);INB(A);return A.YBB;}Future<WG> process(HM B)async{var C=new PE( ++CNB,B);var A=new Im(C);INB(A);return await A.UL.future;}INB(FM A){yMB.add(A);JNB();}JNB(){while(KNB()){var A=yMB.removeFirst();LNB(A);}}bool KNB()=>(!yMB.isEmpty)&&(ANB==false);LNB(FM A)async{if(BNB==null){await connect();}hC.eC("Sending message ${A.message}");var B=A.message.toBytes();BNB.add(B);zMB[A.message.yU]=A;if(A.message.rj==Dc)ANB=true;}Future close(bool B){if(B||MNB()){return NNB();}else{var A=new Completer();new Timer.periodic(mz,(Timer C){if(MNB()){C.cancel();NNB().then((D)=>A.complete());}});return A.future;}}bool MNB(){if(zMB.isEmpty&&yMB.isEmpty){return true;}hC.rD("close() waiting for queue to drain pendingResponse=${zMB}");JNB();return false;}Future NNB(){hC.kB("Closing ldap connection");if(BNB==null){return new Future.value();}var A=BNB.done;new Future((){if(BNB!=null){BNB.destroy();BNB=null;}});return A;}void HNB(PE A){var B=X0.Y0(A);if(B is IW){var D=B as IW;hC.oC("Got extended response ${D.Fx} code=${B.HN.PK}");}var C=zMB[A.yU];if(C==null)throw new GM("Server sent us an unknown message id = ${A.yU}" " opCode=${A.rj}");if(C.qj(B)){zMB.remove(A.yU);}if(A.rj==Ec)ANB=false;}}abstract class nH{String get Tj;static const oz=0xA0;bool p$=false;HC ZI()=>throw new Exception("Not implemented. Subclass must implement");nH();static List<nH> pz(HC A){hC.rD("Create Controls from ${A}");var B=[] ;if(A!=null){A.fB.forEach((C)=>B.add(qz(C)));}return B;}static qz(HC A){var B=(A.fB.first as yC).SF;hC.rD("Got control ${B}");switch (B){case xb.Km:return new xb.nCB(A.fB[1]);case wb.Jm:return new wb.mCB(A.fB[1]);default:throw new Exception("Control ${B} not implemented");}}String toString()=>"${Tj} ${this.runtimeType}, isCritical=${p$}}";}class wb extends nH{static const Jm="1.2.840.113556.1.4.474";String get Tj=>Jm;wb.mCB(yC A){}}class xb extends nH{static const Km="2.16.840.1.113730.3.4.10";get Tj=>Km;int bx;int lu;int Iv=0;int DEB;xb.nCB(yC B){var C=B.RI;C[0]=tV;var D=new HC.dCB(C);hC.rD("Create control from ${B}  seq=${D}");var A=(D.fB.first as HC);A.fB.forEach((G)=>hC.rD(" ${G.runtimeType}  ${G}"));bx=(A.fB[0] as SG).NG;lu=(A.fB[1] as SG).NG;Iv=(A.fB[2] as SG).NG;}String toString()=>"${super.toString()}(targetpos=${bx}, contentCount=${lu},x=${Iv})";}class GM implements Exception{String ONB;WG PNB;String get message=>ONB;WG get HN=>PNB;GM(this.ONB,[this.PNB]);String toString()=>"LDAPException(${message}, result=${PNB})";}Pm(bool A,String B){if(!A)throw new GM(B);}class EC{int QNB;int get RR=>QNB;String RNB;String get H_=>RNB;String SNB;String get SZ=>SNB;List<EC> TNB=new List<EC>();List<EC> get Rk=>TNB;static const int Lm=0xA0;static const int Mm=0xA1;static const int rz=0xA2;static const int Nm=0xA3;static const int sz=0xA5;static const int tz=0xA6;static const int Om=0x87;static const int uz=0xA8;static const int vz=0xA9;EC(this.QNB,[this.SNB,this.RNB,this.TNB]);static EC yb(String A,String B)=>new EC(Nm,A,B);static EC wz(List<EC> A)=>new EC(Lm,null,null,A);static EC xz(List<EC> A)=>new EC(Mm,null,null,A);static EC yz(String A)=>new EC(Om,A);EC operator&(EC A)=>EC.wz([this,A]);EC operator|(EC A)=>EC.xz([this,A]);String toString()=>"Filter(type=${QNB} attrName=${SNB} val=${RNB}, subFilters=${TNB})";bC ZI(){switch (RR){case EC.Nm:case EC.sz:case EC.tz:case EC.uz:var A=new HC(tag:RR);A.add(new yC(SZ));A.add(new yC(U0.V0(H_)));return A;case EC.Lm:case EC.Mm:var B=new mP(tag:RR);Rk.forEach((EC D){B.add(D.ZI());});return B;case EC.Om:return new yC(SZ,tag:RR);case EC.rz:assert(Rk!=null);var C=new mP(tag:RR);C.add(Rk[0].ZI());return C;case EC.vz:throw "Not Done yet. Fix me!!";default:throw new GM("Unexpected filter type = ${RR}. This should never happen");}}}class IS{static const int W0=2;String UNB;List VNB=new List();int WNB;String get SZ=>UNB;int get wAB=>WNB;List get values=>VNB;IS.oCB(this.UNB,this.VNB){WNB=W0;}}class Vm extends HM{String XNB;Map<String,zF> YNB;Vm(this.XNB,Map<String,zF> this.YNB):super(em);bC ZI(){var A=ZNB();A.add(new yC(XNB));var C=new HC();YNB.forEach((I,zF D){var B=new HC();B.add(new yC(D.name));var G=new HC();D.values.forEach((dynamic H){G.add(new yC(H));});B.add(G);C.add(B);});A.add(C);return A;}}class Ac extends HM{String aNB;String bNB;static const int Z0=0x80;Ac(this.aNB,this.bNB):super(Dc);bC ZI(){var A=ZNB();var B=new SG(3);A.add(B);var C=new yC(aNB);var D=new yC(bNB,tag:Z0);A.add(C);A.add(D);return A;}}class Um extends HM{String XNB;Um(this.XNB):super(gm);bC ZI()=>new yC(XNB,tag:gm);}class PE{int cNB;int dNB;int get rj=>dNB;HC eNB;HC fNB;bC gNB;List<bC> get fB=>(gNB as HC).fB;int get yU=>cNB;HC get bZ=>fNB;bool get c$=>fNB!=null;HC get jR=>eNB;int get SAB=>gNB.kx;PE(this.cNB,HM B,[List<nH> A=null]){dNB=B.EBB;gNB=B.ZI();if(A!=null&&A.length>0){fNB=new HC(tag:g0);A.forEach((C){fNB.add(C.ZI());hC.rD("adding control ${C}");});}String D()=>"LDAPMessage(id=${cNB} ${jR} controls=${fNB}";}PE.qCB(Uint8List A){gNB=new HC.dCB(A);Pm(gNB!=null,"Parsing error on ${A}");Pm(fB.length==2||fB.length==3,"Expecting two or three elements.actual = ${fB.length} obj=${gNB}");var C=fB[0] as SG;cNB=C.NG;eNB=fB[1] as HC;dNB=eNB.tag;if(fB.length==3){var B=fB[2].RI;if(B[0]==nH.oz)fNB=new HC.dCB(B);}hC.eC("Got LDAP Message. Id = ${yU} protocolOp = ${jR}");}List<int> toBytes(){HC A=new HC();A.add(new SG(cNB));A.add(gNB);if(fNB!=null)A.add(fNB);var B=A.RI;return B;}String toString(){var A=jm(dNB);return "Msg(id=${cNB}, op=${A},controls=${fNB})";}}const int Dc=0x60;const int Ec=0x61;const int Zm=0x63;const int am=0x64;const int cm=0x65;const int a0=0x73;const int dm=0x66;const int b0=0x67;const int em=0x68;const int fm=0x69;const int c0=0x78;const int gm=0x4A;const int d0=0x6B;const int e0=0x6C;const int hm=0x6D;const int f0=0x6E;const int im=0x6F;const int g0=0xA0;String jm(int A){switch (A){case Dc:return "BND_REQ";case Ec:return "BND_RESP";case Zm:return "SRCH_REQ";case am:return "SRCH_RES_ENTRY";case cm:return "SRCH_RES_DONE";case a0:return "SRCH_RES_REF";case dm:return "MODIFY_REQUEST";case em:return "ADD_REQUEST";case fm:return "ADD_RESPONSE";case e0:return "MODIFY_DN_REQ";case hm:return "MODIFY_DN_RESP";case f0:return "COMPARE_REQ";case im:return "COMPARE_RESP";default:return A.toRadixString(16);}}class Ym extends oH{Ym(PE A):super(A);}class Cc extends oH{Cc(PE A):super(A);}class bm extends oH{bm(PE A):super(A);}class IW extends oH{String Fx;String response;IW(PE A):super(A){if(A.fB.length>2){Fx=hNB(A.fB[2]);if(A.fB.length==4){response=hNB(A.fB[3]);}}}String hNB(bC A){var B=new yC.hCB(A.RI);return B.SF;}}class Wm extends HM{String XNB;List<IS> iNB;Wm(this.XNB,this.iNB):super(dm);bC ZI(){var A=ZNB();A.add(new yC(XNB));var D=new HC();iNB.forEach((IS B){var C=new HC();C.add(new SG(B.wAB));C.add(jNB(B.SZ,B.values));D.add(C);});A.add(D);return A;}HC jNB(String C,List D){var A=new HC();A.add(new yC(C));var B=new HC();D.forEach((G){B.add(new yC(G));});A.add(B);return A;}}class Xm{int eNB;int get EBB=>eNB;Xm(this.eNB);HC ZNB(){var A=new HC(tag:eNB);return A;}}abstract class HM extends Xm{HM(int A):super(A);bC ZI();}class oH{WG kNB;List<nH> fNB=[] ;List<nH> get bZ=>fNB;int lNB;WG get HN=>kNB;oH.pCB();oH(PE A){hC.rD("+++++ new response op = ${A}");kNB=mNB(A.jR);if(A.c$)fNB=nH.pz(A.fNB);}WG mNB(HC A){hC.rD("parse ldap result == ${A}");SG B=A.fB[0];var C=B.NG;var D=A.fB[1] as yC;var G=D.SF;var H=A.fB[2] as yC;var I=H.SF;var J=[] ;if(A.fB.length>3){var K=A.fB[3];hC.eC("parse LDAP Result type = ${K}");}return new WG(C,G,I,J);}}class X0{static oH Y0(PE A){hC.rD("handle response tag=${jm(A.jR.tag)}");oH B;switch (A.jR.tag){case Ec:return new Ym(A);case am:return new Bc(A);case cm:return new Cc(A);case c0:return new IW(A);case fm:case d0:case b0:case hm:case im:return new bm(A);default:throw "Not done";}return B;}}class Fc extends HM{String nNB;int oNB;int pNB;int qNB=0;List<String> YNB;bool rNB=false;int sNB=0;EC tNB;Fc(this.nNB,this.tNB,this.YNB,[this.oNB=km.lm,this.pNB=0]):super(Zm);bC ZI(){var A=ZNB();var B=new HC();YNB.forEach((String C){B.add(new yC(C));});A..add(new yC(nNB))..add(new Sb(oNB))..add(new Sb(qNB))..add(new SG(pNB))..add(new SG(sNB))..add(new sV(rNB))..add(tNB.ZI())..add(B);return A;}}class Bc extends oH{XF uNB;XF get Ik=>uNB;Bc(PE G):super.pCB(){var A=G.jR;var H=A.fB[0] as yC;var B=H.SF;hC.rD("Search Entry dn=${B}");var I=A.fB[1] as HC;uNB=new XF(B);I.fB.forEach((HC C){var D=C.fB[0] as yC;var J=C.fB[1] as mP;var K=J.fB.map((M)=>(M as yC).SF).toSet();Ik.HB[D.SF]=new zF(D.SF,K);});if(A.fB.length>=3){var O=A.fB[2];hC.rD("Controls = ${O}");}}String toString(){return "SearchResultEntry(${Ik}})";}}StreamTransformer<Uint8List,PE> nz(){Uint8List C=null;return new StreamTransformer.fromHandlers(handleData:(Uint8List H,EventSink<PE> M){var A;if(C==null){A=new Uint8List.view(H.buffer);}else{A=new Uint8List(C.length+H.length);A.setRange(0,C.length,C);A.setRange(C.length,A.length,H);C=null;}assert(0<A.length);do{var B=null;var D;if(2<=A.length){int I=A[1];if(I&0x80==0){D=1;B=I&0x7F;}else{var J=(I&0x7F);if(2+J<=A.length){D=1+J;B=0;for(int K=2;K<J+2;K++ ){B<<= 8;B|= A[K]&0xFF;}}}}if(B!=null&&(1+D+B)<=A.length){var G=(1+D+B);hC.F$("Bytes parsed for ASN.1 object: ${G}");hC.eC("ASN.1 object received: tag=${A[0]}, length=${B}");hC.rD("ASN.1 value: ${new Uint8List.view(A.buffer,1+D,B)}");if(A[0]==10){hC.gC("LDAP stream transformer: got a tag 10 object");}var O=new PE.qCB(A);assert(O.SAB==G);M.add(O);if(A.length==G){A=null;}else{A=new Uint8List.view(A.buffer,A.offsetInBytes+G);}}else{C=A;A=null;}}while(A!=null);},handleError:(Object P,StackTrace Q,EventSink<PE> M){hC.oC("LDAP stream transformer: error=${P}, stacktrace=${Q}");assert(false);throw P;});}class WG{int vNB;String wNB;String xNB;List<String> yNB;int get PK=>vNB;String get qu=>wNB;String get OAB=>xNB;WG(this.vNB,this.xNB,this.wNB,this.yNB);String toString()=>"${C0(PK)} msg=${wNB} dn=${OAB}";}class XF{String zNB;String get zu=>zNB;Map<String,zF> AOB=new Map<String,zF>();Map<String,zF> get HB=>AOB;XF(this.zNB);String toString()=>"Entry[${zNB},${AOB}]";}String C0(int A)=>"${HS.Tm(A)} (${A})";class HS{static const int Qm=0;static const int D0=1;static const int E0=2;static const int F0=3;static const int G0=4;static const int Rm=5;static const int Sm=6;static const int H0=7;static const int I0=8;static const int J0=9;static const int K0=11;static const int L0=12;static const int M0=13;static const int N0=14;static const int O0=16;static const int P0=17;static const int Q0=32;static const int R0=49;static const int S0=50;static const int T0=68;static String Tm(int A){switch (A){case Qm:return "OK";case D0:return "Operations Error";case E0:return "Protocol Error";case F0:return "Time Limit Exceeded";case G0:return "Size Limit Exceeded";case Sm:return "Compare True";case Rm:return "Compare False";case H0:return "Auth Method Not supported";case I0:return "String Auth Required";case J0:return "Referral";case K0:return "Admin Limit Exceeded";case L0:return "UNAVAILABLE_CRITICAL_EXTENSION";case M0:return "CONFIDENTIALITY_REQUIRED";case N0:return "SASL_BIND_IN_PROGRESS";case O0:return "NO_SUCH_ATTRIBUTE";case P0:return "Undefined Attribute Type";case Q0:return "Object does not exist";case R0:return "Invalid Credentials";case S0:return "Insufficient Access Rights";case T0:return "Entry already exists";default:return "LDAP Error code ${A}";}}}class yP{WG HN;yP(this.BOB);Stream<XF> BOB;Stream<XF> get stream=>BOB;List<nH> bZ;}class km{static const int lm=2;}class U0{static String V0(String C){StringBuffer A=new StringBuffer();C.codeUnits.forEach((B){switch (B){case 0x2a:case 0x28:case 0x29:case 0x00:case 0x5c:A.write('\\');A.write(B.toRadixString(16));break;default:A.writeCharCode(B);break;}});return A.toString();}}class G6 extends PT{}class fM{}class GH implements Comparable<GH>{}abstract class l5 implements GH{String get lBB{var A=JC==null?'unknown source':JC;return '${A}:${HD+1}:${RC+1}';}int yu(GH A){if(JC!=A.JC){throw new ArgumentError("Source URLs \"${JC}\" and " "\"${A.JC}\" don't match.");}return (offset-A.offset).abs();}qD QF()=>new qD(this,this,"");int compareTo(GH A){if(JC!=A.JC){throw new ArgumentError("Source URLs \"${JC}\" and " "\"${A.JC}\" don't match.");}return offset-A.offset;}bool operator==(A)=>A is GH&&JC==A.JC&&offset==A.offset;int get hashCode=>JC.hashCode+offset;String toString()=>'<${runtimeType}: ${offset} ${lBB}>';}bool LO=false;RB l4=RB.Fq;RB Dq=RB.fe;class WD{final String name;String get Tv=>(parent==null||parent.name=='')?name:'${parent.Tv}.${name}';final WD parent;RB COB;final Map<String,WD> DOB;final Map<String,WD> R;StreamController<rK> EOB;factory WD(String A){return m4.putIfAbsent(A,()=>new WD.GDB(A));}factory WD.GDB(String A){if(A.startsWith('.')){throw new ArgumentError("name shouldn't start with a '.'");}int B=A.lastIndexOf('.');WD C=null;String D;if(B==-1){if(A!='')C=new WD('');D=A;}else{C=new WD(A.substring(0,B));D=A.substring(B+1);}return new WD.HDB(D,C,new Map<String,WD>());}WD.HDB(this.name,this.parent,Map<String,WD> A):this.DOB=A,this.R=new UnmodifiableMapView(A){if(parent!=null)parent.DOB[name]=this;}RB get level{if(LO){if(COB!=null)return COB;if(parent!=null)return parent.level;}return Dq;}void set level(RB A){if(LO&&parent!=null){COB=A;}else{if(parent!=null){throw new UnsupportedError('Please set "hierarchicalLoggingEnabled" to true if you want to ' 'change the level on a non-root logger.');}Dq=A;}}Stream<rK> get Qa=>FOB();void Ei(){if(LO||parent==null){if(EOB!=null){EOB.close();EOB=null;}}else{ee.Ei();}}bool wO(RB A)=>(A>=level);void IN(RB B,A,[Object D,StackTrace G,Zone H]){Object I;if(wO(B)){if(A is Function)A=A();if(A is!String){I=A;A=A.toString();}if(G==null&&B>=l4){try {throw "autogenerated stack trace for ${B} ${A}";}catch (K,M){G=M;if(D==null)D=K;}}if(H==null)H=Zone.current;var J=new rK(B,A,Tv,D,G,H,I);if(LO){var C=this;while(C!=null){C.GOB(J);C=C.parent;}}else{ee.GOB(J);}}}void rD(A,[Object B,StackTrace C])=>IN(RB.YQ,A,B,C);void F$(A,[Object B,StackTrace C])=>IN(RB.Gq,A,B,C);void eC(A,[Object B,StackTrace C])=>IN(RB.VX,A,B,C);void PH(A,[Object B,StackTrace C])=>IN(RB.Hq,A,B,C);void kB(A,[Object B,StackTrace C])=>IN(RB.fe,A,B,C);void gC(A,[Object B,StackTrace C])=>IN(RB.Iq,A,B,C);void oC(A,[Object B,StackTrace C])=>IN(RB.Jq,A,B,C);Stream<rK> FOB(){if(LO||parent==null){if(EOB==null){EOB=new StreamController<rK>.broadcast(sync:true);}return EOB.stream;}else{return ee.FOB();}}void GOB(rK A){if(EOB!=null){EOB.add(A);}}static final WD ee=new WD('');static final Map<String,WD> m4=<String,WD>{};}class RB implements Comparable<RB>{final String name;final int value;const RB(this.name,this.value);static const RB Eq=const RB('ALL',0);static const RB Fq=const RB('OFF',2000);static const RB YQ=const RB('FINEST',300);static const RB Gq=const RB('FINER',400);static const RB VX=const RB('FINE',500);static const RB Hq=const RB('CONFIG',700);static const RB fe=const RB('INFO',800);static const RB Iq=const RB('WARNING',900);static const RB Jq=const RB('SEVERE',1000);static const RB n4=const RB('SHOUT',1200);static const List<RB> ge=const[Eq,YQ,Gq,VX,Hq,fe,Iq,Jq,n4,Fq];bool operator==(A)=>A is RB&&value==A.value;bool operator<(RB A)=>value<A.value;bool operator<=(RB A)=>value<=A.value;bool operator>(RB A)=>value>A.value;bool operator>=(RB A)=>value>=A.value;int compareTo(RB A)=>value-A.value;int get hashCode=>value;String toString()=>name;}class rK{final RB level;final String message;final Object dAB;final String Hj;final DateTime cx;final int Mx;static int o4=0;final Object error;final StackTrace stackTrace;final Zone zone;rK(this.level,this.message,this.Hj,[this.error,this.stackTrace,this.zone,this.dAB]):cx=new DateTime.now(),Mx=rK.o4++ ;String toString()=>'[${level.name}] ${Hj}: ${message}';}const p4=const[40,41,60,62,64,44,59,58,92,34,47,91,93,63,61,123,125,32,9];bool q4(int A){return A>31&&A<128&&p4.indexOf(A)==-1;}int he(int A){const B=pC.v4-pC.Wq;return (pC.Wq<=A&&A<=pC.u4)?A+B:A;}void ET(int A,int B){if(A!=B){throw new GT("Failed to parse multipart mime 1");}}void Kq(int A){if(A!=pC.re&&A!=pC.qe){throw new GT("Failed to parse multipart mime 2");}}class Lq extends aM{final Map<String,String> headers;final Stream<List<int>> HOB;Lq(this.headers,this.HOB);StreamSubscription<List<int>> listen(void A(List<int> data),{void onDone(),Function onError,bool cancelOnError}){return HOB.listen(A,onDone:onDone,onError:onError,cancelOnError:cancelOnError);}}class Mq{static const int Nq=0;static const int ie=1;static const int Oq=2;static const int Pq=3;static const int je=4;static const int ke=5;static const int Qq=6;static const int le=7;static const int Rq=8;static const int me=9;static const int WX=10;static const int Sq=11;static const int Tq=12;static const int Uq=13;static const int ne=14;static const int r4=15;final List<int> IOB;final List<int> JOB=[] ;final List<int> KOB=[] ;static const int s4=0;static const int oe=1;static const int pe=2;static const int Vq=3;int LOB=s4;StreamController MOB;Stream<aM> get stream=>MOB.stream;StreamSubscription NOB;StreamController OOB;Map<String,String> POB;int QOB=Nq;int ROB=2;int SOB;List<int> TOB;Mq(this.IOB,Stream<List<int>> A){MOB=new StreamController(sync:true,onPause:UOB,onResume:VOB,onCancel:(){LOB=Vq;WOB();},onListen:(){LOB=oe;NOB=A.listen((B){assert(TOB==null);NOB.pause();TOB=B;SOB=0;XOB();},onDone:(){if(QOB!=ne){MOB.addError(new GT("Bad multipart ending"));}MOB.close();},onError:MOB.addError);});}void VOB(){assert(LOB==pe);LOB=oe;WOB();}void UOB(){LOB=pe;WOB();}void WOB(){if(OOB==null){switch (LOB){case oe:if(NOB.isPaused)NOB.resume();break;case pe:if(!NOB.isPaused)NOB.pause();break;case Vq:NOB.cancel();break;default:throw new StateError("This code should never be reached.");}}}void XOB(){int C=0;int B;void G(){if(B<0){var D=C+SOB-ROB;if(D<=C){OOB.add(IOB.sublist(0,D));}else{OOB.add(IOB.sublist(0,C));OOB.add(TOB.sublist(0,D-C));}}else{var H=SOB-ROB;OOB.add(TOB.sublist(B,H));}}if(QOB==WX&&ROB==0){B=0;}else{B=null;}C=ROB;while((SOB<TOB.length)&&QOB!=r4&&QOB!=ne){int A;if(SOB<0){A=IOB[C+SOB];}else{A=TOB[SOB];}switch (QOB){case Nq:if(A==IOB[ROB]){ROB++ ;if(ROB==IOB.length){QOB=ie;ROB=0;}}else{SOB=SOB-ROB;ROB=0;}break;case ie:if(A==pC.MO){QOB=Oq;}else if(A==pC.XX){QOB=Sq;}else{Kq(A);}break;case Oq:ET(A,pC.FT);if(OOB!=null){OOB.close();OOB=null;WOB();}QOB=Pq;break;case Pq:POB=new Map<String,String>();if(A==pC.MO){QOB=me;}else{JOB.add(he(A));QOB=je;}break;case je:if(A==pC.t4){QOB=ke;}else{if(!q4(A)){throw new GT("Invalid header field name");}JOB.add(he(A));}break;case ke:if(A==pC.MO){QOB=le;}else if(A!=pC.re&&A!=pC.qe){KOB.add(A);QOB=Qq;}break;case Qq:if(A==pC.MO){QOB=le;}else{KOB.add(A);}break;case le:ET(A,pC.FT);QOB=Rq;break;case Rq:if(A==pC.re||A==pC.qe){QOB=ke;}else{String I=UTF8.decode(JOB);String J=UTF8.decode(KOB);POB[I.toLowerCase()]=J;JOB.clear();KOB.clear();if(A==pC.MO){QOB=me;}else{JOB.add(he(A));QOB=je;}}break;case me:ET(A,pC.FT);OOB=new StreamController(sync:true,onListen:(){if(NOB.isPaused)NOB.resume();},onPause:NOB.pause,onResume:NOB.resume);MOB.add(new Lq(POB,OOB.stream));POB=null;QOB=WX;B=SOB+1;break;case WX:if(A==IOB[ROB]){ROB++ ;if(ROB==IOB.length){if(B!=null){SOB++ ;G();SOB-- ;}OOB.close();OOB=null;WOB();ROB=0;QOB=ie;}}else{SOB=SOB-ROB;if(B==null)B=SOB;ROB=0;}break;case Sq:ET(A,pC.XX);QOB=Tq;break;case Tq:if(A==pC.MO){QOB=Uq;}else{Kq(A);}break;case Uq:ET(A,pC.FT);if(OOB!=null){OOB.close();OOB=null;WOB();}QOB=ne;break;default:assert(false);break;}SOB++ ;}if(QOB==WX&&B!=null){G();}if(SOB==TOB.length){TOB=null;SOB=null;NOB.resume();}}}class pC{static const int qe=9;static const int FT=10;static const int MO=13;static const int re=32;static const int XX=45;static const int t4=58;static const int Wq=65;static const int u4=90;static const int v4=97;}Uint8List w4(String C){var B=C.codeUnits;var A=new Uint8List(4+B.length);A[0]=pC.MO;A[1]=pC.FT;A[2]=pC.XX;A[3]=pC.XX;A.setRange(4,4+B.length,B);return A;}class Xq implements StreamTransformer<List<int>,aM>{final List<int> YOB;Xq(String A):YOB=w4(A);Stream<aM> bind(Stream<List<int>> A){return new Mq(YOB,A).stream;}}class GT implements Exception{final String message;const GT([String this.message=""]);String toString()=>"MimeMultipartException: ${message}";}abstract class aM extends Stream<List<int>>{Map<String,String> get headers;}String x4(String A){int B=A.lastIndexOf('.',A.length-1);if(B!=-1){String C=A.substring(B+1);return y4[C];}else return null;}Map y4=const{'3g2':'video/3gpp2','abs':'audio/x-mpeg','ai':'application/postscript','aif':'audio/x-aiff','aifc':'audio/x-aiff','aiff':'audio/x-aiff','aim':'application/x-aim','anx':'application/annodex','axa':'audio/annodex','axv':'video/annodex','art':'image/x-jg','asf':'video/x-ms-asf','asx':'video/x-ms-asf','au':'audio/basic','avi':'video/x-msvideo','avs':'video/avs','avx':'video/x-rad-screenplay','bcpio':'application/x-bcpio','bin':'application/octet-stream','bmp':'image/bmp','body':'text/html','bwf':'audio/x-wav','c':'text/x-c','caf':'audio/x-caf','cdda':'audio/aiff','cdf':'application/x-cdf','cer':'application/x-x509-ca-cert','class':'application/java','cpio':'application/x-cpio','cpp':'text/x-c','cre':'music/crescendo-encrypted','csh':'application/x-csh','css':'text/css','csv':'text/csv','dart':'application/dart','dib':'image/bmp','doc':'application/msword','docm':'application/vnd.ms-word.document.macroEnabled.12','docs':'application/vnd.google-apps.document','docx':'application/vnd.openxmlformats-officedocument.wordprocessingml.document','dot':'application/msword','dotm':'application/vnd.ms-word.template.macroEnabled.12','dotx':'application/vnd.openxmlformats-officedocument.wordprocessingml.template','dtd':'application/xml-dtd','dv':'video/x-dv','dvi':'application/x-dvi','dxf':'application/dxf','enc':'video/mpeg','eps':'application/postscript','etx':'text/x-setext','exe':'application/octet-stream','flac':'audio/flac','flc':'video/flc','flv':'video/x-flv','fvi':'video/isivideo','gdoc':'application/vnd.google-apps.document','gdraw':'application/vnd.google-apps.drawing','gslide':'application/vnd.google-apps.presentation','gsheet':'application/vnd.google-apps.spreadsheet','gif':'image/gif','gsm':'audio/x-gsm','gtar':'application/x-gtar','gz':'application/x-gzip','gzip':'application/x-gzip','h':'text/x-h','hdf':'application/x-hdf','hdml':'text/x-hdml','hqx':'application/mac-binhex40','htc':'text/x-component','htm':'text/html','html':'text/html','ico':'image/vnd.microsoft.icon','ief':'image/ief','jad':'text/vnd.sun.j2me.app-descriptor','jar':'application/java-archive','java':'text/plain','jnlp':'application/x-java-jnlp-file','jp2':'image/jp2','jpe':'image/jpeg','jpeg':'image/jpeg','jpg':'image/jpeg','js':'text/javascript','jsf':'text/plain','json':'application/json','jsonp':'application/javascript','jspf':'text/plain','kar':'audio/x-midi','latex':'application/x-latex','lha':'application/x-lzh','lzh':'application/x-lzh','m1v':'video/mpeg','m3u':'audio/x-mpegurl','m4a':'audio/mp4','mac':'image/x-macpaint','man':'application/x-troff-man','map':'text/x-imagemap','mathml':'application/mathml+xml','md':'text/x-web-markdown','me':'application/x-troff-me','mid':'audio/x-midi','midi':'audio/x-midi','mif':'application/x-mif','mkd':'text/x-web-markdown','mmf':'application/x-smaf','mov':'video/quicktime','movie':'video/x-sgi-movie','mp1':'audio/x-mpeg','mp2':'audio/x-mpeg','mp3':'audio/x-mpeg','mp4':'video/mp4','mpa':'audio/x-mpeg','mpe':'video/mpeg','mpeg':'video/mpeg','mpega':'audio/x-mpeg','mpg':'video/mpeg','mpv2':'video/mpeg2','mqv':'video/quicktime','ms':'application/x-wais-source','nc':'application/x-netcdf','oda':'application/oda','odb':'application/vnd.oasis.opendocument.database','odc':'application/vnd.oasis.opendocument.chart','odf':'application/vnd.oasis.opendocument.formula','odg':'application/vnd.oasis.opendocument.graphics','odi':'application/vnd.oasis.opendocument.image','odm':'application/vnd.oasis.opendocument.text-master','odp':'application/vnd.oasis.opendocument.presentation','ods':'application/vnd.oasis.opendocument.spreadsheet','odt':'application/vnd.oasis.opendocument.text','otg':'application/vnd.oasis.opendocument.graphics-template','oth':'application/vnd.oasis.opendocument.text-web','otp':'application/vnd.oasis.opendocument.presentation-template','ots':'application/vnd.oasis.opendocument.spreadsheet-template','ott':'application/vnd.oasis.opendocument.text-template','ogx':'application/ogg','ogv':'video/ogg','oga':'audio/ogg','ogg':'audio/ogg','spx':'audio/ogg','xspf':'application/xspf+xml','pages':'application/vnd.apple.pages','pbm':'image/x-portable-bitmap','pcd':'image/x-photo-cd','pct':'image/pict','pcx':'image/x-pcx','pdf':'application/pdf','pgm':'image/x-portable-graymap','php':'application/x-php','pic':'image/pict','pict':'image/pict','pls':'audio/x-scpls','png':'image/png','pnm':'image/x-portable-anymap','pnt':'image/x-macpaint','ppm':'image/x-portable-pixmap','ppt':'application/vnd.ms-powerpoint','pot':'application/vnd.ms-powerpoint','pps':'application/vnd.ms-powerpoint','ppa':'application/vnd.ms-powerpoint','pptx':'application/vnd.openxmlformats-officedocument.presentationml.presentation','potx':'application/vnd.openxmlformats-officedocument.presentationml.template','ppsx':'application/vnd.openxmlformats-officedocument.presentationml.slideshow','ppam':'application/vnd.ms-powerpoint.addin.macroEnabled.12','pptm':'application/vnd.ms-powerpoint.presentation.macroEnabled.12','potm':'application/vnd.ms-powerpoint.template.macroEnabled.12','ppsm':'application/vnd.ms-powerpoint.slideshow.macroEnabled.12','ps':'application/postscript','psd':'image/x-photoshop','qt':'video/quicktime','qti':'image/x-quicktime','qtif':'image/x-quicktime','ras':'image/x-cmu-raster','rat':'text/x-rat','rdf':'application/rdf+xml','rgb':'image/x-rgb','ra':'audio/vnd.rn-realaudio','rar':'application/x-rar-compressed','rm':'application/vnd.rn-realmedia','rmi':'audio/midi','roff':'application/x-troff','rt':'text/vnd.rn-realtext','rtf':'application/rtf','rtx':'text/richtext','sgi':'image/x-sgi','sgm':'text/x-sgml','sgml':'text/x-sgml','sh':'application/x-sh','shar':'application/x-shar','smf':'audio/x-midi','smi':'text/smil-basic','sit':'application/x-stuffit','slides':'application/vnd.google-apps.presentation','snd':'audio/basic','spreadsheets':'application/vnd.google-apps.spreadsheet','src':'application/x-wais-source','sv4cpio':'application/x-sv4cpio','sv4crc':'application/x-sv4crc','svg':'image/svg+xml','svgz':'image/svg+xml','swf':'application/x-shockwave-flash','t':'application/x-troff','talk':'text/x-speech','tar':'application/x-tar','tcl':'application/x-tcl','tex':'application/x-tex','texi':'application/x-texinfo','texinfo':'application/x-texinfo','targa':'image/x-targa','tga':'image/x-targa','tgz':'application/x-tar','tif':'image/tiff','tiff':'image/tiff','tr':'application/x-troff','tsv':'text/tab-separated-values','ttf':'application/x-font-ttf','txt':'text/plain','ulw':'audio/basic','ustar':'application/x-ustar','vsd':'application/x-visio','vxml':'application/voicexml+xml','war':'application/java-archive','wav':'audio/x-wav','webm':'video/webm','wbmp':'image/vnd.wap.wbmp','wlpg':'application/x-wlpg3-detect','wml':'text/vnd.wap.wml','wmlc':'application/vnd.wap.wmlc','wmls':'text/vnd.wap.wmlscript','wmlscriptc':'application/vnd.wap.wmlscriptc','wmv':'video/x-ms-wmv','wrl':'x-world/x-vrml','wspolicy':'application/wspolicy+xml','xbm':'image/x-xbitmap','xht':'application/xhtml+xml','xhtml':'application/xhtml+xml','xls':'application/vnd.ms-excel','xlt':'application/vnd.ms-excel','xla':'application/vnd.ms-excel','xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','xltx':'application/vnd.openxmlformats-officedocument.spreadsheetml.template','xlsm':'application/vnd.ms-excel.sheet.macroEnabled.12','xltm':'application/vnd.ms-excel.template.macroEnabled.12','xlam':'application/vnd.ms-excel.addin.macroEnabled.12','xlsb':'application/vnd.ms-excel.sheet.binary.macroEnabled.12','xml':'application/xml','xpm':'image/x-xpixmap','xps':'application/vnd.ms-xpsdocument','xsl':'application/xml','xslt':'application/xslt+xml','xul':'application/vnd.mozilla.xul+xml','xwd':'image/x-xwindowdump','yaml':'application/x-yaml','Z':'application/x-compress','z':'application/x-compress','zip':'application/zip'};final bool A5=identical(1,1.0);class Zq{static Map<String,List<int>> aq={};static bool B5(String A){return aq.containsKey(A);}static List<int> C5(String A){return aq[A];}}Uint8List D5(String B){int C=B.length;Uint8List D=new Uint8List(C);for(int A=0;A<C;A++ ){int G=B.codeUnitAt(A);if(G>=128){return new Uint8List.fromList(const Utf8Encoder().convert(B));}D[A]=G;}return D;}abstract class Yq{}List<int> z4(A,{bool stateful: true}){if(stateful){if(YX==null){YX=new se();}YX.oL(A);return YX.done();}else{return const cq().oL(A);}}se YX;class bq{}class ue{}class cq{const cq();List<int> oL(A){if(A==null)return const[0xc0];else if(A==false)return const[0xc2];else if(A==true)return const[0xc3];else if(A is int)return fj(A);else if(A is String)return hj(A);else if(A is List)return JV(A);else if(A is Iterable)return JV(A.toList());else if(A is Map)return gj(A);else if(A is double)return dj(A);else if(A is ByteData)return cj(A);else if(A is Yq)return xAB(A);else if(A is bq)return A.data;else if(A is ue)return ej(A.value);throw new Exception("Failed to pack value: ${A}");}List<int> xAB(Yq A){return JV(A.toList());}List<int> cj(ByteData G){var B=G.elementSizeInBytes*G.lengthInBytes;if(B<=255){var A=new ByteData(B+2);A.setUint8(0,0xc4);A.setUint8(1,B);var D=2;for(var C=0;C<B;C++ ){A.setUint8(D,G.getUint8(C));D++ ;}return A.buffer.asUint8List();}else if(B<=65535){var A=new ByteData(B+3);A.setUint8(0,0xc5);A.setUint16(1,B);var D=3;for(var C=0;C<B;C++ ){A.setUint8(D,G.getUint8(C));D++ ;}return A.buffer.asUint8List();}else{var A=new ByteData(B+5);A.setUint8(0,0xc6);A.setUint32(1,B);var D=5;for(var C=0;C<B;C++ ){A.setUint8(D,G.getUint8(C));D++ ;}return A.buffer.asUint8List();}}List<int> fj(int B){if(B>=0&&B<128){var A=new Uint8List(1);A[0]=B;return A;}Uint8List A;if(B<0){if(B>=-32){A=new Uint8List(1);A[0]=0xe0+B+32;}else if(B>-0x80){A=new Uint8List(2);A[0]=0xd0;A[1]=B+0x100;}else if(B>-0x8000){A=new Uint8List(3);ZOB(B+0x10000,A,1);}else if(B>-0x80000000){A=new Uint8List(5);A[0]=0xd2;aOB(B+0x100000000,A,1);}else{A=new Uint8List(9);A[0]=0xd3;bOB(B,A,1);}}else{if(B<0x100){A=new Uint8List(2);A[0]=0xcc;A[1]=B;}else if(B<0x10000){A=new Uint8List(3);A[0]=0xcd;ZOB(B,A,1);}else if(B<0x100000000){A=new Uint8List(5);A[0]=0xce;aOB(B,A,1);}else{A=new Uint8List(9);A[0]=0xcf;bOB(B,A,1);}}return A;}List<int> ZOB(int B,[Uint8List A,int C=0]){if(A==null)A=new Uint8List(2);A[C]=(B>>8)&0xff;A[C+1]=B&0xff;return A;}Uint8List aOB(int B,[Uint8List A,int C=0]){if(A==null)A=new Uint8List(4);A[C]=(B>>24)&0xff;A[C+1]=(B>>16)&0xff;A[C+2]=(B>>8)&0xff;A[C+3]=B&0xff;return A;}List<int> bOB(int B,[Uint8List A,int C=0]){if(A==null)A=new Uint8List(8);A[C]=(B>>56)&0xff;A[C+1]=(B>>48)&0xff;A[C+2]=(B>>40)&0xff;A[C+3]=(B>>32)&0xff;A[C+4]=(B>>24)&0xff;A[C+5]=(B>>16)&0xff;A[C+6]=(B>>8)&0xff;A[C+7]=B&0xff;return A;}static const Utf8Encoder E5=const Utf8Encoder();List<int> hj(String C){List<int> B=[] ;List<int> A=E5.convert(C);if(A.length<32)B.add(0xa0|A.length);else if(A.length<256)B.addAll([0xd9,A.length]);else if(A.length<65536)B..add(0xda)..addAll(ZOB(A.length));else B..add(0xdb)..addAll(aOB(A.length));B.addAll(A);return B;}List<int> ej(double B){var A=new ByteData(4);A.setFloat32(0,B);return [0xca]..addAll(A.buffer.asUint8List());}List<int> dj(double B){var A=new ByteData(8);A.setFloat64(0,B);return [0xcb]..addAll(A.buffer.asUint8List());}List<int> JV(List A){List<int> B=[] ;if(A.length<16)B.add(0x90+A.length);else if(A.length<0x100)B..add(0xdc)..addAll(ZOB(A.length));else B..add(0xdd)..addAll(aOB(A.length));for(var C in A){B.addAll(oL(C));}return B;}List<int> gj(Map B){var A=<int>[] ;if(B.length<16){A.add(0x80+B.length);}else if(B.length<0x100){A.add(0xde);A.addAll(ZOB(B.length));}else{A.add(0xdf);A.addAll(aOB(B.length));}for(var C in B.keys){A.addAll(oL(C));A.addAll(oL(B[C]));}return A;}}class se{se();void oL(A){if(A is Iterable&&A is!List){A=A.toList();}if(A==null){write(0xc0);}else if(A==false){write(0xc2);}else if(A==true){write(0xc3);}else if(A is int){fj(A);}else if(A is String){hj(A);}else if(A is List){JV(A);}else if(A is Map){gj(A);}else if(A is double){dj(A);}else if(A is ue){ej(A);}else if(A is ByteData){cj(A);}else if(A is bq){writeAll(A.data);}else{throw new Exception("Failed to pack value: ${A}");}}void cj(ByteData A){var B=A.elementSizeInBytes*A.lengthInBytes;if(B<=255){write(0xc4);write(B);writeAll(A.buffer.asUint8List());}else if(B<=65535){write(0xc5);ZOB(B);writeAll(A.buffer.asUint8List());}else{write(0xc6);aOB(B);writeAll(A.buffer.asUint8List());}}void fj(int A){if(A>=0&&A<128){write(A);return;}if(A<0){if(A>=-32){write(0xe0+A+32);}else if(A>-0x80){write(0xd0);write(A+0x100);}else if(A>-0x8000){write(0xd1);ZOB(A+0x10000);}else if(A>-0x80000000){write(0xd2);aOB(A+0x100000000);}else{write(0xd3);bOB(A);}}else{if(A<0x100){write(0xcc);write(A);}else if(A<0x10000){write(0xcd);ZOB(A);}else if(A<0x100000000){write(0xce);aOB(A);}else{write(0xcf);bOB(A,true);}}}void ZOB(int A){write((A>>8)&0xff);write(A&0xff);}void aOB(int A){write((A>>24)&0xff);write((A>>16)&0xff);write((A>>8)&0xff);write(A&0xff);}void bOB(int A,[bool B=false]){if(A5&&B){write((A~/72057594037927936)&0xff);write((A~/281474976710656)&0xff);write((A~/1099511627776)&0xff);write((A~/4294967296)&0xff);}else{write((A>>56)&0xff);write((A>>48)&0xff);write((A>>40)&0xff);write((A>>32)&0xff);}write((A>>24)&0xff);write((A>>16)&0xff);write((A>>8)&0xff);write(A&0xff);}void hj(String B){List<int> A;if(Zq.B5(B)){A=Zq.C5(B);}else{A=D5(B);}if(A.length<0x20){write(0xa0+A.length);}else if(A.length<0x100){write(0xd9);write(A.length);}else if(A.length<0x10000){write(0xda);ZOB(A.length);}else{write(0xdb);aOB(A.length);}writeAll(A);}void dj(double B){write(0xcb);var A=new ByteData(8);A.setFloat64(0,B);writeAll(A);}void ej(ue B){write(0xca);var A=new ByteData(4);A.setFloat32(0,B.value);writeAll(A);}void JV(List B){var A=B.length;if(A<16){write(0x90+A);}else if(A<0x100){write(0xdc);ZOB(A);}else{write(0xdd);aOB(A);}for(var C in B){oL(C);}}void gj(Map A){if(A.length<16){write(0x80+A.length);}else if(A.length<0x100){write(0xde);ZOB(A.length);}else{write(0xdf);aOB(A.length);}for(var B in A.keys){oL(B);oL(A[B]);}}void writeAll(A){if(A is ByteData){for(var B=0;B<A.lengthInBytes;B++ ){write(A.getUint8(B));}}else if(A is List){for(var C in A){write(C);}}else{throw new Exception("I don't know how to write everything in ${A}");}}void write(int A){if(dR==null){dR=[] ;}if(list==null||sL>=list.length){if(list!=null){dR.add(new Uint8List.view(list.buffer,0,sL));}list=new Uint8List(64);sL=0;}list[sL]=A;sL++ ;Dj++ ;}Uint8List done(){if(list!=null&&sL!=0){dR.add(new Uint8List.view(list.buffer,0,sL));sL=0;}var A=new Uint8List(Dj);var B=0;for(var C in dR){for(var D in C){A[B]=D;B++ ;}}list=null;dR=null;Dj=0;sL=0;return A;}int sL=0;int Dj=0;Uint8List list;List<Uint8List> dR;}const int te=4294967295;class ve{ByteData data;int offset;ve(ByteBuffer A,[this.offset=0]){data=A.asByteData();}void reset(ByteBuffer A){data=A.asByteData();offset=0;}wa(){int A=data.getUint8(offset++ );if(A>=0xe0)return A-0x100;if(A<0xc0){if(A<0x80)return A;else if(A<0x90)return ya(A-0x80);else if(A<0xa0)return xa(A-0x90);else return za(A-0xa0);}switch (A){case 0xc0:return null;case 0xc2:return false;case 0xc3:return true;case 0xc4:return dk(A);case 0xc5:return dk(A);case 0xc6:return dk(A);case 0xcf:return tBB();case 0xce:return UN();case 0xcd:return Ab();case 0xcc:return pG();case 0xd3:return rBB();case 0xd2:return qBB();case 0xd1:return pBB();case 0xd0:return sBB();case 0xd9:return za(pG());case 0xda:return za(Ab());case 0xdb:return za(UN());case 0xdf:return ya(UN());case 0xde:return ya(Ab());case 0x80:return ya(pG());case 0xdd:return xa(UN());case 0xdc:return xa(Ab());case 0x90:return xa(pG());case 0xca:return oBB();case 0xcb:return nBB();}}ByteData dk(int C){int A;var B=0;if(C==0xc4){A=data.getUint8(offset);B=1;}else if(C==0xc5){A=data.getUint16(offset);B=2;}else if(C==0xc6){A=data.getUint32(offset);B=4;}else{throw new Exception("Bad Binary Type");}offset+= B;var G=new Uint8List(A);var D=0;for(var H=offset;D<A;H++ ){G[D]=data.getUint8(H);D++ ;}offset+= A;return G.buffer.asByteData();}double oBB(){var A=data.getFloat32(offset);offset+= 4;return A;}double nBB(){var A=new Uint8List.fromList(data.buffer.asUint8List(offset,8));offset+= 8;return A.buffer.asByteData().getFloat64(0);}int tBB(){var A=UN();var B=UN();return (A*(te+1))+B;}int UN(){var A=0;for(var B=0;B<4;B++ ){A=(A<<8)|pG();}return A;}int Ab(){var A=pG();A=A<<8;A|= pG();return A;}int pG(){return data.getUint8(offset++ );}int rBB(){var A=UN();var B=UN();if((A&0x80000000)!=0){A=cOB(A);B=cOB(B);return -((A*(te+1))+B+1);}else{return (A*(te+1))+B;}}int cOB(int A){A=~A;if(A<0){A=(A&0x7FFFFFFF)+0x80000000;}return A;}int qBB(){var D=[pG(),pG(),pG(),pG()];var G=(D[0]&0x40)!=0;var B=0;var J=0;var H=1;for(var C=3,I=1;C>=0;C-- ,I*= 256){var A=D[J+C];if(G){A=(A^0xff)+H;H=A>>8;A&= 0xff;}B+= A*I;}return G?-B:B;}int pBB(){var D=[pG(),pG()];var G=(D[0]&0x20)!=0;var B=0;var J=0;var H=1;for(var C=1,I=1;C>=0;C-- ,I*= 256){var A=D[J+C];if(G){A=(A^0xff)+H;H=A>>8;A&= 0xff;}B+= A*I;}return G?-B:B;}int sBB(){var D=[pG()];var G=(D[0]&0x10)!=0;var B=0;var J=0;var H=1;for(var C=0,I=1;C>=0;C-- ,I*= 256){var A=D[J+C];if(G){A=(A^0xff)+H;H=A>>8;A&= 0xff;}B+= A*I;}return G?-B:B;}String za(int A){String B=const Utf8Decoder().convert(new Uint8List.view(data.buffer,offset,A));offset+= A;return B;}Map ya(int C){Map A={};for(int B=0;B<C; ++B){A[wa()]=wa();}return A;}List xa(int C){List A=[] ;A.length=C;for(int B=0;B<C; ++B){A[B]=wa();}return A;}}class zp implements HttpHeaders{final Set<HttpHeaders> dOB;bool get chunkedTransferEncoding=>dOB.first.chunkedTransferEncoding;set chunkedTransferEncoding(bool A){for(var B in dOB){B.chunkedTransferEncoding=A;}}int get contentLength=>dOB.first.contentLength;set contentLength(int A){for(var B in dOB){B.contentLength=A;}}ContentType get contentType=>dOB.first.contentType;set contentType(ContentType A){for(var B in dOB){B.contentType=A;}}DateTime get date=>dOB.first.date;set date(DateTime A){for(var B in dOB){B.date=A;}}DateTime get expires=>dOB.first.expires;set expires(DateTime A){for(var B in dOB){B.expires=A;}}String get host=>dOB.first.host;set host(String A){for(var B in dOB){B.host=A;}}DateTime get ifModifiedSince=>dOB.first.ifModifiedSince;set ifModifiedSince(DateTime A){for(var B in dOB){B.ifModifiedSince=A;}}bool get persistentConnection=>dOB.first.persistentConnection;set persistentConnection(bool A){for(var B in dOB){B.persistentConnection=A;}}int get port=>dOB.first.port;set port(int A){for(var B in dOB){B.port=A;}}zp(Iterable<HttpHeaders> A):dOB=A.toSet();void add(String A,Object B){for(var C in dOB){C.add(A,B);}}void forEach(void A(String name,List<String> values))=>dOB.first.forEach(A);void noFolding(String A){for(var B in dOB){B.noFolding(A);}}void remove(String A,Object B){for(var C in dOB){C.remove(A,B);}}void removeAll(String A){for(var B in dOB){B.removeAll(A);}}void set(String A,Object B){for(var C in dOB){C.set(A,B);}}String value(String A)=>dOB.first.value(A);List<String> operator[](String A)=>dOB.first[A];void clear(){for(var A in dOB){A.clear();}}}class Tr extends af implements dQ{Tr(String A):super(A,()=>new Ur(A));}class Ur implements dQ,bf{final String path;Stream<cG> get nZ=>eOB.stream;final eOB=new StreamController<cG>.broadcast();Future get QV=>fOB.future;final fOB=new Completer();StreamSubscription gOB;Ur(this.path){hOB();fOB.complete();}void hOB(){gOB=new File(path).watch().transform(new Q6<FileSystemEvent>()).listen(iOB,onError:eOB.addError,onDone:jOB);}void iOB(List<FileSystemEvent> A){if(A.any((B)=>B.type==FileSystemEvent.DELETE)){return;}eOB.add(new cG(pJ.lX,path));}jOB()async{var A=await new File(path).exists();if(eOB.isClosed)return;if(A){eOB.add(new cG(pJ.lX,path));hOB();}else{eOB.add(new cG(pJ.Yr,path));close();}}void close(){if(gOB!=null)gOB.cancel();gOB=null;eOB.close();}}vE Vy(String A,String B,String C,String D,List<String> G,Map<String,String> H,I,Function J,RG K,{bool negatable,bool splitCommas,bool hide: false}){return new vE.WCB(A,B,C,D,G,H,I,J,K,negatable:negatable,splitCommas:splitCommas,hide:hide);}class vE{final String name;final String uM;final List<String> PU;final HF;final Function callback;final String ri;final String lk;final Map<String,String> IR;final RG type;final bool negatable;final bool Rx;final bool hide;bool get cL=>type==RG.Nl;bool get Cw=>type==RG.Rb;vE.WCB(this.name,this.uM,this.ri,this.lk,List<String> A,Map<String,String> B,this.HF,this.callback,RG C,{this.negatable,bool splitCommas,this.hide: false}):this.PU=A==null?null:new UnmodifiableListView(A),this.IR=B==null?null:new UnmodifiableMapView(B),this.type=C,this.Rx=splitCommas==null?C==RG.Rb:splitCommas{if(name.isEmpty){throw new ArgumentError('Name cannot be empty.');}else if(name.startsWith('-')){throw new ArgumentError('Name ${name} cannot start with "-".');}if(Ml.hasMatch(name)){throw new ArgumentError('Name "${name}" contains invalid characters.');}if(uM!=null){if(uM.length!=1){throw new ArgumentError('Abbreviation must be null or have length 1.');}else if(uM=='-'){throw new ArgumentError('Abbreviation cannot be "-".');}if(Ml.hasMatch(uM)){throw new ArgumentError('Abbreviation is an invalid character.');}}}dynamic iv(A){if(A!=null)return A;if(!Cw)return HF;if(HF!=null)return [HF];return [] ;}static final Ml=new RegExp(r'''[ \t\r\n"'\\/]''');}class RG{static const Nl=const RG.XCB("OptionType.FLAG");static const Wy=const RG.XCB("OptionType.SINGLE");static const Rb=const RG.XCB("OptionType.MULTIPLE");final String name;const RG.XCB(this.name);}final Xy=new RegExp(r'^-([a-zA-Z0-9])$');final Yy=new RegExp(r'^-([a-zA-Z0-9]+)(.*)$');final Zy=new RegExp(r'^--([a-zA-Z\-_0-9]+)(=(.*))?$');class yR{final String iu;final yR parent;final dH DK;final List<String> aE;final NK=<String>[] ;final Map<String,dynamic> wL=<String,dynamic>{};yR(this.iu,this.DK,this.aE,[this.parent,List<String> A]){if(A!=null)this.NK.addAll(A);}String get current=>aE[0];YK BE(){var D=aE.toList();var B=null;while(aE.length>0){if(current=='--'){aE.removeAt(0);break;}var C=DK.ju[current];if(C!=null){aH(NK.isEmpty,'Cannot specify arguments before a command.');var G=aE.removeAt(0);var H=new yR(G,C,aE,this,NK);B=H.BE();NK.clear();break;}if(sw())continue;if(pw(this))continue;if(kj())continue;if(!DK.Yu)break;NK.add(aE.removeAt(0));}DK.bD.forEach((I,A){if(A.callback==null)return;A.callback(A.iv(wL[I]));});NK.addAll(aE);aE.clear();return Uy(DK,wL,iu,B,NK,D);}void zw(vE A){aH(aE.length>0,'Missing argument for "${A.name}".');setOption(wL,A,current);aE.removeAt(0);}bool sw(){var B=Xy.firstMatch(current);if(B==null)return false;var A=DK.oZ(B[1]);if(A==null){aH(parent!=null,'Could not find an option or flag "-${B[1]}".');return parent.sw();}aE.removeAt(0);if(A.cL){da(wL,A,true);}else{zw(A);}return true;}bool pw(yR G){var A=Yy.firstMatch(current);if(A==null)return false;var B=A[1].substring(0,1);var D=DK.oZ(B);if(D==null){aH(parent!=null,'Could not find an option with short name "-${B}".');return parent.pw(G);}else if(!D.cL){var H='${A[1].substring(1)}${A[2]}';setOption(wL,D,H);}else{aH(A[2]=='','Option "-${B}" is a flag and cannot handle value ' '"${A[1].substring(1)}${A[2]}".');for(var C=0;C<A[1].length;C++ ){var B=A[1].substring(C,C+1);G.rw(B);}}aE.removeAt(0);return true;}void rw(String A){var B=DK.oZ(A);if(B==null){aH(parent!=null,'Could not find an option with short name "-${A}".');parent.rw(A);return;}aH(B.cL,'Option "-${A}" must be a flag to be in a collapsed "-".');da(wL,B,true);}bool kj(){var C=Zy.firstMatch(current);if(C==null)return false;var A=C[1];var B=DK.bD[A];if(B!=null){aE.removeAt(0);if(B.cL){aH(C[3]==null,'Flag option "${A}" should not be given a value.');da(wL,B,true);}else if(C[3]!=null){setOption(wL,B,C[3]);}else{zw(B);}}else if(A.startsWith('no-')){A=A.substring('no-'.length);B=DK.bD[A];if(B==null){aH(parent!=null,'Could not find an option named "${A}".');return parent.kj();}aE.removeAt(0);aH(B.cL,'Cannot negate non-flag option "${A}".');aH(B.negatable,'Cannot negate option "${A}".');da(wL,B,false);}else{aH(parent!=null,'Could not find an option named "${A}".');return parent.kj();}return true;}void aH(bool A,String B){if(!A)throw new FormatException(B);}void setOption(Map C,vE A,String B){assert(!A.cL);if(!A.Cw){kOB(A,B);C[A.name]=B;return;}var D=C.putIfAbsent(A.name,()=><String>[] );if(A.Rx){for(var G in B.split(",")){kOB(A,G);D.add(G);}}else{kOB(A,B);D.add(B);}}void da(Map B,vE A,bool C){assert(A.cL);B[A.name]=C;}void kOB(vE A,String B){if(A.PU==null)return;aH(A.PU.contains(B),'"${B}" is not an allowed value for option "${A.name}".');}}abstract class we{}class F5 implements we{var LK=new Random(new DateTime.now().millisecondsSinceEpoch);List<int> M$(int C){var A=new List<int>();for(var B=0;B<C;B++ ){A.add(LK.nextInt(256));}return A;}}class ZX{we Hx;aK hash;int lOB;int mOB;ZX({we saltGenerator,aK hash,int iterations: 1000,int keyLength: 32}){this.Hx=saltGenerator==null?new F5():saltGenerator;this.hash=hash==null?new ES():hash;this.lOB=iterations;this.mOB=keyLength;}bool S_(String A,String C){var D=IT.G5(A);var G=IT.H5(A);var H=IT.dq(D,C,hash,lOB,mOB);var B=-1;return H.every((I){B++ ;return G[B]==I;});}String qi(String A,{List<int> salt}){if(salt==null){salt=Hx.M$(32);}var B=IT.dq(salt,A,hash,lOB,mOB);return IT.I5(salt,B);}}class IT{static List<int> G5(String A){var B=int.parse(A.substring(0,3));var C=A.substring(3,3+B);return VG.wP(C);}static List<int> H5(String A){var B=int.parse(A.substring(0,3));var C=A.substring(3+B);return VG.wP(C);}static List<int> dq(List<int> A,String B,aK C,int D,int G){var H=new oq(hash:C);return H.L$(B,new String.fromCharCodes(A),D,G);}static String I5(List<int> C,List<int> D){var B=VG.gN(C);var G=VG.gN(D);var H=B.length;var A="${H}";while(A.length<3){A="0${A}";}return "${A}${B}${G}";}}final wD J5=new wD(style:VC.nJ);final wD eq=new wD(style:VC.uK);final wD jE=U5();VC get JT=>jE.MB;String get fq{var C=Uri.base;if(VC.Bf==VC.uK){return C.resolve('.').toString();}else{var A=C.toFilePath();int B=A.length-1;assert(A[B]=='/'||A[B]=='\\');return A.substring(0,B);}}String K5(String A,[String B,String C,String D,String G,String H,String I])=>jE.absolute(A,B,C,D,G,H,I);String mJ(String A)=>jE.wh(A);String L5(String A)=>jE.xh(A);String aX(String A)=>jE.o_(A);String xe(String A)=>jE.ai(A);bool ye(String A)=>jE.isAbsolute(A);String CB(String A,[String B,String C,String D,String G,String H,String I,String J])=>jE.join(A,B,C,D,G,H,I,J);String gq(Iterable<String> A)=>jE.Ew(A);List<String> hq(String A)=>jE.split(A);String M5(String A)=>jE.mL(A);String bX(String A,{String from})=>jE.uj(A,from:from);String N5(A)=>jE.Sv(A);Uri O5(String A)=>jE.hx(A);String iq(A)=>jE.CBB(A);const cX=0x2e;const bM=0x2f;const P5=0x3a;const Q5=0x41;const R5=0x5a;const S5=0x61;const T5=0x7a;const ze=0x5c;wD U5()=>new wD.IDB();class wD{factory wD({VC style,String current}){if(current==null){if(style==null){current=fq;}else{current=".";}}if(style==null){style=VC.Bf;}else if(style is!sK){throw new ArgumentError("Only styles defined by the path package are " "allowed.");}return new wD.JDB(style as sK,current);}wD.IDB():MB=VC.Bf as sK,nOB=null;wD.JDB(this.MB,this.nOB);final sK MB;final String nOB;String get current=>nOB!=null?nOB:fq;String get RJ=>MB.RJ;String absolute(String A,[String B,String C,String D,String G,String H,String I]){jq("absolute",[A,B,C,D,G,H,I]);if(B==null&&isAbsolute(A)&&!OG(A)){return A;}return join(current,A,B,C,D,G,H,I);}String wh(String A)=>oOB(A).wh;String xh(String A)=>oOB(A).xh;String o_(String B){var A=oOB(B);A.RV();if(A.bB.isEmpty)return A.ZB==null?'.':A.ZB;if(A.bB.length==1){return A.ZB==null?'.':A.ZB;}A.bB.removeLast();A.ME.removeLast();A.RV();return A.toString();}String ai(String A)=>oOB(A).ai;String VBB(String A)=>A.substring(0,MB.xL(A));bool isAbsolute(String A)=>MB.xL(A)>0;bool qU(String A)=>!this.isAbsolute(A);bool OG(String A)=>MB.OG(A);String join(String B,[String C,String D,String G,String H,String I,String J,String K]){var A=<String>[B,C,D,G,H,I,J,K];jq("join",A);return Ew(A.where((M)=>M!=null));}String Ew(Iterable<String> H){var B=new StringBuffer();var D=false;var G=false;for(var A in H.where((A)=>A!='')){if(this.OG(A)&&G){var C=oOB(A);C.ZB=this.VBB(B.toString());if(MB.eR(C.ZB)){C.ME[0]=MB.RJ;}B.clear();B.write(C.toString());}else if(this.isAbsolute(A)){G=!this.OG(A);B.clear();B.write(A);}else{if(A.length>0&&MB.aZ(A[0])){}else if(D){B.write(RJ);}B.write(A);}D=MB.eR(A);}return B.toString();}List<String> split(String B){var A=oOB(B);A.bB=A.bB.where((C)=>!C.isEmpty).toList();if(A.ZB!=null)A.bB.insert(0,A.ZB);return A.bB;}String mL(String A){if(!pOB(A))return A;var B=oOB(A);B.mL();return B.toString();}bool pOB(String I){var J=0;var D=I.codeUnits;var B;var A;var G=MB.xL(I);if(G!=0){J=G;A=bM;if(MB==VC.nJ){for(var C=0;C<G;C++ ){if(D[C]==bM)return true;}}}for(var C=J;C<D.length;C++ ){var H=D[C];if(MB.NF(H)){if(MB==VC.nJ&&H==bM)return true;if(A!=null&&MB.NF(A))return true;if(A==cX&&(B==null||B==cX||MB.NF(B))){return true;}}B=A;A=H;}if(A==null)return true;if(MB.NF(A))return true;if(A==cX&&(B==null||B==bM||B==cX)){return true;}return false;}String uj(String C,{String from}){if(from==null){from=current;}else if(this.qU(from)||this.OG(from)){from=this.join(current,from);}if(this.qU(from)&&this.isAbsolute(C)){return this.mL(C);}if(this.qU(C)||this.OG(C)){C=this.absolute(C);}if(this.qU(C)&&this.isAbsolute(from)){throw new Af('Unable to find a path to "${C}" from "${from}".');}var B=oOB(from)..mL();var A=oOB(C)..mL();if(B.bB.length>0&&B.bB[0]=='.'){return A.toString();}if(B.ZB!=A.ZB&&((B.ZB==null||A.ZB==null)||B.ZB.toLowerCase().replaceAll('/','\\')!=A.ZB.toLowerCase().replaceAll('/','\\'))){return A.toString();}while(B.bB.length>0&&A.bB.length>0&&B.bB[0]==A.bB[0]){B.bB.removeAt(0);B.ME.removeAt(1);A.bB.removeAt(0);A.ME.removeAt(1);}if(B.bB.length>0&&B.bB[0]=='..'){throw new Af('Unable to find a path to "${C}" from "${from}".');}A.bB.insertAll(0,new List.filled(B.bB.length,'..'));A.ME[0]='';A.ME.insertAll(1,new List.filled(B.bB.length,MB.RJ));if(A.bB.length==0)return '.';if(A.bB.length>1&&A.bB.last=='.'){A.bB.removeLast();A.ME..removeLast()..removeLast()..add('');}A.ZB='';A.RV();return A.toString();}String Sv(A){if(A is String)A=Uri.parse(A);return MB.KV(A);}Uri hx(String A){if(qU(A)){return MB.vj(A);}else{return MB.HU(join(current,A));}}String CBB(A){if(A is String)A=Uri.parse(A);if(A.scheme=='file'&&MB==VC.uK)return A.toString();if(A.scheme!='file'&&A.scheme!=''&&MB!=VC.uK){return A.toString();}var B=mL(Sv(A));var C=uj(B);return split(C).length>split(B).length?B:C;}tK oOB(String A)=>new tK.KDB(A,MB);}jq(String H,List<String> A){for(var B=1;B<A.length;B++ ){if(A[B]==null||A[B-1]!=null)continue;var C;for(C=A.length;C>=1;C-- ){if(A[C-1]!=null)break;}var D=new StringBuffer();D.write("${H}(");D.write(A.take(C).map((G)=>G==null?"null":'"${G}"').join(", "));D.write("): part ${B-1} was null, but part ${B} was not.");throw new ArgumentError(D.toString());}}abstract class sK extends VC{String get RJ;bool aZ(String A);bool NF(int A);bool eR(String A);int xL(String A);String lv(String A){var B=xL(A);if(B>0)return A.substring(0,B);return OG(A)?A[0]:null;}bool OG(String A);String KV(Uri A);Uri vj(String A){var B=context.split(A);if(NF(A.codeUnitAt(A.length-1)))B.add('');return new Uri(pathSegments:B);}Uri HU(String A);}class tK{sK MB;String ZB;bool OG;List<String> bB;List<String> ME;String get ai=>qOB()[1];bool get isAbsolute=>ZB!=null;factory tK.KDB(String A,sK D){var H=D.lv(A);var J=D.OG(A);if(H!=null)A=A.substring(H.length);var I=<String>[] ;var G=<String>[] ;var B=0;if(A.isNotEmpty&&D.NF(A.codeUnitAt(0))){G.add(A[0]);B=1;}else{G.add('');}for(var C=B;C<A.length;C++ ){if(D.NF(A.codeUnitAt(C))){I.add(A.substring(B,C));G.add(A[C]);B=C+1;}}if(B<A.length){I.add(A.substring(B));G.add('');}return new tK.LDB(D,H,J,I,G);}tK.LDB(this.MB,this.ZB,this.OG,this.bB,this.ME);String get wh{var A=this.xM();A.RV();if(A.bB.isEmpty)return ZB==null?'':ZB;return A.bB.last;}String get xh=>qOB()[0];bool get pi=>!bB.isEmpty&&(bB.last==''||ME.last!='');void RV(){while(!bB.isEmpty&&bB.last==''){bB.removeLast();ME.removeLast();}if(ME.length>0)ME[ME.length-1]='';}void mL(){var C=0;var A=<String>[] ;for(var B in bB){if(B=='.'||B==''){}else if(B=='..'){if(A.length>0){A.removeLast();}else{C++ ;}}else{A.add(B);}}if(!isAbsolute){A.insertAll(0,new List.filled(C,'..'));}if(A.length==0&&!isAbsolute){A.add('.');}var D=new List<String>.generate(A.length,(G)=>MB.RJ,growable:true);D.insert(0,isAbsolute&&A.length>0&&MB.eR(ZB)?MB.RJ:'');bB=A;ME=D;if(ZB!=null&&MB==VC.nJ){ZB=ZB.replaceAll('/','\\');}RV();}String toString(){var A=new StringBuffer();if(ZB!=null)A.write(ZB);for(var B=0;B<bB.length;B++ ){A.write(ME[B]);A.write(bB[B]);}A.write(ME.last);return A.toString();}List<String> qOB(){var A=bB.lastWhere((C)=>C!='',orElse:()=>null);if(A==null)return ['',''];if(A=='..')return ['..',''];var B=A.lastIndexOf('.');if(B<=0)return [A,''];return [A.substring(0,B),A.substring(B)];}tK xM()=>new tK.LDB(MB,ZB,OG,new List.from(bB),new List.from(ME));}class Af implements Exception{String message;Af(this.message);String toString()=>"PathException: ${message}";}abstract class VC{static final VC kq=new lq();static final VC nJ=new nq();static final VC uK=new mq();static final VC Bf=V5();static VC V5(){if(Uri.base.scheme!='file')return VC.uK;if(!Uri.base.path.endsWith('/'))return VC.uK;if(new Uri(path:'a/b').toFilePath()=='a\\b')return VC.nJ;return VC.kq;}String get name;wD get context=>new wD(style:this);String get RJ;String lv(String A);String KV(Uri A);Uri vj(String A);Uri HU(String A);String toString()=>name;}class lq extends sK{lq();final name='posix';final RJ='/';final ME=const['/'];final Lx=new RegExp(r'/');final Yw=new RegExp(r'[^/]$');final Gx=new RegExp(r'^/');final Ax=null;bool aZ(String A)=>A.contains('/');bool NF(int A)=>A==bM;bool eR(String A)=>A.isNotEmpty&&!NF(A.codeUnitAt(A.length-1));int xL(String A){if(A.isNotEmpty&&NF(A.codeUnitAt(0)))return 1;return 0;}bool OG(String A)=>false;String KV(Uri A){if(A.scheme==''||A.scheme=='file'){return Uri.decodeComponent(A.path);}throw new ArgumentError("Uri ${A} must have scheme 'file:'.");}Uri HU(String B){var A=new tK.KDB(B,this);if(A.bB.isEmpty){A.bB.addAll(["",""]);}else if(A.pi){A.bB.add("");}return new Uri(scheme:'file',pathSegments:A.bB);}}class mq extends sK{mq();final name='url';final RJ='/';final ME=const['/'];final Lx=new RegExp(r'/');final Yw=new RegExp(r"(^[a-zA-Z][-+.a-zA-Z\d]*://|[^/])$");final Gx=new RegExp(r"[a-zA-Z][-+.a-zA-Z\d]*://[^/]*");final Ax=new RegExp(r"^/");bool aZ(String A)=>A.contains('/');bool NF(int A)=>A==bM;bool eR(String A){if(A.isEmpty)return false;if(!NF(A.codeUnitAt(A.length-1)))return true;return A.endsWith("://")&&xL(A)==A.length;}int xL(String A){if(A.isEmpty)return 0;if(NF(A.codeUnitAt(0)))return 1;var B=A.indexOf("/");if(B>0&&A.startsWith('://',B-1)){B=A.indexOf('/',B+2);if(B>0)return B;return A.length;}return 0;}bool OG(String A)=>A.isNotEmpty&&NF(A.codeUnitAt(0));String KV(Uri A)=>A.toString();Uri vj(String A)=>Uri.parse(A);Uri HU(String A)=>Uri.parse(A);}class nq extends sK{nq();final name='windows';final RJ='\\';final ME=const['/','\\'];final Lx=new RegExp(r'[/\\]');final Yw=new RegExp(r'[^/\\]$');final Gx=new RegExp(r'^(\\\\[^\\]+\\[^\\/]+|[a-zA-Z]:[/\\])');final Ax=new RegExp(r"^[/\\](?![/\\])");bool aZ(String A)=>A.contains('/');bool NF(int A)=>A==bM||A==ze;bool eR(String A){if(A.isEmpty)return false;return !NF(A.codeUnitAt(A.length-1));}int xL(String A){if(A.isEmpty)return 0;if(A.codeUnitAt(0)==bM)return 1;if(A.codeUnitAt(0)==ze){if(A.length<2||A.codeUnitAt(1)!=ze)return 1;var B=A.indexOf('\\',2);if(B>0){B=A.indexOf('\\',B+1);if(B>0)return B;}return A.length;}if(A.length<3)return 0;if(!W5(A.codeUnitAt(0)))return 0;if(A.codeUnitAt(1)!=P5)return 0;if(!NF(A.codeUnitAt(2)))return 0;return 3;}bool OG(String A)=>xL(A)==1;String KV(Uri A){if(A.scheme!=''&&A.scheme!='file'){throw new ArgumentError("Uri ${A} must have scheme 'file:'.");}var B=A.path;if(A.host==''){if(B.startsWith('/'))B=B.replaceFirst("/","");}else{B='\\\\${A.host}${B}';}return Uri.decodeComponent(B.replaceAll("/","\\"));}Uri HU(String C){var A=new tK.KDB(C,this);if(A.ZB.startsWith(r'\\')){var B=A.ZB.split('\\').where((D)=>D!='');A.bB.insert(0,B.last);if(A.pi){A.bB.add("");}return new Uri(scheme:'file',host:B.first,pathSegments:A.bB);}else{if(A.bB.length==0||A.pi){A.bB.add("");}A.bB.insert(0,A.ZB.replaceAll("/","").replaceAll("\\",""));return new Uri(scheme:'file',pathSegments:A.bB);}}}bool W5(int A)=>(A>=Q5&&A<=R5)||(A>=S5&&A<=T5);final f5=new RegExp(r'^' r'(\d+).(\d+).(\d+)' r'(-([0-9A-Za-z-]+(\.[0-9A-Za-z-]+)*))?' r'(\+([0-9A-Za-z-]+(\.[0-9A-Za-z-]+)*))?');final g5=new RegExp(f5.pattern+r'$');class oq{aK hash;List<int> RU=new List<int>(4);oq({aK this.hash});List<int> L$(String J,String K,int M,int B){var H=hash.newInstance();H.add([1,2,3]);var C=H.close().length;if(B>((2<<31)-1)*C){throw "derived key too long";}var D=(B/C).ceil();var O=B-(D-1)*C;var G=[] ;for(var A=1;A<=D;A++ ){var I=rOB(J,K,M,A);if(A<D){G.addAll(I);}else{G.addAll(I.sublist(0,O));}}return G;}List<int> rOB(String C,String I,int J,int K){var A=new vP(hash,C.codeUnits);A.add(I.codeUnits);sOB(A,K);var B=A.close();var D=B;for(var G=1;G<J;G++ ){A=new vP(hash,C.codeUnits);A.add(B);var H=A.close();tOB(D,H);B=H;}return D;}sOB(vP B,int A){RU[0]=A>>24;RU[1]=A>>16;RU[2]=A>>8;RU[3]=A;B.add(RU);}tOB(List<int> B,List<int> C){for(var A=0;A<B.length;A++ ){B[A]=B[A]^C[A];}}}class Cf extends oI{final Function uOB;Cf(A,this.uOB):super(A);JD aC(IE B){var A=vOB.aC(B);if(A.eL){return A.DE(uOB(A.value));}else{return A;}}bool MF(o A){return A is Cf&&super.MF(A)&&uOB==A.uOB;}}class pq extends oI{o wOB;o xOB;pq(A,this.wOB,this.xOB):super(A);JD aC(IE C){var A=C;do{A=wOB.aC(A);}while((A as JD).eL);var B=vOB.aC(A);if(B.vO){return B;}A=B;do{A=xOB.aC(A);}while((A as JD).eL);return A.DE(B.value);}List<o> get R=>[vOB,wOB,xOB];void replace(o A,o B){super.replace(A,B);if(wOB==A){wOB=B;}if(xOB==A){xOB=B;}}}class uq extends oI{uq(A):super(A);JD aC(IE A){var B=vOB.aC(A);if(B.eL){var C=A.buffer is String?A.buffer.substring(A.position,B.position):A.buffer.sublist(A.position,B.position);return B.DE(C);}else{return B;}}}class zq extends oI{zq(A):super(A);JD aC(IE B){var A=vOB.aC(B);if(A.eL){var C=new NO(A.value,B.buffer,B.position,A.position);return A.DE(C);}else{return A;}}}class ZQ extends o{final vK yOB;final String zOB;ZQ(this.yOB,this.zOB);JD aC(IE A){var C=A.buffer;var B=A.position;if(B<C.length&&yOB.test(C.codeUnitAt(B))){return A.DE(C[B],B+1);}return A.aL(zOB);}String toString()=>'${super.toString()}[${zOB}]';bool MF(o A){return A is ZQ&&super.MF(A)&&yOB==A.yOB&&zOB==A.zOB;}}abstract class vK{}class rq implements vK{final vK uw;rq(this.uw);bool test(int A)=>!uw.test(A);}vK Z5(Iterable<aQ> J){var H=new List.from(J,growable:false);H.sort((C,D){return C.start!=D.start?C.start-D.start:C.stop-D.stop;});var A=new List();for(var B in H){if(A.isEmpty){A.add(B);}else{var I=A.last;if(I.stop+1>=B.start){var K=new aQ(I.start,B.stop);A[A.length-1]=K;}else{A.add(B);}}}if(A.length==1){return A[0].start==A[0].stop?new Of(A[0].start):A[0];}else{return new Dr(A.length,A.map((G)=>G.start).toList(growable:false) as List<int>,A.map((G)=>G.stop).toList(growable:false) as List<int>);}}o uB(A,[String B]){return new ZQ(new Of(NT(A)),B!=null?B:'"${A}" expected');}class Of implements vK{final int value;const Of(this.value);bool test(int A)=>identical(this.value,A);}o dX([String A]){return new ZQ(a5,A!=null?A:'digit expected');}class Ar implements vK{const Ar();bool test(int A)=>48<=A&&A<=57;}const a5=const Ar();o Cr(String A,[String B]){return new ZQ(c5.BE(A).value,B!=null?B:'[${A}] expected');}o b5(){var B=cM().map((A)=>new aQ(NT(A),NT(A)));var C=cM().IP(uB('-')).IP(cM()).map((A)=>new aQ(NT(A[0]),NT(A[2])));var D=C.IK(B).Va().map((A)=>Z5(A as Iterable<aQ>));return uB('^').HK().IP(D).map((A)=>A[0]==null?A[1]:new rq(A[1]));}final c5=b5();class Dr implements vK{final int length;final List<int> Tx;final List<int> Wx;Dr(this.length,this.Tx,this.Wx);bool test(int D){var A=0;var B=length;while(A<B){var C=A+((B-A)>>1);var G=Tx[C]-D;if(G==0){return true;}else if(G<0){A=C+1;}else{B=C;}}return 0<A&&D<=Wx[A-1];}}class aQ implements vK{final int start;final int stop;aQ(this.start,this.stop);bool test(int A)=>start<=A&&A<=stop;}o d5([String A]){return new ZQ(e5,A!=null?A:'whitespace expected');}class Er implements vK{const Er();bool test(int A){if(A<256){return A==0x09||A==0x0A||A==0x0B||A==0x0C||A==0x0D||A==0x20||A==0x85||A==0xA0;}else{return A==0x1680||A==0x180E||A==0x2000||A==0x2001||A==0x2002||A==0x2003||A==0x2004||A==0x2005||A==0x2006||A==0x2007||A==0x2008||A==0x2009||A==0x200A||A==0x2028||A==0x2029||A==0x202F||A==0x205F||A==0x3000||A==0xFEFF;}}}const e5=const Er();int NT(A){if(A is num){return A.round();}var B=A.toString();if(B.length!=1){throw new ArgumentError('${B} is not a character');}return B.codeUnitAt(0);}class oI extends o{o vOB;oI(this.vOB);JD aC(IE A){return vOB.aC(A);}List<o> get R=>[vOB];void replace(o A,o B){super.replace(A,B);if(vOB==A){vOB=B;}}}class Ff extends oI{final String zOB;Ff(A,this.zOB):super(A);JD aC(IE B){var A=vOB.aC(B);if(A.vO||A.position==A.buffer.length){return A;}return A.aL(zOB,A.position);}String toString()=>'${super.toString()}[${zOB}]';bool MF(o A){return A is Ff&&super.MF(A)&&zOB==A.zOB;}}class tq extends oI{tq(A):super(A);JD aC(IE B){var A=vOB.aC(B);if(A.eL){return B.DE(A.value);}else{return A;}}}class Kf extends oI{final String zOB;Kf(A,this.zOB):super(A);JD aC(IE A){var B=vOB.aC(A);if(B.vO){return A.DE(null);}else{return A.aL(zOB);}}String toString()=>'${super.toString()}[${zOB}]';bool MF(o A){return A is Kf&&super.MF(A)&&zOB==A.zOB;}}class Mf extends oI{final APB;Mf(A,this.APB):super(A);JD aC(IE A){var B=vOB.aC(A);if(B.eL){return B;}else{return A.DE(APB);}}bool MF(o A){return A is Mf&&super.MF(A)&&APB==A.APB;}}abstract class Nf extends o{final List<o> BPB;Nf(this.BPB);List<o> get R=>BPB;void replace(o B,o C){super.replace(B,C);for(var A=0;A<BPB.length;A++ ){if(BPB[A]==B){BPB[A]=C;}}}}class MT extends Nf{factory MT(Iterable<o> A){return new MT.MDB(new List.from(A,growable:false));}MT.MDB(List<o> A):super(A);JD aC(IE C){var A;for(var B=0;B<BPB.length;B++ ){A=BPB[B].aC(C);if(A.eL){return A;}}return A;}o IK(o A){return new MT(new List()..addAll(BPB)..add(A));}}class OO extends Nf{factory OO(Iterable<o> A){return new OO.NDB(new List.from(A,growable:false));}OO.NDB(List<o> A):super(A);JD aC(IE G){var C=G;var D=new List(BPB.length);for(var A=0;A<BPB.length;A++ ){var B=BPB[A].aC(C);if(B.vO){return B;}D[A]=B.value;C=B;}return C.DE(D);}o IP(o A){return new OO(new List()..addAll(BPB)..add(A));}}class IE{const IE(this.buffer,this.position);final buffer;final int position;JD DE(B,[int A]){return new sq(buffer,A==null?this.position:A,B);}JD aL(String B,[int A]){return new Hf(buffer,A==null?this.position:A,B);}String toString()=>'Context[${ra()}]';String ra()=>NO.xq(buffer,position);}abstract class JD extends IE{const JD(A,B):super(A,B);bool get eL=>false;bool get vO=>false;get value;String get message;}class sq extends JD{const sq(A,B,this.value):super(A,B);bool get eL=>true;final value;String get message=>null;String toString()=>'Success[${ra()}]: ${value}';}class Hf extends JD{const Hf(A,B,this.message):super(A,B);bool get vO=>true;get value=>throw new vq(this);final String message;String toString()=>'Failure[${ra()}]: ${message}';}class vq extends Error{final Hf aL;vq(this.aL);String toString()=>'${aL.message} at ${aL.ra()}';}abstract class Jf{const Jf();o start();o r(Function A,[B,C,D,G,H,I]){var J=[B,C,D,G,H,I].takeWhile((K)=>K!=null).toList(growable:false);return new oJ(A,J);}o MI({Function start: null,List arguments: const[] }){return CPB(new oJ(start!=null?start:this.start,arguments));}o CPB(oJ C){var H=new Map();o I(oJ C){var A=H[C];if(A==null){var D=[C];A=C.resolve();while(A is oJ){if(D.contains(A)){throw new StateError('Recursive references detected: ${D}');}D.add(A);A=A.resolve();}for(var O in D){H[O]=A;}}return A;}var G=[I(C)];var J=new Set.from(G);while(G.isNotEmpty){var K=G.removeLast();for(var B in K.R){if(B is oJ){var M=I(B);K.replace(B,M);B=M;}if(!J.contains(B)){J.add(B);G.add(B);}}}return H[C];}}class Br extends oI{Br(Jf A):super(A.MI());}class oJ extends o{final Function function;final List arguments;oJ(this.function,this.arguments);o resolve()=>Function.apply(function,arguments);bool operator==(A){if(A is!oJ||A.function!=function||A.arguments.length!=arguments.length){return false;}for(var B=0;B<arguments.length;B++ ){var C=arguments[B],D=A.arguments[B];if(C is o&&C is!oJ&&D is o&&D is!oJ){if(!C.Bw(D)){return false;}}else{if(C!=D){return false;}}}return true;}int get hashCode=>function.hashCode;JD aC(IE A)=>throw new UnsupportedError('References cannot be parsed.');}abstract class o{JD aC(IE A);JD BE(A){return aC(new IE(A,0));}Iterable kD(B){var A=new List();kO().map((C)=>A.add(C)).IP(cM()).IK(cM()).SK().BE(B);return A;}Iterable PAB(B){var A=new List();map((C)=>A.add(C)).IK(cM()).SK().BE(B);return A;}o HK([A])=>new Mf(this,A);o SK()=>aa(0,KT);o Va()=>aa(1,KT);o aa(int A,int B){return new qq(this,A,B);}o qa(int A)=>aa(A,A);o IP(o A)=>new OO([this,A]);o operator&(o A)=>this.IP(A);o IK(o A)=>new MT([this,A]);o operator|(o A)=>this.IK(A);o kO()=>new tq(this);o BP([String A])=>new Kf(this,A);o Rj([String A])=>BP(A).IP(cM()).rL(1);o di()=>new uq(this);o token()=>new zq(this);o trim([o A,o B]){if(A==null)A=d5();if(B==null)B=A;return new pq(this,A,B);}o end([String A='end of input expected']){return new Ff(this,A);}o map(Function A)=>new Cf(this,A);o rL(int A){return this.map((List B){return B[A<0?B.length+A:A];});}o ABB(List<int> C){return this.map((List B){return C.map((A){return B[A<0?B.length+A:A];}).toList();});}o VV(o B,{bool includeSeparators: true,bool optionalSeparatorAtEnd: false}){var D=new OO([B,this]).SK();var H=new OO(optionalSeparatorAtEnd?[this,D,B.HK(B)]:[this,D]);return H.map((List C){var A=new List();A.add(C[0]);for(var G in C[1]){if(includeSeparators){A.add(G[0]);}A.add(G[1]);}if(includeSeparators&&optionalSeparatorAtEnd&&!identical(C[2],B)){A.add(C[2]);}return A;});}bool Bw(o B,[Set<o> A]){if(A==null){A=new Set();}if(this==B||A.contains(this)){return true;}A.add(this);return runtimeType==B.runtimeType&&MF(B)&&d$(B,A);}bool MF(o A)=>true;bool d$(o D,Set<o> G){var B=R,C=D.R;if(B.length!=C.length){return false;}for(var A=0;A<B.length;A++ ){if(!B[A].Bw(C[A],G)){return false;}}return true;}List<o> get R=>const[] ;void replace(o A,o B){}}o cM([String A='input expected']){return new Ef(A);}class Ef extends o{final String zOB;Ef(this.zOB);JD aC(IE A){var B=A.position;var C=A.buffer;return B<C.length?A.DE(C[B],B+1):A.aL(zOB);}bool MF(o A){return A is Ef&&super.MF(A)&&zOB==A.zOB;}}o Gf(A,[String B]){return yq(1,(C)=>A.indexOf(C)>=0,B!=null?B:'any of ${A} expected');}o LT(String A,[String B]){return yq(A.length,(String C)=>A==C,B!=null?B:'${A} expected');}typedef bool wq(_0);o yq(int A,wq B,String C){return new Lf(A,B,C);}class Lf extends o{final int DPB;final wq yOB;final String zOB;Lf(this.DPB,this.yOB,this.zOB);JD aC(IE A){final C=A.position;final B=C+DPB;if(B<=A.buffer.length){var D=A.buffer is String?A.buffer.substring(C,B):A.buffer.sublist(C,B);if(yOB(D)){return A.DE(D,B);}}return A.aL(zOB);}String toString()=>'${super.toString()}[${zOB}]';bool MF(o A){return A is Lf&&super.MF(A)&&DPB==A.DPB&&yOB==A.yOB&&zOB==A.zOB;}}const int KT=-1;abstract class Df extends oI{final int EPB;final int FPB;Df(o A,this.EPB,this.FPB):super(A){assert(0<=EPB);assert(FPB==KT||EPB<=FPB);}String toString(){var A=FPB==KT?'*':FPB;return '${super.toString()}[${EPB}..${A}]';}bool MF(o A){return A is Df&&super.MF(A)&&EPB==A.EPB&&FPB==A.FPB;}}class qq extends Df{qq(o A,int B,int C):super(A,B,C);JD aC(IE D){var B=D;var C=new List();while(C.length<EPB){var A=vOB.aC(B);if(A.vO){return A;}C.add(A.value);B=A;}while(FPB==KT||C.length<FPB){var A=vOB.aC(B);if(A.vO){return B.DE(C);}C.add(A.value);B=A;}return B.DE(C);}}class NO{final value;final buffer;final int start;final int stop;const NO(this.value,this.buffer,this.start,this.stop);get input=>buffer is String?buffer.substring(start,stop):buffer.sublist(start,stop);int get length=>stop-start;int get HD=>NO.If(buffer,start)[0];int get RC=>NO.If(buffer,start)[1];String toString()=>'Token[${xq(buffer,start)}]: ${value}';bool operator==(A){return A is NO&&value==A.value&&start==A.start&&stop==A.stop;}int get hashCode=>value.hashCode+start.hashCode+stop.hashCode;static o X5()=>Y5;static final o Y5=uB('\n')|(uB('\r')&uB('\n').HK());static List<int> If(String G,int A){var B=1,C=0;for(var D in X5().token().PAB(G)){if(A<D.stop){return [B,A-C+1];}B++ ;C=D.stop;}return [B,A-C+1];}static String xq(A,int B){if(A is String){var C=NO.If(A,B);return '${C[0]}:${C[1]}';}else{return '${B}';}}}class Vr extends af implements dQ{Vr(String A,{Duration pollingDelay}):super(A,(){return new Wr(A,pollingDelay!=null?pollingDelay:new Duration(seconds:1));});}class Wr implements dQ,bf{final String path;Stream<cG> get nZ=>GPB.stream;final GPB=new StreamController<cG>.broadcast();Future get QV=>HPB.future;final HPB=new Completer();Timer IPB;DateTime JPB;Wr(this.path,Duration A){IPB=new Timer.periodic(A,(B)=>KPB());KPB();}Future KPB()async{var B=await new File(path).exists();if(GPB.isClosed)return;if(JPB!=null&&!B){GPB.add(new cG(pJ.Yr,path));close();return;}var A;try {try {A=await P6(path);}finally {if(GPB.isClosed)return;}}on FileSystemException catch (C,D){GPB.addError(C,D);close();return;}if(JPB==A)return;if(JPB==null){JPB=A;HPB.complete();}else{JPB=A;GPB.add(new cG(pJ.lX,path));}}void close(){IPB.cancel();GPB.close();}}class Bm<XB> extends Object with ListMixin<XB> implements Queue<XB>{static const int Cm=8;List<XB> LPB;int MPB;int NPB;Bm([int A]):MPB=0,NPB=0{if(A==null||A<Cm){A=Cm;}else if(!Dm(A)){A=Em(A);}assert(Dm(A));LPB=new List<XB>(A);}void add(XB A){OPB(A);}void addAll(Iterable<XB> G){if(G is List){var B=G;int A=B.length;int C=this.length;if(C+A>=LPB.length){PPB(C+A);LPB.setRange(C,C+A,B,0);NPB+= A;}else{int D=LPB.length-NPB;if(A<D){LPB.setRange(NPB,NPB+A,B,0);NPB+= A;}else{int H=A-D;LPB.setRange(NPB,NPB+D,B,0);LPB.setRange(0,H,B,D);NPB=H;}}}else{for(XB I in G)OPB(I);}}String toString()=>IterableBase.iterableToFullString(this,"{","}");void addLast(XB A){OPB(A);}void addFirst(XB A){MPB=(MPB-1)&(LPB.length-1);LPB[MPB]=A;if(MPB==NPB)QPB();}XB removeFirst(){if(MPB==NPB)throw new StateError("No element");XB A=LPB[MPB];LPB[MPB]=null;MPB=(MPB+1)&(LPB.length-1);return A;}XB removeLast(){if(MPB==NPB)throw new StateError("No element");NPB=(NPB-1)&(LPB.length-1);XB A=LPB[NPB];LPB[NPB]=null;return A;}int get length=>(NPB-MPB)&(LPB.length-1);void set length(int A){if(A<0)throw new RangeError("Length ${A} may not be negative.");int C=A-length;if(C>=0){if(LPB.length<=A){PPB(A);}NPB=(NPB+C)&(LPB.length-1);return;}int B=NPB+C;if(B>=0){LPB.fillRange(B,NPB,null);}else{B+= LPB.length;LPB.fillRange(0,NPB,null);LPB.fillRange(B,LPB.length,null);}NPB=B;}XB operator[](int A){if(A<0||A>=length){throw new RangeError("Index ${A} must be in the range [0..${length}).");}return LPB[(MPB+A)&(LPB.length-1)];}void operator[]=(int A,XB B){if(A<0||A>=length){throw new RangeError("Index ${A} must be in the range [0..${length}).");}LPB[(MPB+A)&(LPB.length-1)]=B;}static bool Dm(int A)=>(A&(A-1))==0;static int Em(int A){assert(A>0);A=(A<<1)-1;for(;;){int B=A&(A-1);if(B==0)return A;A=B;}}void OPB(XB A){LPB[NPB]=A;NPB=(NPB+1)&(LPB.length-1);if(MPB==NPB)QPB();}void QPB(){List<XB> A=new List<XB>(LPB.length*2);int B=LPB.length-MPB;A.setRange(0,B,LPB,MPB);A.setRange(B,B+MPB,LPB,0);MPB=0;NPB=LPB.length;LPB=A;}int RPB(List<XB> A){assert(A.length>=length);if(MPB<=NPB){int C=NPB-MPB;A.setRange(0,C,LPB,MPB);return C;}else{int B=LPB.length-MPB;A.setRange(0,B,LPB,MPB);A.setRange(B,B+NPB,LPB,0);return NPB+B;}}void PPB(int A){assert(A>=length);A+= A>>1;int C=Em(A);List<XB> B=new List<XB>(C);NPB=RPB(B);LPB=B;MPB=0;}}abstract class bQ<XE,jC> implements Map<XE,jC>{factory bQ()=>new fX();}class fX<XE,jC> implements bQ<XE,jC>{final Map<XE,jC> SPB;final Map<jC,XE> TPB;bQ<jC,XE> UPB;fX():this.QDB(new HashMap(),new HashMap());fX.QDB(this.SPB,this.TPB);jC operator[](Object A)=>SPB[A];void operator[]=(XE A,jC B){VPB(A,B,false);}void replace(XE A,jC B){VPB(A,B,true);}void addAll(Map<XE,jC> A)=>A.forEach((B,C)=>VPB(B,C,false));bool containsKey(Object A)=>SPB.containsKey(A);bool containsValue(Object A)=>TPB.containsKey(A);void forEach(void A(XE key,jC value))=>SPB.forEach(A);bool get isEmpty=>SPB.isEmpty;bool get isNotEmpty=>SPB.isNotEmpty;Iterable<XE> get keys=>SPB.keys;int get length=>SPB.length;Iterable<jC> get values=>TPB.keys;bQ<jC,XE> get o${if(UPB==null){UPB=new fX.QDB(TPB,SPB);}return UPB;}jC putIfAbsent(XE A,jC C()){var B=SPB[A];if(B!=null)return B;if(!SPB.containsKey(A))return VPB(A,C(),false);return null;}jC remove(Object A){TPB.remove(SPB[A]);return SPB.remove(A);}void clear(){SPB.clear();TPB.clear();}jC VPB(XE B,jC A,bool D){if(B==null)throw new ArgumentError("null key");if(A==null)throw new ArgumentError("null value");var C=SPB[B];if(C==A)return A;if(TPB.containsKey(A)){if(!D)throw new ArgumentError("Mapping for ${A} exists");SPB.remove(TPB[A]);}TPB.remove(C);SPB[B]=A;TPB[A]=B;return A;}}Iterable i5(Iterable<Iterable> A)=>A.expand((B)=>B);typedef bf N6();abstract class af implements cf{final N6 WPB;final String path;Stream<cG> get nZ=>XPB.stream;StreamController<cG> XPB;Future get QV=>YPB.future;var YPB=new Completer();af(this.path,this.WPB){var A;var B;XPB=new StreamController<cG>.broadcast(onListen:(){A=WPB();B=A.nZ.listen(XPB.add,onError:XPB.addError,onDone:XPB.close);A.QV.then(YPB.complete);},onCancel:(){B.cancel();A.close();YPB=new Completer();},sync:true);}}abstract class bf implements cf{}abstract class qD implements Comparable<qD>{factory qD(GH A,GH B,String C)=>new Rf(A,B,C);}class Rf extends Jr{final GH start;final GH end;final String PD;Rf(this.start,this.end,this.PD){if(end.JC!=start.JC){throw new ArgumentError("Source URLs \"${start.JC}\" and " " \"${end.JC}\" don't match.");}else if(end.offset<start.offset){throw new ArgumentError('End ${end} must come after start ${start}.');}else if(PD.length!=start.yu(end)){throw new ArgumentError('Text "${PD}" must be ${start.yu(end)} ' 'characters long.');}}}class Ir implements Exception{String get message=>ZPB;final String ZPB;qD get c=>aPB;final qD aPB;Ir(this.ZPB,this.aPB);String toString({color}){if(c==null)return message;return "Error on "+c.message(message,color:color);}}class Sf extends Ir implements FormatException{dynamic get source=>bPB;final bPB;int get offset=>c==null?null:c.start.offset;Sf(String A,qD B,[this.bPB]):super(A,B);}abstract class Jr implements qD{Uri get JC=>start.JC;int get length=>end.offset-start.offset;int compareTo(qD A){var B=start.compareTo(A.start);return B==0?end.compareTo(A.end):B;}String message(String J,{color}){if(color==true)color=j5;if(color==false)color=null;var K=start.HD;var B=start.RC;var A=new StringBuffer();A.write('line ${K+1}, column ${B+1}');if(JC!=null)A.write(' of ${iq(JC)}');A.write(': ${J}');if(length==0&&this is!gX)return A.toString();A.write("\n");var C;if(this is gX){var D=(this as gX).context;var G=m5(D,PD,B);if(G!=null&&G>0){A.write(D.substring(0,G));D=D.substring(G);}var I=D.indexOf('\n');C=I==-1?D:D.substring(0,I+1);B=bI.min(B,C.length);}else{C=PD.split("\n").first;B=0;}var H=bI.min(B+end.offset-start.offset,C.length);if(color!=null){A.write(C.substring(0,B));A.write(color);A.write(C.substring(B,H));A.write(Hr);A.write(C.substring(H));}else{A.write(C);}if(!C.endsWith('\n'))A.write('\n');A.write(' '*B);if(color!=null)A.write(color);A.write('^'*bI.max(H-B,1));if(color!=null)A.write(Hr);return A.toString();}bool operator==(A)=>A is qD&&start==A.start&&end==A.end;int get hashCode=>start.hashCode+(31*end.hashCode);String toString()=>'<${runtimeType}: from ${start} to ${end} "${PD}">';}class cQ extends PT implements G6{final PO cPB;int get HD=>cPB.uZ(position);int get RC=>cPB.hi(position);fM get state=>new Qr(this,position);DD dPB;dM get location=>cPB.location(position);DD get pF=>location.QF();cQ(String A,{sourceUrl,int position}):cPB=new PO(A,url:sourceUrl),super(A,sourceUrl:sourceUrl,position:position);factory cQ.REB(String string,{sourceUrl,int position})=Uf;DD RF(fM B,[fM A]){var C=A==null?position:A.position;return cPB.c(B.position,C);}bool kD(Pattern A){if(!super.kD(A)){dPB=null;return false;}dPB=cPB.c(position,FN.end);return true;}void error(String A,{Match match,int position,int length}){Rr(string,match,position,length);if(match==null&&position==null&&length==null)match=FN;if(position==null){position=match==null?this.position:match.start;}if(length==null)length=match==null?1:match.end-match.start;var B=cPB.c(position,position+length);throw new jX(A,B,string);}}class Qr implements fM{final cQ ePB;final int position;int get HD=>ePB.cPB.uZ(position);int get RC=>ePB.cPB.hi(position);Qr(this.ePB,this.position);}class gX extends Rf{}typedef void y5(_0,jD _1);class Tf{final fPB=new Expando<eM>("stack chains");final y5 gPB;eM hPB;Tf([this.gPB]);ZoneSpecification kBB(){return new ZoneSpecification(handleUncaughtError:handleUncaughtError,registerCallback:registerCallback,registerUnaryCallback:registerUnaryCallback,registerBinaryCallback:registerBinaryCallback,errorCallback:errorCallback);}jD du(StackTrace A){if(A is jD)return A;var B=A==null?null:fPB[A];return new eM(A,B).ex();}ZoneCallback registerCallback(Zone G,ZoneDelegate A,Zone B,Function C){if(C==null)return A.registerCallback(B,null);var D=iPB(1);return A.registerCallback(B,()=>jPB(C,D));}ZoneUnaryCallback registerUnaryCallback(Zone H,ZoneDelegate A,Zone B,Function C){if(C==null)return A.registerUnaryCallback(B,null);var D=iPB(1);return A.registerUnaryCallback(B,(G){return jPB(()=>C(G),D);});}ZoneBinaryCallback registerBinaryCallback(Zone I,ZoneDelegate A,Zone B,Function C){if(C==null)return A.registerBinaryCallback(B,null);var D=iPB(1);return A.registerBinaryCallback(B,(G,H){return jPB(()=>C(G,H),D);});}handleUncaughtError(Zone J,ZoneDelegate A,Zone B,C,StackTrace H){var D=du(H);if(gPB==null){return A.handleUncaughtError(B,C,D);}try {return A.runBinary(B,gPB,C,D);}catch (G,I){if(identical(G,C)){return A.handleUncaughtError(B,C,D);}else{return A.handleUncaughtError(B,G,I);}}}AsyncError errorCallback(Zone H,ZoneDelegate D,Zone G,Object B,StackTrace A){if(A==null){A=iPB(2).ex();}else{if(fPB[A]==null)fPB[A]=iPB(2);}var C=D.errorCallback(G,B,A);return C==null?new AsyncError(B,A):C;}eM iPB([int A=0])=>new eM(new qB.ZDB(A+1),hPB);jPB(Function B,eM A){var C=hPB;hPB=A;try {return B();}catch (G,D){fPB[D]=A;rethrow;}finally {hPB=C;}}}class eM{final qB lx;final eM previous;eM(StackTrace A,[this.previous]):lx=A==null?new qB.ZDB():new qB.aDB(A);jD ex(){var B=<qB>[] ;var A=this;while(A!=null){B.add(A.lx);A=A.previous;}return new jD(B);}}typedef DateTime O6(String _0);O6 Xr;Future<DateTime> P6(String A){if(Xr!=null){return new Future.value(Xr(A));}return FileStat.stat(A).then((B)=>B.modified);}class Ub<BB> implements Sink<Stream<BB>>{Stream<BB> get stream=>kPB.stream;StreamController<BB> kPB;var lPB=false;var mPB=zG.cl;final nPB=new Map<Stream<BB>,StreamSubscription<BB>>();static Stream my(Iterable<Stream> B){var A=new Ub();B.forEach(A.add);A.close();return A.stream;}Ub(){kPB=new StreamController<BB>(onListen:oPB,onPause:pPB,onResume:qPB,onCancel:rPB,sync:true);}Future add(Stream<BB> A){if(lPB){throw new StateError("Can't add a Stream to a closed StreamGroup.");}if(mPB==zG.cl){nPB.putIfAbsent(A,()=>null);}else if(mPB==zG.fl){return A.listen(null).cancel();}else{nPB.putIfAbsent(A,()=>sPB(A));}return null;}Future remove(Stream<BB> B){var A=nPB.remove(B);var C=A==null?null:A.cancel();if(lPB&&nPB.isEmpty)kPB.close();return C;}void oPB(){mPB=zG.dl;nPB.forEach((A,B){if(B!=null)return;nPB[A]=sPB(A);});}void pPB(){mPB=zG.el;for(var A in nPB.values){A.pause();}}void qPB(){mPB=zG.dl;for(var A in nPB.values){A.resume();}}Future rPB(){mPB=zG.fl;var A=nPB.values.map((B)=>B.cancel()).where((C)=>C!=null).toList();nPB.clear();return A.isEmpty?null:Future.wait(A);}StreamSubscription<BB> sPB(Stream<BB> A){var B=A.listen(kPB.add,onError:kPB.addError,onDone:()=>remove(A));if(mPB==zG.el)B.pause();return B;}Future close(){if(lPB)return kPB.done;lPB=true;if(nPB.isEmpty)kPB.close();return kPB.done;}}class zG{static const cl=const zG("dormant");static const dl=const zG("listening");static const el=const zG("paused");static const fl=const zG("canceled");final String name;const zG(this.name);String toString()=>name;}final H6=new RegExp("/").pattern=="\\/";class PT{final Uri JC;final String string;int get position=>tPB;set position(int A){if(A<0||A>string.length){throw new ArgumentError("Invalid position ${A}");}tPB=A;}int tPB=0;Match get FN=>uPB;Match uPB;String get NK=>string.substring(position);bool get NJ=>position==string.length;PT(this.string,{sourceUrl,int position}):JC=sourceUrl is String?Uri.parse(sourceUrl):sourceUrl{if(position!=null)this.position=position;}int cB(){if(NJ)vPB("more input");return string.codeUnitAt(tPB++ );}int mB([int A]){if(A==null)A=0;var B=position+A;if(B<0||B>=string.length)return null;return string.codeUnitAt(B);}bool GC(Pattern B){var A=kD(B);if(A)tPB=uPB.end;return A;}void QR(Pattern A,{String name}){if(GC(A))return;if(name==null){if(A is RegExp){var B=A.pattern;if(!H6)B=B.replaceAll("/","\\/");name="/${B}/";}else{name=A.toString().replaceAll("\\","\\\\").replaceAll('"','\\"');name='"${name}"';}}vPB(name);}bool kD(Pattern A){uPB=A.matchAsPrefix(string,position);return uPB!=null;}String substring(int B,[int A]){if(A==null)A=position;return string.substring(B,A);}void error(String A,{Match match,int position,int length}){Rr(string,match,position,length);if(match==null&&position==null&&length==null)match=FN;if(position==null){position=match==null?this.position:match.start;}if(length==null)length=match==null?1:match.end-match.start;var B=new PO(string,url:JC);var C=B.c(position,position+length);throw new jX(A,C,string);}void vPB(String A){error("expected ${A}.",position:this.position,length:0);}}class Sr extends Br{Sr():super(new M6());}class I6{String encode(Map<String,dynamic> B){var A=new K6();A.Yi(B,name:[] );return A.toString();}}abstract class J6{}typedef void Vf<jC>(jC _0);class K6{static final RegExp L6=new RegExp(r'^[A-Za-z0-9_-]+$');final StringBuffer wPB=new StringBuffer();void ui(){if(wPB.isNotEmpty)wPB.writeln();}void k$(List<String> B,{bool array: false}){if(B.isNotEmpty){ui();ui();wPB.write(array?'[[':'[');for(int A=0;A<B.length;A++ ){if(A!=0)wPB.write('.');Ev(B[A]);}wPB.write(array?']]':']');}}ek(A){while(A is J6)A=A.OEB();return A;}void Yi(Map<String,dynamic> H,{List<String> name,bool array: false}){var C={};var D={};H.forEach((B,A){A=ek(A);if(A is Map){D[B]=A;return;}if(A is Iterable&&A.length>0){A=A.map(ek);if(A.every((G)=>G is Map)){D[B]=A;return;}}C[B]=A;});if(array||C.isNotEmpty){k$(name,array:array);C.forEach(l$);}D.forEach((B,A){name.add(B);if(A is Map){Yi(A,name:name);}else if(A is Iterable){A.forEach((G){Yi(G,name:name,array:true);});}name.removeLast();});}void l$(String A,B){ui();Ev(A);wPB.write(' = ');Fv(B);}void Ev(String A){if(L6.hasMatch(A)){wPB.write(A);}else{Dv(A);}}void Fv(A){A=ek(A);Vf B=Y$(A);if(B==null)throw new Yf(A);B(A);}Vf Y$(A){if(A is num)return A$;if(A is bool)return u_;if(A is DateTime)return v_;if(A is String)return B$;if(A is Iterable)return t_;return null;}void A$(num A){wPB.write('${A}');}void u_(bool A){wPB.write(A?'true':'false');}void v_(DateTime A){wPB.write(A.toIso8601String());}Type FCB(Iterable B){if(B.isEmpty)return null;if(identical(1,1.0)&&B.every((A)=>A is num)&&B.any((A)=>A is int)&&B.any((A)=>A is!int)){return num;}return B.map((A)=>A.runtimeType).reduce((C,D){if(C!=D)throw new Zf(B);return C;});}void t_(Iterable B){var D=FCB(B);wPB.write('[');for(var A=0;A<B.length;A++ ){var C=B.elementAt(A);if(A!=0)wPB.write(', ');Fv(C);if(D==num&&C is int)wPB.write('.0');}wPB.write(']');}Vf<String> W$(String A){var C=[xH.pI['"'],xH.pI['\\']];bool B(String D)=>xH.pI.values.where((G)=>!C.contains(G)).any(D.codeUnits.contains);if(A.contains('\n')||A.contains('\r')){if(A.split(new RegExp('\n|\r')).any(B)){return y_;}return z_;}if(A.contains("'")||B(A)){return Dv;}return x_;}void B$(String A){var B=W$(A);B(A);}void xPB(String A,{String quotes,Iterable<int> esc: const[] ,bool multiline: false}){if(esc.isNotEmpty){A=A.codeUnits.map((int B){if(esc.contains(B)){return '\\${xH.pI.o$[B]}';}return new String.fromCharCode(B);}).join();}if(multiline){if(quotes=='"""')A=A.replaceAll('"""',r'\"\"\"');}else if(A.contains('\n')||A.contains('\r')){throw new kX('Newlines are only allowed in multi-line strings!');}if(!esc.contains(quotes.codeUnitAt(0))&&A.contains(quotes)){throw new kX('"${quotes}" are prohibited in non-basic strings.');}wPB.write(quotes);if(multiline)wPB.writeln();wPB.write(A);wPB.write(quotes);}void Dv(String A)=>xPB(A,quotes:'"',esc:xH.pI.values);void y_(String B)=>xPB(B,quotes:'"""',esc:xH.pI.values.where((A)=>A!=xH.pI['"']&&A!=xH.pI['n']&&A!=xH.pI['r']),multiline:true);void x_(String A)=>xPB(A,quotes:"'");void z_(String A)=>xPB(A,quotes:"'''",multiline:true);String toString()=>wPB.toString();}class Wf{final String fU;Wf(this.fU);bool operator==(A)=>A is Wf&&A.fU==fU;int get hashCode=>fU.hashCode;String toString()=>'The escape sequence "${fU}" is invalid!';}class kX{final String msg;kX(this.msg);bool operator==(A)=>A is kX&&A.msg==msg;int get hashCode=>msg.hashCode;String toString()=>msg;}class QT{final String name;QT(this.name);bool operator==(A)=>A is QT&&A.name==name;int get hashCode=>name.hashCode;String toString()=>'Cannot redefine "${name}"!';}class Xf{final String name;Xf(this.name);bool operator==(A)=>A is Xf&&A.name==name;int get hashCode=>name.hashCode;String toString()=>'Cannot define table "${name}"! Parent must be a table!';}class Yf{final value;Yf(this.value);bool operator==(A)=>A is Yf&&A.value==value;int get hashCode=>value.hashCode;String toString()=>'"${value}" cannot be encoded as a TOMl value!';}class Zf{final Iterable NB;Zf(this.NB);bool operator==(A)=>A is Zf&&A.NB==NB;int get hashCode=>NB.hashCode;String toString()=>'The items of "${NB}" must all be of the same type!';}class xH extends Jf{static final bQ<String,int> pI=new bQ()..addAll({'b':0x08,'t':0x09,'n':0x0A,'f':0x0C,'r':0x0D,'"':0x22,r'\':0x5C});start()=>r(Ui).end();token(A,[bool C=false,bool B]){if(B==null)B=C;if(A is Function)A=r(A);var D=r(DN,C);var G=r(DN,B);return A.di().trim(D,G);}DN([bool A=false])=>A?r(DN)|r(jL):r(mk)|r(JJ);mk()=>uB(' ')|uB('\t');jL()=>uB('\n')|uB('\r')&uB('\n');JJ()=>uB('#')&r(jL).Rj().SK();value()=>r(eZ)|r(pZ)|r(yZ)|r(WZ)|r(Xx)|r(NB)|r(xZ);o yPB({o quotes,o esc,bool multiline: false}){var A=quotes;if(multiline)A=(A&r(Bv).HK()).rL(0);var C=quotes;if(!multiline)C|= r(jL);var B=C.Rj();if(esc!=null)B=esc|B;return (A&B.SK()&quotes).trim(r(DN)).rL(1).map((List D)=>D.join());}Xx()=>r(WAB)|r(au)|r(YAB)|r(BAB);au()=>yPB(quotes:uB('"'),esc:r(mZ));mZ()=>uB('\\')&(r(ck)|r(Nk));ck()=>uB('u')&r(uv).qa(4).di()|uB('U')&r(uv).qa(8).di();Nk()=>cM();uv()=>Cr('0-9a-fA-F');WAB()=>yPB(quotes:LT('"""'),esc:r(XAB),multiline:true);XAB()=>r(nk)|r(mZ);nk()=>uB('\\')&r(Bv).Va()&r(mk).SK();Bv()=>r(mk).SK()&r(jL);BAB()=>yPB(quotes:LT("'"));YAB()=>yPB(quotes:LT("'''"),multiline:true);yZ()=>r(token,zPB);zPB()=>Gf('+-').HK()&(uB('0')|r(su));su()=>dX().Va().VV(uB('_'));pZ()=>r(token,AQB);AQB()=>r(zPB)&(r(G$)&r(Hv).HK()|r(Hv));G$()=>uB('.')&r(su);Hv()=>Gf('eE')&r(zPB);WZ()=>r(token,BQB);BQB()=>LT('true')|LT('false');eZ()=>r(token,CQB);CQB()=>r(H$)&uB('T')&r(I$);H$()=>r(h_)&uB('-')&r(pO)&uB('-')&r(pO);I$()=>r(zAB)&r(iBB);zAB()=>r(pO)&uB(':')&r(pO)&uB(':')&r(pO)&(uB('.')&dX().aa(1,6)).HK();iBB()=>uB('Z')|r(hBB);hBB()=>Gf('+-')&r(pO)&uB(':')&r(pO);pO()=>dX().qa(2);h_()=>dX().qa(4);NB()=>SL(eZ)|SL(pZ)|SL(yZ)|SL(WZ)|SL(Xx)|SL(NB)|SL(xZ);SL(A)=>r(token,uB('['),false,true)&r(A).VV(r(token,uB(','),true),optionalSeparatorAtEnd:true,includeSeparators:false).HK([] )&r(token,uB(']'),true,false);LP()=>r(ma).trim(r(DN,true))&r(Aj);ma()=>uB('[')&r(gBB)&uB(']');Tk()=>r(Uk).trim(r(DN,true))&r(Aj);Uk()=>uB('[')&r(ma)&uB(']');xZ()=>r(token,uB('{'))&r(Ga).VV(token(uB(',')),optionalSeparatorAtEnd:false,includeSeparators:false).HK([] )&r(token,uB('}'));key()=>r(token,J_)|r(FBB);J_()=>Cr('A-Za-z0-9_-').Va();FBB()=>r(au);gBB()=>r(key).VV(uB('.'),includeSeparators:false);Ga()=>r(key)&uB('=')&r(value);Aj()=>r(Ga).VV(r(jL)&r(DN,true).SK(),includeSeparators:false,optionalSeparatorAtEnd:true).HK([] );Ui()=>r(DN,true).SK()&r(Aj)&(r(LP)|r(Tk)).SK();}class M6 extends xH{mZ()=>super.mZ().rL(1);Nk()=>super.Nk().map((String A){if(xH.pI.containsKey(A)){return new String.fromCharCode(xH.pI[A]);}throw new Wf('\\${A}');});ck()=>super.ck().rL(1).map((A)=>new String.fromCharCode(int.parse(A,radix:16)));nk()=>super.nk().map((A)=>'');yZ()=>super.yZ().map((A)=>int.parse(A.replaceAll('_','')));pZ()=>super.pZ().map((A)=>double.parse(A.replaceAll('_','')));WZ()=>super.WZ().map((A)=>A=='true');eZ()=>super.eZ().map(DateTime.parse);SL(A)=>super.SL(A).rL(1);LP()=>super.LP().map((List A)=>{'type':'table','parent':A[0].sublist(0,A[0].length-1),'name':A[0].last,'pairs':A[1]});ma()=>super.ma().rL(1);Tk()=>super.Tk().map((List A)=>{'type':'table-array','parent':A[0].sublist(0,A[0].length-1),'name':A[0].last,'pairs':A[1]});Uk()=>super.Uk().rL(1);xZ()=>super.xZ().rL(1).map((List C){var A={};C.forEach((Map B){A[B['key']]=B['value'];});return A;});Ga()=>super.Ga().ABB([0,2]).map((List A)=>{'key':A[0],'value':A[1]});Ui()=>super.Ui().map((List P){var I={};var Q=new Set();void J(String A){if(Q.contains(A))throw new QT(A);Q.add(A);}Function S(Map Z,[String h])=>(Map G){var A=h==null?G['key']:'${h}.${G['key']}';J(A);if(Z.containsKey(G['key']))throw new QT(A);Z[G['key']]=G['value'];};P[1].forEach(S(I));P[2].forEach((Map C){var B=I;var A=[] ;C['parent'].forEach((String H){B=B.putIfAbsent(H,()=>{});if(B is List){H='${H}[${B.length-1}]';B=B.last;}A.add(H);if(B is!Map)throw new Xf(A.join('.'));});A.add(C['name']);A=A.join('.');var K;if(C['type']=='table-array'){var M=B.putIfAbsent(C['name'],(){J(A);return [] ;});if(M is Map)throw new QT(A);var p=M.length;M.add(K={});A='${A}[${p}]';}else{K=B.putIfAbsent(C['name'],()=>{});}J(A);C['pairs'].forEach(S(K,A));});O(D){if(D is Map){return new UnmodifiableMapView(new Map.fromIterables(D.keys,D.values.map(O)));}if(D is List){return new UnmodifiableListView(D.map(O));}return D;}return O(I);});}final z5=new RegExp(r"(-patch)?([/\\].*)?$");final A6=new RegExp(r"\n    ?at ");final B6=new RegExp(r"    ?at ");final C6=new RegExp(r"^" r"(" r"([.0-9A-Za-z_$/<]|\(.*\))*" r"@" r")?" r"[^\s]*" r":\d*" r"$",multiLine:true);final D6=new RegExp(r"^[^\s]+( \d+(:\d+)?)?[ \t]+[^\s]+$",multiLine:true);class qB implements StackTrace{final List<WC> RH;factory qB.ZDB([int A=0]){if(A<0){throw new ArgumentError("Argument [level] must be greater than or equal " "to 0.");}var B=new qB.aDB(StackTrace.current);return new OT((){return new qB(B.RH.skip(A+(F6?2:1)));});}factory qB.aDB(StackTrace A){if(A==null){throw new ArgumentError("Cannot create a Trace from null.");}if(A is qB)return A;if(A is jD)return A.gx();return new OT(()=>new qB.bDB(A.toString()));}factory qB.bDB(String A){try {if(A.isEmpty)return new qB(<WC>[] );if(A.contains(A6))return new qB.dDB(A);if(A.contains("\tat "))return new qB.eDB(A);if(A.contains(C6)){return new qB.fDB(A);}if(A.contains(iX))return new jD.UDB(A).gx();if(A.contains(D6)){return new qB.gDB(A);}return new qB.cDB(A);}on FormatException catch (B){throw new FormatException('${B.message}\nStack trace:\n${A}');}}qB.cDB(String A):this(E6(A));static List<WC> E6(String C){var A=C.trim().split("\n");var B=A.take(A.length-1).map((D)=>new WC.VDB(D)).toList();if(!A.last.endsWith(".da")){B.add(new WC.VDB(A.last));}return B;}qB.dDB(String B):this(B.split("\n").skip(1).skipWhile((A)=>!A.startsWith(B6)).map((A)=>new WC.WDB(A)));qB.eDB(String B):this(B.split("\n").where((A)=>A!="\tat ").map((A)=>new WC.WDB(A)));qB.fDB(String B):this(B.trim().split("\n").where((A)=>A.isNotEmpty&&A!='[native code]').map((A)=>new WC.XDB(A)));qB.gDB(String B):this(B.isEmpty?[] :B.trim().split("\n").where((A)=>!A.startsWith('=====')).map((A)=>new WC.YDB(A)));qB(Iterable<WC> A):RH=new List<WC>.unmodifiable(A);qB get oa=>SR((A)=>false,terse:true);qB SR(bool C(WC frame),{bool terse: false}){if(terse){var D=C;C=(A){if(D(A))return true;if(A.vi)return true;if(A.ow=='stack_trace')return true;if(!A.GK.contains('<async>'))return false;return A.HD==null;};}var B=<WC>[] ;for(var A in RH.reversed){if(A is yK||!C(A)){B.add(A);}else if(B.isEmpty||!C(B.last)){B.add(new WC(A.uri,A.HD,A.RC,A.GK));}}if(terse){B=B.map((A){if(A is yK||!C(A))return A;var G=A.uU.replaceAll(z5,'');return new WC(Uri.parse(G),null,null,A.GK);}).toList();if(B.length>1&&B.first.vi)B.removeAt(0);}return new qB(B.reversed);}String toString(){var B=RH.map((A)=>A.location.length).fold(0,bI.max);return RH.map((A){if(A is yK)return "${A}\n";return '${Nr(A.location,B)}  ${A.GK}\n';}).join();}}abstract class Yz<XE,jC> implements Map<XE,jC>{static DS(){throw new UnsupportedError("Cannot modify an unmodifiable Map");}void operator[]=(XE A,jC B)=>DS();jC putIfAbsent(XE A,jC B())=>DS();void addAll(Map<XE,jC> A)=>DS();jC remove(Object A)=>DS();void clear()=>DS();}class yK implements WC{final Uri uri=new Uri(path:"unparsed");final int HD=null;final int RC=null;final bool vi=false;final String uU="unparsed";final String ow=null;final String location="unparsed";final String GK;yK(this.GK);String toString()=>GK;}class Ol{static const zR=3;final List aj;StringBuffer buffer;int zM=0;List<int> YZ;int Ma=0;int CV=0;Ol(this.aj);String Uv(){buffer=new StringBuffer();Q_();for(var B in aj){if(B is String){if(buffer.isNotEmpty)buffer.write("\n\n");buffer.write(B);CV=1;continue;}var A=B as vE;if(A.hide)continue;write(0,Wv(A));write(1,fv(A));if(A.ri!=null)write(2,A.ri);if(A.IR!=null){var C=A.IR.keys.toList(growable:false);C.sort();jL();for(var D in C){write(1,Xv(D));write(2,A.IR[D]);}jL();}else if(A.PU!=null){write(2,N_(A));}else if(A.HF!=null){if(A.cL&&A.HF==true){write(2,'(defaults to on)');}else if(!A.cL){write(2,'(defaults to "${A.HF}")');}}if(Ma>1)jL();}return buffer.toString();}String Wv(vE A){if(A.uM!=null){return '-${A.uM}, ';}else{return '';}}String fv(vE A){var B;if(A.negatable){B='--[no-]${A.name}';}else{B='--${A.name}';}if(A.lk!=null)B+= "=<${A.lk}>";return B;}String Xv(String A){return '      [${A}]';}void Q_(){int C=0;int A=0;for(var B in aj){if(B is!vE)continue;if(B.hide)continue;C=bI.max(C,Wv(B).length);A=bI.max(A,fv(B).length);if(B.IR!=null){for(var D in B.IR.keys){A=bI.max(A,Xv(D).length);}}}A+= 4;YZ=[C,A];}void jL(){CV++ ;zM=0;Ma=0;}void write(int B,String C){var A=C.split('\n');while(A.length>0&&A[0].trim()==''){A.removeRange(0,1);}while(A.length>0&&A[A.length-1].trim()==''){A.removeLast();}for(var D in A){LCB(B,D);}}void LCB(int A,String B){while(CV>0){buffer.write('\n');CV-- ;}while(zM!=A){if(zM<zR-1){buffer.write(Pl('',YZ[zM]));}else{buffer.write('\n');}zM=(zM+1)%zR;}if(A<YZ.length){buffer.write(Pl(B,YZ[A]));}else{buffer.write(B);}zM=(zM+1)%zR;if(A==zR-1)CV++ ;if(A==zR-1){Ma++ ;}else{Ma=0;}}String N_(vE B){var A=new StringBuffer();A.write('[');bool C=true;for(var D in B.PU){if(!C)A.write(', ');A.write(D);if(D==B.HF){A.write(' (default)');}C=false;}A.write(']');return A.toString();}}String Pl(String B,int C){final A=new StringBuffer();A.write(B);while(A.length<C){A.write(' ');}return A.toString();}int m5(String B,String C,int D){var I=C=='';var A=B.indexOf(C);while(A!=-1){var G=B.lastIndexOf('\n',A)+1;var H=A-G;if(D==H||(I&&D==H+1)){return G;}A=B.indexOf(C,A+1);}return null;}const iX='===== asynchronous gap ===========================\n';final bool F6=JT==VC.uK;String Nr(String A,int C){if(A.length>=C)return A;var B=new StringBuffer();B.write(A);for(var D=0;D<C-A.length;D++ ){B.write(' ');}return B.toString();}void Rr(String C,Match D,int A,int B){if(D!=null&&(A!=null||B!=null)){throw new ArgumentError("Can't pass both match and position/length.");}if(A!=null){if(A<0){throw new RangeError("position must be greater than or equal to 0.");}else if(A>C.length){throw new RangeError("position must be less than or equal to the " "string length.");}}if(B!=null&&B<0){throw new RangeError("length must be greater than or equal to 0.");}if(A!=null&&B!=null&&A+B>C.length){throw new RangeError("position plus length must not go beyond the end of " "the string.");}}class Q6<BB> implements StreamTransformer<BB,List<BB>>{Stream<List<BB>> bind(Stream<BB> C){var A=new Queue<BB>();return new StreamTransformer<BB,List<BB>>.fromHandlers(handleData:(D,B){A.add(D);Timer.run((){if(A.isEmpty)return;B.add(A.toList());A.clear();});},handleDone:(B){if(A.isNotEmpty){B.add(A.toList());A.clear();}B.close();}).bind(C);}}final eX=const CS();class pD implements wK,Pf{final int OF;final int lE;final int patch;final List EP;final List MI;final String DQB;pD get min=>this;pD get max=>this;pD.ODB(this.OF,this.lE,this.patch,String A,String B,this.DQB):EP=A==null?[] :Fr(A),MI=B==null?[] :Fr(B){if(OF<0)throw new ArgumentError('Major version must be non-negative.');if(lE<0)throw new ArgumentError('Minor version must be non-negative.');if(patch<0)throw new ArgumentError('Patch version must be non-negative.');}factory pD.PDB(String B){final A=g5.firstMatch(B);if(A==null){throw new FormatException('Could not parse "${B}".');}try {int C=int.parse(A[1]);int D=int.parse(A[2]);int G=int.parse(A[3]);String H=A[5];String I=A[8];return new pD.ODB(C,D,G,H,I,B);}on FormatException {throw new FormatException('Could not parse "${B}".');}}static List Fr(String B){return B.split('.').map((A){try {return int.parse(A);}on FormatException {return A;}}).toList();}bool operator==(A){if(A is!pD)return false;return OF==A.OF&&lE==A.lE&&patch==A.patch&&eX.JF(EP,A.EP)&&eX.JF(MI,A.MI);}int get hashCode=>OF^lE^patch^eX.hash(EP)^eX.hash(MI);bool operator<(pD A)=>compareTo(A)<0;bool operator>(pD A)=>compareTo(A)>0;bool operator<=(pD A)=>compareTo(A)<=0;bool operator>=(pD A)=>compareTo(A)>=0;bool get isEmpty=>false;bool get Ca=>EP.isNotEmpty;bool Zu(pD A)=>this==A;wK difference(wK A)=>A.Zu(this)?wK.h5:this;int compareTo(Pf A){if(A is pD){if(OF!=A.OF)return OF.compareTo(A.OF);if(lE!=A.lE)return lE.compareTo(A.lE);if(patch!=A.patch)return patch.compareTo(A.patch);if(!Ca&&A.Ca)return 1;if(!A.Ca&&Ca)return -1;var B=EQB(EP,A.EP);if(B!=0)return B;if(MI.isEmpty&&A.MI.isNotEmpty)return -1;if(A.MI.isEmpty&&MI.isNotEmpty)return 1;return EQB(MI,A.MI);}else{return -A.compareTo(this);}}String toString()=>DQB;int EQB(List D,List G){for(var A=0;A<bI.max(D.length,G.length);A++ ){var C=(A<D.length)?D[A]:null;var B=(A<G.length)?G[A]:null;if(C==B)continue;if(C==null)return -1;if(B==null)return 1;if(C is num){if(B is num){return C.compareTo(B);}else{return -1;}}else{if(B is num){return 1;}else{return C.compareTo(B);}}}return 0;}}abstract class wK{static wK h5=const Gr();}class Gr implements wK{const Gr();bool get isEmpty=>true;bool Zu(pD A)=>false;wK difference(wK A)=>this;String toString()=>'<empty>';}class Pf implements Comparable<Pf>,wK{}class cG{final pJ type;final String path;cG(this.type,this.path);String toString()=>"${type} ${path}";}class pJ{static const Yr=const pJ("remove");static const lX=const pJ("modify");final String FQB;const pJ(this.FQB);String toString()=>FQB;}abstract class cf{}O7(String A,{sourceUrl})=>P7(A,sourceUrl:sourceUrl).value;xD P7(String A,{sourceUrl})=>Q7(A,sourceUrl:sourceUrl).Ii;iQ Q7(String D,{sourceUrl}){var A=new hr(D,sourceUrl:sourceUrl);var B=A.load();if(B==null){return new iQ.lDB(new JE.pDB(null,A.c),A.c,null,const[] );}var C=A.load();if(C!=null){throw new rB("Only expected one document.",C.c);}return B;}Map R6()=>new HashMap(equals:S6,hashCode:Zr);bool S6(A,B)=>new T6().JF(A,B);class T6{final GQB=[] ;final HQB=[] ;bool JF(A,B){if(A is JE)A=A.value;if(B is JE)B=B.value;for(var C=0;C<GQB.length;C++ ){var D=identical(A,GQB[C]);var G=identical(B,HQB[C]);if(D&&G)return true;if(D||G)return false;}GQB.add(A);HQB.add(B);try {if(A is List&&B is List){return IQB(A,B);}else if(A is Map&&B is Map){return JQB(A,B);}else if(A is num&&B is num){return KQB(A,B);}else{return A==B;}}finally {GQB.removeLast();HQB.removeLast();}}bool IQB(List B,List C){if(B.length!=C.length)return false;for(var A=0;A<B.length;A++ ){if(!JF(B[A],C[A]))return false;}return true;}bool JQB(Map A,Map B){if(A.length!=B.length)return false;for(var C in A.keys){if(!B.containsKey(C))return false;if(!JF(A[C],B[C]))return false;}return true;}bool KQB(num A,num B){if(A.isNaN&&B.isNaN)return true;return A==B;}}int Zr(G){var B=[] ;C(A){if(B.any((H)=>identical(H,A)))return -1;B.add(A);try {if(A is Map){var D=const GW();return D.hash(A.keys.map(C))^D.hash(A.values.map(C));}else if(A is Iterable){return const CS().hash(A.map(Zr));}else if(A is JE){return A.value.hashCode;}else{return A.hashCode;}}finally {B.removeLast();}}return C(G);}class XC{final IC type;final DD c;XC(this.type,this.c);String toString()=>type.toString();}class mX implements XC{get type=>IC.U6;final DD c;final YT versionDirective;final List<zH> na;final bool isImplicit;mX(this.c,{this.versionDirective,List<zH> tagDirectives,this.isImplicit: true}):na=tagDirectives==null?[] :tagDirectives;String toString()=>"DOCUMENT_START";}class nX implements XC{get type=>IC.cr;final DD c;final bool isImplicit;nX(this.c,{this.isImplicit: true});String toString()=>"DOCUMENT_END";}class df implements XC{get type=>IC.dr;final DD c;final String name;df(this.c,this.name);String toString()=>"ALIAS ${name}";}abstract class ef implements XC{String get anchor;String get tag;String toString(){var A=new StringBuffer('${type}');if(anchor!=null)A.write(" &${anchor}");if(tag!=null)A.write(" ${tag}");return A.toString();}}class yH extends ef{get type=>IC.er;final DD c;final String anchor;final String tag;final String value;final WE MB;yH(this.c,this.value,this.MB,{this.anchor,this.tag});String toString()=>"${super.toString()} \"${value}\"";}class RT extends ef{get type=>IC.fr;final DD c;final String anchor;final String tag;final HH MB;RT(this.c,this.MB,{this.anchor,this.tag});}class ST extends ef{get type=>IC.gr;final DD c;final String anchor;final String tag;final HH MB;ST(this.c,this.MB,{this.anchor,this.tag});}class IC{static const ar=const IC.hDB("STREAM_START");static const br=const IC.hDB("STREAM_END");static const U6=const IC.hDB("DOCUMENT_START");static const cr=const IC.hDB("DOCUMENT_END");static const dr=const IC.hDB("ALIAS");static const er=const IC.hDB("SCALAR");static const fr=const IC.hDB("SEQUENCE_START");static const oX=const IC.hDB("SEQUENCE_END");static const gr=const IC.hDB("MAPPING_START");static const pX=const IC.hDB("MAPPING_END");final String name;const IC.hDB(this.name);String toString()=>name;}class rB extends Sf{rB(String A,qD B):super(A,B);}class hr{final ff LQB;final MQB=new Map<String,xD>();DD get c=>NQB;DD NQB;hr(String B,{sourceUrl}):LQB=new ff(B,sourceUrl:sourceUrl){var A=LQB.BE();NQB=A.c;assert(A.type==IC.ar);}iQ load(){if(LQB.NJ)return null;var A=LQB.BE();if(A.type==IC.br){NQB=NQB.expand(A.c);return null;}var B=OQB(A);NQB=NQB.expand(B.c);MQB.clear();return B;}iQ OQB(mX A){var C=PQB(LQB.BE());var B=LQB.BE() as nX;assert(B.type==IC.cr);return new iQ.lDB(C,A.c.expand(B.c),A.versionDirective,A.na,startImplicit:A.isImplicit,endImplicit:B.isImplicit);}xD PQB(XC A){switch (A.type){case IC.dr:return QQB(A);case IC.er:return RQB(A);case IC.fr:return SQB(A);case IC.gr:return TQB(A);default:throw "Unreachable";}}void UQB(String A,xD B){if(A==null)return;MQB[A]=B;}xD QQB(df A){var B=MQB[A.name];if(B!=null)return B;throw new rB("Undefined alias.",A.c);}xD RQB(yH A){var B;if(A.tag=="!"){B=new JE.oDB(A.value,A);}else if(A.tag!=null){B=VQB(A);}else{B=WQB(A);}UQB(A.anchor,B);return B;}xD SQB(RT A){if(A.tag!="!"&&A.tag!=null&&A.tag!="tag:yaml.org,2002:seq"){throw new rB("Invalid tag for sequence.",A.c);}var D=<xD>[] ;var C=new Is.nDB(D,A.c,A.MB);UQB(A.anchor,C);var B=LQB.BE();while(B.type!=IC.oX){D.add(PQB(B));B=LQB.BE();}Js(C,A.c.expand(B.c));return C;}xD TQB(ST A){if(A.tag!="!"&&A.tag!=null&&A.tag!="tag:yaml.org,2002:map"){throw new rB("Invalid tag for mapping.",A.c);}var D=R6();var C=new Hs.mDB(D,A.c,A.MB);UQB(A.anchor,C);var B=LQB.BE();while(B.type!=IC.pX){var G=PQB(B);var H=PQB(LQB.BE());D[G]=H;B=LQB.BE();}Js(C,A.c.expand(B.c));return C;}JE VQB(yH A){switch (A.tag){case "tag:yaml.org,2002:null":var B=XQB(A);if(B!=null)return B;throw new rB("Invalid null scalar.",A.c);case "tag:yaml.org,2002:bool":var B=YQB(A);if(B!=null)return B;throw new rB("Invalid bool scalar.",A.c);case "tag:yaml.org,2002:int":var B=ZQB(A,allowFloat:false);if(B!=null)return B;throw new rB("Invalid int scalar.",A.c);case "tag:yaml.org,2002:float":var B=ZQB(A,allowInt:false);if(B!=null)return B;throw new rB("Invalid float scalar.",A.c);case "tag:yaml.org,2002:str":return new JE.oDB(A.value,A);default:throw new rB('Undefined tag: ${A.tag}.',A.c);}}JE WQB(yH A)=>aQB(A)??new JE.oDB(A.value,A);JE aQB(yH A){var B=A.value.length;if(B==0)return new JE.oDB(null,A);var C=A.value.codeUnitAt(0);switch (C){case xV:case ab:case bb:return ZQB(A);case yy:case vy:return B==4?XQB(A):null;case Az:case wy:return B==4?YQB(A):null;case xy:case uy:return B==5?YQB(A):null;case Cz:return B==1?new JE.oDB(null,A):null;default:if(C>=qP&&C<=yV)return ZQB(A);return null;}}JE XQB(yH A){switch (A.value){case "":case "null":case "Null":case "NULL":case "~":return new JE.oDB(null,A);default:return null;}}JE YQB(yH A){switch (A.value){case "true":case "True":case "TRUE":return new JE.oDB(true,A);case "false":case "False":case "FALSE":return new JE.oDB(false,A);default:return null;}}xD ZQB(yH A,{bool allowInt: true,bool allowFloat: true}){var B=bQB(A.value,allowInt:allowInt,allowFloat:allowFloat);return B==null?null:new JE.oDB(B,A);}num bQB(String A,{bool allowInt: true,bool allowFloat: true}){assert(allowInt||allowFloat);var B=A.codeUnitAt(0);var G=A.length;if(allowInt&&G==1){var H=B-qP;return H>=0&&H<=9?H:null;}var C=A.codeUnitAt(1);if(allowInt&&B==qP){if(C==Bz)return int.parse(A,onError:(D)=>null);if(C==zy){var J=A.substring(2);return int.parse(J,radix:8,onError:(D)=>null);}}if((B>=qP&&B<=yV)||((B==ab||B==bb)&&C>=qP&&C<=yV)){var I=null;if(allowInt){I=int.parse(A,radix:10,onError:(D)=>null);}if(allowFloat)I??= double.parse(A,(D)=>null);return I;}if(!allowFloat)return null;if((B==xV&&C>=qP&&C<=yV)||(B==bb||B==ab)&&C==xV){if(G==5){switch (A){case "+.inf":case "+.Inf":case "+.INF":return double.INFINITY;case "-.inf":case "-.Inf":case "-.INF":return -double.INFINITY;}}return double.parse(A,(D)=>null);}if(G==4&&B==xV){switch (A){case ".inf":case ".Inf":case ".INF":return double.INFINITY;case ".nan":case ".NaN":case ".NAN":return double.NAN;}}return null;}}class ff{final pf cQB;final dQB=new List<t>();var eQB=t.ir;final fQB=new Map<String,zH>();bool get NJ=>eQB==t.rr;ff(String A,{sourceUrl}):cQB=new pf(A,sourceUrl:sourceUrl);XC BE(){try {if(NJ)throw new StateError("No more events.");var B=gQB();return B;}on jX catch (A){throw new rB(A.message,A.c);}}XC gQB(){switch (eQB){case t.ir:return hQB();case t.gf:return iQB();case t.jr:return jQB();case t.hf:return kQB();case t.kr:return lQB(block:true);case t.V6:return lQB(block:true,indentlessSequence:true);case t.W6:return lQB();case t.lr:cQB.GC();return mQB();case t.jf:return mQB();case t.qX:return nQB();case t.mr:cQB.GC();return oQB();case t.rX:return oQB();case t.sX:return pQB();case t.nr:return qQB(first:true);case t.kf:return qQB();case t.or:return rQB();case t.lf:return sQB();case t.mf:return tQB();case t.pr:return uQB(first:true);case t.tX:return uQB();case t.nf:return vQB();case t.qr:return vQB(empty:true);default:throw "Unreachable";}}XC hQB(){var A=cQB.GC();assert(A.type==a.Bs);eQB=t.gf;return new XC(IC.ar,A.c);}XC iQB(){var A=cQB.PF();while(A.type==a.JY){A=cQB.OH();}if(A.type!=a.GY&&A.type!=a.HY&&A.type!=a.IY&&A.type!=a.WT){wQB();dQB.add(t.hf);eQB=t.kr;return new mX(A.c.start.QF());}if(A.type==a.WT){eQB=t.rr;cQB.GC();return new XC(IC.br,A.c);}var C=A.c;var B=wQB();var D=B.first;var G=B.last;A=cQB.PF();if(A.type!=a.IY){throw new rB("Expected document start.",A.c);}dQB.add(t.hf);eQB=t.jr;cQB.GC();return new mX(C.expand(A.c),versionDirective:D,tagDirectives:G,isImplicit:false);}XC jQB(){var A=cQB.PF();switch (A.type){case a.GY:case a.HY:case a.IY:case a.JY:case a.WT:eQB=dQB.removeLast();return xQB(A.c.start);default:return lQB(block:true);}}XC kQB(){fQB.clear();eQB=t.gf;var A=cQB.PF();if(A.type==a.JY){cQB.GC();return new nX(A.c,isImplicit:false);}else{return new nX(A.c.start.QF(),isImplicit:true);}}XC lQB({bool block: false,bool indentlessSequence: false}){var A=cQB.PF();if(A is Eg){cQB.GC();eQB=dQB.removeLast();return new df(A.c,A.name);}var D;var G;var B=A.c.start.QF();H(A){D=A.name;B=B.expand(A.c);return cQB.OH();}I(A){G=A;B=B.expand(A.c);return cQB.OH();}if(A is EY){A=H(A);if(A is FY)A=I(A);}else if(A is FY){A=I(A);if(A is EY)A=H(A);}var C;if(G!=null){if(G.SH==null){C=G.ka;}else{var J=fQB[G.SH];if(J==null){throw new rB("Undefined tag handle.",G.c);}C=J.vF+G.ka;}}if(indentlessSequence&&A.type==a.hQ){eQB=t.qX;return new RT(B.expand(A.c),HH.Ag,anchor:D,tag:C);}if(A is eQ){if(C==null&&A.MB!=WE.DY)C="!";eQB=dQB.removeLast();cQB.GC();return new yH(B.expand(A.c),A.value,A.MB,anchor:D,tag:C);}if(A.type==a.Ds){eQB=t.nr;return new RT(B.expand(A.c),HH.Bg,anchor:D,tag:C);}if(A.type==a.Es){eQB=t.pr;return new ST(B.expand(A.c),HH.Bg,anchor:D,tag:C);}if(block&&A.type==a.Cs){eQB=t.lr;return new RT(B.expand(A.c),HH.Ag,anchor:D,tag:C);}if(block&&A.type==a.KY){eQB=t.mr;return new ST(B.expand(A.c),HH.Ag,anchor:D,tag:C);}if(D!=null||C!=null){eQB=dQB.removeLast();return new yH(B,'',WE.DY,anchor:D,tag:C);}throw new rB("Expected node content.",B);}XC mQB(){var A=cQB.PF();if(A.type==a.hQ){A=cQB.OH();if(A.type==a.hQ||A.type==a.RO){eQB=t.jf;return xQB(A.c.end);}else{dQB.add(t.jf);return lQB(block:true);}}if(A.type==a.RO){cQB.GC();eQB=dQB.removeLast();return new XC(IC.oX,A.c);}throw new rB("While parsing a block collection, expected '-'.",A.c.start.QF());}XC nQB(){var A=cQB.PF();if(A.type!=a.hQ){eQB=dQB.removeLast();return new XC(IC.oX,A.c.start.QF());}var B=A.c.start;A=cQB.OH();if(A.type==a.hQ||A.type==a.AL||A.type==a.tJ||A.type==a.RO){eQB=t.qX;return xQB(B);}else{dQB.add(t.qX);return lQB(block:true);}}XC oQB(){var A=cQB.PF();if(A.type==a.AL){var B=A.c.start;A=cQB.OH();if(A.type==a.AL||A.type==a.tJ||A.type==a.RO){eQB=t.sX;return xQB(B);}else{dQB.add(t.sX);return lQB(block:true,indentlessSequence:true);}}if(A.type==a.tJ){eQB=t.sX;return xQB(A.c.start);}if(A.type==a.RO){cQB.GC();eQB=dQB.removeLast();return new XC(IC.pX,A.c);}throw new rB("Expected a key while parsing a block mapping.",A.c.start.QF());}XC pQB(){var A=cQB.PF();if(A.type!=a.tJ){eQB=t.rX;return xQB(A.c.start);}var B=A.c.start;A=cQB.OH();if(A.type==a.AL||A.type==a.tJ||A.type==a.RO){eQB=t.rX;return xQB(B);}else{dQB.add(t.rX);return lQB(block:true,indentlessSequence:true);}}XC qQB({bool first: false}){if(first)cQB.GC();var A=cQB.PF();if(A.type!=a.fQ){if(!first){if(A.type!=a.SO){throw new rB("While parsing a flow sequence, expected ',' or ']'.",A.c.start.QF());}A=cQB.OH();}if(A.type==a.AL){eQB=t.or;cQB.GC();return new ST(A.c,HH.Bg);}else if(A.type!=a.fQ){dQB.add(t.kf);return lQB();}}cQB.GC();eQB=dQB.removeLast();return new XC(IC.oX,A.c);}XC rQB(){var A=cQB.PF();if(A.type==a.tJ||A.type==a.SO||A.type==a.fQ){var B=A.c.start;eQB=t.lf;return xQB(B);}else{dQB.add(t.lf);return lQB();}}XC sQB(){var A=cQB.PF();if(A.type==a.tJ){A=cQB.OH();if(A.type!=a.SO&&A.type!=a.fQ){dQB.add(t.mf);return lQB();}}eQB=t.mf;return xQB(A.c.start);}XC tQB(){eQB=t.kf;return new XC(IC.pX,cQB.PF().c.start.QF());}XC uQB({bool first: false}){if(first)cQB.GC();var A=cQB.PF();if(A.type!=a.gQ){if(!first){if(A.type!=a.SO){throw new rB("While parsing a flow mapping, expected ',' or '}'.",A.c.start.QF());}A=cQB.OH();}if(A.type==a.AL){A=cQB.OH();if(A.type!=a.tJ&&A.type!=a.SO&&A.type!=a.gQ){dQB.add(t.nf);return lQB();}else{eQB=t.nf;return xQB(A.c.start);}}else if(A.type!=a.gQ){dQB.add(t.qr);return lQB();}}cQB.GC();eQB=dQB.removeLast();return new XC(IC.pX,A.c);}XC vQB({bool empty: false}){var A=cQB.PF();if(empty){eQB=t.tX;return xQB(A.c.start);}if(A.type==a.tJ){A=cQB.OH();if(A.type!=a.SO&&A.type!=a.gQ){dQB.add(t.tX);return lQB();}}eQB=t.tX;return xQB(A.c.start);}XC xQB(GH A)=>new yH(A.QF(),'',WE.DY);XT<YT,List<zH>> wQB(){var A=cQB.PF();var B;var C=<zH>[] ;while(A.type==a.GY||A.type==a.HY){if(A is Cg){if(B!=null){throw new rB("Duplicate %YAML directive.",A.c);}if(A.OF!=1||A.lE==0){throw new rB("Incompatible YAML document. This parser only supports YAML 1.1 " "and 1.2.",A.c);}else if(A.lE>2){Gs("Warning: this parser only supports YAML 1.1 and 1.2.",A.c);}B=new YT(A.OF,A.lE);}else if(A is Dg){var D=new zH(A.SH,A.vF);yQB(D,A.c);C.add(D);}A=cQB.OH();}yQB(new zH("!","!"),A.c.start.QF(),allowDuplicates:true);yQB(new zH("!!","tag:yaml.org,2002:"),A.c.start.QF(),allowDuplicates:true);return new XT(B,C);}void yQB(zH A,DD B,{bool allowDuplicates: false}){if(fQB.containsKey(A.SH)){if(allowDuplicates)return;throw new rB("Duplicate %TAG directive.",B);}fQB[A.SH]=A;}}class t{static const ir=const t("STREAM_START");static const gf=const t("DOCUMENT_START");static const jr=const t("DOCUMENT_CONTENT");static const hf=const t("DOCUMENT_END");static const kr=const t("BLOCK_NODE");static const V6=const t("BLOCK_NODE_OR_INDENTLESS_SEQUENCE");static const W6=const t("FLOW_NODE");static const lr=const t("BLOCK_SEQUENCE_FIRST_ENTRY");static const jf=const t("BLOCK_SEQUENCE_ENTRY");static const qX=const t("INDENTLESS_SEQUENCE_ENTRY");static const mr=const t("BLOCK_MAPPING_FIRST_KEY");static const rX=const t("BLOCK_MAPPING_KEY");static const sX=const t("BLOCK_MAPPING_VALUE");static const nr=const t("FLOW_SEQUENCE_FIRST_ENTRY");static const kf=const t("FLOW_SEQUENCE_ENTRY");static const or=const t("FLOW_SEQUENCE_ENTRY_MAPPING_KEY");static const lf=const t("FLOW_SEQUENCE_ENTRY_MAPPING_VALUE");static const mf=const t("FLOW_SEQUENCE_ENTRY_MAPPING_END");static const pr=const t("FLOW_MAPPING_FIRST_KEY");static const tX=const t("FLOW_MAPPING_KEY");static const nf=const t("FLOW_MAPPING_VALUE");static const qr=const t("FLOW_MAPPING_EMPTY_VALUE");static const rr=const t("END");final String name;const t(this.name);String toString()=>name;}class pf{static const qJ=0x9;static const rJ=0xA;static const sJ=0xD;static const qI=0x20;static const X6=0x24;static const Y6=0x28;static const Z6=0x29;static const TT=0x2B;static const UT=0x2C;static const uX=0x2D;static const a6=0x2E;static const qf=0x3F;static const vX=0x3A;static const b6=0x3B;static const c6=0x3D;static const wX=0x5B;static const VT=0x5D;static const rf=0x7B;static const xX=0x7D;static const sf=0x23;static const sr=0x26;static const tr=0x2A;static const ur=0x21;static const d6=0x7C;static const e6=0x3C;static const f6=0x3E;static const QO=0x27;static const yX=0x22;static const zX=0x25;static const tf=0x40;static const vr=0x60;static const g6=0x7E;static const h6=0x0;static const i6=0x7;static const j6=0x8;static const k6=0xB;static const l6=0xC;static const m6=0x1B;static const wr=0x2F;static const uf=0x5C;static const n6=0x5F;static const AY=0x85;static const o6=0xA0;static const p6=0x2028;static const q6=0x2029;static const vf=0xFEFF;static const zK=0x30;static const BY=0x39;static const CY=0x61;static const r6=0x62;static const s6=0x65;static const xr=0x66;static const t6=0x6E;static const u6=0x72;static const v6=0x74;static const w6=0x75;static const x6=0x76;static const y6=0x78;static const z6=0x7A;static const wf=0x41;static const yr=0x46;static const A7=0x4C;static const B7=0x4E;static const C7=0x50;static const D7=0x55;static const E7=0x5A;final cQ zQB;var ARB=false;var BRB=false;final CRB=new Bm<qC>();var DRB=0;var ERB=false;final FRB=<int>[-1];var GRB=true;final HRB=<xf>[null];int get IRB=>FRB.last;bool get JRB=>HRB.length==1;bool get KRB=>zQB.NJ||LRB;bool get LRB=>MRB(0);bool get NRB=>ORB(0);bool get PRB=>QRB(0);bool get RRB{var A=zQB.mB();if(A==null)return false;switch (A){case uX:case b6:case wr:case vX:case tf:case sr:case c6:case TT:case X6:case a6:case g6:case qf:case tr:case QO:case Y6:case Z6:case zX:return true;default:return (A>=zK&&A<=BY)||(A>=CY&&A<=z6)||(A>=wf&&A<=E7);}}bool get SRB{if(!TRB)return false;switch (zQB.mB()){case UT:case wX:case VT:case rf:case xX:return false;default:return true;}}bool get URB{var A=zQB.mB();return A!=null&&(A>=zK&&A<=BY);}bool get VRB{var A=zQB.mB();if(A==null)return false;return (A>=zK&&A<=BY)||(A>=CY&&A<=xr)||(A>=wf&&A<=yr);}bool get WRB=>XRB(0);bool get YRB{var A=zQB.mB();if(A==null)return false;switch (A){case rJ:case sJ:case vf:return false;case qJ:case AY:return true;default:return (A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF);}}bool get TRB{var A=zQB.mB();if(A==null)return false;switch (A){case rJ:case sJ:case vf:case qI:return false;case AY:return true;default:return (A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF);}}bool get ZRB{return zQB.RC==0&&ORB(3)&&(zQB.kD('---')||zQB.kD('...'));}pf(String A,{sourceUrl}):zQB=new cQ.REB(A,sourceUrl:sourceUrl);qC GC(){if(BRB)throw new StateError("Out of tokens.");if(!ERB)aRB();var A=CRB.removeFirst();ERB=false;DRB++ ;BRB=A is qC&&A.type==a.WT;return A;}qC OH(){GC();return PF();}qC PF(){if(BRB)return null;if(!ERB)aRB();return CRB.first;}void aRB(){while(true){if(CRB.isNotEmpty){bRB();if(!HRB.any((A)=>A!=null&&A.ta==DRB)){break;}}cRB();}ERB=true;}void cRB(){if(!ARB){dRB();return;}eRB();bRB();fRB(zQB.RC);if(zQB.NJ){gRB();return;}if(zQB.RC==0){if(zQB.mB()==zX){hRB();return;}if(ORB(3)){if(zQB.kD('---')){iRB(a.IY);return;}if(zQB.kD('...')){iRB(a.JY);return;}}}switch (zQB.mB()){case wX:jRB(a.Ds);return;case rf:jRB(a.Es);return;case VT:kRB(a.fQ);return;case xX:kRB(a.gQ);return;case UT:lRB();return;case tr:mRB(anchor:false);return;case sr:mRB(anchor:true);return;case ur:nRB();return;case QO:oRB(singleQuote:true);return;case yX:oRB(singleQuote:false);return;case d6:if(!JRB)pRB();qRB(literal:true);return;case f6:if(!JRB)pRB();qRB(literal:false);return;case zX:case tf:case vr:pRB();return;case uX:if(XRB(1)){rRB();}else{sRB();}return;case qf:if(XRB(1)){rRB();}else{tRB();}return;case vX:if(!JRB&&CRB.isNotEmpty){var A=CRB.last;if(A.type==a.fQ||A.type==a.gQ||(A.type==a.Fs&&(A as eQ).MB.t$)){uRB();return;}}if(XRB(1)){rRB();}else{uRB();}return;default:if(!YRB)pRB();rRB();return;}throw 'Inaccessible';}void pRB()=>zQB.error("Unexpected character.",length:1);void bRB(){for(var A=0;A<HRB.length;A++ ){var B=HRB[A];if(B==null)continue;if(!JRB)continue;if(B.HD==zQB.HD)continue;if(B.Ak){throw new rB("Expected ':'.",zQB.pF);}HRB[A]=null;}}void vRB(){var A=JRB&&IRB==zQB.RC;assert(GRB||!A);if(!GRB)return;wRB();HRB[HRB.length-1]=new xf(DRB+CRB.length,zQB.HD,zQB.RC,zQB.location,required:A);}void wRB(){var A=HRB.last;if(A!=null&&A.Ak){throw new rB("Could not find expected ':' for simple key.",A.location.QF());}HRB[HRB.length-1]=null;}void xRB(){HRB.add(null);}void yRB(){if(JRB)return;HRB.removeLast();}void zRB(int A,a C,GH D,{int tokenNumber}){if(!JRB)return;if(IRB!=-1&&IRB>=A)return;FRB.add(A);var B=new qC(C,D.QF());if(tokenNumber==null){CRB.add(B);}else{CRB.insert(tokenNumber-DRB,B);}}void fRB(int A){if(!JRB)return;while(IRB>A){CRB.add(new qC(a.RO,zQB.pF));FRB.removeLast();}}void ASB()=>fRB(-1);void dRB(){ARB=true;CRB.add(new qC(a.Bs,zQB.pF));}void gRB(){ASB();wRB();GRB=false;CRB.add(new qC(a.WT,zQB.pF));}void hRB(){ASB();wRB();GRB=false;var A=BSB();if(A!=null)CRB.add(A);}void iRB(a A){ASB();wRB();GRB=false;var B=zQB.state;zQB.cB();zQB.cB();zQB.cB();CRB.add(new qC(A,zQB.RF(B)));}void jRB(a A){vRB();xRB();GRB=true;CSB(A);}void kRB(a A){wRB();yRB();GRB=false;CSB(A);}void lRB(){wRB();GRB=true;CSB(a.SO);}void sRB(){if(JRB){if(!GRB){throw new rB("Block sequence entries are not allowed here.",zQB.pF);}zRB(zQB.RC,a.Cs,zQB.location);}else{}wRB();GRB=true;CSB(a.hQ);}void tRB(){if(JRB){if(!GRB){throw new rB("Mapping keys are not allowed here.",zQB.pF);}zRB(zQB.RC,a.KY,zQB.location);}GRB=JRB;CSB(a.AL);}void uRB(){var A=HRB.last;if(A!=null){CRB.insert(A.ta-DRB,new qC(a.AL,A.location.QF()));zRB(A.RC,a.KY,A.location,tokenNumber:A.ta);HRB[HRB.length-1]=null;GRB=false;}else if(JRB){if(!GRB){throw new rB("Mapping values are not allowed here. Did you miss a colon " "earlier?",zQB.pF);}zRB(zQB.RC,a.KY,zQB.location);GRB=true;}else if(GRB){GRB=false;CSB(a.AL);}CSB(a.tJ);}void CSB(a A){var B=zQB.state;zQB.cB();CRB.add(new qC(A,zQB.RF(B)));}void mRB({bool anchor: true}){vRB();GRB=false;CRB.add(DSB(anchor:anchor));}void nRB(){vRB();GRB=false;CRB.add(ESB());}void qRB({bool literal: false}){wRB();GRB=true;CRB.add(FSB(literal:literal));}void oRB({bool singleQuote: false}){vRB();GRB=false;CRB.add(GSB(singleQuote:singleQuote));}void rRB(){vRB();GRB=false;CRB.add(HSB());}void eRB(){var A=false;while(true){if(zQB.RC==0)zQB.GC("\uFEFF");while(zQB.mB()==qI||((!JRB||!A)&&zQB.mB()==qJ)){zQB.cB();}if(zQB.mB()==qJ){zQB.error("Tab characters are not allowed as indentation.",length:1);}ISB();if(LRB){JSB();if(JRB)GRB=true;A=true;}else{break;}}}qC BSB(){var A=zQB.state;zQB.cB();var B;var C=KSB();if(C=="YAML"){B=LSB(A);}else if(C=="TAG"){B=MSB(A);}else{Gs("Warning: unknown directive.",zQB.RF(A));while(!KRB){zQB.cB();}return null;}NSB();ISB();if(!KRB){throw new rB("Expected comment or line break after directive.",zQB.RF(A));}JSB();return B;}String KSB(){var B=zQB.position;while(TRB){zQB.cB();}var A=zQB.substring(B);if(A.isEmpty){throw new rB("Expected directive name.",zQB.pF);}else if(!NRB){throw new rB("Unexpected character in directive name.",zQB.pF);}return A;}qC LSB(fM A){NSB();var B=OSB();zQB.QR('.');var C=OSB();return new Cg(zQB.RF(A),B,C);}int OSB(){var B=zQB.position;while(URB){zQB.cB();}var A=zQB.substring(B);if(A.isEmpty){throw new rB("Expected version number.",zQB.pF);}return int.parse(A);}qC MSB(fM A){NSB();var B=PSB(directive:true);if(!PRB){throw new rB("Expected whitespace.",zQB.pF);}NSB();var C=QSB();if(!NRB){throw new rB("Expected whitespace.",zQB.pF);}return new Dg(zQB.RF(A),B,C);}qC DSB({bool anchor: true}){var C=zQB.state;zQB.cB();var D=zQB.position;while(SRB){zQB.cB();}var B=zQB.substring(D);var A=zQB.mB();if(B.isEmpty||(!NRB&&A!=qf&&A!=vX&&A!=UT&&A!=VT&&A!=xX&&A!=zX&&A!=tf&&A!=vr)){throw new rB("Expected alphanumeric character.",zQB.pF);}if(anchor){return new EY(zQB.RF(C),B);}else{return new Eg(zQB.RF(C),B);}}qC ESB(){var A;var B;var C=zQB.state;if(zQB.mB(1)==e6){zQB.cB();zQB.cB();A='';B=QSB();zQB.QR('>');}else{A=PSB();if(A.length>1&&A.startsWith('!')&&A.endsWith('!')){B=QSB(flowSeparators:false);}else{B=QSB(head:A,flowSeparators:false);if(B.isEmpty){A=null;B='!';}else{A='!';}}}return new FY(zQB.RF(C),A,B);}String PSB({bool directive: false}){zQB.QR('!');var A=new StringBuffer('!');var B=zQB.position;while(RRB){zQB.cB();}A.write(zQB.substring(B));if(zQB.mB()==ur){A.writeCharCode(zQB.cB());}else{if(directive&&A.toString()!='!')zQB.QR('!');}return A.toString();}String QSB({String head,bool flowSeparators: true}){var B=head==null?0:head.length;var C=new StringBuffer();if(B>1)C.write(head.substring(1));var D=zQB.position;var A=zQB.mB();while(RRB||(flowSeparators&&(A==UT||A==wX||A==VT))){zQB.cB();A=zQB.mB();}return Uri.decodeFull(zQB.substring(D));}qC FSB({bool literal: false}){var K=zQB.state;zQB.cB();var I=rI.F7;var D=0;var A=zQB.mB();if(A==TT||A==uX){I=A==TT?rI.zf:rI.yf;zQB.cB();if(URB){if(zQB.mB()==zK){throw new rB("0 may not be used as an indentation indicator.",zQB.RF(K));}D=zQB.cB()-zK;}}else if(URB){if(zQB.mB()==zK){throw new rB("0 may not be used as an indentation indicator.",zQB.RF(K));}D=zQB.cB()-zK;A=zQB.mB();if(A==TT||A==uX){I=A==TT?rI.zf:rI.yf;zQB.cB();}}NSB();ISB();if(!KRB){throw new rB("Expected comment or line break.",zQB.pF);}JSB();var C=0;if(D!=0){C=IRB>=0?IRB+D:D;}var G=RSB(C);C=G.first;var J=G.last;var B=new StringBuffer();var H='';var M=false;var O=false;var P=zQB.state;while(zQB.RC==C&&!zQB.NJ){if(ZRB)break;O=PRB;if(!literal&&H.isNotEmpty&&!M&&!O){if(J.isEmpty)B.writeCharCode(qI);}else{B.write(H);}H='';B.write(J);M=PRB;var Q=zQB.position;while(!KRB){zQB.cB();}B.write(zQB.substring(Q));P=zQB.state;if(!zQB.NJ)H=SSB();var G=RSB(C);C=G.first;J=G.last;}if(I!=rI.yf)B.write(H);if(I==rI.zf)B.write(J);return new eQ(zQB.RF(K,P),B.toString(),literal?WE.H7:WE.I7);}XT<int,String> RSB(int A){var B=0;var C=new StringBuffer();while(true){while((A==0||zQB.RC<A)&&zQB.mB()==qI){zQB.cB();}if(zQB.RC>B)B=zQB.RC;if(!LRB)break;C.write(SSB());}if(A==0){A=B;if(A<IRB+1)A=IRB+1;}return new XT(A,C.toString());}qC GSB({bool singleQuote: false}){var O=zQB.state;var A=new StringBuffer();zQB.cB();while(true){if(ZRB){zQB.error("Unexpected document indicator.");}if(zQB.NJ){throw new rB("Unexpected end of file.",zQB.pF);}var D=false;while(!NRB){var G=zQB.mB();if(singleQuote&&G==QO&&zQB.mB(1)==QO){zQB.cB();zQB.cB();A.writeCharCode(QO);}else if(G==(singleQuote?QO:yX)){break;}else if(!singleQuote&&G==uf&&MRB(1)){zQB.cB();JSB();D=true;break;}else if(!singleQuote&&G==uf){var I=zQB.state;var B=null;switch (zQB.mB(1)){case zK:A.writeCharCode(h6);break;case CY:A.writeCharCode(i6);break;case r6:A.writeCharCode(j6);break;case v6:case qJ:A.writeCharCode(qJ);break;case t6:A.writeCharCode(rJ);break;case x6:A.writeCharCode(k6);break;case xr:A.writeCharCode(l6);break;case u6:A.writeCharCode(sJ);break;case s6:A.writeCharCode(m6);break;case qI:case yX:case wr:case uf:A.writeCharCode(zQB.mB(1));break;case B7:A.writeCharCode(AY);break;case n6:A.writeCharCode(o6);break;case A7:A.writeCharCode(p6);break;case C7:A.writeCharCode(q6);break;case y6:B=2;break;case w6:B=4;break;case D7:B=8;break;default:throw new rB("Unknown escape character.",zQB.RF(I));}zQB.cB();zQB.cB();if(B!=null){var C=0;for(var K=0;K<B;K++ ){if(!VRB){zQB.cB();throw new rB("Expected ${B}-digit hexidecimal number.",zQB.RF(I));}C=(C<<4)+TSB(zQB.cB());}if((C>=0xD800&&C<=0xDFFF)||C>0x10FFFF){throw new rB("Invalid Unicode character escape code.",zQB.RF(I));}A.writeCharCode(C);}}else{A.writeCharCode(zQB.cB());}}if(zQB.mB()==(singleQuote?QO:yX)){break;}var H=new StringBuffer();var M='';var J=new StringBuffer();while(PRB||LRB){if(PRB){if(!D){H.writeCharCode(zQB.cB());}else{zQB.cB();}}else{if(!D){H.clear();M=SSB();D=true;}else{J.write(SSB());}}}if(D){if(M.isNotEmpty&&J.isEmpty){A.writeCharCode(qI);}else{A.write(J);}}else{A.write(H);H.clear();}}zQB.cB();return new eQ(zQB.RF(O),A.toString(),singleQuote?WE.zr:WE.As);}qC HSB(){var I=zQB.state;var G=zQB.state;var B=new StringBuffer();var A='';var C='';var D=new StringBuffer();var H=IRB+1;while(true){if(ZRB)break;if(zQB.mB()==sf)break;if(WRB){if(A.isNotEmpty){if(C.isEmpty){B.writeCharCode(qI);}else{B.write(C);}A='';C='';}else{B.write(D);D.clear();}}var J=zQB.position;while(WRB){zQB.cB();}B.write(zQB.substring(J));G=zQB.state;if(!PRB&&!LRB)break;while(PRB||LRB){if(PRB){if(A.isNotEmpty&&zQB.RC<H&&zQB.mB()==qJ){zQB.error("Expected a space but found a tab.",length:1);}if(A.isEmpty){D.writeCharCode(zQB.cB());}else{zQB.cB();}}else{if(A.isEmpty){A=SSB();D.clear();}else{C=SSB();}}}if(JRB&&zQB.RC<H)break;}if(A.isNotEmpty)GRB=true;return new eQ(zQB.RF(I,G),B.toString(),WE.DY);}void JSB(){var A=zQB.mB();if(A!=sJ&&A!=rJ)return;zQB.cB();if(A==sJ&&zQB.mB()==rJ)zQB.cB();}String SSB(){var A=zQB.mB();if(A!=sJ&&A!=rJ){throw new rB("Expected newline.",zQB.pF);}zQB.cB();if(A==sJ&&zQB.mB()==rJ)zQB.cB();return "\n";}bool QRB(int B){var A=zQB.mB(B);return A==qI||A==qJ;}bool MRB(int B){var A=zQB.mB(B);return A==sJ||A==rJ;}bool ORB(int B){var A=zQB.mB(B);return A==null||A==qI||A==qJ||A==sJ||A==rJ;}bool XRB(int A){switch (zQB.mB(A)){case vX:return USB(A+1);case sf:var B=zQB.mB(A-1);return B!=qI&&B!=qJ;default:return USB(A);}}bool USB(int B){var A=zQB.mB(B);switch (A){case UT:case wX:case VT:case rf:case xX:return JRB;case qI:case qJ:case rJ:case sJ:case vf:return false;case AY:return true;default:return A!=null&&((A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF));}}int TSB(int A){if(A<=BY)return A-zK;if(A<=yr)return 10+A-wf;return 10+A-CY;}void NSB(){while(PRB){zQB.cB();}}void ISB(){if(zQB.mB()!=sf)return;while(!KRB){zQB.cB();}}}class xf{final int ta;final GH location;final int HD;final int RC;final bool Ak;xf(this.ta,this.HD,this.RC,this.location,{bool required}):Ak=required;}class rI{static const yf=const rI("STRIP");static const F7=const rI("CLIP");static const zf=const rI("KEEP");final String name;const rI(this.name);String toString()=>name;}class WE{static const G7=const WE.iDB("ANY");static const DY=const WE.iDB("PLAIN");static const H7=const WE.iDB("LITERAL");static const I7=const WE.iDB("FOLDED");static const zr=const WE.iDB("SINGLE_QUOTED");static const As=const WE.iDB("DOUBLE_QUOTED");final String name;bool get t$=>this==zr||this==As;const WE.iDB(this.name);String toString()=>name;}class HH{static const Ag=const HH.jDB("BLOCK");static const Bg=const HH.jDB("FLOW");final String name;const HH.jDB(this.name);String toString()=>name;}class qC{final a type;final DD c;qC(this.type,this.c);String toString()=>type.toString();}class Cg implements qC{get type=>a.GY;final DD c;final int OF;final int lE;Cg(this.c,this.OF,this.lE);String toString()=>"VERSION_DIRECTIVE ${OF}.${lE}";}class Dg implements qC{get type=>a.HY;final DD c;final String SH;final String vF;Dg(this.c,this.SH,this.vF);String toString()=>"TAG_DIRECTIVE ${SH} ${vF}";}class EY implements qC{get type=>a.K7;final DD c;final String name;EY(this.c,this.name);String toString()=>"ANCHOR ${name}";}class Eg implements qC{get type=>a.J7;final DD c;final String name;Eg(this.c,this.name);String toString()=>"ALIAS ${name}";}class FY implements qC{get type=>a.L7;final DD c;final String SH;final String ka;FY(this.c,this.SH,this.ka);String toString()=>"TAG ${SH} ${ka}";}class eQ implements qC{get type=>a.Fs;final DD c;final String value;final WE MB;eQ(this.c,this.value,this.MB);String toString()=>"SCALAR ${MB} \"${value}\"";}class a{static const Bs=const a.kDB("STREAM_START");static const WT=const a.kDB("STREAM_END");static const GY=const a.kDB("VERSION_DIRECTIVE");static const HY=const a.kDB("TAG_DIRECTIVE");static const IY=const a.kDB("DOCUMENT_START");static const JY=const a.kDB("DOCUMENT_END");static const Cs=const a.kDB("BLOCK_SEQUENCE_START");static const KY=const a.kDB("BLOCK_MAPPING_START");static const RO=const a.kDB("BLOCK_END");static const Ds=const a.kDB("FLOW_SEQUENCE_START");static const fQ=const a.kDB("FLOW_SEQUENCE_END");static const Es=const a.kDB("FLOW_MAPPING_START");static const gQ=const a.kDB("FLOW_MAPPING_END");static const hQ=const a.kDB("BLOCK_ENTRY");static const SO=const a.kDB("FLOW_ENTRY");static const AL=const a.kDB("KEY");static const tJ=const a.kDB("VALUE");static const J7=const a.kDB("ALIAS");static const K7=const a.kDB("ANCHOR");static const L7=const a.kDB("TAG");static const Fs=const a.kDB("SCALAR");final String name;const a.kDB(this.name);String toString()=>name;}class XT<XB,Y7>{final XB first;final Y7 last;XT(this.first,this.last);String toString()=>'(${first}, ${last})';}void Gs(String A,[qD B])=>N7(A,B);typedef dynamic M7(String _0,[qD _1]);M7 N7=(A,[B]){if(B!=null)A=B.message(A);print(A);};String R7(B){var A=new StringBuffer();S7(B,A);return A.toString();}void S7(A,StringSink B){Fg(A,0,B,true);}void Fg(A,int C,StringSink B,bool D){if(A is Map){U7(A,C,B,D);}else if(A is Iterable){W7(A,C,B,D);}else if(A is String){B..writeln('"${T7(A)}"');}else if(A is double){B.writeln("!!float ${A}");}else{B.writeln(A);}}String T7(String A)=>A.replaceAll('"',r'\"').replaceAll("\n",r"\n");void U7(Map C,int B,StringSink A,bool G){if(!G){A.writeln();B+= 2;}final H=V7(C);H.forEach((D){final I=C[D];Ks(B,A);A..write(D)..write(': ');Fg(I,B,A,false);});}Iterable<String> V7(Map H){final B=[] ;final C=[] ;final D=[] ;H.forEach((A,G){if(G is String){B.add(A);}else if(G is Map){C.add(A);}else{D.add(A);}});return i5([B..sort(),C..sort(),D..sort()]);}void W7(Iterable C,int B,StringSink A,bool D){if(!D){A.writeln();B+= 2;}C.forEach((G){Ks(B,A);A.write('- ');Fg(G,B,A,false);});}void Ks(int A,StringSink B)=>B.write(' '*A);class iQ{final xD Ii;final qD c;final YT versionDirective;final List<zH> na;final bool startImplicit;final bool endImplicit;iQ.lDB(this.Ii,this.c,this.versionDirective,List<zH> A,{this.startImplicit: false,this.endImplicit: false}):na=new UnmodifiableListView(A);String toString()=>Ii.toString();}class YT{final int OF;final int lE;YT(this.OF,this.lE);String toString()=>"%YAML ${OF}.${lE}";}class zH{final String SH;final String vF;zH(this.SH,this.vF);String toString()=>"%TAG ${SH} ${vF}";}abstract class xD{qD get c=>VSB;qD VSB;get value;}class Hs extends xD with MapMixin,Yz{final Map<dynamic,xD> g;final HH MB;Map get value=>this;Iterable get keys=>g.keys.map((A)=>A.value);Hs.mDB(Map<dynamic,xD> A,qD B,this.MB):g=new UnmodifiableMapView<dynamic,xD>(A){VSB=B;}operator[](B){var A=g[B];return A==null?null:A.value;}}class Is extends xD with ListMixin{final List<xD> g;final HH MB;List get value=>this;int get length=>g.length;set length(int A){throw new UnsupportedError("Cannot modify an unmodifiable List");}Is.nDB(List<xD> A,qD B,this.MB):g=new UnmodifiableListView<xD>(A){VSB=B;}operator[](int A)=>g[A].value;operator[]=(int A,B){throw new UnsupportedError("Cannot modify an unmodifiable List");}}class JE extends xD{final value;final WE MB;JE.oDB(this.value,yH A):MB=A.MB{VSB=A.c;}JE.pDB(this.value,qD A):MB=WE.G7{VSB=A;}String toString()=>value.toString();}void Js(xD A,qD B){A.VSB=B;}