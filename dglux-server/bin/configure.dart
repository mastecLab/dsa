import "dart:async";import "dart:io";import "dart:io" as JM;import "dart:collection";import "dart:math";import "dart:math" as eD;import "dart:convert";import "dart:typed_data";class jB{final Map<String,GB> XR;final Map<String,jB> YR;final Map<String,GB> VC;final Map<String,jB> oK;final ZR=[] ;final bool iK;factory jB({bool allowTrailingOptions: false})=>new jB.uQ(<String,GB>{},<String,jB>{},allowTrailingOptions:allowTrailingOptions);jB.uQ(Map<String,GB> A,Map<String,jB> B,{bool allowTrailingOptions: false}):this.XR=A,this.VC=new UnmodifiableMapView(A),this.YR=B,this.oK=new UnmodifiableMapView(B),this.iK=allowTrailingOptions!=null?allowTrailingOptions:false;void eK(String A,{String abbr,String help,bool defaultsTo: false,bool negatable: true,void callback(bool value),bool hide: false}){aR(A,abbr,help,null,null,null,defaultsTo,callback,kB.JI,negatable:negatable,hide:hide);}void aR(String A,String B,String H,String K,List<String> O,Map<String,String> P,Z,void j(value),kB EB,{bool negatable: false,bool splitCommas,bool hide: false}){if(XR.containsKey(A)){throw new ArgumentError('Duplicate option "${A}".');}if(B!=null){var C=hF(B);if(C!=null){throw new ArgumentError('Abbreviation "${B}" is already used by "${C.name}".');}}var D=OM(A,B,H,K,O,P,Z,j,EB,negatable:negatable,splitCommas:splitCommas,hide:hide);XR[A]=D;ZR.add(D);}oC DB(List<String> A)=>new fD(null,this,A.toList()).DB();String get qQ=>new LI(ZR).JQ();GB hF(String A){return VC.values.firstWhere((B)=>B.fC==A,orElse:()=>null);}}oC NM(jB A,Map<String,dynamic> B,String C,oC D,List<String> H,List<String> K){return new oC.vQ(A,B,C,D,H,K);}class oC{final jB bR;final Map<String,dynamic> cR;final String name;final oC tP;final List<String> zB;final List<String> arguments;oC.vQ(this.bR,this.cR,this.name,this.tP,List<String> A,List<String> B):this.zB=new UnmodifiableListView(A),this.arguments=new UnmodifiableListView(B);operator[](String A){if(!bR.VC.containsKey(A)){throw new ArgumentError('Could not find an option named "${A}".');}return bR.VC[A].ML(cR[A]);}Iterable<String> get VC{var A=new Set<String>.from(cR.keys);bR.VC.forEach((B,C){if(C.PC!=null)A.add(B);});return A;}}const int DG=0x0A;const int NI=0x0D;const int EG=0x2B;const int FG=0x2D;const int VE=0x2E;const int JD=0x30;const int WE=0x39;const int SM=0x46;const int TM=0x4E;const int UM=0x54;const int VM=0x66;const int WM=0x6E;const int XM=0x6F;const int YM=0x74;const int ZM=0x78;const int aM=0x7E;const String ON='\u001b[31m';const String zI='\u001b[0m';main(List<String> B)async{await MM();eM();if(B.isEmpty){B=<String>["--interactive"];}var A=new jB();A.eK("interactive",abbr:"i",help:"Interactive Configuration",negatable:false);A.eK("create-ssl-request",help:"Generate an SSL Request",negatable:false);var D=A.DB(B);if(D["create-ssl-request"]){var H=new Directory("certs").absolute;if(!(await H.exists())){await H.create(recursive:true);}var C=new File(rC("certs","key.pem")).absolute;if(!(await C.exists())){print("Generating Private Key (4096-bit RSA)...");await YI(<String>["genrsa","-out",C.path,"4096"]);print("Generated Private Key.");}var K=new File(rC("certs","server.csr")).absolute;print("Generating Certificate Request...");await YI(<String>["req","-new","-sha256","-key",C.path,"-out",K.path],inherit:true,stdin:true);print("Generated Certificate Request.");print("Send the file certs/server.csr to your SSL" " provider to generate a certificate.");exit(0);}else if(D["interactive"]){await KM();}else{print("Usage: configure <options>");print(A.qQ);exit(1);}}KM()async{WI A=new WI();await A.VQ();Stream<String> EB=JM.stdin.transform(const Utf8Decoder()).transform(const LineSplitter()).asBroadcastStream();Future<String> K(String iB)async{JM.stdout.write(iB);return (await EB.first).trim();}Future<int> H(String D,[int B,bool P=false])async{while(true){var C=await K(B!=null?"${D} [${B}${P?'ms':''}]: ":"${D}: ");if(C.isEmpty){if(B!=null){return B;}else{continue;}}if(P&&C.endsWith("ms")){C=C.substring(0,C.length-2);}if(!LM(C)){print("Invalid Integer.");continue;}return int.parse(C);}}Future<bool> O(String D,[bool B])async{while(true){var C=await K(B!=null?"${D}? [${B?'yes':'no'}]: ":"${D}? (yes/no): ");if(C.isEmpty){if(B!=null){return B;}else{continue;}}var BC=["yes","y","yeah","true"];var dD=["no","n","nope","false"];if(BC.contains(C)){return true;}else if(dD.contains(C)){return false;}else{print("Unknown Response. Try 'yes' or 'no'.");}}}Future<String> Z(String D,[String B])async{while(true){var C=await K(B!=null?"${D} [${B}]: ":"${D}: ");if(C.isEmpty){if(B!=null){return B;}else{continue;}}return C;}}A.port=await H("Server Port",A.port);A.UE=await H("Server Workers",A.UE);var j=false;if(j=await O("Enable HTTPS",false)){A.kF=await H("HTTPS Port",A.kF);A.JE=await Z("Certificate Name",A.JE);A.KE=await Z("Certificate Password",A.KE);}A.IE=await O("Broadcast Broker",A.IE);A.SE=await H("Update Interval",A.SE,true);A.QE=await O("Enable Quarantine",A.QE);print("Configuration:");print("  Server Port: ${A.port}");print("  Server Workers: ${A.UE}");if(j){print("  Enable HTTPS: yes");print("  Certificate Name: ${A.JE}");print("  Certificate Password: ${A.KE}");}else{print("  Enable HTTPS: no");}print("  Broadcast Broker: ${A.IE?'yes':'no'}");print("  Update Interval: ${A.SE}ms");print("  Enable Quarantine: ${A.QE?'yes':'no'}");await A.xH();print("Configuration Saved!");exit(0);}bool LM(String A)=>int.parse(A,onError:(B)=>null)!=null;MM()async{var B=Platform.script.toFilePath(windows:Platform.isWindows);var C=dI(B);var A=dI(C);var D=new File(rC(A,"bin","daemon.dart"));if(await D.exists()){Directory.current=new Directory(A);}}class WI{bool qK;int port;int kF;String KE;String JE;String mK;bool tK;bool IE;int UE;String host;int SE;String fH;String hH;Map<String,String> uF;Map<String,Map<String,dynamic>> YL;Map<String,Map<String,dynamic>> DM;String gH;bool wH;List<String> uK;String EM;bool QE;bool fK;List rK;bool HM;int lL;int mL;String dL;String PL;String kK;String CM;String aL;String wK;bool FM;bool GM;String xK;bool rL;bool BL;String uL;List<String> cL;Map<String,String> proxies;Map<String,List<String>> RL;List<String> vL;List<String> pK;List<String> WL;int IM;bool gK;bool AL;bool hK;bool XL;Map<String,String> ZL;bool BM;String HL;bool zK;String jK;Map<String,List<String>> SL;bool TL;String zL;dynamic gL;dynamic get(A,[B]){if(A is!List){A=[A];}for(var C in A){if(map[C]!=null){return map[C];}}if(B is Function){return B();}else{return B;}}dynamic map;void load(Map B){this.map=B;qK=get("debug",false);port=get("port",dR);kF=get(["httpsPort","httpsport"],eR);JE=get("certName","");KE=get("certPassword","");mK=get("certKeyName","");tK=get("disableFileSecurity",false);IE=get("broadcast",false);fH=get("broadcastUrl");UE=get("workers",Platform.numberOfProcessors==1?1:2);SE=get("updateInterval",200);var A=<String,String>{"/.well-known":"${Directory.current.absolute.path}/.well-known"};uF=get("static",A);if(!uF.containsKey("/.well-known")){uF.addAll(A);}YL=get("linkConfig",{});hH=get("brokerUrl");gH=get("brokerName","broker-");uK=get("disabledLinks",[] );wH=get("runBrokerInMain",Platform.numberOfProcessors==1?true:false);EM=get("uptimeCheckUrl");BL=get("enableUptimeChecker",true);DM=get("upstream",{});QE=get("quarantine",false);fK=get("allowAllLinks",true);rK=get("defaultPermission",null);HM=get("useRuntimeManager",false);FM=get("useDartRuntimeManager",false);GM=get("useJavaRuntimeManager",false);lL=get("passwordHasherIterations",1000);mL=get("passwordHasherKeyLength",32);dL=get("loginRedirectPath","/");kK=get("authType","file");CM=get("twoFactorAuth","none");xK=get("downstreamName","conns");rL=get("runPortChecks",true);zL=get("storageDriver",'simple');gL=get("observe",false);host=get("host","0.0.0.0");cL=get("loggers",[] );proxies=get("proxies",{});RL=get("hooks",{});wK=get("distributionUrl",dM);aL=get("linkRepositoryUrl",cM);vL=get("serverVmFlags",[] );pK=get("dartRuntimeManagerVmFlags",[] );WL=get("javaRuntimeManagerVmFlags",[] );IM=get("userTimeout",525600);gK=get("allowBrowserCaching",false);uL=get("serverLogLevel","INFO");AL=get("enableIPv6",false);PL=get("guestLoginRedirectPath",null);hK=get("allowPasswordChanges",true);XL=get("keepCustomAssets",false);ZL=get("linkManagerEnvironment",{});BM=get("timeHttpRequests",false);HL=get("generatedCertificateSubject","/C=US/ST=California/L=Oakland/O=DGLogik Inc./OU=Customers/CN=*");zK=get("enableCertificateGeneration",true);jK=get("alternativeBrokerUrl",null);SL=get("httpPathClassification",{});TL=get("isAlwaysOffline",false);}Future<bool> VQ([String A="server"])async{if(await jD.KG.oH(".docker").exists()){dR=80;eR=443;}var B=await XI(A);if(!(await B.exists())){load({"downstreamName":"downstream"});await xH(A);return true;}var C=await fM(B);load(C);var D=sL();if(const JsonEncoder().convert(C)!=const JsonEncoder().convert(D)){await xH(A);}return false;}int eR=8443;int dR=8080;Map sL(){var A={"debug":qK,"host":host,"port":port,"httpsPort":kF,"certName":JE,"certKeyName":mK,"certPassword":KE,"disableFileSecurity":tK,"isAlwaysOffline":TL,"broadcast":IE,"workers":UE,"updateInterval":SE,"static":uF,"linkConfig":YL,"disabledLinks":uK,"uptimeCheckUrl":EM,"upstream":DM,"quarantine":QE,"allowAllLinks":fK,"defaultPermission":rK,"useRuntimeManager":HM,"useDartRuntimeManager":FM,"useJavaRuntimeManager":GM,"passwordHasherIterations":lL,"passwordHasherKeyLength":mL,"loginRedirectPath":dL,"guestLoginRedirectPath":PL,"authType":kK,"twoFactorAuth":CM,"runPortChecks":rL,"storageDriver":zL,"downstreamName":xK,"enableUptimeChecker":BL,"observe":gL,"loggers":cL,"proxies":proxies,"hooks":RL,"distributionUrl":wK,"linkRepositoryUrl":aL,"serverVmFlags":vL,"userTimeout":IM,"allowBrowserCaching":gK,"serverLogLevel":uL,"enableIPv6":AL,"dartRuntimeManagerVmFlags":pK,"javaRuntimeManagerVmFlags":WL,"allowPasswordChanges":hK,"keepCustomAssets":XL,"linkManagerEnvironment":ZL,"timeHttpRequests":BM,"generatedCertificateSubject":HL,"enableCertificateGeneration":zK,"alternativeBrokerUrl":jK,"httpPathClassification":SL};if(fH!=null){A["broadcastUrl"]=fH;}if(gH!=null){A["brokerName"]=gH;}if(hH!=null){A["brokerUrl"]=hH;}if(wH!=null){A["runBrokerInMain"]=wH;}if(map["ldap"]!=null){A["ldap"]=map["ldap"];}if(map["duo"]!=null){A["duo"]=map["duo"];}if(map["externalAuth"]!=null){A["externalAuth"]=map["externalAuth"];}if(map["authServer"]!=null){A["authServer"]=map["authServer"];}return A;}bool fR=false;Future xH([String A="server"])async{if(fR){return;}fR=true;var B=await XI(A);await gM(B,sL());fR=false;}}const String cM="https://dsa.s3.amazonaws.com/links/links.json";const String dM="https://dsa.s3.amazonaws.com/dists/dists.json";v XE;eM(){if(XE==null){cE=true;XE=new v("DGServer");XE.dQ.listen((A){List<String> B=A.message.split("\n");for(String C in B){print("[${A.level.name}] ${C}");}if(A.error!=null){print(A.error);}if(A.stackTrace!=null){print(A.stackTrace);}});}}Future<LD> XI(String A)async{var B=["${A}.json","${A}.toml","${A}.yaml"];for(var D in B){var C=jD.KG.oH(D);if(await C.exists()){return C;}}return jD.KG.oH(B.first);}Future<dynamic> fM(LD B)async{if(!(await B.exists())){return null;}var A=await B.readAsString();var C=eI(B.path);if(C==".toml"){var D=new GJ();return KD(D.DB(A).value);}else if(C==".yaml"){return KD(WO(A));}else{if(A.trim().isEmpty||A==" "){A="{}";}return KD(iM.convert(A));}}Future gM(LD B,dynamic C)async{if(!(await B.exists())){await B.create();}var A="";var D=eI(B.path);if(D==".toml"){var H=new UN();A=H.encode(C);}else if(D==".yaml"){A=ZO(C);}else{A=hM.convert(C);}if(!A.endsWith("\n")){A=A+"\n";}await B.writeAsString(A);}JsonEncoder hM=const JsonEncoder.withIndent("  ");JsonDecoder iM=const JsonDecoder();dynamic KD(A){if(A is Map){var B={};for(var C in A.keys){B[KD(C)]=KD(A[C]);}return B;}else if(A is List){return A.map((D)=>KD(D)).toList();}else{return A;}}typedef dynamic jM<VD>(VD _0);typedef void kM(Process _0);typedef void HG(String _0);class YE extends ProcessResult{final hL;YE(int A,int B,C,D,this.hL):super(A,B,C,D);}class lM{}bool mM=false;Future<YE> nM(String D,{List<String> args: const[] ,String workingDirectory,Map<String,String> environment,bool includeParentEnvironment: true,bool runInShell: true,stdin,kM handler,HG stdoutHandler,HG stderrHandler,HG outputHandler,lM controller,File outputFile,jM<int> exitHandler,bool inherit: false,bool writeToBuffer: false,bool binary: false,bool capture: true,bool inheritStdin: false,Duration timeout,bool sudo: false})async{if(sudo&&(Platform.isLinux||Platform.isMacOS)&&(await IG("sudo"))!=null){var dD=D;D=await IG("sudo");args=new List<String>.from(args);args.insert(0,dD);}IOSink B;if(outputFile!=null){if(!(await outputFile.exists())){await outputFile.create(recursive:true);}B=await outputFile.openWrite(mode:FileMode.APPEND);}if(workingDirectory==null){workingDirectory=Directory.current.path;}try {if(mM){XE.NQ("Execute '${D} ${args.join(' ')}' in ${workingDirectory}");}Process A=await Process.start(D,args,workingDirectory:workingDirectory,environment:environment,includeParentEnvironment:includeParentEnvironment,runInShell:runInShell);if(controller!=null){controller.gR=A;controller.hR.complete();}if(B!=null){B.writeln("[${ZE}] == Executing ${D} with arguments ${args} (pid: ${A.pid}) ==");}var K=new StringBuffer();var Z=new StringBuffer();var j=new StringBuffer();var O=<int>[] ;var EB=<int>[] ;var iB=<int>[] ;if(capture){if(!binary){A.stdout.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((C)async{if(writeToBuffer){Z.writeln(C);K.writeln(C);}if(stdoutHandler!=null){stdoutHandler(C);}if(outputHandler!=null){outputHandler(C);}if(inherit){JM.stdout.writeln(C);}if(B!=null){await B.writeln("[${ZE}] ${C}");}});A.stderr.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((C)async{if(writeToBuffer){j.writeln(C);K.writeln(C);}if(stderrHandler!=null){stderrHandler(C);}if(outputHandler!=null){outputHandler(C);}if(inherit){JM.stderr.writeln(C);}if(B!=null){await B.writeln("[${ZE}] ${C}");}});}else{A.stdout.listen((H){if(writeToBuffer){O.addAll(H);iB.addAll(H);}});A.stderr.listen((H){if(writeToBuffer){O.addAll(H);EB.addAll(H);}});}}if(handler!=null){handler(A);}if(stdin!=null){if(stdin is File){stdin=await stdin.openRead();}if(stdin is Stream){stdin.listen(A.stdin.add,onDone:A.stdin.close);}else if(stdin is List){A.stdin.add(stdin);}else{A.stdin.write(stdin);await A.stdin.close();}}else if(inherit&&inheritStdin){JM.stdin.listen(A.stdin.add,onDone:A.stdin.close);}var BC=false;if(timeout!=null){new Future.delayed(timeout,(){if(!BC){A.kill(ProcessSignal.SIGKILL);}});}var P=await A.exitCode;BC=true;var BG=A.pid;await new Future.delayed(const Duration(milliseconds:5));try {if(B!=null){B.writeln("[${ZE}] == Exited with status ${P} ==");await B.flush();await B.close();}}catch (CG){}if(exitHandler!=null){exitHandler(P);}return new YE(BG,P,binary?iB:Z.toString(),binary?EB:j.toString(),binary?O:K.toString());}finally {try {if(B!=null){await B.flush();await B.close();}}catch (CG){}}}Map<String,String> iD={};Future<String> IG(String B)async{if(iD.containsKey(B)){var A=new File(iD[B]);if(await A.exists()){return A.path;}}if(const["dart","pub"].contains(B)){try {var O=new File(Platform.resolvedExecutable);var P=O.parent;var A=new File(rC(P.path,B));if(await A.exists()){return iD[B]=A.absolute.path;}}catch (BC){}}if(const["openssl"].contains(B)&&Platform.isWindows){var Z=<String>[r"C:\OpenSSL-Win32\bin\openssl.exe",r"C:\OpenSSL-Win64\bin\openssl.exe",rC(Directory.current.path,"bin","tools","openssl","openssl.exe")];for(var j in Z){var A=new File(j);if(await A.exists()){return iD[B]=A.absolute.path;}}}var EB=Platform.environment["PATH"].split(Platform.isWindows?";":":");var H=[B];if(Platform.isWindows){H.addAll(["${B}.exe","${B}.bat"]);}for(var C in EB){if(C.startsWith('"')&&C.endsWith('"')){C=C.substring(1,C.length-1);}if(Platform.environment.containsKey("HOME")){var D=Platform.environment["HOME"];if(!D.endsWith("/")){D+= "/";}C=C.replaceAll("~/",D);}var K=new Directory(uM(C)).absolute;if(!(await K.exists())){continue;}for(var iB in H){var A=new File("${K.path}/${iB}").absolute;if(await A.exists()){iD[B]=A.path;return A.path;}}}return null;}String get ZE{return new DateTime.now().toString();}Future<YE> YI(List<String> B,{bool checked: true,bool inherit: false,bool stdin: false})async{var C=<String,String>{};if(Platform.isWindows){C["OPENSSL_CONF"]=rC(Directory.current.path,"bin","tools","openssl","openssl.cfg");}var D=await IG("openssl");if(D==null){throw new Exception("OpenSSL is not installed.");}var A=await nM(D,args:B,writeToBuffer:true,environment:C,inherit:inherit,inheritStdin:stdin);if(A.exitCode!=0){throw new Exception("Failed to run OpenSSL with arguments ${B}" " (code = ${A.exitCode}):" "\n${A.hL}");}return A;}abstract class JG{}abstract class LD implements JG{}abstract class aE implements JG{}abstract class jD{static jD KG=new oM();aE get i;LD oH(String A){return i.sP(A);}}class ZI implements LD{final File file;ZI(this.file);Future create()async{await file.create(recursive:true);}Future<bool> exists(){return file.exists();}JG get parent{return new bE(file.parent);}String get path=>file.path;Future<List<int>> readAsBytes(){return file.readAsBytes();}Future<String> readAsString(){return file.readAsString();}Future writeAsString(String A){return file.writeAsString(A);}}class bE implements aE{final Directory ZD;bE(this.ZD);LD sP(String A){var B=rC(ZD.path,A);return new ZI(new File(B));}Future create(){return ZD.create(recursive:true);}Future<bool> exists(){return ZD.exists();}aE get parent=>new bE(ZD.parent);String get path=>ZD.path;}class oM extends jD{aE get i=>new bE(Directory.current);}final CJ=new RegExp(r"\r\n?|\n");class eG extends PD{int get IB=>iR;int iR=0;int get g=>jR;int jR=0;dC get state=>new DJ(this,position,IB,g);bool get kR=>U(-1)==NI&&U()==DG;set position(int A){var C=position;super.position=A;if(A>C){var B=lR(string.substring(C,A));iR+= B.length;if(B.isEmpty){jR+= A-C;}else{jR=A-B.last.end;}}else{var B=lR(string.substring(A,C));if(kR)B.removeLast();iR-= B.length;if(B.isEmpty){jR-= C-A;}else{jR=A-string.lastIndexOf(CJ,A)-1;}}}eG(String A,{sourceUrl,int position}):super(A,sourceUrl:sourceUrl,position:position);int S(){var A=super.S();mR(A);return A;}void mR(int A){if(A==DG||(A==NI&&U()!=DG)){iR+= 1;jR=0;}else{jR+= 1;}}bool q(Pattern B){if(!super.q(B))return false;var A=lR(aD[0]);iR+= A.length;if(A.isEmpty){jR+= aD[0].length;}else{jR=aD[0].length-A.last.end;}return true;}List<Match> lR(String B){var A=CJ.allMatches(B).toList();if(kR)A.removeLast();return A;}}class DJ implements dC{final eG nR;final int position;final int IB;final int g;DJ(this.nR,this.position,this.IB,this.g);}const int pC=0x7fffffff;abstract class qC<R>{}class GG<R> implements qC<R>{const GG();bool jC(R A,R B)=>A==B;int kC(R A)=>A.hashCode;bool rH(Object A)=>true;}class OI<R> implements qC<Iterable<R>>{final qC<R> oR;const OI([qC<R> A=const GG()]):oR=A;bool jC(Iterable<R> A,Iterable<R> B){if(identical(A,B))return true;if(A==null||B==null)return false;var C=A.iterator;var D=B.iterator;while(true){bool H=C.moveNext();if(H!=D.moveNext())return false;if(!H)return true;if(!oR.jC(C.current,D.current))return false;}}int kC(Iterable<R> B){int A=0;for(R C in B){int D=oR.kC(C);A=(A+D)&pC;A=(A+(A<<10))&pC;A^= (A>>6);}A=(A+(A<<3))&pC;A^= (A>>11);A=(A+(A<<15))&pC;return A;}bool rH(Object A)=>A is Iterable<R>;}abstract class QI<R,VD extends Iterable<R>> implements qC<VD>{final qC<R> oR;const QI(this.oR);bool jC(VD D,VD H){if(identical(D,H))return true;if(D==null||H==null)return false;HashMap<R,int> C=new HashMap(equals:oR.jC,hashCode:oR.kC,isValidKey:oR.rH);int K=0;for(var B in D){int A=C[B];if(A==null)A=0;C[B]=A+1;K++ ;}for(var B in H){int A=C[B];if(A==null||A==0)return false;C[B]=A-1;K-- ;}return K==0;}int kC(VD B){int A=0;for(R C in B){int D=oR.kC(C);A=(A+D)&pC;}A=(A+(A<<3))&pC;A^= (A>>11);A=(A+(A<<15))&pC;return A;}}class RI<R> extends QI<R,Iterable<R>>{const RI([qC<R> A=const GG()]):super(A);bool rH(Object A)=>A is Iterable<R>;}class iE extends dG{String get source=>super.source;Uri get Y=>J.Y;iE(String A,n B,String C):super(A,B,C);}const int bG=10;const int PN=13;class uC{final Uri EI;final pR=<int>[0];final Uint32List qR;int get length=>qR.length;int get bD=>pR.length;int rR;uC(String A,{url}):this.IR(A.runes,url:url);uC.IR(Iterable<int> D,{url}):EI=url is String?Uri.parse(url):url,qR=new Uint32List.fromList(D.toList()){for(var A=0;A<qR.length;A++ ){var B=qR[A];if(B==PN){var C=A+1;if(C>=qR.length||qR[C]!=bG)B=bG;}if(B==bG)pR.add(A+1);}}h J(int B,[int A]){if(A==null)A=length-1;return new FC(this,B,A);}cC location(int A)=>new cC.JR(this,A);int jF(int A){if(A<0){throw new RangeError("Offset may not be negative, was ${A}.");}else if(A>length){throw new RangeError("Offset ${A} must not be greater than the number " "of characters in the file, ${length}.");}if(A<pR.first)return -1;if(A>=pR.last)return pR.length-1;if(sR(A))return rR;rR=tR(A)-1;return rR;}bool sR(int A){if(rR==null)return false;if(A<pR[rR])return false;if(rR>=pR.length-1||A<pR[rR+1]){return true;}if(rR>=pR.length-2||A<pR[rR+2]){rR++ ;return true;}return false;}int tR(int D){int A=0;int B=pR.length-1;while(A<B){var C=A+((B-A)~/2);if(pR[C]>D){B=C;}else{A=C+1;}}return B;}int nH(int A,{int line}){if(A<0){throw new RangeError("Offset may not be negative, was ${A}.");}else if(A>length){throw new RangeError("Offset ${A} must be not be greater than the " "number of characters in the file, ${length}.");}if(line==null){line=jF(A);}else if(line<0){throw new RangeError("Line may not be negative, was ${line}.");}else if(line>=bD){throw new RangeError("Line ${line} must be less than the number of " "lines in the file, ${bD}.");}var B=pR[line];if(B>A){throw new RangeError("Line ${line} comes after offset ${A}.");}return A-B;}int LL(int A,[int B]){if(B==null)B=0;if(A<0){throw new RangeError("Line may not be negative, was ${A}.");}else if(A>=bD){throw new RangeError("Line ${A} must be less than the number of " "lines in the file, ${bD}.");}else if(B<0){throw new RangeError("Column may not be negative, was ${B}.");}var C=pR[A]+B;if(C>length||(A+1<bD&&C>=pR[A+1])){throw new RangeError("Line ${A} doesn't have ${B} columns.");}return C;}String OL(int A,[int B])=>new String.fromCharCodes(qR.sublist(A,B));}class cC extends QN implements WB{final uC file;final int offset;Uri get Y=>file.EI;int get IB=>file.jF(offset);int get g=>file.nH(offset);cC.JR(this.file,this.offset){if(offset<0){throw new RangeError("Offset may not be negative, was ${offset}.");}else if(offset>file.length){throw new RangeError("Offset ${offset} must not be greater than the number " "of characters in the file, ${file.length}.");}}h KB()=>new FC(file,offset,offset);}abstract class h implements hE{}class FC extends BJ implements h{final uC file;final int uR;final int vR;Uri get Y=>file.EI;int get length=>vR-uR;cC get start=>new cC.JR(file,uR);cC get end=>new cC.JR(file,vR);String get ID=>file.OL(uR,vR);String get context=>file.OL(file.LL(start.IB),end.IB==file.bD-1?null:file.LL(end.IB+1));FC(this.file,this.uR,this.vR){if(vR<uR){throw new ArgumentError('End ${vR} must come after start ${uR}.');}else if(vR>file.length){throw new RangeError("End ${vR} must not be greater than the number " "of characters in the file, ${file.length}.");}else if(uR<0){throw new RangeError("Start may not be negative, was ${uR}.");}}int compareTo(n A){if(A is!FC)return super.compareTo(A);FC B=A;var C=uR.compareTo(B.uR);return C==0?vR.compareTo(B.vR):C;}bool operator==(A){if(A is!h)return super==A;if(A is!FC){return super==A&&Y==A.Y;}return uR==A.uR&&vR==A.vR&&Y==A.Y;}int get hashCode=>super.hashCode;h expand(h A){if(Y!=A.Y){throw new ArgumentError("Source URLs \"${Y}\" and " " \"${A.Y}\" don't match.");}if(A is FC){var B=eD.min(this.uR,A.uR);var C=eD.max(this.vR,A.vR);return new FC(file,B,C);}else{var B=eD.min(this.uR,A.start.offset);var C=eD.max(this.vR,A.end.offset);return new FC(file,B,C);}}}class SN extends fG{}class dC{}class WB implements Comparable<WB>{}abstract class QN implements WB{String get pQ{var A=Y==null?'unknown source':Y;return '${A}:${IB+1}:${g+1}';}int vK(WB A){if(Y!=A.Y){throw new ArgumentError("Source URLs \"${Y}\" and " "\"${A.Y}\" don't match.");}return (offset-A.offset).abs();}n KB()=>new n(this,this,"");int compareTo(WB A){if(Y!=A.Y){throw new ArgumentError("Source URLs \"${Y}\" and " "\"${A.Y}\" don't match.");}return offset-A.offset;}bool operator==(A)=>A is WB&&Y==A.Y&&offset==A.offset;int get hashCode=>Y.hashCode+offset;String toString()=>'<${runtimeType}: ${offset} ${pQ}>';}bool cE=false;m pM=m.sM;m qM=m.bI;class v{final String name;String get GL=>(parent==null||parent.name=='')?name:'${parent.GL}.${name}';final v parent;m wR;final Map<String,v> xR;final Map<String,v> hC;StreamController<ZC> yR;factory v(String A){return rM.putIfAbsent(A,()=>new v.yQ(A));}factory v.yQ(String A){if(A.startsWith('.')){throw new ArgumentError("name shouldn't start with a '.'");}int B=A.lastIndexOf('.');v C=null;String D;if(B==-1){if(A!='')C=new v('');D=A;}else{C=new v(A.substring(0,B));D=A.substring(B+1);}return new v.zQ(D,C,new Map<String,v>());}v.zQ(this.name,this.parent,Map<String,v> A):this.xR=A,this.hC=new UnmodifiableMapView(A){if(parent!=null)parent.xR[name]=this;}m get level{if(cE){if(wR!=null)return wR;if(parent!=null)return parent.level;}return qM;}Stream<ZC> get dQ=>zR();bool RQ(m A)=>(A>=level);void WQ(m B,A,[Object D,StackTrace H,Zone K]){Object O;if(RQ(B)){if(A is Function)A=A();if(A is!String){O=A;A=A.toString();}if(H==null&&B>=pM){try {throw "autogenerated stack trace for ${B} ${A}";}catch (Z,j){H=j;if(D==null)D=Z;}}if(K==null)K=Zone.current;var P=new ZC(B,A,GL,D,H,K,O);if(cE){var C=this;while(C!=null){C.AS(P);C=C.parent;}}else{aI.AS(P);}}}void NQ(A,[Object B,StackTrace C])=>WQ(m.bI,A,B,C);Stream<ZC> zR(){if(cE||parent==null){if(yR==null){yR=new StreamController<ZC>.broadcast(sync:true);}return yR.stream;}else{return aI.zR();}}void AS(ZC A){if(yR!=null){yR.add(A);}}static final v aI=new v('');static final Map<String,v> rM=<String,v>{};}class m implements Comparable<m>{final String name;final int value;const m(this.name,this.value);static const m sM=const m('OFF',2000);static const m bI=const m('INFO',800);bool operator==(A)=>A is m&&value==A.value;bool operator<(m A)=>value<A.value;bool operator<=(m A)=>value<=A.value;bool operator>(m A)=>value>A.value;bool operator>=(m A)=>value>=A.value;int compareTo(m A)=>value-A.value;int get hashCode=>value;String toString()=>name;}class ZC{final m level;final String message;final Object cQ;final String bL;final DateTime mQ;final int kQ;static int tM=0;final Object error;final StackTrace stackTrace;final Zone zone;ZC(this.level,this.message,this.bL,[this.error,this.stackTrace,this.zone,this.cQ]):mQ=new DateTime.now(),kQ=ZC.tM++ ;String toString()=>'[${level.name}] ${bL}: ${message}';}GB OM(String A,String B,String C,String D,List<String> H,Map<String,String> K,O,Function P,kB Z,{bool negatable,bool splitCommas,bool hide: false}){return new GB.wQ(A,B,C,D,H,K,O,P,Z,negatable:negatable,splitCommas:splitCommas,hide:hide);}class GB{final String name;final String fC;final List<String> HE;final PC;final Function callback;final String pH;final String FI;final Map<String,String> YD;final kB type;final bool negatable;final bool wL;final bool hide;bool get SC=>type==kB.JI;bool get VL=>type==kB.KI;GB.wQ(this.name,this.fC,this.pH,this.FI,List<String> A,Map<String,String> B,this.PC,this.callback,kB C,{this.negatable,bool splitCommas,this.hide: false}):this.HE=A==null?null:new UnmodifiableListView(A),this.YD=B==null?null:new UnmodifiableMapView(B),this.type=C,this.wL=splitCommas==null?C==kB.KI:splitCommas{if(name.isEmpty){throw new ArgumentError('Name cannot be empty.');}else if(name.startsWith('-')){throw new ArgumentError('Name ${name} cannot start with "-".');}if(II.hasMatch(name)){throw new ArgumentError('Name "${name}" contains invalid characters.');}if(fC!=null){if(fC.length!=1){throw new ArgumentError('Abbreviation must be null or have length 1.');}else if(fC=='-'){throw new ArgumentError('Abbreviation cannot be "-".');}if(II.hasMatch(fC)){throw new ArgumentError('Abbreviation is an invalid character.');}}}dynamic ML(A){if(A!=null)return A;if(!VL)return PC;if(PC!=null)return [PC];return [] ;}static final II=new RegExp(r'''[ \t\r\n"'\\/]''');}class kB{static const JI=const kB.xQ("OptionType.FLAG");static const KI=const kB.xQ("OptionType.MULTIPLE");final String name;const kB.xQ(this.name);}final PM=new RegExp(r'^-([a-zA-Z0-9])$');final QM=new RegExp(r'^-([a-zA-Z0-9]+)(.*)$');final RM=new RegExp(r'^--([a-zA-Z\-_0-9]+)(=(.*))?$');class fD{final String nK;final fD parent;final jB xB;final List<String> PB;final zB=<String>[] ;final Map<String,dynamic> XC=<String,dynamic>{};fD(this.nK,this.xB,this.PB,[this.parent,List<String> A]){if(A!=null)this.zB.addAll(A);}String get current=>PB[0];oC DB(){var D=PB.toList();var B=null;while(PB.length>0){if(current=='--'){PB.removeAt(0);break;}var C=xB.oK[current];if(C!=null){cB(zB.isEmpty,'Cannot specify arguments before a command.');var H=PB.removeAt(0);var K=new fD(H,C,PB,this,zB);B=K.DB();zB.clear();break;}if(kL())continue;if(iL(this))continue;if(uH())continue;if(!xB.iK)break;zB.add(PB.removeAt(0));}xB.VC.forEach((O,A){if(A.callback==null)return;A.callback(A.ML(XC[O]));});zB.addAll(PB);PB.clear();return NM(xB,XC,nK,B,zB,D);}void oL(GB A){cB(PB.length>0,'Missing argument for "${A.name}".');setOption(XC,A,current);PB.removeAt(0);}bool kL(){var B=PM.firstMatch(current);if(B==null)return false;var A=xB.hF(B[1]);if(A==null){cB(parent!=null,'Could not find an option or flag "-${B[1]}".');return parent.kL();}PB.removeAt(0);if(A.SC){tF(XC,A,true);}else{oL(A);}return true;}bool iL(fD H){var A=QM.firstMatch(current);if(A==null)return false;var B=A[1].substring(0,1);var D=xB.hF(B);if(D==null){cB(parent!=null,'Could not find an option with short name "-${B}".');return parent.iL(H);}else if(!D.SC){var K='${A[1].substring(1)}${A[2]}';setOption(XC,D,K);}else{cB(A[2]=='','Option "-${B}" is a flag and cannot handle value ' '"${A[1].substring(1)}${A[2]}".');for(var C=0;C<A[1].length;C++ ){var B=A[1].substring(C,C+1);H.jL(B);}}PB.removeAt(0);return true;}void jL(String A){var B=xB.hF(A);if(B==null){cB(parent!=null,'Could not find an option with short name "-${A}".');parent.jL(A);return;}cB(B.SC,'Option "-${A}" must be a flag to be in a collapsed "-".');tF(XC,B,true);}bool uH(){var C=RM.firstMatch(current);if(C==null)return false;var A=C[1];var B=xB.VC[A];if(B!=null){PB.removeAt(0);if(B.SC){cB(C[3]==null,'Flag option "${A}" should not be given a value.');tF(XC,B,true);}else if(C[3]!=null){setOption(XC,B,C[3]);}else{oL(B);}}else if(A.startsWith('no-')){A=A.substring('no-'.length);B=xB.VC[A];if(B==null){cB(parent!=null,'Could not find an option named "${A}".');return parent.uH();}PB.removeAt(0);cB(B.SC,'Cannot negate non-flag option "${A}".');cB(B.negatable,'Cannot negate option "${A}".');tF(XC,B,false);}else{cB(parent!=null,'Could not find an option named "${A}".');return parent.uH();}return true;}void cB(bool A,String B){if(!A)throw new FormatException(B);}void setOption(Map C,GB A,String B){assert(!A.SC);if(!A.VL){BS(A,B);C[A.name]=B;return;}var D=C.putIfAbsent(A.name,()=><String>[] );if(A.wL){for(var H in B.split(",")){BS(A,H);D.add(H);}}else{BS(A,B);D.add(B);}}void tF(Map B,GB A,bool C){assert(A.SC);B[A.name]=C;}void BS(GB A,String B){if(A.HE==null)return;cB(A.HE.contains(B),'"${B}" is not an allowed value for option "${A.name}".');}}final CC kD=BN();String get cI{var C=Uri.base;if(r.NG==r.mD){return C.resolve('.').toString();}else{var A=C.toFilePath();int B=A.length-1;assert(A[B]=='/'||A[B]=='\\');return A.substring(0,B);}}String dI(String A)=>kD.wP(A);String eI(String A)=>kD.lH(A);String rC(String A,[String B,String C,String D,String H,String K,String O,String P])=>kD.join(A,B,C,D,H,K,O,P);String uM(String A)=>kD.FD(A);String vM(A)=>kD.gQ(A);const dE=0x2e;const aC=0x2f;const wM=0x3a;const xM=0x41;const yM=0x5a;const zM=0x61;const AN=0x7a;const LG=0x5c;CC BN()=>new CC.AR();class CC{factory CC({r style,String current}){if(current==null){if(style==null){current=cI;}else{current=".";}}if(style==null){style=r.NG;}else if(style is!DC){throw new ArgumentError("Only styles defined by the path package are " "allowed.");}return new CC.BR(style as DC,current);}CC.AR():Q=r.NG as DC,CS=null;CC.BR(this.Q,this.CS);final DC Q;final String CS;String get current=>CS!=null?CS:cI;String get pB=>Q.pB;String absolute(String A,[String B,String C,String D,String H,String K,String O]){fI("absolute",[A,B,C,D,H,K,O]);if(B==null&&isAbsolute(A)&&!VB(A)){return A;}return join(current,A,B,C,D,H,K,O);}String wP(String B){var A=DS(B);A.rF();if(A.a.isEmpty)return A.i==null?'.':A.i;if(A.a.length==1){return A.i==null?'.':A.i;}A.a.removeLast();A.FB.removeLast();A.rF();return A.toString();}String lH(String A)=>DS(A).lH;String jQ(String A)=>A.substring(0,Q.YC(A));bool isAbsolute(String A)=>Q.YC(A)>0;bool nF(String A)=>!this.isAbsolute(A);bool VB(String A)=>Q.VB(A);String join(String B,[String C,String D,String H,String K,String O,String P,String Z]){var A=<String>[B,C,D,H,K,O,P,Z];fI("join",A);return TQ(A.where((j)=>j!=null));}String TQ(Iterable<String> K){var B=new StringBuffer();var D=false;var H=false;for(var A in K.where((A)=>A!='')){if(this.VB(A)&&H){var C=DS(A);C.i=this.jQ(B.toString());if(Q.cD(C.i)){C.FB[0]=Q.pB;}B.clear();B.write(C.toString());}else if(this.isAbsolute(A)){H=!this.VB(A);B.clear();B.write(A);}else{if(A.length>0&&Q.dF(A[0])){}else if(D){B.write(pB);}B.write(A);}D=Q.cD(A);}return B.toString();}List<String> split(String B){var A=DS(B);A.a=A.a.where((C)=>!C.isEmpty).toList();if(A.i!=null)A.a.insert(0,A.i);return A.a;}String FD(String A){if(!ES(A))return A;var B=DS(A);B.FD();return B.toString();}bool ES(String O){var P=0;var D=O.codeUnits;var B;var A;var H=Q.YC(O);if(H!=0){P=H;A=aC;if(Q==r.eE){for(var C=0;C<H;C++ ){if(D[C]==aC)return true;}}}for(var C=P;C<D.length;C++ ){var K=D[C];if(Q.RB(K)){if(Q==r.eE&&K==aC)return true;if(A!=null&&Q.RB(A))return true;if(A==dE&&(B==null||B==dE||Q.RB(B))){return true;}}B=A;A=K;}if(A==null)return true;if(Q.RB(A))return true;if(A==dE&&(B==null||B==aC||B==dE)){return true;}return false;}String iQ(String C,{String from}){if(from==null){from=current;}else if(this.nF(from)||this.VB(from)){from=this.join(current,from);}if(this.nF(from)&&this.isAbsolute(C)){return this.FD(C);}if(this.nF(C)||this.VB(C)){C=this.absolute(C);}if(this.nF(C)&&this.isAbsolute(from)){throw new MG('Unable to find a path to "${C}" from "${from}".');}var B=DS(from)..FD();var A=DS(C)..FD();if(B.a.length>0&&B.a[0]=='.'){return A.toString();}if(B.i!=A.i&&((B.i==null||A.i==null)||B.i.toLowerCase().replaceAll('/','\\')!=A.i.toLowerCase().replaceAll('/','\\'))){return A.toString();}while(B.a.length>0&&A.a.length>0&&B.a[0]==A.a[0]){B.a.removeAt(0);B.FB.removeAt(1);A.a.removeAt(0);A.FB.removeAt(1);}if(B.a.length>0&&B.a[0]=='..'){throw new MG('Unable to find a path to "${C}" from "${from}".');}A.a.insertAll(0,new List.filled(B.a.length,'..'));A.FB[0]='';A.FB.insertAll(1,new List.filled(B.a.length,Q.pB));if(A.a.length==0)return '.';if(A.a.length>1&&A.a.last=='.'){A.a.removeLast();A.FB..removeLast()..removeLast()..add('');}A.i='';A.rF();return A.toString();}String GQ(A){if(A is String)A=Uri.parse(A);return Q.PE(A);}String gQ(A){if(A is String)A=Uri.parse(A);if(A.scheme=='file'&&Q==r.mD)return A.toString();if(A.scheme!='file'&&A.scheme!=''&&Q!=r.mD){return A.toString();}var B=FD(GQ(A));var C=iQ(B);return split(C).length>split(B).length?B:C;}lD DS(String A)=>new lD.DR(A,Q);}fI(String K,List<String> A){for(var B=1;B<A.length;B++ ){if(A[B]==null||A[B-1]!=null)continue;var C;for(C=A.length;C>=1;C-- ){if(A[C-1]!=null)break;}var D=new StringBuffer();D.write("${K}(");D.write(A.take(C).map((H)=>H==null?"null":'"${H}"').join(", "));D.write("): part ${B-1} was null, but part ${B} was not.");throw new ArgumentError(D.toString());}}abstract class DC extends r{String get pB;bool dF(String A);bool RB(int A);bool cD(String A);int YC(String A);String NL(String A){var B=YC(A);if(B>0)return A.substring(0,B);return VB(A)?A[0]:null;}bool VB(String A);String PE(Uri A);}class lD{DC Q;String i;bool VB;List<String> a;List<String> FB;String get lH=>FS()[1];bool get isAbsolute=>i!=null;factory lD.DR(String A,DC D){var K=D.NL(A);var P=D.VB(A);if(K!=null)A=A.substring(K.length);var O=<String>[] ;var H=<String>[] ;var B=0;if(A.isNotEmpty&&D.RB(A.codeUnitAt(0))){H.add(A[0]);B=1;}else{H.add('');}for(var C=B;C<A.length;C++ ){if(D.RB(A.codeUnitAt(C))){O.add(A.substring(B,C));H.add(A[C]);B=C+1;}}if(B<A.length){O.add(A.substring(B));H.add('');}return new lD.ER(D,K,P,O,H);}lD.ER(this.Q,this.i,this.VB,this.a,this.FB);void rF(){while(!a.isEmpty&&a.last==''){a.removeLast();FB.removeLast();}if(FB.length>0)FB[FB.length-1]='';}void FD(){var C=0;var A=<String>[] ;for(var B in a){if(B=='.'||B==''){}else if(B=='..'){if(A.length>0){A.removeLast();}else{C++ ;}}else{A.add(B);}}if(!isAbsolute){A.insertAll(0,new List.filled(C,'..'));}if(A.length==0&&!isAbsolute){A.add('.');}var D=new List<String>.generate(A.length,(H)=>Q.pB,growable:true);D.insert(0,isAbsolute&&A.length>0&&Q.cD(i)?Q.pB:'');a=A;FB=D;if(i!=null&&Q==r.eE){i=i.replaceAll('/','\\');}rF();}String toString(){var A=new StringBuffer();if(i!=null)A.write(i);for(var B=0;B<a.length;B++ ){A.write(FB[B]);A.write(a[B]);}A.write(FB.last);return A.toString();}List<String> FS(){var A=a.lastWhere((C)=>C!='',orElse:()=>null);if(A==null)return ['',''];if(A=='..')return ['..',''];var B=A.lastIndexOf('.');if(B<=0)return [A,''];return [A.substring(0,B),A.substring(B)];}}class MG implements Exception{String message;MG(this.message);String toString()=>"PathException: ${message}";}abstract class r{static final r CN=new gI();static final r eE=new iI();static final r mD=new hI();static final r NG=DN();static r DN(){if(Uri.base.scheme!='file')return r.mD;if(!Uri.base.path.endsWith('/'))return r.mD;if(new Uri(path:'a/b').toFilePath()=='a\\b')return r.eE;return r.CN;}String get name;CC get context=>new CC(style:this);String get pB;String NL(String A);String PE(Uri A);String toString()=>name;}class gI extends DC{gI();final name='posix';final pB='/';final FB=const['/'];final tL=new RegExp(r'/');final eL=new RegExp(r'[^/]$');final qL=new RegExp(r'^/');final pL=null;bool dF(String A)=>A.contains('/');bool RB(int A)=>A==aC;bool cD(String A)=>A.isNotEmpty&&!RB(A.codeUnitAt(A.length-1));int YC(String A){if(A.isNotEmpty&&RB(A.codeUnitAt(0)))return 1;return 0;}bool VB(String A)=>false;String PE(Uri A){if(A.scheme==''||A.scheme=='file'){return Uri.decodeComponent(A.path);}throw new ArgumentError("Uri ${A} must have scheme 'file:'.");}}class hI extends DC{hI();final name='url';final pB='/';final FB=const['/'];final tL=new RegExp(r'/');final eL=new RegExp(r"(^[a-zA-Z][-+.a-zA-Z\d]*://|[^/])$");final qL=new RegExp(r"[a-zA-Z][-+.a-zA-Z\d]*://[^/]*");final pL=new RegExp(r"^/");bool dF(String A)=>A.contains('/');bool RB(int A)=>A==aC;bool cD(String A){if(A.isEmpty)return false;if(!RB(A.codeUnitAt(A.length-1)))return true;return A.endsWith("://")&&YC(A)==A.length;}int YC(String A){if(A.isEmpty)return 0;if(RB(A.codeUnitAt(0)))return 1;var B=A.indexOf("/");if(B>0&&A.startsWith('://',B-1)){B=A.indexOf('/',B+2);if(B>0)return B;return A.length;}return 0;}bool VB(String A)=>A.isNotEmpty&&RB(A.codeUnitAt(0));String PE(Uri A)=>A.toString();}class iI extends DC{iI();final name='windows';final pB='\\';final FB=const['/','\\'];final tL=new RegExp(r'[/\\]');final eL=new RegExp(r'[^/\\]$');final qL=new RegExp(r'^(\\\\[^\\]+\\[^\\/]+|[a-zA-Z]:[/\\])');final pL=new RegExp(r"^[/\\](?![/\\])");bool dF(String A)=>A.contains('/');bool RB(int A)=>A==aC||A==LG;bool cD(String A){if(A.isEmpty)return false;return !RB(A.codeUnitAt(A.length-1));}int YC(String A){if(A.isEmpty)return 0;if(A.codeUnitAt(0)==aC)return 1;if(A.codeUnitAt(0)==LG){if(A.length<2||A.codeUnitAt(1)!=LG)return 1;var B=A.indexOf('\\',2);if(B>0){B=A.indexOf('\\',B+1);if(B>0)return B;}return A.length;}if(A.length<3)return 0;if(!EN(A.codeUnitAt(0)))return 0;if(A.codeUnitAt(1)!=wM)return 0;if(!RB(A.codeUnitAt(2)))return 0;return 3;}bool VB(String A)=>YC(A)==1;String PE(Uri A){if(A.scheme!=''&&A.scheme!='file'){throw new ArgumentError("Uri ${A} must have scheme 'file:'.");}var B=A.path;if(A.host==''){if(B.startsWith('/'))B=B.replaceFirst("/","");}else{B='\\\\${A.host}${B}';}return Uri.decodeComponent(B.replaceAll("/","\\"));}}bool EN(int A)=>(A>=xM&&A<=yM)||(A>=zM&&A<=AN);class OG extends lB{final Function GS;OG(A,this.GS):super(A);k c(s B){var A=HS.c(B);if(A.TC){return A.aB(GS(A.value));}else{return A;}}bool HB(L A){return A is OG&&super.HB(A)&&GS==A.GS;}}class jI extends lB{L IS;L JS;jI(A,this.IS,this.JS):super(A);k c(s C){var A=C;do{A=IS.c(A);}while((A as k).TC);var B=HS.c(A);if(B.CD){return B;}A=B;do{A=JS.c(A);}while((A as k).TC);return A.aB(B.value);}List<L> get hC=>[HS,IS,JS];void replace(L A,L B){super.replace(A,B);if(IS==A){IS=B;}if(JS==A){JS=B;}}}class oI extends lB{oI(A):super(A);k c(s A){var B=HS.c(A);if(B.TC){var C=A.buffer is String?A.buffer.substring(A.position,B.position):A.buffer.sublist(A.position,B.position);return B.aB(C);}else{return B;}}}class tI extends lB{tI(A):super(A);k c(s B){var A=HS.c(B);if(A.TC){var C=new sC(A.value,B.buffer,B.position,A.position);return A.aB(C);}else{return A;}}}class MD extends L{final EC KS;final String LS;MD(this.KS,this.LS);k c(s A){var C=A.buffer;var B=A.position;if(B<C.length&&KS.test(C.codeUnitAt(B))){return A.aB(C[B],B+1);}return A.QC(LS);}String toString()=>'${super.toString()}[${LS}]';bool HB(L A){return A is MD&&super.HB(A)&&KS==A.KS&&LS==A.LS;}}abstract class EC{}class lI implements EC{final EC nL;lI(this.nL);bool test(int A)=>!nL.test(A);}EC HN(Iterable<ND> P){var K=new List.from(P,growable:false);K.sort((C,D){return C.start!=D.start?C.start-D.start:C.stop-D.stop;});var A=new List();for(var B in K){if(A.isEmpty){A.add(B);}else{var O=A.last;if(O.stop+1>=B.start){var Z=new ND(O.start,B.stop);A[A.length-1]=Z;}else{A.add(B);}}}if(A.length==1){return A[0].start==A[0].stop?new aG(A[0].start):A[0];}else{return new xI(A.length,A.map((H)=>H.start).toList(growable:false) as List<int>,A.map((H)=>H.stop).toList(growable:false) as List<int>);}}L W(A,[String B]){return new MD(new aG(qD(A)),B!=null?B:'"${A}" expected');}class aG implements EC{final int value;const aG(this.value);bool test(int A)=>identical(this.value,A);}L fE([String A]){return new MD(IN,A!=null?A:'digit expected');}class uI implements EC{const uI();bool test(int A)=>48<=A&&A<=57;}const IN=const uI();L wI(String A,[String B]){return new MD(KN.DB(A).value,B!=null?B:'[${A}] expected');}L JN(){var B=bC().map((A)=>new ND(qD(A),qD(A)));var C=bC().HD(W('-')).HD(bC()).map((A)=>new ND(qD(A[0]),qD(A[2])));var D=C.OE(B).qF().map((A)=>HN(A as Iterable<ND>));return W('^').yB().HD(D).map((A)=>A[0]==null?A[1]:new lI(A[1]));}final KN=JN();class xI implements EC{final int length;final List<int> xL;final List<int> yL;xI(this.length,this.xL,this.yL);bool test(int D){var A=0;var B=length;while(A<B){var C=A+((B-A)>>1);var H=xL[C]-D;if(H==0){return true;}else if(H<0){A=C+1;}else{B=C;}}return 0<A&&D<=yL[A-1];}}class ND implements EC{final int start;final int stop;ND(this.start,this.stop);bool test(int A)=>start<=A&&A<=stop;}L LN([String A]){return new MD(MN,A!=null?A:'whitespace expected');}class yI implements EC{const yI();bool test(int A){if(A<256){return A==0x09||A==0x0A||A==0x0B||A==0x0C||A==0x0D||A==0x20||A==0x85||A==0xA0;}else{return A==0x1680||A==0x180E||A==0x2000||A==0x2001||A==0x2002||A==0x2003||A==0x2004||A==0x2005||A==0x2006||A==0x2007||A==0x2008||A==0x2009||A==0x200A||A==0x2028||A==0x2029||A==0x202F||A==0x205F||A==0x3000||A==0xFEFF;}}}const MN=const yI();int qD(A){if(A is num){return A.round();}var B=A.toString();if(B.length!=1){throw new ArgumentError('${B} is not a character');}return B.codeUnitAt(0);}class lB extends L{L HS;lB(this.HS);k c(s A){return HS.c(A);}List<L> get hC=>[HS];void replace(L A,L B){super.replace(A,B);if(HS==A){HS=B;}}}class RG extends lB{final String LS;RG(A,this.LS):super(A);k c(s B){var A=HS.c(B);if(A.CD||A.position==A.buffer.length){return A;}return A.QC(LS,A.position);}String toString()=>'${super.toString()}[${LS}]';bool HB(L A){return A is RG&&super.HB(A)&&LS==A.LS;}}class nI extends lB{nI(A):super(A);k c(s B){var A=HS.c(B);if(A.TC){return B.aB(A.value);}else{return A;}}}class WG extends lB{final String LS;WG(A,this.LS):super(A);k c(s A){var B=HS.c(A);if(B.CD){return A.aB(null);}else{return A.QC(LS);}}String toString()=>'${super.toString()}[${LS}]';bool HB(L A){return A is WG&&super.HB(A)&&LS==A.LS;}}class YG extends lB{final MS;YG(A,this.MS):super(A);k c(s A){var B=HS.c(A);if(B.TC){return B;}else{return A.aB(MS);}}bool HB(L A){return A is YG&&super.HB(A)&&MS==A.MS;}}abstract class ZG extends L{final List<L> NS;ZG(this.NS);List<L> get hC=>NS;void replace(L B,L C){super.replace(B,C);for(var A=0;A<NS.length;A++ ){if(NS[A]==B){NS[A]=C;}}}}class pD extends ZG{factory pD(Iterable<L> A){return new pD.FR(new List.from(A,growable:false));}pD.FR(List<L> A):super(A);k c(s C){var A;for(var B=0;B<NS.length;B++ ){A=NS[B].c(C);if(A.TC){return A;}}return A;}L OE(L A){return new pD(new List()..addAll(NS)..add(A));}}class tC extends ZG{factory tC(Iterable<L> A){return new tC.GR(new List.from(A,growable:false));}tC.GR(List<L> A):super(A);k c(s H){var C=H;var D=new List(NS.length);for(var A=0;A<NS.length;A++ ){var B=NS[A].c(C);if(B.CD){return B;}D[A]=B.value;C=B;}return C.aB(D);}L HD(L A){return new tC(new List()..addAll(NS)..add(A));}}class s{const s(this.buffer,this.position);final buffer;final int position;k aB(B,[int A]){return new mI(buffer,A==null?this.position:A,B);}k QC(String B,[int A]){return new TG(buffer,A==null?this.position:A,B);}String toString()=>'Context[${zF()}]';String zF()=>sC.rI(buffer,position);}abstract class k extends s{const k(A,B):super(A,B);bool get TC=>false;bool get CD=>false;get value;String get message;}class mI extends k{const mI(A,B,this.value):super(A,B);bool get TC=>true;final value;String get message=>null;String toString()=>'Success[${zF()}]: ${value}';}class TG extends k{const TG(A,B,this.message):super(A,B);bool get CD=>true;get value=>throw new pI(this);final String message;String toString()=>'Failure[${zF()}]: ${message}';}class pI extends Error{final TG QC;pI(this.QC);String toString()=>'${QC.message} at ${QC.zF()}';}abstract class VG{const VG();L start();L M(Function A,[B,C,D,H,K,O]){var P=[B,C,D,H,K,O].takeWhile((Z)=>Z!=null).toList(growable:false);return new qB(A,P);}L pP({Function start: null,List arguments: const[] }){return OS(new qB(start!=null?start:this.start,arguments));}L OS(qB C){var K=new Map();L O(qB C){var A=K[C];if(A==null){var D=[C];A=C.resolve();while(A is qB){if(D.contains(A)){throw new StateError('Recursive references detected: ${D}');}D.add(A);A=A.resolve();}for(var EB in D){K[EB]=A;}}return A;}var H=[O(C)];var P=new Set.from(H);while(H.isNotEmpty){var Z=H.removeLast();for(var B in Z.hC){if(B is qB){var j=O(B);Z.replace(B,j);B=j;}if(!P.contains(B)){P.add(B);H.add(B);}}}return K[C];}}class vI extends lB{vI(VG A):super(A.pP());}class qB extends L{final Function function;final List arguments;qB(this.function,this.arguments);L resolve()=>Function.apply(function,arguments);bool operator==(A){if(A is!qB||A.function!=function||A.arguments.length!=arguments.length){return false;}for(var B=0;B<arguments.length;B++ ){var C=arguments[B],D=A.arguments[B];if(C is L&&C is!qB&&D is L&&D is!qB){if(!C.UL(D)){return false;}}else{if(C!=D){return false;}}}return true;}int get hashCode=>function.hashCode;k c(s A)=>throw new UnsupportedError('References cannot be parsed.');}abstract class L{k c(s A);k DB(A){return c(new s(A,0));}Iterable mC(B){var A=new List();nP().map((C)=>A.add(C)).HD(bC()).OE(bC()).AC().DB(B);return A;}Iterable XQ(B){var A=new List();map((C)=>A.add(C)).OE(bC()).AC().DB(B);return A;}L yB([A])=>new YG(this,A);L AC()=>sF(0,nD);L qF()=>sF(1,nD);L sF(int A,int B){return new kI(this,A,B);}L yF(int A)=>sF(A,A);L HD(L A)=>new tC([this,A]);L operator&(L A)=>this.HD(A);L OE(L A)=>new pD([this,A]);L operator|(L A)=>this.OE(A);L nP()=>new nI(this);L bQ([String A])=>new WG(this,A);L fL([String A])=>bQ(A).HD(bC()).WC(1);L mH()=>new oI(this);L bB()=>new tI(this);L trim([L A,L B]){if(A==null)A=LN();if(B==null)B=A;return new jI(this,A,B);}L end([String A='end of input expected']){return new RG(this,A);}L map(Function A)=>new OG(this,A);L WC(int A){return this.map((List B){return B[A<0?B.length+A:A];});}L fQ(List<int> C){return this.map((List B){return C.map((A){return B[A<0?B.length+A:A];}).toList();});}L RE(L B,{bool includeSeparators: true,bool optionalSeparatorAtEnd: false}){var D=new tC([B,this]).AC();var K=new tC(optionalSeparatorAtEnd?[this,D,B.yB(B)]:[this,D]);return K.map((List C){var A=new List();A.add(C[0]);for(var H in C[1]){if(includeSeparators){A.add(H[0]);}A.add(H[1]);}if(includeSeparators&&optionalSeparatorAtEnd&&!identical(C[2],B)){A.add(C[2]);}return A;});}bool UL(L B,[Set<L> A]){if(A==null){A=new Set();}if(this==B||A.contains(this)){return true;}A.add(this);return runtimeType==B.runtimeType&&HB(B)&&MQ(B,A);}bool HB(L A)=>true;bool MQ(L D,Set<L> H){var B=hC,C=D.hC;if(B.length!=C.length){return false;}for(var A=0;A<B.length;A++ ){if(!B[A].UL(C[A],H)){return false;}}return true;}List<L> get hC=>const[] ;void replace(L A,L B){}}L bC([String A='input expected']){return new QG(A);}class QG extends L{final String LS;QG(this.LS);k c(s A){var B=A.position;var C=A.buffer;return B<C.length?A.aB(C[B],B+1):A.QC(LS);}bool HB(L A){return A is QG&&super.HB(A)&&LS==A.LS;}}L SG(A,[String B]){return sI(1,(C)=>A.indexOf(C)>=0,B!=null?B:'any of ${A} expected');}L oD(String A,[String B]){return sI(A.length,(String C)=>A==C,B!=null?B:'${A} expected');}typedef bool qI(_0);L sI(int A,qI B,String C){return new XG(A,B,C);}class XG extends L{final int PS;final qI KS;final String LS;XG(this.PS,this.KS,this.LS);k c(s A){final C=A.position;final B=C+PS;if(B<=A.buffer.length){var D=A.buffer is String?A.buffer.substring(C,B):A.buffer.sublist(C,B);if(KS(D)){return A.aB(D,B);}}return A.QC(LS);}String toString()=>'${super.toString()}[${LS}]';bool HB(L A){return A is XG&&super.HB(A)&&PS==A.PS&&KS==A.KS&&LS==A.LS;}}const int nD=-1;abstract class PG extends lB{final int QS;final int RS;PG(L A,this.QS,this.RS):super(A){assert(0<=QS);assert(RS==nD||QS<=RS);}String toString(){var A=RS==nD?'*':RS;return '${super.toString()}[${QS}..${A}]';}bool HB(L A){return A is PG&&super.HB(A)&&QS==A.QS&&RS==A.RS;}}class kI extends PG{kI(L A,int B,int C):super(A,B,C);k c(s D){var B=D;var C=new List();while(C.length<QS){var A=HS.c(B);if(A.CD){return A;}C.add(A.value);B=A;}while(RS==nD||C.length<RS){var A=HS.c(B);if(A.CD){return B.aB(C);}C.add(A.value);B=A;}return B.aB(C);}}class sC{final value;final buffer;final int start;final int stop;const sC(this.value,this.buffer,this.start,this.stop);int get length=>stop-start;int get IB=>sC.UG(buffer,start)[0];int get g=>sC.UG(buffer,start)[1];String toString()=>'Token[${rI(buffer,start)}]: ${value}';bool operator==(A){return A is sC&&value==A.value&&start==A.start&&stop==A.stop;}int get hashCode=>value.hashCode+start.hashCode+stop.hashCode;static L FN()=>GN;static final L GN=W('\n')|(W('\r')&W('\n').yB());static List<int> UG(String H,int A){var B=1,C=0;for(var D in FN().bB().XQ(H)){if(A<D.stop){return [B,A-C+1];}B++ ;C=D.stop;}return [B,A-C+1];}static String rI(A,int B){if(A is String){var C=sC.UG(A,B);return '${C[0]}:${C[1]}';}else{return '${B}';}}}class SI<R> extends Object with ListMixin<R> implements Queue<R>{static const int TI=8;List<R> SS;int TS;int US;SI([int A]):TS=0,US=0{if(A==null||A<TI){A=TI;}else if(!UI(A)){A=VI(A);}assert(UI(A));SS=new List<R>(A);}void add(R A){VS(A);}void addAll(Iterable<R> H){if(H is List){var B=H;int A=B.length;int C=this.length;if(C+A>=SS.length){WS(C+A);SS.setRange(C,C+A,B,0);US+= A;}else{int D=SS.length-US;if(A<D){SS.setRange(US,US+A,B,0);US+= A;}else{int K=A-D;SS.setRange(US,US+D,B,0);SS.setRange(0,K,B,D);US=K;}}}else{for(R O in H)VS(O);}}String toString()=>IterableBase.iterableToFullString(this,"{","}");void addLast(R A){VS(A);}void addFirst(R A){TS=(TS-1)&(SS.length-1);SS[TS]=A;if(TS==US)XS();}R removeFirst(){if(TS==US)throw new StateError("No element");R A=SS[TS];SS[TS]=null;TS=(TS+1)&(SS.length-1);return A;}R removeLast(){if(TS==US)throw new StateError("No element");US=(US-1)&(SS.length-1);R A=SS[US];SS[US]=null;return A;}int get length=>(US-TS)&(SS.length-1);void set length(int A){if(A<0)throw new RangeError("Length ${A} may not be negative.");int C=A-length;if(C>=0){if(SS.length<=A){WS(A);}US=(US+C)&(SS.length-1);return;}int B=US+C;if(B>=0){SS.fillRange(B,US,null);}else{B+= SS.length;SS.fillRange(0,US,null);SS.fillRange(B,SS.length,null);}US=B;}R operator[](int A){if(A<0||A>=length){throw new RangeError("Index ${A} must be in the range [0..${length}).");}return SS[(TS+A)&(SS.length-1)];}void operator[]=(int A,R B){if(A<0||A>=length){throw new RangeError("Index ${A} must be in the range [0..${length}).");}SS[(TS+A)&(SS.length-1)]=B;}static bool UI(int A)=>(A&(A-1))==0;static int VI(int A){assert(A>0);A=(A<<1)-1;for(;;){int B=A&(A-1);if(B==0)return A;A=B;}}void VS(R A){SS[US]=A;US=(US+1)&(SS.length-1);if(TS==US)XS();}void XS(){List<R> A=new List<R>(SS.length*2);int B=SS.length-TS;A.setRange(0,B,SS,TS);A.setRange(B,B+TS,SS,0);TS=0;US=SS.length;SS=A;}int YS(List<R> A){assert(A.length>=length);if(TS<=US){int C=US-TS;A.setRange(0,C,SS,TS);return C;}else{int B=SS.length-TS;A.setRange(0,B,SS,TS);A.setRange(B,B+US,SS,0);return US+B;}}void WS(int A){assert(A>=length);A+= A>>1;int C=VI(A);List<R> B=new List<R>(C);US=YS(B);SS=B;TS=0;}}abstract class OD<BB,f> implements Map<BB,f>{factory OD()=>new gE();}class gE<BB,f> implements OD<BB,f>{final Map<BB,f> ZS;final Map<f,BB> aS;OD<f,BB> bS;gE():this.HR(new HashMap(),new HashMap());gE.HR(this.ZS,this.aS);f operator[](Object A)=>ZS[A];void operator[]=(BB A,f B){cS(A,B,false);}void replace(BB A,f B){cS(A,B,true);}void addAll(Map<BB,f> A)=>A.forEach((B,C)=>cS(B,C,false));bool containsKey(Object A)=>ZS.containsKey(A);bool containsValue(Object A)=>aS.containsKey(A);void forEach(void A(BB key,f value))=>ZS.forEach(A);bool get isEmpty=>ZS.isEmpty;bool get isNotEmpty=>ZS.isNotEmpty;Iterable<BB> get keys=>ZS.keys;int get length=>ZS.length;Iterable<f> get values=>aS.keys;OD<f,BB> get QQ{if(bS==null){bS=new gE.HR(aS,ZS);}return bS;}f putIfAbsent(BB A,f C()){var B=ZS[A];if(B!=null)return B;if(!ZS.containsKey(A))return cS(A,C(),false);return null;}f remove(Object A){aS.remove(ZS[A]);return ZS.remove(A);}void clear(){ZS.clear();aS.clear();}f cS(BB B,f A,bool D){if(B==null)throw new ArgumentError("null key");if(A==null)throw new ArgumentError("null value");var C=ZS[B];if(C==A)return A;if(aS.containsKey(A)){if(!D)throw new ArgumentError("Mapping for ${A} exists");ZS.remove(aS[A]);}aS.remove(C);ZS[B]=A;aS[A]=B;return A;}}Iterable NN(Iterable<Iterable> A)=>A.expand((B)=>B);abstract class n implements Comparable<n>{factory n(WB A,WB B,String C)=>new cG(A,B,C);}class cG extends BJ{final WB start;final WB end;final String ID;cG(this.start,this.end,this.ID){if(end.Y!=start.Y){throw new ArgumentError("Source URLs \"${start.Y}\" and " " \"${end.Y}\" don't match.");}else if(end.offset<start.offset){throw new ArgumentError('End ${end} must come after start ${start}.');}else if(ID.length!=start.vK(end)){throw new ArgumentError('Text "${ID}" must be ${start.vK(end)} ' 'characters long.');}}}class AJ implements Exception{String get message=>dS;final String dS;n get J=>eS;final n eS;AJ(this.dS,this.eS);String toString({color}){if(J==null)return message;return "Error on "+J.message(message,color:color);}}class dG extends AJ implements FormatException{dynamic get source=>fS;final fS;int get offset=>J==null?null:J.start.offset;dG(String A,n B,[this.fS]):super(A,B);}abstract class BJ implements n{Uri get Y=>start.Y;int get length=>end.offset-start.offset;int compareTo(n A){var B=start.compareTo(A.start);return B==0?end.compareTo(A.end):B;}String message(String P,{color}){if(color==true)color=ON;if(color==false)color=null;var Z=start.IB;var B=start.g;var A=new StringBuffer();A.write('line ${Z+1}, column ${B+1}');if(Y!=null)A.write(' of ${vM(Y)}');A.write(': ${P}');if(length==0&&this is!hE)return A.toString();A.write("\n");var C;if(this is hE){var D=(this as hE).context;var H=RN(D,ID,B);if(H!=null&&H>0){A.write(D.substring(0,H));D=D.substring(H);}var O=D.indexOf('\n');C=O==-1?D:D.substring(0,O+1);B=eD.min(B,C.length);}else{C=ID.split("\n").first;B=0;}var K=eD.min(B+end.offset-start.offset,C.length);if(color!=null){A.write(C.substring(0,B));A.write(color);A.write(C.substring(B,K));A.write(zI);A.write(C.substring(K));}else{A.write(C);}if(!C.endsWith('\n'))A.write('\n');A.write(' '*B);if(color!=null)A.write(color);A.write('^'*eD.max(K-B,1));if(color!=null)A.write(zI);return A.toString();}bool operator==(A)=>A is n&&start==A.start&&end==A.end;int get hashCode=>start.hashCode+(31*end.hashCode);String toString()=>'<${runtimeType}: from ${start} to ${end} "${ID}">';}class PD extends fG implements SN{final uC gS;int get IB=>gS.jF(position);int get g=>gS.nH(position);dC get state=>new EJ(this,position);h hS;cC get location=>gS.location(position);h get QB=>location.KB();PD(String A,{sourceUrl,int position}):gS=new uC(A,url:sourceUrl),super(A,sourceUrl:sourceUrl,position:position);factory PD.WR(String string,{sourceUrl,int position})=eG;h LB(dC B,[dC A]){var C=A==null?position:A.position;return gS.J(B.position,C);}bool mC(Pattern A){if(!super.mC(A)){hS=null;return false;}hS=gS.J(position,aD.end);return true;}void error(String A,{Match match,int position,int length}){FJ(string,match,position,length);if(match==null&&position==null&&length==null)match=aD;if(position==null){position=match==null?this.position:match.start;}if(length==null)length=match==null?1:match.end-match.start;var B=gS.J(position,position+length);throw new iE(A,B,string);}}class EJ implements dC{final PD iS;final int position;int get IB=>iS.gS.jF(position);int get g=>iS.gS.nH(position);EJ(this.iS,this.position);}class hE extends cG{}final TN=new RegExp("/").pattern=="\\/";class fG{final Uri Y;final String string;int get position=>jS;set position(int A){if(A<0||A>string.length){throw new ArgumentError("Invalid position ${A}");}jS=A;}int jS=0;Match get aD=>kS;Match kS;String get zB=>string.substring(position);bool get RC=>position==string.length;fG(this.string,{sourceUrl,int position}):Y=sourceUrl is String?Uri.parse(sourceUrl):sourceUrl{if(position!=null)this.position=position;}int S(){if(RC)lS("more input");return string.codeUnitAt(jS++ );}int U([int A]){if(A==null)A=0;var B=position+A;if(B<0||B>=string.length)return null;return string.codeUnitAt(B);}bool q(Pattern B){var A=mC(B);if(A)jS=kS.end;return A;}void gF(Pattern A,{String name}){if(q(A))return;if(name==null){if(A is RegExp){var B=A.pattern;if(!TN)B=B.replaceAll("/","\\/");name="/${B}/";}else{name=A.toString().replaceAll("\\","\\\\").replaceAll('"','\\"');name='"${name}"';}}lS(name);}bool mC(Pattern A){kS=A.matchAsPrefix(string,position);return kS!=null;}String substring(int B,[int A]){if(A==null)A=position;return string.substring(B,A);}void error(String A,{Match match,int position,int length}){FJ(string,match,position,length);if(match==null&&position==null&&length==null)match=aD;if(position==null){position=match==null?this.position:match.start;}if(length==null)length=match==null?1:match.end-match.start;var B=new uC(string,url:Y);var C=B.J(position,position+length);throw new iE(A,C,string);}void lS(String A){error("expected ${A}.",position:this.position,length:0);}}class GJ extends vI{GJ():super(new YN());}class UN{String encode(Map<String,dynamic> B){var A=new WN();A.kH(B,name:[] );return A.toString();}}abstract class VN{}typedef void gG<f>(f _0);class WN{static final RegExp XN=new RegExp(r'^[A-Za-z0-9_-]+$');final StringBuffer mS=new StringBuffer();void qH(){if(mS.isNotEmpty)mS.writeln();}void OQ(List<String> B,{bool array: false}){if(B.isNotEmpty){qH();qH();mS.write(array?'[[':'[');for(int A=0;A<B.length;A++ ){if(A!=0)mS.write('.');DL(B[A]);}mS.write(array?']]':']');}}DI(A){while(A is VN)A=A.VR();return A;}void kH(Map<String,dynamic> K,{List<String> name,bool array: false}){var C={};var D={};K.forEach((B,A){A=DI(A);if(A is Map){D[B]=A;return;}if(A is Iterable&&A.length>0){A=A.map(DI);if(A.every((H)=>H is Map)){D[B]=A;return;}}C[B]=A;});if(array||C.isNotEmpty){OQ(name,array:array);C.forEach(PQ);}D.forEach((B,A){name.add(B);if(A is Map){kH(A,name:name);}else if(A is Iterable){A.forEach((H){kH(H,name:name,array:true);});}name.removeLast();});}void PQ(String A,B){qH();DL(A);mS.write(' = ');EL(B);}void DL(String A){if(XN.hasMatch(A)){mS.write(A);}else{CL(A);}}void EL(A){A=DI(A);gG B=LQ(A);if(B==null)throw new jG(A);B(A);}gG LQ(A){if(A is num)return DQ;if(A is bool)return yP;if(A is DateTime)return zP;if(A is String)return EQ;if(A is Iterable)return xP;return null;}void DQ(num A){mS.write('${A}');}void yP(bool A){mS.write(A?'true':'false');}void zP(DateTime A){mS.write(A.toIso8601String());}Type rQ(Iterable B){if(B.isEmpty)return null;if(identical(1,1.0)&&B.every((A)=>A is num)&&B.any((A)=>A is int)&&B.any((A)=>A is!int)){return num;}return B.map((A)=>A.runtimeType).reduce((C,D){if(C!=D)throw new kG(B);return C;});}void xP(Iterable B){var D=rQ(B);mS.write('[');for(var A=0;A<B.length;A++ ){var C=B.elementAt(A);if(A!=0)mS.write(', ');EL(C);if(D==num&&C is int)mS.write('.0');}mS.write(']');}gG<String> KQ(String A){var C=[dB.mB['"'],dB.mB['\\']];bool B(String D)=>dB.mB.values.where((H)=>!C.contains(H)).any(D.codeUnits.contains);if(A.contains('\n')||A.contains('\r')){if(A.split(new RegExp('\n|\r')).any(B)){return BQ;}return CQ;}if(A.contains("'")||B(A)){return CL;}return AQ;}void EQ(String A){var B=KQ(A);B(A);}void nS(String A,{String quotes,Iterable<int> esc: const[] ,bool multiline: false}){if(esc.isNotEmpty){A=A.codeUnits.map((int B){if(esc.contains(B)){return '\\${dB.mB.QQ[B]}';}return new String.fromCharCode(B);}).join();}if(multiline){if(quotes=='"""')A=A.replaceAll('"""',r'\"\"\"');}else if(A.contains('\n')||A.contains('\r')){throw new jE('Newlines are only allowed in multi-line strings!');}if(!esc.contains(quotes.codeUnitAt(0))&&A.contains(quotes)){throw new jE('"${quotes}" are prohibited in non-basic strings.');}mS.write(quotes);if(multiline)mS.writeln();mS.write(A);mS.write(quotes);}void CL(String A)=>nS(A,quotes:'"',esc:dB.mB.values);void BQ(String B)=>nS(B,quotes:'"""',esc:dB.mB.values.where((A)=>A!=dB.mB['"']&&A!=dB.mB['n']&&A!=dB.mB['r']),multiline:true);void AQ(String A)=>nS(A,quotes:"'");void CQ(String A)=>nS(A,quotes:"'''",multiline:true);String toString()=>mS.toString();}class hG{final String LE;hG(this.LE);bool operator==(A)=>A is hG&&A.LE==LE;int get hashCode=>LE.hashCode;String toString()=>'The escape sequence "${LE}" is invalid!';}class jE{final String ME;jE(this.ME);bool operator==(A)=>A is jE&&A.ME==ME;int get hashCode=>ME.hashCode;String toString()=>ME;}class rD{final String name;rD(this.name);bool operator==(A)=>A is rD&&A.name==name;int get hashCode=>name.hashCode;String toString()=>'Cannot redefine "${name}"!';}class iG{final String name;iG(this.name);bool operator==(A)=>A is iG&&A.name==name;int get hashCode=>name.hashCode;String toString()=>'Cannot define table "${name}"! Parent must be a table!';}class jG{final value;jG(this.value);bool operator==(A)=>A is jG&&A.value==value;int get hashCode=>value.hashCode;String toString()=>'"${value}" cannot be encoded as a TOMl value!';}class kG{final Iterable gC;kG(this.gC);bool operator==(A)=>A is kG&&A.gC==gC;int get hashCode=>gC.hashCode;String toString()=>'The items of "${gC}" must all be of the same type!';}class dB extends VG{static final OD<String,int> mB=new OD()..addAll({'b':0x08,'t':0x09,'n':0x0A,'f':0x0C,'r':0x0D,'"':0x22,r'\':0x5C});start()=>M(jH).end();bB(A,[bool C=false,bool B]){if(B==null)B=C;if(A is Function)A=M(A);var D=M(lC,C);var H=M(lC,B);return A.mH().trim(D,H);}lC([bool A=false])=>A?M(lC)|M(UC):M(GI)|M(uP);GI()=>W(' ')|W('\t');UC()=>W('\n')|W('\r')&W('\n');uP()=>W('#')&M(UC).fL().AC();value()=>M(eF)|M(iF)|M(mF)|M(bF)|M(AM)|M(gC)|M(lF);L oS({L quotes,L esc,bool multiline: false}){var A=quotes;if(multiline)A=(A&M(yK).yB()).WC(0);var C=quotes;if(!multiline)C|= M(UC);var B=C.fL();if(esc!=null)B=esc|B;return (A&B.AC()&quotes).trim(M(lC)).WC(1).map((List D)=>D.join());}AM()=>M(YQ)|M(lK)|M(aQ)|M(UQ);lK()=>oS(quotes:W('"'),esc:M(fF));fF()=>W('\\')&(M(CI)|M(yH));CI()=>W('u')&M(QL).yF(4).mH()|W('U')&M(QL).yF(8).mH();yH()=>bC();QL()=>wI('0-9a-fA-F');YQ()=>oS(quotes:oD('"""'),esc:M(ZQ),multiline:true);ZQ()=>M(HI)|M(fF);HI()=>W('\\')&M(yK).qF()&M(GI).AC();yK()=>M(GI).AC()&M(UC);UQ()=>oS(quotes:oD("'"));aQ()=>oS(quotes:oD("'''"),multiline:true);mF()=>M(bB,pS);pS()=>SG('+-').yB()&(W('0')|M(sK));sK()=>fE().qF().RE(W('_'));iF()=>M(bB,qS);qS()=>M(pS)&(M(FQ)&M(FL).yB()|M(FL));FQ()=>W('.')&M(sK);FL()=>SG('eE')&M(pS);bF()=>M(bB,rS);rS()=>oD('true')|oD('false');eF()=>M(bB,sS);sS()=>M(HQ)&W('T')&M(IQ);HQ()=>M(vP)&W('-')&M(BD)&W('-')&M(BD);IQ()=>M(eQ)&M(oQ);eQ()=>M(BD)&W(':')&M(BD)&W(':')&M(BD)&(W('.')&fE().sF(1,6)).yB();oQ()=>W('Z')|M(nQ);nQ()=>SG('+-')&M(BD)&W(':')&M(BD);BD()=>fE().yF(2);vP()=>fE().yF(4);gC()=>OC(eF)|OC(iF)|OC(mF)|OC(bF)|OC(AM)|OC(gC)|OC(lF);OC(A)=>M(bB,W('['),false,true)&M(A).RE(M(bB,W(','),true),optionalSeparatorAtEnd:true,includeSeparators:false).yB([] )&M(bB,W(']'),true,false);zH()=>M(wF).trim(M(lC,true))&M(sH);wF()=>W('[')&M(lQ)&W(']');AI()=>M(BI).trim(M(lC,true))&M(sH);BI()=>W('[')&M(wF)&W(']');lF()=>M(bB,W('{'))&M(oF).RE(bB(W(',')),optionalSeparatorAtEnd:false,includeSeparators:false).yB([] )&M(bB,W('}'));key()=>M(bB,oP)|M(hQ);oP()=>wI('A-Za-z0-9_-').qF();hQ()=>M(lK);lQ()=>M(key).RE(W('.'),includeSeparators:false);oF()=>M(key)&W('=')&M(value);sH()=>M(oF).RE(M(UC)&M(lC,true).AC(),includeSeparators:false,optionalSeparatorAtEnd:true).yB([] );jH()=>M(lC,true).AC()&M(sH)&(M(zH)|M(AI)).AC();}class YN extends dB{fF()=>super.fF().WC(1);yH()=>super.yH().map((String A){if(dB.mB.containsKey(A)){return new String.fromCharCode(dB.mB[A]);}throw new hG('\\${A}');});CI()=>super.CI().WC(1).map((A)=>new String.fromCharCode(int.parse(A,radix:16)));HI()=>super.HI().map((A)=>'');mF()=>super.mF().map((A)=>int.parse(A.replaceAll('_','')));iF()=>super.iF().map((A)=>double.parse(A.replaceAll('_','')));bF()=>super.bF().map((A)=>A=='true');eF()=>super.eF().map(DateTime.parse);OC(A)=>super.OC(A).WC(1);zH()=>super.zH().map((List A)=>{'type':'table','parent':A[0].sublist(0,A[0].length-1),'name':A[0].last,'pairs':A[1]});wF()=>super.wF().WC(1);AI()=>super.AI().map((List A)=>{'type':'table-array','parent':A[0].sublist(0,A[0].length-1),'name':A[0].last,'pairs':A[1]});BI()=>super.BI().WC(1);lF()=>super.lF().WC(1).map((List C){var A={};C.forEach((Map B){A[B['key']]=B['value'];});return A;});oF()=>super.oF().fQ([0,2]).map((List A)=>{'key':A[0],'value':A[1]});jH()=>super.jH().map((List iB){var O={};var BC=new Set();void P(String A){if(BC.contains(A))throw new rD(A);BC.add(A);}Function dD(Map BG,[String CG])=>(Map H){var A=CG==null?H['key']:'${CG}.${H['key']}';P(A);if(BG.containsKey(H['key']))throw new rD(A);BG[H['key']]=H['value'];};iB[1].forEach(dD(O));iB[2].forEach((Map C){var B=O;var A=[] ;C['parent'].forEach((String K){B=B.putIfAbsent(K,()=>{});if(B is List){K='${K}[${B.length-1}]';B=B.last;}A.add(K);if(B is!Map)throw new iG(A.join('.'));});A.add(C['name']);A=A.join('.');var Z;if(C['type']=='table-array'){var j=B.putIfAbsent(C['name'],(){P(A);return [] ;});if(j is Map)throw new rD(A);var tQ=j.length;j.add(Z={});A='${A}[${tQ}]';}else{Z=B.putIfAbsent(C['name'],()=>{});}P(A);C['pairs'].forEach(dD(Z,A));});EB(D){if(D is Map){return new UnmodifiableMapView(new Map.fromIterables(D.keys,D.values.map(EB)));}if(D is List){return new UnmodifiableListView(D.map(EB));}return D;}return EB(O);});}abstract class bM<BB,f> implements Map<BB,f>{static hD(){throw new UnsupportedError("Cannot modify an unmodifiable Map");}void operator[]=(BB A,f B)=>hD();f putIfAbsent(BB A,f B())=>hD();void addAll(Map<BB,f> A)=>hD();f remove(Object A)=>hD();void clear()=>hD();}class LI{static const gD=3;final List tH;StringBuffer buffer;int iC=0;List<int> cF;int pF=0;int NE=0;LI(this.tH);String JQ(){buffer=new StringBuffer();rP();for(var B in tH){if(B is String){if(buffer.isNotEmpty)buffer.write("\n\n");buffer.write(B);NE=1;continue;}var A=B as GB;if(A.hide)continue;write(0,IL(A));write(1,KL(A));if(A.pH!=null)write(2,A.pH);if(A.YD!=null){var C=A.YD.keys.toList(growable:false);C.sort();UC();for(var D in C){write(1,JL(D));write(2,A.YD[D]);}UC();}else if(A.HE!=null){write(2,qP(A));}else if(A.PC!=null){if(A.SC&&A.PC==true){write(2,'(defaults to on)');}else if(!A.SC){write(2,'(defaults to "${A.PC}")');}}if(pF>1)UC();}return buffer.toString();}String IL(GB A){if(A.fC!=null){return '-${A.fC}, ';}else{return '';}}String KL(GB A){var B;if(A.negatable){B='--[no-]${A.name}';}else{B='--${A.name}';}if(A.FI!=null)B+= "=<${A.FI}>";return B;}String JL(String A){return '      [${A}]';}void rP(){int C=0;int A=0;for(var B in tH){if(B is!GB)continue;if(B.hide)continue;C=eD.max(C,IL(B).length);A=eD.max(A,KL(B).length);if(B.YD!=null){for(var D in B.YD.keys){A=eD.max(A,JL(D).length);}}}A+= 4;cF=[C,A];}void UC(){NE++ ;iC=0;pF=0;}void write(int B,String C){var A=C.split('\n');while(A.length>0&&A[0].trim()==''){A.removeRange(0,1);}while(A.length>0&&A[A.length-1].trim()==''){A.removeLast();}for(var D in A){sQ(B,D);}}void sQ(int A,String B){while(NE>0){buffer.write('\n');NE-- ;}while(iC!=A){if(iC<gD-1){buffer.write(MI('',cF[iC]));}else{buffer.write('\n');}iC=(iC+1)%gD;}if(A<cF.length){buffer.write(MI(B,cF[A]));}else{buffer.write(B);}iC=(iC+1)%gD;if(A==gD-1)NE++ ;if(A==gD-1){pF++ ;}else{pF=0;}}String qP(GB B){var A=new StringBuffer();A.write('[');bool C=true;for(var D in B.HE){if(!C)A.write(', ');A.write(D);if(D==B.PC){A.write(' (default)');}C=false;}A.write(']');return A.toString();}}String MI(String B,int C){final A=new StringBuffer();A.write(B);while(A.length<C){A.write(' ');}return A.toString();}int RN(String B,String C,int D){var O=C=='';var A=B.indexOf(C);while(A!=-1){var H=B.lastIndexOf('\n',A)+1;var K=A-H;if(D==K||(O&&D==K+1)){return H;}A=B.indexOf(C,A+1);}return null;}void FJ(String C,Match D,int A,int B){if(D!=null&&(A!=null||B!=null)){throw new ArgumentError("Can't pass both match and position/length.");}if(A!=null){if(A<0){throw new RangeError("position must be greater than or equal to 0.");}else if(A>C.length){throw new RangeError("position must be less than or equal to the " "string length.");}}if(B!=null&&B<0){throw new RangeError("length must be greater than or equal to 0.");}if(A!=null&&B!=null&&A+B>C.length){throw new RangeError("position plus length must not go beyond the end of " "the string.");}}WO(String A,{sourceUrl})=>XO(A,sourceUrl:sourceUrl).value;o XO(String A,{sourceUrl})=>YO(A,sourceUrl:sourceUrl).iH;UD YO(String D,{sourceUrl}){var A=new PJ(D,sourceUrl:sourceUrl);var B=A.load();if(B==null){return new UD.OR(new t.SR(null,A.J),A.J,null,const[] );}var C=A.load();if(C!=null){throw new V("Only expected one document.",C.J);}return B;}Map ZN()=>new HashMap(equals:aN,hashCode:HJ);bool aN(A,B)=>new bN().jC(A,B);class bN{final tS=[] ;final uS=[] ;bool jC(A,B){if(A is t)A=A.value;if(B is t)B=B.value;for(var C=0;C<tS.length;C++ ){var D=identical(A,tS[C]);var H=identical(B,uS[C]);if(D&&H)return true;if(D||H)return false;}tS.add(A);uS.add(B);try {if(A is List&&B is List){return vS(A,B);}else if(A is Map&&B is Map){return wS(A,B);}else if(A is num&&B is num){return xS(A,B);}else{return A==B;}}finally {tS.removeLast();uS.removeLast();}}bool vS(List B,List C){if(B.length!=C.length)return false;for(var A=0;A<B.length;A++ ){if(!jC(B[A],C[A]))return false;}return true;}bool wS(Map A,Map B){if(A.length!=B.length)return false;for(var C in A.keys){if(!B.containsKey(C))return false;if(!jC(A[C],B[C]))return false;}return true;}bool xS(num A,num B){if(A.isNaN&&B.isNaN)return true;return A==B;}}int HJ(H){var B=[] ;C(A){if(B.any((K)=>identical(K,A)))return -1;B.add(A);try {if(A is Map){var D=const RI();return D.kC(A.keys.map(C))^D.kC(A.values.map(C));}else if(A is Iterable){return const OI().kC(A.map(HJ));}else if(A is t){return A.value.hashCode;}else{return A.hashCode;}}finally {B.removeLast();}}return C(H);}class b{final X type;final h J;b(this.type,this.J);String toString()=>type.toString();}class kE implements b{get type=>X.cN;final h J;final zD versionDirective;final List<fB> xF;final bool isImplicit;kE(this.J,{this.versionDirective,List<fB> tagDirectives,this.isImplicit: true}):xF=tagDirectives==null?[] :tagDirectives;String toString()=>"DOCUMENT_START";}class lE implements b{get type=>X.KJ;final h J;final bool isImplicit;lE(this.J,{this.isImplicit: true});String toString()=>"DOCUMENT_END";}class lG implements b{get type=>X.LJ;final h J;final String name;lG(this.J,this.name);String toString()=>"ALIAS ${name}";}abstract class mG implements b{String get anchor;String get tag;String toString(){var A=new StringBuffer('${type}');if(anchor!=null)A.write(" &${anchor}");if(tag!=null)A.write(" ${tag}");return A.toString();}}class eB extends mG{get type=>X.MJ;final h J;final String anchor;final String tag;final String value;final AB Q;eB(this.J,this.value,this.Q,{this.anchor,this.tag});String toString()=>"${super.toString()} \"${value}\"";}class sD extends mG{get type=>X.NJ;final h J;final String anchor;final String tag;final XB Q;sD(this.J,this.Q,{this.anchor,this.tag});}class tD extends mG{get type=>X.OJ;final h J;final String anchor;final String tag;final XB Q;tD(this.J,this.Q,{this.anchor,this.tag});}class X{static const IJ=const X.KR("STREAM_START");static const JJ=const X.KR("STREAM_END");static const cN=const X.KR("DOCUMENT_START");static const KJ=const X.KR("DOCUMENT_END");static const LJ=const X.KR("ALIAS");static const MJ=const X.KR("SCALAR");static const NJ=const X.KR("SEQUENCE_START");static const mE=const X.KR("SEQUENCE_END");static const OJ=const X.KR("MAPPING_START");static const nE=const X.KR("MAPPING_END");final String name;const X.KR(this.name);String toString()=>name;}class V extends dG{V(String A,n B):super(A,B);}class PJ{final nG yS;final zS=new Map<String,o>();h get J=>AT;h AT;PJ(String B,{sourceUrl}):yS=new nG(B,sourceUrl:sourceUrl){var A=yS.DB();AT=A.J;assert(A.type==X.IJ);}UD load(){if(yS.RC)return null;var A=yS.DB();if(A.type==X.JJ){AT=AT.expand(A.J);return null;}var B=BT(A);AT=AT.expand(B.J);zS.clear();return B;}UD BT(kE A){var C=CT(yS.DB());var B=yS.DB() as lE;assert(B.type==X.KJ);return new UD.OR(C,A.J.expand(B.J),A.versionDirective,A.xF,startImplicit:A.isImplicit,endImplicit:B.isImplicit);}o CT(b A){switch (A.type){case X.LJ:return DT(A);case X.MJ:return ET(A);case X.NJ:return FT(A);case X.OJ:return GT(A);default:throw "Unreachable";}}void IT(String A,o B){if(A==null)return;zS[A]=B;}o DT(lG A){var B=zS[A.name];if(B!=null)return B;throw new V("Undefined alias.",A.J);}o ET(eB A){var B;if(A.tag=="!"){B=new t.RR(A.value,A);}else if(A.tag!=null){B=JT(A);}else{B=KT(A);}IT(A.anchor,B);return B;}o FT(sD A){if(A.tag!="!"&&A.tag!=null&&A.tag!="tag:yaml.org,2002:seq"){throw new V("Invalid tag for sequence.",A.J);}var D=<o>[] ;var C=new qJ.QR(D,A.J,A.Q);IT(A.anchor,C);var B=yS.DB();while(B.type!=X.mE){D.add(CT(B));B=yS.DB();}rJ(C,A.J.expand(B.J));return C;}o GT(tD A){if(A.tag!="!"&&A.tag!=null&&A.tag!="tag:yaml.org,2002:map"){throw new V("Invalid tag for mapping.",A.J);}var D=ZN();var C=new pJ.PR(D,A.J,A.Q);IT(A.anchor,C);var B=yS.DB();while(B.type!=X.nE){var H=CT(B);var K=CT(yS.DB());D[H]=K;B=yS.DB();}rJ(C,A.J.expand(B.J));return C;}t JT(eB A){switch (A.tag){case "tag:yaml.org,2002:null":var B=LT(A);if(B!=null)return B;throw new V("Invalid null scalar.",A.J);case "tag:yaml.org,2002:bool":var B=MT(A);if(B!=null)return B;throw new V("Invalid bool scalar.",A.J);case "tag:yaml.org,2002:int":var B=NT(A,allowFloat:false);if(B!=null)return B;throw new V("Invalid int scalar.",A.J);case "tag:yaml.org,2002:float":var B=NT(A,allowInt:false);if(B!=null)return B;throw new V("Invalid float scalar.",A.J);case "tag:yaml.org,2002:str":return new t.RR(A.value,A);default:throw new V('Undefined tag: ${A.tag}.',A.J);}}t KT(eB A)=>OT(A)??new t.RR(A.value,A);t OT(eB A){var B=A.value.length;if(B==0)return new t.RR(null,A);var C=A.value.codeUnitAt(0);switch (C){case VE:case EG:case FG:return NT(A);case WM:case TM:return B==4?LT(A):null;case YM:case UM:return B==4?MT(A):null;case VM:case SM:return B==5?MT(A):null;case aM:return B==1?new t.RR(null,A):null;default:if(C>=JD&&C<=WE)return NT(A);return null;}}t LT(eB A){switch (A.value){case "":case "null":case "Null":case "NULL":case "~":return new t.RR(null,A);default:return null;}}t MT(eB A){switch (A.value){case "true":case "True":case "TRUE":return new t.RR(true,A);case "false":case "False":case "FALSE":return new t.RR(false,A);default:return null;}}o NT(eB A,{bool allowInt: true,bool allowFloat: true}){var B=PT(A.value,allowInt:allowInt,allowFloat:allowFloat);return B==null?null:new t.RR(B,A);}num PT(String A,{bool allowInt: true,bool allowFloat: true}){assert(allowInt||allowFloat);var B=A.codeUnitAt(0);var H=A.length;if(allowInt&&H==1){var K=B-JD;return K>=0&&K<=9?K:null;}var C=A.codeUnitAt(1);if(allowInt&&B==JD){if(C==ZM)return int.parse(A,onError:(D)=>null);if(C==XM){var P=A.substring(2);return int.parse(P,radix:8,onError:(D)=>null);}}if((B>=JD&&B<=WE)||((B==EG||B==FG)&&C>=JD&&C<=WE)){var O=null;if(allowInt){O=int.parse(A,radix:10,onError:(D)=>null);}if(allowFloat)O??= double.parse(A,(D)=>null);return O;}if(!allowFloat)return null;if((B==VE&&C>=JD&&C<=WE)||(B==FG||B==EG)&&C==VE){if(H==5){switch (A){case "+.inf":case "+.Inf":case "+.INF":return double.INFINITY;case "-.inf":case "-.Inf":case "-.INF":return -double.INFINITY;}}return double.parse(A,(D)=>null);}if(H==4&&B==VE){switch (A){case ".inf":case ".Inf":case ".INF":return double.INFINITY;case ".nan":case ".NaN":case ".NAN":return double.NAN;}}return null;}}class nG{final vG QT;final RT=new List<N>();var ST=N.QJ;final TT=new Map<String,fB>();bool get RC=>ST==N.ZJ;nG(String A,{sourceUrl}):QT=new vG(A,sourceUrl:sourceUrl);b DB(){try {if(RC)throw new StateError("No more events.");var B=UT();return B;}on iE catch (A){throw new V(A.message,A.J);}}b UT(){switch (ST){case N.QJ:return VT();case N.oG:return WT();case N.RJ:return XT();case N.pG:return YT();case N.SJ:return ZT(block:true);case N.dN:return ZT(block:true,indentlessSequence:true);case N.eN:return ZT();case N.TJ:QT.q();return aT();case N.qG:return aT();case N.oE:return bT();case N.UJ:QT.q();return cT();case N.pE:return cT();case N.qE:return dT();case N.VJ:return eT(first:true);case N.rG:return eT();case N.WJ:return fT();case N.sG:return gT();case N.tG:return hT();case N.XJ:return iT(first:true);case N.rE:return iT();case N.uG:return jT();case N.YJ:return jT(empty:true);default:throw "Unreachable";}}b VT(){var A=QT.q();assert(A.type==I.jJ);ST=N.oG;return new b(X.IJ,A.J);}b WT(){var A=QT.JB();while(A.type==I.HF){A=QT.YB();}if(A.type!=I.EF&&A.type!=I.FF&&A.type!=I.GF&&A.type!=I.xD){kT();RT.add(N.pG);ST=N.SJ;return new kE(A.J.start.KB());}if(A.type==I.xD){ST=N.ZJ;QT.q();return new b(X.JJ,A.J);}var C=A.J;var B=kT();var D=B.first;var H=B.last;A=QT.JB();if(A.type!=I.GF){throw new V("Expected document start.",A.J);}RT.add(N.pG);ST=N.RJ;QT.q();return new kE(C.expand(A.J),versionDirective:D,tagDirectives:H,isImplicit:false);}b XT(){var A=QT.JB();switch (A.type){case I.EF:case I.FF:case I.GF:case I.HF:case I.xD:ST=RT.removeLast();return lT(A.J.start);default:return ZT(block:true);}}b YT(){TT.clear();ST=N.oG;var A=QT.JB();if(A.type==I.HF){QT.q();return new lE(A.J,isImplicit:false);}else{return new lE(A.J.start.KB(),isImplicit:true);}}b ZT({bool block: false,bool indentlessSequence: false}){var A=QT.JB();if(A is KH){QT.q();ST=RT.removeLast();return new lG(A.J,A.name);}var D;var H;var B=A.J.start.KB();K(A){D=A.name;B=B.expand(A.J);return QT.YB();}O(A){H=A;B=B.expand(A.J);return QT.YB();}if(A is CF){A=K(A);if(A is DF)A=O(A);}else if(A is DF){A=O(A);if(A is CF)A=K(A);}var C;if(H!=null){if(H.ZB==null){C=H.vF;}else{var P=TT[H.ZB];if(P==null){throw new V("Undefined tag handle.",H.J);}C=P.GD+H.vF;}}if(indentlessSequence&&A.type==I.TD){ST=N.oE;return new sD(B.expand(A.J),XB.GH,anchor:D,tag:C);}if(A is QD){if(C==null&&A.Q!=AB.BF)C="!";ST=RT.removeLast();QT.q();return new eB(B.expand(A.J),A.value,A.Q,anchor:D,tag:C);}if(A.type==I.lJ){ST=N.VJ;return new sD(B.expand(A.J),XB.HH,anchor:D,tag:C);}if(A.type==I.mJ){ST=N.XJ;return new tD(B.expand(A.J),XB.HH,anchor:D,tag:C);}if(block&&A.type==I.kJ){ST=N.TJ;return new sD(B.expand(A.J),XB.GH,anchor:D,tag:C);}if(block&&A.type==I.IF){ST=N.UJ;return new tD(B.expand(A.J),XB.GH,anchor:D,tag:C);}if(D!=null||C!=null){ST=RT.removeLast();return new eB(B,'',AB.BF,anchor:D,tag:C);}throw new V("Expected node content.",B);}b aT(){var A=QT.JB();if(A.type==I.TD){A=QT.YB();if(A.type==I.TD||A.type==I.wC){ST=N.qG;return lT(A.J.end);}else{RT.add(N.qG);return ZT(block:true);}}if(A.type==I.wC){QT.q();ST=RT.removeLast();return new b(X.mE,A.J);}throw new V("While parsing a block collection, expected '-'.",A.J.start.KB());}b bT(){var A=QT.JB();if(A.type!=I.TD){ST=RT.removeLast();return new b(X.mE,A.J.start.KB());}var B=A.J.start;A=QT.YB();if(A.type==I.TD||A.type==I.HC||A.type==I.uB||A.type==I.wC){ST=N.oE;return lT(B);}else{RT.add(N.oE);return ZT(block:true);}}b cT(){var A=QT.JB();if(A.type==I.HC){var B=A.J.start;A=QT.YB();if(A.type==I.HC||A.type==I.uB||A.type==I.wC){ST=N.qE;return lT(B);}else{RT.add(N.qE);return ZT(block:true,indentlessSequence:true);}}if(A.type==I.uB){ST=N.qE;return lT(A.J.start);}if(A.type==I.wC){QT.q();ST=RT.removeLast();return new b(X.nE,A.J);}throw new V("Expected a key while parsing a block mapping.",A.J.start.KB());}b dT(){var A=QT.JB();if(A.type!=I.uB){ST=N.pE;return lT(A.J.start);}var B=A.J.start;A=QT.YB();if(A.type==I.HC||A.type==I.uB||A.type==I.wC){ST=N.pE;return lT(B);}else{RT.add(N.pE);return ZT(block:true,indentlessSequence:true);}}b eT({bool first: false}){if(first)QT.q();var A=QT.JB();if(A.type!=I.RD){if(!first){if(A.type!=I.xC){throw new V("While parsing a flow sequence, expected ',' or ']'.",A.J.start.KB());}A=QT.YB();}if(A.type==I.HC){ST=N.WJ;QT.q();return new tD(A.J,XB.HH);}else if(A.type!=I.RD){RT.add(N.rG);return ZT();}}QT.q();ST=RT.removeLast();return new b(X.mE,A.J);}b fT(){var A=QT.JB();if(A.type==I.uB||A.type==I.xC||A.type==I.RD){var B=A.J.start;ST=N.sG;return lT(B);}else{RT.add(N.sG);return ZT();}}b gT(){var A=QT.JB();if(A.type==I.uB){A=QT.YB();if(A.type!=I.xC&&A.type!=I.RD){RT.add(N.tG);return ZT();}}ST=N.tG;return lT(A.J.start);}b hT(){ST=N.rG;return new b(X.nE,QT.JB().J.start.KB());}b iT({bool first: false}){if(first)QT.q();var A=QT.JB();if(A.type!=I.SD){if(!first){if(A.type!=I.xC){throw new V("While parsing a flow mapping, expected ',' or '}'.",A.J.start.KB());}A=QT.YB();}if(A.type==I.HC){A=QT.YB();if(A.type!=I.uB&&A.type!=I.xC&&A.type!=I.SD){RT.add(N.uG);return ZT();}else{ST=N.uG;return lT(A.J.start);}}else if(A.type!=I.SD){RT.add(N.YJ);return ZT();}}QT.q();ST=RT.removeLast();return new b(X.nE,A.J);}b jT({bool empty: false}){var A=QT.JB();if(empty){ST=N.rE;return lT(A.J.start);}if(A.type==I.uB){A=QT.YB();if(A.type!=I.xC&&A.type!=I.SD){RT.add(N.rE);return ZT();}}ST=N.rE;return lT(A.J.start);}b lT(WB A)=>new eB(A.KB(),'',AB.BF);yD<zD,List<fB>> kT(){var A=QT.JB();var B;var C=<fB>[] ;while(A.type==I.EF||A.type==I.FF){if(A is IH){if(B!=null){throw new V("Duplicate %YAML directive.",A.J);}if(A.DD!=1||A.nC==0){throw new V("Incompatible YAML document. This parser only supports YAML 1.1 " "and 1.2.",A.J);}else if(A.nC>2){oJ("Warning: this parser only supports YAML 1.1 and 1.2.",A.J);}B=new zD(A.DD,A.nC);}else if(A is JH){var D=new fB(A.ZB,A.GD);mT(D,A.J);C.add(D);}A=QT.YB();}mT(new fB("!","!"),A.J.start.KB(),allowDuplicates:true);mT(new fB("!!","tag:yaml.org,2002:"),A.J.start.KB(),allowDuplicates:true);return new yD(B,C);}void mT(fB A,h B,{bool allowDuplicates: false}){if(TT.containsKey(A.ZB)){if(allowDuplicates)return;throw new V("Duplicate %TAG directive.",B);}TT[A.ZB]=A;}}class N{static const QJ=const N("STREAM_START");static const oG=const N("DOCUMENT_START");static const RJ=const N("DOCUMENT_CONTENT");static const pG=const N("DOCUMENT_END");static const SJ=const N("BLOCK_NODE");static const dN=const N("BLOCK_NODE_OR_INDENTLESS_SEQUENCE");static const eN=const N("FLOW_NODE");static const TJ=const N("BLOCK_SEQUENCE_FIRST_ENTRY");static const qG=const N("BLOCK_SEQUENCE_ENTRY");static const oE=const N("INDENTLESS_SEQUENCE_ENTRY");static const UJ=const N("BLOCK_MAPPING_FIRST_KEY");static const pE=const N("BLOCK_MAPPING_KEY");static const qE=const N("BLOCK_MAPPING_VALUE");static const VJ=const N("FLOW_SEQUENCE_FIRST_ENTRY");static const rG=const N("FLOW_SEQUENCE_ENTRY");static const WJ=const N("FLOW_SEQUENCE_ENTRY_MAPPING_KEY");static const sG=const N("FLOW_SEQUENCE_ENTRY_MAPPING_VALUE");static const tG=const N("FLOW_SEQUENCE_ENTRY_MAPPING_END");static const XJ=const N("FLOW_MAPPING_FIRST_KEY");static const rE=const N("FLOW_MAPPING_KEY");static const uG=const N("FLOW_MAPPING_VALUE");static const YJ=const N("FLOW_MAPPING_EMPTY_VALUE");static const ZJ=const N("END");final String name;const N(this.name);String toString()=>name;}class vG{static const rB=0x9;static const sB=0xA;static const tB=0xD;static const nB=0x20;static const fN=0x24;static const gN=0x28;static const hN=0x29;static const uD=0x2B;static const vD=0x2C;static const sE=0x2D;static const iN=0x2E;static const wG=0x3F;static const tE=0x3A;static const jN=0x3B;static const kN=0x3D;static const uE=0x5B;static const wD=0x5D;static const xG=0x7B;static const vE=0x7D;static const yG=0x23;static const aJ=0x26;static const bJ=0x2A;static const cJ=0x21;static const lN=0x7C;static const mN=0x3C;static const nN=0x3E;static const vC=0x27;static const wE=0x22;static const xE=0x25;static const zG=0x40;static const dJ=0x60;static const oN=0x7E;static const pN=0x0;static const qN=0x7;static const rN=0x8;static const sN=0xB;static const tN=0xC;static const uN=0x1B;static const eJ=0x2F;static const AH=0x5C;static const vN=0x5F;static const yE=0x85;static const wN=0xA0;static const xN=0x2028;static const yN=0x2029;static const BH=0xFEFF;static const GC=0x30;static const zE=0x39;static const AF=0x61;static const zN=0x62;static const AO=0x65;static const fJ=0x66;static const BO=0x6E;static const CO=0x72;static const DO=0x74;static const EO=0x75;static const FO=0x76;static const GO=0x78;static const HO=0x7A;static const CH=0x41;static const gJ=0x46;static const IO=0x4C;static const JO=0x4E;static const KO=0x50;static const LO=0x55;static const MO=0x5A;final PD nT;var oT=false;var pT=false;final qT=new SI<e>();var rT=0;var sT=false;final tT=<int>[-1];var uT=true;final vT=<DH>[null];int get wT=>tT.last;bool get xT=>vT.length==1;bool get yT=>nT.RC||zT;bool get zT=>AU(0);bool get BU=>CU(0);bool get DU=>EU(0);bool get FU{var A=nT.U();if(A==null)return false;switch (A){case sE:case jN:case eJ:case tE:case zG:case aJ:case kN:case uD:case fN:case iN:case oN:case wG:case bJ:case vC:case gN:case hN:case xE:return true;default:return (A>=GC&&A<=zE)||(A>=AF&&A<=HO)||(A>=CH&&A<=MO);}}bool get GU{if(!HU)return false;switch (nT.U()){case vD:case uE:case wD:case xG:case vE:return false;default:return true;}}bool get IU{var A=nT.U();return A!=null&&(A>=GC&&A<=zE);}bool get JU{var A=nT.U();if(A==null)return false;return (A>=GC&&A<=zE)||(A>=AF&&A<=fJ)||(A>=CH&&A<=gJ);}bool get KU=>LU(0);bool get MU{var A=nT.U();if(A==null)return false;switch (A){case sB:case tB:case BH:return false;case rB:case yE:return true;default:return (A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF);}}bool get HU{var A=nT.U();if(A==null)return false;switch (A){case sB:case tB:case BH:case nB:return false;case yE:return true;default:return (A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF);}}bool get NU{return nT.g==0&&CU(3)&&(nT.mC('---')||nT.mC('...'));}vG(String A,{sourceUrl}):nT=new PD.WR(A,sourceUrl:sourceUrl);e q(){if(pT)throw new StateError("Out of tokens.");if(!sT)OU();var A=qT.removeFirst();sT=false;rT++ ;pT=A is e&&A.type==I.xD;return A;}e YB(){q();return JB();}e JB(){if(pT)return null;if(!sT)OU();return qT.first;}void OU(){while(true){if(qT.isNotEmpty){PU();if(!vT.any((A)=>A!=null&&A.AG==rT)){break;}}QU();}sT=true;}void QU(){if(!oT){RU();return;}SU();PU();TU(nT.g);if(nT.RC){UU();return;}if(nT.g==0){if(nT.U()==xE){VU();return;}if(CU(3)){if(nT.mC('---')){WU(I.GF);return;}if(nT.mC('...')){WU(I.HF);return;}}}switch (nT.U()){case uE:XU(I.lJ);return;case xG:XU(I.mJ);return;case wD:YU(I.RD);return;case vE:YU(I.SD);return;case vD:ZU();return;case bJ:aU(anchor:false);return;case aJ:aU(anchor:true);return;case cJ:bU();return;case vC:cU(singleQuote:true);return;case wE:cU(singleQuote:false);return;case lN:if(!xT)dU();eU(literal:true);return;case nN:if(!xT)dU();eU(literal:false);return;case xE:case zG:case dJ:dU();return;case sE:if(LU(1)){fU();}else{gU();}return;case wG:if(LU(1)){fU();}else{hU();}return;case tE:if(!xT&&qT.isNotEmpty){var A=qT.last;if(A.type==I.RD||A.type==I.SD||(A.type==I.nJ&&(A as QD).Q.SQ)){iU();return;}}if(LU(1)){fU();}else{iU();}return;default:if(!MU)dU();fU();return;}throw 'Inaccessible';}void dU()=>nT.error("Unexpected character.",length:1);void PU(){for(var A=0;A<vT.length;A++ ){var B=vT[A];if(B==null)continue;if(!xT)continue;if(B.IB==nT.IB)continue;if(B.vH){throw new V("Expected ':'.",nT.QB);}vT[A]=null;}}void jU(){var A=xT&&wT==nT.g;assert(uT||!A);if(!uT)return;kU();vT[vT.length-1]=new DH(rT+qT.length,nT.IB,nT.g,nT.location,required:A);}void kU(){var A=vT.last;if(A!=null&&A.vH){throw new V("Could not find expected ':' for simple key.",A.location.KB());}vT[vT.length-1]=null;}void lU(){vT.add(null);}void mU(){if(xT)return;vT.removeLast();}void nU(int A,I C,WB D,{int tokenNumber}){if(!xT)return;if(wT!=-1&&wT>=A)return;tT.add(A);var B=new e(C,D.KB());if(tokenNumber==null){qT.add(B);}else{qT.insert(tokenNumber-rT,B);}}void TU(int A){if(!xT)return;while(wT>A){qT.add(new e(I.wC,nT.QB));tT.removeLast();}}void oU()=>TU(-1);void RU(){oT=true;qT.add(new e(I.jJ,nT.QB));}void UU(){oU();kU();uT=false;qT.add(new e(I.xD,nT.QB));}void VU(){oU();kU();uT=false;var A=pU();if(A!=null)qT.add(A);}void WU(I A){oU();kU();uT=false;var B=nT.state;nT.S();nT.S();nT.S();qT.add(new e(A,nT.LB(B)));}void XU(I A){jU();lU();uT=true;qU(A);}void YU(I A){kU();mU();uT=false;qU(A);}void ZU(){kU();uT=true;qU(I.xC);}void gU(){if(xT){if(!uT){throw new V("Block sequence entries are not allowed here.",nT.QB);}nU(nT.g,I.kJ,nT.location);}else{}kU();uT=true;qU(I.TD);}void hU(){if(xT){if(!uT){throw new V("Mapping keys are not allowed here.",nT.QB);}nU(nT.g,I.IF,nT.location);}uT=xT;qU(I.HC);}void iU(){var A=vT.last;if(A!=null){qT.insert(A.AG-rT,new e(I.HC,A.location.KB()));nU(A.g,I.IF,A.location,tokenNumber:A.AG);vT[vT.length-1]=null;uT=false;}else if(xT){if(!uT){throw new V("Mapping values are not allowed here. Did you miss a colon " "earlier?",nT.QB);}nU(nT.g,I.IF,nT.location);uT=true;}else if(uT){uT=false;qU(I.HC);}qU(I.uB);}void qU(I A){var B=nT.state;nT.S();qT.add(new e(A,nT.LB(B)));}void aU({bool anchor: true}){jU();uT=false;qT.add(rU(anchor:anchor));}void bU(){jU();uT=false;qT.add(sU());}void eU({bool literal: false}){kU();uT=true;qT.add(tU(literal:literal));}void cU({bool singleQuote: false}){jU();uT=false;qT.add(uU(singleQuote:singleQuote));}void fU(){jU();uT=false;qT.add(vU());}void SU(){var A=false;while(true){if(nT.g==0)nT.q("\uFEFF");while(nT.U()==nB||((!xT||!A)&&nT.U()==rB)){nT.S();}if(nT.U()==rB){nT.error("Tab characters are not allowed as indentation.",length:1);}wU();if(zT){xU();if(xT)uT=true;A=true;}else{break;}}}e pU(){var A=nT.state;nT.S();var B;var C=yU();if(C=="YAML"){B=zU(A);}else if(C=="TAG"){B=AV(A);}else{oJ("Warning: unknown directive.",nT.LB(A));while(!yT){nT.S();}return null;}BV();wU();if(!yT){throw new V("Expected comment or line break after directive.",nT.LB(A));}xU();return B;}String yU(){var B=nT.position;while(HU){nT.S();}var A=nT.substring(B);if(A.isEmpty){throw new V("Expected directive name.",nT.QB);}else if(!BU){throw new V("Unexpected character in directive name.",nT.QB);}return A;}e zU(dC A){BV();var B=CV();nT.gF('.');var C=CV();return new IH(nT.LB(A),B,C);}int CV(){var B=nT.position;while(IU){nT.S();}var A=nT.substring(B);if(A.isEmpty){throw new V("Expected version number.",nT.QB);}return int.parse(A);}e AV(dC A){BV();var B=DV(directive:true);if(!DU){throw new V("Expected whitespace.",nT.QB);}BV();var C=EV();if(!BU){throw new V("Expected whitespace.",nT.QB);}return new JH(nT.LB(A),B,C);}e rU({bool anchor: true}){var C=nT.state;nT.S();var D=nT.position;while(GU){nT.S();}var B=nT.substring(D);var A=nT.U();if(B.isEmpty||(!BU&&A!=wG&&A!=tE&&A!=vD&&A!=wD&&A!=vE&&A!=xE&&A!=zG&&A!=dJ)){throw new V("Expected alphanumeric character.",nT.QB);}if(anchor){return new CF(nT.LB(C),B);}else{return new KH(nT.LB(C),B);}}e sU(){var A;var B;var C=nT.state;if(nT.U(1)==mN){nT.S();nT.S();A='';B=EV();nT.gF('>');}else{A=DV();if(A.length>1&&A.startsWith('!')&&A.endsWith('!')){B=EV(flowSeparators:false);}else{B=EV(head:A,flowSeparators:false);if(B.isEmpty){A=null;B='!';}else{A='!';}}}return new DF(nT.LB(C),A,B);}String DV({bool directive: false}){nT.gF('!');var A=new StringBuffer('!');var B=nT.position;while(FU){nT.S();}A.write(nT.substring(B));if(nT.U()==cJ){A.writeCharCode(nT.S());}else{if(directive&&A.toString()!='!')nT.gF('!');}return A.toString();}String EV({String head,bool flowSeparators: true}){var B=head==null?0:head.length;var C=new StringBuffer();if(B>1)C.write(head.substring(1));var D=nT.position;var A=nT.U();while(FU||(flowSeparators&&(A==vD||A==uE||A==wD))){nT.S();A=nT.U();}return Uri.decodeFull(nT.substring(D));}e tU({bool literal: false}){var Z=nT.state;nT.S();var O=oB.NO;var D=0;var A=nT.U();if(A==uD||A==sE){O=A==uD?oB.FH:oB.EH;nT.S();if(IU){if(nT.U()==GC){throw new V("0 may not be used as an indentation indicator.",nT.LB(Z));}D=nT.S()-GC;}}else if(IU){if(nT.U()==GC){throw new V("0 may not be used as an indentation indicator.",nT.LB(Z));}D=nT.S()-GC;A=nT.U();if(A==uD||A==sE){O=A==uD?oB.FH:oB.EH;nT.S();}}BV();wU();if(!yT){throw new V("Expected comment or line break.",nT.QB);}xU();var C=0;if(D!=0){C=wT>=0?wT+D:D;}var H=FV(C);C=H.first;var P=H.last;var B=new StringBuffer();var K='';var j=false;var EB=false;var iB=nT.state;while(nT.g==C&&!nT.RC){if(NU)break;EB=DU;if(!literal&&K.isNotEmpty&&!j&&!EB){if(P.isEmpty)B.writeCharCode(nB);}else{B.write(K);}K='';B.write(P);j=DU;var BC=nT.position;while(!yT){nT.S();}B.write(nT.substring(BC));iB=nT.state;if(!nT.RC)K=GV();var H=FV(C);C=H.first;P=H.last;}if(O!=oB.EH)B.write(K);if(O==oB.FH)B.write(P);return new QD(nT.LB(Z,iB),B.toString(),literal?AB.PO:AB.QO);}yD<int,String> FV(int A){var B=0;var C=new StringBuffer();while(true){while((A==0||nT.g<A)&&nT.U()==nB){nT.S();}if(nT.g>B)B=nT.g;if(!zT)break;C.write(GV());}if(A==0){A=B;if(A<wT+1)A=wT+1;}return new yD(A,C.toString());}e uU({bool singleQuote: false}){var EB=nT.state;var A=new StringBuffer();nT.S();while(true){if(NU){nT.error("Unexpected document indicator.");}if(nT.RC){throw new V("Unexpected end of file.",nT.QB);}var D=false;while(!BU){var H=nT.U();if(singleQuote&&H==vC&&nT.U(1)==vC){nT.S();nT.S();A.writeCharCode(vC);}else if(H==(singleQuote?vC:wE)){break;}else if(!singleQuote&&H==AH&&AU(1)){nT.S();xU();D=true;break;}else if(!singleQuote&&H==AH){var O=nT.state;var B=null;switch (nT.U(1)){case GC:A.writeCharCode(pN);break;case AF:A.writeCharCode(qN);break;case zN:A.writeCharCode(rN);break;case DO:case rB:A.writeCharCode(rB);break;case BO:A.writeCharCode(sB);break;case FO:A.writeCharCode(sN);break;case fJ:A.writeCharCode(tN);break;case CO:A.writeCharCode(tB);break;case AO:A.writeCharCode(uN);break;case nB:case wE:case eJ:case AH:A.writeCharCode(nT.U(1));break;case JO:A.writeCharCode(yE);break;case vN:A.writeCharCode(wN);break;case IO:A.writeCharCode(xN);break;case KO:A.writeCharCode(yN);break;case GO:B=2;break;case EO:B=4;break;case LO:B=8;break;default:throw new V("Unknown escape character.",nT.LB(O));}nT.S();nT.S();if(B!=null){var C=0;for(var Z=0;Z<B;Z++ ){if(!JU){nT.S();throw new V("Expected ${B}-digit hexidecimal number.",nT.LB(O));}C=(C<<4)+HV(nT.S());}if((C>=0xD800&&C<=0xDFFF)||C>0x10FFFF){throw new V("Invalid Unicode character escape code.",nT.LB(O));}A.writeCharCode(C);}}else{A.writeCharCode(nT.S());}}if(nT.U()==(singleQuote?vC:wE)){break;}var K=new StringBuffer();var j='';var P=new StringBuffer();while(DU||zT){if(DU){if(!D){K.writeCharCode(nT.S());}else{nT.S();}}else{if(!D){K.clear();j=GV();D=true;}else{P.write(GV());}}}if(D){if(j.isNotEmpty&&P.isEmpty){A.writeCharCode(nB);}else{A.write(P);}}else{A.write(K);K.clear();}}nT.S();return new QD(nT.LB(EB),A.toString(),singleQuote?AB.hJ:AB.iJ);}e vU(){var O=nT.state;var H=nT.state;var B=new StringBuffer();var A='';var C='';var D=new StringBuffer();var K=wT+1;while(true){if(NU)break;if(nT.U()==yG)break;if(KU){if(A.isNotEmpty){if(C.isEmpty){B.writeCharCode(nB);}else{B.write(C);}A='';C='';}else{B.write(D);D.clear();}}var P=nT.position;while(KU){nT.S();}B.write(nT.substring(P));H=nT.state;if(!DU&&!zT)break;while(DU||zT){if(DU){if(A.isNotEmpty&&nT.g<K&&nT.U()==rB){nT.error("Expected a space but found a tab.",length:1);}if(A.isEmpty){D.writeCharCode(nT.S());}else{nT.S();}}else{if(A.isEmpty){A=GV();D.clear();}else{C=GV();}}}if(xT&&nT.g<K)break;}if(A.isNotEmpty)uT=true;return new QD(nT.LB(O,H),B.toString(),AB.BF);}void xU(){var A=nT.U();if(A!=tB&&A!=sB)return;nT.S();if(A==tB&&nT.U()==sB)nT.S();}String GV(){var A=nT.U();if(A!=tB&&A!=sB){throw new V("Expected newline.",nT.QB);}nT.S();if(A==tB&&nT.U()==sB)nT.S();return "\n";}bool EU(int B){var A=nT.U(B);return A==nB||A==rB;}bool AU(int B){var A=nT.U(B);return A==tB||A==sB;}bool CU(int B){var A=nT.U(B);return A==null||A==nB||A==rB||A==tB||A==sB;}bool LU(int A){switch (nT.U(A)){case tE:return IV(A+1);case yG:var B=nT.U(A-1);return B!=nB&&B!=rB;default:return IV(A);}}bool IV(int B){var A=nT.U(B);switch (A){case vD:case uE:case wD:case xG:case vE:return xT;case nB:case rB:case sB:case tB:case BH:return false;case yE:return true;default:return A!=null&&((A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF));}}int HV(int A){if(A<=zE)return A-GC;if(A<=gJ)return 10+A-CH;return 10+A-AF;}void BV(){while(DU){nT.S();}}void wU(){if(nT.U()!=yG)return;while(!yT){nT.S();}}}class DH{final int AG;final WB location;final int IB;final int g;final bool vH;DH(this.AG,this.IB,this.g,this.location,{bool required}):vH=required;}class oB{static const EH=const oB("STRIP");static const NO=const oB("CLIP");static const FH=const oB("KEEP");final String name;const oB(this.name);String toString()=>name;}class AB{static const OO=const AB.LR("ANY");static const BF=const AB.LR("PLAIN");static const PO=const AB.LR("LITERAL");static const QO=const AB.LR("FOLDED");static const hJ=const AB.LR("SINGLE_QUOTED");static const iJ=const AB.LR("DOUBLE_QUOTED");final String name;bool get SQ=>this==hJ||this==iJ;const AB.LR(this.name);String toString()=>name;}class XB{static const GH=const XB.MR("BLOCK");static const HH=const XB.MR("FLOW");final String name;const XB.MR(this.name);String toString()=>name;}class e{final I type;final h J;e(this.type,this.J);String toString()=>type.toString();}class IH implements e{get type=>I.EF;final h J;final int DD;final int nC;IH(this.J,this.DD,this.nC);String toString()=>"VERSION_DIRECTIVE ${DD}.${nC}";}class JH implements e{get type=>I.FF;final h J;final String ZB;final String GD;JH(this.J,this.ZB,this.GD);String toString()=>"TAG_DIRECTIVE ${ZB} ${GD}";}class CF implements e{get type=>I.SO;final h J;final String name;CF(this.J,this.name);String toString()=>"ANCHOR ${name}";}class KH implements e{get type=>I.RO;final h J;final String name;KH(this.J,this.name);String toString()=>"ALIAS ${name}";}class DF implements e{get type=>I.TO;final h J;final String ZB;final String vF;DF(this.J,this.ZB,this.vF);String toString()=>"TAG ${ZB} ${vF}";}class QD implements e{get type=>I.nJ;final h J;final String value;final AB Q;QD(this.J,this.value,this.Q);String toString()=>"SCALAR ${Q} \"${value}\"";}class I{static const jJ=const I.NR("STREAM_START");static const xD=const I.NR("STREAM_END");static const EF=const I.NR("VERSION_DIRECTIVE");static const FF=const I.NR("TAG_DIRECTIVE");static const GF=const I.NR("DOCUMENT_START");static const HF=const I.NR("DOCUMENT_END");static const kJ=const I.NR("BLOCK_SEQUENCE_START");static const IF=const I.NR("BLOCK_MAPPING_START");static const wC=const I.NR("BLOCK_END");static const lJ=const I.NR("FLOW_SEQUENCE_START");static const RD=const I.NR("FLOW_SEQUENCE_END");static const mJ=const I.NR("FLOW_MAPPING_START");static const SD=const I.NR("FLOW_MAPPING_END");static const TD=const I.NR("BLOCK_ENTRY");static const xC=const I.NR("FLOW_ENTRY");static const HC=const I.NR("KEY");static const uB=const I.NR("VALUE");static const RO=const I.NR("ALIAS");static const SO=const I.NR("ANCHOR");static const TO=const I.NR("TAG");static const nJ=const I.NR("SCALAR");final String name;const I.NR(this.name);String toString()=>name;}class yD<R,fO>{final R first;final fO last;yD(this.first,this.last);String toString()=>'(${first}, ${last})';}void oJ(String A,[n B])=>VO(A,B);typedef dynamic UO(String _0,[n _1]);UO VO=(A,[B]){if(B!=null)A=B.message(A);print(A);};String ZO(B){var A=new StringBuffer();aO(B,A);return A.toString();}void aO(A,StringSink B){LH(A,0,B,true);}void LH(A,int C,StringSink B,bool D){if(A is Map){cO(A,C,B,D);}else if(A is Iterable){eO(A,C,B,D);}else if(A is String){B..writeln('"${bO(A)}"');}else if(A is double){B.writeln("!!float ${A}");}else{B.writeln(A);}}String bO(String A)=>A.replaceAll('"',r'\"').replaceAll("\n",r"\n");void cO(Map C,int B,StringSink A,bool H){if(!H){A.writeln();B+= 2;}final K=dO(C);K.forEach((D){final O=C[D];sJ(B,A);A..write(D)..write(': ');LH(O,B,A,false);});}Iterable<String> dO(Map K){final B=[] ;final C=[] ;final D=[] ;K.forEach((A,H){if(H is String){B.add(A);}else if(H is Map){C.add(A);}else{D.add(A);}});return NN([B..sort(),C..sort(),D..sort()]);}void eO(Iterable C,int B,StringSink A,bool D){if(!D){A.writeln();B+= 2;}C.forEach((H){sJ(B,A);A.write('- ');LH(H,B,A,false);});}void sJ(int A,StringSink B)=>B.write(' '*A);class UD{final o iH;final n J;final zD versionDirective;final List<fB> xF;final bool startImplicit;final bool endImplicit;UD.OR(this.iH,this.J,this.versionDirective,List<fB> A,{this.startImplicit: false,this.endImplicit: false}):xF=new UnmodifiableListView(A);String toString()=>iH.toString();}class zD{final int DD;final int nC;zD(this.DD,this.nC);String toString()=>"%YAML ${DD}.${nC}";}class fB{final String ZB;final String GD;fB(this.ZB,this.GD);String toString()=>"%TAG ${ZB} ${GD}";}abstract class o{n get J=>JV;n JV;get value;}class pJ extends o with MapMixin,bM{final Map<dynamic,o> ED;final XB Q;Map get value=>this;Iterable get keys=>ED.keys.map((A)=>A.value);pJ.PR(Map<dynamic,o> A,n B,this.Q):ED=new UnmodifiableMapView<dynamic,o>(A){JV=B;}operator[](B){var A=ED[B];return A==null?null:A.value;}}class qJ extends o with ListMixin{final List<o> ED;final XB Q;List get value=>this;int get length=>ED.length;set length(int A){throw new UnsupportedError("Cannot modify an unmodifiable List");}qJ.QR(List<o> A,n B,this.Q):ED=new UnmodifiableListView<o>(A){JV=B;}operator[](int A)=>ED[A].value;operator[]=(int A,B){throw new UnsupportedError("Cannot modify an unmodifiable List");}}class t extends o{final value;final AB Q;t.RR(this.value,eB A):Q=A.Q{JV=A.J;}t.SR(this.value,n A):Q=AB.OO{JV=A;}String toString()=>value.toString();}void rJ(o A,n B){A.JV=B;}