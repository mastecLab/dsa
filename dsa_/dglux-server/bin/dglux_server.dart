import "dart:async";import "dart:io";import "dart:io" as lh;import "dart:typed_data";import "dart:convert";import "dart:math";import "dart:math" as LJ;import "dart:isolate";import "dart:collection";import "dart:mirrors";class g3{var KYB;var LYB;var MYB;var NYB=0;var OYB=0;List<String> PYB;Map<String,int> QYB;g3(){PYB=new List<String>(256);QYB=new Map<String,int>();for(var A=0;A<256;A++ ){var B=new List<int>();B.add(A);PYB[A]=Mi.encode(B);QYB[PYB[A]]=A;}KYB=h3.i3();LYB=[KYB[0]|0x01,KYB[1],KYB[2],KYB[3],KYB[4],KYB[5]];MYB=(KYB[6]<<8|KYB[7])&0x3ffff;}List<int> YD(String B,{List<int> buffer,int offset: 0}){var C=offset,A=0;buffer=(buffer!=null)?buffer:new List<int>(16);final RegExp G=new RegExp('[0-9a-f]{2}');for(Match D in G.allMatches(B.toLowerCase())){if(A<16){var H=B.toLowerCase().substring(D.start,D.end);buffer[C+A++ ]=QYB[H];}}while(A<16){buffer[C+A++ ]=0;}return buffer;}String xUB(List A,{int offset: 0}){var B=offset;return '${PYB[A[B++ ]]}${PYB[A[B++ ]]}' '${PYB[A[B++ ]]}${PYB[A[B++ ]]}-' '${PYB[A[B++ ]]}${PYB[A[B++ ]]}-' '${PYB[A[B++ ]]}${PYB[A[B++ ]]}-' '${PYB[A[B++ ]]}${PYB[A[B++ ]]}-' '${PYB[A[B++ ]]}${PYB[A[B++ ]]}' '${PYB[A[B++ ]]}${PYB[A[B++ ]]}' '${PYB[A[B++ ]]}${PYB[A[B++ ]]}';}LVB({Map<String,dynamic> options: null,List buffer: null,int offset: 0}){var C=offset;options=(options!=null)?options:new Map<String,dynamic>();var D=(options['positionalArgs']!=null)?options['positionalArgs']:[] ;var G=(options['namedArgs']!=null)?options['namedArgs'] as Map<Symbol,dynamic>:const<Symbol,dynamic>{};var H=(options['rng']!=null)?Function.apply(options['rng'],D,G):h3.i3();var A=(options['random']!=null)?options['random']:H;A[6]=(A[6]&0x0f)|0x40;A[8]=(A[8]&0x3f)|0x80;if(buffer!=null){for(var B=0;B<16;B++ ){buffer[C+B]=A[B];}}return (buffer!=null)?buffer:xUB(A);}}class h3{static List<int> i3({int seed: null}){var B,C=new List<int>(16);var D=(seed==null)?new Random():new Random(seed);for(var A=0;A<16;A++ ){if((A&0x03)==0){B=(D.nextDouble()*0x100000000).floor().toInt();}C[A]=B>>((A&0x03)<<3)&0xff;}return C;}}Uint8List T$(List<int> A){if(A is Uint8List){if(A.offsetInBytes==0){return A;}else{return A.toList();}}return new Uint8List.fromList(A);}class WM extends IterableBase<qD>{List<qD> MG=[] ;String wK;void LY(qD A){MG.add(A);}int get length=>MG.length;qD operator[](int A)=>MG[A];qD F8(String B){for(qD A in MG){if(A.name==B){return A;}}return null;}int c9(){return MG.length;}qD get first=>MG.first;qD get last=>MG.last;bool get isEmpty=>MG.isEmpty;bool get isNotEmpty=>MG.isNotEmpty;Iterator<qD> get iterator=>MG.iterator;}class qD{static const int ph=0;static const int jt=8;String name;int size;int mode;int zXB=0;int j8=0;int VSB;bool JSB=true;int yI;String wK;bool Qf=true;qD(this.name,this.size,A,[this.RYB=ph]){if(A is List<int>){SYB=A;TYB=new xC(SYB);}else if(A is xC){TYB=new xC.bVB(A);}}List<int> get JG{if(SYB==null){fY();}return SYB;}void fY(){if(SYB==null){if(RYB==jt){var A=TYB.QV();SYB=U$.decode(A);}else{SYB=TYB.QV();}RYB=ph;}}bool get DS=>RYB!=ph;int get FQB=>RYB;xC get uTB=>TYB;String toString()=>name;int RYB;xC TYB;List<int> SYB;static final ZLibCodec U$=new ZLibCodec(raw:true);}class MJ implements Exception{final String message;MJ(this.message);String toString()=>"ArchiveException: ${message}";}const int ft=0;const int YV=1;int Oa(List<int> B,[int A=0]){int D=B.length;A=A^0xffffffff;int C=0;while(D>=8){A=XM[(A^B[C++ ])&0xff]^(A>>8);A=XM[(A^B[C++ ])&0xff]^(A>>8);A=XM[(A^B[C++ ])&0xff]^(A>>8);A=XM[(A^B[C++ ])&0xff]^(A>>8);A=XM[(A^B[C++ ])&0xff]^(A>>8);A=XM[(A^B[C++ ])&0xff]^(A>>8);A=XM[(A^B[C++ ])&0xff]^(A>>8);A=XM[(A^B[C++ ])&0xff]^(A>>8);D-= 8;}if(D>0)do{A=XM[(A^B[C++ ])&0xff]^(A>>8);}while( --D>0);return A^0xffffffff;}const List<int> XM=const[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];class xC{List<int> UYB;List<int> get buffer=>UYB;int offset;int VYB;int get start=>VYB;int WYB;int get byteOrder=>WYB;xC(A,{int byteOrder,int start,int length}){if(byteOrder==null){byteOrder=ft;}WYB=byteOrder;if(start==null){if(A is TypedData){VYB=A.offsetInBytes;}else{VYB=0;}}else{VYB=start;}if(length!=null){XYB=length;}else{if(A is TypedData){XYB=A.lengthInBytes;}else if(A is List<int>){XYB=A.length;}else{throw "Invalid data input.";}}if(A is TypedData){UYB=A.buffer.asUint8List();}else if(A is List<int>){UYB=A;}else{throw "Invalid data input.";}offset=VYB;}xC.bVB(xC A){this.UYB=A.buffer;this.offset=A.offset;this.VYB=A.VYB;this.XYB=A.XYB;this.WYB=A.byteOrder;}int get position=>offset-start;int get length=>XYB-(offset-start);bool get wY=>offset>=(start+XYB);void reset(){offset=start;}int operator[](int A)=>buffer[offset+A];xC WS([int A,int B]){if(A==null){A=this.offset;}else{A+= start;}if(B==null||B<0){B=XYB-(A-start);}return new xC(buffer,byteOrder:byteOrder,start:A,length:B);}int indexOf(int B,[int C=0]){for(int A=this.offset+C,D=this.offset+length;A<D; ++A){if(buffer[A]==B){return A-this.start;}}return -1;}void skip(int A){offset+= A;}int readByte(){return buffer[offset++ ];}xC KV(int B){xC A=WS(this.offset-start,B);offset+= A.length;return A;}String gg([int A]){if(A==null){List<int> B=[] ;while(!wY){int C=readByte();if(C==0){return new String.fromCharCodes(B);}B.add(C);}throw new MJ('EOF reached without finding string terminator');}xC D=KV(A);Uint8List G=D.QV();String H=new String.fromCharCodes(G);return H;}int nD(){int A=buffer[offset++ ]&0xff;int B=buffer[offset++ ]&0xff;if(byteOrder==YV){return (A<<8)|B;}return (B<<8)|A;}int HE(){int A=buffer[offset++ ]&0xff;int B=buffer[offset++ ]&0xff;int C=buffer[offset++ ]&0xff;int D=buffer[offset++ ]&0xff;if(byteOrder==YV){return (A<<24)|(B<<16)|(C<<8)|D;}return (D<<24)|(C<<16)|(B<<8)|A;}int IO(){int A=buffer[offset++ ]&0xff;int B=buffer[offset++ ]&0xff;int C=buffer[offset++ ]&0xff;int D=buffer[offset++ ]&0xff;int G=buffer[offset++ ]&0xff;int H=buffer[offset++ ]&0xff;int I=buffer[offset++ ]&0xff;int J=buffer[offset++ ]&0xff;if(byteOrder==YV){return (A<<56)|(B<<48)|(C<<40)|(D<<32)|(G<<24)|(H<<16)|(I<<8)|J;}return (J<<56)|(I<<48)|(H<<40)|(G<<32)|(D<<24)|(C<<16)|(B<<8)|A;}Uint8List QV(){int A=length;if(buffer is Uint8List){Uint8List B=buffer;Uint8List C=new Uint8List.view(B.buffer,offset,A);return C;}return new Uint8List.fromList(buffer.sublist(offset,offset+A));}int XYB;}class MQ{int length;final int byteOrder;MQ({int size: Pa,this.byteOrder: ft}):UYB=new Uint8List(size==null?Pa:size),length=0;List<int> qf(){return new Uint8List.view(UYB.buffer,0,length);}void clear(){UYB=new Uint8List(Pa);length=0;}void reset(){XYB=0;}void writeByte(int A){if(length==UYB.length){YYB();}UYB[length++ ]=A&0xff;}void QO(List<int> B,[int A]){if(A==null){A=B.length;}while(length+A>UYB.length){YYB((length+A)-UYB.length);}UYB.setRange(length,length+A,B);length+= A;}void M$(xC A){while(length+A.length>UYB.length){YYB((length+A.length)-UYB.length);}UYB.setRange(length,length+A.length,A.buffer,A.offset);length+= A.length;}void KD(int A){if(byteOrder==YV){writeByte((A>>8)&0xff);writeByte((A)&0xff);return;}writeByte((A)&0xff);writeByte((A>>8)&0xff);}void GF(int A){if(byteOrder==YV){writeByte((A>>24)&0xff);writeByte((A>>16)&0xff);writeByte((A>>8)&0xff);writeByte((A)&0xff);return;}writeByte((A)&0xff);writeByte((A>>8)&0xff);writeByte((A>>16)&0xff);writeByte((A>>24)&0xff);}List<int> WS(int B,[int A]){if(B<0){B=(length)+B;}if(A==null){A=length;}else if(A<0){A=length+A;}return new Uint8List.view(UYB.buffer,B,A-B);}void YYB([int A]){int B=Pa;if(A!=null){if(A>B){B=A;}}Uint8List C=new Uint8List(UYB.length+B);C.setRange(0,UYB.length,UYB);UYB=C;}static const int Pa=0x8000;Uint8List UYB;}class Na{static const int it=0x06054b50;static const int Q$=0x07064b50;static const int kt=20;static const int S$=0x06064b50;int pq=-1;int d9=0;int q7=0;int q_=0;int p_=0;int Hq;int Gq;String UVB='';List<NQ> D8=[] ;Na.aVB(xC A){pq=ZYB(A);A.offset=pq;int G=A.HE();d9=A.nD();q7=A.nD();q_=A.nD();p_=A.nD();Hq=A.HE();Gq=A.HE();int C=A.nD();if(C>0){UVB=A.gg(C);}aYB(A);xC B=A.WS(Gq,Hq);while(!B.wY){int D=B.HE();if(D!=NQ.gt){break;}D8.add(new NQ(B,A));}}void aYB(xC A){int C=A.offset;int G=pq-kt;xC B=A.WS(G,kt);int D=B.HE();if(D!=Q$){A.offset=C;return;}int Q=B.HE();int H=B.IO();int S=B.HE();A.offset=H;D=A.HE();if(D!=S$){A.offset=C;return;}int V=A.IO();int b=A.nD();int h=A.nD();int I=A.HE();int J=A.HE();int K=A.IO();int M=A.IO();int N=A.IO();int O=A.IO();d9=I;q7=J;q_=K;p_=M;Hq=N;Gq=O;A.offset=C;}int ZYB(xC A){int C=A.offset;int D=A.length;for(int B=D-4;B>0; --B){A.offset=B;int G=A.HE();if(G==it){A.offset=C;return B;}}throw new MJ('Could not find End of Central Directory Record');}}class VM{static const int mh=0;static const int nh=8;static const int qh=0x04034b50;int vg=qh;int version=0;int lY=0;int eU=0;int USB=0;int TSB=0;int yI;int dU;int bS;String yK='';List<int> oq=[] ;NQ uf;VM([xC A,this.uf]){if(A!=null){vg=A.HE();if(vg!=qh){throw new MJ('Invalid Zip Signature');}version=A.nD();lY=A.nD();eU=A.nD();USB=A.nD();TSB=A.nD();yI=A.HE();dU=A.HE();bS=A.HE();int C=A.nD();int D=A.nD();yK=A.gg(C);oq=A.KV(D).QV();TYB=A.KV(uf.dU);if(lY&0x08!=0){int B=A.HE();if(B==0x08074b50){yI=A.HE();}else{yI=B;}dU=A.HE();bS=A.HE();}}}List<int> get JG{if(SYB==null){if(eU==nh){SYB=new et.ZVB(TYB,bS).qf();eU=mh;}else{SYB=TYB.QV();}}return SYB;}String toString()=>yK;xC TYB;List<int> SYB;int bYB;}class NQ{static const int gt=0x02014b50;int PVB=0;int QVB=0;int SRB=0;int eU=0;int XSB=0;int WSB=0;int yI;int dU;int bS;int p7;int ESB;int oQB;int dr;String yK='';List<int> oq=[] ;String pQB='';VM file;NQ([xC A,xC D]){if(A!=null){PVB=A.nD();QVB=A.nD();SRB=A.nD();eU=A.nD();XSB=A.nD();WSB=A.nD();yI=A.HE();dU=A.HE();bS=A.HE();int G=A.nD();int H=A.nD();int I=A.nD();p7=A.nD();ESB=A.nD();oQB=A.HE();dr=A.HE();if(G>0){yK=A.gg(G);}if(H>0){xC B=A.KV(H);oq=B.QV();int J=B.nD();int C=B.nD();if(J==1){if(C>=8){bS=B.IO();}if(C>=16){dU=B.IO();}if(C>=24){dr=B.IO();}if(C>=28){p7=B.HE();}}}if(I>0){pQB=A.gg(I);}if(D!=null){D.offset=dr;file=new VM(D,this);}}}String toString()=>yK;}class ht{Na wR;WM j7(List<int> A,{bool verify: false}){return SQB(new xC(T$(A)),verify:verify);}WM SQB(xC D,{bool verify: false}){wR=new Na.aVB(D);WM B=new WM();for(NQ G in wR.D8){VM A=G.file;if(verify){int H=Oa(A.JG);if(H!=A.yI){throw new MJ('Invalid CRC for file in archive.');}}var I=A.SYB!=null?A.SYB:A.TYB;qD C=new qD(A.yK,A.bS,I,A.eU);C.yI=A.yI;B.LY(C);}return B;}}class oh{List<int> encode(WM H,{int level: P$.R$}){DateTime C=new DateTime.now();int N=((C.minute&0x7)<<5)|(C.second~/2);int O=(C.hour<<3)|(C.minute>>3);int Q=((O&0xff)<<8)|(N&0xff);int S=((C.month&0x7)<<5)|C.day;int V=(((C.year-1980)&0x7f)<<1)|(C.month>>3);int b=((V&0xff)<<8)|(S&0xff);int J=0;int K=0;int M=0;Map<qD,Map> B={};for(qD A in H.MG){B[A]={};B[A]['time']=Q;B[A]['date']=b;xC D;int G;if(!A.Qf){if(A.DS){A.fY();}D=new xC(A.JG);if(A.yI!=null){G=A.yI;}else{G=Oa(A.JG);}}else if(!A.Qf||A.FQB==qD.jt){D=A.uTB;if(A.yI!=null){G=A.yI;}else{G=Oa(A.JG);}}else{G=Oa(A.JG);List<int> h=new ZLibCodec(level:level==null?ZLibOption.DEFAULT_LEVEL:level,raw:true).encode(A.JG);D=new xC(h);}J+= 30+A.name.length+D.length;K+= 46+A.name.length+(A.wK!=null?A.wK.length:0);B[A]['crc']=G;B[A]['size']=D.length;B[A]['data']=D;}M=46+(H.wK!=null?H.wK.length:0);int r=J+K+M;MQ I=new MQ(size:r);for(qD A in H.MG){B[A]['pos']=I.length;cYB(A,B,I);}dYB(H,B,I);return I.qf();}void cYB(qD B,Map C,MQ A){A.GF(VM.qh);int H=lt;int I=0;int J=B.Qf?VM.nh:VM.mh;int K=C[B]['time'];int M=C[B]['date'];int N=C[B]['crc'];int O=C[B]['size'];int Q=B.size;String D=B.name;List<int> G=[] ;xC S=C[B]['data'];A.KD(H);A.KD(I);A.KD(J);A.KD(K);A.KD(M);A.GF(N);A.GF(O);A.GF(Q);A.KD(D.length);A.KD(G.length);A.QO(D.codeUnits);A.QO(G);A.M$(S);}void dYB(WM C,Map D,MQ A){int G=A.length;int H=lt;int N=V$;for(qD B in C.MG){int O=(N<<8)|H;int Q=H;int S=0;int V=B.Qf?VM.nh:VM.mh;int b=D[B]['time'];int h=D[B]['date'];int r=D[B]['crc'];int EB=D[B]['size'];int IB=B.size;int LB=0;int UB=0;int aB=0;int qB=D[B]['pos'];String I=B.name;List<int> J=[] ;String K=(B.wK==null?'':B.wK);A.GF(NQ.gt);A.KD(O);A.KD(Q);A.KD(S);A.KD(V);A.KD(b);A.KD(h);A.GF(r);A.GF(EB);A.GF(IB);A.KD(I.length);A.KD(J.length);A.KD(K.length);A.KD(LB);A.KD(UB);A.GF(aB);A.GF(qB);A.QO(I.codeUnits);A.QO(J);A.QO(K.codeUnits);}int CC=0;int FC=0;int fC=C.c9();int rC=C.c9();int ED=A.length-G;int cD=G;String M=(C.wK==null?'':C.wK);A.GF(Na.it);A.KD(CC);A.KD(FC);A.KD(fC);A.KD(rC);A.GF(ED);A.GF(cD);A.KD(M.length);A.QO(M.codeUnits);}static const int lt=20;static const int V$=0;}class P${static const int R$=1;}class WI{Uint32List XS;int LZ=0;int T9=0x7fffffff;WI(List<int> B){int I=B.length;for(int A=0;A<I; ++A){if(B[A]>LZ){LZ=B[A];}if(B[A]<T9){T9=B[A];}}int J=1<<LZ;XS=new Uint32List(J);for(int D=1,G=0,K=2;D<=LZ;){for(int A=0;A<I; ++A){if(B[A]==D){int H=0;int M=G;for(int C=0;C<D; ++C){H=(H<<1)|(M&1);M>>= 1;}for(int C=H;C<J;C+= K){XS[C]=(D<<16)|A;} ++G;}} ++D;G<<= 1;K<<= 1;}}}class et{xC input;final MQ XE;et.ZVB(xC A,[int B]):input=A,XE=new MQ(size:B){eYB();}List<int> qf(){return XE.qf();}void eYB(){fYB=0;gYB=0;while(hYB());}bool hYB(){if(input.wY){return false;}int A=iYB(3);bool C=(A&0x1)!=0;int B=A>>1;switch (B){case W$:jYB();break;case X$:kYB();break;case Y$:lYB();break;default:throw new MJ('unknown BTYPE: ${B}');}return !C;}int iYB(int A){if(A==0){return 0;}while(gYB<A){if(input.wY){throw new MJ('input buffer is broken');}int B=input.readByte();fYB|= B<<gYB;gYB+= 8;}int B=fYB&((1<<A)-1);fYB>>= A;gYB-= A;return B;}int mYB(WI A){List<int> G=A.XS;int B=A.LZ;while(gYB<B){if(input.wY){break;}int H=input.readByte();fYB|= H<<gYB;gYB+= 8;}int C=G[fYB&((1<<B)-1)];int D=C>>16;fYB>>= D;gYB-= D;return C&0xffff;}void jYB(){fYB=0;gYB=0;int A=iYB(16);int B=iYB(16);if(A==~B){throw new MJ('Invalid uncompressed block header');}if(A>input.length){throw new MJ('Input buffer is broken');}XE.M$(input.KV(A));}void kYB(){nYB(oYB,pYB);}void lYB(){int B=iYB(5)+257;int C=iYB(5)+1;int H=iYB(4)+4;Uint8List D=new Uint8List(mt.length);for(int A=0;A<H; ++A){D[mt[A]]=iYB(3);}WI G=new WI(D);Uint8List I=new Uint8List(B);Uint8List J=new Uint8List(C);List<int> K=qYB(B,G,I);List<int> M=qYB(C,G,J);nYB(new WI(K),new WI(M));}void nYB(WI H,WI I){while(true){int A=mYB(H);if(A<0||A>285){throw new MJ('Invalid Huffman Code ${A}');}if(A==256){break;}if(A<256){XE.writeByte(A&0xff);continue;}int G=A-257;int C=b$[G]+iYB(c$[G]);int D=mYB(I);if(D>=0&&D<=29){int B=d$[D]+iYB(e$[D]);while(C>B){XE.QO(XE.WS(-B));C-= B;}if(C==B){XE.QO(XE.WS(-B));}else{XE.QO(XE.WS(-B,C-B));}}else{throw new MJ('Illegal unused distance symbol');}}while(gYB>=8){gYB-= 8;input.offset-- ;}}List<int> qYB(int H,WI I,List<int> B){int G=0;int C=0;while(C<H){int A=mYB(I);switch (A){case 16:int D=3+iYB(2);while(D-- >0){B[C++ ]=G;}break;case 17:int D=3+iYB(3);while(D-- >0){B[C++ ]=0;}G=0;break;case 18:int D=11+iYB(7);while(D-- >0){B[C++ ]=0;}G=0;break;default:if(A<0||A>15){throw new MJ('Invalid Huffman Code: ${A}');}B[C++ ]=A;G=A;break;}}return B;}int fYB=0;int gYB=0;int rYB=0;static const int W$=0;static const int X$=1;static const int Y$=2;static const List<int> Z$=const[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8];final WI oYB=new WI(Z$);static const List<int> a$=const[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];final WI pYB=new WI(a$);static const List<int> mt=const[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];static const List<int> b$=const[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];static const List<int> c$=const[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];static const List<int> d$=const[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];static const List<int> e$=const[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];}class DH{final Map<String,sF> sYB;final Map<String,DH> tYB;final Map<String,sF> lB;final Map<String,DH> bY;final uYB=[] ;final bool L7;factory DH({bool allowTrailingOptions: false})=>new DH.cVB(<String,sF>{},<String,DH>{},allowTrailingOptions:allowTrailingOptions);DH.cVB(Map<String,sF> A,Map<String,DH> B,{bool allowTrailingOptions: false}):this.sYB=A,this.lB=new UnmodifiableMapView(A),this.tYB=B,this.bY=new UnmodifiableMapView(B),this.L7=allowTrailingOptions!=null?allowTrailingOptions:false;void np(String A,{String abbr,String help,bool defaultsTo: false,bool negatable: true,void callback(bool value),bool hide: false}){vYB(A,abbr,help,null,null,null,defaultsTo,callback,fH.ot,negatable:negatable,hide:hide);}void tI(String A,{String abbr,String help,String valueHelp,List<String> allowed,Map<String,String> allowedHelp,String defaultsTo,void callback(value),bool allowMultiple: false,bool splitCommas,bool hide: false}){if(!allowMultiple&&splitCommas!=null){throw new ArgumentError('splitCommas may not be set if allowMultiple is false.');}vYB(A,abbr,help,valueHelp,allowed,allowedHelp,defaultsTo,callback,allowMultiple?fH.rh:fH.h$,splitCommas:splitCommas,hide:hide);}void vYB(String A,String B,String G,String H,List<String> I,Map<String,String> J,K,void M(value),fH N,{bool negatable: false,bool splitCommas,bool hide: false}){if(sYB.containsKey(A)){throw new ArgumentError('Duplicate option "${A}".');}if(B!=null){var C=kf(B);if(C!=null){throw new ArgumentError('Abbreviation "${B}" is already used by "${C.name}".');}}var D=g$(A,B,G,H,I,J,K,M,N,negatable:negatable,splitCommas:splitCommas,hide:hide);sYB[A]=D;uYB.add(D);}LL YD(List<String> A)=>new ZV(null,this,A.toList()).YD();String get H$=>new pt(uYB).N8();sF kf(String A){return lB.values.firstWhere((B)=>B.XP==A,orElse:()=>null);}}class Qa extends FormatException{final List<String> bY;Qa(String B,[Iterable<String> A]):bY=A==null?const[] :new List.unmodifiable(A),super(B);}LL f$(DH A,Map<String,dynamic> B,String C,LL D,List<String> G,List<String> H){return new LL.dVB(A,B,C,D,G,H);}class LL{final DH wYB;final Map<String,dynamic> xYB;final String name;final LL command;final List<String> yJ;final List<String> arguments;LL.dVB(this.wYB,this.xYB,this.name,this.command,List<String> A,List<String> B):this.yJ=new UnmodifiableListView(A),this.arguments=new UnmodifiableListView(B);operator[](String A){if(!wYB.lB.containsKey(A)){throw new ArgumentError('Could not find an option named "${A}".');}return wYB.lB[A].c8(xYB[A]);}Iterable<String> get lB{var A=new Set<String>.from(xYB.keys);wYB.lB.forEach((B,C){if(C.defaultValue!=null)A.add(B);});return A;}}class ut extends yC{List<int> bF;int y_;ut.mVB(Uint8List A):super.qVB(A){y_=A[0];bF=fS().sublist(1);}Uint8List yYB(){var A=[y_];A.addAll(bF);zYB=A.length;AZB();BZB(A);return CZB;}String toString()=>"BitString(${bF})";}class Ra extends yC{bool DZB;Ra(this.DZB,{tag: tt}):super(tag:tag){zYB=1;}Ra.kVB(Uint8List A):super.qVB(A){var B=A[EZB];DZB=(B==Cu);}Uint8List yYB(){super.AZB();super.BZB([DZB==true?Cu:s$]);return CZB;}}const int tt=0x01;const int vt=0x02;const int o$=0x03;const int wt=0x04;const int xt=0x05;const int yt=0x0A;const int p$=0x13;const int q$=0x17;const int Sa=0x30;const int Bu=0x31;const int r$=0x06;const int Cu=0xff;const int s$=0x00;class sh extends gH{sh(int A,{tag: yt}):super(A,tag:tag);}class bV{String message;bV(this.message);}class gH extends yC{var tG;gH(this.tG,{tag: vt}):super(tag:tag);gH.iVB(Uint8List A):super.qVB(A){tG=w$(this.fS());}Uint8List yYB(){var A=u$(this.tG);zYB=A.length;super.AZB();BZB(A);return CZB;}static Uint8List u$(var A){var B;if(A is n){B=new Uint8List.fromList(A.IQ());}else{var C=new n(A);B=new Uint8List.fromList(C.IQ());}return B;}static dynamic w$(Uint8List A,{int offset: 0}){if(A.length-offset>8){return new n(A.sublist(offset));}else{return new n(A.sublist(offset)).tG();}}String toString()=>"ASNInteger(${tG})";}class nS{int FZB;int get length=>FZB;int EZB;int get NVB=>EZB;nS(this.FZB,this.EZB);static Uint8List t$(int C){Uint8List A;if(C<=127){A=new Uint8List(1);A[0]=C;}else{var G=new Uint32List(1);G[0]=C;var H=new Uint8List.view(G.buffer);int B=3;while(H[B]==0) --B;A=new Uint8List(B+2);A[0]=0x80+B+1;for(int D=1;D<A.length; ++D)A[D]=H[B-- ];}return A;}static nS v$(Uint8List B){int C=2;int A=(B[1]&0x7F);if(A!=B[1]){int G=A;A=0;for(int D=0;D<G;D++ ){A<<= 8;A|= (B[C++ ]&0xFF);}}return new nS(A,C);}}class rt extends yC{static final m$=new Uint8List.fromList([xt,0x00]);Uint8List get uJ=>m$;rt.hVB(Uint8List A):super.qVB(A);}class yC{final int GZB;int get tag=>GZB;Uint8List CZB;Uint8List get uJ{if(CZB==null)yYB();return CZB;}yC({int tag: 0}):GZB=tag;yC.qVB(A):GZB=A[0]{CZB=A;HZB();}void HZB(){nS A=nS.v$(CZB);zYB=A.length;EZB=A.NVB;}int get r_=>EZB+zYB;int zYB;int EZB=2;Uint8List AZB(){if(CZB==null){Uint8List A=nS.t$(zYB);CZB=new Uint8List(1+A.length+zYB);CZB[0]=tag;CZB.setRange(1,1+A.length,A,0);EZB=1+A.length;}return CZB;}Uint8List yYB()=>AZB();Uint8List fS(){return new Uint8List.view(CZB.buffer,EZB+CZB.offsetInBytes,zYB);}void BZB(List<int> A){this.uJ.setRange(EZB,EZB+A.length,A);}lUB()=>l$.n$(uJ);String toString()=>"ASN1Object(tag=${tag.toRadixString(16)} valueByteLength=${zYB}) startpos=${EZB} bytes=${lUB()}";}class st extends yC{List<int> e9;st.gVB(Uint8List A):super.qVB(A);Uint8List yYB(){zYB=e9.length;super.AZB();BZB(e9);return CZB;}}class FD extends yC{Uint8List MS;FD(dynamic A,{int tag: wt}):super(tag:tag){if(A is String)this.MS=new Uint8List.fromList(A.codeUnits);else if(A is Uint8List)this.MS=A;else if(A is List<int>)this.MS=new Uint8List.fromList(A);else throw new ArgumentError("Parameters octets should be either of type String or List<int>.");}FD.pVB(Uint8List A):super.qVB(A){MS=fS();}String get bF=>new String.fromCharCodes(MS);Uint8List yYB(){zYB=MS.length;AZB();BZB(MS);return CZB;}String toString()=>"OctetString(${bF})";}class th{Uint8List IZB;th(this.IZB);int JZB=0;bool hasNext(){return JZB<IZB.length;}yC b9(){int A=IZB[JZB];bool D=(0xC0&A)==0;bool G=(0x40&A)!=0;int H=IZB.length-JZB;var C=new Uint8List.view(IZB.buffer,JZB+IZB.offsetInBytes,H);yC B=null;if(D)B=KZB(A,C);else if(G){if((A&Sa)!=0)B=new ZC.lVB(C);else throw new bV("Parser for tag ${A} not implemented yet");}else{B=new yC.qVB(C);}JZB=JZB+B.r_;return B;}yC KZB(int B,Uint8List A){switch (B){case Sa:return new ZC.lVB(A);case wt:return new FD.pVB(A);case vt:case yt:return new gH.iVB(A);case Bu:return new mS.jVB(A);case tt:return new Ra.kVB(A);case r$:return new st.gVB(A);case o$:return new ut.mVB(A);case xt:return new rt.hVB(A);case p$:return new zt.nVB(A);case q$:return new Au.oVB(A);default:throw new bV("Parser for tag ${B} not implemented yet");}}}class zt extends yC{String bF;zt.nVB(Uint8List A):super.qVB(A){var B=fS();bF=xp.decode(B);}Uint8List yYB(){var A=xp.encode(bF);zYB=A.length;AZB();BZB(A);return CZB;}String toString()=>"PrintableString(${bF})";}class ZC extends yC{List<yC> zB=new List();ZC.lVB(Uint8List A):super.qVB(A){if((tag&0x30)==0)throw new bV("The tag ${tag} does not look like a sequence type");LZB();}ZC({int tag: Sa}):super(tag:tag);add(yC A){zB.add(A);}Uint8List yYB(){zYB=MZB();super.AZB();var A=EZB;zB.forEach((C){var B=C.uJ;uJ.setRange(A,A+B.length,B);A+= B.length;});return CZB;}int MZB(){int A=0;zB.forEach((B){A+= B.yYB().length;});return A;}LZB(){var A=new th(fS());while(A.hasNext()){zB.add(A.b9());}}String toString(){var A=new StringBuffer("Seq[");zB.forEach((B){A.write(B.toString());A.write(" ");});A.write("]");return A.toString();}}class mS extends yC{Set<yC> zB=new Set<yC>();mS.jVB(Uint8List A):super.qVB(A){if((tag&0x30)==0)throw new bV("The tag ${tag} does not look like a set type");NZB();}mS({int tag: Bu}):super(tag:tag);add(yC A){zB.add(A);}Uint8List yYB(){zYB=MZB();super.AZB();var A=EZB;zB.forEach((C){var B=C.uJ;uJ.setRange(A,A+B.length,B);A+= B.length;});return CZB;}int MZB(){int A=0;zB.forEach((B){B.yYB();A+= B.uJ.length;});return A;}NZB(){var A=new th(fS());while(A.hasNext()){zB.add(A.b9());}}String toString(){var A=new StringBuffer("Set[");zB.forEach((B){A.write(B.toString());A.write(" ");});A.write("]");return A.toString();}}class Au extends yC{DateTime Xq;Au.oVB(Uint8List B):super.qVB(B){var C=fS();var A=xp.decode(C);var D=int.parse(A.substring(0,2));if(D>75)A="19"+A;else A="20"+A;A=A.substring(0,8)+"T"+A.substring(8);Xq=DateTime.parse(A);}Uint8List yYB(){var A=Xq.toUtc();var C=A.year.toString().substring(2).padLeft(2,"0");var D=A.month.toString().padLeft(2,"0");var G=A.day.toString().padLeft(2,"0");var H=A.hour.toString().padLeft(2,"0");var I=A.minute.toString().padLeft(2,"0");var J=A.second.toString().padLeft(2,"0");var K="${C}${D}${G}${H}${I}${J}Z";var B=new List<int>();B.addAll(xp.encode(K));zYB=B.length;AZB();BZB(B);return CZB;}String toString()=>"UtcTime(${Xq})";}class l${static String n$(List<int> C){StringBuffer A=new StringBuffer("[");bool B=false;C.forEach((D){B?A.write(", "):B=true;A.write("0x${D.toRadixString(16)}");});A.write("]");return A.toString();}}class ac{final String scheme;final Map<String,String> parameters;static List<ac> wHB(String C){return W1("authentication header",C,(){var A=new dK(C);A.ZB(nF);var H=EIB(A,(){var I=xHB(A,whitespaceName:'" " or "="');var B=<String,String>{};while(A.ZB(",")){A.ZB(nF);}yHB(A,B);var D=A.position;while(A.ZB(",")){A.ZB(nF);if(A.XD(",")||A.JI)continue;A.LG(yM,name:"a token");var G=A.DF[0];A.ZB(nF);if(!A.ZB('=')){A.position=D;break;}A.ZB(nF);if(A.ZB(yM)){B[G]=A.DF[0];}else{B[G]=wl(A,name:"a token or a quoted string");}A.ZB(nF);D=A.position;}return new ac(I,B);});A.z7();return H;});}static String xHB(dK A,{String whitespaceName}){A.LG(yM,name:"a token");var B=A.DF[0].toLowerCase();A.ZB(nF);if(A.DF==null||!A.DF[0].contains(" ")){A.LG(" ",name:whitespaceName);}return B;}static void yHB(dK A,Map B){A.LG(yM,name:"a token");var C=A.DF[0];A.ZB(nF);A.LG('=');A.ZB(nF);if(A.ZB(yM)){B[C]=A.DF[0];}else{B[C]=wl(A,name:"a token or a quoted string");}A.ZB(nF);}ac(this.scheme,Map<String,String> A):parameters=new UnmodifiableMapView(new vl.aWB(A));}class Vm{final String identifier;final String secret;final Uri TY;final Uri tokenEndpoint;final bool OZB;String PZB;dL QZB;Uri RZB;List<String> SZB;String TZB;aK UZB=aK.Wm;Vm(this.identifier,this.TY,this.tokenEndpoint,{this.secret,String delimiter,bool basicAuth: true,dL httpClient}):OZB=basicAuth,QZB=httpClient==null?new dL():httpClient,PZB=delimiter??' ';Uri R8(Uri B,{Iterable<String> scopes,String state}){if(UZB!=aK.Wm){throw new StateError('The authorization URL has already been generated.');}UZB=aK.NJB;if(scopes==null){scopes=[] ;}else{scopes=scopes.toList();}this.RZB=B;this.SZB=scopes;this.TZB=state;var A={"response_type":"code","client_id":this.identifier,"redirect_uri":B.toString()};if(state!=null)A['state']=state;if(!scopes.isEmpty)A['scope']=scopes.join(PZB);return hJB(this.TY,A);}Future<hT> lRB(Map<String,String> A)async{if(UZB==aK.Wm){throw new StateError('The authorization URL has not yet been generated.');}else if(UZB==aK.U2){throw new StateError('The authorization code has already been received.');}UZB=aK.U2;if(TZB!=null){if(!A.containsKey('state')){throw new FormatException('Invalid OAuth response for ' '"${TY}": parameter "state" expected to be ' '"${TZB}", was missing.');}else if(A['state']!=TZB){throw new FormatException('Invalid OAuth response for ' '"${TY}": parameter "state" expected to be ' '"${TZB}", was "${A['state']}".');}}if(A.containsKey('error')){var C=A['error_description'];var B=A['error_uri'];var D=B==null?null:Uri.parse(B);throw new jc(A['error'],C,D);}else if(!A.containsKey('code')){throw new FormatException('Invalid OAuth response for ' '"${TY}": did not contain required parameter ' '"code".');}return await VZB(A['code']);}Future<hT> VZB(String C)async{var D=new DateTime.now();var B=<String,String>{};var A={"grant_type":"authorization_code","code":C,"redirect_uri":this.RZB.toString()};if(OZB&&secret!=null){B["Authorization"]=Z2(identifier,secret);}else{A["client_id"]=identifier;if(secret!=null)A["client_secret"]=secret;}var G=await QZB.post(this.tokenEndpoint,headers:B,body:A);var H=W2(G,tokenEndpoint,D,SZB,PZB);return new hT(H,identifier:this.identifier,secret:this.secret,basicAuth:OZB,httpClient:QZB);}void close(){if(QZB!=null)QZB.close();QZB=null;}}class aK{static const Wm=const aK("initial");static const NJB=const aK("awaiting response");static const U2=const aK("finished");final String WZB;const aK(this.WZB);String toString()=>WZB;}class jc implements Exception{final String error;final String description;final Uri uri;jc(this.error,this.description,this.uri);String toString(){var A='OAuth authorization error (${error})';if(description!=null){A='${A}: ${description}';}else if(uri!=null){A='${A}: ${uri}';}return '${A}.';}}class Ua{static String DAB(List<int> J){var B=new Uint8List(J.length);B.setRange(0,B.length,J,0);int C=0,A=0,D=0;int G,H;String I='';while(C<B.length){G=B[C];if(A>3){if((C+1)<B.length){H=B[C+1];}else{H=0;}D=G&(0xFF>>A);A=(A+5)%8;D<<= A;D|= H>>(8-A);C++ ;}else{D=(G>>(8-(A+5))&0x1F);A=(A+5)%8;if(A==0){C++ ;}}I=I+EAB[D];}return I;}static Uint8List xh(String I){int A=0,H,C=0,G;Uint8List B=new Uint8List(I.length*5~/8);for(int D=0;D<B.length;D++ ){B[D]=0;}for(int D=0;D<I.length;D++ ){H=I.codeUnitAt(D)-'0'.codeUnitAt(0);if(H<0||H>=Hu.length){continue;}G=Hu[H];if(G==0xFF){continue;}if(A<=3){A=(A+5)%8;if(A==0){B[C]|=G;C++ ;if(C>=B.length){break;}}else{B[C]|=G<<(8-A);}}else{A=(A+5)%8;B[C]|=(G>>A);C++ ;if(C>=B.length){break;}B[C]|=G<<(8-A);}}return B;}static const EAB='ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';static const Hu=const[0xFF,0xFF,0x1A,0x1B,0x1C,0x1D,0x1E,0x1F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F,0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F,0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0xFF,0xFF,0xFF,0xFF,0xFF];}abstract class P1 implements dL{Future<gI> get(A,{Map<String,String> headers})=>XZB("GET",A,headers);Future<gI> post(A,{Map<String,String> headers,body,Encoding encoding})=>XZB("POST",A,headers,body,encoding);Future<gI> patch(A,{Map<String,String> headers,body,Encoding encoding})=>XZB("PATCH",A,headers,body,encoding);Future<gI> delete(A,{Map<String,String> headers})=>XZB("DELETE",A,headers);Future<String> read(A,{Map<String,String> headers}){return get(A,headers:headers).then((B){YZB(A,B);return B.TD;});}Future<Uint8List> KV(A,{Map<String,String> headers}){return get(A,headers:headers).then((B){YZB(A,B);return B.wL;});}Future<cT> send(yO A);Future<gI> XZB(String H,C,Map<String,String> D,[A,Encoding G])async{if(C is String)C=Uri.parse(C);var B=new T1(H,C);if(D!=null)B.headers.addAll(D);if(G!=null)B.encoding=G;if(A!=null){if(A is String){B.TD=A;}else if(A is List){B.wL=Ki.Yu(A);}else if(A is Map){B.nPB=Li.au(A);}else{throw new ArgumentError('Invalid request body "${A}".');}}return gI.pHB(await send(B));}void YZB(A,gI B){if(B.statusCode<400)return;var C="Request to ${A} failed with status ${B.statusCode}";if(B.reasonPhrase!=null){C="${C}: ${B.reasonPhrase}";}if(A is String)A=Uri.parse(A);throw new Yc("${C}.",A);}void close(){}}abstract class yO{final String method;final Uri QE;int get contentLength=>ZZB;int ZZB;set contentLength(int A){if(A!=null&&A<0){throw new ArgumentError("Invalid content length ${A}.");}aZB();ZZB=A;}bool get persistentConnection=>bZB;bool bZB=true;set persistentConnection(bool A){aZB();bZB=A;}bool get followRedirects=>cZB;bool cZB=true;set followRedirects(bool A){aZB();cZB=A;}int get maxRedirects=>dZB;int dZB=5;set maxRedirects(int A){aZB();dZB=A;}final Map<String,String> headers;bool get sq=>eZB;bool eZB=false;yO(this.method,this.QE):headers=new LinkedHashMap(equals:(A,B)=>A.toLowerCase()==B.toLowerCase(),hashCode:(C)=>C.toLowerCase().hashCode);cL rq(){if(sq)throw new StateError("Can't finalize a finalized Request.");eZB=true;return null;}void aZB(){if(!sq)return;throw new StateError("Can't modify a finalized Request.");}String toString()=>"${method} ${QE}";}abstract class sl{final yO request;final int statusCode;final String reasonPhrase;final int contentLength;final Map<String,String> headers;final bool isRedirect;final bool persistentConnection;sl(this.statusCode,{this.contentLength,this.request,this.headers: const{},this.isRedirect: false,this.persistentConnection: true,this.reasonPhrase}){if(statusCode<100){throw new ArgumentError("Invalid status code ${statusCode}.");}else if(contentLength!=null&&contentLength<0){throw new ArgumentError("Invalid content length ${contentLength}.");}}}abstract class n{static bool oS=(){if(0.0 is int){return true;}try {return 3.modInverse(7)==-1;}catch (A){return true;}return false;}();static n get FAB{if(oS){return AB.NJ(0);}else{return MB.Va(0);}}static n get YM{if(oS){return AB.NJ(1);}else{return MB.Va(1);}}static n get yh{if(oS){return AB.NJ(2);}else{return MB.Va(2);}}static n get Iu{if(oS){return AB.NJ(3);}else{return MB.Va(3);}}factory n([A,B,C]){if(oS){return new AB(A,B,C);}else{return new MB(A,B,C);}}factory n.tVB(int A,List<int> B){if(oS){return new AB.vVB(A,B);}else{return new MB.uVB(A,B);}}}class MB implements n{static MB Va(int A){return new MB(A);}int data;MB([A,B,C]){if(A!=null){if(A is int){data=A;}else if(A is num){data=A.toInt();}else if(A is List){this.yq(A);}else{this.mU(A,B);}}}factory MB.uVB(int B,List<int> C){MB A=new MB();if(B!=0){A.yq(C,true);}else{A.yq(C,false);}if(B<0){A.data=-A.data;}return A;}void cP(MB A){A.data=data;}void nf(int A){data=A;}void mU(String A,int B){data=int.parse(A,radix:B,onError:(C)=>0);}void yq(List B,[bool G=false]){if(B==null||B.length==0){data=0;return;}bool D=false;if(!G&&B[0]&0xFF>0x7F){D=true;}if(D){int A=0;for(int C in B){A=(A<<8)|(~((C&0xFF)-256));}data=~A;}else{int A=0;for(int C in B){A=(A<<8)|(C&0xFF);}data=A;}}String toString([int A=10]){return data.toRadixString(A);}DV(){return new MB(-data);}MB abs(){return (data<0)?this.DV():this.xL();}int compareTo(A){if(A is num){return data.compareTo(A);}if(A is MB){return data.compareTo(A.data);}return 0;}int Mg(A){var C=1,B;if(A is num)A=A.toInt();if((B=A>>16)!=0){A=B;C+= 16;}if((B=A>>8)!=0){A=B;C+= 8;}if((B=A>>4)!=0){A=B;C+= 4;}if((B=A>>2)!=0){A=B;C+= 2;}if((B=A>>1)!=0){A=B;C+= 1;}return C;}int bitLength(){return data.bitLength;}void CZ(int A,B){B.data=data<<A;}void NM(int A,B){B.data=data>>A;}void oD(A,B){B.data=data-A.data;}void OZ(A,B){B.data=data*A.data;}void wg(A){A.data=data*data;}fP(MB A,MB B,MB C){B.data=data~/A.data;C.data=data%A.data;}NZ(A){return new MB(data%A.data);}isEven(){return data.isEven;}isOdd(){return data.isOdd;}xL(){return new MB(this.data);}int tG(){return data;}int RI(){return data.sign;}String ss([int A=10]){return data.toRadixString(A);}void J8(A,B){data=int.parse(A,radix:B,onError:(C)=>0);}List<int> IQ(){String G;bool M=false;if(data<0){G=(~data).toRadixString(16);M=true;}else{G=data.toRadixString(16);}int D=0;int K=G.length;int I=(K+1)~/2;int J=0;List A;if(M){if(K&1==1){D=-1;}int B=~int.parse(G.substring(0,D+2),radix:16);if(B<-128)B+= 256;if(B>=0){J=1;A=new List<int>(I+1);A[0]=-1;A[1]=B;}else{A=new List<int>(I);A[0]=B;}for(int C=1;C<I; ++C){int H=~int.parse(G.substring(D+(C<<1),D+(C<<1)+2),radix:16);if(H<-128)H+= 256;A[C+J]=H;}}else{if(K&1==1){D=-1;}int B=int.parse(G.substring(0,D+2),radix:16);if(B>127)B-= 256;if(B<0){J=1;A=new List<int>(I+1);A[0]=0;A[1]=B;}else{A=new List<int>(I);A[0]=B;}for(int C=1;C<I; ++C){int H=int.parse(G.substring(D+(C<<1),D+(C<<1)+2),radix:16);if(H>127)H-= 256;A[C+J]=H;}}return A;}bool LE(MB A){return this.compareTo(A)==0?true:false;}MB min(MB A){return (this.compareTo(A)<0)?this:A;}MB max(MB A){return (this.compareTo(A)>0)?this:A;}void Gf(MB A,Function B,MB C){C.data=B(data,A.data);}m9(A,B){return A&B;}oR(A){return new MB(data&A.data);}n9(A,B){return A|B;}LM(A){return new MB(data|A.data);}o9(A,B){return A^B;}hh(A){return new MB(data^A.data);}LS(){return new MB(~data);}ds(int A){return new MB(data<<A);}tg(int A){return new MB(data>>A);}int ar(int A){if(A==0)return -1;int B=0;while((A&0xffffffff)==0){A>>= 32;B+= 32;}if((A&0xffff)==0){A>>= 16;B+= 16;}if((A&0xff)==0){A>>= 8;B+= 8;}if((A&0xf)==0){A>>= 4;B+= 4;}if((A&3)==0){A>>= 2;B+= 2;}if((A&1)==0) ++B;return B;}Dr(){return ar(data);}int get P9=>Dr();EL(A){return ((data&(1<<A))!=0);}PY(A,B){B.data=data+A.data;}MB add(A){return new MB(data+A.data);}MB subtract(A){return new MB(data-A.data);}MB or(A){return new MB(data*A.data);}MB hU(A){return new MB(data~/A.data);}MB remainder(MB A){return new MB(data.remainder(A.data));}Tq(A){data*= A;}Uf(A,B){if(B==0){data+= A;}else{throw 'dAddOffset(${A},${B}) not implemented';}}modPow(MB A,MB B){return new MB(data.modPow(A.data,B.data));}MB modInverse(MB A){return new MB(data.modInverse(A.data));}MB operator+(MB A)=>add(A);MB operator-(MB A)=>subtract(A);MB operator*(MB A)=>or(A);MB operator%(MB A)=>NZ(A);MB operator/(MB A)=>hU(A);MB operator~/(MB A)=>hU(A);MB operator-()=>this.DV();bool operator<(MB A)=>compareTo(A)<0?true:false;bool operator<=(MB A)=>compareTo(A)<=0?true:false;bool operator>(MB A)=>compareTo(A)>0?true:false;bool operator>=(MB A)=>compareTo(A)>=0?true:false;bool operator==(A)=>compareTo(A)==0?true:false;MB operator&(MB A)=>oR(A);MB operator|(MB A)=>LM(A);MB operator^(MB A)=>hh(A);MB operator~()=>LS();MB operator<<(int A)=>ds(A);MB operator>>(int A)=>tg(A);}class Ju{AB qC;Ju(this.qC);convert(A){if(A.eB<0||A.compareTo(this.qC)>=0){return A.NZ(this.qC);}else{return A;}}kg(A){return A;}reduce(A){A.fP(this.qC,null,A);}Lg(B,C,A){B.OZ(C,A);this.reduce(A);}VS(B,A){B.wg(A);this.reduce(A);}}class Ku{AB qC;var mr;var nr;var U9;var x_;var V9;Ku(this.qC){this.mr=qC.FSB();this.nr=this.mr&0x7fff;this.U9=this.mr>>15;this.x_=(1<<(AB.GC-15))-1;this.V9=2*qC.c;}AB convert(AB B){var A=AB.PD();B.abs().hY(this.qC.c,A);A.fP(this.qC,null,A);if(B.eB<0&&A.compareTo(AB.ML)>0)this.qC.oD(A,A);return A;}AB kg(AB B){var A=AB.PD();B.cP(A);this.reduce(A);return A;}void reduce(A){var B=A.YB;while(A.c<=this.V9){B[A.c++ ]=0;}for(var D=0;D<this.qC.c; ++D){var C=B[D]&0x7fff;var G=(C*this.nr+(((C*this.U9+(B[D]>>15)*this.nr)&this.x_)<<15))&AB.UG;C=D+this.qC.c;B[C]+=this.qC.uK(0,G,A,D,0,this.qC.c);while(B[C]>=AB.hH){B[C]-=AB.hH;B[ ++C]++;}}A.clamp();A.df(this.qC.c,A);if(A.compareTo(this.qC)>=0){A.oD(this.qC,A);}}VS(B,A){B.wg(A);this.reduce(A);}Lg(B,C,A){B.OZ(C,A);this.reduce(A);}}class Lu{AB qC;AB yP;AB Ks;var W9;Lu(this.qC){this.yP=AB.PD();this.Ks=AB.PD();AB.Bi.hY(2*qC.c,this.yP);this.W9=this.yP.hU(qC);}AB convert(AB A){if(A.eB<0||A.c>2*this.qC.c){return A.NZ(this.qC);}else if(A.compareTo(this.qC)<0){return A;}else{var B=AB.PD();A.cP(B);this.reduce(B);return B;}}kg(A){return A;}void reduce(AB A){A.df(this.qC.c-1,this.yP);if(A.c>this.qC.c+1){A.c=this.qC.c+1;A.clamp();}this.W9.xSB(this.yP,this.qC.c+1,this.Ks);this.qC.wSB(this.Ks,this.qC.c+1,this.yP);while(A.compareTo(this.yP)<0){A.Uf(1,this.qC.c+1);}A.oD(this.yP,A);while(A.compareTo(this.qC)>=0){A.oD(this.qC,A);}}VS(B,A){B.wg(A);this.reduce(A);}Lg(B,C,A){B.OZ(C,A);this.reduce(A);}}class Wa<Y>{operator[](var A){return data[A];}operator[]=(var A,var B){if(A>data.length-1){data.length=A+1;}return data[A]=B;}List<Y> data=new List<Y>();}class AB implements n{static int pS;static int GC;static int UG;static int hH;static int Xa;static int Mu;static int zh;static int Ai;static AB PD(){return new AB(null,null,null);}static AB NJ(int B){var A=PD();A.nf(B);return A;}static AB get ML=>NJ(0);static AB get Bi=>NJ(1);static final List<int> Nu=const[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509];static int GAB;static int HAB=0xdeadbeefcafe;static bool IAB;Wa<int> YB;Function uK;static var Ou="0123456789abcdefghijklmnopqrstuvwxyz";static Map OQ;int c;var eB;AB([A,B,C]){KAB(28);uK=fZB;this.YB=new Wa<int>();if(A!=null){if(A is int){this.mU(A.toString(),10);}else if(A is num){this.mU(A.toInt().toString(),10);}else if(B==null&&A is!String){this.mU(A,256);}else{this.mU(A,B);}}}factory AB.vVB(int B,List<int> A){if(B==0)throw new ArgumentError("Argument signum must not be zero");if((A[0]&0x80)!=0){A=new Uint8List(1+A.length)..[0]=0..setRange(1,1+A.length,A);}var C=new AB(A);return (B<0)?-C:C;}fZB(C,D,O,G,B,Q){var H=this.YB;var I=O.YB;var J=D.toInt()&0x3fff,K=D.toInt()>>14;while( --Q>=0){var A=H[C]&0x3fff;var M=H[C++ ]>>14;var N=K*A+M*J;A=J*A+((N&0x3fff)<<14)+I[G]+B;B=(A>>28)+(N>>14)+K*M;I[G++ ]=A&0xfffffff;}return B;}static JAB(int A){pS=A;GC=pS;UG=((1<<pS)-1);hH=(1<<pS);Xa=52;Mu=pow(2,Xa);zh=Xa-pS;Ai=2*pS-Xa;}static KAB(int A){if(OQ!=null)return;OQ=new Map();IAB=((HAB&0xffffff)==0xefcafe);LAB();GAB=(1<<26)~/Nu[Nu.length-1];JAB(A);}static LAB(){Ou="0123456789abcdefghijklmnopqrstuvwxyz";OQ=new Map();int B,A;B="0".codeUnitAt(0);for(A=0;A<=9; ++A)OQ[B++ ]=A;B="a".codeUnitAt(0);for(A=10;A<36; ++A)OQ[B++ ]=A;B="A".codeUnitAt(0);for(A=10;A<36; ++A)OQ[B++ ]=A;}gZB(A){return Ou[A];}hZB(B,C){var A=OQ[B.codeUnitAt(C)];return (A==null)?-1:A;}void cP(AB B){var C=this.YB;var D=B.YB;for(var A=this.c-1;A>=0; --A)D[A]=C[A];B.c=this.c;B.eB=this.eB;}void nf(int A){var B=this.YB;this.c=1;this.eB=(A<0)?-1:0;if(A>0){B[0]=A;}else if(A<-1){B[0]=A+hH;}else{this.c=0;}}void mU(D,int C){var G=this.YB;var B;if(C==16){B=4;}else if(C==8){B=3;}else if(C==256){B=8;}else if(C==2){B=1;}else if(C==32){B=5;}else if(C==4){B=2;}else{this.J8(D,C);return;}this.c=0;this.eB=0;var I=D.length,J=false,A=0;while( --I>=0){var H=(B==8)?D[I]&0xff:hZB(D,I);if(H<0){if(D[I]=="-")J=true;continue;}J=false;if(A==0){G[this.c++ ]=H;}else if(A+B>GC){G[this.c-1]|=(H&((1<<(GC-A))-1))<<A;G[this.c++ ]=(H>>(GC-A));}else{G[this.c-1]|=H<<A;}A+= B;if(A>=GC)A-= GC;}if(B==8&&(D[0]&0x80)!=0){this.eB=-1;if(A>0)G[this.c-1]|=((1<<(GC-A))-1)<<A;}this.clamp();if(J)AB.ML.oD(this,this);}String toString([int D]){var H=this.YB;if(this.eB<0){return "-${this.DV().toString(D)}";}var A;if(D==16){A=4;}else if(D==8){A=3;}else if(D==2){A=1;}else if(D==32){A=5;}else if(D==4){A=2;}else{return this.ss(D);}var K=(1<<A)-1,G,I=false,J="",C=this.c;var B=GC-(C*GC)%A;if(C-- >0){if(B<GC&&(G=H[C]>>B)>0){I=true;J=gZB(G);}while(C>=0){if(B<A){G=(H[C]&((1<<B)-1))<<(A-B);G|= H[ --C]>>(B+= GC-A);}else{G=(H[C].toInt()>>(B-= A.toInt()).toInt())&K.toInt();if(B<=0){B+= GC; --C;}}if(G>0)I=true;if(I)J="${J}${gZB(G)}";}}return I?J:"0";}DV(){var A=PD();AB.ML.oD(this,A);return A;}AB abs(){return (this.eB<0)?this.DV():this;}int compareTo(B){if(B is num){B=new AB(B);}var D=this.YB;var G=B.YB;var A=this.eB-B.eB;if(A!=0)return A;var C=this.c;A=C-B.c;if(A!=0)return A;while( --C>=0)if((A=D[C]-G[C])!=0)return A;return 0;}int Mg(A){var C=1,B;if(A is num)A=A.toInt();if((B=A>>16)!=0){A=B;C+= 16;}if((B=A>>8)!=0){A=B;C+= 8;}if((B=A>>4)!=0){A=B;C+= 4;}if((B=A>>2)!=0){A=B;C+= 2;}if((B=A>>1)!=0){A=B;C+= 1;}return C;}int bitLength(){var A=this.YB;if(this.c<=0)return 0;return GC*(this.c-1)+Mg(A[this.c-1]^(this.eB&UG));}void hY(B,C){var G=this.YB;var D=C.YB;var A;for(A=this.c-1;A>=0; --A)D[A+B]=G[A];for(A=B-1;A>=0; --A)D[A]=0;C.c=this.c+B;C.eB=this.eB;}void df(B,C){var D=this.YB;var G=C.YB;for(var A=B;A<this.c; ++A)G[A-B]=D[A];C.c=LJ.max(this.c-B,0);C.eB=this.eB;}void CZ(I,B){var J=this.YB;var D=B.YB;var G=I%GC;var K=GC-G;var M=(1<<K)-1;int C=I~/GC;var H=(this.eB<<G)&UG;var A;for(A=this.c-1;A>=0; --A){D[A+C+1]=(J[A]>>K)|H;H=(J[A]&M)<<G;}for(A=C-1;A>=0; --A)D[A]=0;D[C]=H;B.c=this.c+C+1;B.eB=this.eB;B.clamp();}void NM(I,C){var H=this.YB;var G=C.YB;C.eB=this.eB;var A=I~/GC;if(A>=this.c){C.c=0;return;}var D=I%GC;var J=GC-D;var K=(1<<D)-1;G[0]=H[A]>>D;for(var B=A+1;B<this.c; ++B){G[B-A-1]|=(H[B]&K)<<J;G[B-A]=H[B]>>D;}if(D>0)G[this.c-A-1]|=(this.eB&K)<<J;C.c=this.c-A;C.clamp();}void clamp(){var A=this.YB;var B=this.eB&UG;while(this.c>0&&A[this.c-1]==B){ --this.c;}}void oD(C,G){var H=this.YB;var D=G.YB;var I=C.YB;int B=0;int A=0;int J=LJ.min(C.c,this.c);while(B<J){A+= (H[B].toInt()-I[B].toInt()).toInt();D[B++ ]=A&UG;A>>= GC;if(A==4294967295){A=-1;}}if(C.c<this.c){A-= C.eB;while(B<this.c){A+= H[B];D[B++ ]=A&UG;A>>= GC;if(A==4294967295){A=-1;}}A+= this.eB;}else{A+= this.eB;while(B<C.c){A-= I[B];D[B++ ]=A&UG;A>>= GC;if(A==4294967295){A=-1;}}A-= C.eB;}G.eB=(A<0)?-1:0;if(A<-1){D[B++ ]=hH+A;}else if(A>0){D[B++ ]=A;}G.c=B;G.clamp();}bool iZB=true;void OZ(G,B){var J=this.YB;var H=B.YB;AB C=this.abs();AB D=G.abs();var I=D.YB;var A=C.c;B.c=A+D.c;while( --A>=0)H[A]=0;for(A=0;A<D.c; ++A)H[A+C.c]=C.uK(0,I[A],B,A,0,C.c);B.eB=0;B.clamp();if(this.eB!=G.eB){AB.ML.oD(B,B);}}void wg(C){var B=this.abs();var G=B.YB;var D=C.YB;var A=C.c=2*B.c;while( --A>=0)D[A]=0;for(A=0;A<B.c-1; ++A){var H=B.uK(A,G[A],C,2*A,0,1);if((D[A+B.c]+=B.uK(A+1,2*G[A],C,2*A+1,H,B.c-A-1))>=hH){D[A+B.c]-=hH;D[A+B.c+1]=1;}}if(C.c>0)D[C.c-1]+=B.uK(A,G[A],C,2*A,0,1);C.eB=0;C.clamp();}fP(AB V,D,AB A){var H=V.abs();if(H.c<=0)return;var N=this.abs();if(N.c<H.c){if(D!=null)D.nf(0);if(A!=null)this.cP(A);return;}if(A==null)A=PD();var B=PD(),b=this.eB,r=V.eB;var EB=H.YB;var K=GC-Mg(EB[H.c-1]);if(K>0){H.CZ(K,B);N.CZ(K,A);}else{H.cP(B);N.cP(A);}var C=B.c;var O=B.YB;var Q=O[C-1];if(Q==0)return;var h=Q*(1<<zh)+((C>1)?O[C-2]>>Ai:0);var IB=Mu/h,LB=(1<<zh)/h,UB=1<<Ai;var I=A.c,M=I-C;AB G=(D==null)?PD():D;B.hY(M,G);var J=A.YB;if(A.compareTo(G)>=0){J[A.c++ ]=1;A.oD(G,A);}AB.Bi.hY(C,G);G.oD(B,B);while(B.c<C)O[B.c++ ]=0;while( --M>=0){var S=(J[ --I]==Q)?UG:(J[I]*IB+(J[I-1]+UB)*LB).floor();if((J[I]+=B.uK(0,S,A,M,0,C))<S){B.hY(M,G);A.oD(G,A);while(J[I]< --S)A.oD(G,A);}}if(D!=null){A.df(C,D);if(b!=r)AB.ML.oD(D,D);}A.c=C;A.clamp();if(K>0)A.NM(K,A);if(b<0)AB.ML.oD(A,A);}NZ(B){var A=PD();this.abs().fP(B,null,A);if(this.eB<0&&A.compareTo(AB.ML)>0)B.oD(A,A);return A;}FSB(){var C=this.YB;if(this.c<1)return 0;var B=C[0];if((B&1)==0)return 0;var A=B&3;A=(A*(2-(B&0xf)*A))&0xf;A=(A*(2-(B&0xff)*A))&0xff;A=(A*(2-(((B&0xffff)*A)&0xffff)))&0xffff;A=(A*(2-B*A%hH))%hH;return (A>0)?hH-A:-A;}isEven(){var A=this.YB;return ((this.c>0)?(A[0]&1):this.eB)==0;}isOdd()=>!isEven();xL(){var A=PD();this.cP(A);return A;}int tG(){var A=this.YB;if(this.eB<0){if(this.c==1){return A[0]-hH;}else if(this.c==0)return -1;}else if(this.c==1){return A[0];}else if(this.c==0)return 0;return ((A[1]&((1<<(32-GC))-1))<<GC)|A[0];}int Y7(A){return (LN2*GC/log(A)).floor().toInt();}int RI(){var A=this.YB;if(this.eB<0){return -1;}else if(this.c<=0||(this.c==1&&A[0]<=0)){return 0;}else{return 1;}}String ss([int A=10]){if(A==null)A=10;if(this.RI()==0||A<2||A>36)return "0";var I=this.Y7(A);int G=pow(A,I);var H=NJ(G),B=PD(),C=PD(),D="";this.fP(H,B,C);while(B.RI()>0){D="${(G+C.tG()).toInt().toRadixString(A).substring(1)}${D}";B.fP(H,B,C);}return "${C.tG().toRadixString(A)}${D}";}void J8(C,A){this.nf(0);if(A==null)A=10;var H=this.Y7(A);num K=pow(A,H);bool I=false;int D=0,B=0;for(var G=0;G<C.length; ++G){var J=hZB(C,G);if(J<0){if(C is String){if(C[0]=="-"&&this.RI()==0){I=true;}}continue;}B=A*B+J;if( ++D>=H){this.Tq(K);this.Uf(B,0);D=0;B=0;}}if(D>0){this.Tq(pow(A,D));if(B!=0){this.Uf(B,0);}}if(I){AB.ML.oD(this,this);}}List<int> IQ(){var G=this.YB;var C=this.c;Wa<int> H=new Wa<int>();H[0]=this.eB;var A=GC-(C*GC)%8,B,D=0;if(C-- >0){if(A<GC&&(B=G[C]>>A)!=(this.eB&UG)>>A){H[D++ ]=B|(this.eB<<(GC-A));}while(C>=0){if(A<8){B=(G[C]&((1<<A)-1))<<(8-A);B|= G[ --C]>>(A+= GC-8);}else{B=(G[C]>>(A-= 8))&0xff;if(A<=0){A+= GC; --C;}}if((B&0x80)!=0)B|= -256;if(D==0&&(this.eB&0x80)!=(B&0x80)) ++D;if(D>0||B!=this.eB)H[D++ ]=B;}}return H.data;}bool LE(AB A){return this.compareTo(A)==0?true:false;}AB min(AB A){return (this.compareTo(A)<0)?this:A;}AB max(AB A){return (this.compareTo(A)>0)?this:A;}void Gf(AB B,Function D,AB C){var J=this.YB;var K=B.YB;var H=C.YB;var A,G,I=LJ.min(B.c,this.c);for(A=0;A<I; ++A)H[A]=D(J[A],K[A]);if(B.c<this.c){G=B.eB&UG;for(A=I;A<this.c; ++A)H[A]=D(J[A],G);C.c=this.c;}else{G=this.eB&UG;for(A=I;A<B.c; ++A)H[A]=D(G,K[A]);C.c=B.c;}C.eB=D(this.eB,B.eB);C.clamp();}m9(A,B){return A&B;}oR(B){var A=PD();this.Gf(B,m9,A);return A;}n9(A,B){return A|B;}LM(B){var A=PD();this.Gf(B,n9,A);return A;}o9(A,B){return A^B;}hh(B){var A=PD();this.Gf(B,o9,A);return A;}LS(){var C=this.YB;var A=PD();var D=A.YB;for(var B=0;B<this.c; ++B){D[B]=UG&~C[B];}A.c=this.c;A.eB=~this.eB;return A;}ds(A){var B=PD();if(A<0){this.NM(-A,B);}else{this.CZ(A,B);}return B;}tg(A){var B=PD();if(A<0){this.CZ(-A,B);}else{this.NM(A,B);}return B;}ar(A){if(A==0)return -1;var B=0;if((A&0xffff)==0){A>>= 16;B+= 16;}if((A&0xff)==0){A>>= 8;B+= 8;}if((A&0xf)==0){A>>= 4;B+= 4;}if((A&3)==0){A>>= 2;B+= 2;}if((A&1)==0) ++B;return B;}Dr(){var B=this.YB;for(var A=0;A<this.c; ++A)if(B[A]!=0)return A*GC+ar(B[A]);if(this.eB<0)return this.c*GC;return -1;}int get P9=>Dr();EL(A){var C=this.YB;int B=A~/GC;if(B>=this.c)return (this.eB!=0);return ((C[B]&(1<<(A%GC)))!=0);}PY(C,G){var H=this.YB;var I=C.YB;var D=G.YB;var B=0,A=0,J=LJ.min(C.c,this.c);while(B<J){A+= H[B]+I[B];D[B++ ]=A&UG;A>>= GC;}if(C.c<this.c){A+= C.eB;while(B<this.c){A+= H[B];D[B++ ]=A&UG;A>>= GC;}A+= this.eB;}else{A+= this.eB;while(B<C.c){A+= I[B];D[B++ ]=A&UG;A>>= GC;}A+= C.eB;}G.eB=(A<0)?-1:0;if(A>0){D[B++ ]=A;}else if(A<-1)D[B++ ]=hH+A;G.c=B;G.clamp();}AB add(B){var A=PD();this.PY(B,A);return A;}AB subtract(B){var A=PD();this.oD(B,A);return A;}AB or(B){var A=PD();this.OZ(B,A);return A;}AB hU(B){var A=PD();this.fP(B,A,null);return A;}AB remainder(AB B){AB A=PD();this.fP(B,null,A);return (A.RI()>=0)?A:(A+B);}Tq(A){var B=this.YB;B[this.c]=this.uK(0,A-1,this,0,0,this.c); ++this.c;this.clamp();}Uf(C,A){var B=this.YB;while(this.c<=A)B[this.c++ ]=0;B[A]+=C;while(B[A]>=hH){B[A]-=hH;if( ++A>=this.c)B[this.c++ ]=0; ++B[A];}}wSB(D,G,B){var H=B.YB;var I=D.YB;var A=LJ.min(this.c+D.c,G);B.eB=0;B.c=A;while(A>0)H[ --A]=0;var C;for(C=B.c-this.c;A<C; ++A)H[A+this.c]=this.uK(0,I[A],B,A,0,this.c);for(C=LJ.min(D.c,G);A<C; ++A)this.uK(0,I[A],B,A,0,G-A);B.clamp();}xSB(D,C,B){var G=B.YB;var H=D.YB; --C;var A=B.c=this.c+D.c-C;B.eB=0;while( --A>=0)G[A]=0;for(A=LJ.max(C-this.c,0);A<D.c; ++A){G[this.c+A-C]=this.uK(C-A,H[A],B,0,0,this.c+A-C);}B.clamp();B.df(1,B);}modPow(AB S,AB N){var M=S.YB;var A=S.bitLength(),H,B=NJ(1),C;if(A<=0){return B;}else if(A<18){H=1;}else if(A<48){H=3;}else if(A<144){H=4;}else if(A<768){H=5;}else{H=6;}if(A<8){C=new Ju(N);}else if(N.isEven()){C=new Lu(N);}else{C=new Ku(N);}var J=new Map(),D=3,O=H-1,V=(1<<H)-1;J[1]=C.convert(this);if(H>1){var b=PD();C.VS(J[1],b);while(D<=V){J[D]=PD();C.Lg(b,J[D-2],J[D]);D+= 2;}}var G=S.c-1,K,h=true,I=PD(),Q;A=Mg(M[G])-1;while(G>=0){if(A>=O){K=(M[G]>>(A-O))&V;}else{K=(M[G]&((1<<(A+1))-1))<<(O-A);if(G>0)K|= M[G-1]>>(GC+A-O);}D=H;while((K&1)==0){K>>= 1; --D;}if((A-= D)<0){A+= GC; --G;}if(h){J[K].cP(B);h=false;}else{while(D>1){C.VS(B,I);C.VS(I,B);D-= 2;}if(D>0)C.VS(B,I);else{Q=B;B=I;I=Q;}C.Lg(I,J[K],B);}while(G>=0&&(M[G]&(1<<A))==0){C.VS(B,I);Q=B;B=I;I=Q;if( --A<0){A=GC-1; --G;}}}return C.kg(B);}AB modInverse(AB B){var J=B.isEven();if((this.isEven()&&J)||B.RI()==0)return AB.ML;var G=B.xL(),C=this.xL();if(C.RI()<0)C=-C;var H=NJ(1),D=NJ(0),I=NJ(0),A=NJ(1);while(G.RI()!=0){while(G.isEven()){G.NM(1,G);if(J){if(!H.isEven()||!D.isEven()){H.PY(this,H);D.oD(B,D);}H.NM(1,H);}else if(!D.isEven())D.oD(B,D);D.NM(1,D);}while(C.isEven()){C.NM(1,C);if(J){if(!I.isEven()||!A.isEven()){I.PY(this,I);A.oD(B,A);}I.NM(1,I);}else if(!A.isEven())A.oD(B,A);A.NM(1,A);}if(G.compareTo(C)>=0){G.oD(C,G);if(J)H.oD(I,H);D.oD(A,D);}else{C.oD(G,C);if(J)I.oD(H,I);A.oD(D,A);}}if(C.compareTo(AB.Bi)!=0)return AB.ML;if(A.compareTo(B)>=0)return jZB(A.subtract(B),B);if(A.RI()<0)A.PY(B,A);else return jZB(A,B);if(A.RI()<0)return jZB(A.add(B),B);else return jZB(A,B);}jZB(A,B)=>(RI()<0)?(B-A):A;AB operator+(AB A)=>add(A);AB operator-(AB A)=>subtract(A);AB operator*(AB A)=>or(A);AB operator%(AB A)=>remainder(A);AB operator/(AB A)=>hU(A);AB operator~/(AB A)=>hU(A);AB operator-()=>this.DV();bool operator<(AB A)=>compareTo(A)<0?true:false;bool operator<=(AB A)=>compareTo(A)<=0?true:false;bool operator>(AB A)=>compareTo(A)>0?true:false;bool operator>=(AB A)=>compareTo(A)>=0?true:false;bool operator==(A)=>compareTo(A)==0?true:false;AB operator&(AB A)=>oR(A);AB operator|(AB A)=>LM(A);AB operator^(AB A)=>hh(A);AB operator~()=>LS();AB operator<<(int A)=>ds(A);AB operator>>(int A)=>tg(A);}class xS{static String TQ;static final UC rBB=new UC.tWB("1.0.1");static final UC sBB=new UC.tWB("1.0.4");int TV=200;final IF EC;final VW kZB;LD xI;String W_;MF dE;String V_;xS(VW A,this.EC):kZB=(A==null)?new eFB():A{dE=MW();W_=dE.pF.IV;V_=dE.pF.U8("broker-dsa");}List<String> W8(HttpRequest A,[g G]){String C=A.uri.queryParameters["dsId"];if(C!=null&&C.length>=43){if(A.requestedUri.queryParameters["home"]!=null){C="${A.requestedUri.queryParameters["home"]}:${C}";}return [C,null];}String B=G==null?null:G.username;if(TQ!=null&&A.headers.value("X-Verification-Token")==TQ){if(A.uri.queryParameters["username"]!=null){B=A.requestedUri.queryParameters["username"];}if(A.headers.value("X-Username")!=null){B=A.headers.value("X-Username");}}if(X.Hf&&B==HD.NK.username){return null;}if(B!=null&&B.isNotEmpty&&B.length<43){String D=A.uri.queryParameters["session"];if(D==null){D="";}return [B,D];}return null;}k8(HttpRequest A,[g O])async{var I=W8(A,O);if(I==null){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("Invalid Request.");A.response.close();return;}String J=I[0];List<int> K=await A.fold([] ,x0);try {if(K.length>1024){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("Invalid Request.");A.response.close();return;}String Q=const Utf8Decoder(allowMalformed:true).convert(K);Map B=const JsonDecoder().convert(Q);U.mB("DSLink attempting handshake (${I[0]}): ${B}");if(B["linkData"]!=null&&B["linkData"] is!Map){throw HttpStatus.BAD_REQUEST;}if(B["formats"]!=null&&B["formats"] is!List){throw HttpStatus.BAD_REQUEST;}var M=new UC.tWB(B["version"]);bool G=false;String H=A.requestedUri.queryParameters["token"];if(H!=null){String S=H.substring(0,16);for(var V in EC.JJ.xZ.values){if(V.id==S){G=true;break;}}}WK D=kZB.Cr(J);if(D==null){String b=B["publicKey"];var N=zF.vO(b);if(N==null){throw HttpStatus.BAD_REQUEST;}String H=A.requestedUri.queryParameters["token"];D=new WK(J,new dJ.OWB(N),kZB,token:H,nodeProvider:EC,enableTimeout:M>=rBB,enableAck:M>=sBB,onDisconnect:kZB.vr,trusted:G);if(!G&&!D.ISB){throw HttpStatus.BAD_REQUEST;}if(!kZB.MY(D)){throw HttpStatus.UNAUTHORIZED;}}await D.yRB(A,B["isRequester"]==true,B["isResponder"]==true,V_,W_,updateInterval:TV,trusted:G,linkData:B["linkData"],formats:B["formats"],enableCompression:B["enableWebSocketCompression"]==true);}catch (C){if(C is int){A.response.statusCode=C;if(C==HttpStatus.BAD_REQUEST){A.response.writeln("Invalid Request.");}else if(C==HttpStatus.UNAUTHORIZED){A.response.writeln("Unauthorized.");}}if(xI!=null&&xI.gU==true&&C is!int){A.response.writeln(C);}A.response.close();}}void nRB(HttpRequest C){var A=C.response;A.deadline=const Duration(seconds:15);String D=C.uri.path;String G=D.substring(6);EC.V8(G).then((ByteData B){if(B==null){A.statusCode=HttpStatus.NOT_FOUND;A.writeln("Icon Not Found.");A.close();return;}A.add(B.buffer.asUint8List(B.offsetInBytes,B.lengthInBytes));A.close();}).catchError((H){A.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.close();});}void Lr(HttpRequest D,[g B]){var G=W8(D,B);if(G==null){D.response.statusCode=HttpStatus.BAD_REQUEST;D.response.writeln("Invalid Request.");D.response.close();return;}bool I=G[1]!=null;String N=D.requestedUri.queryParameters["token"];String K;String M;int V=f.dI(D.requestedUri.queryParameters["maxPermission"],f.o);if(N!=null){K=N.substring(0,16);for(var O in EC.JJ.xZ.keys){var b=EC.JJ.xZ[O];if(b.id==K){I=true;M=O;break;}}}WK C=kZB.Cr(G[0],sessionId:G[1]);if(C==null&&G[1]!=null){C=new WK(G[0],null,kZB,nodeProvider:EC,session:G[1],enableTimeout:true,onDisconnect:RTB,trusted:I,maxPermission:V);C.iq=true;kZB.MY(C);}String A="";if(G[1]!=null&&B!=null){var J=B.metadata["groups"];if(J is String){A=J;}else if(J is List){A=J.map((H)=>H.toString()).join(",");}if(B.pD){A+= ',:config';}else if(B.username!=HD.NK.username){A+= ',:user';}if(TQ!=null&&D.headers.value("X-Verification-Token")==TQ){var Q=D.headers.value("X-Permission-Group");if(Q!=null){A+= ',${Q}';}}if(A==null){A="user/${B.username}";}else{if(!A.endsWith(",")){A+= ",";}A+= "user/${B.username}";}}if(C!=null){if(X.vI.startsWith('ldap')&&B!=null&&B.username!=HD.NK.username&&B.metadata!=null&&B.metadata['isLdap']==true){var S=B.metadata['ldapGroups'] as List<String>;S.addAll(A.split(',').map((H)=>H.trim()));C.OC.BK(S);}else if(A!=null&&A.isNotEmpty){C.OC.BK(A.split(",").map((H)=>H.trim()).toList());}if(C.bg!=null){kZB.A$(C.vD,C.bg);C.bg=null;}if(I&&K!=null&&M!=null){eM.dQ.eE(M,"connected");}C.Lr(D,I,cDB.fDB);}else{throw HttpStatus.UNAUTHORIZED;}}void RTB(WK A){String B='${A.vD} ${A.session}';kZB.EJ(A,B);}}class cL extends StreamView<List<int>>{cL(Stream<List<int>> A):super(A);factory cL.YWB(List<int> A)=>new cL(new Stream.fromIterable([A]));Future<Uint8List> toBytes(){var A=new Completer<Uint8List>();var B=new ByteConversionSink.withCallback((C)=>A.complete(new Uint8List.fromList(C)));listen(B.add,onError:A.completeError,onDone:B.close,cancelOnError:true);return A.future;}}typedef RX WAB<RX,wB>(wB _0);typedef bool XAB(Object _0);class Su<RX,wB,dB> implements Map<wB,dB>{final WAB<RX,wB> lZB;final XAB mZB;final nZB=new Map<RX,ca<wB,dB>>();Su.wVB(Map<wB,dB> A,RX B(wB key),{bool isValidKey(Object key)}):lZB=B,mZB=isValidKey{addAll(A);}dB operator[](Object A){if(!oZB(A))return null;var B=nZB[lZB(A as wB)];return B==null?null:B.last;}void operator[]=(wB A,dB B){if(!oZB(A))return;nZB[lZB(A)]=new ca(A,B);}void addAll(Map<wB,dB> A){A.forEach((B,C)=>this[B]=C);}void clear(){nZB.clear();}bool containsKey(Object A){if(!oZB(A))return false;return nZB.containsKey(lZB(A as wB));}bool containsValue(Object A)=>nZB.values.any((B)=>B.last==A);void forEach(void B(wB key,dB value)){nZB.forEach((C,A)=>B(A.first,A.last));}bool get isEmpty=>nZB.isEmpty;bool get isNotEmpty=>nZB.isNotEmpty;Iterable<wB> get keys=>nZB.values.map((A)=>A.first);int get length=>nZB.length;dB putIfAbsent(wB A,dB B()){return nZB.putIfAbsent(lZB(A),()=>new ca(A,B())).last;}dB remove(Object A){if(!oZB(A))return null;var B=nZB.remove(lZB(A as wB));return B==null?null:B.last;}Iterable<dB> get values=>nZB.values.map((A)=>A.last);String toString()=>Maps.mapToString(this);bool oZB(Object A)=>(A==null||A is wB)&&(mZB==null||mZB(A));}class vl<dB> extends Su<String,String,dB>{vl.aWB(Map<String,dB> B):super.wVB(B,(A)=>A.toLowerCase(),isValidKey:(A)=>A!=null);}final S3=new Object();class hC implements StackTrace{final List<IC> PO;static wc get tc=>Zone.current[S3];static PKB(C(),{void onError(error,hC chain),bool when: true}){if(!when){var D;if(onError!=null){D=(B,A){onError(B,A==null?new hC.AXB():new hC.BXB(A));};}return runZoned(C,onError:D);}var G=new wc(onError);return runZoned((){try {return C();}catch (B,A){return Zone.current.handleUncaughtError(B,A);}},zoneSpecification:G.mUB(),zoneValues:{S3:G,wc.V3:false}) as dynamic;}factory hC.AXB([int A=0]){if(tc!=null)return tc.OQB(A+1);var B=new hC.BXB(StackTrace.current);return new vc((){var C=new IC(B.PO.first.GI.skip(A+(X3?2:1)));return new hC([C]..addAll(B.PO.skip(1)));});}factory hC.BXB(StackTrace A){if(A is hC)return A;if(tc!=null)return tc.W7(A);return new vc(()=>new hC.CXB(A.toString()));}factory hC.CXB(String A){if(A.isEmpty)return new hC([] );if(A.contains(yc)){return new hC(A.split(yc).map((B)=>new IC.JXB(B)));}if(!A.contains(xc))return new hC([new IC.IXB(A)]);return new hC(A.split(xc).map((B)=>new IC.NXB(B)));}hC(Iterable<IC> A):PO=new List<IC>.unmodifiable(A);hC get YS=>jP((A)=>false,terse:true);hC jP(bool D(uC frame),{bool terse: false}){var B=PO.map((A)=>A.jP(D,terse:terse));var C=B.where((A){if(A.GI.length>1)return true;if(A.GI.isEmpty)return false;if(!terse)return false;return A.GI.single.line!=null;});if(C.isEmpty&&B.isNotEmpty){return new hC([B.last]);}return new hC(C);}IC Lh()=>new IC(PO.expand((A)=>A.GI));String toString(){var C=PO.map((B){return B.GI.map((A)=>A.location.length).fold(0,LJ.max);}).fold(0,LJ.max);return PO.map((B){return B.GI.map((A){return '${A.location.padRight(C)}  ${A.HM}\n';}).join();}).join(xc);}}const hI=0x2e;const fJ=0x2f;const dm=0x3a;const h2=0x41;const i2=0x5a;const j2=0x61;const k2=0x7a;const kT=0x5c;const int Pu=0x09;const int Ci=0x0A;const int Qu=0x0D;const int MAB=0x20;const int Di=0x2B;const int Ei=0x2D;const int Ya=0x2E;const int cO=0x30;const int Za=0x39;const int NAB=0x46;const int OAB=0x4E;const int PAB=0x54;const int Fi=0x61;const int Ru=0x66;const int QAB=0x6E;const int RAB=0x6F;const int SAB=0x74;const int UAB=0x78;const int VAB=0x7E;abstract class kH{}abstract class gk{}abstract class F0 implements gk{}abstract class G0 implements gk{}class ob<nn extends F0,dB extends G0>{final nn pF;final dB dE;ob(this.pF,this.dE);}abstract class zFB{}abstract class jO{static final yFB=new AGB<jO>();factory jO([String A=""])=>yFB.create(A);}abstract class E0{}abstract class D0{}abstract class VL{}abstract class kM{}abstract class wE{}abstract class H0{}abstract class hk implements gk{final VL parameters;hk(this.parameters);}class lH extends hk implements G0{final n sJ;lH(this.sJ,VL A):super(A);bool operator==(A){if(A==null)return false;if(A is!lH)return false;return (A.parameters==this.parameters)&&(A.sJ==this.sJ);}int get hashCode{return parameters.hashCode+sJ.hashCode;}}class wF extends hk implements F0{final wE hK;wF(this.hK,VL A):super(A);bool operator==(A){if(A==null)return false;if(A is!wF)return false;return (A.parameters==this.parameters)&&(A.hK==this.hK);}int get hashCode{return parameters.hashCode+hK.hashCode;}}class AGB<Y>{final pZB=new Map<String,Function>();final qZB=new List<Function>();operator[]=(String A,Y B(String))=>zTB(A,B);void zTB(String A,Y B(String)){pZB[A]=B;}Y create(String A){var B=pZB[A];if(B!=null){return B(A);}else{for(B in qZB){var C=B(A);if(C!=null){return C;}}}throw new UnsupportedError("No algorithm with that name registered: ${A}");}}class kO extends GGB{static const I0=16;bool rZB;List<List<int>> sZB;int tZB;int uZB;int vZB;int wZB;int xZB;int get blockSize=>I0;void reset(){tZB=0;uZB=vZB=wZB=xZB=0;rZB=false;sZB=null;}void init(bool J,kH K){var H=(K as mO).key;int B=(H.lengthInBytes/4).floor();if(((B!=4)&&(B!=6)&&(B!=8))||((B*4)!=H.lengthInBytes)){throw new ArgumentError("Key length must be 128/192/256 bits");}this.rZB=J;tZB=B+6;sZB=new List.generate(tZB+1,(int A)=>new List<int>(4));var M=new ByteData.view((K as mO).key.buffer);for(var A=0,I=0;A<H.lengthInBytes;A+= 4,I++ ){var C=OT(M,A,Endianness.LITTLE_ENDIAN);sZB[I>>2][I&3]=C;}int N=(tZB+1)<<2;for(int A=B;A<N;A++ ){int D=sZB[(A-1)>>2][(A-1)&3].toInt();if((A%B)==0){D=J0(pb(D,8))^FGB[((A/B)-1).floor()];}else if((B>6)&&((A%B)==4)){D=J0(D);}var C=sZB[(A-B)>>2][(A-B)&3]^D;sZB[A>>2][A&3]=C;}if(!J){for(var G=1;G<tZB;G++ ){for(var A=0;A<4;A++ ){var C=EGB(sZB[G][A].toInt());sZB[G][A]=C;}}}}int PS(Uint8List C,int A,Uint8List D,int B){if(sZB==null){throw new StateError("AES engine not initialised");}if((A+(32/2))>C.lengthInBytes){throw new ArgumentError("Input buffer too short");}if((B+(32/2))>D.lengthInBytes){throw new ArgumentError("Output buffer too short");}var G=new ByteData.view(C.buffer);var H=new ByteData.view(D.buffer);if(rZB){yZB(G,A);zZB(sZB);AaB(H,B);}else{yZB(G,A);BaB(sZB);AaB(H,B);}return I0;}void zZB(List<List<int>> B){int A,C,D,G,H;uZB^= B[0][0].toInt();vZB^= B[0][1].toInt();wZB^= B[0][2].toInt();xZB^= B[0][3].toInt();A=1;while(A<tZB-1){C=UJ[uZB&255]^VJ[(vZB>>8)&255]^WJ[(wZB>>16)&255]^XJ[(xZB>>24)&255]^B[A][0].toInt();D=UJ[vZB&255]^VJ[(wZB>>8)&255]^WJ[(xZB>>16)&255]^XJ[(uZB>>24)&255]^B[A][1].toInt();G=UJ[wZB&255]^VJ[(xZB>>8)&255]^WJ[(uZB>>16)&255]^XJ[(vZB>>24)&255]^B[A][2].toInt();H=UJ[xZB&255]^VJ[(uZB>>8)&255]^WJ[(vZB>>16)&255]^XJ[(wZB>>24)&255]^B[A][3].toInt();A++ ;uZB=UJ[C&255]^VJ[(D>>8)&255]^WJ[(G>>16)&255]^XJ[(H>>24)&255]^B[A][0].toInt();vZB=UJ[D&255]^VJ[(G>>8)&255]^WJ[(H>>16)&255]^XJ[(C>>24)&255]^B[A][1].toInt();wZB=UJ[G&255]^VJ[(H>>8)&255]^WJ[(C>>16)&255]^XJ[(D>>24)&255]^B[A][2].toInt();xZB=UJ[H&255]^VJ[(C>>8)&255]^WJ[(D>>16)&255]^XJ[(G>>24)&255]^B[A][3].toInt();A++ ;}C=UJ[uZB&255]^VJ[(vZB>>8)&255]^WJ[(wZB>>16)&255]^XJ[(xZB>>24)&255]^B[A][0].toInt();D=UJ[vZB&255]^VJ[(wZB>>8)&255]^WJ[(xZB>>16)&255]^XJ[(uZB>>24)&255]^B[A][1].toInt();G=UJ[wZB&255]^VJ[(xZB>>8)&255]^WJ[(uZB>>16)&255]^XJ[(vZB>>24)&255]^B[A][2].toInt();H=UJ[xZB&255]^VJ[(uZB>>8)&255]^WJ[(vZB>>16)&255]^XJ[(wZB>>24)&255]^B[A][3].toInt();A++ ;uZB=(xE[C&255]&255)^((xE[(D>>8)&255]&255)<<8)^((xE[(G>>16)&255]&255)<<16)^(xE[(H>>24)&255]<<24)^B[A][0].toInt();vZB=(xE[D&255]&255)^((xE[(G>>8)&255]&255)<<8)^((xE[(H>>16)&255]&255)<<16)^(xE[(C>>24)&255]<<24)^B[A][1].toInt();wZB=(xE[G&255]&255)^((xE[(H>>8)&255]&255)<<8)^((xE[(C>>16)&255]&255)<<16)^(xE[(D>>24)&255]<<24)^B[A][2].toInt();xZB=(xE[H&255]&255)^((xE[(C>>8)&255]&255)<<8)^((xE[(D>>16)&255]&255)<<16)^(xE[(G>>24)&255]<<24)^B[A][3].toInt();}void BaB(List<List<int>> A){int B,C,D,G,H;uZB^= A[tZB][0].toInt();vZB^= A[tZB][1].toInt();wZB^= A[tZB][2].toInt();xZB^= A[tZB][3].toInt();B=tZB-1;while(B>1){C=YJ[uZB&255]^ZJ[(xZB>>8)&255]^aJ[(wZB>>16)&255]^bJ[(vZB>>24)&255]^A[B][0].toInt();D=YJ[vZB&255]^ZJ[(uZB>>8)&255]^aJ[(xZB>>16)&255]^bJ[(wZB>>24)&255]^A[B][1].toInt();G=YJ[wZB&255]^ZJ[(vZB>>8)&255]^aJ[(uZB>>16)&255]^bJ[(xZB>>24)&255]^A[B][2].toInt();H=YJ[xZB&255]^ZJ[(wZB>>8)&255]^aJ[(vZB>>16)&255]^bJ[(uZB>>24)&255]^A[B][3].toInt();B-- ;uZB=YJ[C&255]^ZJ[(H>>8)&255]^aJ[(G>>16)&255]^bJ[(D>>24)&255]^A[B][0].toInt();vZB=YJ[D&255]^ZJ[(C>>8)&255]^aJ[(H>>16)&255]^bJ[(G>>24)&255]^A[B][1].toInt();wZB=YJ[G&255]^ZJ[(D>>8)&255]^aJ[(C>>16)&255]^bJ[(H>>24)&255]^A[B][2].toInt();xZB=YJ[H&255]^ZJ[(G>>8)&255]^aJ[(D>>16)&255]^bJ[(C>>24)&255]^A[B][3].toInt();B-- ;}C=YJ[uZB&255]^ZJ[(xZB>>8)&255]^aJ[(wZB>>16)&255]^bJ[(vZB>>24)&255]^A[B][0].toInt();D=YJ[vZB&255]^ZJ[(uZB>>8)&255]^aJ[(xZB>>16)&255]^bJ[(wZB>>24)&255]^A[B][1].toInt();G=YJ[wZB&255]^ZJ[(vZB>>8)&255]^aJ[(uZB>>16)&255]^bJ[(xZB>>24)&255]^A[B][2].toInt();H=YJ[xZB&255]^ZJ[(wZB>>8)&255]^aJ[(vZB>>16)&255]^bJ[(uZB>>24)&255]^A[B][3].toInt();uZB=(YG[C&255]&255)^((YG[(H>>8)&255]&255)<<8)^((YG[(G>>16)&255]&255)<<16)^(YG[(D>>24)&255]<<24)^A[0][0].toInt();vZB=(YG[D&255]&255)^((YG[(C>>8)&255]&255)<<8)^((YG[(H>>16)&255]&255)<<16)^(YG[(G>>24)&255]<<24)^A[0][1].toInt();wZB=(YG[G&255]&255)^((YG[(D>>8)&255]&255)<<8)^((YG[(C>>16)&255]&255)<<16)^(YG[(H>>24)&255]<<24)^A[0][2].toInt();xZB=(YG[H&255]&255)^((YG[(G>>8)&255]&255)<<8)^((YG[(D>>16)&255]&255)<<16)^(YG[(C>>24)&255]<<24)^A[0][3].toInt();}void yZB(ByteData A,int B){uZB=OT(A,B,Endianness.LITTLE_ENDIAN);vZB=OT(A,B+4,Endianness.LITTLE_ENDIAN);wZB=OT(A,B+8,Endianness.LITTLE_ENDIAN);xZB=OT(A,B+12,Endianness.LITTLE_ENDIAN);}void AaB(ByteData A,int B){PW(uZB,A,B,Endianness.LITTLE_ENDIAN);PW(vZB,A,B+4,Endianness.LITTLE_ENDIAN);PW(wZB,A,B+8,Endianness.LITTLE_ENDIAN);PW(xZB,A,B+12,Endianness.LITTLE_ENDIAN);}}int pb(int A,int B)=>XK(A,B);const int BGB=0x80808080;const int CGB=0x7f7f7f7f;const int DGB=0x0000001b;int ik(int A){var B=ok((A&BGB),7);return (((A&CGB)<<1)^B*DGB);}int EGB(int D){int A=ik(D);int B=ik(A);int G=ik(B);int C=D^G;return A^B^G^pb(A^C,8)^pb(B^C,16)^pb(C,24);}int J0(int A){return (xE[A&255]&255|((xE[(A>>8)&255]&255)<<8)|((xE[(A>>16)&255]&255)<<16)|xE[(A>>24)&255]<<24);}final xE=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];final YG=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125];final FGB=[0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x1b,0x36,0x6c,0xd8,0xab,0x4d,0x9a,0x2f,0x5e,0xbc,0x63,0xc6,0x97,0x35,0x6a,0xd4,0xb3,0x7d,0xfa,0xef,0xc5,0x91];final UJ=[0xa56363c6,0x847c7cf8,0x997777ee,0x8d7b7bf6,0x0df2f2ff,0xbd6b6bd6,0xb16f6fde,0x54c5c591,0x50303060,0x03010102,0xa96767ce,0x7d2b2b56,0x19fefee7,0x62d7d7b5,0xe6abab4d,0x9a7676ec,0x45caca8f,0x9d82821f,0x40c9c989,0x877d7dfa,0x15fafaef,0xeb5959b2,0xc947478e,0x0bf0f0fb,0xecadad41,0x67d4d4b3,0xfda2a25f,0xeaafaf45,0xbf9c9c23,0xf7a4a453,0x967272e4,0x5bc0c09b,0xc2b7b775,0x1cfdfde1,0xae93933d,0x6a26264c,0x5a36366c,0x413f3f7e,0x02f7f7f5,0x4fcccc83,0x5c343468,0xf4a5a551,0x34e5e5d1,0x08f1f1f9,0x937171e2,0x73d8d8ab,0x53313162,0x3f15152a,0x0c040408,0x52c7c795,0x65232346,0x5ec3c39d,0x28181830,0xa1969637,0x0f05050a,0xb59a9a2f,0x0907070e,0x36121224,0x9b80801b,0x3de2e2df,0x26ebebcd,0x6927274e,0xcdb2b27f,0x9f7575ea,0x1b090912,0x9e83831d,0x742c2c58,0x2e1a1a34,0x2d1b1b36,0xb26e6edc,0xee5a5ab4,0xfba0a05b,0xf65252a4,0x4d3b3b76,0x61d6d6b7,0xceb3b37d,0x7b292952,0x3ee3e3dd,0x712f2f5e,0x97848413,0xf55353a6,0x68d1d1b9,0x00000000,0x2cededc1,0x60202040,0x1ffcfce3,0xc8b1b179,0xed5b5bb6,0xbe6a6ad4,0x46cbcb8d,0xd9bebe67,0x4b393972,0xde4a4a94,0xd44c4c98,0xe85858b0,0x4acfcf85,0x6bd0d0bb,0x2aefefc5,0xe5aaaa4f,0x16fbfbed,0xc5434386,0xd74d4d9a,0x55333366,0x94858511,0xcf45458a,0x10f9f9e9,0x06020204,0x817f7ffe,0xf05050a0,0x443c3c78,0xba9f9f25,0xe3a8a84b,0xf35151a2,0xfea3a35d,0xc0404080,0x8a8f8f05,0xad92923f,0xbc9d9d21,0x48383870,0x04f5f5f1,0xdfbcbc63,0xc1b6b677,0x75dadaaf,0x63212142,0x30101020,0x1affffe5,0x0ef3f3fd,0x6dd2d2bf,0x4ccdcd81,0x140c0c18,0x35131326,0x2fececc3,0xe15f5fbe,0xa2979735,0xcc444488,0x3917172e,0x57c4c493,0xf2a7a755,0x827e7efc,0x473d3d7a,0xac6464c8,0xe75d5dba,0x2b191932,0x957373e6,0xa06060c0,0x98818119,0xd14f4f9e,0x7fdcdca3,0x66222244,0x7e2a2a54,0xab90903b,0x8388880b,0xca46468c,0x29eeeec7,0xd3b8b86b,0x3c141428,0x79dedea7,0xe25e5ebc,0x1d0b0b16,0x76dbdbad,0x3be0e0db,0x56323264,0x4e3a3a74,0x1e0a0a14,0xdb494992,0x0a06060c,0x6c242448,0xe45c5cb8,0x5dc2c29f,0x6ed3d3bd,0xefacac43,0xa66262c4,0xa8919139,0xa4959531,0x37e4e4d3,0x8b7979f2,0x32e7e7d5,0x43c8c88b,0x5937376e,0xb76d6dda,0x8c8d8d01,0x64d5d5b1,0xd24e4e9c,0xe0a9a949,0xb46c6cd8,0xfa5656ac,0x07f4f4f3,0x25eaeacf,0xaf6565ca,0x8e7a7af4,0xe9aeae47,0x18080810,0xd5baba6f,0x887878f0,0x6f25254a,0x722e2e5c,0x241c1c38,0xf1a6a657,0xc7b4b473,0x51c6c697,0x23e8e8cb,0x7cdddda1,0x9c7474e8,0x211f1f3e,0xdd4b4b96,0xdcbdbd61,0x868b8b0d,0x858a8a0f,0x907070e0,0x423e3e7c,0xc4b5b571,0xaa6666cc,0xd8484890,0x05030306,0x01f6f6f7,0x120e0e1c,0xa36161c2,0x5f35356a,0xf95757ae,0xd0b9b969,0x91868617,0x58c1c199,0x271d1d3a,0xb99e9e27,0x38e1e1d9,0x13f8f8eb,0xb398982b,0x33111122,0xbb6969d2,0x70d9d9a9,0x898e8e07,0xa7949433,0xb69b9b2d,0x221e1e3c,0x92878715,0x20e9e9c9,0x49cece87,0xff5555aa,0x78282850,0x7adfdfa5,0x8f8c8c03,0xf8a1a159,0x80898909,0x170d0d1a,0xdabfbf65,0x31e6e6d7,0xc6424284,0xb86868d0,0xc3414182,0xb0999929,0x772d2d5a,0x110f0f1e,0xcbb0b07b,0xfc5454a8,0xd6bbbb6d,0x3a16162c];final VJ=[0x6363c6a5,0x7c7cf884,0x7777ee99,0x7b7bf68d,0xf2f2ff0d,0x6b6bd6bd,0x6f6fdeb1,0xc5c59154,0x30306050,0x01010203,0x6767cea9,0x2b2b567d,0xfefee719,0xd7d7b562,0xabab4de6,0x7676ec9a,0xcaca8f45,0x82821f9d,0xc9c98940,0x7d7dfa87,0xfafaef15,0x5959b2eb,0x47478ec9,0xf0f0fb0b,0xadad41ec,0xd4d4b367,0xa2a25ffd,0xafaf45ea,0x9c9c23bf,0xa4a453f7,0x7272e496,0xc0c09b5b,0xb7b775c2,0xfdfde11c,0x93933dae,0x26264c6a,0x36366c5a,0x3f3f7e41,0xf7f7f502,0xcccc834f,0x3434685c,0xa5a551f4,0xe5e5d134,0xf1f1f908,0x7171e293,0xd8d8ab73,0x31316253,0x15152a3f,0x0404080c,0xc7c79552,0x23234665,0xc3c39d5e,0x18183028,0x969637a1,0x05050a0f,0x9a9a2fb5,0x07070e09,0x12122436,0x80801b9b,0xe2e2df3d,0xebebcd26,0x27274e69,0xb2b27fcd,0x7575ea9f,0x0909121b,0x83831d9e,0x2c2c5874,0x1a1a342e,0x1b1b362d,0x6e6edcb2,0x5a5ab4ee,0xa0a05bfb,0x5252a4f6,0x3b3b764d,0xd6d6b761,0xb3b37dce,0x2929527b,0xe3e3dd3e,0x2f2f5e71,0x84841397,0x5353a6f5,0xd1d1b968,0x00000000,0xededc12c,0x20204060,0xfcfce31f,0xb1b179c8,0x5b5bb6ed,0x6a6ad4be,0xcbcb8d46,0xbebe67d9,0x3939724b,0x4a4a94de,0x4c4c98d4,0x5858b0e8,0xcfcf854a,0xd0d0bb6b,0xefefc52a,0xaaaa4fe5,0xfbfbed16,0x434386c5,0x4d4d9ad7,0x33336655,0x85851194,0x45458acf,0xf9f9e910,0x02020406,0x7f7ffe81,0x5050a0f0,0x3c3c7844,0x9f9f25ba,0xa8a84be3,0x5151a2f3,0xa3a35dfe,0x404080c0,0x8f8f058a,0x92923fad,0x9d9d21bc,0x38387048,0xf5f5f104,0xbcbc63df,0xb6b677c1,0xdadaaf75,0x21214263,0x10102030,0xffffe51a,0xf3f3fd0e,0xd2d2bf6d,0xcdcd814c,0x0c0c1814,0x13132635,0xececc32f,0x5f5fbee1,0x979735a2,0x444488cc,0x17172e39,0xc4c49357,0xa7a755f2,0x7e7efc82,0x3d3d7a47,0x6464c8ac,0x5d5dbae7,0x1919322b,0x7373e695,0x6060c0a0,0x81811998,0x4f4f9ed1,0xdcdca37f,0x22224466,0x2a2a547e,0x90903bab,0x88880b83,0x46468cca,0xeeeec729,0xb8b86bd3,0x1414283c,0xdedea779,0x5e5ebce2,0x0b0b161d,0xdbdbad76,0xe0e0db3b,0x32326456,0x3a3a744e,0x0a0a141e,0x494992db,0x06060c0a,0x2424486c,0x5c5cb8e4,0xc2c29f5d,0xd3d3bd6e,0xacac43ef,0x6262c4a6,0x919139a8,0x959531a4,0xe4e4d337,0x7979f28b,0xe7e7d532,0xc8c88b43,0x37376e59,0x6d6ddab7,0x8d8d018c,0xd5d5b164,0x4e4e9cd2,0xa9a949e0,0x6c6cd8b4,0x5656acfa,0xf4f4f307,0xeaeacf25,0x6565caaf,0x7a7af48e,0xaeae47e9,0x08081018,0xbaba6fd5,0x7878f088,0x25254a6f,0x2e2e5c72,0x1c1c3824,0xa6a657f1,0xb4b473c7,0xc6c69751,0xe8e8cb23,0xdddda17c,0x7474e89c,0x1f1f3e21,0x4b4b96dd,0xbdbd61dc,0x8b8b0d86,0x8a8a0f85,0x7070e090,0x3e3e7c42,0xb5b571c4,0x6666ccaa,0x484890d8,0x03030605,0xf6f6f701,0x0e0e1c12,0x6161c2a3,0x35356a5f,0x5757aef9,0xb9b969d0,0x86861791,0xc1c19958,0x1d1d3a27,0x9e9e27b9,0xe1e1d938,0xf8f8eb13,0x98982bb3,0x11112233,0x6969d2bb,0xd9d9a970,0x8e8e0789,0x949433a7,0x9b9b2db6,0x1e1e3c22,0x87871592,0xe9e9c920,0xcece8749,0x5555aaff,0x28285078,0xdfdfa57a,0x8c8c038f,0xa1a159f8,0x89890980,0x0d0d1a17,0xbfbf65da,0xe6e6d731,0x424284c6,0x6868d0b8,0x414182c3,0x999929b0,0x2d2d5a77,0x0f0f1e11,0xb0b07bcb,0x5454a8fc,0xbbbb6dd6,0x16162c3a];final WJ=[0x63c6a563,0x7cf8847c,0x77ee9977,0x7bf68d7b,0xf2ff0df2,0x6bd6bd6b,0x6fdeb16f,0xc59154c5,0x30605030,0x01020301,0x67cea967,0x2b567d2b,0xfee719fe,0xd7b562d7,0xab4de6ab,0x76ec9a76,0xca8f45ca,0x821f9d82,0xc98940c9,0x7dfa877d,0xfaef15fa,0x59b2eb59,0x478ec947,0xf0fb0bf0,0xad41ecad,0xd4b367d4,0xa25ffda2,0xaf45eaaf,0x9c23bf9c,0xa453f7a4,0x72e49672,0xc09b5bc0,0xb775c2b7,0xfde11cfd,0x933dae93,0x264c6a26,0x366c5a36,0x3f7e413f,0xf7f502f7,0xcc834fcc,0x34685c34,0xa551f4a5,0xe5d134e5,0xf1f908f1,0x71e29371,0xd8ab73d8,0x31625331,0x152a3f15,0x04080c04,0xc79552c7,0x23466523,0xc39d5ec3,0x18302818,0x9637a196,0x050a0f05,0x9a2fb59a,0x070e0907,0x12243612,0x801b9b80,0xe2df3de2,0xebcd26eb,0x274e6927,0xb27fcdb2,0x75ea9f75,0x09121b09,0x831d9e83,0x2c58742c,0x1a342e1a,0x1b362d1b,0x6edcb26e,0x5ab4ee5a,0xa05bfba0,0x52a4f652,0x3b764d3b,0xd6b761d6,0xb37dceb3,0x29527b29,0xe3dd3ee3,0x2f5e712f,0x84139784,0x53a6f553,0xd1b968d1,0x00000000,0xedc12ced,0x20406020,0xfce31ffc,0xb179c8b1,0x5bb6ed5b,0x6ad4be6a,0xcb8d46cb,0xbe67d9be,0x39724b39,0x4a94de4a,0x4c98d44c,0x58b0e858,0xcf854acf,0xd0bb6bd0,0xefc52aef,0xaa4fe5aa,0xfbed16fb,0x4386c543,0x4d9ad74d,0x33665533,0x85119485,0x458acf45,0xf9e910f9,0x02040602,0x7ffe817f,0x50a0f050,0x3c78443c,0x9f25ba9f,0xa84be3a8,0x51a2f351,0xa35dfea3,0x4080c040,0x8f058a8f,0x923fad92,0x9d21bc9d,0x38704838,0xf5f104f5,0xbc63dfbc,0xb677c1b6,0xdaaf75da,0x21426321,0x10203010,0xffe51aff,0xf3fd0ef3,0xd2bf6dd2,0xcd814ccd,0x0c18140c,0x13263513,0xecc32fec,0x5fbee15f,0x9735a297,0x4488cc44,0x172e3917,0xc49357c4,0xa755f2a7,0x7efc827e,0x3d7a473d,0x64c8ac64,0x5dbae75d,0x19322b19,0x73e69573,0x60c0a060,0x81199881,0x4f9ed14f,0xdca37fdc,0x22446622,0x2a547e2a,0x903bab90,0x880b8388,0x468cca46,0xeec729ee,0xb86bd3b8,0x14283c14,0xdea779de,0x5ebce25e,0x0b161d0b,0xdbad76db,0xe0db3be0,0x32645632,0x3a744e3a,0x0a141e0a,0x4992db49,0x060c0a06,0x24486c24,0x5cb8e45c,0xc29f5dc2,0xd3bd6ed3,0xac43efac,0x62c4a662,0x9139a891,0x9531a495,0xe4d337e4,0x79f28b79,0xe7d532e7,0xc88b43c8,0x376e5937,0x6ddab76d,0x8d018c8d,0xd5b164d5,0x4e9cd24e,0xa949e0a9,0x6cd8b46c,0x56acfa56,0xf4f307f4,0xeacf25ea,0x65caaf65,0x7af48e7a,0xae47e9ae,0x08101808,0xba6fd5ba,0x78f08878,0x254a6f25,0x2e5c722e,0x1c38241c,0xa657f1a6,0xb473c7b4,0xc69751c6,0xe8cb23e8,0xdda17cdd,0x74e89c74,0x1f3e211f,0x4b96dd4b,0xbd61dcbd,0x8b0d868b,0x8a0f858a,0x70e09070,0x3e7c423e,0xb571c4b5,0x66ccaa66,0x4890d848,0x03060503,0xf6f701f6,0x0e1c120e,0x61c2a361,0x356a5f35,0x57aef957,0xb969d0b9,0x86179186,0xc19958c1,0x1d3a271d,0x9e27b99e,0xe1d938e1,0xf8eb13f8,0x982bb398,0x11223311,0x69d2bb69,0xd9a970d9,0x8e07898e,0x9433a794,0x9b2db69b,0x1e3c221e,0x87159287,0xe9c920e9,0xce8749ce,0x55aaff55,0x28507828,0xdfa57adf,0x8c038f8c,0xa159f8a1,0x89098089,0x0d1a170d,0xbf65dabf,0xe6d731e6,0x4284c642,0x68d0b868,0x4182c341,0x9929b099,0x2d5a772d,0x0f1e110f,0xb07bcbb0,0x54a8fc54,0xbb6dd6bb,0x162c3a16];final XJ=[0xc6a56363,0xf8847c7c,0xee997777,0xf68d7b7b,0xff0df2f2,0xd6bd6b6b,0xdeb16f6f,0x9154c5c5,0x60503030,0x02030101,0xcea96767,0x567d2b2b,0xe719fefe,0xb562d7d7,0x4de6abab,0xec9a7676,0x8f45caca,0x1f9d8282,0x8940c9c9,0xfa877d7d,0xef15fafa,0xb2eb5959,0x8ec94747,0xfb0bf0f0,0x41ecadad,0xb367d4d4,0x5ffda2a2,0x45eaafaf,0x23bf9c9c,0x53f7a4a4,0xe4967272,0x9b5bc0c0,0x75c2b7b7,0xe11cfdfd,0x3dae9393,0x4c6a2626,0x6c5a3636,0x7e413f3f,0xf502f7f7,0x834fcccc,0x685c3434,0x51f4a5a5,0xd134e5e5,0xf908f1f1,0xe2937171,0xab73d8d8,0x62533131,0x2a3f1515,0x080c0404,0x9552c7c7,0x46652323,0x9d5ec3c3,0x30281818,0x37a19696,0x0a0f0505,0x2fb59a9a,0x0e090707,0x24361212,0x1b9b8080,0xdf3de2e2,0xcd26ebeb,0x4e692727,0x7fcdb2b2,0xea9f7575,0x121b0909,0x1d9e8383,0x58742c2c,0x342e1a1a,0x362d1b1b,0xdcb26e6e,0xb4ee5a5a,0x5bfba0a0,0xa4f65252,0x764d3b3b,0xb761d6d6,0x7dceb3b3,0x527b2929,0xdd3ee3e3,0x5e712f2f,0x13978484,0xa6f55353,0xb968d1d1,0x00000000,0xc12ceded,0x40602020,0xe31ffcfc,0x79c8b1b1,0xb6ed5b5b,0xd4be6a6a,0x8d46cbcb,0x67d9bebe,0x724b3939,0x94de4a4a,0x98d44c4c,0xb0e85858,0x854acfcf,0xbb6bd0d0,0xc52aefef,0x4fe5aaaa,0xed16fbfb,0x86c54343,0x9ad74d4d,0x66553333,0x11948585,0x8acf4545,0xe910f9f9,0x04060202,0xfe817f7f,0xa0f05050,0x78443c3c,0x25ba9f9f,0x4be3a8a8,0xa2f35151,0x5dfea3a3,0x80c04040,0x058a8f8f,0x3fad9292,0x21bc9d9d,0x70483838,0xf104f5f5,0x63dfbcbc,0x77c1b6b6,0xaf75dada,0x42632121,0x20301010,0xe51affff,0xfd0ef3f3,0xbf6dd2d2,0x814ccdcd,0x18140c0c,0x26351313,0xc32fecec,0xbee15f5f,0x35a29797,0x88cc4444,0x2e391717,0x9357c4c4,0x55f2a7a7,0xfc827e7e,0x7a473d3d,0xc8ac6464,0xbae75d5d,0x322b1919,0xe6957373,0xc0a06060,0x19988181,0x9ed14f4f,0xa37fdcdc,0x44662222,0x547e2a2a,0x3bab9090,0x0b838888,0x8cca4646,0xc729eeee,0x6bd3b8b8,0x283c1414,0xa779dede,0xbce25e5e,0x161d0b0b,0xad76dbdb,0xdb3be0e0,0x64563232,0x744e3a3a,0x141e0a0a,0x92db4949,0x0c0a0606,0x486c2424,0xb8e45c5c,0x9f5dc2c2,0xbd6ed3d3,0x43efacac,0xc4a66262,0x39a89191,0x31a49595,0xd337e4e4,0xf28b7979,0xd532e7e7,0x8b43c8c8,0x6e593737,0xdab76d6d,0x018c8d8d,0xb164d5d5,0x9cd24e4e,0x49e0a9a9,0xd8b46c6c,0xacfa5656,0xf307f4f4,0xcf25eaea,0xcaaf6565,0xf48e7a7a,0x47e9aeae,0x10180808,0x6fd5baba,0xf0887878,0x4a6f2525,0x5c722e2e,0x38241c1c,0x57f1a6a6,0x73c7b4b4,0x9751c6c6,0xcb23e8e8,0xa17cdddd,0xe89c7474,0x3e211f1f,0x96dd4b4b,0x61dcbdbd,0x0d868b8b,0x0f858a8a,0xe0907070,0x7c423e3e,0x71c4b5b5,0xccaa6666,0x90d84848,0x06050303,0xf701f6f6,0x1c120e0e,0xc2a36161,0x6a5f3535,0xaef95757,0x69d0b9b9,0x17918686,0x9958c1c1,0x3a271d1d,0x27b99e9e,0xd938e1e1,0xeb13f8f8,0x2bb39898,0x22331111,0xd2bb6969,0xa970d9d9,0x07898e8e,0x33a79494,0x2db69b9b,0x3c221e1e,0x15928787,0xc920e9e9,0x8749cece,0xaaff5555,0x50782828,0xa57adfdf,0x038f8c8c,0x59f8a1a1,0x09808989,0x1a170d0d,0x65dabfbf,0xd731e6e6,0x84c64242,0xd0b86868,0x82c34141,0x29b09999,0x5a772d2d,0x1e110f0f,0x7bcbb0b0,0xa8fc5454,0x6dd6bbbb,0x2c3a1616];final YJ=[0x50a7f451,0x5365417e,0xc3a4171a,0x965e273a,0xcb6bab3b,0xf1459d1f,0xab58faac,0x9303e34b,0x55fa3020,0xf66d76ad,0x9176cc88,0x254c02f5,0xfcd7e54f,0xd7cb2ac5,0x80443526,0x8fa362b5,0x495ab1de,0x671bba25,0x980eea45,0xe1c0fe5d,0x02752fc3,0x12f04c81,0xa397468d,0xc6f9d36b,0xe75f8f03,0x959c9215,0xeb7a6dbf,0xda595295,0x2d83bed4,0xd3217458,0x2969e049,0x44c8c98e,0x6a89c275,0x78798ef4,0x6b3e5899,0xdd71b927,0xb64fe1be,0x17ad88f0,0x66ac20c9,0xb43ace7d,0x184adf63,0x82311ae5,0x60335197,0x457f5362,0xe07764b1,0x84ae6bbb,0x1ca081fe,0x942b08f9,0x58684870,0x19fd458f,0x876cde94,0xb7f87b52,0x23d373ab,0xe2024b72,0x578f1fe3,0x2aab5566,0x0728ebb2,0x03c2b52f,0x9a7bc586,0xa50837d3,0xf2872830,0xb2a5bf23,0xba6a0302,0x5c8216ed,0x2b1ccf8a,0x92b479a7,0xf0f207f3,0xa1e2694e,0xcdf4da65,0xd5be0506,0x1f6234d1,0x8afea6c4,0x9d532e34,0xa055f3a2,0x32e18a05,0x75ebf6a4,0x39ec830b,0xaaef6040,0x069f715e,0x51106ebd,0xf98a213e,0x3d06dd96,0xae053edd,0x46bde64d,0xb58d5491,0x055dc471,0x6fd40604,0xff155060,0x24fb9819,0x97e9bdd6,0xcc434089,0x779ed967,0xbd42e8b0,0x888b8907,0x385b19e7,0xdbeec879,0x470a7ca1,0xe90f427c,0xc91e84f8,0x00000000,0x83868009,0x48ed2b32,0xac70111e,0x4e725a6c,0xfbff0efd,0x5638850f,0x1ed5ae3d,0x27392d36,0x64d90f0a,0x21a65c68,0xd1545b9b,0x3a2e3624,0xb1670a0c,0x0fe75793,0xd296eeb4,0x9e919b1b,0x4fc5c080,0xa220dc61,0x694b775a,0x161a121c,0x0aba93e2,0xe52aa0c0,0x43e0223c,0x1d171b12,0x0b0d090e,0xadc78bf2,0xb9a8b62d,0xc8a91e14,0x8519f157,0x4c0775af,0xbbdd99ee,0xfd607fa3,0x9f2601f7,0xbcf5725c,0xc53b6644,0x347efb5b,0x7629438b,0xdcc623cb,0x68fcedb6,0x63f1e4b8,0xcadc31d7,0x10856342,0x40229713,0x2011c684,0x7d244a85,0xf83dbbd2,0x1132f9ae,0x6da129c7,0x4b2f9e1d,0xf330b2dc,0xec52860d,0xd0e3c177,0x6c16b32b,0x99b970a9,0xfa489411,0x2264e947,0xc48cfca8,0x1a3ff0a0,0xd82c7d56,0xef903322,0xc74e4987,0xc1d138d9,0xfea2ca8c,0x360bd498,0xcf81f5a6,0x28de7aa5,0x268eb7da,0xa4bfad3f,0xe49d3a2c,0x0d927850,0x9bcc5f6a,0x62467e54,0xc2138df6,0xe8b8d890,0x5ef7392e,0xf5afc382,0xbe805d9f,0x7c93d069,0xa92dd56f,0xb31225cf,0x3b99acc8,0xa77d1810,0x6e639ce8,0x7bbb3bdb,0x097826cd,0xf418596e,0x01b79aec,0xa89a4f83,0x656e95e6,0x7ee6ffaa,0x08cfbc21,0xe6e815ef,0xd99be7ba,0xce366f4a,0xd4099fea,0xd67cb029,0xafb2a431,0x31233f2a,0x3094a5c6,0xc066a235,0x37bc4e74,0xa6ca82fc,0xb0d090e0,0x15d8a733,0x4a9804f1,0xf7daec41,0x0e50cd7f,0x2ff69117,0x8dd64d76,0x4db0ef43,0x544daacc,0xdf0496e4,0xe3b5d19e,0x1b886a4c,0xb81f2cc1,0x7f516546,0x04ea5e9d,0x5d358c01,0x737487fa,0x2e410bfb,0x5a1d67b3,0x52d2db92,0x335610e9,0x1347d66d,0x8c61d79a,0x7a0ca137,0x8e14f859,0x893c13eb,0xee27a9ce,0x35c961b7,0xede51ce1,0x3cb1477a,0x59dfd29c,0x3f73f255,0x79ce1418,0xbf37c773,0xeacdf753,0x5baafd5f,0x146f3ddf,0x86db4478,0x81f3afca,0x3ec468b9,0x2c342438,0x5f40a3c2,0x72c31d16,0x0c25e2bc,0x8b493c28,0x41950dff,0x7101a839,0xdeb30c08,0x9ce4b4d8,0x90c15664,0x6184cb7b,0x70b632d5,0x745c6c48,0x4257b8d0];final ZJ=[0xa7f45150,0x65417e53,0xa4171ac3,0x5e273a96,0x6bab3bcb,0x459d1ff1,0x58faacab,0x03e34b93,0xfa302055,0x6d76adf6,0x76cc8891,0x4c02f525,0xd7e54ffc,0xcb2ac5d7,0x44352680,0xa362b58f,0x5ab1de49,0x1bba2567,0x0eea4598,0xc0fe5de1,0x752fc302,0xf04c8112,0x97468da3,0xf9d36bc6,0x5f8f03e7,0x9c921595,0x7a6dbfeb,0x595295da,0x83bed42d,0x217458d3,0x69e04929,0xc8c98e44,0x89c2756a,0x798ef478,0x3e58996b,0x71b927dd,0x4fe1beb6,0xad88f017,0xac20c966,0x3ace7db4,0x4adf6318,0x311ae582,0x33519760,0x7f536245,0x7764b1e0,0xae6bbb84,0xa081fe1c,0x2b08f994,0x68487058,0xfd458f19,0x6cde9487,0xf87b52b7,0xd373ab23,0x024b72e2,0x8f1fe357,0xab55662a,0x28ebb207,0xc2b52f03,0x7bc5869a,0x0837d3a5,0x872830f2,0xa5bf23b2,0x6a0302ba,0x8216ed5c,0x1ccf8a2b,0xb479a792,0xf207f3f0,0xe2694ea1,0xf4da65cd,0xbe0506d5,0x6234d11f,0xfea6c48a,0x532e349d,0x55f3a2a0,0xe18a0532,0xebf6a475,0xec830b39,0xef6040aa,0x9f715e06,0x106ebd51,0x8a213ef9,0x06dd963d,0x053eddae,0xbde64d46,0x8d5491b5,0x5dc47105,0xd406046f,0x155060ff,0xfb981924,0xe9bdd697,0x434089cc,0x9ed96777,0x42e8b0bd,0x8b890788,0x5b19e738,0xeec879db,0x0a7ca147,0x0f427ce9,0x1e84f8c9,0x00000000,0x86800983,0xed2b3248,0x70111eac,0x725a6c4e,0xff0efdfb,0x38850f56,0xd5ae3d1e,0x392d3627,0xd90f0a64,0xa65c6821,0x545b9bd1,0x2e36243a,0x670a0cb1,0xe757930f,0x96eeb4d2,0x919b1b9e,0xc5c0804f,0x20dc61a2,0x4b775a69,0x1a121c16,0xba93e20a,0x2aa0c0e5,0xe0223c43,0x171b121d,0x0d090e0b,0xc78bf2ad,0xa8b62db9,0xa91e14c8,0x19f15785,0x0775af4c,0xdd99eebb,0x607fa3fd,0x2601f79f,0xf5725cbc,0x3b6644c5,0x7efb5b34,0x29438b76,0xc623cbdc,0xfcedb668,0xf1e4b863,0xdc31d7ca,0x85634210,0x22971340,0x11c68420,0x244a857d,0x3dbbd2f8,0x32f9ae11,0xa129c76d,0x2f9e1d4b,0x30b2dcf3,0x52860dec,0xe3c177d0,0x16b32b6c,0xb970a999,0x489411fa,0x64e94722,0x8cfca8c4,0x3ff0a01a,0x2c7d56d8,0x903322ef,0x4e4987c7,0xd138d9c1,0xa2ca8cfe,0x0bd49836,0x81f5a6cf,0xde7aa528,0x8eb7da26,0xbfad3fa4,0x9d3a2ce4,0x9278500d,0xcc5f6a9b,0x467e5462,0x138df6c2,0xb8d890e8,0xf7392e5e,0xafc382f5,0x805d9fbe,0x93d0697c,0x2dd56fa9,0x1225cfb3,0x99acc83b,0x7d1810a7,0x639ce86e,0xbb3bdb7b,0x7826cd09,0x18596ef4,0xb79aec01,0x9a4f83a8,0x6e95e665,0xe6ffaa7e,0xcfbc2108,0xe815efe6,0x9be7bad9,0x366f4ace,0x099fead4,0x7cb029d6,0xb2a431af,0x233f2a31,0x94a5c630,0x66a235c0,0xbc4e7437,0xca82fca6,0xd090e0b0,0xd8a73315,0x9804f14a,0xdaec41f7,0x50cd7f0e,0xf691172f,0xd64d768d,0xb0ef434d,0x4daacc54,0x0496e4df,0xb5d19ee3,0x886a4c1b,0x1f2cc1b8,0x5165467f,0xea5e9d04,0x358c015d,0x7487fa73,0x410bfb2e,0x1d67b35a,0xd2db9252,0x5610e933,0x47d66d13,0x61d79a8c,0x0ca1377a,0x14f8598e,0x3c13eb89,0x27a9ceee,0xc961b735,0xe51ce1ed,0xb1477a3c,0xdfd29c59,0x73f2553f,0xce141879,0x37c773bf,0xcdf753ea,0xaafd5f5b,0x6f3ddf14,0xdb447886,0xf3afca81,0xc468b93e,0x3424382c,0x40a3c25f,0xc31d1672,0x25e2bc0c,0x493c288b,0x950dff41,0x01a83971,0xb30c08de,0xe4b4d89c,0xc1566490,0x84cb7b61,0xb632d570,0x5c6c4874,0x57b8d042];final aJ=[0xf45150a7,0x417e5365,0x171ac3a4,0x273a965e,0xab3bcb6b,0x9d1ff145,0xfaacab58,0xe34b9303,0x302055fa,0x76adf66d,0xcc889176,0x02f5254c,0xe54ffcd7,0x2ac5d7cb,0x35268044,0x62b58fa3,0xb1de495a,0xba25671b,0xea45980e,0xfe5de1c0,0x2fc30275,0x4c8112f0,0x468da397,0xd36bc6f9,0x8f03e75f,0x9215959c,0x6dbfeb7a,0x5295da59,0xbed42d83,0x7458d321,0xe0492969,0xc98e44c8,0xc2756a89,0x8ef47879,0x58996b3e,0xb927dd71,0xe1beb64f,0x88f017ad,0x20c966ac,0xce7db43a,0xdf63184a,0x1ae58231,0x51976033,0x5362457f,0x64b1e077,0x6bbb84ae,0x81fe1ca0,0x08f9942b,0x48705868,0x458f19fd,0xde94876c,0x7b52b7f8,0x73ab23d3,0x4b72e202,0x1fe3578f,0x55662aab,0xebb20728,0xb52f03c2,0xc5869a7b,0x37d3a508,0x2830f287,0xbf23b2a5,0x0302ba6a,0x16ed5c82,0xcf8a2b1c,0x79a792b4,0x07f3f0f2,0x694ea1e2,0xda65cdf4,0x0506d5be,0x34d11f62,0xa6c48afe,0x2e349d53,0xf3a2a055,0x8a0532e1,0xf6a475eb,0x830b39ec,0x6040aaef,0x715e069f,0x6ebd5110,0x213ef98a,0xdd963d06,0x3eddae05,0xe64d46bd,0x5491b58d,0xc471055d,0x06046fd4,0x5060ff15,0x981924fb,0xbdd697e9,0x4089cc43,0xd967779e,0xe8b0bd42,0x8907888b,0x19e7385b,0xc879dbee,0x7ca1470a,0x427ce90f,0x84f8c91e,0x00000000,0x80098386,0x2b3248ed,0x111eac70,0x5a6c4e72,0x0efdfbff,0x850f5638,0xae3d1ed5,0x2d362739,0x0f0a64d9,0x5c6821a6,0x5b9bd154,0x36243a2e,0x0a0cb167,0x57930fe7,0xeeb4d296,0x9b1b9e91,0xc0804fc5,0xdc61a220,0x775a694b,0x121c161a,0x93e20aba,0xa0c0e52a,0x223c43e0,0x1b121d17,0x090e0b0d,0x8bf2adc7,0xb62db9a8,0x1e14c8a9,0xf1578519,0x75af4c07,0x99eebbdd,0x7fa3fd60,0x01f79f26,0x725cbcf5,0x6644c53b,0xfb5b347e,0x438b7629,0x23cbdcc6,0xedb668fc,0xe4b863f1,0x31d7cadc,0x63421085,0x97134022,0xc6842011,0x4a857d24,0xbbd2f83d,0xf9ae1132,0x29c76da1,0x9e1d4b2f,0xb2dcf330,0x860dec52,0xc177d0e3,0xb32b6c16,0x70a999b9,0x9411fa48,0xe9472264,0xfca8c48c,0xf0a01a3f,0x7d56d82c,0x3322ef90,0x4987c74e,0x38d9c1d1,0xca8cfea2,0xd498360b,0xf5a6cf81,0x7aa528de,0xb7da268e,0xad3fa4bf,0x3a2ce49d,0x78500d92,0x5f6a9bcc,0x7e546246,0x8df6c213,0xd890e8b8,0x392e5ef7,0xc382f5af,0x5d9fbe80,0xd0697c93,0xd56fa92d,0x25cfb312,0xacc83b99,0x1810a77d,0x9ce86e63,0x3bdb7bbb,0x26cd0978,0x596ef418,0x9aec01b7,0x4f83a89a,0x95e6656e,0xffaa7ee6,0xbc2108cf,0x15efe6e8,0xe7bad99b,0x6f4ace36,0x9fead409,0xb029d67c,0xa431afb2,0x3f2a3123,0xa5c63094,0xa235c066,0x4e7437bc,0x82fca6ca,0x90e0b0d0,0xa73315d8,0x04f14a98,0xec41f7da,0xcd7f0e50,0x91172ff6,0x4d768dd6,0xef434db0,0xaacc544d,0x96e4df04,0xd19ee3b5,0x6a4c1b88,0x2cc1b81f,0x65467f51,0x5e9d04ea,0x8c015d35,0x87fa7374,0x0bfb2e41,0x67b35a1d,0xdb9252d2,0x10e93356,0xd66d1347,0xd79a8c61,0xa1377a0c,0xf8598e14,0x13eb893c,0xa9ceee27,0x61b735c9,0x1ce1ede5,0x477a3cb1,0xd29c59df,0xf2553f73,0x141879ce,0xc773bf37,0xf753eacd,0xfd5f5baa,0x3ddf146f,0x447886db,0xafca81f3,0x68b93ec4,0x24382c34,0xa3c25f40,0x1d1672c3,0xe2bc0c25,0x3c288b49,0x0dff4195,0xa8397101,0x0c08deb3,0xb4d89ce4,0x566490c1,0xcb7b6184,0x32d570b6,0x6c48745c,0xb8d04257];final bJ=[0x5150a7f4,0x7e536541,0x1ac3a417,0x3a965e27,0x3bcb6bab,0x1ff1459d,0xacab58fa,0x4b9303e3,0x2055fa30,0xadf66d76,0x889176cc,0xf5254c02,0x4ffcd7e5,0xc5d7cb2a,0x26804435,0xb58fa362,0xde495ab1,0x25671bba,0x45980eea,0x5de1c0fe,0xc302752f,0x8112f04c,0x8da39746,0x6bc6f9d3,0x03e75f8f,0x15959c92,0xbfeb7a6d,0x95da5952,0xd42d83be,0x58d32174,0x492969e0,0x8e44c8c9,0x756a89c2,0xf478798e,0x996b3e58,0x27dd71b9,0xbeb64fe1,0xf017ad88,0xc966ac20,0x7db43ace,0x63184adf,0xe582311a,0x97603351,0x62457f53,0xb1e07764,0xbb84ae6b,0xfe1ca081,0xf9942b08,0x70586848,0x8f19fd45,0x94876cde,0x52b7f87b,0xab23d373,0x72e2024b,0xe3578f1f,0x662aab55,0xb20728eb,0x2f03c2b5,0x869a7bc5,0xd3a50837,0x30f28728,0x23b2a5bf,0x02ba6a03,0xed5c8216,0x8a2b1ccf,0xa792b479,0xf3f0f207,0x4ea1e269,0x65cdf4da,0x06d5be05,0xd11f6234,0xc48afea6,0x349d532e,0xa2a055f3,0x0532e18a,0xa475ebf6,0x0b39ec83,0x40aaef60,0x5e069f71,0xbd51106e,0x3ef98a21,0x963d06dd,0xddae053e,0x4d46bde6,0x91b58d54,0x71055dc4,0x046fd406,0x60ff1550,0x1924fb98,0xd697e9bd,0x89cc4340,0x67779ed9,0xb0bd42e8,0x07888b89,0xe7385b19,0x79dbeec8,0xa1470a7c,0x7ce90f42,0xf8c91e84,0x00000000,0x09838680,0x3248ed2b,0x1eac7011,0x6c4e725a,0xfdfbff0e,0x0f563885,0x3d1ed5ae,0x3627392d,0x0a64d90f,0x6821a65c,0x9bd1545b,0x243a2e36,0x0cb1670a,0x930fe757,0xb4d296ee,0x1b9e919b,0x804fc5c0,0x61a220dc,0x5a694b77,0x1c161a12,0xe20aba93,0xc0e52aa0,0x3c43e022,0x121d171b,0x0e0b0d09,0xf2adc78b,0x2db9a8b6,0x14c8a91e,0x578519f1,0xaf4c0775,0xeebbdd99,0xa3fd607f,0xf79f2601,0x5cbcf572,0x44c53b66,0x5b347efb,0x8b762943,0xcbdcc623,0xb668fced,0xb863f1e4,0xd7cadc31,0x42108563,0x13402297,0x842011c6,0x857d244a,0xd2f83dbb,0xae1132f9,0xc76da129,0x1d4b2f9e,0xdcf330b2,0x0dec5286,0x77d0e3c1,0x2b6c16b3,0xa999b970,0x11fa4894,0x472264e9,0xa8c48cfc,0xa01a3ff0,0x56d82c7d,0x22ef9033,0x87c74e49,0xd9c1d138,0x8cfea2ca,0x98360bd4,0xa6cf81f5,0xa528de7a,0xda268eb7,0x3fa4bfad,0x2ce49d3a,0x500d9278,0x6a9bcc5f,0x5462467e,0xf6c2138d,0x90e8b8d8,0x2e5ef739,0x82f5afc3,0x9fbe805d,0x697c93d0,0x6fa92dd5,0xcfb31225,0xc83b99ac,0x10a77d18,0xe86e639c,0xdb7bbb3b,0xcd097826,0x6ef41859,0xec01b79a,0x83a89a4f,0xe6656e95,0xaa7ee6ff,0x2108cfbc,0xefe6e815,0xbad99be7,0x4ace366f,0xead4099f,0x29d67cb0,0x31afb2a4,0x2a31233f,0xc63094a5,0x35c066a2,0x7437bc4e,0xfca6ca82,0xe0b0d090,0x3315d8a7,0xf14a9804,0x41f7daec,0x7f0e50cd,0x172ff691,0x768dd64d,0x434db0ef,0xcc544daa,0xe4df0496,0x9ee3b5d1,0x4c1b886a,0xc1b81f2c,0x467f5165,0x9d04ea5e,0x015d358c,0xfa737487,0xfb2e410b,0xb35a1d67,0x9252d2db,0xe9335610,0x6d1347d6,0x9a8c61d7,0x377a0ca1,0x598e14f8,0xeb893c13,0xceee27a9,0xb735c961,0xe1ede51c,0x7a3cb147,0x9c59dfd2,0x553f73f2,0x1879ce14,0x73bf37c7,0x53eacdf7,0x5f5baafd,0xdf146f3d,0x7886db44,0xca81f3af,0xb93ec468,0x382c3424,0xc25f40a3,0x1672c31d,0xbc0c25e2,0x288b493c,0xff41950d,0x397101a8,0x08deb30c,0xd89ce4b4,0x6490c156,0x7b6184cb,0xd570b632,0x48745c6c,0xd04257b8];abstract class GGB implements E0{Uint8List process(Uint8List B){var A=new Uint8List(blockSize);var C=PS(B,0,A,0);return A.sublist(0,C);}}abstract class HGB implements D0{Uint8List process(Uint8List A){update(A,0,A.length);var B=new Uint8List(m7);var C=cQB(B,0);return B.sublist(0,C);}}abstract class K0 extends HGB{final CaB=new cI(0);final DaB=new Uint8List(4);int EaB;final Endianness FaB;final GaB;final state;final buffer;int WY;K0(this.FaB,int A,int C,[int B=null]):GaB=(B==null)?A:B,state=new List<int>(A),buffer=new List<int>(C){reset();}void M_();void PS();void reset(){CaB.set(0);EaB=0;DaB.fillRange(0,DaB.length,0);WY=0;buffer.fillRange(0,buffer.length,0);M_();}void Uh(int A){DaB[EaB++ ]=O0(A);HaB();CaB.sum(1);}void update(Uint8List D,int B,int C){var A;A=IaB(D,B,C);B+= A;C-= A;A=JaB(D,B,C);B+= A;C-= A;KaB(D,B,C);}int cQB(Uint8List A,int B){var C=new cI(CaB)..dUB(3);LaB();MaB(C);NaB();OaB(A,B);reset();return m7;}void PaB(Uint8List A,int B){buffer[WY++ ]=OT(A,B,FaB);if(WY==16){NaB();}}void NaB(){PS();WY=0;buffer.fillRange(0,16,0);}void KaB(Uint8List C,int A,int B){while(B>0){Uh(C[A]);A++ ;B-- ;}}int JaB(Uint8List D,int A,int B){int C=0;while(B>DaB.length){PaB(D,A);A+= DaB.length;B-= DaB.length;CaB.sum(DaB.length);C+= 4;}return C;}int IaB(Uint8List D,int A,int B){var C=0;while((EaB!=0)&&(B>0)){Uh(D[A]);A++ ;B-- ;C++ ;}return C;}void HaB(){if(EaB==DaB.length){PaB(DaB,0);EaB=0;}}void LaB(){Uh(128);while(EaB!=0){Uh(0);}}void MaB(cI A){if(WY>14){NaB();}switch (FaB){case Endianness.LITTLE_ENDIAN:buffer[14]=A.I9;buffer[15]=A.n8;break;case Endianness.BIG_ENDIAN:buffer[14]=A.n8;buffer[15]=A.I9;break;default:throw new StateError("Invalid endianness: ${FaB}");}}void OaB(Uint8List B,int C){for(int A=0;A<GaB;A++ ){PW(state[A],B,(C+A*4),FaB);}}}class kQ extends K0 implements D0{static const IGB=32;kQ():super(Endianness.BIG_ENDIAN,8,64);final lXB="SHA-256";final m7=IGB;void M_(){state[0]=0x6a09e667;state[1]=0xbb67ae85;state[2]=0x3c6ef372;state[3]=0xa54ff53a;state[4]=0x510e527f;state[5]=0x9b05688c;state[6]=0x1f83d9ab;state[7]=0x5be0cd19;}void PS(){for(var A=16;A<64;A++ ){buffer[A]=tC(QaB(buffer[A-2])+buffer[A-7]+RaB(buffer[A-15])+buffer[A-16]);}var B=state[0];var C=state[1];var D=state[2];var G=state[3];var H=state[4];var I=state[5];var J=state[6];var K=state[7];var A=0;for(var M=0;M<8;M++ ){K=tC(K+SaB(H)+TaB(H,I,J)+lO[A]+buffer[A]);G=tC(G+K);K=tC(K+UaB(B)+VaB(B,C,D)); ++A;J=tC(J+SaB(G)+TaB(G,H,I)+lO[A]+buffer[A]);D=tC(D+J);J=tC(J+UaB(K)+VaB(K,B,C)); ++A;I=tC(I+SaB(D)+TaB(D,G,H)+lO[A]+buffer[A]);C=tC(C+I);I=tC(I+UaB(J)+VaB(J,K,B)); ++A;H=tC(H+SaB(C)+TaB(C,D,G)+lO[A]+buffer[A]);B=tC(B+H);H=tC(H+UaB(I)+VaB(I,J,K)); ++A;G=tC(G+SaB(B)+TaB(B,C,D)+lO[A]+buffer[A]);K=tC(K+G);G=tC(G+UaB(H)+VaB(H,I,J)); ++A;D=tC(D+SaB(K)+TaB(K,B,C)+lO[A]+buffer[A]);J=tC(J+D);D=tC(D+UaB(G)+VaB(G,H,I)); ++A;C=tC(C+SaB(J)+TaB(J,K,B)+lO[A]+buffer[A]);I=tC(I+C);C=tC(C+UaB(D)+VaB(D,G,H)); ++A;B=tC(B+SaB(I)+TaB(I,J,K)+lO[A]+buffer[A]);H=tC(H+B);B=tC(B+UaB(C)+VaB(C,D,G)); ++A;}state[0]=tC(state[0]+B);state[1]=tC(state[1]+C);state[2]=tC(state[2]+D);state[3]=tC(state[3]+G);state[4]=tC(state[4]+H);state[5]=tC(state[5]+I);state[6]=tC(state[6]+J);state[7]=tC(state[7]+K);}int TaB(int A,int B,int C)=>(A&B)^((~A)&C);int VaB(int A,int B,int C)=>(A&B)^(A&C)^(B&C);int UaB(int A)=>XK(A,2)^XK(A,13)^XK(A,22);int SaB(int A)=>XK(A,6)^XK(A,11)^XK(A,25);int RaB(int A)=>XK(A,7)^XK(A,18)^ok(A,3);int QaB(int A)=>XK(A,17)^XK(A,19)^ok(A,10);static final lO=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];}class L0 implements VL{final String dQB;final H0 XF;final List<int> pZ;final wE pn;final n pr;n WaB;L0(this.dQB,this.XF,this.pn,this.pr,[this.WaB=null,this.pZ=null]){if(WaB==null){WaB=n.YM;}}}abstract class KH implements kM{n IJ();int get kY;int get pPB=>((kY+7)~/8);KH operator+(kM A);KH operator-(kM A);KH operator*(kM A);KH operator/(kM A);KH operator-();KH sZ();KH sqrt();String toString()=>IJ().toString();}abstract class ZG implements wE{final jk XF;final KH x;final KH y;final bool DS;final JGB XaB;LT YaB;ZG(this.XF,this.x,this.y,this.DS,[this.XaB=KGB]);bool get sN=>(x==null&&y==null);void set oTB(LT A){YaB=A;}bool operator==(A){if(A is ZG){if(sN){return A.sN;}return x==A.x&&y==A.y;}return false;}String toString()=>"(${x},${y})";int get hashCode{if(sN){return 0;}return x.hashCode^y.hashCode;}Uint8List nU([bool A=true]);wE operator+(wE A);wE operator-(wE A);wE operator-();wE yZ();wE operator*(n A){if(A.RI()<0){throw new ArgumentError("The multiplicator cannot be negative");}if(sN){return this;}if(A.RI()==0){return XF.xU;}return XaB(this,A,YaB);}}abstract class jk implements H0{KH ZaB;KH aaB;jk(n A,n B){this.ZaB=qN(A);this.aaB=qN(B);}KH get GY=>ZaB;KH get Ff=>aaB;int get kY;ZG get xU;KH qN(n A);ZG h7(n A,n B,[bool C=false]);ZG k7(int A,n B);ZG vR(List<int> A){ZG C=null;int B=(kY+7)~/8;switch (A[0]){case 0x00:if(A.length!=1){throw new ArgumentError("Incorrect length for infinity encoding");}C=xU;break;case 0x02:case 0x03:if(A.length!=(B+1)){throw new ArgumentError("Incorrect length for compressed encoding");}int G=A[0]&1;var D=baB(A,1,B);C=k7(G,D);break;case 0x04:case 0x06:case 0x07:if(A.length!=(2*B+1)){throw new ArgumentError("Incorrect length for uncompressed/hybrid encoding");}n D=baB(A,1,B);n H=baB(A,1+B,B);C=h7(D,H,false);break;default:throw new ArgumentError("Invalid point encoding 0x"+A[0].toRadixString(16));}return C;}n baB(List<int> B,int A,int C){return new n.tVB(1,B.sublist(A,A+C));}}abstract class LT{}typedef ZG JGB(ZG _0,n _1,LT _2);ZG KGB(ZG C,n I,LT M){n D=I;n G=D*n.Iu;ZG J=-C;ZG A=C;for(var B=G.bitLength()-2;B>0; --B){A=A.yZ();var H=G.EL(B);var K=D.EL(B);if(H!=K){A=(A+(H?C:J)) as ZG;}}return A;}class bE extends KH{final n KC;final n x;bE(this.KC,this.x){if(x>=KC){throw new ArgumentError("Value x must be smaller than q");}}int get kY=>KC.bitLength();n IJ()=>x;bE operator+(kM A)=>new bE(KC,(x+A.IJ())%KC);bE operator-(kM A)=>new bE(KC,(x-A.IJ())%KC);bE operator*(kM A)=>new bE(KC,(x*A.IJ())%KC);bE operator/(kM A)=>new bE(KC,(x*A.IJ().modInverse(KC))%KC);bE operator-()=>new bE(KC,-x%KC);bE sZ()=>new bE(KC,x.modPow(n.yh,KC));bE sqrt(){if(!KC.EL(0)){throw new UnimplementedError("Not implemented yet");}if(KC.EL(1)){var G=new bE(KC,x.modPow((KC>>2)+n.YM,KC));return G.sZ()==this?G:null;}var C=KC-n.YM;var H=C>>1;if(x.modPow(H,KC)!=n.YM){return null;}var M=C>>2;var N=(M<<1)+n.YM;var I=x;var J=(I>>2)%KC;var D,A;var O=new jO();do{n B;do{B=O.a9(KC.bitLength());}while((B>=KC)||(((B*B)-J).modPow(H,KC)!=C));List<n> K=caB(KC,B,I,N);D=K[0];A=K[1];if(((A*A)%KC)==J){if(A.EL(0)){A=A+KC;}A=(A>>1);return new bE(KC,A);}}while((D==n.YM)||(D==C));return null;}List<n> caB(n B,n J,n M,n K){var O=K.bitLength();var N=K.P9;n D=n.YM;n C=n.yh;n G=J;n A=n.YM;n H=n.YM;for(var I=O-1;I>=(N+1);I-- ){A=(A*H)%B;if(K.EL(I)){H=(A*M)%B;D=(D*G)%B;C=((G*C)-(J*A))%B;G=((G*G)-(H<<1))%B;}else{H=A;D=((D*C)-A)%B;G=((G*C)-(J*A))%B;C=((C*C)-(A<<1))%B;}}A=(A*H)%B;H=(A*M)%B;D=((D*C)-A)%B;C=((G*C)-(J*A))%B;A=(A*H)%B;for(var I=1;I<=N;I++ ){D=(D*C)%B;C=((C*C)-(A<<1))%B;A=(A*A)%B;}return [D,C];}bool operator==(A){if(A is bE){return (KC==A.KC)&&(x==A.x);}return false;}int get hashCode=>KC.hashCode^x.hashCode;}class xF extends ZG{xF(qb C,bE A,bE B,[bool D=false]):super(C,A,B,D,LGB){if((A!=null&&B==null)||(A==null&&B!=null)){throw new ArgumentError("Exactly one of the field elements is null");}}Uint8List nU([bool H=true]){if(sN){return new Uint8List.fromList([1]);}var C=x.pPB;if(H){int D;if(y.IJ().EL(0)){D=0x03;}else{D=0x02;}Uint8List B=lk(x.IJ(),C);Uint8List A=new Uint8List(B.length+1);A[0]=D.toInt();A.setAll(1,B);return A;}else{Uint8List B=lk(x.IJ(),C);Uint8List G=lk(y.IJ(),C);Uint8List A=new Uint8List(B.length+G.length+1);A[0]=0x04;A.setAll(1,B);A.setAll(B.length+1,G);return A;}}wE operator+(wE A){if(sN){return A;}if(A.sN){return this;}if(x==A.x){if(y==A.y){return yZ();}return XF.xU;}var B=(A.y-y)/(A.x-x);var C=(B.sZ()-x)-A.x;var D=(B*(x-C))-y;return new xF(XF,C,D,DS);}wE yZ(){if(sN){return this;}if(y.IJ()==0){return this.XF.xU;}var A=XF.qN(n.yh);var D=XF.qN(n.Iu);var B=((x.sZ()*D)+XF.GY)/(y*A);var C=B.sZ()-(x*A);var G=(B*(x-C))-y;return new xF(XF,C,G,DS);}wE operator-(wE A){if(A.sN){return this;}return this+(-A);}wE operator-(){return new xF(XF,x,-y,DS);}}class qb extends jk{final n KC;xF daB;qb(this.KC,n A,n B):super(A,B){daB=new xF(this,null,null);}int get kY=>KC.bitLength();xF get xU=>daB;bE qN(n A)=>new bE(this.KC,A);xF h7(n A,n B,[bool C=false])=>new xF(this,qN(A),qN(B),C);xF k7(int D,n G){var A=qN(G);var H=(A*((A*A)+GY))+Ff;bE B=H.sqrt();if(B==null){throw new ArgumentError("Invalid point compression");}var C=B.IJ();var I=C.EL(0)?1:0;if(I!=D){B=qN(KC-C);}return new xF(this,A,B,true);}bool operator==(A){if(A is qb){return KC==A.KC&&GY==A.GY&&Ff==A.Ff;}return false;}int get hashCode=>GY.hashCode^Ff.hashCode^KC.hashCode;}class kk implements LT{List<xF> y9;xF v_;}xF LGB(ZG K,n Q,LT N){kk H=N;if((N==null)&&(N is!kk)){H=new kk();}var I=Q.bitLength();var D;var C;if(I<13){D=2;C=1;}else{if(I<41){D=3;C=2;}else{if(I<121){D=4;C=4;}else{if(I<337){D=5;C=8;}else{if(I<897){D=6;C=16;}else{if(I<2305){D=7;C=32;}else{D=8;C=127;}}}}}}var O=1;var A=H.y9;var M=H.v_;if(A==null){A=new List<xF>.filled(1,K);}else{O=A.length;}if(M==null){M=K.yZ();}if(O<C){List<xF> S=A;A=new List<xF>(C);A.setAll(0,S);for(int B=O;B<C;B++ ){A[B]=M+(A[B-1]);}}var J=MGB(D,Q);var V=J.length;var G=K.XF.xU;for(int B=V-1;B>=0;B-- ){G=G.yZ();if(J[B]!=0){if(J[B]>0){G=G+A[(J[B]-1)~/2];}else{G=G-A[(-J[B]-1)~/2];}}}H.y9=A;H.v_=M;K.oTB=H;return G;}List<int> MGB(int H,n C){List<int> B=new List<int>(C.bitLength()+1);int I=(1<<H);n K=new n(I);int A=0;int D=0;while(C.RI()>0){if(C.EL(0)){n G=C.NZ(K);if(G.EL(H-1)){B[A]=G.tG()-I;}else{B[A]=G.tG();}B[A]%=0x100;if((B[A]&0x80)!=0){B[A]=B[A]-256;}C=C-new n(B[A]);D=A;}else{B[A]=0;}C=C.tg(1);A++ ;}D++ ;List<int> J=new List<int>(D);J.setAll(0,B.sublist(0,D));return J;}Uint8List lk(n C,int B){Uint8List A=new Uint8List.fromList(C.IQ());if(B<A.length){return A.sublist(A.length-B);}else if(B>A.length){return new Uint8List(B)..setAll(B-A.length,A);}return A;}class rb implements zFB{VL eaB;jO faB;void init(kH A){MT B;if(A is NT){faB=A.OM;B=A.parameters;}else{faB=new jO();B=A;}eaB=B.eQB;}ob pf(){var B=eaB.pr;var C=B.bitLength();var A;do{A=faB.a9(C);}while(A==n.FAB||(A>=B));var D=eaB.pn*A;return new ob(new wF(D,eaB),new lH(A,eaB));}}class MT extends M0{VL gaB;MT(VL A):super(A.pr.bitLength()){gaB=A;}VL get eQB=>gaB;}abstract class M0 implements kH{final int lPB;M0(this.lPB);}class mO extends kH{final Uint8List key;mO(this.key);}class OW<qn extends kH> implements kH{final Uint8List A9;final qn parameters;OW(this.parameters,this.A9);}class NT<qn extends kH> implements kH{final qn parameters;final jO OM;NT(this.parameters,this.OM);}class mk extends N0 implements jO{final E0 YY;Uint8List haB;Uint8List iaB;var jaB;mk(this.YY){haB=new Uint8List(YY.blockSize);iaB=new Uint8List(YY.blockSize);jaB=iaB.length;}void pZ(kH A){jaB=iaB.length;haB.setAll(0,(A as OW<kH>).A9);YY.init(true,(A as OW<kH>).parameters);}int KS(){if(jaB==iaB.length){YY.PS(haB,0,iaB,0);jaB=0;kaB();}return O0(iaB[jaB++ ]);}void kaB(){int A=haB.length;do{A-- ;haB[A]+=1;}while(haB[A]==0);}}abstract class N0 implements jO{int zSB(){var A=KS();var B=KS();return RGB((B<<8)|A);}n a9(int A){return new n.tVB(1,laB(A));}List<int> laB(int B){if(B<0){throw new ArgumentError("numBits must be non-negative");}var A=(B+7)~/8;var C=new Uint8List(A);if(A>0){for(var D=0;D<A;D++ ){C[D]=KS();}int G=8*A-B;C[0]&=(1<<(8-G))-1;}return C;}}const nk=0x1F;const NGB=0x3F;const OGB=0xFF;const PGB=0xFFFF;const aG=0xFFFFFFFF;final QGB=[0xFFFFFFFF,0x7FFFFFFF,0x3FFFFFFF,0x1FFFFFFF,0x0FFFFFFF,0x07FFFFFF,0x03FFFFFF,0x01FFFFFF,0x00FFFFFF,0x007FFFFF,0x003FFFFF,0x001FFFFF,0x000FFFFF,0x0007FFFF,0x0003FFFF,0x0001FFFF,0x0000FFFF,0x00007FFF,0x00003FFF,0x00001FFF,0x00000FFF,0x000007FF,0x000003FF,0x000001FF,0x000000FF,0x0000007F,0x0000003F,0x0000001F,0x0000000F,0x00000007,0x00000003,0x00000001,0x00000000];int O0(int A)=>(A&OGB);int RGB(int A)=>(A&PGB);int tC(int A)=>(A&aG);int sb(int A,int B){assert((A>=0)&&(A<=aG));B&= nk;A&= QGB[B];return ((A<<B)&aG);}int ok(int A,int B){assert((A>=0)&&(A<=aG));B&= nk;return (A>>B);}int XK(int A,int B){assert(B>=0);assert((A>=0)&&(A<=aG));B&= nk;return (A>>B)|sb(A,(32-B));}void PW(int B,dynamic A,int C,Endianness D){assert((B>=0)&&(B<=aG));if(A is!ByteData){A=new ByteData.view(A.buffer);}(A as ByteData).setUint32(C,B,D);}int OT(dynamic A,int B,Endianness C){if(A is!ByteData){A=new ByteData.view(A.buffer);}return (A as ByteData).getUint32(B,C);}class cI{int maB;int naB;cI([dynamic A=0,int B=null]){set(A,B);}int get I9=>naB;int get n8=>maB;bool operator==(cI A)=>((maB==A.maB)&&(naB==A.naB));bool operator<(cI A)=>((maB<A.maB)||((maB==A.maB)&&(naB<A.naB)));bool operator<=(cI A)=>((this<A)||(this==A));bool operator>(cI A)=>((maB>A.maB)||((maB==A.maB)&&(naB>A.naB)));bool operator>=(cI A)=>((this>A)||(this==A));void set(dynamic A,[int B=null]){if(B==null){if(A is cI){maB=A.maB;naB=A.naB;}else{assert(A<=aG);maB=0;naB=A;}}else{assert(A<=aG);assert(B<=aG);maB=A;naB=B;}}void sum(dynamic A){if(A is int){A&= aG;int B=(naB+A);naB=(B&aG);if(B!=naB){maB++ ;maB&= aG;}}else{int B=(naB+A.naB);naB=(B&aG);int C=((B!=naB)?1:0);maB=(((maB+A.maB+C) as int)&aG);}}void qr(){LS();sum(1);}void LS(){maB=(~maB&aG);naB=(~naB&aG);}void oR(cI A){maB&= A.maB;naB&= A.naB;}void LM(cI A){maB|= A.maB;naB|= A.naB;}void hh(cI A){maB^= A.maB;naB^= A.naB;}void dUB(int A){A&= NGB;if(A==0){}else if(A>=32){maB=sb(naB,(A-32));naB=0;}else{maB=sb(maB,A);maB|= naB>>(32-A);naB=sb(naB,A);}}String toString(){var A=new StringBuffer();oaB(A,maB);oaB(A,naB);return A.toString();}void oaB(StringBuffer A,int D){var B=D.toRadixString(16);for(var C=(8-B.length);C>0;C-- ){A.write("0");}A.write(B);}}abstract class dL{factory dL(){R1("IOClient");return new Zc();}}class hT extends P1{final String identifier;final String secret;CP get credentials=>paB;CP paB;final bool qaB;dL raB;hT(this.paB,{this.identifier,this.secret,bool basicAuth: true,dL httpClient}):qaB=basicAuth,raB=httpClient==null?new dL():httpClient{if(identifier==null&&secret!=null){throw new ArgumentError("secret may not be passed without identifier.");}}Future<cT> send(yO D)async{if(credentials.w8){if(!credentials.T7)throw new V2(credentials);await xTB();}D.headers['authorization']="Bearer ${credentials.IY}";var A=await raB.send(D);if(A.statusCode!=401)return A;if(!A.headers.containsKey('www-authenticate'))return A;var G;try {G=ac.wHB(A.headers['www-authenticate']);}on FormatException {return A;}var C=G.firstWhere((C)=>C.scheme=='bearer',orElse:()=>null);if(C==null)return A;var B=C.parameters;if(!B.containsKey('error'))return A;throw new jc(B['error'],B['error_description'],B['error_uri']==null?null:Uri.parse(B['error_uri']));}Future<hT> xTB([List<String> B])async{if(!credentials.T7){var A="OAuth credentials";if(credentials.w8)A="${A} have expired and";throw new StateError("${A} can't be refreshed.");}paB=await credentials.wTB(identifier:identifier,secret:secret,newScopes:B,basicAuth:qaB,httpClient:raB);return this;}void close(){if(raB!=null)raB.close();raB=null;}}const String JKB='\u001b[31m';const String P3='\u001b[0m';AE sJB()=>new AE.mWB();class AE{factory AE({AD style,String current}){if(current==null){if(style==null){current=c2;}else{current=".";}}if(style==null){style=AD.hm;}else if(style is!FN){throw new ArgumentError("Only styles defined by the path package are " "allowed.");}return new AE.nWB(style as FN,current);}AE.mWB():BB=AD.hm as FN,saB=null;AE.nWB(this.BB,this.saB);final FN BB;final String saB;String get current=>saB!=null?saB:c2;String get AK=>BB.AK;String absolute(String A,[String B,String C,String D,String G,String H,String I]){m2("absolute",[A,B,C,D,G,H,I]);if(B==null&&isAbsolute(A)&&!oF(A)){return A;}return join(current,A,B,C,D,G,H,I);}String zp(String A)=>taB(A).zp;String Aq(String A)=>taB(A).Aq;String YQB(String B){var A=taB(B);A.lZ();if(A.tB.isEmpty)return A.nB==null?'.':A.nB;if(A.tB.length==1){return A.nB==null?'.':A.nB;}A.tB.removeLast();A.EF.removeLast();A.lZ();return A.toString();}String nq(String A)=>taB(A).nq;bool isAbsolute(String A)=>BB.AL(A)>0;bool yU(String A)=>!this.isAbsolute(A);bool oF(String A)=>BB.oF(A);String join(String B,[String C,String D,String G,String H,String I,String J,String K]){var A=<String>[B,C,D,G,H,I,J,K];m2("join",A);return B9(A.where((M)=>M!=null));}String B9(Iterable<String> I){var B=new StringBuffer();var D=false;var G=false;for(var A in I.where((A)=>A!='')){if(this.oF(A)&&G){var C=taB(A);var H=B.toString();C.nB=H.substring(0,BB.AL(H,withDrive:true));if(BB.CV(C.nB)){C.EF[0]=BB.AK;}B.clear();B.write(C.toString());}else if(this.isAbsolute(A)){G=!this.oF(A);B.clear();B.write(A);}else{if(A.length>0&&BB.Rf(A[0])){}else if(D){B.write(AK);}B.write(A);}D=BB.CV(A);}return B.toString();}List<String> split(String B){var A=taB(B);A.tB=A.tB.where((C)=>!C.isEmpty).toList();if(A.nB!=null)A.tB.insert(0,A.nB);return A.tB;}String wJ(String A){if(!uaB(A))return A;var B=taB(A);B.wJ();return B.toString();}bool uaB(String I){var J=0;var D=I.codeUnits;int B;int A;var G=BB.AL(I);if(G!=0){J=G;A=fJ;if(BB==AD.fL){for(var C=0;C<G;C++ ){if(D[C]==fJ)return true;}}}for(var C=J;C<D.length;C++ ){var H=D[C];if(BB.VC(H)){if(BB==AD.fL&&H==fJ)return true;if(A!=null&&BB.VC(A))return true;if(A==hI&&(B==null||B==hI||BB.VC(B))){return true;}}B=A;A=H;}if(A==null)return true;if(BB.VC(A))return true;if(A==hI&&(B==null||BB.VC(B)||B==hI)){return true;}return false;}String iZ(String C,{String from}){if(from==null&&this.yU(C))return this.wJ(C);from=from==null?current:absolute(from);if(this.yU(from)&&this.isAbsolute(C)){return this.wJ(C);}if(this.yU(C)||this.oF(C)){C=this.absolute(C);}if(this.yU(C)&&this.isAbsolute(from)){throw new nc('Unable to find a path to "${C}" from "${from}".');}var B=taB(from)..wJ();var A=taB(C)..wJ();if(B.tB.length>0&&B.tB[0]=='.'){return A.toString();}if(B.nB!=A.nB&&((B.nB==null||A.nB==null)||!BB.Es(B.nB,A.nB))){return A.toString();}while(B.tB.length>0&&A.tB.length>0&&BB.Es(B.tB[0],A.tB[0])){B.tB.removeAt(0);B.EF.removeAt(1);A.tB.removeAt(0);A.EF.removeAt(1);}if(B.tB.length>0&&B.tB[0]=='..'){throw new nc('Unable to find a path to "${C}" from "${from}".');}A.tB.insertAll(0,new List.filled(B.tB.length,'..'));A.EF[0]='';A.EF.insertAll(1,new List.filled(B.tB.length,BB.AK));if(A.tB.length==0)return '.';if(A.tB.length>1&&A.tB.last=='.'){A.tB.removeLast();A.EF..removeLast()..removeLast()..add('');}A.nB='';A.lZ();return A.toString();}bool LE(String A,String B)=>vaB(A,B)==MD.mc;MD vaB(String A,String B){var D=isAbsolute(A);var G=isAbsolute(B);if(D&&!G){B=absolute(B);if(BB.oF(A))A=absolute(A);}else if(G&&!D){A=absolute(A);if(BB.oF(B))B=absolute(B);}else if(G&&D){var H=BB.oF(B);var I=BB.oF(A);if(H&&!I){B=absolute(B);}else if(I&&!H){A=absolute(A);}}var J=waB(A,B);if(J!=MD.LR)return J;String C;try {C=this.iZ(B,from:A);}on nc catch (K){return MD.EN;}if(!this.yU(C))return MD.EN;if(C=='.')return MD.mc;if(C=='..')return MD.EN;return (C.length>=3&&C.startsWith('..')&&BB.VC(C.codeUnitAt(2)))?MD.EN:MD.n2;}MD waB(String C,String D){if(C=='.')C='';var K=BB.AL(C);var O=BB.AL(D);if(K!=O)return MD.EN;for(var N=0;N<K;N++ ){var G=C.codeUnitAt(N);var H=D.codeUnitAt(N);if(!BB.Of(G,H)){return MD.EN;}}var I=fJ;int J;var A=K;var B=O;while(A<C.length&&B<D.length){var G=C.codeUnitAt(A);var H=D.codeUnitAt(B);if(BB.Of(G,H)){if(BB.VC(G)){J=A;}I=G;A++ ;B++ ;continue;}if(BB.VC(G)&&BB.VC(I)){J=A;A++ ;continue;}else if(BB.VC(H)&&BB.VC(I)){B++ ;continue;}if(G==hI&&BB.VC(I)){A++ ;if(A==C.length)break;G=C.codeUnitAt(A);if(BB.VC(G)){J=A;A++ ;continue;}if(G==hI){A++ ;if(A==C.length||BB.VC(C.codeUnitAt(A))){return MD.LR;}}}if(H==hI&&BB.VC(I)){B++ ;if(B==D.length)break;H=D.codeUnitAt(B);if(BB.VC(H)){B++ ;continue;}if(H==hI){B++ ;if(B==D.length||BB.VC(D.codeUnitAt(B))){return MD.LR;}}}var Q=xaB(D,B);if(Q!=iG.gm){return MD.LR;}var S=xaB(C,A);if(S!=iG.gm){return MD.LR;}return MD.EN;}if(B==D.length){if(A==C.length||BB.VC(C.codeUnitAt(A))){J=A;}else{J??= LJ.max(0,K-1);}var M=xaB(C,J??K-1);if(M==iG.fm)return MD.mc;return M==iG.em?MD.LR:MD.EN;}var M=xaB(D,B);if(M==iG.fm)return MD.mc;if(M==iG.em){return MD.LR;}return (BB.VC(D.codeUnitAt(B))||BB.VC(I))?MD.n2:MD.EN;}iG xaB(String B,int H){var C=0;var G=false;var A=H;while(A<B.length){while(A<B.length&&BB.VC(B.codeUnitAt(A))){A++ ;}if(A==B.length)break;var D=A;while(A<B.length&&!BB.VC(B.codeUnitAt(A))){A++ ;}if(A-D==1&&B.codeUnitAt(D)==hI){}else if(A-D==2&&B.codeUnitAt(D)==hI&&B.codeUnitAt(D+1)==hI){C-- ;if(C<0)break;if(C==0)G=true;}else{C++ ;}if(A==B.length)break;A++ ;}if(C<0)return iG.em;if(C==0)return iG.fm;if(G)return iG.tJB;return iG.gm;}int hash(String A){A=absolute(A);var B=yaB(A);if(B!=null)return B;var C=taB(A);C.wJ();return yaB(C.toString());}int yaB(String B){var C=4603;var H=true;var D=true;for(var A=0;A<B.length;A++ ){var G=BB.U7(B.codeUnitAt(A));if(BB.VC(G)){D=true;continue;}if(G==hI&&D){if(A+1==B.length)break;var I=B.codeUnitAt(A+1);if(BB.VC(I))continue;if(!H&&I==hI&&(A+2==B.length||BB.VC(B.codeUnitAt(A+2)))){return null;}}C&= 0x3FFFFFF;C*= 33;C^= G;D=false;H=false;}return C;}String K8(A)=>BB.cZ(l2(A));Uri o_(String A){if(yU(A)){return BB.Ns(A);}else{return BB.HY(join(current,A));}}String pTB(D){var A=l2(D);if(A.scheme=='file'&&BB==AD.HN){return A.toString();}else if(A.scheme!='file'&&A.scheme!=''&&BB!=AD.HN){return A.toString();}var B=wJ(K8(A));var C=iZ(B);return split(C).length>split(B).length?B:C;}GN taB(String A)=>new GN.oWB(A,BB);}Uri l2(A){if(A is String)return Uri.parse(A);if(A is Uri)return A;throw new ArgumentError.value(A,'uri','Value must be a String or a Uri');}void m2(String H,List<String> A){for(var B=1;B<A.length;B++ ){if(A[B]==null||A[B-1]!=null)continue;int C;for(C=A.length;C>=1;C-- ){if(A[C-1]!=null)break;}var D=new StringBuffer();D.write("${H}(");D.write(A.take(C).map((G)=>G==null?"null":'"${G}"').join(", "));D.write("): part ${B-1} was null, but part ${B} was not.");throw new ArgumentError(D.toString());}}class iG{static const em=const iG("above root");static const fm=const iG("at root");static const tJB=const iG("reaches root");static const gm=const iG("below root");final String name;const iG(this.name);String toString()=>name;}class MD{static const n2=const MD("within");static const mc=const MD("equal");static const EN=const MD("different");static const LR=const MD("inconclusive");final String name;const MD(this.name);String toString()=>name;}const Mi=const bu.xVB();class bu extends Codec<List<int>,String>{Pi get encoder=>dAB;Ni get decoder=>cAB;const bu.xVB();}const cAB=const Ni.yVB();class Ni extends Converter<String,List<int>>{const Ni.yVB();List<int> convert(String A){if(!A.length.isEven){throw new FormatException("Invalid input length, must be even.",A,A.length);}var B=new Uint8List(A.length~/2);Oi(A.codeUnits,0,A.length,B,0);return B;}StringConversionSink startChunkedConversion(Sink<List<int>> A)=>new cu(A);}class cu extends StringConversionSinkBase{final Sink<List<int>> zaB;int AbB;cu(this.zaB);void addSlice(String D,int A,int B,bool H){RangeError.checkValidRange(A,B,D.length);if(A==B){if(H)BbB(D,B);return;}var I=D.codeUnits;Uint8List C;int G;if(AbB==null){C=new Uint8List((B-A)~/2);G=0;}else{var J=(B-A-1)~/2;C=new Uint8List(1+J);C[0]=AbB+gV(I,A);A++ ;G=1;}AbB=Oi(I,A,B,C,G);zaB.add(C);if(H)BbB(D,B);}ByteConversionSink asUtf8Sink(bool A)=>new du(zaB);void close()=>BbB();void BbB([String A,int B]){if(AbB!=null){throw new FormatException("Input ended with incomplete encoded byte.",A,B);}zaB.close();}}class du extends ByteConversionSinkBase{final Sink<List<int>> zaB;int AbB;du(this.zaB);void add(List<int> A)=>addSlice(A,0,A.length,false);void addSlice(List<int> C,int A,int B,bool H){RangeError.checkValidRange(A,B,C.length);if(A==B){if(H)BbB(C,B);return;}Uint8List D;int G;if(AbB==null){D=new Uint8List((B-A)~/2);G=0;}else{var I=(B-A-1)~/2;D=new Uint8List(1+I);D[0]=AbB+gV(C,A);A++ ;G=1;}AbB=Oi(C,A,B,D,G);zaB.add(D);if(H)BbB(C,B);}void close()=>BbB();void BbB([List<int> A,int B]){if(AbB!=null){throw new FormatException("Input ended with incomplete encoded byte.",A,B);}zaB.close();}}int Oi(List<int> B,int D,int C,List<int> G,int H){var I=H;for(var A=D;A<C-1;A+= 2){var J=gV(B,A);var K=gV(B,A+1);G[I++ ]=16*J+K;}if((C-D).isEven)return null;return 16*gV(B,C-1);}const dAB=const Pi.zVB();class Pi extends Converter<List<int>,String>{const Pi.zVB();String convert(List<int> A)=>Qi(A,0,A.length);ByteConversionSink startChunkedConversion(Sink<String> A)=>new eu(A);}class eu extends ByteConversionSinkBase{final Sink<String> CbB;eu(this.CbB);void add(List<int> A){CbB.add(Qi(A,0,A.length));}void addSlice(List<int> A,int B,int C,bool D){RangeError.checkValidRange(B,C,A.length);CbB.add(Qi(A,B,C));if(D)CbB.close();}void close(){CbB.close();}}String Qi(List<int> C,int D,int G){var H=new Uint8List((G-D)*2);var J=0;var I=0;for(var A=D;A<G;A++ ){var B=C[A];I|= B;H[J++ ]=fu((B&0xF0)>>4);H[J++ ]=fu(B&0x0F);}if(I>=0&&I<=255)return new String.fromCharCodes(H);for(var A=D;A<G;A++ ){var B=C[A];if(B>=0&&B<=0xff)continue;throw new FormatException("Invalid byte ${B<0?"-":""}0x${B.abs().toRadixString(16)}.",C,A);}throw 'unreachable';}int fu(int A)=>A<10?A+cO:A+Fi-10;int gV(List<int> D,int G){var A=D[G];var B=cO^A;if(B<=9){if(B>=0)return B;}else{var C=0x20|A;if(Fi<=C&&C<=Ru)return C-Fi+10;}throw new FormatException("Invalid hexadecimal code unit " "U+${A.toRadixString(16).padLeft(4,'0')}.",D,G);}class CP{String DbB;final String IY;final String refreshToken;final Uri tokenEndpoint;final iT idToken;final List<String> ng;final DateTime expiration;bool get w8=>expiration!=null&&new DateTime.now().isAfter(expiration);bool get T7=>refreshToken!=null&&tokenEndpoint!=null;CP(this.IY,{this.refreshToken,this.tokenEndpoint,Iterable<String> scopes,this.expiration,this.idToken,String delimiter}):ng=new UnmodifiableListView(scopes==null?<String>[] :scopes.toList()),DbB=delimiter??' ';String FYB()=>JSON.encode({'accessToken':IY,'refreshToken':refreshToken,'tokenEndpoint':tokenEndpoint==null?null:tokenEndpoint.toString(),'scopes':ng,'expiration':expiration==null?null:expiration.millisecondsSinceEpoch});Future<CP> wTB({String identifier,String secret,Iterable<String> newScopes,bool basicAuth: true,dL httpClient})async{var A=this.ng;if(newScopes!=null)A=newScopes.toList();if(A==null)A=[] ;if(httpClient==null)httpClient=new dL();if(identifier==null&&secret!=null){throw new ArgumentError("secret may not be passed without identifier.");}var G=new DateTime.now();if(refreshToken==null){throw new StateError("Can't refresh credentials without a refresh " "token.");}else if(tokenEndpoint==null){throw new StateError("Can't refresh credentials without a token " "endpoint.");}var D=<String,String>{};var C={"grant_type":"refresh_token","refresh_token":refreshToken};if(!A.isEmpty)C["scope"]=A.join(DbB);if(basicAuth&&secret!=null){D["Authorization"]=Z2(identifier,secret);}else{if(identifier!=null)C["client_id"]=identifier;if(secret!=null)C["client_secret"]=secret;}var H=await httpClient.post(tokenEndpoint,headers:D,body:C);var B=await W2(H,tokenEndpoint,G,A,DbB);if(B.refreshToken!=null)return B;return new CP(B.IY,refreshToken:this.refreshToken,tokenEndpoint:B.tokenEndpoint,scopes:B.ng,expiration:B.expiration);}}abstract class dO{Stopwatch EbB=new Stopwatch()..start();gE message;dO(this.message);String toString()=>"PendingOp m=${message}";bool Is(IK A);done(){var A=EbB.elapsedMilliseconds;ii.mB("LDAP request serviced: ${message} (${A} ms)");}}class nu extends dO{StreamController<tF> FbB=new StreamController<tF>();sS GbB;sS get PUB=>GbB;nu(gE A):super(A){GbB=new sS(FbB.stream);}bool Is(IK A){if(A is kV){FbB.add(A.Xs);return false;}else if(A is di){if(A.GS.bH!=uB.uS){FbB.addError(A.GS.y7());}GbB.Sf=A.Sf;GbB.GS=A.GS;FbB.close();done();}else{assert(false);FbB.addError(new ci(null));FbB.close();done();}return true;}}class xu extends dO{var kN=new Completer<cB>();xu(gE A):super(A);bool Is(IK B){var A=B.GS;if(A.bH==uB.uS||A.bH==uB.ai||A.bH==uB.bi){kN.complete(A);}else{kN.completeError(A.y7());}done();return true;}}typedef bool Vi(X509Certificate _0);class ga{Queue<dO> HbB=new Queue<dO>();Map<int,dO> IbB=new Map();static const vAB=const Duration(seconds:3);bool JbB=false;Socket KbB;bool isClosed()=>KbB==null;int LbB=1;int MbB;String NbB;bool ObB;SecurityContext PbB;Vi QbB=null;Completer RbB;ga(this.NbB,this.MbB,this.ObB,this.QbB,[this.PbB]);Future<ga> connect()async{try {if(isClosed()){var B=(ObB)?SecureSocket.connect(NbB,MbB,onBadCertificate:QbB,context:PbB):Socket.connect(NbB,MbB);KbB=await B;RbB=new Completer();KbB.transform(iAB()).listen((C)=>SbB(C),onError:TbB,onDone:UbB);}return this;}on SocketException catch (A){if(A.osError!=null){if(A.osError.errorCode==61){throw new Yi(A,NbB,MbB);}else if(A.osError.errorCode==8){throw new Xi(A,NbB);}}rethrow;}}void SbB(gE A){var B=CBB.DBB(A);if(B is hi){PL.mB("Got extended response ${B.N_} code=${B.GS.bH}");}var C=IbB[A.IM];if(C==null)throw new ia("Server sent us an unknown message id = ${A.IM} opCode=${A.Js}");if(C.Is(B)){IbB.remove(A.IM);}if(A.Js==fi)JbB=false;}void TbB(A,StackTrace B){rD.oE("listen: onError",A,B);if(A is SocketException){if(A.osError!=null){if(A.osError.errorCode==61){throw new Yi(A,NbB,MbB);}else if(A.osError.errorCode==8){throw new Xi(A,NbB);}}throw new ha(A);}else{throw A;}}void UbB(){rD.kC("message stream done");assert(RbB!=null);RbB.complete();VbB();}sS rTB(gi B,List<QJ> C){if(isClosed()){throw new RQ("not connected");}var D=new gE( ++LbB,B,C);var A=new nu(D);WbB(A);return A.PUB;}Future<cB> process(eO B){if(isClosed()){throw new RQ("not connected");}var C=new gE( ++LbB,B);var A=new xu(C);WbB(A);return A.kN.future;}WbB(dO A){HbB.add(A);XbB();}XbB(){while(YbB()){var A=HbB.removeFirst();ZbB(A);}}bool YbB()=>(!HbB.isEmpty)&&(JbB==false);ZbB(dO A){ii.mB("[${A.message.IM}] Sending LDAP message: ${A.message}");var C=A.message.toBytes();ka.kC("[${A.message.IM}] Bytes sending: ${C}");KbB.add(C);IbB[A.message.IM]=A;if(A.message.Js==ei){JbB=true;}try {KbB.flush().then((D){ka.oE("[${A.message.IM}] Sent ${C.length} bytes");}).catchError((B){ka.BC("[${A.message.IM}] ${B}");throw B;});}catch (B){ka.BC("[${A.message.IM}] caught: ${B}");throw B;}}Future close(bool B)async{if(B||abB()){await VbB();}else{rD.oE("wait for queue to drain pendingResponse=${IbB}");var A=new Completer();new Timer.periodic(vAB,(Timer C){if(abB()){C.cancel();VbB().then((D)=>A.complete());}});await A.future;}if(RbB!=null){rD.kC("wait for message stream to be done");await RbB.future;}}bool abB(){if(IbB.isEmpty&&HbB.isEmpty){return true;}XbB();return false;}Future VbB()async{if(!isClosed()){await KbB.destroy();KbB=null;}}}class iV{static const int Zi=389;static const int Dv=636;ga bbB;bool cbB=true;static const String Rv="localhost";String NbB=Rv;String get host=>NbB;void WUB(String A){var B=(A!=null&&A.isNotEmpty)?A:Rv;if(B!=NbB){if(state==ConnectionState.ready||state==ConnectionState.bindRequired){throw new StateError("cannot change host while connection is open");}}NbB=B;}bool dbB=false;int MbB=Zi;SecurityContext PbB=null;int get port=>MbB;void aUB(bool B,[int A=null,SecurityContext C=null]){if(A!=null){if(A<0||65535<A){throw new ArgumentError.value(A,"port","outside range of 0-65535");}}B=(B==null||!B)?false:true;if(A==null){A=(B)?Dv:Zi;}if(B!=dbB||A!=MbB||C!=PbB){if(state==ConnectionState.ready||state==ConnectionState.bindRequired){throw new StateError("cannot change protocol while connection is open");}dbB=B;MbB=A;PbB=C;}}Vi N7;String ebB="";String fbB="";String gbB="";String hbB="";String get kPB=>ebB;Future<cB> bs(String A,String B)async{ibB(A,B);if(cbB){return await jbB(mustSend:false);}else{return null;}}bool get isAuthenticated{return (ebB.isNotEmpty);}List<Completer> kbB=new List<Completer>();List<Completer<cB>> lbB=new List<Completer<cB>>();var mbB;List<Completer> nbB=new List<Completer>();ConnectionState get state{if(bbB==null){return ConnectionState.closed;}else{if(bbB.isClosed()){return ConnectionState.disconnected;}else{if(ebB!=gbB||fbB!=hbB){return ConnectionState.bindRequired;}else{return ConnectionState.ready;}}}}iV({String host: null,bool ssl: false,int port: null,String bindDN: null,String password: null,Vi badCertificateHandler: null,SecurityContext context: null}){WUB(host);aUB(ssl,port,context);ibB(bindDN,password);N7=badCertificateHandler;this.cbB=true;}Future<cB> open()async{rD.mB("open: ${this.QE}");await obB(true);if(cbB){return await jbB(mustSend:false);}else{return null;}}Future close([bool A=false])async{rD.mB("close${A?": immediate":""}");if(kbB.isNotEmpty){var B=new Completer();kbB.add(B);await B.future;}switch (state){case ConnectionState.ready:case ConnectionState.bindRequired:await VbB(A);rD.oE("close: done");break;case ConnectionState.closed:rD.oE("close: was closed");break;case ConnectionState.disconnected:await bbB.close(A);rD.oE("close: was disconnected");break;}bbB=null;}Future<Object> VbB(bool C)async{assert(kbB.isEmpty);var B=new Completer();nbB.add(B);if(nbB.length==1){var A=null;try {rD.kC("close: started");await bbB.close(C);rD.kC("close: done");}catch (D){A=D;rethrow;}finally {for(var G in nbB){G.complete(A);}nbB.removeRange(0,nbB.length);}return null;}else{rD.kC("close in progress");var A=await B.future;if(A!=null){throw A;}return null;}}void ibB(String A,String B){if(A!=null&&A is!String){throw new ArgumentError.value(A,"bindDN","not a String");}if(B!=null&&B is!String){throw new ArgumentError.value(A,"password","not a String");}if(A==null||A.isEmpty){ebB="";fbB="";}else{ebB=A;fbB=B??"";}}Future obB(bool A)async{if(nbB.isNotEmpty){var B=new Completer();nbB.add(B);await B.future;}switch (state){case ConnectionState.closed:case ConnectionState.disconnected:if(A||cbB){if(A){rD.oE("explicit open");}else{rD.oE("automatic open: ${this.QE}");}await pbB();}else{throw new StateError("connection is not open: ${this.QE}");}break;case ConnectionState.bindRequired:case ConnectionState.ready:if(A&&!cbB){throw new StateError("cannot open: already open: ${this.QE}");}break;}}Future<Object> pbB()async{assert(nbB.isEmpty);assert(lbB.isEmpty);var B=new Completer<Object>();kbB.add(B);if(kbB.length==1){var A=null;try {rD.kC("opening connection: started");var C=new ga(NbB,MbB,dbB,N7??BBB,PbB);await C.connect();assert(bbB==null||bbB.isClosed());bbB=C;gbB="";hbB="";rD.kC("opening connection: done");}catch (D){A=D;rethrow;}finally {for(var G in kbB){G.complete(A);}kbB.removeRange(0,kbB.length);}return null;}else{rD.kC("open in progress");var A=await B.future;if(A!=null){throw A;}return null;}}Future qbB()async{switch (state){case ConnectionState.closed:if(cbB){await open();}else{assert(bbB==null);throw new StateError("connection not open");}break;case ConnectionState.disconnected:if(cbB){await open();}else{throw new Av();}break;case ConnectionState.bindRequired:if(cbB){await jbB(mustSend:false);}else{throw new StateError("connection requires BIND");}break;case ConnectionState.ready:break;}assert(state==ConnectionState.ready);}Future<cB> jbB({bool mustSend: true})async{assert(mustSend!=null);if(!mustSend){if(state==ConnectionState.closed||state==ConnectionState.disconnected){rD.oE("bind not required: connection not open");return null;}if(gbB==ebB&&hbB==fbB){rD.oE("bind not required: no change in credentials");return null;}}assert(bbB!=null&&!bbB.isClosed());if(mustSend){return await rbB();}else{return await sbB();}}Future<cB> sbB()async{rD.oE("automatic bind: ${(ebB.isNotEmpty)?ebB:"anonymous"}");assert(kbB.isEmpty);assert(nbB.isEmpty);var B=new Completer<cB>();lbB.add(B);if(lbB.length==1){mbB=null;cB A=null;try {rD.oE("explicit bind: ${(ebB.isNotEmpty)?ebB:"anonymous"}");A=await rbB();mbB=null;return A;}catch (C){A=null;mbB=C;rethrow;}finally {for(var D in lbB){D.complete(A);}lbB.removeRange(0,lbB.length);}}else{var A=await B.future;if(mbB){assert(A==null);throw mbB;}assert(A!=null);return A;}}Future<cB> rbB()async{var A=await bbB.process(new dw(this.ebB,this.fbB));if(A.bH==uB.uS){rD.oE("bind: success");gbB=ebB;hbB=fbB;}else{assert(false);return null;}return A;}Future<sS> og(String A,SB B,List<String> C,{int scope: lu.mu,int sizeLimit: 0,List<QJ> controls: null})async{rD.mB("search");await qbB();return bbB.rTB(new gi(A,B,C,scope,sizeLimit),controls);}Future<cB> add(String A,Map<String,dynamic> B)async{rD.mB("add: ${A}");await qbB();return await bbB.process(new cw(A,EH.qAB(B)));}Future<cB> delete(String A)async{rD.mB("delete: ${A}");await qbB();return await bbB.process(new bw(A));}Future<cB> rSB(String A,Iterable<hV> B)async{rD.mB("modify");await qbB();return await bbB.process(new ew(A,B));}static bool BBB(X509Certificate A){throw new Cv(A);}String get QE{if(dbB){return "ldaps://"+NbB+(MbB!=Dv?":${MbB}":"");}else{return "ldap://"+NbB+(MbB!=Zi?":${MbB}":"");}}}enum ConnectionState {closed,bindRequired,ready,disconnected}StreamTransformer<Uint8List,gE> iAB(){Uint8List B=null;return new StreamTransformer.fromHandlers(handleData:(Uint8List D,EventSink<gE> H){if(D==null||D.length==0){JK.mB("received: zero");return;}Uint8List A;if(B==null){JK.mB("received: ${D.length}");A=new Uint8List.view(D.buffer);}else{JK.mB("received: ${D.length} (+${B.length} leftover)");A=new Uint8List(B.length+D.length);A.setRange(0,B.length,B);A.setRange(B.length,A.length,D);B=null;}JK.kC(()=>"received: ${D}");assert(0<A.length);do{var C=null;var G;if(2<=A.length){int K=A[1];if(K&0x80==0){G=1;C=K&0x7F;}else{var M=(K&0x7F);if(2+M<=A.length){G=1+M;C=0;for(int N=2;N<M+2;N++ ){C<<= 8;C|= A[N]&0xFF;}}}}if(C!=null&&(1+G+C)<=A.length){var I=(1+G+C);JK.oE(()=>"parsed ASN.1 object: ${I} bytes");tw.mB(()=>"ASN.1 object received: tag=${A[0]}, length=${C}");tw.kC(()=>"ASN.1 value: ${new Uint8List.view(A.buffer,1+G,C)}");if(A[0]==10){JK.QB("LDAP stream transformer: got a tag 10 object");}var O=new gE.HWB(A);assert(O.qSB==I);H.add(O);if(A.length==I){A=null;}else{A=new Uint8List.view(A.buffer,A.offsetInBytes+I);}}else{B=A;A=null;}}while(A!=null);if(B==null){JK.oE("processed: all");}else{JK.oE("processed: leftover ${B.length} bytes");}},handleError:(Object J,StackTrace S,EventSink<gE> H){if(J is TlsException){TlsException Q=J;if(Q.osError==null&&Q.message=="OSStatus = -9805: connection closed gracefully error -9805"){JK.kC("LDAP stream transformer: closed gracefully"+((B==null)?"":": ${B.length} bytes left over"));return;}}JK.BC("LDAP stream transformer: error=${J}");throw J;},handleDone:(EventSink<gE> H){JK.kC("LDAP stream transformer: byte stream done");H.close();});}cC ea=new cC("ldap.control");abstract class QJ{String get sr;static const lAB=0xA0;bool HSB=false;ZC HJ()=>throw new Exception("Not implemented. Subclass must implement");QJ();static List<QJ> mAB(ZC A){ea.kC("Create Controls from ${A}");var B=[] ;if(A!=null){A.zB.forEach((C)=>B.add(oAB(C)));}return B;}static oAB(ZC A){var B=(A.zB.first as FD).bF;ea.kC("Got control ${B}");switch (B){case Wi.Bv:return new Wi.EWB(A.zB[1]);case Ui.pu:return new Ui.DWB(A.zB[1]);default:throw new Exception("Control ${B} not implemented");}}String toString()=>"${sr} ${this.runtimeType}, isCritical=${HSB}}";}class Ui extends QJ{static const pu="1.2.840.113556.1.4.474";String get sr=>pu;Ui.DWB(FD A){}}class Wi extends QJ{static const Bv="2.16.840.1.113730.3.4.10";get sr=>Bv;int l_;int g7;int B8=0;int mXB;Wi.EWB(FD B){var C=B.uJ;C[0]=Sa;var D=new ZC.lVB(C);ea.kC("Create control from ${B}  seq=${D}");var A=(D.zB.first as ZC);A.zB.forEach((G)=>ea.kC(" ${G.runtimeType}  ${G}"));l_=(A.zB[0] as gH).tG;g7=(A.zB[1] as gH).tG;B8=(A.zB[2] as gH).tG;}String toString()=>"${super.toString()}(targetpos=${l_}, contentCount=${g7},x=${B8})";}class EH{String tbB;Set ubB=new Set();String get name=>tbB;Set get values=>ubB;EH(String B,dynamic A){this.tbB=B;if(A is Iterable){ubB.addAll(A);}else{ubB.add(A);}}YP(dynamic A)=>ubB.add(A);String toString()=>"${ubB}";bool operator==(Object A)=>(A is EH&&tbB==A.tbB)&&ubB.containsAll(A.ubB)&&A.ubB.containsAll(ubB);static Map<String,EH> qAB(Map<String,dynamic> D){var B=new Map<String,EH>();D.forEach((C,A){B[C]=(A is EH?A:new EH(C,A));});return B;}}class SB{int vbB;int get zR=>vbB;String wbB;String get dPB=>wbB;String xbB;String get SY=>xbB;List<SB> ybB=new List<SB>();List<SB> get ks=>ybB;static const int ou=0xA0;static const int qu=0xA1;static const int ru=0xA2;static const int su=0xA3;static const int nAB=0xA4;static const int tu=0xA5;static const int uu=0xA6;static const int vu=0x87;static const int wu=0xA8;static const int pAB=0xA9;SB(this.vbB,[this.xbB,this.wbB,this.ybB]);static SB fa(String A,String B)=>new SB(su,A,B);static SB tS(List<SB> A)=>new SB(ou,null,null,A);static SB yu(List<SB> A)=>new SB(qu,null,null,A);static SB rAB(SB A)=>new SB(ru,null,null,[A]);static SB zu(String A)=>new SB(vu,A);static SB sAB(String A)=>new jV(A);static SB tAB(String A,String B)=>new SB(tu,A,B);static SB uAB(String A,String B)=>new SB(uu,A,B);static SB wAB(String A,String B)=>new SB(wu,A,B);SB operator&(SB A)=>SB.tS([this,A]);SB operator|(SB A)=>SB.yu([this,A]);String toString()=>"Filter(type=${vbB} attrName=${xbB} val=${wbB}, subFilters=${ybB})";yC HJ(){switch (zR){case SB.su:case SB.tu:case SB.uu:case SB.wu:var A=new ZC(tag:zR);A.add(new FD(SY));A.add(new FD(hAB.jAB(dPB)));return A;case SB.ou:case SB.qu:var B=new mS(tag:zR);ks.forEach((SB D){B.add(D.HJ());});return B;case SB.vu:return new FD(SY,tag:zR);case SB.ru:assert(ks!=null);var C=new mS(tag:zR);C.add(ks[0].HJ());return C;case SB.pAB:throw "Not Done yet. Fix me!!";default:throw new RQ("Unexpected filter type = ${zR}. This should never happen");}}}class jV extends SB{static const int xAB=0x80;static const int yAB=0x81;static const int zAB=0x82;String zbB;List<String> AcB=[] ;String BcB;String get p8=>zbB;List<String> get any=>AcB;String get E8=>BcB;jV(String C):super(SB.nAB){var B=C.split("=");if(B.length!=2||B[0]==""||B[1]==""){throw new RQ("Invalid substring pattern: expecting attr=match: '${C}'");}xbB=B[0];var G=B[1];var A=G.split("*");if(A.length==1){throw new RQ("Invalid substring pattern: missing '*': '${C}'");}if(!A.any((H)=>H.isNotEmpty)){throw new RQ("Invalid substring pattern: use \"present\" filter instead: '${C}'");}if(A[0]!=""){zbB=A[0];}if(A.last!=""){BcB=A.last;}for(int D=1;D<A.length-1; ++D){AcB.add(A[D]);}}yC HJ(){var B=new ZC(tag:zR);B.add(new FD(SY));var A=new ZC();if(p8!=null){A.add(new FD(p8,tag:jV.xAB));}any.forEach((String C)=>A.add(new FD(C,tag:jV.yAB)));if(E8!=null){A.add(new FD(E8,tag:jV.zAB));}B.add(A);return B;}String toString()=>"SubstringFilter(_init=${zbB}, any=${AcB}, fin=${BcB})";}abstract class OL implements Exception{String CcB;String get message=>CcB;OL(this.CcB);String toString()=>CcB;}class RQ extends OL{RQ(String A):super(A);}class Av extends OL{Av():super("connection disconnected");}class ha extends OL{SocketException QM;ha(this.QM,[String A="Socket exception"]):super(A){assert(QM!=null);}String toString()=>QM.toString();}class Xi extends ha{String jZ;Xi(SocketException A,this.jZ):super(A,"Server not found"){assert(QM!=null);assert(QM.osError!=null);assert(QM.osError.errorCode==8);}String toString()=>"Cannot connect to ${jZ}";}class Yi extends ha{int localPort;String jZ;int remotePort;Yi(SocketException A,this.jZ,this.remotePort):super(A,"Cannot establish connection"){assert(QM!=null);assert(QM.osError!=null);assert(QM.osError.errorCode==61);this.localPort=QM.port;}String toString()=>"Cannot connect to ${jZ}:${remotePort} from port ${localPort}";}class Cv extends OL{X509Certificate certificate;Cv(this.certificate):super("Bad X.509 certificate");String toString()=>"${message}: subject=${certificate.subject}; issuer=${certificate.issuer}";}class ia extends OL{ia(String A):super(A);}abstract class QC extends OL{cB DcB;cB get result=>DcB;QC(this.DcB):super("LDAP Result"){assert(result!=null);}String toString()=>DcB.toString();}class Ev extends QC{Ev(cB A):super(A);}class Fv extends QC{Fv(cB A):super(A);}class Gv extends QC{Gv(cB A):super(A);}class Hv extends QC{Hv(cB A):super(A);}class Iv extends QC{Iv(cB A):super(A);}class Jv extends QC{Jv(cB A):super(A);}class Kv extends QC{Kv(cB A):super(A);}class Lv extends QC{Lv(cB A):super(A);}class Mv extends QC{Mv(cB A):super(A);}class Nv extends QC{Nv(cB A):super(A);}class Ov extends QC{Ov(cB A):super(A);}class Pv extends QC{Pv(cB A):super(A);}class Qv extends QC{Qv(cB A):super(A);}class Sv extends QC{Sv(cB A):super(A);}class Tv extends QC{Tv(cB A):super(A);}class Uv extends QC{Uv(cB A):super(A);}class Vv extends QC{Vv(cB A):super(A);}class Wv extends QC{Wv(cB A):super(A);}class Xv extends QC{Xv(cB A):super(A);}class Yv extends QC{Yv(cB A):super(A);}class Zv extends QC{Zv(cB A):super(A);}class av extends QC{av(cB A):super(A);}class bv extends QC{bv(cB A):super(A);}class ja extends QC{ja(cB A):super(A);}class dv extends QC{dv(cB A):super(A);}class hv extends QC{hv(cB A):super(A);}class kv extends QC{kv(cB A):super(A);}class ov extends QC{ov(cB A):super(A);}class sv extends QC{sv(cB A):super(A);}class wv extends QC{wv(cB A):super(A);}class Aw extends QC{Aw(cB A):super(A);}class Fw extends QC{Fw(cB A):super(A);}class Jw extends QC{Jw(cB A):super(A);}class Pw extends QC{Pw(cB A):super(A);}class Tw extends QC{Tw(cB A):super(A);}class Yw extends QC{Yw(cB A):super(A);}class Zw extends QC{Zw(cB A):super(A);}class ci extends QC{ci(cB A):super(A);}class cB{int EcB;String FcB;String GcB;List<String> HcB;int get bH=>EcB;String get l7=>FcB;cB(this.EcB,this.GcB,this.FcB,this.HcB){}String toString()=>uB.aw(EcB)+((FcB!=null&&FcB.isNotEmpty)?": ${FcB}":"")+((GcB!=null&&GcB.isNotEmpty)?": ${GcB}":"");OL y7(){switch (bH){case uB.cv:return new Ev(this);break;case uB.ev:return new Fv(this);break;case uB.fv:return new Gv(this);break;case uB.gv:return new Hv(this);break;case uB.iv:return new Iv(this);break;case uB.jv:return new Jv(this);break;case uB.lv:return new Kv(this);break;case uB.mv:return new Lv(this);break;case uB.nv:return new Mv(this);break;case uB.pv:return new Nv(this);break;case uB.qv:return new Ov(this);break;case uB.rv:return new Pv(this);break;case uB.tv:return new Qv(this);break;case uB.uv:return new Sv(this);break;case uB.vv:return new Tv(this);break;case uB.xv:return new Uv(this);break;case uB.yv:return new Vv(this);break;case uB.zv:return new Wv(this);break;case uB.Bw:return new Xv(this);break;case uB.Cw:return new Yv(this);break;case uB.Dw:return new Zv(this);break;case uB.Ew:return new av(this);break;case uB.Gw:return new bv(this);break;case uB.Hw:return new ja(this);break;case uB.Iw:return new dv(this);break;case uB.Kw:return new hv(this);break;case uB.Lw:return new kv(this);break;case uB.Mw:return new ov(this);break;case uB.Nw:return new sv(this);break;case uB.Ow:return new wv(this);break;case uB.Qw:return new Aw(this);break;case uB.Rw:return new Fw(this);break;case uB.Sw:return new Jw(this);break;case uB.Uw:return new Pw(this);break;case uB.Vw:return new Tw(this);break;case uB.Ww:return new Yw(this);break;case uB.Xw:return new Zw(this);break;default:assert(bH!=uB.uS);assert(bH!=uB.ai);assert(bH!=uB.bi);return new ci(this);break;}}}class tF{String get cq=>IcB;String IcB;final List<String> JcB;List<String> get BQ=>JcB;Map<String,EH> get JB=>KcB;Map<String,EH> KcB=new Map<String,EH>();tF(this.IcB,{List<String> referrals: const[] }):JcB=referrals;String toString()=>"Entry[${IcB},${KcB}]";}class uB{static const uS=0;static const cv=1;static const ev=2;static const fv=3;static const gv=4;static const ai=5;static const bi=6;static const iv=7;static const jv=8;static const lv=9;static const mv=11;static const nv=12;static const pv=13;static const qv=14;static const rv=16;static const tv=17;static const uv=18;static const vv=19;static const xv=20;static const yv=21;static const zv=32;static const Bw=33;static const Cw=34;static const Dw=35;static const Ew=36;static const Gw=48;static const Hw=49;static const Iw=50;static const Kw=51;static const Lw=52;static const Mw=53;static const Nw=54;static const Ow=64;static const Qw=65;static const Rw=66;static const Sw=67;static const Uw=68;static const Vw=69;static const Ww=71;static const Xw=80;static final Map<int,String> ABB={uS:"OK",cv:"Operations error",ev:"Protocol error",fv:"Time limit exceeded",gv:"Size limit exceeded",ai:"Compare false",bi:"Compare true",iv:"Auth method not supported",jv:"Strong auth required",lv:"Referral",mv:"Admin limit exceeded",nv:"Unavailable critical extension",pv:"Confidentiality required",qv:"SASL bind in progress",rv:"No such attribute",tv:"Undefined attribute type",uv:"Inappropriate matching",vv:"Constraint violation",xv:"Attribute or value exists",yv:"Invalid attribute syntax",zv:"No such object",Bw:"Alias problem",Cw:"Invalid DN syntax",Dw:"Is leaf",Ew:"Alias dereferencing problem",Gw:"Inappropriate authentication",Hw:"Invalid credentials",Iw:"Insufficient access rights",Kw:"Busy",Lw:"Unavailable",Mw:"Unwilling to perform",Nw:"Loop detect",Ow:"Naming violation",Qw:"Object class violation",Rw:"Not allowed on nonleaf",Sw:"Not allowed on RDN",Uw:"Entry already exists",Vw:"Object class mods prohibited",Ww:"Affects multiple DSAS",Xw:"Other"};static String aw(int A)=>ABB[A]??"LDAP result code ${A}";}class hAB{static String jAB(String C){StringBuffer A=new StringBuffer();C.codeUnits.forEach((B){switch (B){case 0x2a:case 0x28:case 0x29:case 0x00:case 0x5c:A.write('\\');A.write(B.toRadixString(16));break;default:A.writeCharCode(B);break;}});return A.toString();}}class hV{static const int kAB=2;String LcB;List ubB=new List();int McB;String get SY=>LcB;int get TTB=>McB;List get values=>ubB;hV.CWB(this.LcB,this.ubB){McB=kAB;}}class sS{cB GS;sS(this.NcB);Stream<tF> get stream=>NcB;Stream<tF> NcB;List<QJ> Sf;}class lu{static const int mu=2;}dynamic get h1=>VIB;dynamic VIB=new yl('initializeDateFormatting(<locale>)',KIB);qW i1;String j1;dynamic WIB=new yl('initializeDateFormatting(<locale>)',LIB);class qW{String NAME;List<String> ERAS;List<String> ERANAMES;List<String> NARROWMONTHS;List<String> STANDALONENARROWMONTHS;List<String> MONTHS;List<String> STANDALONEMONTHS;List<String> SHORTMONTHS;List<String> STANDALONESHORTMONTHS;List<String> WEEKDAYS;List<String> STANDALONEWEEKDAYS;List<String> SHORTWEEKDAYS;List<String> STANDALONESHORTWEEKDAYS;List<String> NARROWWEEKDAYS;List<String> STANDALONENARROWWEEKDAYS;List<String> SHORTQUARTERS;List<String> QUARTERS;List<String> AMPMS;List<String> DATEFORMATS;List<String> TIMEFORMATS;List<String> DATETIMEFORMATS;Map<String,String> AVAILABLEFORMATS;int FIRSTDAYOFWEEK;List<int> WEEKENDRANGE;int FIRSTWEEKCUTOFFDAY;qW({this.NAME,this.ERAS,this.ERANAMES,this.NARROWMONTHS,this.STANDALONENARROWMONTHS,this.MONTHS,this.STANDALONEMONTHS,this.SHORTMONTHS,this.STANDALONESHORTMONTHS,this.WEEKDAYS,this.STANDALONEWEEKDAYS,this.SHORTWEEKDAYS,this.STANDALONESHORTWEEKDAYS,this.NARROWWEEKDAYS,this.STANDALONENARROWWEEKDAYS,this.SHORTQUARTERS,this.QUARTERS,this.AMPMS,this.DATEFORMATS,this.TIMEFORMATS,this.AVAILABLEFORMATS,this.FIRSTDAYOFWEEK,this.WEEKENDRANGE,this.FIRSTWEEKCUTOFFDAY,this.DATETIMEFORMATS});toString()=>NAME;}var KIB=new qW(NAME:"en_US",ERAS:const['BC','AD'],ERANAMES:const['Before Christ','Anno Domini'],NARROWMONTHS:const['J','F','M','A','M','J','J','A','S','O','N','D'],STANDALONENARROWMONTHS:const['J','F','M','A','M','J','J','A','S','O','N','D'],MONTHS:const['January','February','March','April','May','June','July','August','September','October','November','December'],STANDALONEMONTHS:const['January','February','March','April','May','June','July','August','September','October','November','December'],SHORTMONTHS:const['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],STANDALONESHORTMONTHS:const['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],WEEKDAYS:const['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],STANDALONEWEEKDAYS:const['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],SHORTWEEKDAYS:const['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],STANDALONESHORTWEEKDAYS:const['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],NARROWWEEKDAYS:const['S','M','T','W','T','F','S'],STANDALONENARROWWEEKDAYS:const['S','M','T','W','T','F','S'],SHORTQUARTERS:const['Q1','Q2','Q3','Q4'],QUARTERS:const['1st quarter','2nd quarter','3rd quarter','4th quarter'],AMPMS:const['AM','PM'],DATEFORMATS:const['EEEE, MMMM d, y','MMMM d, y','MMM d, y','M/d/yy'],TIMEFORMATS:const['h:mm:ss a zzzz','h:mm:ss a z','h:mm:ss a','h:mm a'],FIRSTDAYOFWEEK:6,WEEKENDRANGE:const[5,6],FIRSTWEEKCUTOFFDAY:5,DATETIMEFORMATS:const['{1} \'at\' {0}','{1} \'at\' {0}','{1}, {0}','{1}, {0}']);var LIB=const{'d':'d','E':'EEE','EEEE':'EEEE','LLL':'LLL','LLLL':'LLLL','M':'L','Md':'M/d','MEd':'EEE, M/d','MMM':'LLL','MMMd':'MMM d','MMMEd':'EEE, MMM d','MMMM':'LLLL','MMMMd':'MMMM d','MMMMEEEEd':'EEEE, MMMM d','QQQ':'QQQ','QQQQ':'QQQQ','y':'y','yM':'M/y','yMd':'M/d/y','yMEd':'EEE, M/d/y','yMMM':'MMM y','yMMMd':'MMM d, y','yMMMEd':'EEE, MMM d, y','yMMMM':'MMMM y','yMMMMd':'MMMM d, y','yMMMMEEEEd':'EEEE, MMMM d, y','yQQQ':'QQQ y','yQQQQ':'QQQQ y','H':'HH','Hm':'HH:mm','Hms':'HH:mm:ss','j':'h a','jm':'h:mm a','jms':'h:mm:ss a','jmv':'h:mm a v','jmz':'h:mm a z','jz':'h a z','m':'m','ms':'mm:ss','s':'s','v':'v','z':'z','zzzz':'zzzz','ZZZZ':'ZZZZ'};class Ey extends mC{Ey(String B,i A,LD C):super(B,A){TL.ij(C.yp);new mC('/sys/audit/enabled',A)..L[r'$type']='bool'..q(TL.cQ);new Oy('/sys/audit/config',A);new Ry('/sys/audit/query',A);}}class Oy extends mC{Oy(String A,i B):super(A,B){L[r'$invokable']='config';B$();}B$(){L[r'$params']=[{'name':'Data','type':'string','editor':'textarea','default':oC.qH(TL.iEB(),pretty:true)}];gB(r'$params');}W invoke(Map B,d G,W A,KB H,[int I=f.o]){if(B['Data'] is String){String C=B['Data'];if(C.trim().isEmpty){TL.ij(null);GD.FW('audit',null);provider.pB('/sys/audit/enabled').q(false);}else{try {var D=JSON.decode(C);if(TL.ij(D)){B$();GD.FW('audit',D);provider.pB('/sys/audit/enabled').q(TL.cQ);}else{return A..close(a.SC);}}catch (J){return A..close(a.SC);}}}return A..close();}}class Ry extends mC{Ry(String A,i B):super(A,B){L[r'$invokable']='config';L[r'$result']='table';L[r'$params']=[{'name':'Source','type':'string'},{'name':'Action','type':'enum[all,invoke,set,connect,disconnect]'},{'name':'Path','type':'string'},{'name':'Date','type':'daterange'}];L[r'$columns']=[{'name':'Time','type':'string'},{'name':'Source','type':'string'},{'name':'Action','type':'string'},{'name':'Path','type':'string'},{'name':'Parameter','type':'dynamic'}];}W invoke(Map A,d fC,W D,KB rC,[int ED=f.o]){String O;String Q;String S;String G;String J;String K;int M;int I;if(A['Date'] is String){G=A['Date'];}if(A['Path'] is String&&(A['Path'] as String).isNotEmpty){S=A['Path'];}if(A['Action'] is String&&A['Action']!='all'&&(A['Action'] as String).isNotEmpty){Q=A['Action'];}if(A['Source'] is String&&(A['Source'] as String).isNotEmpty){O=A['Source'];}if(G!=null){List V=G.split('/');if(V.length==2){try {DateTime C=DateTime.parse(V[0]).toLocal();J=C.toIso8601String();M=new DateTime(C.year,C.month,C.day).millisecondsSinceEpoch;C=DateTime.parse(V[1]).toLocal();K=C.toIso8601String();I=new DateTime(C.year,C.month,C.day,23,59,59,999).millisecondsSinceEpoch;if(I-M>1000000000000){return D..close(a.SC);}}catch (N){return D..close(a.SC);}}}if(I<0){DateTime B=new DateTime.now();J=new DateTime(B.year,B.month,B.day).toIso8601String();K=new DateTime(B.year,B.month,B.day,23,59,59,999).toIso8601String();M=new DateTime(B.year,B.month,B.day).millisecondsSinceEpoch;I=new DateTime(B.year,B.month,B.day,23,59,59,999).millisecondsSinceEpoch;}String IB=J.substring(0,10);String LB=K.substring(0,10);bool r=false;D.ZF=(D){r=true;};const int UB=3600*1000*24;(()async{try {for(int b=M;b<=I;b+= UB){String G=new DateTime.fromMillisecondsSinceEpoch(b).toIso8601String().substring(0,10);bool aB=G==IB;bool qB=G==LB;String EB;try {EB=await (new File('audit/${G}')).readAsString();}catch (N){continue;}finally {if(r)return;}List<String> CC=EB.split('\n');List h=[] ;for(String FC in CC){try {List H=JSON.decode(FC);if(aB&&J.compareTo(H[0])>0)continue;if(qB&&K.compareTo(H[0])<0)continue;if(O!=null&&H[1]!=O)continue;if(Q!=null&&H[2]!=Q)continue;if(S!=null&&!(H[3] as String).startsWith(S))continue;h.add(H);}catch (N){}}if(!h.isEmpty){D.TB(h,streamStatus:DC.nM);}}}catch (N){fB.QB('error reading audit log: ${N}');}D.close();})();return D;}}class TL extends Qk{static bool cQ=false;static List dj=['/sys'];static bool Mb=false;static bool Ky=false;static List ej=[] ;static List fj=['getHistory'];static List hj=[] ;static bool ij(Map A){if(A==null){cQ=false;return true;}if(A['auditConnect'] is bool&&A['auditDisconnect'] is bool&&A['paths'] is List&&A['auditAttributes'] is List&&A['ignoreActions'] is List&&A['ignorePoints'] is List){cQ=true;dj=A['paths'];Mb=A['auditConnect'];Ky=A['auditDisconnect'];ej=A['auditAttributes'];fj=A['ignoreActions'];hj=A['ignorePoints'];return true;}return false;}static Map iEB(){return {'paths':dj,'auditConnect':Mb,'auditDisconnect':Ky,'auditAttributes':ej,'ignoreActions':fj,'ignorePoints':hj};}static String kj;static IOSink Qb;static Future<IOSink> jEB(String B)async{String A=B.substring(0,10);if(A!=kj){var C=(await new File('audit/${A}').create(recursive:true)).openWrite(mode:APPEND);if(Qb!=null){Qb.close();}Qb=C;kj=A;}return Qb;}static Qy(String B,String A)async{try {(await jEB(B)).writeln(A);}catch (C){fB.QB('failed to write audit log: ${A}.  ${C}');kj=null;}}static Object Rb(Object A,int C){if(A==null||A is num||A is String||A is bool){return A;}if(A is List){if(C==0||A.length>100){return '[List length${A.length}]';}var B=[] ;for(var D in A){B.add(Rb(D,C-1));}return B;}if(A is Map){if(C==0||A.length>100){return '[Map length${A.length}]';}var B={};A.forEach((G,D){B[G]=Rb(D,C-1);});return B;}if(A is ByteData){return '[ByteData length${A.lengthInBytes}]';}return '[${A.runtimeType}]';}static DW(d C,String D,NB G,Object H)async{String B;if(G!=null){B=G.path;}else{String A=new DateTime.now().toIso8601String();Qy(A,JSON.encode([A,C.DQ,D,null,Rb(H,2)]));return;}for(String I in dj){if(B.startsWith(I)){String A=new DateTime.now().toIso8601String();Qy(A,JSON.encode([A,C.DQ,D,B,Rb(H,2)]));return;}}}TL(jF A,String B):super(A,B);FB AI(FB B,[NB A=null,Object C]){if(cQ&&A!=null){switch (B.type){case 'invoke':{if(!fj.contains(A.name)){DW(this,B.type,A,C);}}break;case 'set':{if(A.yY){if(!hj.contains(A.name)){DW(this,B.type,A,C);}}else if(A.Tr){if(ej.contains(A.name)){DW(this,B.type,A,C);}}break;}}}return super.AI(B,A,C);}void DJ(){if(cQ&&Mb){DW(this,'disconnect',null,null);}super.DJ();}void JM(){if(cQ&&Mb){DW(this,'connect',null,null);}super.JM();}}class Gy extends j{}class IF extends i{static bool gEB=const bool.fromEnvironment("dglux.server.watcher",defaultValue:false);static String My;static j BW;static int Ny=0;bj hUB;IF(bool C,bool D,List G,String H,cW I,bool J):super(enabledQuarantine:C,acceptAllConns:D,defaultPermission:G,downstreamName:H,storage:I,strictTls:J){cs=(String B,dynamic A){if(X==null){return;}if(B=="quarantine"&&A is bool){X.gZ=A;}if(B=="allowAllLinks"&&A is bool){X.Af=A;}if(B=="defaultPermission"&&A is List){X.defaultPermission=A;}X.xG();};hUB=new bj(this);}static LD gM;void Qr(){super.Qr();var B=new Cz("/sys/get_server_log",this);var C=new by("/sys/clear_server_log",this);var A=new j("/sys/build_number",this);A.L[r"$name"]="Server Build";A.L[r"$type"]="string";v("/sys/build_number",A);A.q(My);v(B.path,B);v(C.path,C);v("/sys/links",new eM("/sys/links",this));new XG("/sys/${XG.fM}",this);if(IF.gEB){var K=new rj("/sys/restart_server",this);v("/sys/restart_server",K);}var M=new ZI("/sys/update_server",this);var D=new nj("/sys/update_server_file",this);var N=new Hz("/sys/update_all",this);var G=new gQ("/sys/update_vm_file",this);var H=new Kk("/sys/update_vm_url",this);var I=new fQ("/sys/users",this);v("/sys/users",I);var J=new Hk("/sys/users/createUser",this);v("/sys/users/createUser",J);I.sB("createUser",J);v("/sys/update_server",M);BW=new j("/sys/handledRequests",this);BW.L.addAll({r"$name":"HTTP Request Count",r"$type":"number"});v(BW.path,BW);v("/sys/update_all",N);v(D.path,D);var O=new ey("/sys/config",this,gM);v("/sys/config",O);var Q=new Ek("/sys/export_server",this);v("/sys/export_server",Q);v(G.path,G);v(H.path,H);new Mz("/sys/corsProxyRules",this);new Ey("/sys/audit",this,gM);}void CUB(String A){String B="/sys/links/${A}";CQ(B);}void CQ(String B){NB A=new NB(B);j D=OB(A.AC,false);for(String G in D.Z.keys){CQ("${B}/${G}");}j C=OB(A.AC,false);C.Z.remove(A.name);C.gB(A.name);m.remove(B);}void v(String G,s B){s C=m[G];NB D=new NB(G);s A=m[D.AC];if(C!=null&&A!=null){if(C is Gy){C.i9();}A.hg(D.name);}if(C!=null){B.pC.addAll(C.pC);B.q9(C.QG);}if(A==null){A=new j(D.AC,this);v(D.AC,A);}if(B is Gy){B.Qg();}m[G]=B;A.sB(D.name,B);A.QG.add(r"is");}d dY(String A,String B){if(A is String&&A.length<43&&B!=""){if(B.length==18){return new Py(this,A);}else{return new Fy(this,A);}}else{return new TL(this,A);}}AUB(List<g> G)async{{Map A={};File C=new File("usernodes.json");try {String D=await C.readAsString();A=oC.AG(D);}catch (H){}for(g B in G){if(B!=null&&A[B.username] is!Map){A[B.username]={r"$is":"broker/userRoot"};}}await C.writeAsString(oC.qH(A,pretty:true));}{File C=new File("tokens.json");Map A={};try {String D=await C.readAsString();A=oC.AG(D);}catch (H){}for(g B in G){if(B!=null&&A[B.username] is!Map){A[B.username]={r"$is":"broker/tokenGroup"};}}await C.writeAsString(oC.qH(A,pretty:true));}await cr();await Ig();}cr()async{File D=new File("usernodes.json");try {String G=await D.readAsString();Map A=oC.AG(G);A.forEach((String B,Map A){String H='/users/${B}';KW C=OB(H,false);C.LI([[B,'config'],['default','none']]);C.load(A);Ba.Z[B]=C;});Ba.gB(r"$is");}catch (I){}}Ig()async{super.Ig();File G=new File("tokens.json");try {String H=await G.readAsString();Map A=oC.AG(H);A.forEach((String D,Map A){String B='/sys/tokens/${D}';TJ C=new TJ(B,this,D);C.load(A);});}catch (I){String B='/sys/tokens/root';TJ C=new TJ(B,this,'root');C.init();}}}class by extends j{by(String A,i B):super(A,B){L[r"$name"]="Clear Server Log";L[r"$invokable"]="write";L[r"$result"]="values";L[r"$columns"]=[{"name":"success","type":"bool"}];L[r"$actionGroup"]="Server Log";L[r"$actionGroupSubTitle"]="Clear";}W invoke(Map C,d D,W A,KB G,[int H=f.o]){new Future(()async{var B=new File("logs/dglux_server.log");if(!(await B.exists())){A.TB([{"success":false}]);A.close(new a("logNotFound",msg:"Log file not found.",path:path));return;}try {await B.writeAsBytes([] );}catch (I){}A.TB([{"success":true}]);A.close();});return A;}}class rj extends j{static Function cy;rj(String A,i B):super(A,B){L[r"$name"]="Restart Server";L[r"$invokable"]="write";}W invoke(Map B,d C,W A,KB D,[int G=f.o]){new Future(()async{await cy();});return A..close();}}class ey extends j{ey(String B,i A,LD C):super(B,A){new Future(()async{GD J;GD K;GD M;GD N;GD O;GD Q;GD S;GD V;GD b;GD h;GD H;GD EB;GD r;Vb UB;j G;j I;{J=new GD("port","${B}/port",A,C.port);J..L[r"$name"]="Server Port"..L[r"$type"]="int";sB("port",J);}{h=new GD("quarantine","${B}/quarantine",A,C.gZ);h..L[r"$name"]="Enable Quarantine"..L[r"$type"]="bool";sB("quarantine",h);}G=new j("${B}/advanced",A);I=new j("${B}/static",A);sB("advanced",G);sB("static",I);A.v(I.path,I);if(C.SM!=null){for(String IB in C.SM.keys){var aB=Uri.encodeComponent(IB);var D=new JT("${B}/static/${aB}",A);I.sB(aB,D);D.L[r"$name"]=IB;D.L[r"$type"]="string";D.L[r"$writable"]="write";D.q(C.SM[IB]);A.v(D.path,D);A.v("${D.path}/remove",D.HI("remove"));}}var LB=new my("/sys/config/static/add",A);I.sB("add",LB);A.v(LB.path,LB);{O=new GD("observe","${B}/advanced/observe",A,C.SZ);O..L[r"$name"]="Observatory"..L[r"$type"]="dynamic";G.sB("observe",O);}{S=new GD("distributionUrl","${B}/advanced/distributionUrl",A,C.bf);S..L[r"$name"]="Distribution Url"..L[r"$type"]="string";G.sB("distributionUrl",S);}{V=new GD("linkRepositoryUrl","${B}/advanced/linkRepositoryUrl",A,C.Hg);V..L[r"$name"]="Link Repository Url"..L[r"$type"]="string";G.sB("linkRepositoryUrl",V);}{Q=new GD("debug","${B}/advanced/debug",A,C.gU);Q..L[r"$name"]="Debug"..L[r"$type"]="bool";G.sB("debug",Q);}{K=new GD("httpsPort","${B}/httpsPort",A,C.ZH);K..L[r"$name"]="Secure Port"..L[r"$type"]="int";sB("httpsPort",K);}{M=new GD("workers","${B}/workers",A,C.LQ);M..L[r"$name"]="Workers"..L[r"$type"]="int";sB("workers",M);}{N=new GD("broadcast","${B}/broadcast",A,C.Jf);N..L[r"$name"]="Broadcast"..L[r"$type"]="bool";sB("broadcast",N);}{b=new GD("downstreamName","${B}/downstream",A,C.downstreamName);b..L[r"$name"]="Downstream Name"..L[r"$type"]="string";sB("downstream",b);}{H=new GD("loginRedirectPath","${B}/loginRedirectPath",A,C.CJ);H..L[r"$name"]="Login Redirect"..L[r"$type"]="string";sB("loginRedirectPath",H);}{EB=new GD("guestLoginRedirectPath","${B}/guestLoginRedirectPath",A,C.rY);EB..L[r"$name"]="Guest Login Redirect"..L[r"$type"]="string";sB("guestLoginRedirectPath",H);}{r=new GD("passwordExpireAfterDays","${B}/passwordExpireAfterDays",A,C.aZ);r..L[r"$name"]="Password Expire after Days"..L[r"$type"]="number"..L[r"$editor"]="int";;sB("passwordExpireAfterDays",r);}{UB=new Vb("${B}/smtp",A,C.map['smtp']);sB("smtp",UB);}A.v(J.path,J);A.v(K.path,K);A.v(M.path,M);A.v(N.path,N);A.v(b.path,b);A.v(G.path,G);A.v(O.path,O);A.v(Q.path,Q);A.v(S.path,S);A.v(V.path,V);A.v(h.path,h);A.v(H.path,H);A.v(EB.path,EB);A.v(r.path,r);});}}class GD extends j{static Function FW;final String x7;GD(this.x7,String A,i B,dynamic C):super(A,B){q(C);L[r"$writable"]="write";}FB PC(Object A,d C,FB B,[int D=f.o]){if((L[r"$type"]=="int"||L[r"$type"]=="number")&&A is String){try {A=num.parse(A);}catch (G){}}if(L[r"$type"]=="dynamic"&&(A=="true"||A=="false")){A=A=="true";}q(A);new Future(()async{await FW(x7,A);});B.close();return B;}}class uj extends mC{uj(String A,i B):super(A,B){L[r"$invokable"]="config";}C$(Map A){if(A==null){A={};}List B=[{"name":"server","type":"string","placeholder":"smtp.somedomain.com:465","default":A['server']},{"name":"username","type":"string","default":A['username']},{"name":"password","type":"string","editor":"password"},{"name":"from","type":"string","placeholder":"no-reply@somedomain.com","default":A['from']},{"name":"fromName","type":"string","placeholder":"DG Solution Builder","default":A['fromName']}];this.L[r'$params']=B;this.gB(r'$params');}W invoke(Map A,d D,W B,KB C,[int G=f.o]){if(A!=null&&A.containsKey('server')&&A.containsKey('username')&&A.containsKey('password')&&A.containsKey('from')&&A.containsKey('fromName')){GD.FW('smtp',A);C$(A);(C as Vb).q(A['server']);B.close();}else{B.close(a.SC);}}}class Vb extends mC{uj v;Map value;Vb(String B,i C,dynamic A):super(B,C){L[r"$type"]="string";L[r"$name"]="Smtp";if(A is Map&&A.containsKey('server')){q(A['server']);}v=new uj('${B}/Set',C);if(A is Map){value=A;}v.C$(A);sB('Set',v);}}class my extends j{my(String A,i B):super(A,B){L[r"$invokable"]="write";L[r"$result"]="values";L[r"$name"]="Add Static Directory";L[r"$params"]=[{"name":"serve","type":"string","description":"Server Path","placeholder":"/my_dir"},{"name":"target","type":"string","description":"Folder Path","placeholder":"static_dir/"}];}W invoke(Map G,d I,W H,KB J,[int K=f.o]){new Future(()async{var B=G["serve"];var C=G["target"];if(B==null||C==null){return;}if(B is String&&!B.startsWith("/")){B="/${B}";}var D=Uri.encodeComponent(B);var A=new JT("/sys/config/static/${D}",provider);provider.pB("/sys/config/static").sB(D,A);A.L[r"$name"]=B;A.L[r"$type"]="string";A.L[r"$writable"]="write";A.q(C);provider.v(A.path,A);provider.pB("/sys/config/static").QG.add(D);provider.v("${A.path}/remove",A.HI("remove"));await JT.ab(B,C);H.close();});return H;}}class ny extends j{ny(String A,i B):super(A,B){L[r"$invokable"]="write";L[r"$result"]="values";L[r"$name"]="Remove";new Future((){B.v(A,this);});}W invoke(Map J,d K,W B,KB M,[int N=f.o]){new Future(()async{var A=new NB(path);var H=Uri.decodeComponent(A.parent.name);var C=A.AC;await JT.ab(H,null);var I=provider.m.keys.where((D)=>D==C||D.startsWith(C+"/")).toList();var G=provider.pB("/sys/config/static");G.Z.remove(A.parent.name);I.forEach(provider.m.remove);G.QG.add(r"$is");B.close();});return B;}}class fQ extends j{static const List<String> oy=const['rootUrl','skipTwoFactorAuth','allowDesigner','groups'];fQ(String A,i B):super(A,B);List<g> bD=[] ;void BI(g A){if(Z.containsKey(A.username)){wG(A.username);}bD.add(A);hM B=new hM("/sys/users/${A.username}",provider);provider.v("/sys/users/${A.username}",B);var I=new vB("${B.path}/superuser");I.L.addAll({r"$type":"string",r"$name":"Superuser"});var J=new vB("${B.path}/email");J.L.addAll({r'$type':'string',r'$name':'E-mail'});var C=new vB("${B.path}/rootUrl");C.L.addAll({r"$type":"string",r"$name":"Login Url"});var D=new vB("${B.path}/allowDesigner");D.L.addAll({r"$type":"bool",r"$name":"Allow Designer"});var G=new vB("${B.path}/groups");G.L.addAll({r"$type":"string",r"$name":"Groups"});var H=new vB("${B.path}/skipTwoFactorAuth");H.L.addAll({r"$type":"bool",r"$name":"Skip 2FA"});if(A.metadata!=null&&A.metadata["rootUrl"] is String){C.q(A.metadata["rootUrl"]);}else{C.q("/");}if(A.metadata!=null&&A.metadata["skipTwoFactorAuth"] is bool){H.q(A.metadata["skipTwoFactorAuth"]);}else{H.q(false);}if(A.metadata!=null&&A.metadata["allowDesigner"] is bool){D.q(A.metadata["allowDesigner"]);}else{D.q(true);}if(A.metadata!=null&&A.metadata["groups"]!=null){var K=A.metadata["groups"];if(K is String){G.q(K);}else if(K is List){G.q(K.map((LB)=>LB.toString()).join(","));}}if(A.metadata!=null&&A.metadata.isNotEmpty){vB N=new vB('${B.path}/metadata');bool Q=false;var UB=A.metadata.keys;for(var O in UB){if(oy.contains(O))continue;if(!Q){provider.v(N.path,N);Q=true;}var S=ZW.aW(O);var M=new vB('${N.path}/${S}');M.L.addAll({r'$type':'dynamic',r'$name':S});M.q(A.metadata[O]);provider.v(M.path,M);}}I.q(A.pD);J.q(A.GE);B.VV=A;var V=new Gk("${B.path}/remove",provider);var b=new Fk("${B.path}/rename",provider);var h=new Zb("${B.path}/edit",provider);var r=new Bk("${B.path}/changePassword",provider);var EB=new Dk("${B.path}/verifyPassword",provider);var IB=new Ck("${B.path}/forcePasswordChange",provider);provider.v(h.path,h);provider.v(C.path,C);provider.v(D.path,D);provider.v(r.path,r);provider.v(EB.path,EB);provider.v(IB.path,IB);provider.v(V.path,V);provider.v(b.path,b);provider.v(I.path,I);provider.v(J.path,J);provider.v(G.path,G);provider.v(H.path,H);gB(A.username);}void J7(g A){if(sRB(A.username)){hM B=Z[A.username];provider.pB("${B.path}/superuser").q(A.pD);vB S=provider.pB("${B.path}/email");S.q(A.GE);vB C=provider.pB("${B.path}/groups");{var D=A.metadata["groups"];if(D is String){C.q(D);}else if(D is List){C.q(D.map((V)=>V.toString()).join(","));}}vB M=provider.pB("${B.path}/rootUrl");vB G=provider.pB("${B.path}/allowDesigner");vB N=provider.pB("${B.path}/skipTwoFactorAuth");if(A.metadata!=null&&A.metadata["rootUrl"] is String){M.q(A.metadata["rootUrl"]);}else{M.q("/");}if(A.metadata!=null&&A.metadata["allowDesigner"] is bool){G.q(A.metadata["allowDesigner"]);}else{G.q(true);}if(A.metadata!=null&&A.metadata["skipTwoFactorAuth"] is bool){N.q(A.metadata["skipTwoFactorAuth"]);}else{N.q(false);}if(A.metadata!=null&&A.metadata.isNotEmpty){vB H=null;var b=A.metadata.keys;for(var I in b){if(oy.contains(I))continue;if(H==null){H=provider.OB('${B.path}/metadata');}var K=ZW.aW(I);var J=provider.pB('${H.path}/${K}');if(J==null){J=new vB('${H.path}/${K}');J.L.addAll({r'$type':'dynamic',r'$name':K,'?value':A.metadata[I]});}else{J.q(A.metadata[I]);}}}B.VV=A;}else{BI(A);}hM B=provider.pB("/sys/users/${A.username}");Zb O=B.Z["edit"];String Q="/";if(A.metadata!=null&&A.metadata["rootUrl"] is String){Q=A.metadata["rootUrl"];}vB C=provider.pB("/sys/users/${A.username}/groups");vB G=provider.pB("/sys/users/${A.username}/allowDesigner");vB h=provider.pB("/sys/users/${A.username}/skipTwoFactorAuth");O.L[r"$params"]=[{"name":"superuser","type":"bool","default":A.pD},{"name":"email","type":"string","default":A.GE},{"name":"rootUrl","type":"string","default":Q},{"name":"allowDesigner","type":"bool","default":G.value==true},{"name":"groups","type":"string","default":C.value==null?"":C.value.toString()},{"name":"skipTwoFactorAuth","type":"bool","default":h.value==true}];O.gB(r"$params");}bool sRB(String A){return Z.containsKey(A);}void wG(String A){IF B=provider;if(Z.containsKey(A)){bD.removeWhere((C)=>C.username==A);B.CQ("/sys/users/${A}");}}}class Bk extends j{static Function xy;Bk(String A,i B):super(A,B){L[r"$invokable"]="write";L[r"$name"]="Change Password";L[r"$params"]=[{"name":"password","type":"string","editor":"password"}];}W invoke(Map B,d K,W A,KB M,[int N=f.o]){new Future(()async{try {NB C=new NB(path);String D=C.parent.name;hM G=provider.pB("/sys/users/${D}");String H=B["password"];var I=xy(G.VV.username,H);await I;}catch (J){A.close(new a("invokeError",msg:J));return;}A.close();});return A;}}class Ck extends j{static Function zy;Ck(String A,i B):super(A,B){L[r"$invokable"]="config";L[r"$name"]="Force Password Change";}W invoke(Map I,d J,W A,KB K,[int M=f.o]){new Future(()async{try {NB B=new NB(path);String C=B.parent.name;hM D=provider.pB("/sys/users/${C}");var G=zy(D.VV.username);await G;}catch (H){A.close(new a("invokeError",msg:H));return;}A.close();});return A;}}class Dk extends j{static Function Bz;static const int xEB=5;static const Duration yEB=const Duration(minutes:1);int Sq=0;DateTime rr=new DateTime.now();Dk(String A,i B):super(A,B){L[r"$invokable"]="read";L[r"$name"]="Verify Password";L[r"$result"]='table';L[r"$params"]=[{"name":"password","type":"string","editor":"password"}];L[r"$columns"]=[{"name":"authentication result","type":"bool"},{"name":"message","type":"string"}];}W invoke(Map D,d M,W A,KB N,[int O=f.o]){new Future(()async{try {NB G=new NB(path);String H=G.parent.name;hM I=provider.pB("/sys/users/${H}");String J=D["password"];if(!sPB){var B='Account frozen. Need to wait until ${rr.toIso8601String()} for the next attempt';A.TB([[false,B]]);return;}var C=await Bz(I.VV.username,J) as bool;if(!C){kSB();}else{Sq=0;}var B=C?'Success':'Wrong credentials';A.TB([[C,B]]);return;}catch (K){A.close(new a("invokeError",msg:K));return;}});return A;}void kSB(){ ++Sq;if(Sq>xEB){rr=new DateTime.now().add(yEB);}}bool get sPB=>rr.isBefore(new DateTime.now());}class Ek extends j{static Function Dz;Ek(String A,i B):super(A,B){L[r"$params"]=[{"name":"includeBrokerStorage","type":"bool","description":"Include Broker Storage","default":false},{"name":"includeLinks","type":"bool","description":"Include DSLinks","default":true},{"name":"includeKeys","type":"bool","description":"Include Broker/Link Keys","default":false},{"name":"includeWebAssets","type":"bool","description":"Include Solution Builder and other Web Assets","default":true},{"name":"includeConfiguration","type":"bool","description":"Include Configuration Files","default":true},{"name":"includeServerBuild","type":"bool","description":"Includes the DSA Server build","default":false},{"name":"includeLogs","type":"bool","description":"Include Log Files","default":false},{"name":"includeDataNodes","type":"bool","description":"Includes the Data Node configuration and storage","default":true},{"name":"includeAttributes","type":"bool","description":"Includes attributes that are set on nodes","default":true},{"name":"includeProjects","type":"bool","description":"Includes Solution Builder Projects","default":true},{"name":"includeServerConfiguration","type":"bool","description":"Include Server Configuration (server.json)","default":true}];L[r"$name"]="Export Server";L[r"$invokable"]="write";L[r"$result"]="values";L[r"$columns"]=[{"name":"zip","type":"binary","editor":"download","editorMeta":{"fileName":"dsa-server.zip"}}];}W invoke(Map B,d H,W A,KB I,[int J=f.o]){new Future(()async{try {var C=Dz(B);ByteData D=await C;A.TB([[D]]);A.close();}catch (G){A.close(new a("invokeError",msg:G));return;}A.close();});return A;}}class Zb extends j{static Function Gz;Zb(String A,i B):super(A,B){L[r"$invokable"]="write";L[r"$name"]="Edit User";}W invoke(Map A,d N,W C,KB O,[int D=f.o]){new Future(()async{try {if(D!=f.o){A["superuser"]=null;A["email"]=null;A["allowDesigner"]=null;A["groups"]=null;}NB G=new NB(path);String H=G.parent.name;hM I=provider.pB("/sys/users/${H}");var B=I.VV.wI(superuser:A["superuser"],email:A["email"]);if(B.metadata==null){B.metadata={};}if(A["rootUrl"] is String){B.metadata["rootUrl"]=A["rootUrl"];}if(A["allowDesigner"] is bool){B.metadata["allowDesigner"]=A["allowDesigner"];}if(A["groups"] is String){B.metadata["groups"]=(A["groups"] as String).split(",").map((J){return J.trim();}).toList();}if(A["skipTwoFactorAuth"] is bool){B.metadata["skipTwoFactorAuth"]=A["skipTwoFactorAuth"]==true;}var K=Gz(B);await K;}catch (M){C.close(new a("invokeError",msg:M));return;}C.close();});return C;}}class Fk extends j{static Function Iz;Fk(String A,i B):super(A,B){L[r"$invokable"]="config";L[r"$name"]="Rename User";L[r"$params"]=[{"name":"username","type":"string"}];}W invoke(Map C,d J,W A,KB K,[int M=f.o]){var B=C["username"];new Future(()async{try {if(B==null||B is!String){throw new Exception("Username not specified.");}NB D=new NB(path);String G=D.parent.name;var H=Iz(G,B);await H;}catch (I){A.close(new a("invokeError",msg:I));return;}A.close();});return A;}}class Gk extends j{static Function Jz;Gk(String A,i B):super(A,B){L[r"$invokable"]="config";L[r"$name"]="Remove User";}W invoke(Map I,d C,W A,KB J,[int K=f.o]){new Future(()async{try {NB D=new NB(path);String B=D.parent.name;var G=Jz(B);await G;provider.NE('add new user: ${B}',C);}catch (H){A.close(new a("invokeError",msg:H));return;}A.close();});return A;}}class hM extends j{g VV;hM(String A,i B):super(A,B){this.NI=[new iQ(A.split('/').last,f.lQ)];}}class Hk extends j{static Function Ik;Hk(String A,i B):super(A,B){L[r"$invokable"]="write";L[r"$result"]="values";L[r"$name"]="Create User";L[r"$params"]=[{"name":"username","type":"string","placeholder":"jdoe"},{"name":"superuser","type":"bool","default":false},{"name":"email","type":"string","placeholder":"jdoe@email.com"},{"name":"password","type":"string","placeholder":"MyPassword","editor":"password"}];}W invoke(Map C,d J,W D,KB O,[int Q=f.o]){new Future(()async{H(String K){D.close(new a("invokeError",msg:K));}var A=C["username"];var I=C["superuser"];String B=C["email"];var G=C["password"];if(A==null||A is!String||A.isEmpty){H("Username not provided.");return;}if(B!=null&&(B.isEmpty||B.trim().isEmpty)){B==null;}if(I is!bool){I=false;}if(G==null||G is!String||G.isEmpty){H("Password not provided.");return;}if(Ik==null){H("Creating Users isn't allowed right now.");return;}try {var M=Ik(A,I,B,G);await M;}catch (N){D.close(new a("invokeError",msg:N));return;}provider.NE('add new user: ${A}',J);D.close();});return D;}}class JT extends j{static Function ab;JT(String A,i B):super(A,B){var C=new ny("${A}/remove",B);sB("remove",C);}FB PC(Object A,d C,FB B,[int D=f.o]){q(A);new Future(()async{await ab(L[r"$name"],A);});B.close();return B;}}class gQ extends j{static Function Kz;static bool hO=false;gQ(String A,i B):super(A,B){L.addAll({r"$name":"Update Dart VM from Zip",r"$invokable":"write",r"$params":[{"name":"zip","type":"binary","editor":"fileinput","editorMeta":{"accept":"application/zip"}}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Update",r"$actionGroupSubTitle":"Dart VM from Zip"});if(Platform.isWindows){L[r"$hidden"]=true;}}W invoke(Map B,d G,W A,KB H,[int I=f.o]){if(hO==true){A.TB([[false,"VM Update already in progress."]]);return A..close();}hO=true;if(B["zip"] is!ByteData){A.TB([[false,"Zip is not valid binary"]]);hO=false;return A..close();}new Future(()async{try {var C=await Kz(B["zip"]);A.TB([[true,C]]);}catch (D){A.TB([[false,D.toString()]]);}hO=false;A.close();});return A;}}class Kk extends j{static Function Lz;Kk(String A,i B):super(A,B){L.addAll({r"$name":"Update Dart VM from Url",r"$invokable":"write",r"$params":[{"name":"url","type":"string","description":"Url to Dart VM zip file"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Update",r"$actionGroupSubTitle":"Dart VM from Url"});if(Platform.isWindows){L[r"$hidden"]=true;}}W invoke(Map B,d G,W A,KB H,[int I=f.o]){if(gQ.hO==true){A.TB([[false,"VM Update already in progress."]]);return A..close();}gQ.hO=true;if(B["url"] is!String){A.TB([[false,"Url was not specified."]]);gQ.hO=false;return A..close();}new Future(()async{try {var C=await Lz(B["zip"]);A.TB([[true,C]]);}catch (D){A.TB([[false,D.toString()]]);}gQ.hO=false;A.close();});return A;}}class Mz extends mC{Mz(String A,i B):super(A,B){L[r"$type"]="string";L[r"$writable"]="config";L[r"$editor"]="textarea";q(IF.gM.dP);Kb(IF.gM.dP);}FB PC(Object B,d D,FB C,[int G=f.o]){if(B is String){String A=Kb(B);q(A);if(IF.gM.dP!=A){IF.gM.dP=A;IF.gM.xG();t.WB.callMethod("setServerConfig",IF.gM);}}return C..close();}}class Fy extends TL{Fy(jF A,String B):super(A,B);void TG(Map A){if(A["paths"] is List){for(Object B in A["paths"]){if(B is Map){if(B["path"] is String){XG.AW.addSubscription(B["path"].hashCode);}}}}super.TG(A);}void invoke(Map A){Object B=A["path"];Object C=A["params"];if(B is String){if(C is Map){XG.AW.ye(B,C);}else{XG.AW.ye(B,null);}}super.invoke(A);}}class Py extends TL{Py(jF A,String B):super(A,B);void TG(Map A){if(XG.eQ.enabled){if(A["paths"] is List){for(Object B in A["paths"]){if(B is Map){if(B["path"] is String){XG.eQ.addSubscription(B["path"].hashCode);}}}}}super.TG(A);}void invoke(Map A){if(XG.eQ.enabled){Object B=A["path"];Object C=A["params"];if(B is String){if(C is Map){XG.eQ.ye(B,C);}else{XG.eQ.ye(B,null);}}}super.invoke(A);}}class cj{static const int Iy=61;static const int dEB=13;static const int Jy=10;static const String fEB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijk1mnopqrstuvwxyz0l23456789+/";static final List<int> jj=((){List<int> A=new List<int>(256);A.fillRange(0,256,-2);List<int> C=fEB.codeUnits;int D=C.length;for(int B=0;B<D; ++B){A[C[B]]=B;}A[dEB]=-1;A[Jy]=-1;A[32]=-1;A[Jy]=-1;A[Iy]=0;return A;})();static List<int> kEB(String B){int D=B.length;if(D==0){return new List<int>(0);}int K=0;for(int A=0;A<D;A++ ){int G=jj[B.codeUnitAt(A)];if(G<0){K++ ;if(G==-2){throw new FormatException('Invalid character: ${B[A]}');}}}if((D-K)%4!=0){throw new FormatException('''Size of Base 64 characters in Input
         must be a multiple of 4. Input: ${B}''');}int M=0;for(int A=D-1;A>=0;A-- ){int N=B.codeUnitAt(A);if(jj[N]>0)break;if(N==Iy)M++ ;}int I=(((D-K)*6)>>3)-M;List<int> J=new List<int>(I);for(int A=0,C=0;C<I;){int H=0;for(int O=4;O>0;){int G=jj[B.codeUnitAt(A++ )];if(G>=0){H=((H<<6)&0xFFFFFF)|G;O-- ;}}J[C++ ]=H>>16;if(C<I){J[C++ ]=(H>>8)&0xFF;if(C<I)J[C++ ]=H&0xFF;}}return J;}static n Ty(String A){return new n.tVB(1,kEB(A));}static String lEB(String I){List<int> C=ZM.convert(I);int H=C.length;int B=H;for(int D=0;D<H; ++D){int A=C[D];if(A<192){if(A>63){if(A&63!=63){int G=((A&63)+B)%63+1;B=(G*5)&63;C[D]=(A&192)|(B-1);}}else if(A>32){int G=((A&31)-1+B)%31+1;B=(G*3)&31;C[D]=B+32;}}}return RL.convert(C);}}class pj{static n mEB=new n((1<<16)+1);static n nEB=new n('FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',16);static n oEB=cj.Ty('AI/2nWN7fk9EyejllOJjcLQrMOrPprnbzkOe9afgVWtHluOmlEoTCnivtr3CgLttI2aa5KEGtWWelzYVGhyUwLyvRab+pZfeflNFMGT/2asIizfbTWTwyU4kFuyZVaCdhZuQRa2sMl8XQaOyXuymQqony+MrGskc5simXwb4anR7');static n Yy;static String pEB;static List<String> qEB;static List<String> rEB;static List<String> sEB;static Map Zy;static String tEB;static String uEB(Map A,String B){if(A==null){return 'invalidLicense';}String C=QL.convert(A);List<int> D=pj.vEB('DG'+C);n G=new n.tVB(1,D);Yy=cj.Ty(B);n H=Yy.modPow(mEB,oEB);if(H.oR(pj.nEB)==G){if(A['features'] is Map){Zy=A['features'];}else{Zy=null;}return null;}else{return 'invalidLicense';}}static List<int> vEB(String A){return da.convert(ZM.convert(A)).eC;}static String wEB(Map B){if(B==null||B['sig'] is!String||B['dglux'] is!Map){return 'invalidLicense';}Map A=B['dglux'];if(A['productId'] is!String){return '${'invalidLicense'} . ${'productId'} : ${A['productId']}';}pEB=A['productId'];if(A['hosts'] is!List&&A['paths'] is!List&&A['projs'] is!List){return 'invalidLicense';}qEB=A['hosts'];rEB=A['paths'];sEB=A['projs'];tEB=A['hash'];String C=A['expire'];if(C!=null){DateTime D=DateTime.parse(C);if(D.millisecondsSinceEpoch<new DateTime.now().millisecondsSinceEpoch){return 'invalidLicenseExpired'+C;}}return uEB(A,B['sig']);}}class XG extends mC{static const String cEB='dglux-dsa-';static const String eEB='atrius-dsa-';static const String Ly='dsa-';static const String fM='dglicense';static XG gj;static EW AW;static EW eQ;static j Nb;static j Ob;static j Pb;static String CW;static File hEB=YC.bb;Timer yTB;mC B_;XG(String B,i A):super(B,A){gj=this;AW=new EW('/sys/${fM}/topicsActual',A)..L[r"$name"]="Topic Actual";eQ=new EW('/sys/${fM}/topicsPreview',A)..L[r"$name"]="Topic Preview";new Vy('/sys/${fM}/topicsPreview/reset',A)..L[r"$name"]="Reset";Nb=new mC('/sys/${fM}/topicsLicensed',A)..L[r'$type']='string'..L[r"$name"]="Topics Licensed";Pb=new mC('/sys/${fM}/expirationDate',A)..L[r'$type']='string'..L[r"$name"]="Expiration Date";Ob=new mC('/sys/${fM}/licenseStatus',A)..L[r'$type']='string'..L[r"$name"]="License Status";B_=new mC('/sys/${fM}/productId',A)..L[r'$type']='string'..L[r"$name"]="Product ID"..q('${Ly}${CW}');new Wy('/sys/${fM}/uploadLicense',A);yTB=new Timer.periodic(const Duration(minutes:10),wPB);K9(null);}int C9=1;void wPB(Timer B){int A=(new DateTime.now()).day;if(A==1&&C9>1){AW.reset();}C9=A;}num Nh=0;bool K9(String B){try {String C;if(B!=null){C=B;}else{C=hEB.readAsStringSync();}Map D=oC.AG(C);Map A=D['dglux'];if(A['productId']!="*"&&A['productId']!='${Ly}${CW}'&&A['productId']!='${cEB}${CW}'&&A['productId']!='${eEB}${CW}'){throw 'invalid productId';}String G=pj.wEB(D);if(G!=null){Ob.q('invalid');}else{Ob.q('valid');B_.q(A['productId']);}if(A['topics'] is num){Nh=A['topics'];Nb.q(Nh.toString());}else{Nh=double.INFINITY;Nb.q('unlimited');}if(A['expire'] is String){Pb.q(A['expire']);}else{Pb.q('none');}return G==null;}catch (H){if(B==null){Nh=0;Nb.q('0');Ob.q('invalid');Pb.q('');}return false;}}String BVB(String A){return null;}}class EW extends mC{bool enabled=true;EW(String A,i B):super(A,B){L[r'$type']='int';q(0);}HashSet<int> dC=new HashSet<int>();HashSet<int> yf=new HashSet<int>();Timer OcB;void addSubscription(int A){if(!dC.contains(A)){dC.add(A);if(OcB==null){OcB=new Timer(const Duration(seconds:2),PcB);}}}void ye(String G,Map B){aj C=new aj(G);if(B!=null){B.forEach((String H,Object A){if(A is String&&A.length>16){C.uRB(H,A);}});}int D=C.fRB();if(!yf.contains(D)){yf.add(D);if(OcB==null){OcB=new Timer(const Duration(seconds:2),PcB);}}}void PcB(){OcB=null;q(dC.length+yf.length);}void reset(){dC.clear();yf.clear();q(0);}}class Vy extends mC{Vy(String A,i B):super(A,B){L[r'$invokable']='config';}W invoke(Map B,d C,W A,KB D,[int G=f.o]){XG.eQ.reset();return A..close();}}class Wy extends mC{Wy(String A,i B):super(A,B){L[r"$name"]="Update License";L[r'$invokable']='config';L[r'$params']=[{'name':'data','type':'string','editor':'textarea'}];}W invoke(Map A,d C,W B,KB D,[int G=f.o]){XG.gj.BVB(A["data"]);return B..close();}}class eM extends j{static eM dQ;static String zV(String A){return A.replaceAll(" ","_");}eM(String J,i A):super(J,A){dQ=this;var B=new wy("/sys/links/start_all",A);var C=new lj("/sys/links/rescan",A);var D=new qj("/sys/links/git_install",A);var G=new tj("/sys/links/zip_install",A);var H=new Sb("/sys/links/install",A);var I=new sj("/sys/links/file_install",A);sB("git_install",D);sB("zip_install",G);sB("file_install",I);sB("install",H);sB("rescan",C);sB("start_all",B);new Future((){A.v("/sys/links/rescan",C);A.v("/sys/links/git_install",D);A.v("/sys/links/file_install",I);A.v("/sys/links/zip_install",G);A.v("/sys/links/install",H);A.v("/sys/links/start_all",B);});}void MY(String C,String D,String G,String H,Map I,bool J){var A=zV(C);var B=new UK(C,D,G,"/sys/links/${A}",H,I,J,provider);B.L[r"$name"]=A;sB(A,B);provider.v(B.path,B);gB(A);}void CVB(String C,Map D){UK A=HI(zV(C));if(A!=null){D.forEach((G,H){var B=A.cY.HI(G);if(B!=null){B.q(H);}});}}void EJ(String A){var B=zV(A);(provider as IF).CUB(B);}void eE(String B,String C){UK A=HI(zV(B));if(A!=null){A.eE(C);}}void DVB(String B,String C,String D){UK A=HI(zV(B));if(A!=null){A.zUB(C,D);}}}class lj extends j{static Function Sy;lj(String A,i B):super(A,B){L[r"$name"]="Rescan";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}W invoke(Map B,d C,W A,KB D,[int G=f.o]){new Future(()async{await Sy();A.close();});return A;}}class ZI extends j{static Function mj;static bool TK=false;ZI(String A,i B):super(A,B){L.addAll({r"$name":"Update Server",r"$invokable":"write",r"$params":[] ,r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Update",r"$actionGroupSubTitle":"Server from Repository"});}W invoke(Map G,d B,W A,KB H,[int I=f.o]){if(TK==true){A.TB([[false,"Server Update already in progress."]]);return A..close();}ZI.TK=true;new Future(()async{try {var C=await mj();A.TB([C]);provider.NE('update server',B);}catch (D){A.TB([[false,D.toString()]]);}TK=false;A.close();});return A;}}class nj extends j{static Function Uy;nj(String A,i B):super(A,B){L.addAll({r"$name":"Update Server from Zip",r"$invokable":"write",r"$params":[{"name":"zip","type":"binary","editor":"fileinput","editorMeta":{"accept":"application/zip"}}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Update",r"$actionGroupSubTitle":"Server from Zip"});}W invoke(Map B,d C,W A,KB H,[int I=f.o]){if(ZI.TK==true){A.TB([[false,"Server Update already in progress."]]);return A..close();}ZI.TK=true;if(B["zip"] is!ByteData){A.TB([[false,"Zip is not valid binary"]]);ZI.TK=false;return A..close();}new Future(()async{try {var D=await Uy(B["zip"]);A.TB([D]);}catch (G){A.TB([[false,G.toString()]]);}ZI.TK=false;provider.NE('update server from file',C);A.close();});return A;}}class oj extends j{static Function Xy;final String CB;oj(this.CB,String A,i B):super(A,B){L.addAll({r"$invokable":"write",r"$name":"Export",r"$columns":[{"name":"message","type":"string"},{"name":"zip","type":"binary","editor":"download","editorMeta":{"fileName":"${CB}.zip"}}],r"$result":"values"});}W invoke(Map G,d B,W A,KB H,[int I=f.o]){new Future(()async{try {ByteData C=await Xy(CB);A.TB([["Success!",C]]);provider.NE('download link ${CB}',B);return A..close();}catch (D){A.TB([["Failed to download: ${D}",null]]);return A..close();}});return A;}}class qj extends j{static Function ay;qj(String A,i B):super(A,B){L.addAll({r"$name":"Install Link from Git",r"$invokable":"write",r"$params":[{"name":"name","type":"string"},{"name":"url","type":"string"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Install Link",r"$actionGroupSubTitle":"from Git"});}W invoke(Map B,d D,W A,KB G,[int H=f.o]){if(B["name"]==null){A.TB([[false,"parameter 'name' is required"]]);return A..close(a.SC);}if(B["url"]==null){A.TB([[false,"parameter 'url' is required"]]);return A..close(a.SC);}new Future(()async{var C=await ay(B["url"],B["name"]);A.TB([[C[0],C[1]]]);provider.NE('install link from git: ${B["url"]} ${B["name"]}',D);if(C[0]){A.close();}else{A.close(new a(C[1]));}});return A;}}class sj extends j{static Function dy;sj(String A,i B):super(A,B){L.addAll({r"$name":"Install Link from Zip",r"$invokable":"write",r"$params":[{"name":"name","type":"string"},{"name":"zip","type":"binary","editor":"fileinput","editorMeta":{"accept":"application/zip"}}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Install Link",r"$actionGroupSubTitle":"from Zip"});}W invoke(Map B,d D,W A,KB G,[int H=f.o]){if(B["name"] is!String){A.TB([[false,"parameter 'name' is required"]]);return A..close(a.SC);}if(B["zip"] is!ByteData){A.TB([[false,"parameter 'zip' is required to be binary"]]);return A..close(a.SC);}new Future(()async{var C=await dy(B["zip"],B["name"]);A.TB([[C[0],C[1]]]);provider.NE('install link from file: ${B["name"]}',D);if(C[0]){A.close();}else{A.close(new a(C[1]));}});return A;}}class Sb extends j{static Function fy;static Function gy;Timer ps;Sb(String A,i B):super(A,B){L.addAll({r"$name":"Install Link",r"$invokable":"write",r"$params":[{"name":"name","type":"string"},{"name":"link","type":"enum[]"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Install Link",r"$actionGroupSubTitle":"from Repository"});ps=new Timer.periodic(const Duration(hours:3),(C)async{await Aa();});new Future.delayed(const Duration(seconds:1),()async{await Aa();});}bool Wr=false;Aa()async{if(Wr){return;}Wr=true;String A;try {A=await gy();}catch (B){}Gg=A;(L[r"$params"] as List<Map<String,dynamic>>)[1]["type"]=A;gB(r"$params");E9=new DateTime.now();Wr=false;}void NS(){super.NS();if((Gg==null||Gg=="enum[]"||Gg.isEmpty)||E9.difference(new DateTime.now()).abs().inMinutes>=1){Aa();}}DateTime E9=new DateTime.fromMillisecondsSinceEpoch(0);String Gg;W invoke(Map B,d D,W A,KB G,[int H=f.o]){if(B["name"]==null){A.TB([[false,"parameter 'name' is required"]]);return A..close(a.SC);}if(B["link"]==null){A.TB([[false,"parameter 'link' is required"]]);return A..close(a.SC);}new Future(()async{var C=await fy(B["name"],B["link"]);A.TB([[C[0],C[1]]]);provider.NE('install link from repo: ${B["link"]} ${B["name"]}',D);if(C[0]){A.close();}else{A.close(new a(C[1]));}});return A;}}class tj extends j{static Function hy;tj(String A,i B):super(A,B){L.addAll({r"$name":"Install Link from Url",r"$invokable":"write",r"$params":[{"name":"name","type":"string"},{"name":"url","type":"string"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Install Link",r"$actionGroupSubTitle":"from Url"});}W invoke(Map B,d D,W A,KB G,[int H=f.o]){if(B["name"]==null){A.TB([[false,"parameter 'name' is required"]]);return A..close(a.SC);}if(B["url"]==null){A.TB([[false,"parameter 'url' is required"]]);return A..close(a.SC);}new Future(()async{var C=await hy(B["url"],B["name"]);A.TB([[C[0],C[1]]]);provider.NE('install link from url: ${B["url"]} ${B["name"]}',D);A.close();});return A;}}class Tb extends j{static Function iy;final String CB;Tb(this.CB,String A,i B):super(A,B){L.addAll({r"$name":"Update from Url",r"$invokable":"write",r"$params":[{"name":"url","type":"string"}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Update",r"$actionGroupSubTitle":"from Url"});}W invoke(Map B,d D,W A,KB G,[int H=f.o]){if(B["url"]==null){A.TB([[false,"parameter 'url' is required"]]);return A..close(a.SC);}new Future(()async{var C=await iy(CB,B["url"]);A.TB([[!C.toString().contains("Error"),C.toString()]]);provider.NE('update link from url: ${B["url"]} ${CB}',D);A.close();});return A;}}class Ub extends j{static Function jy;final String CB;Ub(this.CB,String A,i B):super(A,B){L.addAll({r"$name":"Update from Zip",r"$invokable":"write",r"$params":[{"name":"zip","type":"binary","editor":"fileinput","editorMeta":{"accept":"application/zip"}}],r"$columns":[{"name":"success","type":"bool"},{"name":"message","type":"string"}],r"$result":"values",r"$actionGroup":"Update",r"$actionGroupSubTitle":"from Zip"});}W invoke(Map B,d D,W A,KB G,[int J=f.o]){if(B["zip"] is!ByteData){A.TB([[false,"parameter 'zip' is required to be binary"]]);return A..close(a.SC);}var H=G.HI('state') as Yb;var I=H.value;new Future(()async{var C=await jy(CB,B["zip"],I);A.TB([[!C.toString().contains("Error"),C.toString()]]);provider.NE('update link from zip: ${CB}',D);A.close();});return A;}}class UK extends j{static const String ky='version';static const String ly='description';final String CB;j cY;UK(this.CB,String fC,String rC,String B,String S,Map H,bool ED,i A):super(B,A){var b=new Wb(CB,"${B}/start",A);var h=new zj(CB,"${B}/stop",A);var r=new Ak(CB,"${B}/restart",A);var EB=new Yb(CB,"${B}/state",A);var I=new j("${B}/${ly}",A);var J=new j("${B}/${ky}",A);var K=new GW(CB,"${B}/enabled",A);var IB=new yj(CB,"${B}/uninstall",A);var LB=new Ez(CB,"${B}/get_log",A);var UB=new Fz(CB,"${B}/clear_log",A);var aB=new oj(CB,"${B}/download",A);var qB=new yy(CB,H,"${B}/configs/get_nodes",A);var CC=new Az(CB,H,"${B}/configs/set_nodes",A);I.L[r"$type"]="string";K.L[r"$type"]="bool";J.L[r"$type"]="string";I.q(fC);J.q(rC);K.q(ED);Xb M;IT N;Tb O;Ub Q;if(S=="git"){M=new Xb(CB,"${B}/update_git",A);}if(S=="repository"){N=new IT(CB,"${B}/update_repo",A);}if(S!="git"){O=new Tb(CB,"${B}/update_zip",A);Q=new Ub(CB,"${B}/update_file",A);}cY=new j("${B}/configs",A);var FC=<String,j>{};for(var C in H.keys){if(C=="get_nodes"||C=="set_nodes")continue;var V=H[C];var D=new wj(CB,"${B}/configs/${C}",A);var G=V["type"];if(C=="log"&&G=="enum"){G="enum[off,error,info,debug]";}if(G=="url")G="string";D.L[r"$type"]=G;cY.sB(C,D);FC[D.path]=D;if(V["default"]!=null){D.q(V["default"]);}}new Future((){A.v(b.path,b);A.v(h.path,h);A.v(r.path,r);A.v(I.path,I);A.v(J.path,J);A.v(EB.path,EB);A.v(IB.path,IB);A.v(LB.path,LB);A.v(UB.path,UB);A.v(K.path,K);A.v(aB.path,aB);A.v(cY.path,cY);A.v(qB.path,qB);A.v(CC.path,CC);if(M!=null){A.v(M.path,M);}if(N!=null){A.v(N.path,N);}if(O!=null){A.v(O.path,O);}if(Q!=null){A.v(Q.path,Q);}FC.forEach(A.v);});}void eE(String B){Yb D=HI("state");if(D!=null){D.q(B);if(B=="connected"){JF G=provider.JJ.xZ[CB];if(G!=null){String C;for(var A in provider.ND.values){if(A is WK&&A.token!=null){var H=A.token.substring(0,16);if(H==G.id){C=A.path;break;}}}if(C!=null){EO=new j("${path}/path",provider);EO.L[r"$type"]="string";sB("path",EO);provider.v(EO.path,EO);QG.add("path");EO.q(C);}}}else if(EO!=null){Z.remove("path");provider.m.remove(EO.path);QG.add("path");EO=null;}}QcB=B;}void zUB(String A,String B){var C=provider.pB('${path}/${ky}') as j;var D=provider.pB('${path}/${ly}') as j;if(B!=null&&B.isNotEmpty&&B!=D.value){D.q(B);}if(A!=null&&A.isNotEmpty&&A!=C.value){C.q(A);}}j EO;String QcB="unknown";}class Wb extends j{static Function vj;final String CB;Wb(this.CB,String A,i B):super(A,B){L[r"$name"]="Start Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}W invoke(Map B,d C,W A,KB D,[int G=f.o]){new Future(()async{await vj(CB);A.close();});return A;}}class wj extends j{static Function py;final String CB;wj(this.CB,String A,i B):super(A,B){L[r"$writable"]="write";}FB PC(Object A,d C,FB B,[int D=f.o]){py(CB,new NB(path).name,A);q(A);B.close();return B;}}class GW extends j{final String CB;static Function qy;static Function ry;GW(this.CB,String A,i B):super(A,B){L[r"$writable"]="write";}FB PC(Object A,d D,FB C,[int G=f.o]){if(A is bool){Future B;if(A){B=qy(CB);}else{B=ry(CB);}B.then((H){q(A);}).catchError((I){});}return C..close();}}class IT extends j{static Function xj;final String CB;bool oP=false;IT(this.CB,String A,i B):super(A,B){L[r"$name"]="Update from Repository";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[{"name":"message","type":"string"}];L[r"$actionGroup"]="Update";L[r"$actionGroupSubTitle"]="from Repository";}W invoke(Map D,d B,W A,KB G,[int H=f.o]){new Future(()async{if(oP){A.TB([["Link Update is already in progress."]]);}else{try {oP=true;var C=await xj(CB);A.TB([[C]]);}finally {oP=false;}oP=false;}provider.NE('update link from repo: ${CB}',B);A.close();});return A;}}class Xb extends j{static Function sy;final String CB;Xb(this.CB,String A,i B):super(A,B){L[r"$name"]="Update from Git";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[{"name":"message","type":"string"}];L[r"$actionGroup"]="Update";L[r"$actionGroupSubTitle"]="from Git";}W invoke(Map D,d B,W A,KB G,[int H=f.o]){new Future(()async{var C=await sy(CB);A.TB([[C]]);provider.NE('update link from git: ${CB}',B);A.close();});return A;}}class yj extends j{static Function ty;final String CB;yj(this.CB,String A,i B):super(A,B){L[r"$name"]="Uninstall Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}W invoke(Map C,d B,W A,KB D,[int G=f.o]){new Future(()async{await ty(CB);provider.NE('uninstall link: ${CB}',B);A.close();});return A;}}class zj extends j{static Function uy;final String CB;zj(this.CB,String A,i B):super(A,B){L[r"$name"]="Stop Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}W invoke(Map B,d C,W A,KB D,[int G=f.o]){new Future(()async{await uy(CB);A.close();});return A;}}class Ak extends j{static Function vy;final String CB;Ak(this.CB,String A,i B):super(A,B){L[r"$name"]="Restart Link";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}W invoke(Map B,d C,W A,KB D,[int G=f.o]){new Future(()async{await vy(CB);A.close();});return A;}}class Yb extends j{final String CB;Yb(this.CB,String A,i B):super(A,B){L[r"$type"]="string";new Future((){UK C=B.pB(new NB(A).AC);if(C!=null){try {q(C.QcB);}catch (D){q("unknown");}}else{q("unknown");}});}}class wy extends j{wy(String A,i B):super(A,B){L[r"$name"]="Start All Links";L[r"$invokable"]="write";L[r"$params"]=[] ;L[r"$columns"]=[] ;}W invoke(Map G,d H,W B,KB I,[int J=f.o]){new Future(()async{List<UK> D=provider.m.values.where((A)=>A is UK).toList();for(var A in D){GW C=A.get("enabled");if(C.vN!=null&&C.vN.value==true){await Wb.vj(A.CB);}}B.close();});return B;}}class yy extends j{final String CB;final Map xI;File file;yy(this.CB,this.xI,String A,i C):super(A,C){String A="nodes.json";if(xI.containsKey("nodes")){Map B=xI["nodes"];if(B.containsKey("default")){A=B["default"];}if(B.containsKey("value")){A=B["value"];}}file=new File("dslinks/${CB}/${A}");L[r"$name"]="Get Nodes JSON";L[r"$invokable"]="write";L[r"$columns"]=[{"name":"nodes","type":"string","editor":"textarea"},{"name":"success","type":"bool"}];}W invoke(Map B,d C,W A,KB D,[int G=f.o]){new Future(()async{if(!(await file.exists())){A.TB([["{}",false]]);A.close(new a("fileNotFound",msg:"Nodes file not found.",path:"/sys/links/${CB}/configs/get_nodes"));return;}A.TB([[await file.readAsString(),true]]);A.close();});return A;}}class Az extends j{final String CB;final Map xI;File file;Az(this.CB,this.xI,String A,i C):super(A,C){String A="nodes.json";if(xI.containsKey("nodes")){Map B=xI["nodes"];if(B.containsKey("default")){A=B["default"];}if(B.containsKey("value")){A=B["value"];}}file=new File("dslinks/${CB}/${A}");L[r"$name"]="Set Nodes JSON";L[r"$invokable"]="write";L[r"$params"]=[{"name":"nodes","description":"Proceed with caution, this advanced feature could result in data loss.","type":"string","editor":"textarea"}];L[r"$columns"]=[{"name":"success","type":"bool"}];}W invoke(Map D,d I,W A,KB C,[int J=f.o]){if(C!=null){UK G=provider.OB(new NB((C as j).path).AC);if(G.QcB!="stopped"){A.TB([[false]]);var H=new a("linkNotStopped",msg:"Link must be stopped.",path:path);A.close(H);return A;}}var B=D["nodes"];try {if(B is Map){B=QL.convert(B);}hE.convert(B);new Future(()async{if(!(await file.exists())){await file.create();}await file.writeAsString(B);});A.TB([[true]]);A.close();}catch (K){A.TB([[false]]);A.close(a.SC);}return A;}}class Cz extends j{Cz(String A,i B):super(A,B){L[r"$name"]="Get Server Log";L[r"$invokable"]="write";L[r"$params"]=[{"name":"lines","type":"number","default":100}];L[r"$result"]="values";L[r"$columns"]=[{"name":"log","type":"string","editor":"textarea"}];L[r"$actionGroup"]="Server Log";L[r"$actionGroupSubTitle"]="Get";}W invoke(Map H,d K,W B,KB M,[int N=f.o]){new Future(()async{var A=H["lines"];try {if(A is String){A=num.parse(A);}}catch (O){A=50;}var I="logs/dglux_server.log";var D=new File(I);if(!(await D.exists())){B.TB([["Log File not Found"]]);B.close();return;}Iterable<String> C=await D.readAsLines();if(A!=null&&A>0){var J=C.length;var G=J-A;C=C.skip(G<0?0:G).take(A);}B.TB([[C.join("\n")]]);B.close();});return B;}}class Ez extends j{final String CB;Ez(this.CB,String A,i B):super(A,B){L[r"$name"]="Get Log";L[r"$invokable"]="write";L[r"$params"]=[{"name":"lines","type":"number","editor":"int","default":100}];L[r"$result"]="values";L[r"$columns"]=[{"name":"log","type":"string","editor":"textarea"}];L[r"$actionGroup"]="Log";L[r"$actionGroupSubTitle"]="Get";}W invoke(Map H,d J,W B,KB K,[int M=f.o]){new Future(()async{var A=H["lines"];try {if(A is String){A=int.parse(A);}else if(A is num){A=A.toInt();}}catch (N){A=50;}var D=new File("logs/${CB}.log");if(!(await D.exists())){B.TB([["Log File not Found"]]);B.close();return;}Iterable<String> C=await D.readAsLines();if(A!=null&&A>0){var I=C.length;var G=I-A;C=C.skip(G<0?0:G).take(A);}B.TB([[C.join("\n")]]);B.close();});return B;}}class Fz extends j{final String CB;Fz(this.CB,String A,i B):super(A,B){L[r"$name"]="Clear Log";L[r"$invokable"]="write";L[r"$result"]="values";L[r"$columns"]=[{"name":"success","type":"bool"}];L[r"$actionGroup"]="Log";L[r"$actionGroupSubTitle"]="Clear";}W invoke(Map D,d C,W A,KB G,[int H=f.o]){new Future(()async{var B=new File("logs/${CB}.log");if(!(await B.exists())){A.TB([{"success":false}]);A.close(new a("logNotFound",msg:"Log file not found.",path:"/sys/links/${CB}/clear_log"));return;}try {await B.writeAsBytes([] );}catch (I){}A.TB([{"success":true}]);provider.NE('clear link log: ${CB}',C);A.close();});return A;}}class Hz extends j{Hz(String A,i B):super(A,B){L.addAll({r"$name":"Update All Components",r"$invokable":"write",r"$params":[] ,r"$columns":[{"name":"component","type":"string"},{"name":"status","type":"string"},{"name":"message","type":"string"}],r"$result":"stream",r"$actionGroup":"Update",r"$actionGroupSubTitle":"All Components"});}W invoke(Map Q,d O,W D,KB S,[int V=f.o]){new Future(()async{var H=<Jk>[] ;var N=0;if(provider.m.containsKey("/sys/update_server")){var A=new Jk();A.name="dglux-server";A.index=N++ ;A.update=()async{try {if(ZI.TK){return [false,"Server Update is already in progress."];}else{ZI.TK=true;var B=await ZI.mj();ZI.TK=false;return [B[0],B[1]];}}catch (I){ZI.TK=false;return [false,"Error: ${I.toString()}"];}};H.add(A);}List<UK> K;try {K=provider.m.values.where((C)=>C is UK).toList();}catch (I){K=[] ;}for(var C in K){if(C.Z.containsKey("update_repo")){IT J=C.Z["update_repo"];var A=new Jk();A.name=C.CB;A.index=N++ ;A.update=()async{try {if(J.oP){return [false,"Link Update is already in progress."];}J.oP=true;String B=await IT.xj(C.CB);J.oP=false;return [!B.startsWith("Error: "),B];}catch (I){J.oP=false;return [false,"Error: ${I.toString()}"];}};H.add(A);}}var M=<List<String>>[] ;for(var A in H){M.add(<String>[A.name,"Waiting...","N/A"]);}D.TB(M,meta:{"mode":"append"});for(var A in H){List<String> G=M[A.index];G[1]="Updating...";D.TB([G],meta:{"modify":"replace ${A.index}-${A.index}"});var B=await A.update();G[1]=B[0]==true?"Success.":"Failure.";G[2]=B[1];D.TB([G],meta:{"modify":"replace ${A.index}-${A.index}"});}provider.NE('update everything',O);D.close();});return D;}}class Jk{int index;String name;Function update;}class bj{final IF provider;bj(this.provider){}}class aj{static const List<int> Hy=const<int>[1031,4943,4337,3761,3209,2659,2089,1567,1061,4973,4373,3797,3253,2687,2131,1601,1093,5009,4423,3847,3301,2711,2161,1621,1123,5051,4463,3881,3329,2741,2221,1667,1171,5099,4513,3919,3361,2789,2267,1709,1213,5147,4549,3947,3407,2819,2293,1747,1237,5189,4597,4007,3461,2857,2339,1787,1283,5233,4643,4049,3499,2903,2371,1831,1303,5281,4673,4091,3533,2953,2393,1873,1361,5333,4723,4129,3559,2999,2437,1907,1409,5393,4783,4159,3607,3037,2473,1951,1439,5419,4801,4219,3637,3079,2539,1997,1471,5449,4871,4253,3677,3121,2579,2027,1493,5501,4919,4283,3719,3181,2621,2069,1543,1033,4951,4339,3767,3217,2663,2099,1571,1063,4987,4391,3803,3257,2689,2137,1607,1097,5011,4441,3851,3307,2713,2179,1627,1129,5059,4481,3889,3331,2749,2237,1669,1181,5101,4517,3923,3371,2791,2269,1721,1217,5153,4561,3967,3413,2833,2297,1753,1249,5197,4603,4013,3463,2861,2341,1789,1289,5237,4649,4051,3511,2909,2377,1847,1307,5297,4679,4093,3539,2957,2399,1877,1367,5347,4729,4133,3571,3001,2441,1913,1423,5399,4787,4177,3613,3041,2477,1973,1447,5431,4813,4229,3643,3083,2543,1999,1481,5471,4877,4259,3691,3137,2591,2029,1499,5503,4931,4289,3727,3187,2633,2081,1549,1039,4957,4349,3769,3221,2671,2111,1579,1069,4993,4397,3821,3259,2693,2141,1609,1103,5021,4447,3853,3313,2719,2203,1637,1151,5077,4483,3907,3343,2753,2239,1693,1187,5107,4519,3929,3373,2797,2273,1723,1223,5167,4567,3989,3433,2837,2309,1759,1259,5209,4621,4019,3467,2879,2347,1801,1291,5261,4651,4057,3517,2917,2381,1861,1319,5303,4691,4099,3541,2963,2411,1879,1373,5351,4733,4139,3581,3011,2447,1931,1427,5407,4789,4201,3617,3049,2503,1979,1451,5437,4817,4231,3659,3089,2549,2003,1483,5477,4889,4261,3697,3163,2593,2039,1511,5507,4933,4297,3733,3191,2647,2083,1553,1049,4967,4357,3779,3229,2677,2113,1583,1087,4999,4409,3823,3271,2699,2143,1613,1109,5023,4451,3863,3319,2729,2207,1657,1153,5081,4493,3911,3347,2767,2243,1697,1193,5113,4523,3931,3389,2801,2281,1733,1229,5171,4583,4001,3449,2843,2311,1777,1277,5227,4637,4021,3469,2887,2351,1811,1297,5273,4657,4073,3527,2927,2383,1867,1321,5309,4703,4111,3547,2969,2417,1889,1381,5381,4751,4153,3583,3019,2459,1933,1429,5413,4793,4211,3623,3061,2521,1987,1453,5441,4831,4241,3671,3109,2551,2011,1487,5479,4903,4271,3701,3167,2609,2053,1523,5519,4937,4327,3739,3203,2657,2087,1559,1051,4969,4363,3793,3251,2683,2129,1597,1091,5003,4421,3833,3299,2707,2153,1619,1117,5039,4457,3877,3323,2731,2213,1663,1163,5087,4507,3917,3359,2777,2251,1699,1201,5119,4547,3943,3391,2803,2287,1741,1231,5179,4591,4003,3457,2851,2333,1783,1279,5231,4639,4027,3491,2897,2357,1823,1301,5279,4663,4079,3529,2939,2389,1871,1327,5323,4721,4127,3557,2971,2423,1901,1399,5387,4759,4157,3593,3023,2467,1949,1433,5417,4799,4217,3631,3067,2531,1993,1459,5443,4861,4243,3673,3119,2557,2017,1489,5483,4909,4273,3709,3169,2617,2063,1531];int Bs=0;int hash;aj(String A){hash=A.hashCode&0x1fffffff;}void uRB(String I,String J){int C=I.hashCode&0x1fffffff;List<int> H=J.codeUnits;int K=H.length;int B=0;bool D=false;for(int G=0;G<K; ++G){int A=H[G];if(A==32||A==44||A==34||A==59||(A>=48&&A<=57)){if(D)continue;D=true;A=48;}else{D=false;}C=((C*Hy[B])^A)&0x1fffffff;B++ ;if(B>=Hy.length){B=0;}}Bs=(Bs+C)&0x1fffffff;}int fRB(){return Bs^hash;}}YI Ex(String A){YI B;if(A=="file"||A=="json"){B=new mi();}else if(A=="proxy"){B=new li();}else if(A=="openId"){B=new VG();}else if(A=="ldap"){B=new gO();}else if(A=="external"){B=new LBB();}else if(A=="ldap-with-fallback"){B=new vS([new gO(),new gO("ldap2")]);}else if(A=="ldap-with-fallback-and-file"){B=new vS([new gO(),new gO("ldap2"),new mi()]);}else if(A=="open"){B=new MBB();}else if(A.startsWith(vS.zw)&&A.endsWith("]")){String C=A.substring(vS.zw.length,A.length-1);List<String> D=C.split(",").map((G)=>G.trim()).toList();return new vS(D.map(Ex).toList());}else{U.QB("Invalid Authentication Method: ${A}");}return B;}lV jBB(String A){if(A=="none"){return null;}else if(A=="duo"){return new xw();}else if(A=="totp"){return new hBB();}U.QB("Invalid Two-Factor Authentication Method: ${A}");return null;}abstract class lV{bool get jg;List<String> get vq;Future init(LD A);Future<dynamic> tq(String A,Map B,HttpRequest C);Future<String> Ys(Map A,HttpRequest B);Future<String> tp(String A,HttpRequest B);}abstract class YI{Future init(LD A);Future BI(g A,String B);Future wG(String A);Future<g> sG(String A);Future<List<g>> KI();Future<bool> authenticate(String A,String B);Map<String,int> BV=<String,int>{};}abstract class aE{}abstract class ni{}abstract class Dx{}abstract class UBB{}abstract class LK{}class fF{final String message;fF(this.message);String toString()=>message;}class g{final String username;final bool pD;final String GE;final Map metadata;g(this.username,this.pD,[this.GE,Map A]):metadata=A is!Map?{}:A;static g mV(Map A){var B=new g(A["username"],A["superuser"] is bool?A["superuser"]:false,A["email"],A["metadata"]);for(String C in A.keys.where((D)=>!(const["username","superuser","email","metadata"]).contains(D))){B.zK[C]=A[C];}return B;}bool Nf(List<String> A){if(A is!List){return false;}if(metadata["memberOfGroups"] is!List){return false;}List<String> C=metadata["memberOfGroups"];for(String B in A){if(B.startsWith("group:")){var D=B.substring(6);if(C.contains(D)){return true;}}}return false;}Map Ih([List<String> C]){var A={"username":username,"superuser":pD,"metadata":metadata};if(GE!=null&&GE.isNotEmpty){A["email"]=GE;}if(C!=null){for(String B in C){if(zK.containsKey(B)){A[B]=zK[B];}}}return A;}g xL(){return new g(username,pD,GE,new Map.from(metadata));}g wI({String username,bool superuser,String email,Map meta}){if(username==null){username=this.username;}if(superuser==null){superuser=this.pD;}if(email==null){email=this.GE;}if(meta==null){meta=metadata;}return new g(username,superuser,email,meta)..zK=new Map.from(zK);}Map<String,dynamic> zK={};}class vS extends YI implements aE{final List<YI> xN;static const String zw='composite[';vS(this.xN);Future BI(g A,String B)async{for(var C in xN){try {await C.BI(A,B);break;}catch (D){}}}Future<bool> authenticate(String C,String D)async{var A;for(var G in xN){try {var B=await G.authenticate(C,D);if(B){return B;}}catch (H){A=H;}}if(A!=null){throw A;}return false;}Future<g> sG(String C)async{var A;for(var D in xN){try {var B=await D.sG(C);if(B!=null){return B;}}catch (G){A=G;}}if(A!=null){throw A;}return null;}Future init(LD A)async{for(var B in xN){await B.init(A);}}Future<List<g>> KI()async{var A;List<g> B=[] ;for(var C in xN){try {var D=await C.KI();B.addAll(D);}catch (G){A=G;}}if(A!=null){throw A;}return B;}Future wG(String A)async{for(var B in xN){try {await B.wG(A);}catch (C){}}}Future tR(String B,String C)async{for(var A in xN){if(A is aE){await (A as aE).tR(B,C);}}}Future mY(String A)async{}Future hP(g B)async{for(var A in xN){if(A is aE){await (A as aE).hP(B);}}}}final File vw=new File(p("www","duo.html"));class xw extends lV{final bool jg=true;final List<String> vq=["sig_response"];String host;String Or;String fs;String up;xw();Future init(LD B)async{var A=B.get("duo");C(String D){U.BC(D);exit(1);}if(A==null||!A.containsKey("ikey")||!A.containsKey("skey")||!A.containsKey("akey")||!A.containsKey("host")){C("Duo two-factor authentication is not properly configured.");}host=A["host"];Or=A["ikey"];fs=A["skey"];up=A["akey"];}Future<String> tq(String C,Map B,HttpRequest G)async{String D=eHB(Or,fs,up,C);if(!(await vw.exists())){throw new StateError("duo.html does not exist, please report this to Acuity.");}String A=await vw.readAsString();A=A.replaceAll("{{HOST}}",host).replaceAll("{{SIG_REQ}}",D).replaceAll("{{USERNAME}}",B["username"]).replaceAll("{{REMEMBER}}",(B["remember"]!=null).toString());return A;}Future<String> Ys(Map A,HttpRequest C)async{String B=A["sig_response"];if(fHB(Or,fs,up,B)!=null){return '';}return null;}Future<String> tp(String A,HttpRequest B)async{return '';}}class LBB extends YI implements aE,LK{WebSocket socket;String QE;String token;Duration timeout=new Duration(seconds:10);bool Da;Future init(LD C)async{var A=C.get("externalAuth");B(String D){U.jB(D);exit(1);}if(A==null){B("External Authentication not configured.");}QE=A["url"];if(QE==null||QE.isEmpty){B("External Authentication URL not configured.");}token=A["token"];if(A.containsKey('timeout')){timeout=new Duration(seconds:A['timeout']);}if(token==null){B("External Authentication token not configured.");}Da=A["verifyOnStart"];if(Da==null){Da=true;}await connect(true);}Future BI(g A,String B)async{await callMethod("addUser",{"username":A.username,"superuser":A.pD,"password":B,"email":A.GE,"metadata":A.metadata});}Future wG(String A)async{await callMethod("removeUser",{"username":A});}Future<g> sG(String B)async{try {var A=await callMethod("getUser",{"username":B});return new g(A["username"],A["superuser"],A["email"],A["metadata"]);}catch (C){return null;}}Future<List<g>> KI()async{try {var B=await callMethod("listUsers",{});return B.map((A)=>new g(A["username"],A["superuser"],A["email"],A["metadata"])).toList();}catch (C){return null;}}Future<bool> authenticate(String A,String B)async{try {return await callMethod("authenticate",{"username":A,"password":B})==true;}catch (C){return false;}}connect([bool A=false])async{if(RcB){return;}U.mB("External Authentication connecting");try {socket=await XW.Y0(QE);RcB=true;ScB=0;socket.done.then((J){U.mB("External Authentication is closed");RcB=false;new Timer(const Duration(seconds:5),(){connect();});});socket.listen((String G){try {var B=const JsonDecoder().convert(G);if(B is!Map){return;}if(B["event"]=="changed"){for(var H in TcB){H();}return;}UcB.add(B);}catch (C){U.mB("External Authentication data error : ${C}");}});socket.add(const JsonEncoder().convert({"token":token}));Map D=await VcB.first.timeout(const Duration(seconds:5));if(D["error"]!=null){if(A&&Da){U.BC("External Authentcation system says '${D["error"]}'");exit(1);}else{throw new fF(D["error"]);}}if(A){U.jB("External Authentication System Connected.");}}catch (C,I){U.BC("Failed to connect to the External Authentication system.",C,I);if(A&&Da){exit(1);}new Timer(const Duration(seconds:5),(){connect();});}}StreamController<Map> UcB=new StreamController.broadcast();Stream<Map> get VcB=>UcB.stream;bool RcB=false;Future<dynamic> callMethod(String A,Map D)async{if(!RcB){U.mB("External Authentication System is not connected: ${A}");throw new fF("External Authentication System is not connected.");}var C=const JsonEncoder().convert({"rid":ScB,"method":A,"args":D});U.mB("External Authentication Request: ${C}");var G=ScB;ScB++ ;socket.add(C);var B=await VcB.where((H)=>H["rid"]==G).first.timeout(timeout,onTimeout:()=>null);if(B==null){U.mB("External Authentication System timed out: ${A}");throw new fF("External Authentication System timed out.");}U.mB("External Authentication Response: ${B}");return B["value"];}int ScB=0;Future tR(String A,String B)async{await callMethod("changePassword",{"username":A,"password":B});}Future mY(String A)async{}Future hP(g A)async{await callMethod("editUser",{"username":A.username,"superuser":A.pD,"email":A.GE,"metadata":A.metadata});}void YU(Function A){TcB.add(A);}void kZ(Function A){TcB.remove(A);}List<Function> TcB=[] ;}zW SQ;zW la;class mi extends YI implements LK,aE,ni{File file=new File("users.json");List<g> bD=[] ;mi();Future init(LD A)async{SQ=new zW(keyLength:A.Zg,iterations:A.Yg);if(A.UZ!=null||A.TZ!=null){var B=A.TZ??A.Yg;var C=A.UZ??A.Zg;la=new zW(keyLength:C,iterations:B);}await load();if(!Platform.isAndroid){var D=new qT(file.path);D.jf.listen((sH G)async{if(G.type==hL.Bd){U.jB("Reloading Users");await load();}});}}String TRB(){var A={"username":"dgSuper"};var B=[A];A["password"]=SQ.tf('dg1234');A["superuser"]=true;A["metadata"]={"forcePasswordChange":true};return UQ.convert(B);}Future load()async{if(WcB){return;}WcB=true;try {if(!(await file.exists())){await file.create(recursive:true);await file.writeAsString(TRB()+"\n");}var B=await file.readAsString();var A=const JsonDecoder().convert(B);if(A is!List){A=[] ;}List C=A;bD=C.map(g.mV).toList();XcB();}on FormatException catch (D){U.QB("Failed to load Users File: ${D.toString().trim()}");}WcB=false;}bool WcB=false;Future<bool> authenticate(String H,String C)async{g D=await sG(H);if(D==null){return false;}var B=D.zK["password"];if(B==null){B="";}bool A;try {A=SQ.Iq(B,C);}catch (G){A=false;if(la==null){U.QB('Existing password hash too short for keylength.',G);}}if(A||la==null)return A;try {A=la.Iq(B,C);}catch (G){A=false;U.QB('Existing password hash too short for old keylength.',G);}if(A){D.zK['password']=SQ.tf(C);await PE();}return A;}Future<g> sG(String A)async{return bD.firstWhere((B)=>B.username==A,orElse:()=>null);}Future<List<g>> KI()async{return new List<g>.from(bD);}Future BI(g A,String B,{bool isPasswordHashed: false})async{var C=g.mV({"username":A.username,"superuser":A.pD,"email":A.GE,"password":isPasswordHashed?B:SQ.tf(B)});bD.add(C);await PE();XcB();}Future wG(String A)async{bD.removeWhere((B)=>B.username==A);await PE();XcB();}PE()async{var A=const JsonEncoder.withIndent("  ");var B=A.convert(bD.map((g C){return C.Ih(const["password"]);}).toList())+"\n";await file.writeAsString(B);}void YU(Function A){TcB.add(A);}List<Function> TcB=[] ;Future hP(g A)async{Iterable<g> B=bD.where((G){return G.username==A.username;});if(B.isEmpty){return;}g C=B.first;bD.remove(C);var D=A.xL();D.zK["password"]=C.zK["password"];bD.add(D);await PE();XcB();}Future tR(String H,String C)async{List<g> D=bD.where((I){return I.username==H;}).toList();if(D.isEmpty){return;}g A=D.first;{var B=A.zK["password"];if(B==null){B="";}bool G=false;try {G=SQ.Iq(B,C);}catch (J){}if(G){throw new fF("Password is same as existing one.");}}A.zK["password"]=SQ.tf(C);A.metadata.remove('forcePasswordChange');A.metadata['lastPasswordChange']=new DateTime.now().toIso8601String().substring(0,10);await PE();}Future mY(String C)async{List<g> A=bD.where((D){return D.username==C;}).toList();if(A.isEmpty){return;}g B=A.first;B.metadata.remove('lastPasswordChange');B.metadata['forcePasswordChange']=true;await PE();}void kZ(Function A){TcB.remove(A);}Future FUB(String G,String C)async{Iterable<g> D=bD.where((g B)=>B.username==G);if(D.isEmpty){return;}Iterable<g> H=bD.where((g B)=>B.username==C);if(H.isNotEmpty){return;}g A=D.first;bD.remove(A);A=A.wI(username:C);bD.add(A);await PE();XcB();}void XcB(){for(var A in TcB){A();}}}class uw<Y>{List<Function> YcB=<Function>[] ;bool ZcB=false;bool get isCompleted=>ZcB;Y acB;void done(Y A){acB=A;ZcB=true;while(YcB.isNotEmpty){YcB.removeAt(0)(A);}}Future RVB(){if(ZcB){return new Future.value(acB);}var A=new Completer<Y>();YcB.add((B){A.complete(B);});return A.future;}}class tE{static const String QBB='url';static const String RBB='dn';static const String SBB='password';static const String oi='searchBase';static const String TBB='groupAttribute';static const String VBB='usernameAttribute';static const String WBB='emailAttribute';static const String XBB='allowListUsers';static const String YBB='superuserGroup';static const String aBB='metadata';static const String bBB='serverCertificate';static const String cBB='clientCertificate';static const String eBB='clientCertificateKey';static const String fBB='clientKeyPassword';static const String gBB='searchFilter';final String host;final bool ssl;final int port;String P7;String password;SecurityContext context;tE(this.host,{this.ssl: false,this.port: null});}class gO extends YI implements aE,LK{static const String pi='certs';tE qP;List<String> TS;String tU;String CK;String kU;String pg;bool Cf;Map<String,String> MZ;SB LO;dynamic Ch;String bcB;gO([this.bcB="ldap"]);Future init(LD Q)async{void B(String EB){U.BC("Error while initializing LDAP: ${EB}");exit(1);}if(Q.get(bcB)==null){B("LDAP Authentication is not configured.");}var A=Q.get(bcB);var V=A[tE.QBB];if(V==null){B("LDAP URL was not specified.");}Uri D;try {D=Uri.parse(V);}catch (G){B("Failed to parse LDAP URL: ${G}");}var K=new tE(D.host,port:D.port!=0?D.port:null,ssl:D.scheme=="ldaps");SecurityContext C;String M,N,O,b;var S=A[tE.bBB];if(S is String&&S.isNotEmpty){M=p(pi,S);var H=new File(M);if(!H.existsSync()){B('Specified server certificate does not exist at ${M}');}C=SecurityContext.defaultContext;C.setTrustedCertificates(M);}var I=A[tE.cBB];var J=A[tE.eBB];b=A[tE.fBB];if(I!=J&&(I==null||J==null)){B('Both Client Certificate and Client Certificate Key must be provided');}if(I is String&&I.isNotEmpty&&J is String&&J.isNotEmpty){N=p(pi,I);var H=new File(N);if(!H.existsSync()){B('Specified Client certificate does not exist at ${N}');}O=p(pi,J);H=new File(O);if(!H.existsSync()){B('Specified Client certificate key does not exist at ${O}');}if(C==null)C=SecurityContext.defaultContext;C.useCertificateChain(N);C.usePrivateKey(O,password:b);}K.context=C;var h=A[tE.RBB];if(h==null){B("LDAP DN is not configured.");}K.P7=h;var r=A[tE.SBB];if(r!=null){K.password=r;}if(A[tE.oi] is String){TS=[A[tE.oi]];}else{TS=A[tE.oi];}if(TS==null){B("LDAP Search Base is not configured.");}tU=A[tE.TBB];if(tU==null){tU="gid";}CK=A[tE.VBB];if(CK==null){CK="uid";}kU=A[tE.WBB];if(kU==null){kU='mail';}Cf=A[tE.XBB];if(Cf==null){Cf=false;}pg=A[tE.gBB];if(pg!=null&&pg.isNotEmpty){var IB=new bEB();try {LO=IB.AMB(pg);}catch (G){B('Unable to parse search filter: ${G}');}}Ch=A[tE.YBB];if(Ch==null){Ch="superuser";}MZ=A[tE.aBB];if(MZ==null){MZ={};}qP=K;try {bP=await oU();U.jB("LDAP Authentication Configured.");}catch (G){if(Q.vI=="ldap"){B("LDAP Connection failed: ${G}");}}new Timer.periodic(const Duration(seconds:10),(LB){ccB.clear();});new Timer.periodic(const Duration(hours:1),(LB){XcB();});dcB();ecB();}iV bP;Future<iV> oU()async{if(bP==null||bP.state==ConnectionState.closed){bP=new iV(host:qP.host,ssl:qP.ssl,port:qP.port,bindDN:qP.P7,password:qP.password,badCertificateHandler:(A){U.QB('Received warning of bad server certificate');return true;},context:qP.context);}return bP;}Future BI(g A,String B)async{throw new fF("LDAP authentication does not support adding users.");}Future wG(String A)async{throw new fF("LDAP authentication does not support removing users.");}Map<String,g> ccB=new Map<String,g>();Map<String,uw<g>> fcB={};Future<g> sG(String A)async{if(A==null){return null;}if(ccB.containsKey(A)){return ccB[A];}if(fcB.containsKey(A)){var J=fcB[A];if(J!=null&&!J.isCompleted){var IB=await J.RVB();return IB;}}var S=await oU();var LB=new uw<g>();fcB[A]=LB;try {var K=SB.fa(CK,A);if(LO!=null){K=SB.tS([K,LO]);}List<tF> M=[] ;for(var UB in TS){var V=[CK,kU,tU,"*"];V.addAll(MZ.keys);List<tF> B=await (await S.og(UB,K,V)).stream.toList();M.addAll(B);}if(M.isEmpty){ccB[A]=null;var b=fcB[A];if(b!=null&&!b.isCompleted){fcB.remove(A).done(null);}return null;}var B=M.first;var h=false;var G={};if(B.BQ.isNotEmpty){for(var aB in B.BQ){U.jB("LDAP Search referral: ${aB}");}Uri I;try {I=Uri.parse(B.BQ.first);}catch (N){U.QB('Unable to parse ldap referral "${B.BQ.first}"',N);return null;}String O;if(I.path[0]=='/'){O=I.path.substring(1);}else{O=I.path;}await S.bs(O,qP.password);return sG(A);}if(B.JB.containsKey(tU)){var C=B.JB[tU].values;for(var qB in C){if(qB==Ch.toString()){h=true;}}G["memberOfGroups"]=C.toList();}String r;if(B.JB.containsKey(kU)){var C=B.JB[kU].values;if(C.isNotEmpty){r=C.first;}}for(var Q in MZ.keys){var EB=B.JB[Q];if(EB==null)continue;var C=EB.values;if(C.isEmpty){continue;}if(C.length==1){G[Q]=C.first;}else{G[Q]=C.toList();}}EH D=B.JB["passwordMustChange"];if(D==null){D=B.JB["pwdMustChange"];}if(D==null){D=B.JB["pwdLastSet"];}if(D!=null&&(D.values.contains(true)||D.values.contains("on")||D.values.contains(0)||D.values.contains("0"))){G["forcePasswordChange"]=true;}if(gcB[A] is Map){G.addAll(gcB[A]);}var H=new g(A,h,r,G);ccB[A]=H;if(fcB[A]!=null){fcB.remove(A).done(H);}H.metadata['isLdap']=true;var CC=B.JB['memberOf'];var FC=CC.values.toList();H.metadata['ldapGroups']=FC;return H;}catch (N){if(fcB[A]!=null){fcB.remove(A).done(null);}U.QB('Error while getting user from LDAP',N);return null;}}Future<List<g>> KI()async{if(!Cf){return [] ;}var G=<g>[] ;var A=SB.zu(CK);if(LO!=null){A=SB.tS([A,LO]);}for(var B in TS){try {var J=await oU();List<tF> K=await (await J.og(B,A,[CK])).stream.toList();for(var H in K){try {var I=await sG(H.JB[CK].values.first);if(I!=null){G.add(I);}}catch (C,D){U.QB("LDAP user list failed failed for search base '${B}' and entry ${H}",C,D);}}}catch (C,D){U.QB("LDAP user list failed for search base '${B}'",C,D);}}return G;}Future<bool> authenticate(String N,String D)async{try {if(D.isEmpty){return false;}var A=await oU();var I=SB.fa(CK,N);if(LO!=null){I=SB.tS([I,LO]);}List<tF> J=[] ;for(var O in TS){try {var Q=await A.og(O,I,[CK,"*"]);List<tF> B=await Q.stream.toList();J.addAll(B);}on ja catch (S){U.mB('Logging attempt with the wrong credentials.');A.close();return false;}}if(J.isEmpty){return false;}var B=J.first;if(B.BQ.isNotEmpty){for(var V in B.BQ){U.jB("LDAP Search referral: ${V}");}Uri G;try {G=Uri.parse(B.BQ.first);}catch (C){U.QB('Unable to parse ldap referral "${B.BQ.first}"',C);return false;}String K;if(G.path[0]=='/'){K=G.path.substring(1);}else{K=G.path;}await A.bs(K,D);return authenticate(N,D);}try {var H=await A.bs(B.cq,D);if(H==null){var b=await A.isAuthenticated;return b?A.kPB==B.cq:false;}else if(H.bH!=0){U.mB("Failed to authenticate LDAP user: " "(Message: ${H.l7}, " "Result Code: ${H.bH})");A.close();return false;}return true;}on ja catch (S){A.close();return false;}catch (C,M){if(C.toString().contains(", data 773, ")){return true;}U.mB("Failed to authenticate LDAP user.",C,M);A.close();return false;}}catch (C,M){U.mB("Failed to authenticate LDAP user.",C,M);return false;}}static Exception kBB(OL A){if(A.toString().contains("SocketException")){return null;}return A;}Future tR(String J,String O)async{iV K=await oU();var C=SB.fa(CK,J);if(LO!=null){C=SB.tS([C,LO]);}List<tF> D=[] ;for(var Q in TS){List<tF> S=await (await K.og(Q,C,[CK,"unicodePwd","*"])).stream.toList();D.addAll(S);}if(D.isEmpty){throw new fF("Unable to find user '${J}'");}tF G=D.first;String B="unicodePwd";if(!G.JB.containsKey("unicodePwd")){B=G.JB.keys.firstWhere((V)=>V.contains("Password"),orElse:(){return "userPassword";});}if(const["badPasswordTime","passwordMustChange"].contains(B)){B="unicodePwd";}cB A;try {var M='"'+O+'"';var H=<int>[] ;for(var I=0;I<M.length;I++ ){var N=M.codeUnitAt(I);H.add(N&0xff);H.add(N>>8);}A=await K.rSB(G.cq,[new hV.CWB(B,[new String.fromCharCodes(H)])]);}catch (b,h){U.QB("Failed to change password.",b,h);}if(A==null){throw new fF("LDAP result is null.");}else if(A.bH!=uB.uS){throw new fF("Failed to change password: ${A.l7}" " ${uB.aw(A.bH)} " " (${A.bH})");}XcB();}Future mY(String A)async{}Future hP(g A)async{if(gcB[A.username] is!Map){gcB[A.username]={};}ccB.remove(A.username);gcB[A.username].addAll(A.metadata);ecB();XcB();}dcB(){var A=new File("${bcB}_meta.json");if(A.existsSync()){gcB=hE.convert(A.readAsStringSync());}}ecB(){var A=new File("${bcB}_meta.json");A.writeAsStringSync(UQ.convert(gcB)+"\n");}Map<String,Map<String,dynamic>> gcB={};void XcB(){for(var A in TcB){A();}}List<Function> TcB=[] ;void YU(Function A){TcB.add(A);}void kZ(Function A){TcB.removeWhere((B)=>B==A);}Future<Null> ZQB()async{var A=await oU();await A.close();}}class MBB extends YI{Future BI(g A,String B)async{return;}Future<bool> authenticate(String A,String B)async{return true;}Future<g> sG(String A)async{return Q9;}Future init(LD A)async{}Future<List<g>> KI()async=>[Q9];Future wG(String A)async{}final g Q9=new g("dgUser",false,null,{"open":true});}AE NBB=new AE(style:AD.HN);class fO{final Uri issuer;final String cU;final String secret;final String eh;final String Bh;final List<String> Ws=<String>["openid"];final String clientRoles;final String realmRoles;Uri Ef;Uri us;Uri Pr;Uri lq;Uri XY;String z8;static const String Cx='.well-known/openid-configuration';fO(this.issuer,this.cU,this.secret,this.eh,this.Bh,A,{this.clientRoles: null,this.realmRoles: null}){this.Ws.addAll(A);}Future init({bool strictTls: false})async{var C=new HttpClient();C.badCertificateCallback=iBB(strictTls);Uri B;if(issuer.path.contains(Cx)){B=issuer;}else{B=issuer.replace(path:NBB.join(issuer.path,Cx));}try {var D=await C.getUrl(B);var G=await D.close();Map A=JSON.decode(await UTF8.decodeStream(G));var H=Uri.parse(A['issuer']);if(H.host!=issuer.host){throw new StateError('Configuration issuer does not match issuer host address');}z8=A['issuer'];Ef=Uri.parse(A['authorization_endpoint']);us=Uri.parse(A['token_endpoint']);if(A['userinfo_endpoint']!=null){Pr=Uri.parse(A['userinfo_endpoint']);}else{Pr=Ef.resolve('userinfo');}if(A['end_session_endpoint']!=null){lq=Uri.parse(A['end_session_endpoint']);}if(A['check_session_iframe']!=null){XY=Uri.parse(A['check_session_iframe']);}else{U.jB('OpenID Provider does not support session management');}}catch (I,J){U.BC('Error retreiving openId configuration.',I,J);U.BC('Config Path: ${B}');throw new StateError('Unable to configure OpenID');}finally {C.close(force:true);}}static Function iBB(bool A){return (X509Certificate D,String B,int C){U.jB('OpenID configuration: Bad certificate for ${B}:${C}');return !A;};}}class VG extends YI implements LK{static const String Fx='../sso/openId';static final Map<String,g> ma=<String,g>{};fO Vg;List<Function> TcB=[] ;VG();Future init(LD K)async{var A=K.get('openId');String B=A['issuer'];if(B==null||B.isEmpty){throw new ArgumentError.value(B,'issuer');}var C=A['clientId'];if(C==null||C.isEmpty){throw new ArgumentError.value(C,'clientId');}var H=A['secret'];if(H==null||H.isEmpty){throw new ArgumentError.value(H,'secret');}var D=A['clientRoles'] as String;var O=A['realmRoles'] as String;if(D!=null&&D.isNotEmpty){D=D.replaceAll(r'${client_id}',C);}String I=A['usernameKey'];String Q=A['superuserGroup'];List<String> G=A['scope'];Uri M;try {M=Uri.parse(B);}catch (S){throw new ArgumentError.value(B,'issuer');}String N;if(I!=null&&I.isNotEmpty)N=I;List<String> J=[] ;if(G==null||G.isEmpty){J..add('profile')..add('email');}else if(G is List<String>){J.addAll(G);}else{throw new ArgumentError.value(G,'scope','must be a list of strings');}Vg=new fO(M,C,H,N,Q,J,clientRoles:D,realmRoles:O);await Vg.init(strictTls:K.strictTls);U.jB('OpenId configuration is complete.');}Future<Null> BI(g A,String B){throw new fF("OpenID Connect authentication does not support adding users.");}Future<Null> wG(String A){throw new fF("OpenID Connect authentication does not support removing users.");}Future<g> sG(String A)async{if(A==null||A.isEmpty)return null;return ma[A];}void q8(g A){ma[A.username]=A;XcB();}void Z7(String A){ma.remove(A);}Future<List<g>> KI()async{return ma.values.toList();}Future<bool> authenticate(String A,String B){throw new fF('OpenID Connect does not support direct user authentication.');}void XcB(){for(var A in TcB){A();}}void YU(Function A){TcB.add(A);}void kZ(Function A){TcB.removeWhere((B)=>B==A);}}class KK{static const Duration OBB=const Duration(hours:4);static Map<String,KK> wS=<String,KK>{};static KK yw(String B,String C){var A=wS[B];if(A!=null)return A;A=new KK(B,C);wS[B]=A;return A;}static String Ax(String A)=>wS[A]?.username;static void Bx(String B){var A=wS.remove(B);if(A!=null&&A.timeout!=null&&A.timeout.isActive){A.timeout.cancel();}}String token;String username;Timer timeout;KK(this.token,this.username){timeout=new Timer(OBB,(){wS.remove(token);});wS[token]=this;}}class li extends YI implements aE,LK{File file=new File("users.json");List<g> bD=[] ;bool WcB=false;List<Function> TcB=<Function>[] ;String hcB;int icB;li();Future init(LD C)async{if(WcB)return;ASB(C);WcB=true;try {if(!(await file.exists())){await file.create(recursive:true);await file.writeAsString('[{"username": "dgSuper",\n  "superuser": true,\n  "metadata": {}\n}]');}}catch (A){U.QB("Failed to create users file",A);WcB=false;return;}try {var D=await file.readAsString();var B=const JsonDecoder().convert(D);if(B is!List)B=[] ;bD=(B as List).map(g.mV).toList();}catch (A){U.QB("Failed to read users from file ${file.path}",A);}WcB=false;}void ASB(LD D){Map<String,String> B=D.get("proxy",{});if(B.isEmpty)return;var A=B['password'];if(A==null||A.isEmpty)return;String C=Mx(A);if(C==null||C.isEmpty){C=A;var G=jcB(A);if(G!=null){B['password']=G;D.map['proxy']=B;D.xG();}}hcB=C.toLowerCase();}String jcB(String A){if(A==null||A.isEmpty)return null;var B=Nx(A);if(B==null||B.isEmpty){return null;}return B;}bool vPB(String A){if(hcB==null||hcB.isEmpty)return true;return hcB==A.toLowerCase();}Future<bool> authenticate(String A,String B)async{return true;}Future<g> sG(String A)async{var B=bD.firstWhere((g C)=>C.username.toLowerCase()==A.toLowerCase(),orElse:()=>null);return B??new g(A,false);}Future BI(g A,String B)async{bD.add(A.xL());await PE();kcB();}Future wG(String A)async{bD.removeWhere((g B)=>B.username.toLowerCase()==A.toLowerCase());await PE();kcB();}Future hP(g A)async{bD.removeWhere((g B)=>B.username.toLowerCase()==A.username.toLowerCase());bD.add(A.xL());await PE();kcB();}Future<List<g>> KI()async=>new List<g>.from(bD);Future tR(String A,String B){throw new fF("Changing Proxy password is unsupported");}Future mY(String A)async{throw new fF("Force proxy password change is unsupported");}void YU(Function A){TcB.add(A);}void kZ(Function A){TcB.remove(A);}void kcB(){for(var A in TcB){A();}}Future PE()async{var A=const JsonEncoder.withIndent("  ");var B=A.convert(bD.map((g C)=>C.Ih(null)).toList());try {await file.writeAsString(B+"\n");}catch (D){U.QB('Error writing to users file ${file.path}',D);}}}class ki{final String token;final YI VH;ki(this.token,this.VH);oRB(WebSocket H)async{var M=new StreamController<Map>.broadcast();H.listen((String r){try {M.add(const JsonDecoder().convert(r));}catch (C){}});var h=(){H.add(const JsonEncoder().convert({"event":"changed"}));};H.done.then((aB){if(VH is LK){(VH as LK).kZ(h);}M.close();});var N=await M.stream.first.timeout(const Duration(seconds:5),onTimeout:(){return null;});if(N==null||!N.containsKey("token")){H.close();return;}var EB=N["token"];if(this.token!=EB){H.add(const JsonEncoder().convert({"error":"Bad Token"}));await new Future.delayed(const Duration(seconds:1));H.close();return;}var O=[] ;if(VH is aE){O.add("editable");}if(VH is LK){O.add("observable");(VH as LK).YU(h);}H.add(const JsonEncoder().convert({"ok":true,"flags":O}));M.stream.listen((Map J)async{if(J["method"]==null||J["rid"]==null){return;}String I=J["method"];int IB=J["rid"];Map B=J["args"];Map A={"method":I,"rid":IB};if(I=="addUser"){var D=B["username"];var Q=B["superuser"];var S=B["email"];var V=B["metadata"];var K=B["password"];var b=new g(D,Q,S,V);try {await VH.BI(b,K);A["value"]={};}catch (C){A["error"]=C.toString();}}else if(I=="authenticate"){var D=B["username"];var K=B["password"];try {var G=await VH.authenticate(D,K);A["value"]=G;}catch (C){A["error"]=C.toString();}}else if(I=="getUser"){var D=B["username"];try {var G=await VH.sG(D);A["value"]={"username":G.username,"superuser":G.pD,"email":G.GE,"metadata":G.metadata};}catch (C){A["error"]=C.toString();}}else if(I=="changePassword"&&VH is aE){var D=B["username"];var K=B["password"];try {await (VH as aE).tR(D,K);A["value"]={};}catch (C){A["error"]=C.toString();}}else if(I=="editUser"&&VH is aE){var D=B["username"];var Q=B["superuser"];var S=B["email"];var V=B["metadata"];try {g b=new g(D,Q,S,V);await (VH as aE).hP(b);A["value"]={};}catch (C){A["error"]=C.toString();}}else if(I=="listUsers"){try {var LB=await VH.KI();var UB=LB.map((G){return {"username":G.username,"superuser":G.pD,"email":G.GE,"metadata":G.metadata};}).toList();A["value"]=UB;}catch (C){A["error"]=C.toString();}}else if(I=="removeUser"){var D=B["username"];try {await VH.wG(D);A["value"]={};}catch (C){A["error"]=C.toString();}}else{A["error"]="Bad Method";}H.add(const JsonEncoder().convert(A));});}SUB(String C,int B,SecurityContext D)async{var G=await HttpServer.bindSecure(C,B,D);G.listen((HttpRequest A)async{if(A.uri.path!="/auth"){A.response..statusCode=HttpStatus.NOT_FOUND..writeln("Not Found");A.response.close();return;}oRB(await WebSocketTransformer.upgrade(A));});U.jB("Authentication Server Started on port ${B}");}}class ji{static int ww(String B,int A,{int length: 6}){A=(((A~/1000).round())~/30).floor();return PBB(B,A,length);}static int PBB(String D,int G,int B){B=(B>0)?B:6;var H=Ua.xh(D);var I=dBB(G);var J=new PJ(PQ,H);var A=J.convert(I).eC;int C=A[A.length-1]&0xf;int K=((A[C]&0x7f)<<24)|((A[C+1]&0xff)<<16)|((A[C+2]&0xff)<<8)|(A[C+3]&0xff);return K%pow(10,B);}static String ZBB(){var C=new Random();var A=[] ;for(int B=0;B<10;B++ ){A.add(C.nextInt(256));}return Ua.DAB(A);}static List dBB(int A){var B=[0,0,0,0,0,0,0,0];for(var C=B.length-1;C>=0;C-- ){var D=A&0xff;B[C]=D;A=(A-D)~/256;}return B;}}class hBB extends lV{Future<String> gRB(g A,String H,bool O)async{if(!(await YC.Oz.exists())){throw new StateError("totp.html does not exist, please report this to Acuity.");}String B='';String C;if(!A.metadata.containsKey('otp_secret')){B=ji.ZBB();C=B;}else{C=A.metadata['otp_secret'];}String D=await YC.Oz.readAsString();var I=new DateTime.now();var G=I.toIso8601String().substring(0,19);var J=UTF8.encode(G+'::'+A.username);var K=new PJ(PQ,J);var M=K.convert(Ua.xh(C)).eC;var N=G+BASE64URL.encode(M);D=D.replaceAll("{{OTP_SECRET}}",B).replaceAll("{{OTP_LOGIN_INFO}}",H).replaceAll("{{USER_NAME}}",A.username).replaceAll("{{OTP_VERIFY}}",N);return D;}Future tq(String C,Map G,HttpRequest B)async{String A=C;if(A.contains('@')){A=A.split('@')[0];}A+= '@'+B.requestedUri.host;if(B.requestedUri.port!=80&&B.requestedUri.port!=443){A+= ':${B.requestedUri.port}';}g D=await gC.oW.callMethod("getUser",C);return gRB(D,A,false);}List<String> get vq=>['otp_password','otp_secret','username','otp_verify'];Future init(LD A){}bool get jg=>true;Future<String> Ys(Map C,HttpRequest O)async{String H=C["username"];int G=int.parse(C['otp_password'],onError:(String Q)=>-1);if(G<0){return null;}String D=C['otp_secret'];String B=C['otp_verify'];String I=B.substring(0,19);DateTime J=DateTime.parse(I);if(new DateTime.now().difference(J).abs().inMinutes>10){return null;}g A=await gC.oW.callMethod("getUser",H);if(A==null){return null;}if(A.metadata.containsKey('otp_secret')){D=A.metadata['otp_secret'];}var K=UTF8.encode(I+'::'+H);var M=new PJ(PQ,K);var N=M.convert(Ua.xh(D)).eC;if(BASE64URL.encode(N)!=B.substring(19)){return null;}if(A.metadata.containsKey('otp_secret')){var B=ji.ww(A.metadata['otp_secret'],new DateTime.now().millisecondsSinceEpoch);if(B==G){return '';}}else{var B=ji.ww(D,new DateTime.now().millisecondsSinceEpoch);if(B==G){A.metadata['otp_secret']=D;gC.oW.callMethod("editUser",A);return 'totp_ready';}}return null;}Future<String> tp(String B,HttpRequest C)async{String A=await YC.DFB.readAsString();return A.replaceAll('{{REDIRECT_URL}}','/');}}String na(List<int> A){return const Hx().convert(A);}List<int> Gx(String A){return const Ix().convert(A);}class Hx extends Converter<List<int>,String>{final bool G$;final bool op;const Hx([bool this.G$=false,bool this.op=false]);static const int qi=61;static const int lBB=13;static const int mBB=10;static const int nBB=76;static const String oBB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static const String pBB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";String convert(List<int> G){int I=G.length;if(I==0){return "";}final String D=G$?pBB:oBB;final int J=I.remainder(3);final int O=I-J;int K=((I~/3)*4)+((J>0)?4:0);if(op){K+= ((K-1)~/nBB)<<1;}List<int> A=new List<int>(K);int B=0,H=0,M=0;while(H<O){int C=((G[H++ ]<<16)&0xFFFFFF)|((G[H++ ]<<8)&0xFFFFFF)|G[H++ ];A[B++ ]=D.codeUnitAt(C>>18);A[B++ ]=D.codeUnitAt((C>>12)&0x3F);A[B++ ]=D.codeUnitAt((C>>6)&0x3F);A[B++ ]=D.codeUnitAt(C&0x3f);if(op&& ++M==19&&B<K-2){A[B++ ]=lBB;A[B++ ]=mBB;M=0;}}if(J==1){int C=G[H];A[B++ ]=D.codeUnitAt(C>>2);A[B++ ]=D.codeUnitAt((C<<4)&0x3F);A[B++ ]=qi;A[B++ ]=qi;}else if(J==2){int C=G[H];int N=G[H+1];A[B++ ]=D.codeUnitAt(C>>2);A[B++ ]=D.codeUnitAt(((C<<4)|(N>>4))&0x3F);A[B++ ]=D.codeUnitAt((N<<2)&0x3F);A[B++ ]=qi;}return new String.fromCharCodes(A);}}class Ix extends Converter<String,List<int>>{const Ix();static const List<int> ri=const[-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-1,-2,-2,-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,62,-2,62,-2,63,52,53,54,55,56,57,58,59,60,61,-2,-2,-2,0,-2,-2,-2,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-2,-2,-2,-2,63,-2,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2];static const int qBB=61;List<int> convert(String B){int D=B.length;if(D==0){return new List<int>(0);}int K=0;for(int A=0;A<D;A++ ){int G=ri[B.codeUnitAt(A)];if(G<0){K++ ;if(G==-2){throw new FormatException('Invalid character: ${B[A]}');}}}if((D-K)%4!=0){throw new FormatException('''Size of Base 64 characters in Input
          must be a multiple of 4. Input: ${B}''');}int M=0;for(int A=D-1;A>=0;A-- ){int N=B.codeUnitAt(A);if(ri[N]>0)break;if(N==qBB)M++ ;}int I=(((D-K)*6)>>3)-M;List<int> J=new Uint8List(I);for(int A=0,C=0;C<I;){int H=0;for(int O=4;O>0;){int G=ri[B.codeUnitAt(A++ )];if(G>=0){H=((H<<6)&0xFFFFFF)|G;O-- ;}}J[C++ ]=H>>16;if(C<I){J[C++ ]=(H>>8)&0xFF;if(C<I)J[C++ ]=H&0xFF;}}return J;}}abstract class tBB<Y>{}class uBB<Y> extends tBB<Y>{}class LD{bool gU;int port;int ZH;String eY;String Lf;String XH;String bU;bool fq;bool ef;bool Yf;bool Jf;int LQ;String host;int TV;String UY;String WH;Map<String,String> SM;Map<String,Map<String,dynamic>> FZ;Map<String,Map<String,dynamic>> cF;bool strictTls;String VY;bool nZ;List<String> mN;String F$;bool gZ;bool Af;void set defaultPermission(List A){if(A!=null){var B=(List D)=>D[0]=='default';var C=A.firstWhere(B,orElse:()=>null);if(C!=null){A.removeWhere(B);A.add(C);}}lcB=A;}List get defaultPermission=>lcB;List lcB;bool ch;int Yg;int Zg;int TZ;int UZ;String CJ;String rY;String vI;String xs;String Hg;String bf;bool Dt;bool Et;String downstreamName;bool lg;bool t7;String FQ;bool lU;int N9;List<String> GM;Map<String,String> proxies;Map<String,List<String>> uU;List<String> X_;List<String> Uq;List<String> Xr;int dh;bool Bf;bool gq;bool vp;int aZ;bool Eg;Map<String,String> HS;bool os;String zq;bool ff;String tK;Map<String,List<String>> uY;bool zf;String dP;bool eq;bool hq;int jr;String ZP;String fr;bool IZ;int JZ;int Jg;bool get O9=>Jg>0&&JZ>0;bool Hf;String fU;Map yp;RegExp mcB=null;RegExp get nR{if(ZP==null||ZP==''){mcB=new RegExp('^_^');}else if(ZP=='*'){mcB=new RegExp('(.*?)');}if(mcB==null){mcB=new RegExp(ZP);}return mcB;}bool get Bg=>nR.pattern=='(.*?)';bool get vY=>ZP==null||ZP.isEmpty;bool get js{Map A=get("strictFileUpload",null);if(A!=null&&A.containsKey("enabled")&&A["enabled"]){return true;}return false;}List<String> get fUB{Map A=get("strictFileUpload",null);if(A!=null&&A.containsKey("extensions")&&A["extensions"] is List){return A["extensions"];}return const[] ;}bool get gUB{Map A=get("strictFileUpload",null);if(A!=null&&A.containsKey("useClamAV")&&A["useClamAV"]){return true;}return false;}String hs;dynamic SZ;String MV;bool wq;dynamic get(A,[B]){if(A is!List){A=[A];}for(var C in A){if(map[C]!=null){return map[C];}}if(B is Function){return B();}else{return B;}}dynamic map;void load(Map B){this.map=B;gU=get("debug",false);port=get("port",ncB);ZH=get(["httpsPort","httpsport"],ocB);XH=get("certName","");Lf=get("certPassword");pcB(Lf);bU=get("certKeyName","");fq=get("enableHSTS",false);ef=get("enableCSRFProtection",false);Yf=get("disableFileSecurity",false);Jf=get("broadcast",false);UY=get("broadcastUrl");LQ=get("workers",Platform.numberOfProcessors==1?1:2);TV=get("updateInterval",200);var A=<String,String>{"/.well-known":"${Directory.current.absolute.path}/.well-known"};SM=get("static",A);if(!SM.containsKey("/.well-known")){SM.addAll(A);}FZ=get("linkConfig",{});WH=get("brokerUrl");VY=get("brokerName","broker-");mN=get("disabledLinks",[] );nZ=get("runBrokerInMain",Platform.numberOfProcessors==1?true:false);t7=get("enableUptimeChecker",true);F$=get("uptimeCheckUrl");cF=get("upstream",{});strictTls=get("strictTls",false);gZ=get("quarantine",false);Af=get("allowAllLinks",true);defaultPermission=get("defaultPermission",null);ch=get("useRuntimeManager",false);Dt=get("useDartRuntimeManager",false);Et=get("useJavaRuntimeManager",false);Yg=get("passwordHasherIterations",1000);Zg=get("passwordHasherKeyLength",32);TZ=get('old_passwordHasherIterations',null);UZ=get('old_passwordHasherKeyLength',null);CJ=get("loginRedirectPath","/");vI=get("authType","file");xs=get("twoFactorAuth","none");downstreamName=get("downstreamName","conns");lg=get("runPortChecks",true);hs=get("storageDriver",'simple');SZ=get("observe",false);host=get("host","0.0.0.0");GM=get("loggers",[] );proxies=get("proxies",{});uU=get("hooks",{});bf=get("distributionUrl",zBB);Hg=get("linkRepositoryUrl",yBB);X_=get("serverVmFlags",[] );Uq=get("dartRuntimeManagerVmFlags",[] );Xr=get("javaRuntimeManagerVmFlags",[] );dh=get("userTimeout",525600);Bf=get("allowBrowserCaching",false);FQ=get("serverLogLevel","INFO");lU=get("enableLogCompression",true);N9=get("logRotationInterval",0);gq=get("enableIPv6",false);rY=get("guestLoginRedirectPath",null);vp=get("allowPasswordChanges",true);aZ=get("passwordExpireAfterDays",0);Eg=get("keepCustomAssets",false);HS=get("linkManagerEnvironment",{});os=get("timeHttpRequests",false);zq=get("generatedCertificateSubject","/C=US/ST=California/L=Oakland/O=Acuity Brands Inc./OU=Customers/CN=*");ff=get("enableCertificateGeneration",true);tK=get("alternativeBrokerUrl",null);uY=get("httpPathClassification",{});zf=get("isAlwaysOffline",false);dP=get("corsProxyRules","");eq=get("enableGit",false);hq=get("enableSingleSignOnServer",false);jr=get("maxQueueSize",256);MV=get("ssoProviderUrl",null);wq=get("formatDg5",false);ZP=get("allowedCorsRegexString",null);fr=get("loginAuditFileName","audit.log");IZ=get("loginAudit",false);JZ=get("loginThrottleDuration",60);Jg=get("loginThrottleAttempts",5);Hf=get("blockOutsideGuests",false);fU=get("customLogo",null);yp=get("audit",null);}Future<bool> J9([String A="server"])async{if(await JW.Ok.Ir(".docker").exists()){ncB=80;ocB=443;}var B=await Kx(A);if(!(await B.exists())){load({"downstreamName":"downstream","corsProxyRules":""});await xG(A);return true;}var C=await HCB(B);load(C);var D=PE();if(const JsonEncoder().convert(C)!=const JsonEncoder().convert(D)){await xG(A);}return false;}int ocB=8443;int ncB=8080;Map PE(){var A={"debug":gU,"host":host,"port":port,"httpsPort":ZH,"certName":XH,"certKeyName":bU,"certPassword":Lf,"enableHSTS":fq,"enableCSRFProtection":ef,"strictFileUpload":{"enabled":false,"useClamAV":false,"extensions":const["dg5","dgi","crt","key","woff","ttf","gif","svg","png","jpg","xml","json","sql","csv"]},"disableFileSecurity":Yf,"isAlwaysOffline":zf,"broadcast":Jf,"workers":LQ,"updateInterval":TV,"static":SM,"linkConfig":FZ,"disabledLinks":mN,"enableUptimeChecker":t7,"uptimeCheckUrl":F$,"upstream":cF,"strictTls":strictTls,"quarantine":gZ,"allowAllLinks":Af,"defaultPermission":defaultPermission,"useRuntimeManager":ch,"useDartRuntimeManager":Dt,"useJavaRuntimeManager":Et,"passwordHasherIterations":Yg,"passwordHasherKeyLength":Zg,"loginRedirectPath":CJ,"guestLoginRedirectPath":rY,"authType":vI,"twoFactorAuth":xs,"runPortChecks":lg,"storageDriver":hs,"downstreamName":downstreamName,"loggers":GM,"proxies":proxies,"hooks":uU,"distributionUrl":bf,"linkRepositoryUrl":Hg,"serverVmFlags":X_,"userTimeout":dh,"allowBrowserCaching":Bf,"serverLogLevel":FQ,"enableLogCompression":lU,"logRotationInterval":N9,"enableIPv6":gq,"dartRuntimeManagerVmFlags":Uq,"javaRuntimeManagerVmFlags":Xr,"allowPasswordChanges":vp,"passwordExpireAfterDays":aZ,"keepCustomAssets":Eg,"linkManagerEnvironment":HS,"timeHttpRequests":os,"generatedCertificateSubject":zq,"enableCertificateGeneration":ff,"alternativeBrokerUrl":tK,"httpPathClassification":uY,"corsProxyRules":dP,"enableGit":eq,"enableSingleSignOnServer":hq,"maxQueueSize":jr,"ssoProviderUrl":MV,"formatDg5":wq,"allowedCorsRegexString":ZP,"loginAuditFileName":fr,"loginAudit":IZ,"loginThrottleDuration":JZ,"loginThrottleAttempts":Jg,"blockOutsideGuests":Hf,"customLogo":fU,"audit":yp};if(UY!=null){A["broadcastUrl"]=UY;}if(VY!=null){A["brokerName"]=VY;}if(WH!=null){A["brokerUrl"]=WH;}if(nZ!=null){A["runBrokerInMain"]=nZ;}if(map["ldap"]!=null){A["ldap"]=map["ldap"];}if(map["ldap2"]!=null){A["ldap2"]=map["ldap2"];}if(map["duo"]!=null){A["duo"]=map["duo"];}if(map["strictFileUpload"]!=null){A["strictFileUpload"]=map["strictFileUpload"];}if(map["externalAuth"]!=null){A["externalAuth"]=map["externalAuth"];}if(map["authServer"]!=null){A["authServer"]=map["authServer"];}if(map['openId']!=null){A['openId']=map['openId'];}if(map['proxy']!=null){A['proxy']=map['proxy'];}if(TZ!=null){A['old_passwordHasherIterations']=TZ;}if(UZ!=null){A["old_passwordHasherKeyLength"]=UZ;}if(SZ==true||SZ is String){A["observe"]=SZ;}if(map['smtp']!=null){A['smtp']=map['smtp'];}return A;}bool qcB=false;Future xG([String A="server"])async{if(qcB){return;}qcB=true;var B=await Kx(A);await ICB(B,PE());qcB=false;}void pcB(String A){if(A==null||A.isEmpty){eY=A;return;}var B=Mx(A);if(B==null||B.isEmpty){eY=A;rcB(A);return;}eY=B;}void rcB(String B){var A=Nx(B);if(A==null||A.isEmpty){return;}Lf=A;xG();}}class si{static const String vBB='oem-login.html';static const String wBB='images';static const String Jx='oem-login';static String get xBB=>yE.join(Jx,wBB);}const String ti="dglux_server";const String yBB="https://dsa.s3.amazonaws.com/links/links.json";const String zBB="https://dsa.s3.amazonaws.com/dists/dists.json";const int ACB=1024;const int BCB=ACB*1024;const int CCB=BCB*1024;class DCB{static const List<int> ECB=const[0x00000000,0x77073096,0xee0e612c,0x990951ba,0x076dc419,0x706af48f,0xe963a535,0x9e6495a3,0x0edb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x09b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x01db7106,0x98d220bc,0xefd5102a,0x71b18589,0x06b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0x0f00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x086d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x03b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x04db2615,0x73dc1683,0xe3630b12,0x94643b84,0x0d6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0x0a00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x026d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x05005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0x0cb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0x0bdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,0x37d83bf0,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d];static int FCB(List<int> B,[int A=0]){A=A^0xffffffff;for(var C in B){A=(A>>8)^ECB[(A^C)&0xFF];}A=A^0xffffffff;return A;}static String GCB(List<int> B,[int C=0]){var A=FCB(B).toRadixString(16);while(A.length<8){A='0${A}';}return A;}}LD X;cC U;ui(){if(U==null){IR=true;U=new cC("DGServer");U.Tg.listen((A){List<String> B=A.message.split("\n");for(String C in B){print("[${A.level.name}] ${C}");}if(A.error!=null){print(A.error);}if(A.stackTrace!=null&&U.xY(hB.Bm)){print(A.stackTrace);}});}}Future<KT> Kx(String A)async{var B=["${A}.json","${A}.toml","${A}.yaml"];for(var D in B){var C=JW.Ok.Ir(D);if(await C.exists()){return C;}}return JW.Ok.Ir(B.first);}Future<dynamic> HCB(KT B)async{if(!(await B.exists())){return null;}var A=await B.readAsString();var C=Zm(B.path);if(C==".toml"){var D=new c3();return yS(D.YD(A).value);}else if(C==".yaml"){return yS(qLB(A));}else{if(A.trim().isEmpty||A==" "){A="{}";}return yS(hE.convert(A));}}Future ICB(KT B,dynamic D)async{if(!(await B.exists())){await B.create();}var A="";var C=Zm(B.path);if(C==".toml"){var G=new kKB();A=G.encode(D);}else if(C==".yaml"){A=tLB(D);}else{A=UQ.convert(D);}if(!A.endsWith("\n")){A=A+"\n";}final H=C!='.toml'&&C!='.yaml';await B.writeAsString(A,verifyJson:H);}JsonEncoder UQ=const JsonEncoder.withIndent("  ");JsonEncoder QL=const JsonEncoder();JsonDecoder hE=const JsonDecoder();Utf8Decoder RL=const Utf8Decoder(allowMalformed:true);Utf8Encoder ZM=const Utf8Encoder();dynamic yS(A){if(A is Map){var B={};for(var C in A.keys){B[yS(C)]=yS(A[C]);}return B;}else if(A is List){return A.map((D)=>yS(D)).toList();}else{return A;}}final JCB=new Uint8List.fromList([0x00,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0x88,0x77,0x66,0x55,0x44,0xFF,0xFF,0x44,0x55,0x66,0x77,0x88,0x99,0x88,0x77,0x66,0x55,0x44,0x33,0x22,0x11,0xAA]);final mO Lx=new mO(JCB);kO oa;kO get pa{if(oa!=null)return oa;oa=new kO();return oa;}String Mx(String A){if(A==null||A.isEmpty)return null;pa..reset()..init(false,Lx);String B;try {var D=Gx(A);var G=Ox(pa,D);var C=UTF8.decode(G);var H=int.parse(C.substring(0,2),radix:10);B=C.substring(2,2+H);}catch (I){return null;}return B;}String Nx(String B){if(B==null||B.isEmpty)return null;String G;pa..reset()..init(true,Lx);var I=B.length.toString().padLeft(2,'0');var A=I+B;var D=UTF8.encode(A);var H=16-(D.length%16);if(H!=16){var C=A.length+H;C=(C<16?16:C);A=A.padRight(C,'.');D=UTF8.encode(A);}try {var J=Ox(pa,D);G=na(J);}catch (K){U.QB("Error encoding password",K);return null;}return G;}Uint8List Ox(kO D,Uint8List B){var C=new Uint8List(B.length);for(var A=0;A<B.lengthInBytes;){var G=D.PS(B,A,C,A);A+= G;}return C;}Future<ByteData> SDB({bool includeLinks: true,bool includeKeys: true,bool includeBrokerStorage: true,bool includeWebAssets: true,bool includeConfiguration: true,bool includeServerBuild: true,bool includeLogs: true,bool includeDataNodes: true,bool includeServerConfiguration: true,bool includeAttributes: true,bool includeProjects: true})async{List<String> A=<String>[] ;if(includeLinks){A.add("dslinks/**");}if(includeKeys){A.add(".dslink.key");A.add("**/.dslink.key");A.add("**/.key");}if(includeServerConfiguration){A.add("server.json");}if(includeProjects){A.add("files/**");}if(includeAttributes){A.add("storage/brokerAttributes/**");A.add("storage/attribute/**");}if(includeDataNodes){A.addAll(const<String>["data.json","storage/data/**"]);}if(includeWebAssets){A.add("www/**");}if(includeBrokerStorage){A.add("storage/**");A.add("brokerIcons/**");}if(includeServerBuild){A.add("bin/**");}if(includeConfiguration){A.addAll(const<String>["server.json","conns.json","nodes.json","tokens.json","users.json","usernodes.json","data.json","ldap_meta.json","certs/**"]);}if(includeLogs){A.add("logs/**");}AE C=new AE(current:Directory.current.path);List<DR> I=A.map((J)=>new DR(J,recursive:true,context:C)).toList();var D=new WM();await for(FileSystemEntity B in Directory.current.list(recursive:true)){if(B is File){var K=C.wJ(B.path);var M=C.iZ(B.path);if(!I.any((N)=>N.XD(K))){continue;}var G=await B.stat();var O=await B.readAsBytes();var H=new qD(M,G.size,O);H.mode=G.mode;D.LY(H);}}var Q=new oh();return zQ.cl(Q.encode(D));}HttpClient WDB=new HttpClient();class dM{static bool hx(HttpHeaders B,String C,String D){var A=B[C];if(A==null||A.isEmpty){return false;}if(A.contains(D)||A.contains("*")){return true;}return false;}static Future XDB(HttpRequest B){var A=B.response;A.statusCode=404;A.writeln("ERROR: Not Found.");return A.close();}static Map<String,String> ix(HttpHeaders A){var B={};A.forEach((C,D){B[C]=A.value(C);});return B;}static Future Sj(HttpRequest A,Uri N,[Map<String,String> I])async{var C=A.response;var O=WDB;try {HttpClientRequest B=await O.openUrl(A.method,N);B.headers.removeAll("transfer-encoding");B.headers.removeAll("host");A.headers.forEach((G,D){if(G=="connection"&&(D.contains("Upgrade")||D.contains("upgrade"))){D.remove("keep-alive");}B.headers.set(G,D.first);});B.persistentConnection=A.persistentConnection;try {if(A.headers.value("origin")!=null){B.headers.set("X-Proxy-Origin",A.headers.value("origin"));}}catch (J){}if(I!=null){for(var K in I.keys){B.headers.set(K,I[K]);}}HttpClientResponse H=await A.pipe(B);C.statusCode=H.statusCode;H.headers.forEach((G,D){var M=G.toLowerCase();if(M=="tranfer-encoding"||M=="te"){return;}C.headers.set(G,D.first);});if(H.statusCode==HttpStatus.SWITCHING_PROTOCOLS){return await YDB(A,H);}else{await H.pipe(C);}}catch (J,Q){U.QB('Error forwarding request to broker',J,Q);C.statusCode=500;C.writeln("Internal Server Error");return C.close();}}static Future YDB(HttpRequest A,HttpClientResponse B)async{var C=await A.response.detachSocket();var D=await B.detachSocket();await aDB.bDB(C,D);}static List<String> ZDB(String B){List<String> D=new List<String>();int C=0;int A=0;while(A<B.length){if(B[A]==","){D.add(B.substring(C,A));C=A+1;}else if(B[A]==" "||B[A]=="\t"){C++ ;}A++ ;}D.add(B.substring(C,A));return D;}}class aDB{static Future bDB(Socket A,Socket B)async{if(A==null||B==null){A?.destroy();B?.destroy();return null;}B.encoding=A.encoding;var D=new Completer();void C(H){if(H!=null){U.mB('Error proxying socket:',H);}A?.destroy();B?.destroy();A=null;B=null;if(!D.isCompleted)D.complete();}A.listen((List<int> G)=>B?.add(G),onError:C,cancelOnError:true,onDone:()=>C(null));B.listen((List<int> G)=>A?.add(G),onError:C,cancelOnError:true,onDone:()=>C(null));return await D.future;}}class cDB{static const String dDB="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";static const bool eDB=const bool.fromEnvironment("websocket.custom",defaultValue:false);static Future<WebSocket> fDB(HttpRequest C,bool I,[G])async{if((const bool.fromEnvironment("websocket.standard",defaultValue:true)||I==true)&&!eDB){return await WebSocketTransformer.upgrade(C,protocolSelector:G);}var A=C.response;if(!WebSocketTransformer.isUpgradeRequest(C)){A..statusCode=HttpStatus.BAD_REQUEST..close();return new Future.error(new WebSocketException("Invalid WebSocket upgrade request"));}Future H(String B){A..statusCode=HttpStatus.SWITCHING_PROTOCOLS..headers.add(HttpHeaders.CONNECTION,"Upgrade")..headers.add(HttpHeaders.UPGRADE,"websocket");String J=C.headers.value("Sec-WebSocket-Key");String K=na(PQ.convert("${J}${dDB}".codeUnits).eC);A.headers.add("Sec-WebSocket-Accept",K);if(B!=null){A.headers.add("Sec-WebSocket-Protocol",B);}A.headers.contentLength=0;return A.detachSocket().then((M)=>new WebSocket.fromUpgradedSocket(M,protocol:B,serverSide:true));}var D=C.headers['Sec-WebSocket-Protocol'];if(D!=null&&G!=null){D=dM.ZDB(D.join(', '));return new Future(()=>G(D)).then((B){if(D.indexOf(B)<0){throw new WebSocketException("Selected protocol is not in the list of available protocols");}return B;}).catchError((N){A..statusCode=HttpStatus.INTERNAL_SERVER_ERROR..close();throw N;}).then(H);}else{return H(null);}}}class DT{int start;int end;int total;int length;DT(this.start,this.end,this.total){length=(end-start);}String toString()=>"Range(${start}-${end}, length: ${length})";}int mx(String B,int C,int D){String A=B.substring(C,D);return (A.length>0)?int.parse(A):-1;}class HH{final String JG;final ContentType type;HH(this.JG,this.type);}void dD(HttpRequest C,A){if(A==null){return;}var B=C.response;if(A is Future){A.then((G){dD(C,G);});}else if(A is String){var D=ZM.convert(A);if(C.method!="HEAD"&&C.method!="OPTIONS"){B.contentLength=D.length;B.add(D);}else{B.headers.contentLength=D.length;}UE();B.close();}else if(A is Stream){if(C.method!="HEAD"&&C.method!="OPTIONS"){UE();A.pipe(B).then((H){B.close();UE();});}else{UE();B.close();}}else if(A is File){XQ(C,A);}else if(A is Map||A is List){B.headers.contentType=ContentType.JSON;dD(C,UQ.convert(A));}else if(A is HttpResponse){return;}else if(A is HH){B.headers.contentType=A.type;var D=ZM.convert(A.JG);if(C.method!="HEAD"&&C.method!="OPTIONS"){B.contentLength=D.length;B.add(D);}else{B.headers.contentLength=D.length;}B.close();UE();}else{throw new Exception("Unknown Route Value: ${A} with type ${A.runtimeType} on path ${C.uri.path}");}}Stopwatch gDB(){return Zone.current["stopwatch"];}HttpRequest hDB(){return Zone.current["request"];}void UE(){var A=gDB();var B=hDB();if(A!=null&&B!=null){A.stop();U.kC("${B.method} ${B.uri}"+" took ${A.elapsedMicroseconds/1000}ms");}}final RegExp TDB=new RegExp(r"^bytes=\d*-\d*(,\d*-\d*)*$");class UDB{}const int VDB=512*1024*1024;uBB<UDB> Rj;XQ(HttpRequest B,File M,{bool download: false,bool enableCache: true})async{var A=B.response;var V=M.path;var J=hG(V);var G=EJB(J);if(J.endsWith(".dg5")){G="application/json";}else if(J.endsWith(".woff")){G="application/font-woff";}else if(J.endsWith(".jp2")){G="image/jp2";}else if(J.endsWith(".jxr")){G="image/jxr";}if(G==null){G="text/plain";}A.headers.contentType=ContentType.parse(G);var b=B.headers.value("Range");var h=await M.stat();if(h.type==FileSystemEntityType.NOT_FOUND){RJ(B,A);return;}int D=h.size;DateTime N=h.modified;A.headers.set("X-Content-Type-Options","nosniff");var K="${Uri.encodeComponent(J)}_${D}_${N.millisecondsSinceEpoch}_${G}";if(B.headers.value("If-None-Match")!=null&&dM.hx(B.headers,"If-None-Match",K)){A.headers.set(HttpHeaders.ETAG,K);if(X.Bf){A.headers.set("Cache-Control","max-age=300");}A.statusCode=HttpStatus.NOT_MODIFIED;await A.close();UE();return;}if(B.headers.ifModifiedSince!=null&&B.headers.value("If-None-Match")==null){if(B.headers.ifModifiedSince.millisecondsSinceEpoch+1000>N.millisecondsSinceEpoch){A.headers.set(HttpHeaders.ETAG,K);A.statusCode=HttpStatus.NOT_MODIFIED;await A.close();UE();return;}}if(B.headers.value("If-Match")!=null&&!dM.hx(B.headers,"If-Match",K)){A.statusCode=HttpStatus.PRECONDITION_FAILED;await A.close();UE();return;}if(B.headers.value("If-Unmodified-Since")!=null){try {var aB=HttpDate.parse(B.headers.value("If-Unmodified-Since"));if(aB.millisecondsSinceEpoch+1000<=N.millisecondsSinceEpoch){A.statusCode=HttpStatus.PRECONDITION_FAILED;await A.close();return;}}catch (IB){A.statusCode=HttpStatus.BAD_REQUEST;A.writeln(IB);await A.close();UE();return;}}DT r=new DT(0,D,D);List<DT> H=[] ;if(b!=null){if(!TDB.hasMatch(b)){A.headers.set(HttpHeaders.CONTENT_RANGE,"bytes */${D}");A.statusCode=HttpStatus.REQUESTED_RANGE_NOT_SATISFIABLE;await A.close();UE();return;}String EB=B.headers.value("If-Range");if(EB!=null&&EB!=K){try {var qB=HttpDate.parse(EB);if(qB.millisecondsSinceEpoch+1000<N.millisecondsSinceEpoch){H.add(r);}}catch (IB){H.add(r);}}if(H.isEmpty){for(var O in b.substring(6).split(",")){var S=mx(O,0,O.indexOf("-"));var I=mx(O,O.indexOf("-")+1,O.length);if(S==-1){S=D-I;I=D;}else if(I==-1||I>D){I=D;}if(S>I){A.headers.set(HttpHeaders.CONTENT_RANGE,"bytes */${D}");A.statusCode=HttpStatus.REQUESTED_RANGE_NOT_SATISFIABLE;await A.close();return;}H.add(new DT(S,I,D));}}}A.headers.set("Accept-Ranges","bytes");if(enableCache){A.headers.set("ETag",K);if(X.Bf){A.headers.set("Cache-Control","max-age=300");}else{A.headers.set("Cache-Control","max-age=0, must-revalidate");}}else{var LB=new DateTime.now();A.headers.set("Last-Modified",HttpDate.format(LB));A.headers.set("Expires",HttpDate.format(LB));A.headers.set("Cache-Control","no-cache, no-store, max-age=0, must-revalidate");A.headers.set("Pragma","no-cache");}A.headers.contentType=ContentType.parse(G);if(H.isEmpty||H[0]==r){if(B.method=="OPTIONS"){await A.close();return;}if(B.method=="HEAD"){A.headers.contentLength=D;await A.close();return;}if(Rj!=null&&Rj.pRB(V)){var UB=Rj.get(V);if(N.millisecondsSinceEpoch<UB.EYB){A.add(UB.eC);await A.close();return;}}if(D>=VDB){A.bufferOutput=false;}else{A.bufferOutput=true;}A.headers.contentLength=D;await M.openRead().listen((Q){A.add(Q);A.deadline=const Duration(seconds:120);}).asFuture();await A.close();UE();return;}else if(H.length==1){DT C=H[0];if(B.method=="OPTIONS"){await A.close();UE();return;}if(B.method=="HEAD"){A.headers.contentLength=C.length;await A.close();UE();return;}A.contentLength=C.length;A.statusCode=HttpStatus.PARTIAL_CONTENT;A.headers.set("Content-Range","bytes ${C.start}-${C.end-1}/${C.total}");if(B.method=="OPTIONS"||B.method=="HEAD"){await A.close();UE();return;}await M.openRead(C.start,C.start+C.length).listen((Q){A.add(Q);A.deadline=const Duration(seconds:120);}).asFuture();await A.close();UE();return;}else{A.headers.set("Content-Type","multipart/byteranges; boundary=MULTIPART_BYTERANGES");A.statusCode=HttpStatus.PARTIAL_CONTENT;if(B.method=="OPTIONS"||B.method=="HEAD"){await A.close();return;}for(var C in H){A.writeln();A.writeln("--MULTIPART_BYTERANGES");A.writeln("Content-Type: ${G}");A.writeln("Content-Range: bytes ${C.start}-${C.end-1}/${C.total}");A.writeln();await M.openRead(C.start,C.start+C.length).listen((Q){A.add(Q);A.deadline=const Duration(seconds:120);}).asFuture();}A.writeln();A.writeln("--MULTIPART_BYTERANGES--");await A.close();UE();}}File jx=YC.IFB.absolute;File kx=YC.BFB.absolute;File lx=YC.JFB.absolute;RJ(HttpRequest B,HttpResponse A)async{if(B.method=="OPTIONS"){A.statusCode=404;await A.close();UE();return;}if(B.headers.value("Accept")!=null&&B.headers.value("Accept").contains("text/html")&&await jx.exists()){A.statusCode=404;await XQ(B,jx);}else{A.statusCode=404;A.writeln("404 - Not Found.");await A.close();UE();}}zD(HttpRequest B,HttpResponse A)async{if(B.method=="OPTIONS"){A.statusCode=HttpStatus.FORBIDDEN;await A.close();UE();return;}if(B.headers.value("Accept")!=null&&B.headers.value("Accept").contains("text/html")&&await kx.exists()){A.statusCode=HttpStatus.FORBIDDEN;await XQ(B,kx);}else{A.statusCode=HttpStatus.FORBIDDEN;A.writeln("Access Denied.");await A.close();UE();}}nx(HttpRequest B,HttpResponse A)async{if(B.method=="OPTIONS"){A.statusCode=HttpStatus.FORBIDDEN;await A.close();UE();return;}if(B.headers.value("Accept")!=null&&B.headers.value("Accept").contains("text/html")&&await lx.exists()){A.statusCode=HttpStatus.FORBIDDEN;await XQ(B,lx);}else{A.statusCode=HttpStatus.FORBIDDEN;A.writeln("Access Denied.");await A.close();UE();}}Future<String> iDB({int length: 30})async{var C=new StringBuffer();for(int D=1;D<=length;D++ ){var A=new Random.secure();var B=A.nextInt(50);if(B>=0&&B<=32){String G=FT[A.nextInt(FT.length)];C.write(A.nextBool()?G.toLowerCase():G);}else if(B>32&&B<=43){C.write(GT[A.nextInt(GT.length)]);}else if(B>43){C.write(ox[A.nextInt(ox.length)]);}}return C.toString();}String ET({int length: 50}){var A=new Random.secure();var B=new StringBuffer();for(int C=1;C<=length;C++ ){if(A.nextBool()){String D=FT[A.nextInt(FT.length)];B.write(A.nextBool()?D.toLowerCase():D);}else{B.write(GT[A.nextInt(GT.length)]);}}return B.toString();}Future<String> Tj({int length: 50})async{var B=new StringBuffer();for(int C=1;C<=length;C++ ){await new Future.value();var A=new Random.secure();if(A.nextBool()){String D=FT[A.nextInt(FT.length)];B.write(A.nextBool()?D.toLowerCase():D);}else{B.write(GT[A.nextInt(GT.length)]);}}return B.toString();}const List<String> FT=const["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];const List<int> GT=const[0,1,2,3,4,5,6,7,8,9];const List<String> ox=const["@","=","_","+","-","!","."];typedef dynamic jDB<Y>(Y _0);typedef void kDB(Process _0);typedef void Uj(String _0);class IH extends ProcessResult{final XE;IH(int A,int B,C,D,this.XE):super(A,B,C,D);}class lDB{}bool px=false;Future<IH> gF(String D,{List<String> args: const[] ,String workingDirectory,Map<String,String> environment,bool includeParentEnvironment: true,bool runInShell: true,stdin,kDB handler,Uj stdoutHandler,Uj stderrHandler,Uj outputHandler,lDB controller,File outputFile,bool logCompression: true,jDB<int> exitHandler,bool inherit: false,bool writeToBuffer: false,bool binary: false,bool capture: true,bool inheritStdin: false,Duration timeout,bool sudo: false})async{if(sudo&&(Platform.isLinux||Platform.isMacOS)&&(await VE("sudo"))!=null){var V=D;D=await VE("sudo");args=new List<String>.from(args);args.insert(0,V);}Xj B;if(outputFile!=null){B=new Xj(outputFile,logCompression:logCompression);await B.start();}if(workingDirectory==null){workingDirectory=Directory.current.path;}var K=new Map.from(environment is Map?environment:{});if(includeParentEnvironment){K["PATH"]=qx();}try {if(px){U.jB("Execute '${D} ${args.join(' ')}' in ${workingDirectory}");}Process A=await Process.start(D,args,workingDirectory:workingDirectory,environment:K,includeParentEnvironment:includeParentEnvironment,runInShell:runInShell);if(controller!=null){controller.scB=A;controller.tcB.complete();}if(B!=null){var b="[${xV}] ==" " Executing ${D} with arguments" " ${args} (pid: ${A.pid}) ==";B.write(b);}var H=new StringBuffer();var M=new StringBuffer();var N=new StringBuffer();var I=<int>[] ;var O=<int>[] ;var Q=<int>[] ;if(capture){if(!binary){A.stdout.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((C)async{if(writeToBuffer){M.writeln(C);H.writeln(C);}if(stdoutHandler!=null){stdoutHandler(C);}if(outputHandler!=null){outputHandler(C);}if(inherit){lh.stdout.writeln(C);}if(B!=null){B.write("[${xV}] ${C}");}});A.stderr.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((C)async{if(writeToBuffer){N.writeln(C);H.writeln(C);}if(stderrHandler!=null){stderrHandler(C);}if(outputHandler!=null){outputHandler(C);}if(inherit){lh.stderr.writeln(C);}if(B!=null){B.write("[${xV}] ${C}");}});}else{A.stdout.listen((G){if(writeToBuffer){I.addAll(G);Q.addAll(G);}});A.stderr.listen((G){if(writeToBuffer){I.addAll(G);O.addAll(G);}});}}if(handler!=null){handler(A);}if(stdin!=null){if(stdin is File){stdin=await stdin.openRead();}if(stdin is Stream){stdin.listen(A.stdin.add,onDone:A.stdin.close);}else if(stdin is List){A.stdin.add(stdin);}else{A.stdin.write(stdin);await A.stdin.close();}}else if(inherit&&inheritStdin){stdin.listen(A.stdin.add,onDone:A.stdin.close);}var S=false;if(timeout!=null){new Future.delayed(timeout,(){if(!S){A.kill(ProcessSignal.SIGKILL);}});}var J=await A.exitCode;S=true;var h=A.pid;await new Future.delayed(const Duration(milliseconds:5));if(B!=null){B.write("[${xV}] == Exited with status ${J} ==");}if(exitHandler!=null){exitHandler(J);}if(B!=null){await B.stop();}return new IH(h,J,binary?Q:M.toString(),binary?O:N.toString(),binary?I:H.toString());}finally {if(B!=null){await B.stop();}}}Map<String,String> wV={};String qx(){var A=Platform.environment["PATH"].split(Platform.isWindows?";":":");if(Platform.isMacOS&&!A.contains("/usr/local/bin")){A.add("/usr/local/bin");}return A.join(Platform.isWindows?";":":");}Future<String> VE(String B)async{if(wV.containsKey(B)){var A=new File(wV[B]);if(await A.exists()){return A.path;}}if(const["dart","pub"].contains(B)){try {var I=new File(Platform.resolvedExecutable);var J=I.parent;var A=new File(p(J.path,B));if(await A.exists()){return wV[B]=A.absolute.path;}}catch (Q){}}if(const["openssl"].contains(B)&&Platform.isWindows){var K=<String>[p(Directory.current.path,"bin","tools","openssl","openssl.exe")];for(var M in K){var A=new File(M);if(await A.exists()){return wV[B]=A.absolute.path;}}}var N=qx().split(Platform.isWindows?";":":");var G=[B];if(Platform.isWindows){G.addAll(["${B}.exe","${B}.bat"]);}for(var C in N){if(C.startsWith('"')&&C.endsWith('"')){C=C.substring(1,C.length-1);}if(Platform.environment.containsKey("HOME")){var D=Platform.environment["HOME"];if(!D.endsWith("/")){D+= "/";}C=C.replaceAll("~/",D);}var H=new Directory(f2(C)).absolute;if(!(await H.exists())){continue;}for(var O in G){var A=new File(p(H.path,O)).absolute;if(await A.exists()){wV[B]=A.path;return A.path;}}}return null;}Future<bool> Fb()async{if(Platform.isLinux&&await new File("/.dockerinit").exists()){return true;}if(Platform.isLinux&&await new File("/.dockerenv").exists()){return true;}if(const bool.fromEnvironment("dsa.docker",defaultValue:false)){return true;}return false;}Future<bool> mDB()async{var A=await VE("node");return A!=null;}Future<bool> nDB()async{var A=await VE("ruby");return A!=null;}Future<bool> rx()async{var A=await VE("python");return A!=null;}Future<bool> oDB()async{var A=await VE("virtualenv");return A!=null;}Future<bool> pDB()async{var B=await VE("java");if(B!=null){return true;}String A=Platform.environment["JAVA_HOME"];if(A!=null){var C=await qDB([p(A,"bin","java"),p(A,"bin","java.exe"),p(A,"java"),p(A,"java.exe")]);if(C!=null){return true;}}return false;}Future<File> qDB(List<String> B)async{for(var C in B){var A=new File(C);if(await A.exists()){return A;}}return null;}Future<bool> sx(int A,{String host: "0.0.0.0"})async{try {if((Platform.isLinux||Platform.isMacOS)&&await VE("lsof")!=null){var B=await Process.run("lsof",["-n","-i4TCP@${host}:${A}"]);if(B.exitCode==0&&B.stdout.contains("LISTEN")){return false;}else{return true;}}ServerSocket C=await ServerSocket.bind(host,A);await C.close();return true;}catch (D){return false;}}Future<bool> rDB()async{return await new File(".secureMode").exists();}bool Gb;Future<bool> tx()async{if(Gb!=null){return Gb;}Gb=(Platform.isLinux||Platform.isMacOS)&&(await VE("bsdtar")!=null);return Gb;}Future<Directory> sDB([String B])async{var C=await vx();if(C>=(CCB)*2){return await Directory.systemTemp.createTemp(B);}else{Directory A=new Directory("tmp");if(!(await A.exists())){await A.create(recursive:true);}return await A.createTemp(B);}}Future Hb(String K,Directory B,{bool handleSingleDirectory: false,List<String> exclude,bool allowSmartDownload: true,bool allowSmartExtract: true})async{if(allowSmartDownload&&allowSmartExtract&&await tx()){var D=await sDB("dgserver-fetch");var C=new File(p(D.path,"file.tmp"));await C.create(recursive:true);var O=await ux.getUrl(Uri.parse(K));var Q=await O.close();IOSink G=C.openWrite();await Q.listen((S){G.add(S);}).asFuture();await G.flush();await G.close();await new Future.delayed(const Duration(milliseconds:250));var M=await VE("bsdtar");if(!(await B.exists())){await B.create(recursive:true);}var H=["-C",B.path,"-xvf${C.path}"];List<String> I=[] ;if(exclude!=null){I.addAll(exclude.map((A)=>"--exclude=${A}"));}H.addAll(I);if(handleSingleDirectory){IH V=await gF(M,args:["-tf${C.path}"]..addAll(I),writeToBuffer:true);List<String> N=V.XE.split("\n");N.removeWhere((A)=>A==null||A.isEmpty||A.endsWith("/"));if(N.every((b)=>b.contains("/"))){H.addAll(["--strip-components","1"]);}}var J=await gF(M,args:H,writeToBuffer:true);if(J.exitCode!=0){await D.delete(recursive:true);throw new Exception("Failed to extract archive." " (Exit Code: ${J.exitCode})\n${J.XE}");}await D.delete(recursive:true);}else{var h=await Ib(K);await YQ(h,B,handleSingleDirectory:handleSingleDirectory,exclude:exclude,allowSmartExtract:allowSmartExtract);}}Future YQ(List<int> D,Directory C,{bool handleSingleDirectory: false,List<String> exclude,bool allowSmartExtract: true})async{if(allowSmartExtract&&await tx()){var K=await VE("bsdtar");if(!(await C.exists())){await C.create(recursive:true);}var G=["-C",C.path,"-xvf-"];List<String> H=[] ;if(exclude!=null){H.addAll(exclude.map((A)=>"--exclude=${A}"));}G.addAll(H);if(handleSingleDirectory){IH N=await gF(K,args:["-tf-"]..addAll(H),handler:(Process B){B.stdin.add(D);B.stdin.close();},writeToBuffer:true);List<String> M=N.XE.split("\n");M.removeWhere((A)=>A==null||A.isEmpty||A.endsWith("/"));if(M.every((O)=>O.contains("/"))){G.addAll(["--strip-components","1"]);}}var I=await gF(K,args:G,handler:(Process B){B.stdin.add(D);B.stdin.close();});if(I.exitCode!=0){throw new Exception("Failed to extract archive. (Exit Code: ${I.exitCode})\n" "${I.XE}");}}else{List<DR> J=[] ;if(exclude!=null){for(String A in exclude){J.add(new DR(A,recursive:true));}}var Q=await uDB(D).where((qD S){if(J.isEmpty){return true;}else{for(DR V in J){if(V.XD(S.name)){return false;}}return true;}});await tDB(Q,C,handleSingleDirectory:handleSingleDirectory);}}Future tDB(Stream<qD> G,Directory H,{bool handleSingleDirectory: false})async{var C=await G.toList();if(handleSingleDirectory&&C.every((A)=>A.name.split("/").length>=2)){C.forEach((B){B.name=B.name.split("/").skip(1).join("/");});C.removeWhere((D)=>D.name==""||D.name=="/");}for(qD A in C){if(!A.JSB||A.name.endsWith("/"))continue;var B=new File(p(H.path,A.name));if(!(await B.exists())){await B.create(recursive:true);}await B.writeAsBytes(A.JG);}}Stream<qD> uDB(List<int> B)async*{var C=new ht();var D=C.j7(B);for(var A in D.MG){if(A.DS){A.fY();}yield A;}}String vDB(){String A;try {A=Platform.resolvedExecutable;}catch (B){try {A=Platform.executable.isNotEmpty?Platform.executable:"dart";}catch (B){A="dart";}}return A;}Future<List<int>> Ib(String C,{retry: false,retryCallback(int count)})async{if(C==null||C.isEmpty){return <int>[] ;}int D=0;int B=0;if(retry==true){B=5;}else if(retry is int){B=retry;}G()async{try {var H=await ux.getUrl(Uri.parse(C));var A=await H.close();if(A.isRedirect){A=await A.redirect();}if(A.statusCode!=200){throw new Exception("Failed to fetch url: got status code ${A.statusCode}");}return await A.fold([] ,(List I,List J){return I..addAll(J);});}catch (K){if(B>0&&D<B){D++ ;if(retryCallback!=null){retryCallback(D);}await new Future.delayed(const Duration(milliseconds:250));return await G();}else{rethrow;}}}return await G();}Future<dynamic> wDB(String A)async{var B=await Ib(A);return const JsonDecoder().convert(RL.convert(B));}HttpClient ux=new HttpClient()..badCertificateCallback=(A,B,C)=>true;String get xV{return new DateTime.now().toString();}Future<FileSystemEntity> ZQ(String A,{bool dir: false})async{var B=await FileSystemEntity.type(A);if(B==FileSystemEntityType.FILE){return new File(A).absolute;}else if(B==FileSystemEntityType.DIRECTORY){return new Directory(A).absolute;}else{if(dir){return new Directory(A).absolute;}else{return new File(A).absolute;}}}Future Vj(Directory C,Directory A)async{if(!(await A.exists())){await A.create(recursive:true);}await for(FileSystemEntity B in C.list(recursive:true)){String G=cm(B.path,from:C.path);String H=p(A.path,G);if(B is File){File D=new File(H);await D.create(recursive:true);await B.copy(D.path);}}}final File xDB=new File("/proc/meminfo");int aQ;bool Wj;Future<int> vx()async{if(aQ!=null){return aQ;}if(Platform.isMacOS){var C=await Process.run("sysctl",const["-n","hw.memsize"]);aQ=int.parse(C.stdout);}else if(Platform.isLinux||Platform.isAndroid){if(Wj==null){Wj=Platform.isAndroid?false:(await VE("free"))!=null;}if(Wj){var C=await Process.run("free",const["-b"]);List<String> D=C.stdout.split("\n");var A=D[1];var G=A.split(" ");G.removeWhere((H)=>H.trim().isEmpty);var I=num.parse(G[1]);aQ=I;}else{var D=await xDB.readAsLines();var A=D.firstWhere((A){return A.startsWith("MemFree:");});var B=A.replaceAll(" ","").split(":")[1];if(B.endsWith("kB")){B=B.substring(0,B.length-2);}aQ=(num.parse(B)*1024).toInt();}}else{aQ=await yDB("ComputerSystem get TotalPhysicalMemory");}return aQ;}Future<int> yDB(String A)async{try {var B=await Process.run("wmic",A.split(" "));var C=B.stdout.split("\n").where((String D)=>D.isNotEmpty).skip(1).toList();return int.parse(C[0]);}catch (G){return 0;}}GZipCodec zDB=new GZipCodec();Future AEB(File A,File B,{bool clearOld: false})async{var G=await VE("gzip");if(!(await B.parent.exists())){await B.parent.create(recursive:true);}if(G!=null){await B.create(recursive:true);var D=await B.openWrite();var C=await gF(G,stdin:A,handler:(Process H)async{H.stderr.drain();await D.addStream(H.stdout);},capture:false);if(C.exitCode!=0){await D.close();await B.delete();throw new Exception("Failed to GZIP Compress File ${A.path} to ${B.path}");}await new Future.delayed(const Duration(milliseconds:5));await D.close();if(clearOld){if(Platform.isWindows){await A.delete();await A.create(recursive:true);}else{await A.writeAsBytes([] ,flush:true);}}}else{var J=zDB.encoder;var I=await A.readAsBytes();var C=J.convert(I);await B.writeAsBytes(C,flush:true);I=null;C=null;if(clearOld){if(Platform.isWindows){await A.delete();await A.create(recursive:true);}else{await A.writeAsBytes([] ,flush:true);}}}}Future<IH> BEB(List<String> C,{bool checked: true,bool inherit: false,bool stdin: false})async{var D=<String,String>{};if(Platform.isWindows){D["OPENSSL_CONF"]=p(Directory.current.path,"bin","tools","openssl","openssl.cfg");}var G=await VE("openssl");if(G==null){throw new Exception("OpenSSL is not installed.");}var A=await gF(G,args:C,writeToBuffer:true,environment:D,inherit:inherit,inheritStdin:stdin,outputHandler:(String B)=>U.mB("OpenSSL Output: ${B}"),stderrHandler:(String B)=>U.jB("OpenSSL error: ${B}"));if(A.exitCode!=0){throw new Exception("Failed to run OpenSSL with arguments ${C}" " (code = ${A.exitCode}):" "\n${A.XE}");}return A;}Future CEB(String B,LD A)async{String C=A.zq;if(C==null){return;}String J=await VE("openssl");String K=Platform.version.split(" ").first;UC M=new UC.tWB(K);UC N=new UC.tWB("1.13.0");if(M<N){U.QB("Certificate Generation Skipped: Dart v1.13.0+ is required.");return;}if(J==null){U.QB("Certificate Generation Skipped: OpenSSL is not installed.");return;}if(!A.ff){return;}String H=p(B,"server.csr");String O=p(B,"server.pem");String D=p(B,"key.pem");U.jB(["Generating SSL Certificate.","  Subject: ${C}"].join("\n"));Directory I=new Directory("certs");if(!(await I.exists())){await I.create(recursive:true);}Future<IH> G(List<String> Q)async{return await BEB(Q,checked:true);}await G(["genrsa","-out",D,"4096"]);await G(["req","-new","-key",D,"-sha256","-subj",C,"-out",H]);await G(["req","-x509","-days","365000","-key",D,"-in",H,"-out",O]);A.XH="server.pem";A.bU="key.pem";await A.xG();U.jB("Generated SSL Certificate.");}Future<bool> wx(String A){return new Directory(A).exists();}bool get DEB=>!Platform.isWindows;bool EEB(InternetAddress C,List<int> A){try {var B=xx(C);if(B<A[0]||B>A[1]){return false;}return true;}catch (D){return false;}}List<int> FEB(String H){try {List A=H.split('/');InternetAddress D=new InternetAddress(A[0]);int G=xx(D);int B,C;switch (D.type.name){case 'IP_V4':B=32;C=0xFFFFFFFF;break;case 'IP_V6':B=128;C=0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;break;}int I=A.length>1?int.parse(A[1]):B;return [G,G+(C>>I)];}catch (J){return [-1,-1];}}int xx(InternetAddress B){var A=0;return B.rawAddress.reversed.reduce((C,D){A+= 8;return C|= D<<A;});}const int GEB=5242880;const int HEB=2;const Duration yx=const Duration(milliseconds:200);class Xj{final File file;int CYB;bool logCompression;Xj(this.file,{this.logCompression: true}){if(!file.existsSync()){file.createSync(recursive:true);}}Rc ucB;Future start([int B=0])async{if(ucB!=null){ucB.af();ucB=null;}void J(String D,File M,[int C=0]){var G=new File('${D}.${C}');if(G.existsSync()){if(C>=HEB){G.deleteSync();}else{J(D,G,C+1);}}M.renameSync('${D}.${C}');}var A=B==0?null:new Duration(seconds:B);ucB=H1.I1(yx,()async{if(A!=null){A-= yx;}if(vcB.isNotEmpty){if(A!=null&&A<=Duration.ZERO){try {J(file.path,file);file.createSync();A=new Duration(seconds:B);}catch (H,I){if(U!=null){U.QB("Failed to roll log: ${file.path}.",H,I);}}}var K=vcB;vcB=<String>[] ;await file.writeAsString(K.join("\n")+"\n",mode:FileMode.WRITE_ONLY_APPEND);K=null;if(!logCompression)return;try {var N=await file.stat();if(N.size>=GEB&&B<=0){var O=hG(file.path);var Q=new DateTime.now().millisecondsSinceEpoch;var S=new File(p(file.parent.path,"${O}.${Q}.gz"));await AEB(file,S);await file.delete();await file.create();}}catch (H,I){if(U!=null){U.QB("Failed to compress log ${file.path}.",H,I);}}}});}Future stop()async{if(ucB!=null){ucB.af();ucB=null;}if(vcB.isNotEmpty){await file.writeAsString(vcB.join("\n")+"\n",mode:FileMode.WRITE_ONLY_APPEND);}}bool get isActive=>ucB!=null;void write(String A){if(A.contains("\n")){vcB.addAll(LineSplitter.split(A.trim()));}else{vcB.add(A);}}List<String> vcB=<String>[] ;}class IW{static const String Sz='{{FROM_NAME}} forgot password request';static const String OFB='A request has been made to reset the password '+'associated with this account. If you made this request, please copy '+'and paste the following link: {{TARGET}}\r\n'+'If you did not make this request, please disregard this e-mail.';static const String PFB='''<!doctype html>
  <html>
    <head>
      <meta charset="UTF-8">
      <title>Password Reset</title>
    </head>
    <body>
      <h2>{{FROM_NAME}} forgot password request</h2>
      <p>A request has been made to reset the password associated with this 
      account. If you made this request, please follow the link here: 
      <br /><a href="{{TARGET}}">{{TARGET}}</a></p>
      <p>If you did not make this request, please disregard this e-mail.</p>
    </body>
  </html>
  ''';static const String QFB='A request has been made for a password reset '+'with this e-mail address. However either the provided username did not '+'match, or we do not have an account associated with this e-mail address. '+'If you believe this to be an error, please contact your system '+'administrator.\r\n'+'If you did not make this request, please disregard this e-mail.';static const String RFB='''<!doctype html>
  <html>
    <head>
      <meta charset="UTF-8">
      <title>Password Reset Request</title>
    </head>
    <body>
      <h2>{{FROM_NAME}} forgot password request</h2>
      <p>A request has been made for a password reset with this e-mail address. 
      However either the provided username did not match, or we do not have an 
      account associated with this e-mail address. If you believe this to be an 
      error, please contact your system administrator.</p>
      <p>If you did not make this request, please disregard this e-mail.</p>
    </body>
  </html>
  ''';static const String SFB='server';static const String TFB='username';static const String UFB='password';static const String VFB='from';static const String WFB='fromName';String xq;String vJ;uW lB;fc RV;IW(Map<String,String> A){if(A==null)throw new ArgumentError('SMTP Configuration is empty');var B=A[SFB];if(B=='gmail'){lB=new mIB();}else{lB=new uW();if(B.contains(':')){var C=B.split(':');lB.vU=C[0];lB.port=int.parse(C[1],onError:(String D){throw new ArgumentError('SMTP Server address invalid. '+'"${D}" is an invalid port number.');});}else{lB..vU=B;}}lB..username=A[TFB]..password=A[UFB]..IUB=(lB.username!=null&&lB.password!=null);xq=A[VFB];vJ=A[WFB]??"DG Solution Builder";}Future<Null> tQB(String A,String B)async{if(A==null||A.isEmpty)throw new ArgumentError.notNull('to');if(B==null)throw new ArgumentError.notNull('resetLink');if(RV==null)RV=new fc(lB);var C=new AP()..nY=xq..vJ=vJ..AQ.add(A)..subject=Sz.replaceAll('{{FROM_NAME}}',vJ)..text=OFB.replaceAll('{{TARGET}}',B)..tY=PFB.replaceAll("{{FROM_NAME}}",vJ).replaceAll('{{TARGET}}',B);return RV.send(C);}Future<Null> TVB(String A)async{if(A==null||A.isEmpty)throw new ArgumentError.notNull('to');if(RV==null)RV=new fc(lB);var B=new AP()..nY=xq..vJ=vJ..AQ.add(A)..subject=Sz.replaceAll('{{FROM_NAME}}',vJ)..text=QFB..tY=RFB.replaceAll("{{FROM_NAME}}",vJ);return RV.send(B);}}final bool Ij=(){try {assert(false);return false;}catch (A){return true;}}();Uri Ab(Uri A){if(X!=null&&X.tK!=null&&X.tK.isNotEmpty){var B=Uri.parse(X.tK);A=A.replace(host:B.host,scheme:B.scheme,port:B.port,path:A.path,query:A.hasQuery?A.query:null);return A;}var C="http://${InternetAddress.LOOPBACK_IP_V4.address}:${yD.ua}${A.path}";if(A.query!=null&&A.query.isNotEmpty){C+= "?${A.query}";}return Uri.parse(C);}zCB(String B,A)async{U.jB("Configuration Changed: ${B} => ${A}");if(B=="workers"&&A is int){await t.WB.callMethod("resizeServerWorkers",A);}else if(B=="port"&&A is int){await t.WB.callMethod("rebindServerWorkers");}else if(B=="httpsPort"&&A is int){await t.WB.callMethod("rebindServerWorkers");}else if(B=="enableIPv6"&&A is bool){await t.WB.callMethod("rebindServerWorkers");}}int Jj;List<Process> vV=[] ;Map<String,String> Cb={};int Kj=0;void Lj(String A){A=A.trim().toUpperCase();if(A=="DEBUG"){A="ALL";}Map<String,hB> C={};for(var B in hB.Dm){C[B.name]=B;}var B=C[A];if(B!=null){U.level=B;}}Function Db;CDB()async{if(await Fb()){return;}var B=Platform.script.toFilePath(windows:Platform.isWindows);var C=jT(B);var A=jT(C);var D=new File(p(A,"bin","daemon.dart"));if(await D.exists()){Directory.current=new Directory(A);}}Timer Mj;List<Function> Nj=[] ;gC VB;OCB(HttpRequest A)async{if(!(await MK(A))){return null;}if(A.method=="GET"){var C=await YC.CFB.readAsString();var D=A.uri;C=C.replaceAll("{{TARGET}}",D.toString());return new HH(C,ContentType.HTML);}else if(A.method=="POST"){var B=Uri.parse(A.uri.queryParameters["target"]);B=B.replace(queryParameters:new Map.from(B.queryParameters)..addAll({"id":GH().id}));return A.response.redirect(B);}else{return await RJ(A,A.response);}}gCB(HttpRequest A)async{if(X.MV==null){return await RJ(A,A.response);}if(A.method=="GET"&&A.uri.queryParameters["id"] is String){var D=A.uri.queryParameters["id"];var B=await wDB(Uri.parse(X.MV).resolve("/sso/info").replace(queryParameters:{"id":D}).toString());await GH().QI("sso",B);var G=GH().rJ=g.mV(B);await RK(G.username,GH());var C=A.uri.queryParameters["target"];if(C!=null){return A.response.redirect(Uri.parse(C));}return A.response.redirect(Uri.parse("/"));}else{A.response..statusCode=HttpStatus.BAD_REQUEST..close();return null;}}uCB(HttpRequest A)async{if(A.method=="GET"&&A.uri.queryParameters["id"] is String){var C=A.uri.queryParameters["id"];iE B=await t.WB.callMethod("getSession",C);if(B!=null&&B.username!="guest"&&B.username!=null){g D=await t.WB.callMethod("getUser",B.username);var G=D.Ih();return new HH(QL.convert(G),ContentType.JSON);}}A.response..statusCode=HttpStatus.BAD_REQUEST..close();return null;}Qx(xO A)async{return Cj(()=>YCB(A));}YCB(xO wD)async{ui();fB.Kq();fB.Tg.listen((K){U.tP(K.level,K.message,K.error,K.stackTrace);});if((await vx())>(600*1024*1024)){YT.DHB();}U.jB("Starting Broker");var rC=wD.get("logLevel");if(rC is String){Lj(rC);lW(rC);}var YE=await HttpServer.bind(InternetAddress.LOOPBACK_IP_V4.address,0);var fC=YE.port;IF G;gC A;t.WB=A=await wD.init(methods:{"getBrokerPort":(EB)=>fC,"addLink":(H)=>eM.dQ.MY(H[0],H[1],H[2],H[3],H[5],H[4]),"removeLink":(B){eM.dQ.EJ(B);if(G!=null&&G.JJ!=null){G.JJ.xZ.remove(B);}},"setLinkState":(H)=>eM.dQ.eE(H[0],H[1]),"getUpstreamNodes":(EB)=>yD.aM.EC.cF.S8(),"updateLinkConfig":(EB)=>eM.dQ.CVB(EB[0],EB[1]),"setLinkConfig":(List H)async{await A.callMethod("setLinkConfig",H);},"updateLinkInfo":(List H)async{eM.dQ.DVB(H[0],H[1],H[2]);},"updateLicenseData":(String SI){return XG.gj.K9(SI);},"getTrustedToken":(String B){return G.JJ.LQB(B,G).token;},"addUser":(g N){fQ J=G.pB("/sys/users");J.BI(N);},"addOrUpdateUser":(g N){fQ J=G.pB("/sys/users");J.J7(N);},"syncUsers":(List<g> CC)async{fQ J=G.pB("/sys/users");List<g> xD=J.bD.where((S)=>!CC.any((eH)=>eH.username==S.username)).toList();if(xD!=null){xD.forEach((N)=>J.wG(N.username));}if(CC!=null){CC.forEach((g N){if(N!=null){J.J7(N);}});await G.AUB(CC);}},"removeUser":(String M){fQ J=G.pB("/sys/users");J.wG(M);},"clearUsers":(EB){fQ J=G.pB("/sys/users");for(var S in J.Z.keys.toList()){if(S=="createUser"){continue;}J.wG(S);}},"triggerRequestCounter":(EB){IF.Ny++ ;IF.BW.q(IF.Ny);},"setServerConfig":(LD ZE){X=ZE;yD.aM.xI=ZE;}});XG.CW=await A.callMethod("getProductId");yD.va=(HttpRequest C,[g Q])async{var FC=C.uri.path;if(C.method=="HEAD"||C.method=="OPTIONS"){var LB=C.response;LB.headers.set("Access-Control-Allow-Methods","POST, OPTIONS, GET");LB.headers.set("Access-Control-Allow-Headers","Content-Type");String O;if(C.headers.value("x-proxy-origin")!=null){O=C.headers.value("x-proxy-origin");}if(!X.vY){if(X.Bg){LB.headers.set('Access-Control-Allow-Origin','*');}else{if(O==null){O=C.headers['origin']?.first;}if(O!=null&&X.nR.hasMatch(O)){var VI=X.nR.firstMatch(O)[0];LB.headers.set('Access-Control-Allow-Origin',VI);}}}LB.close();return;}if(!X.vY){var O=C.headers.value("X-Proxy-Origin");if(X.Bg){C.response.headers.set("Access-Control-Allow-Origin",'*');}else if(O!=null&&X.nR.hasMatch(O)){C.response.headers.set("Access-Control-Allow-Origin",O);}C.response.headers.set("Access-Control-Allow-Methods","POST, OPTIONS, GET");C.response.headers.set("Access-Control-Allow-Headers","Content-Type");}String UB=Q==null?null:Q.username;if(xS.TQ!=null&&C.headers.value("X-Verification-Token")==xS.TQ){if(C.uri.queryParameters["username"]!=null){UB=C.requestedUri.queryParameters["username"];}if(C.headers.value("X-Username")!=null){UB=C.headers.value("X-Username");}}if(Q==null&&UB!=null&&UB!=HD.NK.username){Q=await A.callMethod("getUser",UB);}if(Q==null){Q=HD.NK;}try {if(FC=="/conn"){await yD.aM.k8(C,Q);}else if(FC=="/ws"){await yD.aM.Lr(C,Q);}else if(FC.startsWith("/conn/")){await yD.aM.k8(C,Q);}else if(FC.startsWith("/icon/")){await yD.aM.nRB(C);}else{dM.XDB(C);}}catch (K){try {if(K is int){eW(C,K);}else{eW(C);}C.response.close();}catch (CH){U.QB(CH);}}};xS.TQ=await A.callMethod("getVerificationUserToken");YE.listen(yD.va);LD D=await A.callMethod("getServerConfig");IF.gM=D;X=D;bG.P0=X.jr;QW ED;var IB=await A.callMethod("getCurrentBuild");if(IB>=900000000000000000000||IB==-1){IB="unknown";}else{IB=IB.toString();}IF.My=IB;cW rE;if(D.hs=="simple"){rE=new Ul('storage');}G=new IF(D.gZ,D.Af,D.defaultPermission,D.downstreamName,rE,D.strictTls);A.u("setLinkEnabled",(B)async{try {G.OB("/sys/links/${B}/enabled",false).q(true);}catch (K){}});Ak.vy=(B)async{await A.callMethod("restartLink",B);};Hk.Ik=(M,AH,zG,aB)async{return await A.callMethod("createUser",[M,AH,zG,aB]);};Zb.Gz=(g N)async{await A.callMethod("editUser",N);};Fk.Iz=(String dF,String HF)async{await A.callMethod("renameUser",[dF,HF]);};Gk.Jz=(M)async{return await A.callMethod("removeUser",M);};Bk.xy=(M,aB)async{return await A.callMethod("changePassword",[M,aB]);};Ck.zy=(M)async{return await A.callMethod("forcePasswordChange",[M]);};Dk.Bz=(M,aB)async{return A.callMethod("authenticate",[M,aB]);};GD.FW=(String qB,r)async{var b=new LD();var V=new Map.from(D.map);V[qB]=r;b.load(V);await b.xG();await A.callMethod("setServerConfig",b);await zCB(qB,r);};JT.ab=(String qB,r)async{var b=new LD();var V=new Map.from(D.map);b.load(V);if(r==null){b.SM.remove(qB);}else{b.SM[qB]=r;}await b.xG();};GW.qy=(B)async{await A.callMethod("enableLink",B);};GW.ry=(B)async{await A.callMethod("disableLink",B);};zj.uy=(B)async{await A.callMethod("stopLink",B);};Wb.vj=(B)async{await A.callMethod("startLink",B);};lj.Sy=()async{await A.callMethod("scanForLinks");};wj.py=(String BH,String B,dynamic r)async{await A.callMethod("setLinkConfig",[BH,B,r]);};qj.ay=(String I,String B)async{return await A.callMethod("installLinkFromGit",[I,B]);};sj.dy=(ByteData h,String B)async{return await A.callMethod("installLinkFromFile",[B,h]);};ZI.mj=()async{return await A.callMethod("updateServer",[] );};nj.Uy=(ByteData h)async{return await A.callMethod("updateServerFromFile",h);};oj.Xy=(String B)async{return await A.callMethod("downloadLink",B);};Ek.Dz=(Map<String,dynamic> V)async{return await A.callMethod("exportDGLuxServer",V);};gQ.Kz=(ByteData h)async{return await A.callMethod("updateDartVmViaBytes",h);};Kk.Lz=(String I)async{return await A.callMethod("updateDartVmViaUrl",I);};Xb.sy=(String B)async{return await A.callMethod("updateLinkGit",B);};IT.xj=(String B)async{return await A.callMethod("updateLinkRepository",B);};Tb.iy=(String B,String I)async{return await A.callMethod("updateLinkZip",[B,I]);};Ub.jy=(String B,ByteData h,String yG)async{return await A.callMethod("updateLinkFile",[B,h,yG]);};tj.hy=(String I,String B)async{return await A.callMethod("installLinkFromZip",[I,B]);};Sb.fy=(String B,String dH)async{List<Map<String,dynamic>> sE;try {sE=await Bb();}catch (K){return [false,"Failed to fetch link repository information." " Please try again later. Error: ${K}"];}var I=sE.firstWhere((S)=>S["displayName"]==dH,orElse:()=>{})["zip"];return await A.callMethod("installLinkFromZip",[I,B]);};rj.cy=()async{await A.callMethod("restart");};Sb.gy=()async{try {var UI=await Bb();return "enum["+UI.map((S){return S["displayName"];}).join(",")+"]";}catch (K){return "enum[]";}};yj.ty=(String B)async{await A.callMethod("uninstallLink",B);};yD.aM=new xS(G,G);yD.aM.TV=D.TV;await G.ZSB();if(D.WH!=null&&D.WH.isNotEmpty){yD.Bj=new pk(["--broker=${D.WH}"],D.VY!=null?D.VY:"broker-",nodeProvider:G,enableHttp:false);yD.Bj.init();yD.Bj.connect();}G.cF.xJ=(V)async{await A.callMethod("updateUpstreamNodes",V);};if(D.gU||Ij||D.FQ.toLowerCase()=='debug'){fB.level=hB.q1;}if(D.Jf){var TI=await wCB();var cD=D.XH!=null&&D.XH.isNotEmpty;var eF=cD?"https":"http";var fC=cD?D.ZH:D.port;var I=D.UY==null?"${eF}://${TI}:${fC}/conn":D.UY;U.jB("Starting Broadcast of Broker at ${I}");ED=new QW();try {await ED.init(true);ED.HUB.listen((RW C){C.GUB(I);});}catch (K){U.QB("Failed to start broker broadcast service."+" Are you running more than one broker on this machine?");}}G.cF.aSB(D.cF);yD.aM.xI=X;await A.callMethod("ready");}Future<int> yi()async{var B=new File("BUILD_NUMBER");if(!(await B.exists())){return 900000000000000000000;}else{try {var A=await B.readAsString();A=A.trim();return int.parse(A);}catch (C){return -1;}}}Future<dynamic> RCB(HttpRequest A)async{if(A.method=='POST')return mCB(A);var D=A.uri.path;if(A.uri.queryParameters['resetToken']!=null){var G=A.uri.queryParameters['resetToken'];var I=await t.WB.callMethod('getResetToken',G);if(I==null){A.response.redirect(Uri.parse("/change_password#invalid_reset_token"));}D+= '?resetToken=${G}';}var H=YC.cb;var C=await YC.EFB.readAsString();String B="4200";if(await H.exists()){B=(await H.readAsString()).trim();if(B==null){B="4200";}}C=C.replaceAll("{{DGLUX_REVISION}}",B).replaceAll("{{TARGET}}",D);return new HH(C,ContentType.HTML);}Future<dynamic> mCB(HttpRequest A)async{final M=new RegExp(r'^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*\W)(?=.{8,})');String G=A.uri.queryParameters['resetToken'];String H;String B;if(G!=null){var N=A.uri.queryParameters['resetToken'];H=await t.WB.callMethod('getResetToken',N);if(H==null){A.response.redirect(Uri.parse("/change_password#invalid_reset_token"));return null;}B=H;}else if(!(await MK(A))){return null;}else{B=GH().username;}var O=await zM.AN(A);var I=O.TD;if(I==null||I["password"] is!String){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Invalid Request";}String J=I["password"];if(!M.hasMatch(J)){A.response.redirect(Uri.parse('/change_password#password_does_not_match_requirements'));return null;}try {await t.WB.callMethod("changePassword",[B,J]);await t.WB.callMethod("invalidateUserCache",B);if(G!=null){await t.WB.callMethod("removeResetToken",G);}}catch (C,Q){U.QB("Failed to change password for ${B}.",C);if(C is String&&C.contains('Password is same as existing one')){A.response.redirect(Uri.parse("/change_password#password_cannot_be_same"));return null;}U.QB("Unexpected error changing password",C,Q);A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;return "Failed to change password: ${C}";}var D=A.uri.queryParameters["target"];if(D==null){D=X.CJ;}g K=await t.WB.callMethod("getUser",B);if(K!=null&&K.metadata["forcePasswordChange"]==true){D="/change_password#password_change_required";}A.response.redirect(Uri.parse(D));return null;}Future<dynamic> xCB(HttpRequest C)async{var H=await t.WB.callMethod('getMailer',null);bool D=false;if(C.method=="POST"){D=await DDB(C);if(!D)return null;}var G=YC.cb;var A=await YC.FFB.readAsString();String B="4200";if(await G.exists()){B=(await G.readAsString()).trim();if(B==null){B="4200";}}A=A.replaceAll("{{DGLUX_REVISION}}",B).replaceAll("{{TARGET}}",C.uri.path);if(H==null){A=A.replaceAll("{{DIALOG_CONTENT}}",r'''Dialog box
  dialog.clear();
  dialog.addTitle('Unable to send e-mail');
  dialog.addText('SMTP Server is not configured. Please contact Solution Builder Administrator for assistance.');
  dialog.addTitle('Restore Admin Password');
  dialog.addText('Follow <a href="https://github.com/IOT-DSA/docs/wiki/CLI-Tools#change-password" target="_blank">these instructions</a> to restore admin password.');
  dialog.addTitle('No SMTP server');
  dialog.addText('SMTP server is not configured. Solution Builder is unable to send email messages. ' +
    'Please follow the instructions to update the server configuration.' +
    '<ol><li>Prepare SMTP server settings:<br />' +
    '<ul><li>Server Ip/Domain and Port</li><li>Username</li><li>Password</li></ul>' +
    '</li><li>Update SMTP parameters in server.json file in the smtp section. ' +
    '<a href="https://github.com/IOT-DSA/docs/wiki/DSA-Server-Options#smtp" target="_blank">See Example</a></li></ol>');
  dialog.display();
  ''');}else if(D){A=A.replaceAll("{{DIALOG_CONTENT}}",r'''Dialog box
    dialog.display(150);
    ''');}return new HH(A,ContentType.HTML);}Future<bool> DDB(HttpRequest A)async{var I=await t.WB.callMethod('getMailer',null);if(I==null){A.response.redirect(Uri.parse("/forgot_password"));return false;}var J=await zM.AN(A);var G=J.TD;String C=G["username"];String B=G["email"];if(C==null||C.isEmpty){A.response.redirect(Uri.parse("/forgot_password#username_cannot_be_empty"));return false;}if(B==null||B.isEmpty){A.response.redirect(Uri.parse("/forgot_password#email_must_be_provided"));return false;}B=B.toLowerCase();g D=await t.WB.callMethod("getUser",C);var H=(D!=null&&D.GE?.toLowerCase()==B);if(H){GDB(A,D);}else{HDB(B);}if(X.IZ){tCB(C,A.connectionInfo.remoteAddress,H);}return true;}Future<Null> GDB(HttpRequest B,g A)async{var C=await t.WB.callMethod("createResetToken",A.username);var D=B.requestedUri.replace(path:'/change_password',queryParameters:{'resetToken':C});try {IW G=await t.WB.callMethod('getMailer',null);await G.tQB(A.GE,D.toString());U.jB('Forgot password email sent to ${A.username}');}catch (H){U.QB('Failed to send forgot password email to ${A.GE}',H);}}Future<Null> HDB(String A)async{try {IW B=await t.WB.callMethod('getMailer',null);await B.TVB(A);U.jB('Wrong email address message sent to ${A}');}catch (C){U.QB('Failed to send wrong email address message to ${A}',C);}}Future<String> nV(g A,String B)async{if(A!=null&&A.pD){return 'write';}var N=Platform.script.toFilePath(windows:Platform.isWindows);var K=jT(jT(N));var O=p(K,'files');B=B.trim();if(B.startsWith("/")){if(!B.startsWith(O)){return null;}B=B.substring(K.length+1);}var D=B.split("/");if(D.length<=1){return null;}if(D[0]=="usr"){var Q=D[1];if(Q!=A.username){if(A.username!='guest'&&D[2].startsWith('profile.')){return 'read';}return null;}return 'write';}if(D[0]=="proj"){var I=D[1];var S=p("files","proj",I,"_proj.json");var M=new File(S);if(!(await M.exists())){return null;}var G=hE.convert(await M.readAsString());if(A.metadata!=null&&A.metadata["denyProjects"] is List){List J=A.metadata["denyProjects"];if(J.contains(I)){return null;}}if(A.metadata!=null&&A.metadata["allowProjects"] is List){List J=A.metadata["allowProjects"];if(!J.contains(I)){return null;}}if(G["owner"]!=null&&G["owner"]==A.username){return 'write';}if(G["owners"] is List){List V=G["owners"];if(V.contains(A.username)){return 'write';}}List<String> C=G["canRead"];List<String> H=G["canWrite"];if(C==null){C=const[] ;}if(H==null){H=const[] ;}if(H.contains(A.username)||(H.contains("all")&&A.username!='guest')||H.contains("*")||A.Nf(H)){return 'write';}if(C.contains(A.username)||(C.contains("all")&&A.username!='guest')||C.contains("*")||C.contains("guest")||A.Nf(C)){return 'read';}}return null;}MK(HttpRequest A,{bool requireSuperuser: false,String user,bool useRootRedirect: false})async{if((GH()==null||GH().username==null||GH().username=="guest")){var C=A.uri.toString();Uri B;if(useRootRedirect&&X.rY!=null){B=Uri.parse(X.rY);}else{if(C!="/"){B=Uri.parse("/login?target=${Uri.encodeComponent(C)}");}else{B=sV.dCB;}}A.response.redirect(B);return false;}if(requireSuperuser){var D=await uE(A);if(D.pD||(user!=null&&D.username==user)){return true;}else{await zD(A,A.response);return null;}}return true;}String xi;SCB(){if(xi!=null){return xi;}else{var B={"indexUrl":"index.html","viewerUrl":"viewer.html","dataUrl":"http","websocketUrl":"ws","connUrl":"conn","userUrl":"user","assetUrl":"file","sessionUrl":"session","dbUrl":"db","logoutUrl":"logout","loginUrl":"login","formatDg5":X.wq};var A=X.fU;if(A!=null&&A!=""){B['customLogo']=A;}return xi=QL.convert(B);}}bool Rx(X509Certificate A,String B,int C){U.jB('OpenID configuration: Bad certificate for ${B}:${C}');U.kC('OpenID configuration - Certificate issuer: ${A.issuer}\n'+'Certificate Subject: ${A.subject}');return !X.strictTls;}Cj(A){if(Ij){return hC.PKB((){return A();},onError:(B,hC C){if(Zone.current.parent!=null){return Zone.current.parent.handleUncaughtError(B,C.YS);}else{return Zone.current.handleUncaughtError(B,C.YS);}});}else{return A();}}String zS=null;Future<bool> VCB()async{if(zS!=null&&zS.isNotEmpty){return true;}zS=await fz("clamscan");if(zS==null){U.QB("strictFileUpload is enabled, but Clam-AV is not installed. Skipping scanning files for viruses.");zS="";}return zS.isNotEmpty;}Future<bool> cCB(File B,IOSink C)async{if(!(await VCB())){return true;}if(!X.gUB){return true;}await C.close();var A=await Process.run("clamscan",[B.absolute.path]);U.mB(A.stdout);return A.exitCode==0;}String BT=null;Future<bool> iCB()async{if(BT!=null&&BT.isNotEmpty){return true;}BT=await fz("magick");if(BT==null){U.QB("strictFileUpload is enabled, but imagemagick is not installed. Skipping scanning files for viruses.");BT="";}return BT.isNotEmpty;}Future<IOSink> pCB(File A,IOSink B)async{if(!(await iCB())){return B;}String C=A.path.substring(A.path.indexOf(".")+1);String D=Sm(C);if(D==null||!D.startsWith("image/")){return B;}await B.close();var G=bm([Directory.systemTemp.absolute.path,"dglux-image."+C]);var I=await Process.run("magick",["convert",A.absolute.path,"-strip","-resize","100%",G]);if(I.exitCode==0){var J=new File(G);List<int> K=await J.readAsBytes();IOSink H=A.openWrite();H.add(K);return H;}return null;}vCB(HttpRequest A)async{try {var wD=Uri.decodeComponent(A.uri.path).substring("/file".length);if(wD.split('/').contains('..')){await zD(A,A.response);return null;}if(wD.isNotEmpty&&wD.startsWith("/")){var J=wD.substring(1);FH("File Service","Get File ${J}");g K=await uE(A);String IB=await nV(K,J);if(!X.Yf&&IB==null){await zD(A,A.response);return null;}var D=new File(bm(["files"]..addAll(J.split("/"))));if(!(await D.exists())){await RJ(A,A.response);return null;}return D;}String I=A.uri.queryParameters["op"];String B=A.uri.queryParameters["path"]??"";if(I==null){A.response.statusCode=HttpStatus.BAD_REQUEST;return "File Operation Not Specified.";}if(I.endsWith("Proj")){return vi(A);}var rE=!(const["get","list","info","watch"]).contains(I);g K=await uE(A);if(X.js&&rE&&K==HD.NK){await zD(A,A.response);return null;}String IB=await nV(K,B);bool FC=IB=='write';if(B!=null&&B.isNotEmpty&&!X.Yf&&(IB==null||(IB=='read'&&rE))){await zD(A,A.response);return null;}if(B!=null&&B.contains('..')){await zD(A,A.response);return null;}if(X.ef&&rE){final List<String> AH=A.headers["X-DG-CSRF-TOKEN"];final List<String> BH=A.headers["X-DG-CSRF-TIMESTAMP"];iE zG=GH();if(zG==null||zG.rJ==HD.NK||AH==null||AH.isEmpty||BH==null||BH.isEmpty){await zD(A,A.response);return null;}final String kS=zG.id;final String UO=AH.first;final String WO=BH.first;if(!(await t.WB.callMethod("verifyCsrfToken",[UO,kS,WO]))){await zD(A,A.response);return null;}}if(I=="get"){FH("File Service","Get File ${B}");return new File(p("files",B));}else if(I=="list"){FH("File Service","List ${B}");var Q=new Directory(p("files",B));if(await Q.exists()){var N=[] ;var YO=await Q.list(recursive:false).toList();var DK=<File>[] ;var TI=<Directory>[] ;for(var rC in YO){var H=hG(rC.path);if(H.startsWith(".")||H=="_proj.json")continue;if(rC is Directory){TI.add(rC);}else{DK.add(rC);}}for(var ZO in TI){var H=hG(ZO.path);N.add({"type":"folder","path":"${B}/${H}","name":H,"writable":FC,"icon":"/assets/icons/folder.png"});}var cD=[] ;if(A.uri.queryParameters.containsKey("filters")){cD=A.uri.queryParameters["filters"].split(",");}if(A.uri.queryParameters.containsKey("filter")){cD=A.uri.queryParameters["filter"].split(",");}fileLoop:for(var D in DK){var H=hG(D.path);if(cD.isNotEmpty){for(var VO in cD){if(!H.contains(VO)){continue fileLoop;}}}var V=await D.stat();var sE=dx(H);N.add({"type":"file","path":"${B}/${H}","name":H,"icon":sE,"size":V.size,"created":V.changed.millisecondsSinceEpoch,"modified":V.modified.millisecondsSinceEpoch,"writable":FC});}return N;}else{A.response.statusCode=HttpStatus.NOT_FOUND;return "Directory Not Found";}}else if(I=="info"){FH("File Service","Stat File ${B}");var J=p("files",B);var UI=await FileSystemEntity.type(J);if(UI==FileSystemEntityType.DIRECTORY){var Q=new Directory(J);var H=hG(Q.path);return {"type":"folder","path":B,"name":H,"writable":FC,"icon":"/assets/icons/folder.png"};}else if(UI==FileSystemEntityType.FILE){var D=new File(J);var H=hG(D.path);var V=await D.stat();var sE=dx(H);return {"type":"file","path":B,"name":H,"icon":sE,"size":V.size,"created":V.changed.millisecondsSinceEpoch,"modified":V.modified.millisecondsSinceEpoch,"writable":FC};}else{A.response.statusCode=HttpStatus.NOT_FOUND;return "File Not Found";}}else if(I=="upload"){FH("File Service","Upload ${B}");if(X.js&&B!=null&&B.isNotEmpty){if(B.contains(".")){List<String> eH=X.fUB;String HF=B.substring(B.indexOf(".")+1);String dF=Sm(HF);if(HF.contains("/")){await zD(A,A.response);return null;}if(dF!=null&&eH.where((XO)=>Sm(XO)==dF).isEmpty){await zD(A,A.response);return null;}if(dF==null&&!eH.contains(HF)){await zD(A,A.response);return null;}}}var D=new File(p("files",B));if(!(await D.exists())){await D.create(recursive:true);}else{if(A.uri.queryParameters["exists"]=="fail"){A.response.statusCode=HttpStatus.CONFLICT;return "file exists";}}IOSink O;try {aC C=await aC.bM(B);List<int> h=await D.readAsBytes();O=await D.openWrite();var yG=0;await A.listen((dH){yG+= dH.length;O.add(dH);}).asFuture();if(X.js&&(!(await cCB(D,O))||(await pCB(D,O))==null)){try {await O.close();O=D.openWrite();O.add(h);yG=h.length;}catch (ED){}A.response.statusCode=HttpStatus.BAD_REQUEST;return "file had viruses";}if(C!=null){String G=A.uri.queryParameters["message"];if(G!=null&&G!=''){G='${aC.PK(A,K)}\n${G}';}else{G=aC.PK(A,K);}C.zL(G);}return yG.toString();}finally {try {await O.close();}catch (ED){}}}else if(I=="delete"){aC C=await aC.bM(B);FH("File Service","Delete ${B}");var J=p("files",B);var M=await ZQ(J);if(await M.exists()){await M.delete(recursive:true);if(C!=null){C.zL(aC.PK(A,K));}}}else if(I=="mkdir"){FH("File Service","Create Directory ${B}");var Q=new Directory(p("files",B));if(await Q.exists()){A.response.statusCode=HttpStatus.CONFLICT;return "Directory already exists.";}await Q.create(recursive:true);}else if(I=="rename"){var J=p("files",B);var H=A.uri.queryParameters["name"];var UM=hG(B).toLowerCase();if(H.toLowerCase()==UM){A.response.statusCode=HttpStatus.CONFLICT;return "Cannot rename a file or folder to the same name";}var M=await ZQ(J);FH("File Service","Rename ${B} -> ${H}");var lS=p("files",jT(B),H);await M.rename(lS);aC C=await aC.bM(B);if(C!=null){C.zL(aC.PK(A,K));}}else if(I=="move"){aC C=await aC.bM(B);var EB=A.uri.queryParameters["dest"];FH("File Service","Move ${B} -> ${EB}");var xD=p("files",EB);var J=p("files",B);var M=await ZQ(J);await M.rename(xD);if(C!=null){C.zL(aC.PK(A,K));}}else if(I=="copy"){aC C=await aC.bM(B);var J=p("files",B);var M=await ZQ(J);var EB=A.uri.queryParameters["dest"];FH("File Service","Copy ${B} -> ${EB}");var xD=p("files",EB);var r=M is File?new File(xD):new Directory(xD);if(M is Directory&&r is Directory){Directory RO=r;await r.create(recursive:true);await (RO.list(recursive:true).asyncMap((File eF)async{if(eF is Directory){return false;}var bO=eF.path.replaceAll(M.path,r.path);var D=new File(bO);if(!(await D.exists())){await D.create(recursive:true);}var qB=await eF.openRead();var aB=await D.openWrite();await aB.addStream(qB);await aB.close();return true;}));}else{await r.create(recursive:true);var qB=await M.openRead();var aB=await r.openWrite();await aB.addStream(qB);await aB.close();}if(C!=null){C.zL(aC.PK(A,K));}}else if(I=="history"){if(B==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "Invalid path.";}aC C=await aC.bM(B);if(C==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "Not supported.";}String ZE=A.uri.queryParameters["from"];String S=B.split('/').sublist(2).join('/');if(ZE=='')ZE=null;if(S=='')S=null;List<fT> TO=await C.wcB.G9(limit:100,range:ZE,file:S,detail:true);List N=[] ;for(fT b in TO){Map SI={};for(ec VI in b.wC){SI[VI.name]=VI.wI;}Map fC={'sha':b.a_,'ts':b.e7.toUtc().toIso8601String(),'msg':b.message,'changes':SI};if(b.Xf!=null){var EK=b.Xf.where((String UB)=>UB.startsWith('tag: ')).map((String UB)=>UB.substring(5));if(!EK.isEmpty){fC['tags']=EK.join(',');}}N.add(fC);}return N;}else if(I=="rollback"){if(B==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "Invalid path.";}String CC=A.uri.queryParameters["sha"];if(CC==null||CC==''){A.response.statusCode=HttpStatus.NOT_FOUND;return "Invalid Sha.";}String S=B.split('/').sublist(2).join('/');if(S==""){S="*";}aC C=await aC.bM(B);if(C==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "Not supported.";}await C.wcB.BM(['checkout',CC,S]);String G=A.uri.queryParameters["message"];if(G!=null&&G!=''){G='${aC.PK(A,K)}\nrevert to ${G}';}else{G='${aC.PK(A,K)}\nrevert to ${CC}';}C.zL(G);}else if(I=="tag"){if(B==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "Invalid path.";}String YE=A.uri.queryParameters["tag"];if(YE==null||YE==''){A.response.statusCode=HttpStatus.NOT_FOUND;return "Invalid Tag.";}aC C=await aC.bM(B);if(C==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "Not supported.";}String G=A.uri.queryParameters["message"];if(G!=null&&G!=''){G='${aC.PK(A,K)}\n${G}';}else{G=aC.PK(A,K);}try {await C.wcB.KQB(YE.replaceAll(new RegExp(r'[?*\[ /\\:~^]'),'_'),commit:G);}catch (SO){A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;return SO.toString();}}else if(I=="uploadLicense"){FH("File Service","Upload License");var aO=await zM.AN(A);var LB=aO.TD;var D=YC.bb;var h=LB is String?ZM.convert(LB):LB;if(A.uri.queryParameters.containsKey("crc")){var HL=A.uri.queryParameters["crc"];var JL=DCB.GCB(h);if(HL!=JL){A.response.statusCode=HttpStatus.NOT_ACCEPTABLE;return "Got checksum ${JL}, but expected ${HL}.";}}var CH=LB is String?LB:RL.convert(h);var N=await t.WB.callMethod("updateLicenseData",CH);if(N==true){await D.writeAsBytes(h);A.response.statusCode=HttpStatus.ACCEPTED;var iS=(await D.stat()).size;return iS.toString();}else{A.response.statusCode=HttpStatus.NOT_ACCEPTABLE;return "Invalid License";}}else if(I=="watch"){var J=p("files",B);var M=await ZQ(J);var IL=await WebSocketTransformer.upgrade(A);var qB=M.watch(recursive:true);var jS=qB.listen((FileSystemEvent KL){var fC={"type":LDB[KL.type],"path":KL.path};IL.add(QL.convert(fC));});IL.done.then((XV){jS.cancel();});return null;}else{A.response.statusCode=HttpStatus.SERVICE_UNAVAILABLE;return "Unknown Operation: ${I}";}return "";}catch (ED,UB){A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;var CH=ED.toString();U.QB('Internal server error for request: ${A.uri}',ED,UB);return CH;}}const Map<int,String> LDB=const{FileSystemEvent.CREATE:"create",FileSystemEvent.MODIFY:"modify",FileSystemEvent.DELETE:"delete",FileSystemEvent.MOVE:"move"};String dx(String C){var A="/assets/icons/document.png";var B=Zm(C);if(const[".jpg",".jpeg",".gif",".webp",".tiff",".png",".bmp",".svg"].contains(B)){A="/assets/icons/image.png";}else if(const[".js",".json",".dart",".java",".sh",".bash",".hs",".cs",".c",".h",".hpp",".cpp",".cc",".groovy",".d",".php",".jsp",".lua",".bat",".swift",".css",".xml"].contains(B)){A="/assets/icons/document-code.png";}else if(const[".zip",".tgz",".tar.gz",".gz",".tar",".bz2",".tar.bz2",".xz"].contains(B)){A="/assets/icons/document-zipper.png";}else if(const[".txt",".csv"].contains(B)){A="/assets/icons/document-text.png";}else if(const[".html",".xhtml"].contains(B)){A="/assets/icons/document-globe.png";}else if(const[".dg5",".dgs",".df5"].contains(B)){A="/assets/icons/blue-document-code.png";}return A;}class aC{static bool sa=false;static WCB(bool A)async{if(A){sa=await eL.eIB();}else{sa=false;}}static String PK(HttpRequest A,g C){String B='';if(A.uri.queryParameters.containsKey("bId")){B=A.uri.queryParameters['bId'];}return '${C.username} - ${A.connectionInfo.remoteAddress.host} ${B}';}static Map<String,aC> Dj={};static Future<aC> bM(String I)async{if(!aC.sa){return null;}List B=I.split('/');if(B.length>1&&B[0]=='proj'){String A=B[1];if(Dj.containsKey(A)){return Dj[A];}String D='files/proj/${A}';Directory G=new Directory(D);if(!G.existsSync()){G.createSync();}File H=new File(D+'/.gitignore');if(!H.existsSync()){H.writeAsStringSync('.*\n!/.gitignore');}aC C=new aC.IWB(A);Dj[A]=C;await C.uPB();return C;}return null;}final String C_;eL wcB;uPB()async{if(!await wcB.OSB()){await wcB.init();await wcB.BM(['add','-A']);await wcB.zL("init project");}}aC.IWB(this.C_){wcB=new eL.cWB('files/proj/${C_}');}bool xcB=false;String d7;void zL(String A){if(!xcB){xcB=true;d7=A;new Timer(new Duration(seconds:1),bQB);}}bQB()async{await wcB.BM(['add','-A']);xcB=false;await wcB.zL(d7);}}class HD{static YI uF;static ki Wx;static final g NK=new g("guest",false);}class yD{static xS aM;static pk Bj;static String qV;static int ua;static Function va;}class sV{static final Uri wa=Uri.parse("/");static final Uri dCB=Uri.parse("/login");}class t{static gC get WB=>gC.oW;static void set WB(gC A){gC.oW=A;}static String xa;static String ya;static String za;static List<iE> iH=[] ;static bool CT;static int Gj;static IW Hj;}KCB(String D,B)async{if(X.uU!=null&&X.uU is Map&&X.uU.containsKey(D)){if(B is Map){B=[QL.convert(B)];}for(var C in X.uU[D]){List<String> A;if(C is List){A=C;}else{A=C.toString().split(" ");}var G=A.removeAt(0);A.addAll(B);gF(G,args:A,inherit:true);}}}Map<String,Function> RC={};Ux(String B,{bool shouldStartNow: false,bool skipDuplicates: false})async{var A=new Directory(B);if(await A.exists()){await for(Directory C in A.list().where((D)=>D is Directory)){await sCB(C.absolute.path,shouldStartNow,skipDuplicates);}}}rV({bool shouldStartNow: false,bool skipDuplicates: false})async{await Ux("links",shouldStartNow:shouldStartNow,skipDuplicates:skipDuplicates);await Ux("dslinks",shouldStartNow:shouldStartNow,skipDuplicates:skipDuplicates);}List<String> Fj=[] ;Future<rB> fCB(String B,String C)async{var A=await PEB(B,C);if(A.aD){rV();}return A;}Future<rB> lCB(String B,String C)async{var A=await REB(B,C);if(A.aD){rV();}return A;}Future<rB> qCB(ByteData B,String C)async{var A=await QEB(B,C);if(A.aD){rV();}return A;}sCB(String G,[bool SO=false,bool TO=false])async{var C=hG(G);var Q=new File("logs/${C}.log");var UO=new Directory("${G}/.git");var xD=await VE("git");var HL=await UO.exists();var sE=HL&&xD!=null;var rC=sE?"git":"none";if(sE){IH M=await gF(xD,args:["pull"],workingDirectory:G,outputFile:Q,logCompression:X.lU);if(M.exitCode!=0){U.QB("Tried to run 'git pull' in '${G}', but it failed.");}}UB(String VO)async{if(!(await Q.exists())){await Q.create(recursive:true);}await Q.writeAsString("[${xV}] ${VO}\n",mode:FileMode.APPEND);}var LB=new File("${G}/dslink.json");var O=new Directory(G).absolute;if(!(await LB.exists())){return;}Map S;try {S=hE.convert(await LB.readAsString());}catch (H){U.BC("Error while loading dslink.json at ${LB.path}: ${H}");return;}var A=new ex(C);A.kB=new aT.RWB(S);try {A.kB.Ca();}catch (H){U.BC("Error while verifying dslink.json at ${LB.path}: ${H}");return;}try {if(uV!=null&&rC=="none"){var SI=A.kB.name;if(uV.any((V)=>V["name"]==SI)){rC="repository";}}}catch (H){}if(Fj.contains(C)){if(!TO){U.BC("Error while loading '${C}': duplicate link found! (path: ${G})");}return;}Fj.add(C);if(!(await Q.exists())){await Q.create(recursive:true);}if(VB!=null){await VB.callMethod("addLink",[C,A.kB.description,A.kB.version,rC,!X.mN.contains(C),A.kB.L]);}await A.eE("stopped");Process b;bQ r;Function IB;Function wD;Completer I;wD=RC[C]=(String J,[List yG])async{Future UI()async{var S=hE.convert(await LB.readAsString());A.kB=new aT.RWB(S);try {A.kB.Ca();}catch (H){U.BC("Error while verifying dslink.json at ${LB.path}: ${H}");return;}String VI=A.kB.version;String DK=A.kB.description;await VB.callMethod("updateLinkInfo",[C,VI,DK]);}FH("Link Commander","DSLink ${C} received command '${J}'");if(J=="restart"){if(!A.CL){await wD("start");}else{A.yR=WG.Oj;await wD("stop");}}else if(J=="start"){var XO=X.mN.remove(C);if(XO){await VB.callMethod("setLinkEnabled",C);await X.xG();}if(!A.CL&&IB!=null){IB();}}else if(J=="updateInfo"){await UI();}else if(J=="setLinkConfig"){String IL=yG[0];dynamic YO=yG[1];var qB=X.FZ;if(qB==null){qB={};}if(qB[C]==null)qB[C]={};qB[C][IL]=YO;await X.xG();}else if(J=="stop"){if(A.yR!=WG.Oj){A.yR=WG.fx;}if(b!=null){if(Platform.isWindows){await SL(b.pid);}else{b.kill();}}else if(r!=null){await r.yg(O.path).timeout(const Duration(seconds:5),onTimeout:(){});}else if(S["served"]==true){await VQ.callMethod("removeLinkStatic",[p(O.path,A.kB.uP)]);await A.eE("stopped");A.CL=false;if(I!=null&&!I.isCompleted)I.complete();}if(I!=null){await I.future;}}else if(J=="enable"){X.mN.remove(C);await X.xG();}else if(J=="disable"){if(!X.mN.contains(C)){X.mN.add(C);await X.xG();}}else if(J=="update-git"){IH M=await gF(xD,args:["pull"],workingDirectory:G,outputFile:Q,logCompression:X.lU);if(M.exitCode!=0){return "Failed.";}else{return "Success!";}}else if(J=="uninstall"){await RC[C]("stop");var eH=0;while(A.CL){await new Future.delayed(const Duration(milliseconds:25));eH++ ;if(eH==320){throw new Exception("Failed to uninstall: Can't stop link.");}}await VB.callMethod("removeLink",C);Fj.remove(C);RC.remove(C);var rE=new Directory(G);if(await rE.exists()){await rE.delete(recursive:true);}U.jB("DSLink '${C}' has been uninstalled.");}else if(J=="update-repo"){try {var ED=S["name"];var TI=await Bb();var h=TI.firstWhere((V)=>V["name"]==ED,orElse:()=>null);if(h==null){return "Error: ${ED} was not found in the repository.";}var cD=new File(p(O.path,".rev"));String FC="UNKNOWN";if(await cD.exists()){FC=await cD.readAsString();FC=FC.trim();}if(h["revision"]!=null&&h["revision"]==FC){return "Link is up-to-date.";}var EK=h["zip"];if(h["zip"]==null){return "Error: ${ED} was found in the repository," "but no ZIP file was specified.";}await RC[C]("stop");var M=await zx(O,EK,h);if(M.contains("Success!")&&h["revision"]!=null){await cD.writeAsString(h["revision"]);}return M;}catch (H){return "Error: ${H.toString()}";}}else if(J=="getLinkDirectory"){return O;}else if(J=="getLinkJson"){return S;}};var aB=S["useRuntimeManager"]!=null?S["useRuntimeManager"]:true;aB=aB&&!Platform.isWindows;if(aB&&A.kB.KG!=null&&A.kB.KG.isNotEmpty&&A.kB.KG.keys.contains("dart")&&(X.ch||X.Dt)){r=await MEB(vV,X.Uq);}if(aB&&((A.kB.KG!=null&&A.kB.KG.isNotEmpty&&A.kB.KG.keys.contains("java"))||(A.kB.name.startsWith("dslink-java-")||A.kB.name.startsWith("dslink-scala-"))&&A.kB.L.containsKey("handler_class")&&A.kB.L.containsKey("name")&&A.kB.L.containsKey("log")&&(X.ch||X.Et))){String JL=p("bin","runtimes","java.jar");if(await new File(JL).exists()){r=await LEB(vV,X.Xr);}}IB=([D()])async{if(X.mN.contains(C)){if(D!=null){D();}return null;}if(A.kB.pY!=null&&A.kB.pY.isNotEmpty){var CC=A.kB.pY;if(A.kB.KG!=null&&A.kB.KG.isNotEmpty&&A.kB.KG.keys.first=="dart"&&CC.every((V)=>V.startsWith("pub "))){var KL=new File(p(G,"pubspec.yaml"));if(!(await KL.exists())){CC=[] ;}}if(A.kB.KG!=null&&A.kB.KG.isNotEmpty&&A.kB.name.startsWith("dslink-python-")&&await rx()&&await oDB()&&A.kB.KG.keys.first=="python"){var UM=new Directory(p(G,"packages"));if(!(await UM.exists())){var RO=await VE("virtualenv");await gF(RO,args:["--system-site-packages","packages"],workingDirectory:G);}}if(CC.isNotEmpty){await A.eE("getting dependencies");U.jB("Fetching Dependencies for DSLink '${C}'");for(var J in CC){var dF=J.split(" ");var B=dF[0];if(!am(B)&&!B.contains("/")&&!B.contains("\\")){var eF=await VE(B);if(A.kB.name.startsWith("dslink-python-")&&(await wx(p(G,"packages")))&&(B=="python"||B=="easy_install"||B=="pip")){if(Platform.isWindows){B=p(G,"packages","Scripts",B+".exe");}else{B=p(G,"packages","bin",B);}}else if(eF!=null){B=eF;}}var N=dF.skip(1).toList();IH M;try {M=await gF(B,args:N,outputFile:Q,logCompression:X.lU,workingDirectory:G,environment:{"DSA_LINK_NAME":C},handler:(Process ZO){b=ZO;},runInShell:false);}catch (H){U.BC("Error while fetching dependencies for link '${C}':\n"+"Encountered process error while running '${B}'"+" with arguments ${N}: ${H}");await A.eE("stopped");if(D!=null){D();}return null;}b=null;if(M.exitCode!=0){U.BC("Error while fetching dependencies for link '${C}':\n" "Process '${B}' with arugments ${N} exited"+" with status ${M.exitCode}");await A.eE("stopped");if(D!=null){D();}return null;}}U.jB("Fetched Dependencies for DSLink '${C}'");await A.eE("stopped");}}if(A.kB.name.startsWith("dslink-java-")){if(!(await pDB())){await A.eE("install java");await UB("Java is not installed. Please install Java."+" See https://www.java.com/ for more information.");if(D!=null){D();}return null;}}if(A.kB.name.startsWith("dslink-javascript-")){if(!(await mDB())){await A.eE("install nodejs");await UB("NodeJS is not installed. Please install NodeJS."+" See https://nodejs.org/ for more information.");if(D!=null){D();}return null;}}if(A.kB.name.startsWith("dslink-ruby-")){if(!(await nDB())){await A.eE("install ruby");await UB("Ruby is not installed. Please install Ruby."+" See https://www.ruby-lang.org/en/documentation/installation/"+" for more information.");if(D!=null){D();}return null;}}if(A.kB.name.startsWith("dslink-python-")){if(!(await rx())){await A.eE("install python");await UB("Python is not installed."+" Please install Python via Get DSA or https://www.python.org/downloads/");if(D!=null){D();}return null;}}await A.eE("starting");String B;var N=[] ;var K={};A.kB.L.keys.where((AH)=>A.kB.L[AH]["value"]!=null||A.kB.L[AH]["default"]!=null).forEach((V){K[V]=A.kB.L[V]["value"]==null?A.kB.L[V]["default"]:A.kB.L[V]["value"];});K.addAll(X.FZ.containsKey(C)?X.FZ[C]:{});if(A.kB.L.containsKey("broker")&&!K.containsKey("broker")){K["broker"]=Ab(Uri.parse("/conn")).toString();}if(aB&&r!=null){K["log-file"]=Q.absolute.path;}if(A.kB.L.containsKey("token")&&!K.containsKey("token")&&!(X!=null&&X.tK!=null&&X.tK.isNotEmpty)){K["token"]=await VB.callMethod("getTrustedToken",C);}for(var ZE in A.kB.L.keys){var BH=A.kB.L[ZE];if(BH["required"]==true&&BH["value"]==null&&!K.containsKey(ZE)){U.BC("DSLink '${C}' requires the config '${ZE}' to be specified.");if(D!=null){D();}return null;}}var bO=S["served"]==true;if(bO){if(I!=null&&!I.isCompleted)I.complete();I=new Completer();var G=K["path"];if(G==null||G is!String||G.isEmpty){G="/links/${C}";}var WO=p(O.path,A.kB.uP);await VQ.callMethod("addLinkStatic",[WO,G]);await A.eE("started");A.CL=true;if(D!=null){D();}}else{if(A.kB.KG==null||A.kB.KG.isEmpty){B=A.kB.uP;if((B.endsWith(".bat")||B.endsWith(".exe"))&&!Platform.isWindows){B=B.substring(0,B.length-4);}else if(Platform.isWindows){if(!B.endsWith(".bat")){B="${B}.bat";}}if(Platform.isWindows){B=B.replaceAll("/","\\");}if(!am(B)){B=p(O.path,B);}}else{B=A.kB.KG.keys.first;if(B=="dart"){try {B=Platform.resolvedExecutable;}catch (H){B=Platform.executable;}if(B==null||B.isEmpty){B=await VE("dart");}if(B==null){B=Platform.executable;}if(B==null&&Platform.isAndroid){B="/data/local/tmp/dart";}if(X.HS!=null&&X.HS["DART_VM_FLAGS"] is String){N.addAll(X.HS["DART_VM_FLAGS"].split(" "));}}if(B=="java"){B=await VE("java");if(B==null){B="java";}N.add("-jar");}if(B=="python"){if(await wx(p(G,"packages"))){if(Platform.isWindows){B=p(O.path,"packages","Scripts","python.exe");}else{B=p(O.path,"packages","bin","python");}}else{B=await VE("python");}if(B==null){B="python";await UB("Warning: Python was not found.");}}N.add(A.kB.uP);}VB.callMethod("updateLinkConfig",[C,K]);for(var EB in K.keys){if(!A.kB.L.containsKey(EB)&&EB!="log-file"){U.QB("Warning: DSLink '${C}' was configured to"+" have '${EB}' be '${K[EB]}', but that option was not"+" found for this link.");}if(EB=="handler_class"){continue;}N.addAll(["--${EB}","${K[EB]}"]);}zG()async{if(I!=null&&!I.isCompleted)I.complete();I=new Completer();if(r!=null){var aO=await r.gs(O.path,A.kB.uP,K);if(!aO){A.eE("errored");if(D!=null){D();D=null;}A.CL=false;return null;}A.CL=true;A.eE("started");U.jB("DSLink '${C}' started.");if(D!=null){D();D=null;}await r.WZ(O.path).first;if(D!=null){D();D=null;}A.CL=false;return null;}try {var CH={"DSA_LINK_NAME":C};if(X.HS is Map){CH.addAll(X.HS);}if(A.kB.RSB["sudo"]==true&&DEB){N.insert(0,B);B="sudo";}var M=await gF(B,args:N,outputFile:Q,logCompression:X.lU,workingDirectory:G,handler:(Process YE){if(D!=null){D();}U.jB("DSLink '${C}' started.");A.CL=true;A.eE("started");b=YE;Aj(YE.pid,C);vV.add(YE);},environment:CH,runInShell:false);if(M.exitCode==126){throw new ProcessException(B,N,"Permission denied");}M=null;}catch (H,dH){if(H is ProcessException){if((Platform.isLinux||Platform.isMacOS)&&B!="bash"){N.insert(0,B);B="bash";return await zG();}U.BC("DSLink '${C}' exception while starting",H,dH);U.QB("DSLink '${C}' errored during startup.");vV.remove(b);A.CL=false;await A.eE("errored");A.yR=WG.Pj;return null;}U.BC("DSLink '${C}' exception while starting",H,dH);}}await zG();try {if(b!=null){await SL(b.pid);}}catch (H){}vV.remove(b);A.CL=false;var fC=false;var HF=false;A.eE("stopped");if(I!=null&&!I.isCompleted)I.complete();if(A.yR==WG.Oj){U.jB("DSLink '${C}' is now restarting.");fC=true;}else if(A.yR==WG.fx){U.jB("DSLink '${C}' is now stopped.");}else{U.jB("DSLink '${C}' suddenly stopped.");fC=true;HF=true;}A.yR=WG.Pj;if(HF){await new Future.delayed(const Duration(seconds:1));}if(fC){await IB();}}};if(SO){IB();}else{Nj.add(IB);}}class ex{final String name;ex(this.name);bool CL=false;WG yR=WG.Pj;aT kB;eE(String A)async{if(VB!=null){await VB.callMethod("setLinkState",[name,A]);}}}class WG{static const WG fx=const WG(0);static const WG Oj=const WG(1);static const WG Pj=const WG(3);final int id;const WG(this.id);}Future<ByteData> MDB(String A)async{var H=p("dslinks",A);var C=new Directory(H).absolute;if(!(await C.exists())){throw new Exception("DSLink at ${H} was not found.");}var I=new WM();await for(FileSystemEntity B in C.list(recursive:true)){if(B is File){var A=cm(B.path,from:C.path);if(A==".dslink.key"||A==".key"){continue;}var D=await B.stat();var J=await B.readAsBytes();var G=new qD(A,D.size,J);G.mode=D.mode;G.VSB=D.modified.millisecondsSinceEpoch;I.LY(G);}}var K=new oh();return zQ.cl(K.encode(I));}FH(String A,String B){if(X!=null&&X.GM!=null&&X.GM.contains(A)){if(U!=null){U.jB("[${A}] ${B}");}else{print("[${A}] ${B}");}}}const String AT='loginAttempt';ta(HttpRequest A,{String invalid: null,iE zoneSession})async{if(A.method=="POST"&&invalid==null){var qB=await zM.AN(A);var B=qB.TD;if(B==null||B["username"]==null){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Invalid Request";}var C=B["username"];var CC=B["remember"]!=null&&!t.CT;if(X.O9){int J=await t.WB.callMethod("getLoginAttempts",C);J+= 1;if(J>X.Jg){U.jB('${J} failed login attempts for '+'${C}. Throttling for ${X.JZ}s');J=0;await new Future.delayed(new Duration(seconds:X.JZ));}await t.WB.callMethod("setLoginAttempts",[C,J]);}lV G=await t.WB.callMethod("getTwoFactorAuth");String S;if(B!=null&&G!=null&&G.jg&&G.vq.every((N)=>B.containsKey(N))){String K=await G.Ys(B,A);if(K==null){return await ta(A,invalid:'Invalid Code for Two Factor Authentication! Please try again.',zoneSession:zoneSession);}if(K!=''){S=await G.tp(K,A);}}else{var O=B["password"];if(O is String&&B["b64"]=="yes"){O=RL.convert(Gx(O));}var K=await t.WB.callMethod("authenticate",[C,O]);if(!K){return await ta(A,invalid:'',zoneSession:zoneSession);}else if(X.O9){t.WB.callMethod("clearLoginAttempts",C);}g FC=await t.WB.callMethod("getUser",C);if(G!=null&&FC.metadata["skipTwoFactorAuth"]!=true){var b=await G.tq(C,B,A);if(G.jg){return new HH(b,ContentType.HTML);}else{if(!b){return await ta(A,invalid:'',zoneSession:zoneSession);}}}}zoneSession=await RK(C,zoneSession);if(X.IZ){kCB(C,A.connectionInfo.remoteAddress);}var M=tV(A);var fC=new Cookie("DGSESSION",zoneSession.id)..secure=M;A.response.cookies.add(fC);if(X.ef){String h=new DateTime.now().toIso8601String();String rC=await t.WB.callMethod("createCsrfToken",[zoneSession.id,h]);A.response.cookies..add(new Cookie("DG-CSRF-TIMESTAMP",h)..httpOnly=false..secure=M)..add(new Cookie("DG-CSRF-TOKEN",rC)..httpOnly=false..secure=M);}if(CC){var r=Uri.encodeComponent(C);var V=new DateTime.now();var EB=new DateTime(V.year,V.month+1,V.day);var IB=await t.WB.callMethod("createRememberToken",C);A.response.cookies.removeWhere((LB)=>LB.name=="DGTOKEN"||LB.name=="DGUSER");A.response.cookies.add(new Cookie("DGTOKEN",IB)..expires=EB..secure=M);A.response.cookies.add(new Cookie("DGUSER",r)..expires=EB..secure=M);A.response.headers.set("X-DG-Token","${r} ${IB}");}if(S!=null){return new HH(S,ContentType.HTML);}var H=A.uri.queryParameters["target"];if(H==null){var I=await uE(A,zoneSession);if(I!=null&&I.metadata!=null&&I.metadata["rootUrl"] is String){H=I.metadata["rootUrl"];}else{H=X.CJ;}if(I!=null&&I.metadata["forcePasswordChange"]==true){H="/change_password#password_change_required";}}else{String ED=H;var cD=Qj(A,ED);if(!cD){A.response.writeln("Cannot complete request. (Wrong redirect address)");return A.response.close();}}if(B["machine"]==null){return A.response.redirect(Uri.parse(H));}else{A.response.writeln("Success.");return A.response.close();}}else{if(!gx(A)){return nx(A,A.response);}switch (X.vI){case 'open':await RK("dgUser",zoneSession);String H=X.CJ;return A.response.redirect(Uri.parse(H));case 'proxy':return JDB(A);case 'openId':return KDB(A);}if(X.MV!=null){var xD=A.requestedUri.resolve("../sso/login");var wD=Uri.parse(X.MV).resolve("/sso/authorize").replace(queryParameters:{"target":xD.toString()});A.response.redirect(wD);return null;}var N=YC.cb;var D=await YC.HFB.readAsString();String Q="4200";if(await N.exists()){Q=(await N.readAsString()).trim();if(Q==null){Q="4200";}}var UB=A.uri.path;if(A.uri.hasQuery){UB+= "?${A.uri.query}";}D=D.replaceAll("{{PASSWORD_ATTRIBUTES}}",t.CT?'autocomplete="new-password"':"").replaceAll("{{DGLUX_REVISION}}",Q).replaceAll("{{TARGET}}",UB);if(invalid!=null){D=D.replaceAll("var invalid = false;","var invalid = true;");if(invalid!=''){D=D.replaceAll("Invalid username and password provided! please try again.",invalid);}}if(t.CT){D=D.replaceAll("var secureMode = false;","var secureMode = true;");}if(oV!=null){var aB=await oV.yXB(D);if(aB!=null){D=aB;}}return new HH(D,ContentType.HTML);}}Future JDB(HttpRequest A)async{var r=X.get("proxy",{});var J=r['address'] as String;if(J!=null&&J.isNotEmpty&&A.connectionInfo.remoteAddress.host!=J){A.response..statusCode=HttpStatus.BAD_GATEWAY..writeln('Invalid gateway. Please connect through proxy server.')..close();return null;}var EB=HD.uF as li;var IB=A.headers.value('x-dg-password');if(!EB.vPB(IB)){A.response..statusCode=HttpStatus.BAD_GATEWAY..writeln('Gateway did not provide the expected shared token.')..close();return null;}var B=A.headers.value('x-logon-user');if(B==null||B.trim().isEmpty){A.response..statusCode=HttpStatus.UNAUTHORIZED..writeln('Unable to receive logon user from proxy. Verify your credentials')..close();return null;}B=B.replaceAll(r'\','_');var O=B;try {B=Uri.decodeComponent(B);}catch (D){U.jB('Failed to decode proxy provided username',D);}var H=await RK(B);var K=new DateTime.now();var Q=new DateTime(K.year,K.month+1,K.day);var S=await t.WB.callMethod("createRememberToken",B);var M=tV(A);A.response..headers.set('X-DG-Session',H.id)..cookies.removeWhere((V)=>V.name=="DGTOKEN"||V.name=="DGUSER")..cookies.add(new Cookie("DGTOKEN",S)..expires=Q..secure=M)..cookies.add(new Cookie("DGUSER",O)..expires=Q..secure=M)..cookies.add(new Cookie("DGSESSION",H.id)..secure=M)..headers.set("X-DG-Token","${O} ${S}");var C=A.uri.queryParameters["target"];if(C==null||C.isEmpty){var I=await uE(A);if(I!=null&&I.metadata!=null&&I.metadata["rootUrl"] is String){C=I.metadata["rootUrl"];}else{C=X.CJ;}}Uri G;try {G=Uri.parse(C);}catch (D){U.QB('Error parsing redirect url: "${C}"',D);G=Uri.parse('/');}var b=await H.AS(AT)??0;await H.QI(AT,b+1);var N=A.headers.value(HttpHeaders.REFERER);try {if(N!=null){var h=Uri.parse(N);var LB=(h.path==G.path&&h.host==G.host);if(LB&&b>=1){zD(A,A.response);return null;}}}catch (D){U.jB('Error parsing referer url: ${N}',D);}return A.response.redirect(G);}Future<Null> KDB(HttpRequest A)async{var D=GH();if(D!=null){var H=await D.AS(AT)??0;if(H>3){zD(A,A.response);return null;}else if(H==1){new Future.delayed(const Duration(seconds:30),(){D.QI(AT,0);});}}fO B=await t.WB.callMethod('getOpenIdConfig');var K=ET(length:8);var I=new HttpClient();I.badCertificateCallback=Rx;var M=new Zc(I);var J=new Vm(B.cU,B.Ef,B.us,secret:B.secret,httpClient:M);var N=A.uri.queryParameters["target"];Uri G=A.requestedUri.resolve(VG.Fx);if(N!=null){G=G.replace(queryParameters:A.uri.queryParameters);}var C=J.R8(G,scopes:B.Ws,state:K);var O=<String,dynamic>{'max_age':'${X.dh*60}'}..addAll(C.queryParameters);C=C.replace(queryParameters:O);A.response.redirect(C,status:HttpStatus.FOUND);J.close();return null;}main(List<String> C)async{ui();var D=(A,G){if(A is OL){A=gO.kBB(A);}if(A is HttpException&&A.toString().contains("Connection closed")){A=null;}if(A is SocketException&&A.toString().contains("Write failed, port = 0")){A=null;}if(A==null){return;}U.BC("An Error Occurred in DSA Server",A,G);Kj=2;if(Db!=null){Db();}};var B=false;var H=new ZoneSpecification(handleUncaughtError:(Zone K,ZoneDelegate M,Zone N,I,StackTrace J){if(!B){B=true;}else{return null;}D(I,J);});return await runZoned(()async{return await Cj(()async{return await nCB(C);});},zoneSpecification:H);}nCB(List<String> B)async{bool O$=await rDB();if(!B.contains("--test")&&!B.contains("--here")&&!(await Fb())){await CDB();}var Jt=new Directory("/data");var Kt=new Directory("/app");if(await Fb()&&await Kt.exists()&&await Jt.exists()){var iS=new Directory("/data/www").absolute;var jS=new Directory("/data/files").absolute;var ih=new Directory("/data/dslinks").absolute;if(!(await iS.exists())){await Vj(new Directory("/app/www"),iS);}if(!(await jS.exists())){await Vj(new Directory("/app/files"),jS);}if(!(await ih.exists())){await Vj(new Directory("/app/dslinks"),ih);}}var XV=false;var Ha=false;var TI=([M])async{if(Ha){return;}if(stdioType(lh.stdin)==StdioType.TERMINAL){print("");}Ha=true;Db=null;if(!XV){new Timer(const Duration(seconds:10),()async{await new Future.delayed(const Duration(seconds:1));try {if(await QK.exists())await QK.delete();}catch (I){}if(JH is SK){await SL((JH as SK).process.pid);}if(SJ is SK){await SL((SJ as SK).process.pid);}await SL(lh.pid,childrenOnly:true);exit(Kj);});XV=true;}if(Mj!=null){try {Mj.cancel();}catch (I){}}try {Ay=true;if(JH!=null){JH.sg();}if(SJ!=null){SJ.sg();}for(var rE in RC.keys.toList()){RC[rE]("stop");}for(var eF in ra){await eF.callMethod("handleShutdown");await eF.stop();}if(RC.isNotEmpty){await new Future.delayed(const Duration(seconds:1));}if(JH!=null){if(JH is SK){SK zG=JH;await SL(zG.process.pid);}JH=null;}if(SJ!=null){if(SJ is SK){SK zG=SJ;await SL(zG.process.pid);}SJ=null;}U.jB("Links Stopped.");if(VB!=null){await VB.stop();U.jB("Stopped Broker Worker.");}if(VQ!=null){await VQ.stop();await new Future.delayed(const Duration(milliseconds:50));U.jB("Server Workers Stopped.");}}catch (I){try {if(await QK.exists())await QK.delete();}catch (I){}exit(1);}await Yx();try {if(await QK.exists())await QK.delete();}catch (I){}exit(Kj);};Db=TI;ProcessSignal.SIGHUP.watch().listen(TI);ProcessSignal.SIGINT.watch().listen(TI);LD A=new LD();X=A;await A.J9();Lj(A.FQ);px=A.GM!=null&&A.GM.contains("Execute");var IL=new File("install.json");bool Ka=true;if(await IL.exists()){Map FC=hE.convert(await IL.readAsString());if(FC["checked"]!=true){List<Map> Ja=FC["links"];var Nt=Ja.map((K)=>K["name"]).toList();A.mN=Nt;await A.xG();FC["checked"]=true;if(FC["ssl"]==false){Ka=false;}await IL.writeAsString(UQ.convert(FC)+"\n");try {for(Map rE in Ja){String D=rE["name"];String jh=rE["revision"];if(jh!=null){var ZO=new File("dslinks/${D}/.rev");await ZO.create(recursive:true);await ZO.writeAsString(jh);}}}catch (I){}}}if(A.XH.isEmpty&&A.bU.isEmpty&&Ka){try {await CEB("certs",A);}catch (I,wD){if(A.FQ.toLowerCase()=='debug'){U.QB("Attempted to generate SSL certificates, but failed.",I,wD);}else{U.QB("Attempted to generate SSL certificates, but failed.",I);A.ff=false;await A.xG();}}}if(await QK.exists()){try {var sE=hE.convert(await QK.readAsString());var ZE={};if(sE is List){for(var K in sE){ZE[K is int?K:int.parse(K.toString())]=K.toString();}}else if(sE is Map){for(var S in sE.keys){ZE[S is int?S:int.parse(S.toString())]=S.toString();}}cM=ZE;}catch (I){}}if(Platform.isLinux||Platform.isMacOS){U.mB("Setting up Server Management Command signal handler.");var HF=new File(".signal");if(!(await HF.exists())){await HF.createSync(recursive:true);}try {HF.watch(events:FileSystemEvent.MODIFY).listen((FileSystemEvent IYB)async{var UB=await HF.readAsString();UB=UB.trim();U.mB("Received Server Management Command: ${UB}");if(UB=="rebind"&&VQ!=null){await VQ.callMethod("rebind");}}).onError((I,wD){U.mB("Error in signal file watcher.",I,wD);});}catch (I,wD){U.mB("Failed to start signal file watcher.",I,wD);}}if(Ij){U.QB("You have debug mode set to on. Performance and resources WILL suffer.");U.QB("To fix this issue, edit the server.json and set the 'debug' setting to false.");}YI H=Ex(A.vI);HD.uF=H;lV HL=jBB(A.xs);if(H==null){exit(1);}var Lt=await NCB();var AH=YC.Qz.absolute;if(!(await AH.exists())){var RO=YC.LFB.absolute;var aO=YC.MFB.absolute;if(await RO.exists()){try {await RO.rename(AH.path);}catch (I){U.BC('Unable to rename dglux5 to dbsb',I);exit(1);}}else if(await aO.exists()){try {await aO.rename(AH.path);}catch (I){U.BC('Unable to rename asb to dbsb',I);exit(1);}}else{U.BC("DG Solution Builder was not found.");exit(1);}}var SO=YC.Rz;var YO=YC.NFB;if(!(await SO.exists())){await SO.create(recursive:true);}if(!(await YO.exists())){await YO.create(recursive:true);}if(A.lg&&A.port>0&&!(await sx(A.port))){U.BC("The configured port for HTTP (${A.port}) is already taken.");exit(1);}if(A.lg&&A.ZH>0&&!(await sx(A.ZH))){U.BC("The configured port for HTTPS (${A.ZH}) is already taken.");exit(1);}await Yx();Aj(lh.pid,"dglux-server");await H.init(A);if(HL!=null){await HL.init(A);}if(A.get("authServer") is Map&&A.get("authServer")["enabled"]==true){var TO=A.XH;var S=A.bU;if(TO==null||TO.isEmpty||S==null||S.isEmpty){U.BC('Authentication server must be run with SSL. ' 'Please provide a certificate name, key and password');exit(1);}var dH=A.get("authServer",{});var eH=dH["host"]??"127.0.0.1";var CC=dH["port"];var N=dH["token"];try {Uri.parse(eH);}catch (I){U.BC('Error parsing authServer host "${eH}".',I);exit(1);}int YE;if(CC is!num){try {YE=int.parse(CC);}catch (I){U.BC('Error parsing authServer port "${CC}".',I);exit(1);}}else{YE=CC.toInt();}if(YE<=0||YE>=65535){U.BC('Invalid authServer port number: "${CC}"');exit(1);}if(CC!=null){if(N==null){U.BC("Authentication Server token not set.");exit(1);}else{HD.Wx=new ki(N,H);try {var Rt=ez(A);await HD.Wx.SUB(eH,YE,Rt);}catch (I){U.BC('Error starting authServer:',I);exit(1);}}}}if(A.get('smtp') is Map){try {t.Hj=new IW(A.get('smtp'));U.jB('SMTP Server has been configured.');}catch (I){U.BC('Failed to setup SMTP server',I);}}await UCB();VB=A.nZ?J1(Qx):kl(Qx);VB.u("getServerConfig",(M)=>A);VB.u("getProductId",(M)=>t.xa);VB.u("restartLink",(D)async{if(RC.containsKey(D)){await RC[D]("restart");}});VB.u('getOpenIdConfig',(M){if(HD.uF is VG){return (HD.uF as VG).Vg;}return null;});VB.u("insertUser",(g G)async{if(G==null||HD.uF is!VG){return null;}return (HD.uF as VG).q8(G);});VB.u('clearUser',(String G){if(G==null||G.isEmpty||HD.uF is!VG){return null;}return (HD.uF as VG).Z7(G);});yD.qV=await ET(length:80);VB.u("getVerificationUserToken",(M)async{return yD.qV;});VB.u("setLinkConfig",(List B)async{String XO=B[0];String D=B[1];dynamic dF=B[2];if(RC.containsKey(XO)){await RC[XO]("setLinkConfig",[D,dF]);}});VB.u("updateUpstreamNodes",(ZE)async{A.cF=ZE;await A.xG();});VB.u("getCurrentBuild",(M)async=>await yi());VB.u("updateServer",(M)async{var Q=await rCB();return [Q.aD,Q.message];});VB.u("updateServerFromFile",(ByteData h)async{var Q=await yCB(h);return [Q.aD,Q.message];});VB.u("exportDGLuxServer",(Map<String,dynamic> V)async{var Q=await SDB(includeBrokerStorage:V["includeBrokerStorage"]!=false,includeLinks:V["includeLinks"]!=false,includeKeys:V["includeKeys"]!=false,includeWebAssets:V["includeWebAssets"]!=false,includeConfiguration:V["includeConfiguration"]!=false,includeServerBuild:V["includeServerBuild"]!=false,includeLogs:V["includeLogs"]!=false,includeDataNodes:V["includeDataNodes"]!=false,includeAttributes:V["includeAttributes"]!=false,includeServerConfiguration:V["includeServerConfiguration"]!=false,includeProjects:V["includeProjects"]!=false);return Q;});VB.u("downloadLink",(String D)async{var Q=await MDB(D);return Q;});VB.u("getUser",(String VVB)async{return await H.sG(VVB);});VB.u("scanForLinks",(M)async{await rV(skipDuplicates:true);});VB.u("createUser",(List<dynamic> B)async{var O=B[0];var Mt=B[1];var Vt=B[2];var IB=B[3];var G=new g(O,Mt,Vt);await H.BI(G,IB);});VB.u("getLoginAttempts",(String G){return H.BV[G]??0;});VB.u("setLoginAttempts",(List<dynamic> B){var G=B[0] as String;var JL=B[1] as int;H.BV[G]=JL;});VB.u("clearLoginAttempts",(String G){H.BV.remove(G);});VB.u("authenticate",(List<dynamic> B)async{var O=B[0];var IB=B[1];var Qt=await H.authenticate(O,IB);return Qt;});VB.u("editUser",(g G)async{if(H is aE){await (H as aE).hP(G);}if(t.iH!=null){for(iE J in t.iH){if(J.username==G.username){J.rJ=null;}}}});VB.u("renameUser",(List<String> b)async{if(H is ni){await (H as ni).FUB(b[0],b[1]);}});var VO=(List<String> B)async{String O=B[0];String IB=B[1];if(H is aE){await (H as aE).tR(O,IB);}else{throw new fF("Password is not changeable.");}};var Tt=(List<String> B)async{String O=B[0];if(H is aE){await (H as aE).mY(O);}else{throw new fF("Password is not changeable.");}};VB.u("changePassword",VO);VB.u("forcePasswordChange",Tt);VB.u("removeUser",(String O)async{await H.wG(O);t.iH.removeWhere((J){return J.username==O;});});VB.u("createResetToken",(String O)async{var N=ET(length:25);KK.yw(N,O);return N;});VB.u("getResetToken",(String N)async=>KK.Ax(N));VB.u("removeResetToken",(String N)async{KK.Bx(N);});VB.u("getMailer",(M)async=>t.Hj);VB.u("startLink",(D)async{if(RC.containsKey(D)){await RC[D]("start");}});VB.u("updateDartVmViaBytes",(ByteData h)async{await bCB(h);return "Success.";});VB.u("updateDartVmViaUrl",(String It)async{await jCB(It);return "Success.";});VB.u("enableLink",(D)async{if(RC.containsKey(D)){await RC[D]("enable");}});VB.u("disableLink",(D)async{if(RC.containsKey(D)){await RC[D]("stop");await RC[D]("disable");}});VB.u("stopLink",(D)async{if(RC.containsKey(D)){await RC[D]("stop");}});VB.u("uninstallLink",(D)async{if(RC.containsKey(D)){await RC[D]("uninstall");}});VB.u("updateLinkGit",(D)async{if(RC.containsKey(D)){return await RC[D]("update-git");}else{return "Link not found.";}});VB.u("updateLinkRepository",(D)async{if(RC.containsKey(D)){return await RC[D]("update-repo");}else{return "Link not found.";}});VB.u("restart",(M)async{await SL(lh.pid);exit(0);});VB.u("updateLinkZip",(List<String> B)async{try {var D=B[0];var WVB=B[1];if(!RC.containsKey(D)){return "Link not found";}var KL=await RC[D]("getLinkDirectory");var CH=await RC[D]("getLinkJson");return await zx(KL,WVB,CH);}catch (I){return "Error: ${I.toString()}";}});VB.u("updateLinkFile",(List<dynamic> B)async{if(B.length!=3){return "Error: missing arguments. Expected 3, got ${B.length}";}var D=B[0];ByteData h=B[1];String Ot=B[2];if(!RC.containsKey(D)){return "Link not found";}bool bO=Ot!="stopped";try {var KL=await RC[D]("getLinkDirectory");var CH=await RC[D]("getLinkJson");if(bO)await RC[D]("stop");var WO=await OEB(KL,h,CH);await RC[D]("updateInfo");if(bO&&!WO.startsWith('Error')){await RC[D]("start");}return WO;}catch (I){return "Error: ${I.toString()}";}});VB.u("installLinkFromGit",(List<String> B)async{var Q=await fCB(B[0],B[1]);return [Q.aD,Q.message];});VB.u("installLinkFromZip",(List<String> B)async{var Q=await lCB(B[0],B[1]);return [Q.aD,Q.message];});VB.u("installLinkFromFile",(List<dynamic> B)async{var Q=await qCB(B[1],B[0]);return [Q.aD,Q.message];});var qB=new Completer();VB.u("ready",(M)=>qB.complete());VB.init();await qB.future;yD.ua=await VB.callMethod("getBrokerPort");vM C;if(A.LQ<2){C=QCB(A.LQ<=0?1:A.LQ,zi,metadata:{"logLevel":A.FQ});}else{C=dHB(A.LQ,zi,metadata:{"logLevel":A.FQ});if(A.LQ>Platform.numberOfProcessors){U.QB("Running with more workers than number of processors.");}}VQ=C;if(A.GM!=null&&A.GM.contains("Main Worker")){C.XZ=(int aB,Xt){FH("Main Worker","Received Message from Worker #${aB}: ${Xt}");};}var Wt=(LD EB)async{if(EB==null){return;}A=EB;X=EB;await C.callMethod("setServerConfig",A);await VB.callMethod("setServerConfig",A);};VB.u("setServerConfig",Wt);C.u("getUsers",(M)async{return H.KI();});C.u("getHttpAuthenticationAdapter",(M){if(H is Dx){return (H as Dx).tXB;}else{return null;}});C.u("getSessionAttribute",(List B){String SI=B[0];String S=B[1];iE J=t.iH.firstWhere((K)=>K.id==SI,orElse:()=>null);if(J!=null){return J.ycB[S];}});C.u("setSessionAttribute",(List B){String SI=B[0];String S=B[1];dynamic dF=B[2];iE J=t.iH.firstWhere((K)=>K.id==SI,orElse:()=>null);if(J!=null){if(dF==null){J.ycB.remove(S);}else{J.ycB[S]=dF;}}});C.u("changePassword",VO);var UO=(int Zt)async{await C.KUB(Zt,zi);};C.u("resizeServerWorkers",UO);VB.u("resizeServerWorkers",UO);VB.u("rebindServerWorkers",(M)async{await C.callMethod("rebind");});C.u("triggerRequestCounter",(M)async{await VB.callMethod("triggerRequestCounter");});C.u("getVerificationUserToken",(M)async{return yD.qV;});C.u("hasPlugins",(M)=>ra.isNotEmpty);C.u("plugin",(kS)async{var bt=kS[0];var h=kS[1];var xD=[] ;for(var eF in ra){var Q=await eF.callMethod(bt,h);if(Q!=null){xD.add(Q);}}return xD;});C.u("getUser",(String O)async{if(O==null||O.isEmpty)return null;var G=await HD.uF.sG(O);return G;});C.u("insertUser",(g G)async{if(G==null||HD.uF is!VG){return null;}return (HD.uF as VG).q8(G);});C.u("clearUser",(String G)async{if(G==null||G.isEmpty||HD.uF is!VG){return null;}return (HD.uF as VG).Z7(G);});C.u("updateLicenseData",(String h)async{return await VB.callMethod("updateLicenseData",h);});C.u("createUser",(List<dynamic> K)async{g r=K[0];String IB=K[1];await H.BI(r,IB);return await H.KI();});C.u("removeUser",(String O)async{await H.wG(O);return await H.KI();});C.u("invalidateUserCache",(String O)async{t.iH.where((K)=>K.username==O).forEach((K){K.rJ=null;});});C.u("getLoginAttempts",(String G){return H.BV[G]??0;});C.u("setLoginAttempts",(List<dynamic> B){var G=B[0] as String;var JL=B[1] as int;H.BV[G]=JL;});C.u("clearLoginAttempts",(String G){H.BV.remove(G);});C.u("authenticate",(List<String> b)async{String G=b[0];String kh=b[1];if(G==null||kh==null){return false;}return await H.authenticate(G,kh);});C.u("editUser",(g G)async{if(H is aE){await (H as aE).hP(G);}if(t.iH!=null){for(iE J in t.iH){if(J.username==G.username){J.rJ=null;}}}});C.u("createResetToken",(String O)async{var N=ET(length:25);KK.yw(N,O);return N;});C.u("getResetToken",(String N)async=>KK.Ax(N));C.u("removeResetToken",(String N)async{KK.Bx(N);});C.u("getMailer",(M)async=>t.Hj);C.u("getServerConfig",(M){return A;});C.u("getTwoFactorAuth",(M)=>HL);C.u("getProductId",(M){return Lt;});C.u("isInSecureMode",(M)=>O$);C.u("getHttpsPort",(M)=>X.ZH);C.u("getBrokerPort",(M)=>yD.ua);C.u("getOpenIdConfig",(M){if(HD.uF is VG){return (HD.uF as VG).Vg;}return null;});C.u("createSession",(M)async{var cD=await iDB(length:50);var ED=new iE();ED.id=cD;var EB=new DateTime.now();ED.lastSeen=EB;ED.Rq=EB;t.iH.add(ED);return ED;});C.u("getSession",(cD){var J=t.iH.firstWhere((fC)=>fC.id==cD,orElse:()=>null);if(J!=null){J.lastSeen=new DateTime.now();}return J;});C.u("invalidateSession",(cD){t.iH.removeWhere((fC)=>fC.id==cD);if(X.vI=='ldap'){var St=H as gO;St.ZQB();}});C.u("updateSession",(Ma)async{var J=t.iH.firstWhere((fC)=>fC.id==Ma[0],orElse:()=>null);if(J==null){return null;}J.lastSeen=new DateTime.now();J.username=Ma[1];if(J.username!=null){J.rJ=await H.sG(J.username);}return J;});C.u("createCsrfToken",(List<String> b){List<int> UM=ZM.convert(MW().oZ());PJ BH=new PJ(da,UM);var EK=BH.convert(ZM.convert(b.join()));return na(EK.eC);});C.u("verifyCsrfToken",(List<String> b){final String N=b.first;final List<int> UM=ZM.convert(MW().oZ());final PJ BH=new PJ(da,UM);final EK=BH.convert(ZM.convert(b.sublist(1).join()));final UI=na(EK.eC);{bool yG=true;final Ut=LJ.min(N.length,UI.length);for(var aB=0;aB<Ut;aB++ ){if(N[aB]!=UI[aB]){yG=false;}}if(N.length!=UI.length){yG=false;}return yG;}});File rC=new File("login_tokens.json");if(!(await rC.exists())){await rC.create(recursive:true);await rC.writeAsString("{}");}Map<String,List<String>> LB={};LB=hE.convert(await rC.readAsString());Ia()async{await rC.writeAsString(UQ.convert(LB)+"\n");}C.u("createRememberToken",(String G)async{var N=await Tj(length:80);var K=LB[G];if(K==null)K=[] ;K.add(N);LB[G]=K;await Ia();return N;});C.u("checkRememberToken",(List<String> B){var r=LB[B[0]];if(r==null){return false;}return r.contains(B[1]);});C.u("removeRememberToken",(List<String> B)async{var r=LB[B[0]];if(r==null||!r.contains(B[1])){return false;}r.remove(B[1]);await Ia();return true;});await dz(X,true);await C.gh();var La=()async{try {List<g> Pt=await H.KI();await VB.callMethod("syncUsers",Pt);}catch (I){}};if(H is LK){(H as LK).YU(La);}La();if(A.port>0){U.jB("DSA Server Started on port ${A.port}");}if(A.XH!=null&&A.XH!=""&&A.ZH>0){U.jB("Secure DSA Server Started on port ${A.ZH}");}var DK=0;Yt()async{DK++ ;var EB=new DateTime.now();var VI=A.dh*60000;if(VI>21600000){VI=14400000;}var XVB=(iE K)=>(EB.millisecondsSinceEpoch-K.lastSeen.millisecondsSinceEpoch)>=VI;t.iH.removeWhere(XVB);if(DK>=360){DK=0;t.iH.forEach((K){K.rJ=null;});}if(qa){qa=false;var xD={};for(var S in cM.keys){xD[S.toString()]=cM[S];}var YVB=QL.convert(xD);if(!(await QK.exists())){await QK.create(recursive:true);}await QK.writeAsString(YVB);}}lS()=>Mj=new Timer(const Duration(seconds:5),()async{await Yt();lS();});lS();if(X!=null&&!X.zf){try {uV=await Bb();}catch (I){}}else{uV=[] ;await new Future.delayed(const Duration(seconds:1));}await rV();if(Vx){await new Future.delayed(const Duration(seconds:1));}By=(ct,UB)async{try {var D=e2(ct).last;if(RC.containsKey(D)){await RC[D](UB);}}catch (I){}};while(Nj.isNotEmpty){Function dt=Nj.removeAt(0);var qB=new Completer();dt((){if(!qB.isCompleted){qB.complete();}});await qB.future;if(Vx){await new Future.delayed(const Duration(milliseconds:250));}}U.jB("All links have been started.");await KCB("ready",const[] );}Future PCB(HttpRequest A,{iE zoneSession})async{if(X.vI!='openId'){return await RJ(A,A.response);}fO B=await t.WB.callMethod('getOpenIdConfig');var Q=new HttpClient();Q.badCertificateCallback=Rx;var h=new Zc(Q);var S=new Vm(B.cU,B.Ef,B.us,secret:B.secret,httpClient:h);var N=A.requestedUri.resolve(VG.Fx);if(A.requestedUri.queryParameters.containsKey('target')){N=N.replace(queryParameters:{'target':A.requestedUri.queryParameters['target']});}Map C;hT D;try {S.R8(N,scopes:B.Ws);D=await S.lRB(A.uri.queryParameters);var K=await D.get(B.Pr);if(K.statusCode!=HttpStatus.OK){throw new StateError('userinfo endpoint returned status: '+'${K.statusCode} - ${K.reasonPhrase}');}C=hE.convert(K.TD);}catch (r){U.QB('OpenID: Failed to authorize user.',r);return await zD(A,A.response);}if(D.credentials.idToken.jN.issuer!=B.z8){U.QB('OpenID: Claim issuer did not match Issuer endpoint.');return await zD(A,A.response);}if(!D.credentials.idToken.jN.audience.contains(B.cU)){U.QB('OpenID: Claim audience does not match client id');return await zD(A,A.response);}if(D.credentials.idToken.jN.authorizedParty!=null&&D.credentials.idToken.jN.authorizedParty!=B.cU){U.QB('OpenID: Claim authorized party does not match client id.');return await zD(A,A.response);}if(C['sub']!=D.credentials.idToken.jN.subject){U.QB('OpenID: user info subect did not match claimset subject');return await zD(A,A.response);}C['access_token']=D.credentials.IY;C['token']=D.credentials.idToken.token;var V=D.credentials.idToken.jN.sessionState;if(V!=null){C['session_state']=V;}var EB=il.toList()..add('|');String G;if(B.eh!=null&&B.eh.isNotEmpty){G=C[B.eh];}G??= C['preferred_username'];G??= C['sub'];for(var IB in EB){G=G.replaceAll(IB,"_");}List<String> H;var M=C['groups'];if(M is String){H=M.split(',');C['groups']=H;}else if(M is List){H=M;}else{C.remove('groups');}if(H!=null&&H.isNotEmpty){if(B.Bh!=null&&B.Bh.isNotEmpty&&H.contains(B.Bh)){C['superuser']=true;}}Set<String> J=new Set<String>();if(B.realmRoles!=null&&B.realmRoles.isNotEmpty){J.addAll(bx(B.realmRoles,D.credentials.idToken.jN.other));}if(B.clientRoles!=null&&B.clientRoles.isNotEmpty){J.addAll(bx(B.clientRoles,D.credentials.idToken.jN.other));}if(J.isNotEmpty){if(C['groups']==null){C['groups']=new List.from(J);}else{(C['groups'] as List).addAll(J);}}var I=await RK(G,zoneSession);I.QI('openId',C);var LB=await I.AS(AT)??0;await I.QI(AT,LB+1);var b=I.rJ=new g(G,C['superuser']??false,C['email'],C);await t.WB.callMethod('insertUser',b);await RK(b.username,I);var UB=tV(A);var aB=new Cookie('DGSESSION',I.id)..path=sV.wa.path..secure=UB;A.response.cookies.add(aB);var O=A.requestedUri.queryParameters["target"];if(O!=null&&Qj(A,O)){return A.response.redirect(Uri.parse(O));}return A.response.redirect(A.requestedUri.resolve('../../'));}List<String> bx(String C,Map<String,dynamic> A){List<String> D=<String>[] ;if(C==null||C.isEmpty)return D;var G=C.split('.');for(var B=0;B<G.length;B++ ){var H=G[B];if(A.containsKey(H)){if(B==G.length-1){D.addAll(A[H]);}else{A=A[H];}}}return D;}Future EDB(HttpRequest B,g H)async{if(X.vI!='openId'){RJ(B,B.response);return null;}var D=H.metadata['session_state'];if(D==null){U.jB('Session Check: User has no session_state, unable to setup session monitoring');RJ(B,B.response);return null;}var G=await Future.wait([t.WB.callMethod('getOpenIdConfig'),YC.db.exists()]);var C=G[0] as fO;var I=G[1] as bool;if(C?.XY==null||I!=true){RJ(B,B.response);return null;}var A=await YC.db.readAsString();A=A.replaceAll(r'{{ID}}',C.cU);A=A.replaceAll(r'{{SS}}',D);A=A.replaceAll(r'{{TO}}',C.XY.origin);return new HH(A,ContentType.HTML);}bool qa=false;Aj(int A,[String B]){if(B==null){B="${A}";}if(!cM.containsKey(A)){cM[A]=B;qa=true;if(B!=A.toString()){U.mB("Registered PID ${A} (${B})");}else{U.mB("Registered PID ${A}");}}}Xx(int A){if(cM.containsKey(A)){cM.remove(A);qa=true;U.mB("Unregistered PID ${A}");}}Map<int,String> cM={};Yx()async{int B=10;if(RC!=null){B+= RC.length;}List<int> A=cM.keys.toList();A.sort((D,G)=>G.compareTo(D));if(A.length>B){A=A.take(B).toList();}if(A.isNotEmpty){U.mB("Cleaning up processes: ${A}");}for(var C in A){if(C==lh.pid){continue;}try {await SL(C);}catch (H){}}cM.clear();A.clear();}File QK=new File(".pids");List<gC> ra=[] ;UCB()async{var C=new Directory("plugins");if(!(await C.exists())){return;}await for(FileSystemEntity A in await C.list()){if(A is!File)continue;if(!A.path.endsWith(".dart"))continue;A=A.absolute;var B=cHB(A.uri);var D=new Completer.sync();B.u("init",(G)async{B.callMethod("ready").then((G){D.complete();});});B.u("listUsers",(G)async{var J=await HD.uF.KI();return J.map((K)=>K.Ih()).toList();});B.u("getUser",(String H)async{if(H==null){return null;}var I=await HD.uF.sG(H);return I==null?null:I;});ra.add(B);await D.future;}}NCB()async{File A;if(await Fb()||Platform.isAndroid){A=new File(".product_id");}else{var B=Platform.environment[Platform.isWindows?"APPDATA":"HOME"];if(B==null){if(Platform.isWindows){B=Platform.environment["USERPROFILE"];}else if(Platform.isMacOS){B="/Users/${Platform.environment["USER"]}";}else{var D=Platform.environment["USER"];if(D=="root"||D==null){B="/root";}else{B="/home/${D}";}}}A=new File(p(B,".dglogik","dgluxserver","product_id"));}String C;try {await A.exists();}catch (G){A=new File(".product_id");}if(await A.exists()){C=(await A.readAsString()).trim();}else{C=await Tj(length:64);await A.create(recursive:true);await A.writeAsString(C);}t.xa=C;return C;}vi(HttpRequest A,[String IB])async{var C=A.uri.queryParameters["op"];var B=await uE(A);if(IB!=null){C=IB;}if(C=="listProj"){var dF=p("files","proj");var rE=new Directory(dF);var rC=[] ;var YE=await rE.list().toList();for(var D in YE){if(D is Directory){var h=new File(p(D.path,"_proj.json"));if(!(await h.exists())){continue;}try {Map J=hE.convert(await h.readAsString());var ZE=J["owner"];var O=J["canRead"];var N=J["canWrite"];if(B.pD||ZE==B.username||O.contains("all")||O.contains(B.username)||B.Nf(O)||N.contains("all")||N.contains(B.username)||B.Nf(N)){J["id"]=hG(D.path);rC.add(J);}}catch (wD,xD){U.QB("Failed to parse project file ${h.path}",wD,xD);}}}return rC;}else if(C=="createProj"){if(!(await MK(A))){A.response.statusCode=HttpStatus.UNAUTHORIZED;return "Access Denied";}var UB=A.uri.queryParameters["name"];var cD=A.uri.queryParameters["template"];var eF=p("files","proj",cD);var I=UB;var M=new Directory(p("files","proj",I));if(await M.exists()){I+= "_"+await ET(length:5);M=new Directory(p("files","proj",I));}var r=new Directory(eF);aC aB=await aC.bM('proj/${I}');await for(var D in r.list(recursive:true).where((D)=>D is File)){var qB=new File(D.path.replaceAll(r.path,M.path));await qB.create(recursive:true);await D.copy(qB.path);}var K={"owner":(await uE(A)).username,"name":UB,"isTemplate":false,"canRead":[] ,"canWrite":[] };var b=hE.convert(await new File(p(r.path,"_proj.json")).readAsString());if(b is Map&&b.containsKey('category')){K['category']=b['category'];}await new File(p(M.path,"_proj.json")).writeAsString(QL.convert(K));K["id"]=I;if(aB!=null){aB.zL(aC.PK(A,B));}return K;}else if(C=="readProj"){var fC=A.uri.queryParameters["id"];var H=p("files","proj",fC,"_proj.json");String ED=await nV(B,"proj/${fC}/_proj.json");if(ED==null){await zD(A,A.response);return null;}return new File(H);}else if(C=="updateProj"){var S=await zM.AN(A);var Q=S.TD;var G=A.uri.queryParameters["id"];var H=p("proj",G,"_proj.json");var EB=new File(p("files",H));if(await nV(B,H)!='write'){await zD(A,A.response);return null;}var LB=hE.convert(await EB.readAsString());var sE=hE.convert(Q);var CC=await uE(A);if(sE["owner"]!=LB["owner"]){if(!CC.pD&&CC.username!=LB["owner"]){A.response.statusCode=HttpStatus.UNAUTHORIZED;return "You are not allowed to change the owner of this project.";}}await EB.writeAsString(Q);return Q;}else if(C=="deleteProj"){var G=A.uri.queryParameters["id"];var H=p("proj",G,"_proj.json");if(await nV(B,H)!='write'){await zD(A,A.response);return null;}var HF=p("files","proj",G);await new Directory(HF).delete(recursive:true);return "";}else if(C=="exportProj"){var G=A.uri.queryParameters["id"];var V=new Set<String>();V.add(G);await cx(G,V);var FC=await FDB(V);({"Content-Type":"application/zip","Content-Disposition":"attachment; filename=${G}.zip","Content-Transfer-Encoding":"binary","Cache-Control":"no-cache, no-store, must-revalidate","Pragma":"no-cache","Expires":"0","Content-Length":FC.length}).forEach(A.response.headers.set);A.response.add(FC);A.response.close();return null;}else if(C=="importProj"){A.response.deadline=const Duration(hours:1);var S=await zM.AN(A);await IDB(S.TD,request:A);if(A.response.statusCode==HttpStatus.OK){return vi(A,"listProj");}return null;}return "";}Future cx(String D,Set<String> A)async{var B=new Directory(p("files","proj",D,"lib"));if(!(await B.exists())){return;}await for(Directory G in B.list().where((H)=>H is Directory)){var C=hG(G.path);var I=A.add(C);if(I){await cx(C,A);}}}Future<List<int>> FDB(Set<String> H)async{var I=new Directory("files/proj");var C=new WM();for(var J in H){var G=new Directory("files/proj/${J}");if(!(await G.exists())){continue;}await for(FileSystemEntity A in G.list(recursive:true)){var B=cm(A.path,from:I.path);if(Platform.isWindows){B=B.replaceAll("\\","/");}if(B.contains('/.')){continue;}if(A is File){var K=(await A.stat()).size;var M=await A.readAsBytes();var D=new qD(B,K,M);C.LY(D);}else if(A is Directory){if(await A.list().isEmpty){var D=new qD(B+"/.DGSERVER_KEEP_DIRECTORY",0,[] );C.LY(D);}}}}return new oh().encode(C);}IDB(List<int> N,{HttpRequest request,String owner})async{var C=new ht().j7(N);if(C.F8("_proj.json")!=null){var B=C.F8("_proj.json");B.fY();var O=hE.convert(RL.convert(B.JG));var Q=O["id"];C.MG.forEach((A){A.name="${Q}/${A.name}";});}Set<String> M=C.MG.map((H)=>H.name.split("/").first).toSet();U.jB("Importing Projects ${M}");for(var D in M){var S=C.MG.where((H)=>H.name.startsWith("${D}/")).toList();for(var A in S){if(!A.name.endsWith("/")){A.fY();var I=new File("files/proj/${A.name}");if(!(await I.exists())){await I.create(recursive:true);}await I.writeAsBytes(A.JG);}else{var G=new Directory("files/proj/${A.name}");if(!(await G.exists())){await G.create(recursive:true);}}}var J=new File("files/proj/${D}/_proj.json");if(!(await J.exists())){U.QB("Skipping Import of ${D}: failed to find project file.");try {var G=new Directory("files/proj/${D}");await G.delete(recursive:true);}catch (V){}continue;}Map B=hE.convert(await J.readAsString());var K=B["owner"];if(request!=null){K=(await uE(request)).username;}else if(owner!=null){K=owner;}B["owner"]=K;B["canWrite"]=[] ;await J.writeAsString(UQ.convert(B));U.jB("Project ${D} Imported.");}}bool Sx=false;UBB oV;XCB(HttpRequest A)async{A.response.bufferOutput=false;A.response.deadline=const Duration(seconds:30);try {return await hCB(A);}catch (B,C){U.QB("Request Error for ${A.method} ${A.uri}",B,C);try {A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;await A.response.close();}catch (B){U.QB('Error closing request',B);}}}bool tV(HttpRequest B){var A=B.requestedUri.scheme;return A=='wss'||A=='https';}hCB(HttpRequest A)async{var RO=X.fq||t.CT;var It=A.headers.value("Host")!=null&&((!A.requestedUri.hasScheme&&!A.requestedUri.hasPort)||(A.requestedUri.hasScheme&&A.requestedUri.scheme!="https"&&A.requestedUri.scheme!="wss")||(A.requestedUri.hasPort&&A.requestedUri.port!=t.Gj));if(RO&&It){try {NDB(A);}catch (G){fB.QB('Silenced exception: \n ${G}');}try {A.response.close();}catch (G){fB.QB('Silenced exception: \n ${G}');}return;}Stopwatch dH;if(X.os==true){dH=new Stopwatch();dH.start();}t.WB.callMethod("triggerRequestCounter");FH("Request Handler","(Worker #${Jj}) ${A.method} ${A.uri}");A.response.headers.removeAll("x-frame-options");A.response.headers.removeAll("x-content-type-options");A.response.headers.removeAll("x-xss-protection");if(RO){A.response.headers.set("Strict-Transport-Security","max-age=31536000; includeSubDomains");}if(t.CT){A.response.headers.set("X-Frame-Options","DENY");}if(!X.vY){if(X.Bg){A.response.headers.set("Access-Control-Allow-Origin","*");}else{var O=A.headers['origin']?.first;if(O!=null&&X.nR.hasMatch(O)){var Lt=X.nR.firstMatch(O)[0];A.response.headers.set("Access-Control-Allow-Origin",Lt);}}}var eH=A.headers["X-Copy-Headers"];if(eH!=null&&eH.isNotEmpty){for(var b in eH){var Ia=A.headers.value(b);if(Ia!=null){A.response.headers.set(b,Ia);}}}if(!X.vY){A.response.headers.set("Access-Control-Allow-Credentials","true");var Ja=A.headers.value("Access-Control-Request-Headers");var VO=A.headers.value("Access-Control-Request-Method");if(Ja!=null){A.response.headers.set("Access-Control-Allow-Headers",Ja);}else{A.response.headers.set("Access-Control-Allow-Headers","X-DG-Token, X-DG-Session, X-DG-CSRF-TOKEN, X-DG-CSRF-TIMESTAMP, Authorization");}if(VO!=null){A.response.headers.set("Access-Control-Allow-Method",VO);}A.response.headers.set("Access-Control-Expose-Headers","X-DG-Token, X-DG-Session, X-DG-User, X-DG-CSRF-TOKEN, X-DG-CSRF-TIMESTAMP");}var SI=tV(A);if(A.method=="OPTIONS"){await A.response.close();return;}var B=A.uri.path;if(B.startsWith("..")||B.contains("/../")){U.QB("A HTTP Client from ${A.connectionInfo.remoteAddress.address}" " attempted to access a malicious path (${B})");A.response..statusCode=HttpStatus.NOT_FOUND..writeln("404 - Not Found (Malicious Intent Detected)")..close();return;}B=b2.wJ(B);if(B=="/ping"){dD(A,"Pong.");return;}var AH=A.cookies.where((Kt)=>Kt.name=="DGSESSION");var h=AH.isNotEmpty?AH.first:null;h=await ODB(AH,h);bool Mt(String XO)=>A.headers[XO]!=null&&A.headers[XO].isNotEmpty;if(h==null&&Mt('X-DG-Session')){h=new Cookie("DGSESSION",A.headers.value("X-DG-Session"))..secure=SI;}iE I;String rE=A.headers.value("X-DG-Token");if(rE==null){rE=A.uri.hasQuery?A.uri.queryParameters["token"]:null;}if(h!=null){I=await t.WB.callMethod("getSession",h.value);}if(I==null){I=await PDB(A);if(I!=null){h=new Cookie("DGSESSION",I.id)..secure=SI;A.response.cookies.add(h);}}if(rE!=null){var K=rE.split(" ");var cD=K.removeLast();var HL=Uri.decodeComponent(K.join(" "));var Ot=await t.WB.callMethod("checkRememberToken",[HL,cD]);if(Ot){I=await RK(HL,I);}if(I!=null){A.response.headers.set("X-DG-Session",I.id);A.response.headers.set("X-DG-User",Uri.encodeComponent(I.username));}}await runZoned(()async{var I=Zone.current['session'];var D=GH();if(I!=null){await aCB(I.username,A.connectionInfo.remoteAddress);if(I.username!=D.username){D=await RK(D.username,D);}}if(Sx&&B!="/session"){List<Map> Pt=await t.WB.callMethod("plugin",["handleHttpRequest",[dM.ix(A.headers),dM.ix(A.response.headers),A.requestedUri.toString(),D.username,A.method]]);for(var ED in Pt){try {Map Ka=ED[0];bool Qt=ED[1];var xD=ED[2];var Rt=ED[3];for(var b in Ka.keys){A.response.headers.set(b,Ka[b]);}if(Qt){A.response.statusCode=Rt;dD(A,xD);return null;}}catch (G){}}}var M=await uE(A,D);if(M!=null&&M.metadata!=null){if(M.metadata.containsKey("allowHttpAccess")&&!(B=="/dglicense.json"||B=="/session"||B=="/dgconfig.json"||B=="/viewer.dart.js"||B.startsWith("/js/")||B.startsWith("/themes/")||B.startsWith("/lang/")||B.startsWith("/css_tree/")||B.startsWith("/assets/")||B.startsWith("/packages/")||B=="/eula.html"||B=="/favicon.ico"||B.startsWith("/images/")||B=="/ws"||B=="/conn"||B.startsWith("/dglux.patch.js")||B.startsWith("/dglux.css")||B.startsWith("/file/")||B=="/file")){if(M.metadata["allowHttpAccess"] is List){List fC=M.metadata["allowHttpAccess"];RegExp qB=new RegExp(fC.join("|"));if(!fC.contains(B)&&!qB.hasMatch(B)&&!qB.hasMatch(A.uri.toString())){await zD(A,A.response);return null;}}}if(M.metadata["denyHttpAccess"] is List){List fC=M.metadata["denyHttpAccess"];RegExp qB=new RegExp(fC.join("|"));if(fC.contains(B)||qB.hasMatch(B)||qB.hasMatch(A.uri.toString())){await zD(A,A.response);return null;}}if(M.metadata["ipWhitelist"] is List){bool aO=false;for(var N in M.metadata["ipWhitelist"]){if(N is!String)continue;if(EEB(A.connectionInfo.remoteAddress,FEB(N))){aO=true;break;}}if(!aO){var St=A.connectionInfo.remoteAddress;var H=M.username;U.QB("Machine at ${St.address} was blocked from logging in as the user ${H}");await t.WB.callMethod("invalidateSession",D.id);if(A.cookies.any((C)=>C.name=="DGTOKEN")){await t.WB.callMethod("removeRememberToken",[D.username,A.cookies.firstWhere((C)=>C.name=="DGTOKEN").value]);}A.response.statusCode=HttpStatus.SERVICE_UNAVAILABLE;dD(A,"This user is not allowed to login on this machine.");return null;}}}String BH=A.headers.value("X-Reveal");if(BH==null){BH="";}for(String b in BH.split(",").map((N)=>N.trim())){if(b=="user"){A.response.headers.set("X-User",M.username);}else if(b=="permission"){var ZE=M.metadata["groups"];var S=":user";if(ZE is String){S=ZE;}else if(ZE is List){S=ZE.map((N)=>N.toString()).join(",");}A.response.headers.set("X-Permission-Group",S);}}if(oV!=null){var xD=await oV.sXB(A);if(xD!=null&&xD==true){return null;}}g H=await uE(A,D);if(H!=null&&H.metadata["forcePasswordChange"]==true){if(!(const["/change_password","/favicon.ico","/logout","/login"].contains(B)||B.startsWith("/images/")||B.startsWith("/assets/"))){A.response.redirect(Uri.parse("/change_password#password_change_required"));A.response.close();return null;}}bool XV(){if(X.aZ>0&&H.username!='guest'){String YE;if(H.metadata['lastPasswordChange'] is String){DateTime Tt=DateTime.parse(H.metadata['lastPasswordChange']);if(new DateTime.now().millisecondsSinceEpoch-Tt.millisecondsSinceEpoch>X.aZ*24*3600000){YE='password_expired';}}else{YE='password_change_required';}if(YE!=null){A.response.redirect(Uri.parse("/change_password#${YE}"));A.response.close();return true;}}return false;}try {var Ut=si.xBB;if((B=='/'||B.endsWith('.html'))&&XV()){return null;}if(B=="/login"){dD(A,ta(A,zoneSession:D));}else if(B=="/change_password"&&X.vp==true){dD(A,RCB(A));}else if(B=='/forgot_password'){dD(A,xCB(A));}else if(B=="/"){dD(A,MCB(A,D));}else if(B=="/index.html"){if(!(await MK(A,useRootRedirect:true)))return null;if(H.metadata!=null&&H.metadata["allowDesigner"]==false){Uri r;if(H.metadata["rootUrl"]!=null){r=Uri.parse(H.metadata["rootUrl"]);A.response.redirect(r);}else{await zD(A,A.response);return null;}}else{dD(A,Eb(A,YC.Pz));}}else if(B=="/update.html"){if(!(await MK(A)))return null;if(!H.pD){return "You do not have permission to do that.";}dD(A,Px(A,true));}else if(B=="/logout"){var yG=sV.wa;if(X.vI=="openId"){fO YO=await t.WB.callMethod('getOpenIdConfig');var JL=await uE(A,D);t.WB.callMethod('clearUser',JL.username);if(YO.lq!=null){var cD=JL.metadata['token'];var Q=new Map<String,String>();var Vt=ET(length:8);var Wt=A.requestedUri.resolve(sV.wa.path);Q['state']=Vt;Q['post_logout_redirect_uri']=Wt.toString();if(cD!=null){Q['id_token_hint']=cD;}yG=YO.lq.replace(queryParameters:Q);}}if(D!=null){await t.WB.callMethod("invalidateSession",D.id);eCB(D.username);}if(A.cookies.any((C)=>C.name=="DGTOKEN")){if(D!=null){await t.WB.callMethod("removeRememberToken",[D.username,A.cookies.firstWhere((C)=>C.name=="DGTOKEN").value]);}A.cookies.where((C)=>C.name=="DGTOKEN"||C.name=="DGUSER").forEach((IL){IL..maxAge=0..secure=SI;A.response.cookies.add(IL);});}var VI=A.uri.queryParameters['target'];if(VI!=null){if(Qj(A,VI))yG=VI;}A.response.redirect(yG);}else if(B=='/sso/openId'){return dD(A,PCB(A,zoneSession:D));}else if(B=="/sso/authorize"){return dD(A,OCB(A));}else if(B=="/sso/login"){return dD(A,gCB(A));}else if(B=="/sso/info"&&X.hq){return dD(A,uCB(A));}else if(B=="/dglicense.json"){XQ(A,YC.bb);}else if(B=="/dgconfig.json"){A.response.headers.contentType=ContentType.JSON;dD(A,SCB());}else if(B=="/favicon.ico"){dD(A,YC.GFB);}else if(B.startsWith('/images/')){dD(A,new File(p("www",B.substring(1))));}else if(X.fU!=null&&B.startsWith("/${Ut.replaceAll(Platform.pathSeparator,'/')}")){var LB=new File('www${Platform.pathSeparator}'+A.uri.path.substring(1).replaceAll('/',Platform.pathSeparator));dD(A,LB);}else if(B=="/file"||B.startsWith("/file/")){dD(A,vCB(A));}else if(B=="/session"||QDB(B,"session")){dD(A,TCB(A));}else if(B=="/proj"){try {dD(A,await vi(A));}catch (G){A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln(G);A.response.close();return null;}}else if(B=="/user"){dD(A,LCB(A));}else if(B=="/conn"||B.startsWith("/conn/")||B.startsWith("/icon/")||B=="/ws"){var O=A.headers['origin']?.first;if(O!=null&&O.isNotEmpty){var zG=A.requestedUri.toString();if(X.vY){if(!zG.startsWith(O)){A.response.statusCode=HttpStatus.FORBIDDEN;A.response.close();U.jB('Denied request for ${zG} from ${O}');return null;}}else if(!X.Bg){if(!X.nR.hasMatch(O)){A.response.statusCode=HttpStatus.FORBIDDEN;A.response.close();U.jB('Denied request for ${zG} from ${O}');return null;}}}try {if(X.nZ==true&&yD.va!=null){var H=await uE(A,D);yD.va(A,H);}else{if(B.startsWith("/icon/")){var V=Ab(A.uri);await dM.Sj(A,V);return null;}var sE=await uE(A,D);var ZO=sE.username;var TO=ZO!=null?{"X-Username":ZO,"X-Verification-Token":yD.qV}:const{};String S;if(A.uri.queryParameters["session"] is String){var wD=sE.metadata["groups"];if(wD is String){S=wD;}else if(wD is List){S=wD.map((N)=>N.toString()).join();}else if(sE.username!=HD.NK.username){S=sE.pD?":config":":user";}}if(S!=null){TO["X-Permission-Group"]=S;}var V=Ab(A.uri);if(X.tK!=null&&X.tK.isNotEmpty&&V.queryParameters["auth"]==null&&V.queryParameters["session"]!=null){try {MF lS=MW();dJ WO=lS.pF;String SO=WO.U8("dglux-${V.queryParameters['session']}-");var Nt={"publicKey":WO.IV,"isRequester":true,"isResponder":false,"version":"1.1.2"};var UO=await XW.fGB("POST",Ab(Uri.parse("/conn?dsId=${SO}")).toString(),headers:{"Content-Type":"application/json"});UO.write(QL.convert(Nt));HttpClientResponse Yt=await UO.close();Map iS=hE.convert(RL.convert(await Yt.fold([] ,(Zt,bt){return Zt..addAll(bt);})));var Xt=await lS.Jr(iS["tempKey"]);String jh=Xt.CS(iS["salt"]);var Q=new Map.from(V.queryParameters);Q["auth"]=jh;Q["format"]="json";Q["dsId"]=SO;Q.remove("session");V=V.replace(queryParameters:Q);}catch (G,EB){U.QB("Failed to handle DGLux /conn handshake",G,EB);}}await dM.Sj(A,V,TO);}}catch (G,EB){U.QB('Error forwarding broker request',G,EB);try {A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.write("Internal Server Error");if(X.gU){A.response.writeln("${G}\n${EB}");}}catch (G){}await A.response.close();}}else if(B=="/update"){A.response.deadline=null;dD(A,Px(A));}else if((B=="/p"||B=="/p/fr")){YEB(A);}else if(B=="/"+hG(YC.db.path)){dD(A,EDB(A,H));}else{var La=new File(bm([YC.HW]..addAll(b2.split(B.substring(1)))));if(B=='/viewer.html'){var kh=A.requestedUri.host!='localhost'&&A.requestedUri.host!='127.0.0.1';var Jt=X.Hf&&kh;if(H.username=='guest'&&Jt){var TI=A.requestedUri;var EK=TI.replace(queryParameters:{});var ih=TI.hasQuery?'${Uri.encodeQueryComponent(TI.query)}':'';A.response.redirect(Uri.parse('/login?target=${EK}${ih}'));}else if(X.vI=='openId'){var CC=await Eb(A,YC.Lk);return dD(A,CC);}}if(await La.exists()){XQ(A,La);return null;}{var HF=X.proxies.keys.firstWhere((N){return N==B||B.startsWith(N+"/");},orElse:()=>null);if(HF!=null){var EK=X.proxies[HF];var eF=Uri.parse(EK);var r=A.uri;var UI=r.path;UI=UI.substring((HF+(HF==B?"":"/")).length);r=r.replace(scheme:eF.scheme,userInfo:r.userInfo,host:eF.host,port:eF.port,path:UI);await dM.Sj(A,r);return null;}}var UB=new Map<String,String>.from(X.SM);if(!UB.containsKey("/assets")){UB["/assets"]=p(YC.hF,"assets");}UB.addAll(Cb);var ct=UB.keys.map((C){if(C.startsWith("!")){return C.substring(1);}else{return C;}}).map((C)=>[C,C.endsWith(Platform.pathSeparator)?C.substring(0,C.length-Platform.pathSeparator.length):C]).toList();var UM=ct.where((C)=>B.startsWith(C[1])).toList();if(UM.isNotEmpty){var dF=UM.first;var DK=false;if(UB.keys.contains("!${dF[0]}")){DK=true;}var rC=UB[(DK?"!":"")+dF[0]];if(rC.endsWith(Platform.pathSeparator)){rC=rC.substring(0,rC.length-Platform.pathSeparator.length);}var aB="${rC}${A.uri.path.replaceFirst(dF[1],"")}";if(await FileSystemEntity.isDirectory(aB)){var dt=["index.html","index.htm","main.html","main.htm"];for(var KL in dt){if(!((await FileSystemEntity.type("${aB}/${KL}"))==FileSystemEntityType.NOT_FOUND)){aB="${aB}/${KL}";}}if(await new File(aB).exists()){if(!A.uri.path.endsWith("/")){A.response.redirect(Uri.parse(A.uri.path+"/"));return null;}}}if(DK&&(await uE(A,D)).username==HD.NK.username){A.response.redirect(Uri.parse("/login?target=${Uri.encodeComponent(A.uri.toString())}"));return null;}var LB=new File(aB);XQ(A,LB);return null;}if(XV()){return null;}var bO=YC.Rz;if(!(await bO.exists())){RJ(A,A.response);return null;}List<String> jS=await bO.list().where((C)=>C is Directory).map((C)=>hG(C.path)).toList();var K=e2(B).skip(1).toList();var CH=K.length>=2&&K[0]=="project";if(CH?(jS.contains(K[1])):(K.length>=1&&jS.contains(K[0]))){if(B.endsWith("/")){A.response.redirect(Uri.parse(B.substring(0,B.length-1)));return null;}var Ha=CH?K[1]:K[0];var FC=CH?K.skip(2).join("/"):K.skip(1).join("/");if(FC==Ha||FC.isEmpty){FC=null;}var LB=YC.Lk;var CC=await Eb(A,YC.Lk);String J;if(CC is File){if(!(await LB.exists())){RJ(A,A.response);return null;}J=await LB.readAsString();}else if(CC is HH){J=(CC as HH).JG;}if(!gx(A)){return nx(A,A.response);}var IB='../'*'/'.allMatches(A.uri.path,1).length;var Ma='''
          <body>
          <input hidden id="defaultproj" value="${Ha}">
          <input hidden id="defaulthost" value="${IB}">
          ''';if(FC!=null){Ma+= '<input hidden id="defaultpath" value="${FC}">';}J=J.replaceAll("<body>",Ma);J=J.replaceAll('href="','href="${IB}');J=J.replaceAll('"dglux.patch.js"','"${IB}dglux.patch.js"');J=J.replaceAll('"core.patch.js"','"${IB}core.patch.js"');J=J.replaceAll('"viewer.dart','"${IB}viewer.dart');J=J.replaceAll("themesPrefix = 'themes/'","themesPrefix = '${IB}themes/'");dD(A,new HH(J,ContentType.HTML));}else{RJ(A,A.response);return null;}}}catch (kS){if(kS is int){try {eW(A,kS);A.response.close();}catch (O$){}}else{rethrow;}}},zoneValues:{"session":I,"stopwatch":dH},onError:(G,EB){U.QB('Error processing requests',G,EB);try {A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln("Internal Server Error");A.response.writeln(G.toString());A.response.writeln(EB.toString());}catch (G){}A.response.close();});}void NDB(HttpRequest A){A.response.statusCode=HttpStatus.MOVED_PERMANENTLY;A.response.headers.set("X-Frame-Options","DENY");A.response.headers.set("Location",A.requestedUri.replace(scheme:A.requestedUri.scheme=="ws"?"wss":"https",port:t.Gj).toString());}bool gx(HttpRequest C){int A;var B=C.headers.value(HttpHeaders.USER_AGENT).toLowerCase();if(B.isEmpty)return true;A=WQ('chrome',B);if(A>=30)return true;A=WQ('firefox',B);if(A>=27)return true;A=WQ('msie',B);if(A!=-1)return false;A=WQ('trident',B);if(A==11)return true;A=WQ('safari',B);if(A>=537){var D=WQ('applewebkit',B);var G=WQ('version',B);if(D>=537&&G>=7){return true;}}U.jB('Unknown user-agent string: ${B}');return false;}int WQ(String C,String B){int A;A=B.indexOf(C);if(A==-1)return A;B=B.substring(A+C.length+1);A=B.indexOf(r'.');return int.parse(B.substring(0,A),onError:(D)=>-1);}Future ODB(Iterable<Cookie> B,C)async{if(B.length>1){var D=new DateTime.fromMillisecondsSinceEpoch(0);for(Cookie G in B){try {iE A=await t.WB.callMethod("getSession",G.value);if(A!=null&&A.Rq.isAfter(D)){D=A.Rq;C=G;}}catch (H){}}}return C;}Future<iE> PDB(HttpRequest C)async{var D=C.cookies.firstWhere((A)=>A.name=="DGTOKEN",orElse:()=>null);var B=C.cookies.firstWhere((A)=>A.name=="DGUSER",orElse:()=>null);if(D==null||B==null)return null;var G=await t.WB.callMethod("checkRememberToken",[B.value,D.value]);if(G){return RK(B.value);}return null;}Future Eb(HttpRequest C,File A)async{if(X.vI!='openId')return A;fO D=await t.WB.callMethod('getOpenIdConfig');if(D.XY==null){return A;}if(!(await A.exists())){RJ(C,C.response);return null;}var G=hG(YC.db.path);var H='''
      <iframe id="oidcSession" src="${D.XY.toString()}" style="position:absolute;top:0;left:0;width:0;height:0;border:0; border:none;"></iframe>
      <iframe src="${G}" style="position:absolute;top:0;left:0;width:0;height:0;border:0; border:none;"></iframe>
    </body>
  ''';var B=await A.readAsString();B=B.replaceAll("</body>",H);return new HH(B,ContentType.HTML);}bool QDB(String B,String A){if(X!=null&&X.uY!=null&&X.uY[A] is List){return X.uY[A].contains(B);}return false;}bool Qj(HttpRequest A,String C){if(C.startsWith('/')){return true;}var D=A.requestedUri.scheme;var G=A.requestedUri.host;var B=A.requestedUri.port;var H=RDB(B)?'(:${B})?':':${B}';var I=new RegExp('^(${D}:\/\/)?${G}${H}\/.*\$');return I.hasMatch(C);}bool RDB(int A)=>A==80||A==443;MCB(HttpRequest A,iE C)async{var D=await MK(A,useRootRedirect:true);if(!D){return null;}var B=await uE(A,C);if(ax(B.metadata,"rootUrl","/",not:true)){A.response.redirect(Uri.parse(B.metadata["rootUrl"]));return null;}else if(ax(B.metadata,"allowDesigner",false)){if(Zx(X.CJ)&&X.CJ!="/"){A.response.redirect(Uri.parse(X.CJ));return null;}else{await zD(A,A.response);}return null;}else if(X!=null&&!B.pD&&Zx(X.CJ)&&X.CJ!="/"){A.response.redirect(Uri.parse(X.CJ));return null;}else{return Eb(A,YC.Pz);}}vM VQ;zi(xO A)async{return Cj(()=>ZCB(A));}ZCB(xO K)async{ui();var G=K.get("workerId");var r=K.get("logLevel");if(r is String){Lj(r);}Jj=G;U.jB("Server Worker #${G} Started.");gC B=await K.i7();LD A;EB(LD I)async{if(I!=null){X=A=I;Kb(I.dP);await aC.WCB(I.eq);}}await EB(await B.callMethod("getServerConfig"));Kb(A.dP);if(A.GM!=null&&A.GM.contains("Server Workers")){B.YZ=(aB){FH("Server Worker #${G}","Received Message from Main Worker: ${aB}");};}B.u("setServerConfig",EB);B.u("addLinkStatic",(J){String M=J[0];String qB=J[1];Cb[qB]=M;});B.u("removeLinkStatic",(J){String M=J[0];var IB=[] ;Cb.forEach((CC,FC){if(FC==M){IB.add(CC);}});IB.forEach(Cb.remove);});ul D;X=A;oV=await B.callMethod("getHttpAuthenticationAdapter");t.xa=await B.callMethod("getProductId");yD.ua=await B.callMethod("getBrokerPort");yD.qV=await B.callMethod("getVerificationUserToken");t.CT=await B.callMethod("isInSecureMode");t.Gj=await B.callMethod("getHttpsPort");String N;var O=await yi();if(O>=900000000000000000000||O==-1){N="unknown";}else{N=O.toString();}Sx=await B.callMethod("hasPlugins");B.done.then((fC){U.jB("Server Worker #${G} Stopped.");if(D!=null){D.close(force:true);}});t.WB=B;var LB=()async{if(D!=null){await D.close();}await runZoned(()async{var UB=await dz(X);var Q=<HttpServer>[] ;var H=A.gq?InternetAddress.ANY_IP_V6:A.host;HttpServer S;if(A.port>0){try {S=await HttpServer.bind(H,A.port,shared:true);}catch (C){if(C is SocketException&&C.toString().contains("Failed to start accept")||C.toString().contains("Address family not supported")){H=InternetAddress.ANY_IP_V4;S=await HttpServer.bind(H,A.port,shared:true);}else{rethrow;}}Q.add(S);}if(A.XH!=null&&A.XH.isNotEmpty&&A.ZH!=null&&A.ZH>0){Future V;if(UB!=false){var b=HttpServer.bindSecure;V=Function.apply(b,[H,A.ZH,UB],{#shared:true});}else{var b=HttpServer.bindSecure;V=Function.apply(b,[H,A.ZH],{#shared:true,#certificateName:A.XH});}Q.add(await V);}D=new ul(Q);D.autoCompress=true;D.serverHeader="dglux_server/${N}";D.listen(XCB,onError:(C){},cancelOnError:false);},onError:(C,h){if(X.FQ.toLowerCase()=='debug'){U.QB("Warning in Server Worker #${G}",C,h);}else{U.QB("Warning in Server Worker #${G}: ${C}");}});};B.u("rebind",(fC)async{try {await A.J9();}catch (C,h){U.QB("Rebind Config Reload Failed",C,h);}await LB();U.jB("Server Worker #${Jj} Rebound.");});await LB();}String wi;TCB(HttpRequest C)async{String I;if(C.method=="POST"){var h=await zM.AN(C);var J=h.TD;var G=J["username"];var H=J["password"];var r=J["remember"]!=null;var Q=J["token"]!=null;if(Q&&H.startsWith("!token!:")){H=H.substring(8);}if(Q){if(await t.WB.callMethod("checkRememberToken",[G,H])){var M=await RK(G);I=G;C.response.headers.set("X-DG-Session",M.id);}}else{var EB=await t.WB.callMethod("authenticate",[G,H]);if(EB){var M=await RK(G);if(r==true){var S=tV(C);var N=new DateTime.now();var V=new DateTime(N.year,N.month+1,N.day);var IB=await t.WB.callMethod("createRememberToken",G);C.response.cookies.removeWhere((b)=>b.name=="DGTOKEN"||b.name=="DGUSER");C.response.cookies.add(new Cookie("DGTOKEN",IB)..expires=V..secure=S);C.response.cookies.add(new Cookie("DGUSER",Uri.encodeComponent(G))..expires=V..secure=S);C.response.headers.set("X-DG-Session",M.id);}I=G;}}}if(wi==null){var K=new DateTime.now().timeZoneOffset.inHours;wi="${K.isNegative?"-":""}${K>10?K:"0${K.abs()}"}:00";}var A=t.xa;if(A.startsWith("dglux-dsa-")){A=A.substring("dglux-dsa-".length);}else if(A.startsWith("dgserver-")){A=A.substring("dgserver-".length);}else if(A.startsWith("atrius-dsa-")){A=A.substring("atrius-dsa-".length);}else if(A.startsWith("dsa-")){A=A.substring("dsa-".length);}if(t.ya==null||t.za==null){var O=await ADB();if(BDB(A,O)){t.ya=O["dglux"]["dist"];t.za=O["dglux"]["type"];}else{t.ya="Dsa";t.za="dsa";}}var B={"dist":t.ya,"type":t.za,"serverTimezone":wi,"connection":"dslink","version":Oc,"formats":(X!=null&&X.tK!=null&&X.tK.isNotEmpty)?const["json"]:const["msgpack","json"]};if(C.uri.queryParameters.containsKey("salt")){var LB=await Tj(length:4);var UB=C.uri.queryParameters["salt"];var aB=cj.lEB(LB+UB+A);B["productCode"]=aB;}var D=await uE(C);if(I!=null){B["user"]=I;B["session"]=GH()?.id;B["superUser"]=true;}else if(D!=null){B["user"]=D.username;B["session"]=GH()?.id;if(D.pD){B["superUser"]=true;}if(D.metadata['ldapGroups']!=null&&X.vI.contains('ldap')){B['userLdapGroups']=D.metadata['ldapGroups'];}if(D.metadata['groups']!=null&&D.metadata['groups'] is List){B['dsaGroups']=D.metadata['groups'].join(',');}if(D.metadata['memberOfGroups']!=null){B['memberOfGroups']=D.metadata['memberOfGroups'];}}B["git"]=aC.sa;return B;}Future<Map<String,dynamic>> ADB()async{var A=YC.bb;if(!await A.exists()){return null;}Map B;try {B=hE.convert(await A.readAsString());}catch (C){U.jB("error decoding license file",C);return null;}return B;}bool BDB(String C,Map<String,dynamic> A){if(A is!Map||A["dglux"]["productId"]==null)return false;if(A["dglux"]["productId"]=='*')return true;String B=A["dglux"]["productId"];String D=A["dglux"]["type"];B=B.substring(D.length+1);return C==B;}Future<g> uE(HttpRequest H,[iE B])async{var A=B!=null?B:GH();if(A==null){return HD.NK;}var C=await A.AS("sso");if(C is Map){return g.mV(C);}if(A.rJ is g&&A.rJ.username==A.username){return A.rJ;}var D=A.username;g G=await t.WB.callMethod("getUser",D);if(G!=null){return A.rJ=G;}else{t.WB.callMethod("invalidateUserCache",D);return HD.NK;}}iE GH()=>Zone.current["session"];Future<iE> RK(String C,[iE A])async{if(A==null){A=GH();}if(A==null){iE B=await t.WB.callMethod('createSession');B=await t.WB.callMethod("updateSession",[B.id,C]);A=B;}else{iE B=await t.WB.callMethod("updateSession",[A.id,C]);A=B;}return A;}class iE{String username;String id;g DYB;DateTime lastSeen;DateTime Rq;g rJ;Map ycB={};Future<dynamic> AS(String A)async{return await t.WB.callMethod("getSessionAttribute",[id,A]);}Future QI(String A,B)async{await t.WB.callMethod("setSessionAttribute",[id,A,B]);}}Px(HttpRequest A,[bool H=false])async{if(!(await MK(A)))return null;if(!(await uE(A)).pD){return "You do not have permission to do that.";}if(A.method=="GET"){var G=YC.cb;var C=await YC.KFB.readAsString();String B="4200";if(await G.exists()){B=(await G.readAsString()).trim();if(B==null){B="4200";}}C=C.replaceAll("{{DGLUX_REVISION}}",B);return new HH(C,ContentType.HTML);}else if(A.method=="POST"&&!H){var D=YC.Qz;if(!(await D.exists())){await D.create(recursive:true);}dT I=await zM.AN(A);var J=(I.TD["fn"] as X1).JG;await YQ(J,D);await A.response.redirect(sV.wa);UE();return null;}A.response.statusCode=HttpStatus.BAD_REQUEST;return "Invalid Request.";}Future<rB> rCB()async{List<int> I;try {I=await Ib(X.bf);}catch (A){return new rB.KWB("Failed to fetch distribution information: ${A}");}var M=RL.convert(I);Map J;try {J=hE.convert(M);}catch (A){return new rB.KWB("Failed to decode distribution information: ${A}");}int N=await yi();int D;Map K=J["dists"];if(K is!Map){return new rB.KWB("Failed to handle distribution information: dists key not found");}Map B=K[ti];if(B is!Map){return new rB.KWB("Failed to handle distribution information: dist ${ti} not found");}try {D=int.parse(B["latest"]);}catch (A){return new rB.KWB("Failed to determine the latest build number: ${A}");}if(N>=D){return new rB.JWB("Server is up-to-date.");}try {var O=B["file"];var C=B["update"];if(C==null){C={};}List<String> G=[] ;if(C.containsKey("ignore")){G.addAll(C["ignore"]);}if(X.Eg==true){G.addAll(const["www/*.html","www/*.css","www/*.png","www/*.jpg","www/*.js","www/*.ico","www/css","www/js","www/img","www/images"]);}String H;if(B["url"] is String){H=B["url"];}else{H="https://dsa.s3.amazonaws.com/dists/${ti}/${D}/${O}";}await Hb(H,Directory.current,exclude:G);return new rB.JWB("Updated!");}catch (A){return new rB.KWB("Failed to update: ${A}");}}Future<rB> yCB(ByteData A)async{try {List<String> B=["bin/tools/nssm-x32.exe","bin/tools/nssm-x64.exe"];if(X.Eg==true){B.addAll(const["www/*.html","www/*.css","www/*.png","www/*.jpg","www/*.js","www/*.ico","www/css","www/js","www/img","www/images"]);}await YQ(A.buffer.asUint8List(A.offsetInBytes,A.lengthInBytes),Directory.current,exclude:B);return new rB.JWB("Updated!");}catch (C){return new rB.KWB("Failed to update: ${C}");}}List<Map<String,dynamic>> uV;Future<List<Map<String,dynamic>>> Bb()async{if(X!=null&&X.zf){return [] ;}var A=hE.convert(RL.convert(await Ib(X.Hg,retry:3)));if(A is List){A.sort((B,C){if(B is Map&&C is Map&&B["displayName"]!=null&&C["displayName"]!=null){return B["displayName"].compareTo(C["displayName"]);}return 0;});uV=A;U.mB("Updated Link Repository Data (${A.length} links)");}return A;}Map<String,InternetAddress> pV={};Future aCB(String A,InternetAddress B)async{Future C()async{pV[A]=B;if(X.IZ){await oCB(A,B);}}if(!pV.containsKey(A)){await C();}else if(pV[A].address!=B.address){await C();}}Object eCB(String A)=>pV.remove(A);Future<File> get Ej async{var A=new File('logs/${X.fr}');var B=await A.exists();if(!B){await A.create();}return A;}Future<Null> kCB(String A,InternetAddress B)async{pV[A]=B;final C=await Ej;await C.writeAsString("${new DateTime.now().toIso8601String()}: Login for user ${A} from ${B.address}\n",mode:FileMode.APPEND);}Future<Null> oCB(String A,InternetAddress B)async{final C=await Ej;await C.writeAsString("${new DateTime.now().toIso8601String()}: User ${A} has a new IP address: ${B.address}\n",mode:FileMode.APPEND);}Future<Null> tCB(String A,InternetAddress B,bool C)async{final D=await Ej;String G=C?'A forgotten password request was sent to ${A} as requested from ${B.address}':'A forgotten password request for ${A} by ${B.address} failed to match';await D.writeAsString('${new DateTime.now().toIso8601String()}: ${G}\n',mode:FileMode.APPEND);}LCB(HttpRequest A)async{try {var D=A.uri.queryParameters["op"];if(D=="listUser"){if(!(await MK(A,requireSuperuser:true))){return null;}List<g> S=await t.WB.callMethod("getUsers");return S.map((g C)=>{"name":C.username,"superUser":C.pD,"email":C.GE,"metadata":C.metadata}).toList();}else if(D=="getUser"){var B=A.uri.queryParameters["name"];var H=await uE(A);if(B==null&&H.username=="guest"){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Username is required.";}B=H.username;if(!(await MK(A,requireSuperuser:true,user:B)))return null;g G=B==H.username?H:await t.WB.callMethod("getUser",B);if(G==null){A.response.statusCode=HttpStatus.NOT_FOUND;return "User not found.";}return {"name":G.username,"superUser":G.pD,"email":G.GE,"metadata":G.metadata};}else if(D=="putUser"){if(A.method!="POST"){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Method not supported.";}var B=A.uri.queryParameters["name"];if(!(await MK(A,requireSuperuser:true,user:B))){return null;}if(B==null||B.isEmpty){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Username is required.";}List<g> V=await t.WB.callMethod("getUsers");if(V.any((g M)=>M!=null&&M.username==B)){A.response.statusCode=HttpStatus.BAD_REQUEST;return "User already exists.";}dT N=await zM.AN(A);if(N.type!="json"){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Body should be JSON.";}var I=N.TD;var J=I["password"];if(J==null||J.isEmpty){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Password is required.";}bool O=false;if((await uE(A)).pD){O=I["superUser"]==null?false:I["superUser"];}var b=I["email"];var K=await t.WB.callMethod("createUser",[new g(B,O,b),J]);return K.map((g C)=>{"name":C.username,"superUser":C.pD,"email":C.GE,"metadata":C.metadata}).toList();}else if(D=="removeUser"){var B=A.uri.queryParameters["name"];if(!(await MK(A,requireSuperuser:true,user:B))){return null;}if(B==null||B.isEmpty){A.response.statusCode=HttpStatus.BAD_REQUEST;return "Username is required.";}var K=await t.WB.callMethod("removeUser",B);return K.map((g C)=>{"name":C.username,"superUser":C.pD,"email":C.GE}).toList();}else{A.response.statusCode=HttpStatus.SERVICE_UNAVAILABLE;return "Unknown Operation: ${D}";}}on fF catch (Q){if(Q.message.contains("not support")){A.response.statusCode=HttpStatus.NOT_IMPLEMENTED;}else{A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;}A.response.writeln(Q.message);A.response.close();return null;}}bool get Vx=>Platform.numberOfProcessors<2;Future<bool> SL(int A,{bool asRoot: false,bool childrenOnly: false})async{try {Xx(A);}catch (C,D){U.QB("Failed to remove PID ${A} from list.",C,D);}if(Platform.isWindows){var B=await gF("taskkill",args:["/F","/T","/PID",A.toString()],timeout:const Duration(seconds:8));return B.exitCode==0;}else if(Platform.isMacOS){try {var B=await gF("kill",args:["-TERM","-"+A.toString()],timeout:const Duration(seconds:3),sudo:asRoot);return B.exitCode==0;}catch (C,D){U.QB("Failed to kill the process ${A}.",C,D);}return false;}else{try {await gF("pkill",args:["-TERM","-P",A.toString()],timeout:const Duration(seconds:3),sudo:asRoot);}catch (C,D){U.QB("Failed to kill the process ${A}.",C,D);}if(!childrenOnly){IH B=await gF("kill",args:["-TERM",A.toString()],timeout:const Duration(seconds:3),sudo:asRoot,writeToBuffer:true);if(!asRoot&&B.XE.toString().contains("not permitted")){U.mB("Unable to kill PID ${A} without root," " attempting sudo kill.");var G=await SL(A,asRoot:true);if(G){U.mB("Killed PID ${A} as root.");}else{U.mB("Failed to kill PID ${A} as root.");}}return B.exitCode==0;}else{return true;}}}Future<String> wCB()async{List<NetworkInterface> A=await NetworkInterface.list();if(A==null||A.isEmpty){return null;}var D=A.first;List<InternetAddress> B=D.addresses.where((C)=>!C.isLinkLocal&&!C.isLoopback).toList();if(B.isEmpty){return null;}return B.first.address;}bool Zx(A)=>A is String&&A.isNotEmpty;bool ax(A,B,C,{bool not: false}){if(A==null){return false;}if(not){if(A[B]==null){return false;}if(A[B]==""&&C!=""){return false;}if(A[B]!=C){return true;}}else{if(A[B]==C){return true;}}return false;}Future Tx()async{var B=new Directory("bin");await for(var C in B.list().where((A)=>A is File&&A.path.endsWith(".snapshot"))){try {await C.delete();}catch (D){}}}Future bCB(ByteData A)async{if(Platform.isWindows){throw new Exception("Error: Updating the Dart VM on Windows is not yet supported.");}var B=new Directory("../dart-sdk").absolute;if(!(await B.exists())){throw new Exception("Error: Directory at '${B.path}' does not exist.");}await YQ(A.buffer.asUint8List(A.offsetInBytes,A.lengthInBytes),B,handleSingleDirectory:true);await Tx();}Future jCB(String B)async{if(Platform.isWindows){throw new Exception("Error: Updating the Dart VM on Windows is not yet supported.");}var A=new Directory("../dart-sdk").absolute;if(!(await A.exists())){throw new Exception("Error: Directory at '${A.path}' does not exist.");}await Hb(B,A,handleSingleDirectory:true);await Tx();}vM QCB(int C,nW D,{Map<String,dynamic> metadata}){var B=[] ;for(var A=1;A<=C;A++ ){B.add(J1(D,metadata:{"workerId":A}..addAll(metadata==null?{}:metadata)));}return new vM(B);}bool Ay=false;Function By;abstract class bQ{Stream WZ(String A);Stream Rg(String A);Set<String> get ND;void sg();Future gs(String A,String B,Map<String,dynamic> C);Future yg(String A);}const bool IEB=const bool.fromEnvironment("dsa.runtime_manager.dart.merged",defaultValue:false);bQ JH;bool yV=false;Future<bQ> MEB(List<Process> K,List<String> B)async{if(IEB){if(JH!=null){return JH;}var D=new NEB();JH=D;yV=false;return D;}if(yV){U.jB("Waiting for Dart Runtime Manager to start.");while(true){if(!yV){break;}await new Future.delayed(const Duration(milliseconds:5));}return JH;}if(JH!=null){return JH;}yV=true;String M=await vDB();String A=p("bin","runtime.dart");if(!(await new File(A).exists())){A=p("bin","helpers","runtime.dart");}var G=new File(p(jT(A),pJB(A)+".snapshot")).absolute;if(await G.exists()){A=G.path;}var H=()async{var C=[] ;if(B!=null&&B.isNotEmpty){C.addAll(B);}C.addAll(["-Ddslink.runtime.manager=true",A]);var I=await Process.start(M,C);K.add(I);return I;};var J=new SK(await H(),logFile:new File("logs/runtime-dart.log"),restart:H,name:"Dart");JH=J;yV=false;return J;}class SK implements bQ{Process process;bool f_=false;Stream WZ(String A){return zcB.stream.where((String B)=>B==A);}Stream Rg(String A){return AdB.stream.where((B)=>B==A||"!${A}"==B);}StreamController<String> zcB=new StreamController.broadcast();StreamController<String> AdB=new StreamController.broadcast();IOSink HO;SK(this.process,{String name,File logFile,Future<Process> restart()}){B()async{if(HO!=null){HO.close();HO=null;}var D="runtime-${name==null?'unknown':name.toLowerCase()}";Aj(process.pid,D);if(logFile!=null){if(!(await logFile.exists())){await logFile.create(recursive:true);}HO=await logFile.openWrite(mode:FileMode.APPEND);}process.exitCode.then((G)async{BdB=false;Xx(process.pid);if(!f_){U.BC("${name==null?"A":name} runtime manager died: ${G}");}try {HO.close();}catch (C){}if(ND.isNotEmpty&&By!=null){var H=new List.from(ND);ND.clear();for(var I in H){zcB.add(I);}}if(restart!=null&&!Ay){process=await restart();B();}});process.stdout.transform(RL).listen((String A){if(A.startsWith("\u0002")&&A.trim().endsWith("\u0003")){A=A.trim();var J=A.substring(1,A.length-1);var K=hE.convert(J);mRB(K);}else{if(HO!=null){try {HO.write(A);}catch (C){}}else{lh.stdout.write(A);}}});process.stderr.transform(RL).listen((String A){if(HO!=null){try {HO.write(A);}catch (C){}}else{lh.stderr.write(A);}});}B();}Set<String> ND=new Set<String>();List<String> CdB=[] ;mRB(Map A)async{U.mB("Runtime Manager Received: ${A}");var B=A["event"];if(B=="fail"){if(!ND.contains(A["path"])){AdB.add("!${A["path"]}");}else{zcB.add(A["path"]);ND.remove(A["path"]);}}else if(B=="stopped"){zcB.add(A["path"]);ND.remove(A["path"]);}else if(B=="ready"||B=="started"){AdB.add(A["path"]);}else if(B=="runtime.ready"){U.mB("Runtime Manager - Flushing Write Queue: ${CdB.length}");BdB=true;while(CdB.isNotEmpty){write(CdB.removeAt(0));}}}Future gs(String A,String B,Map<String,dynamic> C)async{write({"event":"start","path":A,"main":B,"configs":C});return Rg(A).first.then((String D){if(D.startsWith("!")){return false;}ND.add(A);return true;});}Future yg(String A){write({"event":"stop","path":A});return WZ(A).first;}int DdB;bool BdB=false;bool EdB=true;bool FdB=false;void write(A){if(FdB&&A is Map&&A["event"]!="stop"){return;}if(!BdB){CdB.add(A);return;}if(EdB){var B=new DateTime.now().millisecondsSinceEpoch;if(DdB!=null&&(B-DdB)<500){new Future.delayed(Platform.numberOfProcessors==1?const Duration(milliseconds:500):const Duration(milliseconds:250),(){write(A);});return;}DdB=B;}U.mB("Runtime Manager Write: ${A}");var C=QL.convert(A);process.stdin.write("\u0002"+C+"\u0003");}void sg(){f_=true;EdB=false;FdB=true;}}const String Yj='dslinks';const String KEB='logs/installer.log';Future<String> zx(Directory C,String N,Map O)async{try {var A=O["update"];var H=A is Map&&A["backupForUpdate"]==true;var G={};if(H){var I=["nodes.json",".dslink.key"];if(A!=null&&A["protectedFiles"]!=null){I.addAll(A["protectedFiles"]);}for(var B in I){var D=new File(p(C.path,B));if(await D.exists()){G[B]=await D.readAsBytes();}}}if(A is Map&&A["delete"] is List&&A["delete"].isNotEmpty){for(var J in A["delete"]){if(J is!String)continue;try {var K=await ZQ("${C.path}/${J}");if(await K.exists()){await K.delete(recursive:true);}}catch (M){}}}await Hb(N,C,handleSingleDirectory:true);if(H){for(var B in G.keys.toList()){var Q=G.remove(B);var D=new File(p(C.path,B));await D.writeAsBytes(Q);}}return iM;}catch (M){return "Error: ${M.toString()}";}}Future<String> OEB(Directory C,ByteData G,Map O)async{try {var A=O["update"];var I=A is Map&&A["backupForUpdate"]==true;var H={};if(I){var J=["nodes.json",".dslink.key"];if(A!=null&&A["protectedFiles"]!=null){J.addAll(A["protectedFiles"]);}for(var B in J){var D=new File(p(C.path,B));if(await D.exists()){H[B]=await D.readAsBytes();}}}if(A!=null&&A["delete"] is List&&A["delete"].isNotEmpty){for(var K in A["delete"]){if(K is!String)continue;try {var M=await ZQ("${C.path}/${K}");if(await M.exists()){await M.delete(recursive:true);}}catch (N){}}}await YQ(G.buffer.asUint8List(G.offsetInBytes,G.lengthInBytes),C,handleSingleDirectory:true);if(I){for(var B in H.keys.toList()){var Q=H.remove(B);var D=new File(p(C.path,B));await D.writeAsBytes(Q);}}return iM;}catch (N){return "Error: ${N.toString()}";}}Future<rB> PEB(String A,String B,{String linksDirectoryName: Yj,String logPath: KEB})async{final C=new Xz(linksDirectoryName,B,A,logPath);return C.mq();}Future<rB> QEB(ByteData A,String B,{String linksDirectoryName: Yj})async{final C=new Tz(linksDirectoryName,B,A);return C.mq();}Future<rB> REB(String A,String B,{String linksDirectoryName: Yj})async{final C=new az(linksDirectoryName,B,A);return C.mq();}bQ SJ;bool Jb=false;Future<bQ> LEB(List<Process> I,List<String> A)async{if(Jb){U.jB("Waiting for Java Runtime Manager to start.");while(true){if(!Jb){break;}await new Future.delayed(const Duration(milliseconds:5));}return SJ;}if(SJ!=null){return SJ;}Jb=true;String B=await VE("java");if(B==null){B="java";}String J=p("bin","runtimes","java.jar");var D=()async{var C=[] ;if(A!=null&&A.isNotEmpty){C.addAll(A);}C.addAll(["-jar",J]);var G=await Process.start(B,C);I.add(G);return G;};var H=new SK(await D(),logFile:new File("logs/runtime-java.log"),restart:D,name:"Java");SJ=H;Jb=false;return H;}const String JEB=r"""
import "dart:async";
import "dart:io";
import "dart:isolate";
import "{{uri}}" as run;

main(List<String> args, msg) async {
  var rp = new ReceivePort();
  SendPort sp;
  if (msg is SendPort) {
    sp = msg;
  } else {
    sp = rp.sendPort;
  }

  var rcfg = {};

  rp.listen((x) {
    if (x == "STOP") {
      if (rcfg != null && rcfg["closeHandler"] is Function) {
        rcfg["closeHandler"]();
      }
      rp.close();
    }
  });

  sp.send(rp.sendPort);

  var file = new File("{{log_file}}");
  if (!(await file.exists())) {
    await file.create(recursive: true);
  }
  var raf = await file.openWrite(mode: FileMode.APPEND);
  var spec = new ZoneSpecification(print: (Zone self, ZoneDelegate parent, Zone zone, String line) {
    raf.writeln("[${currentTimestamp}] ${line}");
  }, handleUncaughtError: (Zone self, ZoneDelegate parent, Zone zone, error, StackTrace stackTrace) {
    var out = [];
    out.addAll(error.toString().split("\n"));
    out.addAll(stackTrace.toString().split("\n"));

    for (var line in out) {
      raf.writeln("[${currentTimestamp}] ${line}");
    }
    out.clear();
  });

  return await runZoned(() async {
    return await run.main(args);
  }, zoneSpecification: spec, zoneValues: {
    "dslink.runtime.config": rcfg
  });
}

String get currentTimestamp => new DateTime.now().toString();
""";class NEB extends bQ{Map<String,StreamController> GdB={};Map<String,StreamController> HdB={};Set<String> ND=new Set<String>();Stream WZ(String A){if(HdB[A] is StreamController){return HdB[A].stream;}var B=HdB[A]=new StreamController.broadcast();return B.stream;}Stream Rg(String A){if(GdB[A] is StreamController){return GdB[A].stream;}var B=GdB[A]=new StreamController.broadcast();return B.stream;}void sg(){}Future gs(String A,String V,Map<String,dynamic> C){new Future(()async{if(ND.contains(A)){await yg(A);}try {var I=new Directory(A);var J=[] ;for(var D in C.keys){if(C[D] is Map){C[D]=C[D]["value"];}if(D=="log-file"){continue;}J.add("--${D}=${C[D]}");}J.add("--base-path=${I.path}");var M=new File(p(I.path,V)).absolute;var G=JEB;G=G.replaceAll("{{uri}}",M.uri.toString());G=G.replaceAll("{{log_file}}",C["log-file"].toString());var N=new File(p(I.path,".rtm_stub"));await N.writeAsString(G);var O=new ReceivePort();var Q=new Directory(p(M.parent.path,"packages"));Uri S;if(await Q.exists()){S=Q.uri;}var B=await Isolate.spawnUri(N.uri,J,O.sendPort,paused:true,packageRoot:S);var K=new ReceivePort();K.listen((H){if(H=="EXIT"){if(HdB[A] is StreamController){HdB[A].add(A);}Cg.remove(A);K.close();O.close();}});B.addOnExitListener(K.sendPort,response:"EXIT");Cg[A]=B;B.resume(B.pauseCapability);if(GdB[A] is StreamController){GdB[A].add(A);}}catch (H){Isolate B=Cg.remove(A);if(B!=null){B.kill();}eg.remove(A);if(GdB[A] is StreamController){GdB[A].add("!${A}");}try {GdB.remove(A).close();}catch (H){}try {HdB.remove(A).close();}catch (H){}ND.remove(A);return new Future.value();}});return Rg(A).first.then((b){if(b.startsWith("!")){return false;}ND.add(A);return true;});}Future yg(String A)async{new Future(()async{if(eg[A] is SendPort){eg[A].send("STOP");}await new Future.delayed(const Duration(milliseconds:200));var B=Cg.remove(A);if(B!=null){B.kill(priority:Isolate.IMMEDIATE);}eg.remove(A);try {GdB.remove(A).close();}catch (D){}try {var C=HdB.remove(A);C.add(A);C.close();}catch (D){}ND.remove(A);});return WZ(A).first;}Map<String,Isolate> Cg={};Map<String,SendPort> eg={};}const List<String> SEB=const["host","connection","keep-alive","public","proxy-authenticate","proxy-authorization","trailers","upgrade","transfer-encoding","te","content-encoding"];const List<String> TEB=const["host","connection","keep-alive","public","proxy-authenticate","proxy-authorization","trailers","upgrade","transfer-encoding","te","content-encoding","content-length"];HttpClient UEB=new HttpClient()..badCertificateCallback=(A,B,C)=>true;RegExp VEB=new RegExp(r'''\\?\.(?!\+|\*|\{)''');RegExp WEB=new RegExp(r'''\w''');String Cy='';List<RegExp> Zj=[] ;String Kb(String B){if(Cy==B)return B;Cy=B;Zj=[] ;List<String> G=B.split('\n');List<String> C=[] ;for(String D in G){String A=D.trim();if(A.isEmpty){continue;}if(!A.startsWith('http')){A='https?:\/\/'+A;}String H=A.substring(A.length-1);if(WEB.matchAsPrefix(H)!=null){A=A+'\\b';}try {RegExp I=new RegExp(A.replaceAll(VEB,'\\.'));Zj.add(I);C.add(D.trim());}catch (J){}}return C.join('\n');}bool XEB(String A){for(RegExp B in Zj){if(B.matchAsPrefix(A)!=null){return true;}}return false;}YEB(HttpRequest A)async{A.response.deadline=const Duration(seconds:360);var I=A.uri.path.contains("/fr");var G=A.uri.query;if(G==null){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("No URL Specified");A.response.close();return;}try {String H=Uri.decodeComponent(G);if(!XEB(H)){A.response.statusCode=420;A.response.writeln("URL Not Allowed by Proxy");A.response.close();return;}Uri J=Uri.parse(H);HttpClientRequest B=await UEB.openUrl(A.method,J);B.followRedirects=I;ZEB(A,B);await A.pipe(B);HttpClientResponse D=await B.close();var C=A.response;C.statusCode=D.statusCode;aEB(D,C);await D.pipe(C);await C.close();}catch (K,M){A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln(K);A.response.writeln();A.response.writeln(M);A.response.close();return;}}ZEB(HttpRequest A,HttpClientRequest B){A.headers.forEach((C,D){if(SEB.contains(C.toLowerCase())){return;}B.headers.removeAll(C);for(var G in D){B.headers.add(C,G);}});if(A.headers["C00kie"]!=null&&A.headers["C00kie"].isNotEmpty){B.headers.add("Cookie",A.headers.value("C00kie"));}}aEB(HttpClientResponse C,HttpResponse B){C.headers.forEach((A,D){if(TEB.contains(A.toLowerCase())){return;}B.headers.removeAll(A);for(var G in D){B.headers.add(A,G);}});}Function bFB(){throw new UnsupportedError("We don't support the old SSL environment anymore.");}bool cz=false;dz(LD A,[bool C=false])async{if(A!=null&&A.ZH>0&&A.XH!=null&&A.XH.isNotEmpty){String D="certs";if(C){if(cz){return false;}bool B=true;try {var G=bFB();Function.apply(G,[] ,{#database:D,#password:A.eY});}on NoSuchMethodError {B=false;}on UnsupportedError {B=false;}on TlsException catch (H){if(H.message.contains("Called SecureSocket.initialize more than once")){return false;}rethrow;}if(B){cz=true;return false;}}try {return ez(A);}on TypeError {print("** Warning: Please update Dart to use HTTPS. Disabling HTTPS now. **");return false;}}return false;}typedef dynamic cFB({String directory,String file,String password});ez(LD A){String D="certs";var B=new SecurityContext();String G=p(D,A.XH);String I=p(D,A.bU);String H=A.eY??null;B.usePrivateKey(I,password:H);var C=B.useCertificateChain;if(C is cFB){Function.apply(C,[] ,{#file:G,#password:H});}else{Function.apply(C,[G]);}return B;}abstract class Nk{}abstract class KT implements Nk{}abstract class fb implements Nk{}abstract class JW{static JW Ok=new dFB();fb get nB;KT Ir(String A){return nB.Jq(A);}}class gz implements KT{final File file;gz(this.file);Future create()async{await file.create(recursive:true);}Future delete()async{await file.delete(recursive:true);}Future<bool> exists(){return file.exists();}Nk get parent{return new gb(file.parent);}String get path=>file.path;Future<List<int>> readAsBytes(){return file.readAsBytes();}Future<String> readAsString(){return file.readAsString();}Future writeAsBytes(List<int> A){return file.writeAsBytes(A);}Future writeAsString(String A,{bool verifyJson: false})async{return YW(file,A,verifyJson:verifyJson);}}class gb implements fb{final Directory uD;gb(this.uD);KT Jq(String A){var B=p(uD.path,A);return new gz(new File(B));}Future create(){return uD.create(recursive:true);}Future delete(){return uD.delete(recursive:true);}Future<bool> exists(){return uD.exists();}fb get parent=>new gb(uD.parent);String get path=>uD.path;}class dFB extends JW{fb get nB=>new gb(Directory.current);}class SE{final List<int> eC;SE(this.eC);bool operator==(Object A)=>A is SE&&const eV().LE(eC,A.eC);int get hashCode=>const eV().hash(eC);String toString()=>Mi.encode(eC);}class Ri extends Sink<SE>{SE get value{assert(IdB!=null);return IdB;}SE IdB;void add(SE A){assert(IdB==null);IdB=A;}void close(){assert(IdB!=null);}}class lFB{static String mFB="dart";}MF MW({bool save: true}){File D=new File(".dslink.key");MF B;String A;try {A=D.readAsStringSync();B=new MF.QWB(A);}catch (J){}if(A==null||A.length!=131){if(rM.vQ.Y9){String C;if(Platform.isWindows){C=Process.runSync("getmac",[] ).stdout.toString();}else{try {C=Process.runSync("arp",["-an"]).stdout.toString();}catch (I){try {var G="";for(var H in Platform.environment.keys){G+= "${H}=${Platform.environment[H]}\n";}C=G;}catch (I){}}}rM.vQ.I7(C);}B=new MF.PWB();A=B.oZ();if(save==true){D.writeAsStringSync(A);}}return B;}class j extends YL with vF{final i provider;XT JdB;j(String A,this.provider):super(A){if(A!=null&&provider.Cq!=null){JdB=provider.Cq.sU(A);JdB.i8().then((B){if(B is Map){JB.addAll(B);}});}}void load(Map A){super.load(A);if(A["?permissions"] is List){LI(A["?permissions"]);}}Map GJ(bool C){Map A=super.GJ(C);List B=this.rZ();if(B!=null){A["?permissions"]=B;}return A;}vF qY(String A){if(Z[A] is vF){return Z[A] as vF;}return null;}FB QI(String A,Object B,d C,FB D){var G=super.QI(A,B,C,D);provider.NUB(this);return G;}bool OI(){return false;}}class mC extends j{mC(String A,i B):super(A,B){B.v(A,this);}}class mz extends mC{mz(String A,i B,String C):super(A,B){L[r"$name"]="DSA Version";L[r"$type"]="string";q(C);}}class pz extends mC{pz(String B,i C):super(B,C){L[r"$name"]="Dart Version";L[r"$type"]="string";try {var A=Platform.version;A=A.substring(0,A.indexOf(" "));q(A);}catch (D){q(Platform.version);}}}class rz extends mC{rz(String A,i B,String C):super(A,B){L[r"$name"]="Distribution";L[r"$type"]="string";q(C);}}class sz extends mC{sz(String A,i B):super(A,B){L[r"$name"]="Start Time";L[r"$type"]="time";q(RB.QT());}}class vz extends mC{vz(String A,i B):super(A,B){L[r"$name"]="Clear Conns";L[r"$invokable"]="config";}W invoke(Map B,d C,W A,s D,[int G=f.o]){provider.yPB();return A..close();}}class mb extends j{mb(String B,i A):super(B,A){L[r"$is"]="dsa/broker";if(A!=null){L[r"$uid"]=A.w_;L[r"$brokerUUID"]=A.Kf;}}bool KdB=false;void load(Map D){if(KdB){throw "root node can not be initialized twice";}D.forEach((String A,C){if(A.startsWith(r"$")){L[A]=C;}else if(A.startsWith("@")){JB[A]=C;}else if(C is Map){j B;if(C=="defs"){B=new NW("/${A}",provider);}else{B=new j("/${A}",provider);}B.load(C);provider.m[B.path]=B;Z[A]=B;}});}}class NW extends j{NW(String A,i B):super(A,B){L[r"$hidden"]=true;}Map II(){Map A={r"$hidden":true};if(L.containsKey(r"$is")){A[r"$is"]=L[r"$is"];}if(L.containsKey(r"$type")){A[r"$type"]=L[r"$type"];}if(L.containsKey(r"$name")){A[r"$name"]=L[r"$name"];}if(L.containsKey(r"$invokable")){A[r"$invokable"]=L[r"$invokable"];}if(L.containsKey(r"$writable")){A[r"$writable"]=L[r"$writable"];}return A;}}typedef void fFB(String _0,Object _1);class i extends Kl implements VW{final Map<String,s> m=new Map<String,s>();final Map<String,eD> qG=new Map<String,eD>();Wk aF;cW lC;String downstreamName;String cf;String nN;mb nB;j IG;jQ tJ;j Ba;NW gY;j k_;j KQ;j xP;j cH;bool strictTls=false;Map<String,String> wU=<String,String>{};fFB cs;List LdB;void NE(String B,d C){if(LdB==null){LdB=[''];new Timer(new Duration(milliseconds:10),(){new File('logs/config_change.log').writeAsString(LdB.join('\n'),mode:FileMode.APPEND);LdB=null;});}String D='[${new DateTime.now()}] ';if(C!=null&&C.groups!=null){String A=C.groups.firstWhere((B)=>B.startsWith("user/"),orElse:()=>null);if(A!=null){if(A.length>20){A=A.substring(20);}D+= '${A}, ';}}D+= B;LdB.add(D);}String w_;String Kf;Rk e_;Map Ts={"users":{},"sys":{"tokens":{},"quarantine":{}},"upstream":{}};bool ug=true;bool enabledQuarantine=false;bool enabledDataNodes=false;bool acceptAllConns=true;jz Fh;Sk t_;hQ cF;WT Cq;WT zr;Pk JJ;Tk Df;Uk Zr;Yk Bt;List defaultPermission;i({this.enabledQuarantine: false,this.acceptAllConns: true,this.defaultPermission,this.downstreamName: "conns",cW storage,this.enabledDataNodes: true,this.strictTls: false}){if(storage==null){storage=new Ul("storage");}Cq=storage.Er("brokerAttributes");w_=bHB();File A=new File('.uuid');if(A.existsSync()){Kf=A.readAsStringSync();}else{Kf=new g3().LVB();A.writeAsString(Kf);}this.lC=storage;Fh=new jz();aF=new Wk();t_=new Sk(this);JJ=new Pk(this);nB=new mb("/",this);m["/"]=nB;if(downstreamName==null||downstreamName==""||Ts.containsKey(downstreamName)||downstreamName.contains(NB.Al)){throw "invalid downstreamName";}cf="/${downstreamName}";nN="${cf}/";Ts[downstreamName]={};nB.load(Ts);gY=new NW("/defs",this);nB.sB("defs",gY);IG=m[cf];IG.L[r"$downstream"]=true;nB.L[r"$downstream"]=cf;Ba=m["/users"];tJ=m["/data"];k_=m["/sys"];xP=m["/sys/quarantine"];KQ=m["/upstream"];cH=m["/sys/tokens"];new iz("/sys/query",this);if(defaultPermission!=null){yz(defaultPermission);nB.LI(defaultPermission);}gY.LI([["default","read"]]);k_.LI([[":config","config"],["default","none"]]);xP.LI([[":config","config"],["default","none"]]);aF.nB=nB;new Timer.periodic(new Duration(minutes:30),BQB);}void z_(List A){nB.LI(A);Df.BK(A);cF.Tf.BK(A);Bt.BK(A);}static void yz(List D){Map B={":trustedLink":"config",":user":"read",":config":"config",":write":"write",":read":"read"};for(List G in D){B.forEach((String A,String C){if(G[0]==A){B[A]=null;}});}B.forEach((String A,String C){if(C!=null){D.insert(0,[A,C]);}});}ZSB()async{List<List<LH>> A;if(lC!=null){A=await lC.iSB();}await dSB();Ms(pFB);Ms(vFB);Qr();await bSB();await cr();await Ig();if(enabledDataNodes){await cSB();Ms(xFB);}if(lC!=null){gSB();}if(A!=null){for(List<LH> B in A){if(B.length>0){var C=B[0].lC;String D=C.EQ;if(D!=null&&qG.containsKey(D)){qG[D].pU(this,null).BSB(C,B);}else{C.destroy();}}}}}void Qr(){new mz("/sys/version",this,Oc);new pz("/sys/dartVersion",this);new sz("/sys/startTime",this);new rz("/sys/dist",this,lFB.mFB);new vz("/sys/clearConns",this);new nz("/sys/updatePermissions",this);new hz("/sys/getPermissions",this);Fh.zRB(this);cF=new hQ("/sys/upstream",this);t_.init();e_=new Rk(this);e_.init();Df=new Tk("/sys/quarantine/authorize",this);if(defaultPermission!=null){Df.BK(defaultPermission);}Zr=new Uk("/sys/quarantine/deauthorize",this);Bt=new Yk("/sys/updateGroup",this);new ib("/sys/updateDefaultPermission",this)..Wh(defaultPermission);new qz("/sys/allowAllLinks",this);new tz("/sys/enableQuarantine",this);m["/sys/getIcon"]=new kz("/sys/getIcon",this);}dSB()async{qO G=OB("/defs/profile",false);gY.Z["profile"]=G;UGB.forEach((String A,Map C){String D="/defs/profile/${A}";qO B=OB(D,false);B.load(C);G.Z[A]=B;});hFB.forEach((String A,Map C){String D="/defs/profile/${A}";qO B=OB(D,false);B.load(C);G.Z[A]=B;});File H=new File("defs.json");try {String I=await H.readAsString();Map C=oC.AG(I);C.forEach((String A,Map C){String D="/defs/${A}";qO B=OB(D,false);B.load(C);gY.Z[A]=B;});}catch (J){}}void Ms(Map B){void C(Map B,String D){B.forEach((String G,Object A){if(A is Map){C(A,"${D}${G}/");}else if(A is Ll){(OB("${D}${G}",false) as qO).XUB(A);}});}C(B,"/defs/profile/");}cr()async{File D=new File("usernodes.json");try {String G=await D.readAsString();Map A=oC.AG(G);A.forEach((String B,Map A){String H="/users/${B}";KW C=OB(H,false);C.LI([[B,"config"],["default","none"]]);C.load(A);Ba.Z[B]=C;});}catch (I){}}Future<Map> Q_()async{Map A={};Ba.Z.forEach((String B,YL C){A[B]=C.GJ(true);});if(ug){File D=new File("usernodes.json");await YW(D,oC.qH(A));}return A;}bSB()async{File H=new File("conns.json");try {String I=await H.readAsString();Map C=oC.AG(I);List G=[] ;C.forEach((String B,Map C){String D="${nN}${B}";jH A=OB(D,false);IG.Z[B]=A;eD J=A.MdB;J.BJ=true;IG.gB(B);A.load(C);if(A.L[r"$$dsId"] is String){NdB[A.L[r"$$dsId"]]=D;OdB[D]=A.L[r"$$dsId"];}G.add(B);});Zr.Xh(G);}catch (K){}}gSB()async{WT A=lC.Er("attribute");zr=A;fB.kC("Loading Proxy Attributes");Map D=await A.load();D.forEach((C,G){s B=this.OB(C,false);if(B is zC&&B.MdB.BJ){B.EVB(G);}else{A.sU(C).destroy();}});}cSB()async{fB.kC("Loading Data Nodes");tJ=new jQ("/data",this);if(lC!=null){tJ.PV=lC.Er("data");}tJ.init();nB.Z["data"]=tJ;m["/data"]=tJ;File C=new File("data.json");try {String D=await C.readAsString();Map A=oC.AG(D);A.forEach((String G,Map A){String H="/data/${G}";sD I=OB(H,true);I.load(A);});}catch (M){}if(lC!=null){Map J=await tJ.PV.load();J.forEach((B,K){if(m[B] is sD){m[B].q(K);}else{tJ.PV.sU(B).destroy();}});}}Future<Map> SS()async{Map A={};tJ.Z.forEach((String B,sD C){A[B]=C.GJ(true);});File D=new File("data.json");if(ug){await YW(D,oC.qH(A),verifyJson:true);}return A;}Ig()async{File G=new File("tokens.json");try {String H=await G.readAsString();Map A=oC.AG(H);A.forEach((String D,Map A){String B="/sys/tokens/${D}";TJ C=new TJ(B,this,D);C.load(A);});}catch (I){String B="/sys/tokens/root";TJ C=new TJ(B,this,"root");C.init();}}Future<Map> mg()async{Map A={};cH.Z.forEach((String B,TJ C){A[B]=C.GJ(true);});File D=new File("tokens.json");if(ug){await YW(D,oC.qH(A));}return A;}Future<Map> DL()async{Map A={};List B=[] ;IG.Z.forEach((String C,zC D){B.add(C);eD G=D.MdB;A[C]=G.IE.GJ(false);});File H=new File("conns.json");if(ug){var I=oC.qH(A);await YW(H,I,verifyJson:true);}Zr.Xh(B);Bt.Xh(B);return A;}void Yh(){List A=[] ;xP.Z.forEach((String D,j C){Object B=C.L[r"$$dsId"];if(B is String){A.add(B);}});Df.yUB(A);}void yPB(){List D=IG.Z.keys.toList();for(String B in D){zC G=IG.Z[B];eD A=G.MdB;if(A.FI!=null){String C=OdB[A.path];OdB.remove(A.path);NdB.remove(C);IG.Z.remove(B);A.BJ=false;if(PdB.containsKey(C)){PdB.remove(C).close();}IG.gB(B);}}bC.fD(DL,300);}void CQB(){List G=KQ.Z.keys.toList();for(String A in G){var D=KQ.Z[A];if(D is!zC){continue;}zC H=D;eD B=H.MdB;if(B.FI!=null||!cF.Z.containsKey(A)){String C=OdB[B.path];OdB.remove(B.path);NdB.remove(C);KQ.Z.remove(A);B.BJ=false;if(PdB.containsKey(C)){PdB.remove(C);}KQ.gB(A);}}bC.fD(DL,300);}void v(String A,s B){s G=m[A];if(G!=null){fB.BC("error, BrokerNodeProvider.setNode same node can not be set twice");return;}NB C=new NB(A);s D=m[C.AC];if(D==null){fB.BC("error, BrokerNodeProvider.setNode parentNode is null");return;}m[A]=B;D.sB(C.name,B);}s pB(String A){return m[A];}sD QdB(String B,[bool H=true]){sD A=m[B];if(A==null){A=new sD(B,this);A.L[r"$type"]="dynamic";m[B]=A;}if(H&&A.parent==null){int D=B.lastIndexOf("/");String I=B.substring(0,D);String G=B.substring(D+1);sD C=QdB(I,true);C.Z[G]=A;A.parent=C;C.gB(G);}return A;}s OB(String A,[bool M=true]){if(A.startsWith("/data/")){return QdB(A,M);}s D=m[A];if(D!=null){return D;}if(A.startsWith("/users/")){List G=A.split("/");String J=A.split("/")[2];if(G.length==3){D=new KW(A,J,this);}else{int H=A.indexOf("/#");if(H<0){D=new VK(A,this,J);}else{String C;int K=A.indexOf("/",H+1);if(K<0){C=A;}else{C=A.substring(0,K);}eD B=qG[C];if(B==null){B=new eD(this,C,this);qG[C]=B;m[C]=B.IE;B.IE.DO=OB(A.substring(0,H),false);}D=B.OB(A,false);}}}else if(A.startsWith(nN)){String I=A.split("/")[2];String C="${nN}${I}";eD B=qG[C];if(B==null){B=new eD(this,C,this);qG[C]=B;m[C]=B.IE;B.IE.DO=IG;}D=B.OB(A,false);}else if(A.startsWith("/upstream/")){String N=A.split("/")[2];String C="/upstream/${N}";eD B=qG[C];if(B==null){B=new eD(this,C,this);qG[C]=B;m[C]=B.IE;B.IE.DO=KQ;}D=B.OB(A,false);}else if(A.startsWith("/sys/quarantine/")){List G=A.split("/");if(G.length>3){String I=G[3];String C="/sys/quarantine/${I}";eD B=qG[C];if(B==null){B=new eD(this,C,this);qG[C]=B;m[C]=B.IE;B.IE.DO=xP;bC.fD(Yh,300);}D=B.OB(A,false);}else{D=new j(A,this);}}else if(A.startsWith("/defs/")){D=new qO(A,this);}else{D=new j(A,this);}if(D!=null){m[A]=D;}return D;}bool zPB(j A){if(m[A.path]==A){m.remove(A);}return true;}final Map<String,lM> PdB=new Map<String,lM>();final Map<String,String> NdB=new Map<String,String>();final Map<String,String> OdB=new Map<String,String>();Map<String,lM> get ND=>PdB;String IS(String B,[bool H=false]){if(NdB.containsKey(B)){return NdB[B];}if(B.startsWith("@upstream@")){String I=B.substring(10);String A="/upstream/${I}";OdB[A]=B;NdB[B]=A;return A;}if(B.length<43){String A="${nN}${B}";int J=0;while(OdB.containsKey(A)){A="${nN}${B}-${J++ }";}OdB[A]=B;NdB[B]=A;return A;}else if(acceptAllConns||H){String A;String D=nN;String G=B;int C=43;if(G.length==43)C=42;for(;C>=0; --C){A="${D}${G.substring(0,G.length-C)}";if(C==43&&A.length>8&&A.endsWith("-")){A=A.substring(0,A.length-1);}if(!OdB.containsKey(A)){OdB[A]=B;NdB[B]=A;break;}}bC.fD(DL,300);return A;}else if(enabledQuarantine){String A;String D="/sys/quarantine/";A="${D}${B}";if(!OdB.containsKey(A)){OdB[A]=B;NdB[B]=A;}return A;}else{return null;}}String X8(String B,String G){if(NdB.containsKey(B)){return NdB[B];}if(G!=null&&G!=""){JF C=JJ.rQB(G,B);if(C!=null){j J=C.jRB();String A;String K="${J.path}/";String H=B;int D=43;if(H.length==43)D=42;for(;D>=0; --D){A="${K}${H.substring(0,H.length-D)}";if(D==43&&A.length>8&&A.endsWith("-")){A=A.substring(0,A.length-1);}if(!OdB.containsKey(A)){OdB[A]=B;NdB[B]=A;break;}}if(C.KVB(A)){KB I=OB(A,false);I.L[r"$$token"]=C.id;}if(C.group is String){KB I=OB(A,false);I.L[r"$$group"]=C.group;}bC.fD(DL,300);return A;}}return IS(B);}eD K7(yk K,String B){String C="@upstream@${B}";eD A;if(PdB.containsKey(C)){return null;}else{PdB[C]=K;String D="/upstream/${B}";OdB[D]=C;NdB[C]=D;zC H=OB(D,false);KQ.Z[B]=H;KQ.gB(B);A=H.MdB;A.BJ=true;fB.jB("Link connected at ${D}");}if(!A.BJ){List I=A.path.split("/");String J=I.removeLast();j G=OB(I.join("/"),false);G.Z[J]=A.IE;A.IE.DO=G;A.BJ=true;G.gB(J);bC.fD(DL,300);}return A;}bool MY(mM A){String B=A.vD;if(A.session!=""&&A.session!=null){B="${B} ${A.session}";}String C;if(PdB.containsKey(B)){}else{if(B.length>=43&&(A.session==null||A.session=="")){C=IS(B);if(C!=null){s D=OB(C,false)..L[r"$$dsId"]=B;if(D is jH){D.MdB.FI=null;}fB.jB("Link connected at ${C}");}else{return false;}}PdB[B]=A;}return true;}mM Cr(String D,{String sessionId: ""}){if(sessionId==null)sessionId="";String B=D;if(sessionId!=null&&sessionId!=""){B="${D} ${sessionId}";}else if(PdB[B]!=null){String G=IS(B);if(G==null){return null;}zC J=OB(G,false);eD A=J.MdB;if(!A.BJ){List H=A.path.split("/");String I=H.removeLast();j C=OB(H.join("/"),false);C.Z[I]=A.IE;A.IE.DO=C;A.BJ=true;C.gB(I);if(A.path.startsWith(nN)){bC.fD(DL,300);}else if(A.path.startsWith("/sys/quarantine/")){bC.fD(Yh,300);}}}return PdB[B];}void vr(mM A){if(PdB[A.vD]==A){String B=NdB[A.vD];if(B!=null&&B.startsWith("/sys/quarantine/")){OdB.remove(B);if(NdB[A.vD]==B){NdB.remove(A.vD);}xP.Z.remove(A.vD);qG[B].BJ=false;xP.gB(A.vD);bC.fD(Yh,300);PdB.remove(A.vD);}}}void EJ(lM A,String C,{bool force: false}){if(PdB[C]==A||force){if(A is mM){vr(A);}A.close();PdB.remove(C);if(A is WK&&A.session!=""&&A.session!=null){String D=NdB[A.vD];if(D!=null){eD B=qG[D];if(B!=null){if(B.PM.containsKey(A.session)){B.PM.remove(A.session);}if(A.TM!=null){A.TM=null;}if(A.connection!=null){A.connection=null;}}}}}}void BUB(String A){KB C=m[A];if(C is jH){eD G=C.MdB;m.remove(A);qG.remove(A);String B=OdB[A];if(B!=null){lM H=PdB[B];OdB.remove(A);NdB.remove(B);H.close();PdB.remove(B);bC.fD(DL,300);}String D=C.path.split("/").last;IG.Z.remove(D);G.BJ=false;IG.gB(D);}}void A$(String A,Map B){if(NdB.containsKey(A)){var C=OB(NdB[A],false);C.L[r"$linkData"]=B;}}LC Hr(String B){String A=IS(B);if(A==null)return null;if(qG.containsKey(A)){return qG[A].PB;}zC C=OB(A,false);return C.MdB.PB;}d pU(String D,jF H,[String G="",bool I=false]){String B=IS(D);if(B==null)return null;zC C=OB(B,false);d A=C.MdB.pU(H,D,G);if(B.startsWith("/sys/quarantine/")){A.o7=true;bC.fD(Yh,300);}else if(C.L[r"$$group"] is String){List J=(C.L[r"$$group"] as String).split(",");A.BK(J);}else if(I){A.BK([":trustedLink"]);}if(lC!=null&&G==""&&A.lC==null){A.lC=lC.eRB(B);}return A;}d dY(String A,String B){return new Qk(this,A);}void Vh(String A,dynamic C,dynamic B,d D){if(cs!=null){NE("changes config: ${A}, from: ${C}, to: ${B}",D);cs(A,B);}}Future<ByteData> V8(String A)async{var K=Uri.encodeComponent(A);var B=new File("brokerIcons/${K}");if(await B.exists()){wU.remove(A);return await zQ.cl(await B.readAsBytes());}String H=wU[A];if(H is String){zC C=pB(H);if(C!=null&&C.MdB!=null&&C.MdB.PB!=null){await for(XL I in C.MdB.PB.invoke("/sys/getIcon",{"Icon":A}).timeout(const Duration(seconds:10),onTimeout:(EventSink M){M.close();})){if(I.FF==DC.QD){List<List<dynamic>> J=I.BL;if(J.length==1){List G=J[0];if(G.length==1&&G[0] is ByteData){ByteData D=G[0];if(!(await B.exists())){await B.create(recursive:true);}await B.writeAsBytes(D.buffer.asUint8List(D.offsetInBytes,D.lengthInBytes));wU.remove(A);return D;}}}}}}return null;}void NUB(j A){if(A.JdB!=null){A.JdB.PC(A.JB);}}void BQB([Timer D=null]){qG.forEach((B,eD C){for(String B in C.m.keys.toList()){zC A=C.m[B];if(A.RdB==null&&A.pC.isEmpty&&!(A is jH)){m.remove(A.path);C.m.remove(B);}}});}}class iQ{String group;int cg;bool u8;iQ(this.group,this.cg){u8=(group=='default');}}abstract class vF{List<iQ> NI;vF qY(String A);void OG(Iterator<String> C,List<String> D,List<int> G){if(NI!=null){int M=D.length;for(int A=0;A<M; ++A){iQ H;bool I=false;String N=D[A];for(iQ B in NI){if(B.u8)H=B;if(B.group==N){int J=B.cg;G[A]=J;if(J==f.o){return;}I=true;break;}}if(!I&&H!=null){G[A]=H.cg;}}}if(C.moveNext()){vF K=qY(C.current);if(K!=null){K.OG(C,D,G);}}}void LI(List B){if(B!=null&&B.length>0){if(NI==null){NI=new List<iQ>();}else{NI.clear();}for(var A in B){if(A is List&&A.length==2&&A[0] is String&&A[1] is String){String D=A[0];String G=A[1];int C=f.dI(G);if(C==f.UW){continue;}NI.add(new iQ(D,C));}}if(NI.isEmpty){NI=null;}}else{NI=null;}}List rZ(){if(NI==null){return null;}List A=[] ;if(NI!=null){for(var B in NI){A.add([B.group,f.rk[B.cg]]);}}return A;}}class UL extends vF{Map<String,UL> Z=new Map<String,UL>();vF qY(String A){return Z[A];}void load(Map A){A.forEach((String C,Object B){if(B is Map){Z[C]=new UL()..load(B);}});if(A['?permissions'] is List){LI(A['?permissions']);}}Map GJ(){Map A={};Z.forEach((String C,UL D){A[C]=D.GJ();});List B=this.rZ();if(B!=null){A['?permissions']=B;}return A;}}class Wk implements bW{mb nB;Wk();int OG(String H,d A){if(nB!=null&&nB.NI!=null){List<int> C=new List<int>.filled(A.groups.length,f.TW);var D=H.split('/').iterator;D.moveNext();nB.OG(D,A.groups,C);int B=f.TW;for(int G in C){if(G>B){B=G;}}if(B>A.Kg){return A.Kg;}return B;}return A.Kg;}}Map<String,dynamic> hFB={"broker":{"userNode":{"addChild":{r"$name":"Add Child",r"$invokable":"config",r"$params":[{"name":"Name","type":"string"}]},"removeNode":{r"$name":"Remove",r"$invokable":"config",r"$params":[{"name":"Recursive","type":"bool"}]}},"userRoot":{"addChild":{r"$name":"Add Child",r"$invokable":"config",r"$params":[{"name":"Name","type":"string"}]},"addLink":{r"$name":"Add Link",r"$invokable":"config",r"$params":[{"name":"Name","type":"string"},{"name":"Id","type":"string"}]}},"dataNode":{"addNode":{r"$name":"Add Node",r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}],r"$actionGroup":"Add",r"$actionGroupSubTitle":"Node"},"addValue":{r"$name":"Add Value",r"$invokable":"write",r"$params":[{"name":"Name","type":"string"},{"name":"Type","type":"enum[string,number,bool,array,map,binary,dynamic]"},{"name":"Editor","type":"enum[none,textarea,password,daterange,date]"}],r"$actionGroup":"Add",r"$actionGroupSubTitle":"Value"},"deleteNode":{r"$name":"Delete Node",r"$invokable":"write",r"$params":[{"name":"Recursive","type":"bool"}]},"renameNode":{r"$name":"Rename Node",r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}]},"duplicateNode":{r"$name":"Duplicate Node",r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}]},"exportNode":{r"$name":"Export",r"$invokable":"write",r"$columns":[{"name":"data","type":"string","editor":"textarea"}]},"importNode":{r"$name":"Import",r"$invokable":"write",r"$params":[{"name":"data","type":"string","editor":"textarea"}]}},"dataRoot":{"addNode":{r"$name":"Add Node",r"$invokable":"write",r"$params":[{"name":"Name","type":"string"}],r"$actionGroup":"Add",r"$actionGroupSubTitle":"Node"},"addValue":{r"$name":"Add Value",r"$invokable":"write",r"$params":[{"name":"Name","type":"string"},{"name":"Type","type":"enum[string,number,bool,array,map,binary,dynamic]"},{"name":"Editor","type":"enum[none,textarea,password,daterange,date]"}],r"$actionGroup":"Add",r"$actionGroupSubTitle":"Value"},"publish":{r"$name":"Publish",r"$invokable":"write",r"$params":[{"name":"Path","type":"string"},{"name":"Value","type":"dynamic"},{"name":"Timestamp","type":"string"},{"name":"CloseStream","type":"bool"}]},"exportNode":{r"$name":"Export",r"$invokable":"write",r"$columns":[{"name":"data","type":"string","editor":"textarea"}]},"importNode":{r"$name":"Import",r"$invokable":"write",r"$params":[{"name":"data","type":"string","editor":"textarea"}]}},"token":{"delete":{r"$name":"Delete",r"$invokable":"config",r"$params":[] },"update":{r'$name':'Update Group',r'$invokable':'config',r'$params':[{'name':'Group','type':'string','description':'default permission group'}]}},"tokenGroup":{"add":{r"$name":"Add Token",r"$invokable":"config",r"$params":[{"name":"TimeRange","type":"string","editor":"daterange"},{"name":"Count","type":"number","description":"how many times this token can be used"},{"name":"Managed","type":"bool","description":"when a managed token is deleted, server will delete" " all the dslinks associated with the token"},{"name":"Group","type":"string","description":"default permission group"}],r"$columns":[{"name":"tokenName","type":"string"}]}}}};class ib extends mC{static ib lz;List qE;ib(String A,i B):super(A,B){lz=this;qE=[{"name":"Data","type":"string","editor":"textarea","default":"[\n]"}];L[r"$name"]="Update Default Permission";L[r"$invokable"]="config";L[r'$params']=qE;}void Wh(List B){if(B==null){return;}StringBuffer C=new StringBuffer();C.write('[\n');bool D=true;if(B!=null){bool G=false;for(List A in B){if(A[0]==':config'){G=true;A[1]='config';}if(D){D=false;C.write('  ["${A[0]}","${A[1]}"]');}else{C.write(',\n  ["${A[0]}","${A[1]}"]');}}if(!G){B.insert(0,[':config','config']);Wh(B);return;}}C.write('\n]');qE[0]={"name":"Data","type":"string","editor":"textarea","default":C.toString()};gB(r'$params');}W invoke(Map C,d D,W B,s H,[int I=f.o]){if(C['Data'] is String){String G=C['Data'];List A;try {A=JSON.decode(G);i.yz(A);}catch (J){return B..close(a.SC);}Wh(A);provider.z_(A);provider.Vh("defaultPermission",'',A,D);}else{return B..close(a.SC);}return B..close();}}class qz extends mC{qz(String B,i A):super(B,A){L[r"$name"]="Allow All Links";L[r"$writable"]="config";L[r"$type"]="bool";q(A.acceptAllConns);}FB PC(Object A,d B,FB C,[int D=f.o]){if(A is!bool){return C..close(a.SC);}if(A!=provider.acceptAllConns){provider.Vh("allowAllLinks",provider.acceptAllConns,A,B);provider.acceptAllConns=A;}return super.PC(A,B,C,D);}}class tz extends mC{tz(String B,i A):super(B,A){L[r"$name"]="Enable Quarantine";L[r"$writable"]="config";L[r"$type"]="bool";q(A.enabledQuarantine);}FB PC(Object A,d B,FB C,[int D=f.o]){if(A is!bool){return C..close(a.SC);}if(A!=provider.enabledQuarantine){provider.Vh("quarantine",provider.enabledQuarantine,A,B);provider.enabledQuarantine=A;}return super.PC(A,B,C,D);}}class sD extends j{XT lC;j parent;sD(String B,i A):super(B,A){if(A.tJ!=null&&A.tJ.PV!=null){lC=A.tJ.PV.sU(B);}L[r'$is']='broker/dataNode';mD=A.OB('/defs/profile/broker/dataNode',false);L[r'$writable']='write';}FB PC(Object A,d B,FB C,[int D=f.o]){if(parent==null){provider.OB(path,true);bC.fD((B.EC as i).SS,1000);}if(lC!=null&&(vN==null||vN.value!=A)){lC.PC(A);}return super.PC(A,B,C,D);}void load(Map B){super.load(B);Z.forEach((String C,KB A){if(A is sD){A.parent=this;}});}FB QI(String A,Object B,d D,FB C){if(!JB.containsKey(A)||JB[A]!=B){JB[A]=B;gB(A);OI();}return C..close();}bool OI(){bC.fD(provider.SS,1000);return true;}}class jQ extends sD{WT PV;j parent;jQ(String B,i A):super(B,A){L[r'$is']='broker/dataRoot';L.remove(r'$writable');mD=A.OB('/defs/profile/broker/dataRoot',false);parent=this;}void init(){lC=PV.sU(path);}}W kb(Map D,d I,W G,s B){Object A=D['Name'];Object H=D['Type'];Object J=D['Editor'];if(B is sD&&B.parent!=null&&A is String&&A!=''&&!A.startsWith(r'$')&&!A.startsWith(r'!')){String K=A;A=ZW.aW(A);if(B.Z.containsKey(A)){return G..close(new a('invalidParameter',msg:'node already exist'));}sD C=I.EC.OB('${B.path}/${A}',false);if(H is String&&const['string','number','bool','array','map','binary','dynamic'].contains(H)){C.L[r'$type']=H;if(J is String){C.L[r'$editor']=J;}if(A!=K){C.L[r"$name"]=K;}C.q(null);}B.Z[A]=C;C.parent=B;B.gB(A);bC.fD((I.EC as i).SS,1000);return G..close();}return G..close(a.SC);}W nFB(Map G,d H,W B,s A){Object I=G['Recursive'];if(A is sD&&A is!jQ&&A.parent!=null){if(I==true){nb(A,A.path.substring(A.path.lastIndexOf('/')+1));}else{if(A.Z.isEmpty){sD C=A.parent;String D=A.path.substring(A.path.lastIndexOf('/')+1);A.parent=null;A.JB.clear();if(A.lC!=null){A.lC.destroy();}C.Z.remove(D);C.gB(D);A.ZY();}else{return B..close(a.SC);}}bC.fD((H.EC as i).SS,1000);return B..close();}return B..close(a.SC);}W xz(Map M,d N,W H,s D){try {String O=M["data"];var I=JSON.decode(O);if(I is Map){for(String J in D.Z.keys.toList()){var G=D[J];if(G is sD){nb(G,J);}}D.JB.clear();D.q(null);void K(Map C,s B){for(String A in C.keys){if(A==r"$is"){continue;}else if(A.startsWith(r"$")){B.L[A]=C[A];}else if(A.startsWith(r"@")){B.JB[A]=C[A];}else if(A=="?value"){B.q(C[A]);if(B is sD){if(B.lC!=null){B.lC.PC(C[A]);}}}else if(C[A] is Map){var Q=C[A];var G=(D.provider as i).QdB("${B.path}/${A}");K(Q,G);B.sB(A,G);G.parent=B;}B.QG.add(A);}}K(I,D);bC.fD((N.EC as i).SS,1000);return H..close();}throw new Exception("Invalid JSON Data.");}catch (S,V){return H..close(new a("invokeError",msg:S.toString(),detail:V.toString()));}return H..close();}W B0(Map N,d O,W C,s K){void D(s A,Map<String,dynamic> B){for(String G in A.JB.keys){B[G]=A.AS(G);}for(String H in A.L.keys){B[H]=A.NG(H);}for(String I in A.Z.keys){s J=A.Z[I];if(J.L[r"$is"]=="broker/dataNode"){D(J,B[I]={});}}if(A.value!=null){B["?value"]=A.value;}}var B={};D(K,B);String M=JSON.encode(B);C.TB([[M]]);return C..close();}W sFB(Map G,d H,W C,s A){Object B=G['Name'];var D=B;if(B is String){B=ZW.aW(B);}if(A is sD&&A is!jQ&&A.parent!=null&&B is String&&B!=''&&!A.Z.containsKey(B)){dk(A,A.parent,B);if(D!=B){A.L[r"$name"]=D;}nb(A,A.path.substring(A.path.lastIndexOf('/')+1));bC.fD((H.EC as i).SS,1000);return C..close();}return C..close(a.SC);}W uFB(Map D,d G,W C,s B){Object A=D['Name'];if(A is String){A=ZW.aW(A);}if(B is sD&&B is!jQ&&B.parent!=null&&A is String&&A!=''&&!B.Z.containsKey(A)){dk(B,B.parent,A);bC.fD((G.EC as i).SS,1000);return C..close();}return C..close(a.SC);}sD dk(sD D,sD C,String G){sD A=C.provider.OB('${C.path}/${G}',false);C.Z[G]=A;A.parent=C;D.Z.forEach((B,J){dk(J,A,B);});D.L.forEach((B,H){A.L[B]=H;A.gB(B);});D.JB.forEach((B,H){A.JB[B]=H;A.gB(B);});Object I=D.value;if(I!=null){A.q(I);if(A is sD&&A.lC!=null){A.lC.PC(I);}}C.gB(G);return A;}void nb(sD A,String B){for(String B in A.Z.keys.toList()){nb(A.Z[B],B);}A.JB.clear();if(A.lC!=null){A.lC.destroy();}sD C=A.parent;A.parent=null;C.Z.remove(B);C.gB(B);A.ZY();}W wFB(Map N,d Q,W B,s I){bool J(W S,Map C){Object D=C['Path'];Object K=C['Value'];Object A=C['Timestamp'];Object O=C['CloseStream'];if(O==true){B..close();}if(D is String&&D.startsWith('/data/')){NB G=new NB(D);if(!G.yY||!G.WV){return false;}sD M=(I.provider as i).QdB(G.path);if(A is String&&A.length>22){int H=(A as String).length;if(H>29&&H<35){A='${(A as String).substring(0,23)}${(A as String).substring(H-6)}';}try {DateTime.parse(A);M.q(new RB(K,ts:A));}catch (V){return false;}}M.q(K);return true;}return false;}if(I is jQ&&J(B,N)){B.Ug=J;return B;}return B..close(a.SC);}final Map<String,dynamic> xFB=<String,dynamic>{"broker":{"dataNode":{"addNode":kb,"addValue":kb,"deleteNode":nFB,"renameNode":sFB,"duplicateNode":uFB,"exportNode":B0,"importNode":xz},"dataRoot":{"addNode":kb,"addValue":kb,"publish":wFB,"exportNode":B0,"importNode":xz}}};class kz extends j{kz(String A,i B):super(A,B){L.addAll({r"$name":"Get Icon",r"$invokable":"read",r"$params":[{"name":"Icon","type":"string"}],r"$columns":[{"name":"Data","type":"binary"}]});}W invoke(Map<String,dynamic> C,d G,W A,KB H,[int I=f.o]){String D=C["Icon"];provider.V8(D).then((ByteData B){if(B!=null){A.TB([[B]],columns:[{"name":"Data","type":"binary"}]);}else{return A..close();}}).catchError((J){return A..close();});return A;}}class hz extends mC{hz(String A,i B):super(A,B){L[r"$name"]="Get Permissions";L[r"$invokable"]="read";L[r"$params"]=[{"name":"Path","type":"string"}];L[r"$columns"]=[{"name":"permission","type":"string"}];}W invoke(Map C,d J,W G,s M,[int K=f.o]){if(K==f.o&&C!=null&&C["Path"] is String){String H=C["Path"];int A=provider.aF.OG(H,J);String D;if(A==f.o){s B=provider.OB(H,false);if(B is j){List A=B.rZ();if(A!=null){D=JSON.encode(A);}}else if(B is zC){vF I=B.MdB.IE.Gr(B.WC,false);if(I!=null){List A=I.rZ();if(A!=null){D=JSON.encode(A);}}}}return G..TB([[D]],streamStatus:DC.QD);}return G..close();}Map II(){var A=super.II();A[r"$hidden"]=true;return A;}}class nz extends mC{nz(String A,i B):super(A,B){L[r"$name"]="Update Permissions";L[r"$invokable"]="read";L[r"$params"]=[{"name":"Path","type":"string"},{"name":"Permissions","type":"dynamic","editor":"textarea"}];}W invoke(Map C,d I,W D,s M,[int J=f.o]){if(J==f.o&&C!=null&&C["Path"] is String){List B;if(C["Permissions"] is List){B=C["Permissions"];}else if(C["Permissions"] is String){try {B=JSON.decode(C["Permissions"]);}catch (N){return D..close(a.SC);}}String G=C["Path"];int K=provider.aF.OG(G,I);if(K==f.o){if(G==''||G=='/'){ib.lz.Wh(B);provider.z_(B);provider.Vh("defaultPermission",'',B,I);return D..close();}if(B==null){s A=provider.pB(G);if(A is j){if(!A.OI()){D.close(a.eI);}else{A.LI(null);}}else if(A is zC){vF H=A.MdB.IE.Gr(A.WC,false);if(H!=null){H.LI(null);A.MdB.IE.OI();}}}else{s A=provider.OB(G);if(A is j){if(!A.OI()){D.close(a.eI);}else{A.LI(B);}}else if(A is zC){vF H=A.MdB.IE.Gr(A.WC,true);if(H!=null){H.LI(B);A.MdB.IE.OI();}}}}}return D..close();}Map II(){var A=super.II();A[r"$hidden"]=true;return A;}}class Tk extends mC{List oXB=[] ;List rXB=[] ;List qE;Tk(String A,i B):super(A,B){L[r"$name"]="Authorize";qE=[{"name":"DsId","type":"enum"},{"name":"Group","type":"string"},{"name":"Name","type":"string"}];L[r"$invokable"]="config";L[r"$params"]=qE;}void BK(List B){if(B==null){return;}List A=[] ;for(List C in B){A.add(C[0]);}A.sort();qE[1]={"name":"Group","type":"string","editor":"enum[${A.join(',')}]"};gB(r'$params');}void yUB(List A){A.sort();qE[0]={"name":"DsId","type":"enum[${A.join(',')}]"};gB(r'$params');}W invoke(Map C,d I,W H,s K,[int M=f.o]){if(C['DsId'] is String){String A=C['DsId'];zC J=provider.xP.Z[A];if(J!=null){String D;String B;String G;if(C['Group'] is String){D=C['Group'];}if(C['Name'] is String){B=C['Name'];}if(B!=null&&B!=''){if(provider.xP.Z.containsKey(B)){return H..close(new a("invalidParameter",msg:"name already exists"));}}if(provider.PdB.containsKey(A)){provider.EJ(provider.PdB[A],A);}if(B!=null&&B!=''){G=provider.nN+B;provider.OdB[G]=A;provider.NdB[A]=G;}else{provider.NdB.remove(A);G=provider.IS(A,true);}if(D!=null&&D!=''){provider.OB(G,false).L[r'$$group']=D;}provider.NE('authorize dsId ${A} with group:${D}',I);}}else{return H..close(a.SC);}return H..close();}}class Uk extends mC{List qE;Uk(String A,i B):super(A,B){L[r"$name"]="Deauthorize";L[r"$invokable"]="config";qE=[{"name":"Name","type":"enum"}];L[r'$params']=qE;}void Xh(List A){qE[0]={"name":"Name","type":"enum[${A.join(',')}]"};gB(r'$params');}W invoke(Map D,d I,W G,s J,[int K=f.o]){if(D['Name'] is String){String B=D['Name'];zC H=provider.IG.Z[B];if(H!=null){eD C=H.MdB;String A=provider.OdB[C.path];if(provider.PdB.containsKey(A)){provider.EJ(provider.PdB[A],A);}provider.OdB.remove(C.path);provider.NdB.remove(A);provider.IG.Z.remove(B);C.BJ=false;provider.IG.gB(B);provider.NE('kick dslink ${A} ${B}',I);bC.fD(provider.DL,300);}}else{return G..close(a.SC);}return G..close();}}class Yk extends mC{List qE;Yk(String A,i B):super(A,B){L[r"$name"]="Update Permission Group";L[r"$invokable"]="config";qE=[{"name":"Name","type":"enum"},{"name":"Group","type":"group"}];L[r"$params"]=qE;}void Xh(List A){qE[0]={"name":"Name","type":"enum[${A.join(',')}]"};gB(r'$params');}void BK(List B){if(B==null){return;}List A=[] ;for(List C in B){A.add(C[0]);}A.sort();qE[1]={"name":"Group","type":"string","editor":"enum[${A.join(',')}]"};gB(r'$params');}W invoke(Map A,d I,W D,s J,[int K=f.o]){if(A['Name'] is String){String H=A['Name'];zC B=provider.IG.Z[H];if(B!=null){String G;if(A['Group'] is String){G=A['Group'];}B.L[r'$$group']=G;String C=provider.OdB[B.path];if(provider.PdB.containsKey(C)){provider.EJ(provider.PdB[C],C);}bC.fD(provider.DL,300);}}else{return D..close(a.SC);}return D..close();}}class iz extends mC{RT SdB;iz(String B,i A):super(B,A){SdB=new RT(A);L[r"$name"]="Query";L[r"$invokable"]="write";L[r"$result"]="stream";L[r"$params"]=[{"name":"query","type":"string","editor":"textarea"}];}W invoke(Map D,d G,W C,KB H,[int I=f.o]){Object A=D["query"];iF B;if(A is String){B=SdB.fTB(A);}if(A is List){B=SdB.t9(A);}if(B==null){return C..close(a.SC);}B.AI(C);return C;}}class eD implements jF,qQ{final Map<String,zC> m=new Map<String,zC>();final String path;final i vK;LC PB;jH IE;bool BJ=false;String FI=RB.QT();eD(this.vK,this.path,Kl B,[Map A]){PB=new hb(this,path);IE=new jH(path,'/',this);m['/']=IE;if(A!=null){IE.load(A);}}Map<String,d> PM;d pU(jF D,String B,[String A='']){if(PM==null){PM={};}if(PM.containsKey(A)){return PM[A]..DQ=B;}else{var C=D.dY(B,A);C.DQ=B;PM[A]=C;return C;}}s pB(String B){String A=B.replaceFirst(path,'');if(A==''){A='/';}return m[A];}s OB(String C,[bool D=true]){if(D==true){throw 'not supported';}String A=C.replaceFirst(path,'');if(A==''){A='/';}zC B=m[A];if(B==null){B=new zC(C,vK,A,this);m[A]=B;}return B;}s operator[](String A){return pB(A);}nC CM(String A){String C=path+A;if(A==''){A='/';}zC B=m[A];if(B==null){B=new zC(C,vK,A,this);m[A]=B;}return B;}KB T8(String A,String C){if(yb.Ac.containsKey(C)){return yb.Ac[C];}if(A.startsWith('/defs/')&&vK.m.containsKey(A)){s B=vK.m[A];if(B is YL&&B.L9){return B;}}return CM(A);}nC Zh(nC A,String C,Map G){String B;if(A.WC=='/'){B='/${C}';}else{B='${A.WC}/${C}';}if(A is zC){zC D=A.MdB.CM(B);D.UV(G,this);return D;}return null;}s operator~()=>this['/'];bW get aF=>vK.aF;d dY(String A,String B){throw 'not implemented';}void clear(){m.clear();}}class zC extends nC implements s{final i provider;oM Pq(LC A){return new C0(this,A);}YK<String> TdB;YK<String> get QG{if(TdB==null){TdB=new YK<String>(NS,Pg);}return TdB;}Stream<String> get br=>QG.stream;StreamSubscription RdB;void NS(){if(RdB==null){RdB=MdB.PB.list(WC).listen(UdB);}}void Pg(){if(RdB!=null){RdB.cancel();RdB=null;Z.clear();}VdB=false;}void UdB(mH A){for(var B in A.wC){QG.add(B);}VdB=true;}Map<Function,int> pC=new Map<Function,int>();int FS=-1;void IVB(){int A=0;pC.forEach((C,B){if(B>A){A=B;}});if(A!=FS){FS=A;MdB.PB.TG(WC,q,FS);}}pM TG(B(ValueUpdate),[int A=0]){pC[B]=A;var C=new pM(this,B);if(fh){B(WdB);}if(A>FS){FS=A;MdB.PB.TG(WC,q,A);}return C;}void GL(A(ValueUpdate)){int B=-1;if(pC.containsKey(A)){B=pC[A];pC.remove(A);}if(pC.isEmpty){MdB.PB.GL(WC,q);XdB=false;FS=-1;}else if(B==FS){IVB();}}RB WdB;RB get vN{return WdB;}dynamic get value{if(WdB!=null){return WdB.value;}return null;}void q(Object A,{bool force: false}){if(A is RB){WdB=A;pC.forEach((B,C){B(WdB);});}else if(WdB==null||WdB.value!=A||force){WdB=new RB(A);pC.forEach((B,C){B(WdB);});}XdB=true;}void ZY(){XdB=false;WdB=null;}final String path;eD MdB;zC(this.path,this.provider,String A,this.MdB):super(A){}bool VdB=false;bool get H9=>VdB;String get FI=>MdB.FI;List Br(){return [[r'$disconnectedTs',FI]];}bool XdB=false;bool get fh=>XdB;bool get exists=>true;W invoke(Map C,d H,W A,s I,[int D=f.o]){if(MdB.FI!=null){return A..close(a.U0);}StreamSubscription G=MdB.PB.invoke(WC,C,D).listen((XL B){if(B.error!=null){A.close(B.error);}else{A.TB(B.dS,streamStatus:B.FF,columns:B.F_,meta:B.meta);}},onDone:(){A.close();});A.Ug=(W J,Map K){};A.ZF=(W M){G.cancel();};return A;}KB HI(String A){return MdB.OB('${path}/${A}',false);}int rf(){return f.dI(NG(r'$invokable'),f.tb);}int g8(){return f.dI(NG(r'$writable'),f.lQ);}FB Os(String B,d G,FB A){if(!MdB.IE.r8){p9(B,value,true);return A..close();}String C;if(WC=='/'){C='/${B}';}else{C='${WC}/${B}';}MdB.PB.remove(C).then((H){A.close();}).catchError((D){if(D is a){A.close(D);}else{A.close(new a('internalError',detail:'${D}'));}});return A;}FB QS(String D,d G,FB A){String B;if(WC=='/'){B='/${D}';}else{B='${WC}/${D}';}MdB.PB.remove(B).then((H){A.close();}).catchError((C){if(C is a){A.close(C);}else{A.close(new a('internalError',detail:'${C}'));}});return A;}FB QI(String C,Object B,d H,FB A){if(!MdB.IE.r8||(B is Map&&B['@']!=null)){p9(C,B,false);return A..close();}String D;if(WC=='/'){D='/${C}';}else{D='${WC}/${C}';}MdB.PB.set(D,B).then((I){A.close();}).catchError((G){if(G is a){A.close(G);}else{A.close(new a('internalError',detail:'${G}'));}});return A;}FB NO(String D,Object G,d H,FB A){String B;if(WC=='/'){B='/${D}';}else{B='${WC}/${D}';}MdB.PB.set(B,G).then((I){A.close();}).catchError((C){if(C is a){A.close(C);}else{A.close(new a('internalError',detail:'${C}'));}});return A;}FB PC(Object C,d H,FB A,[int D=f.o]){MdB.PB.set(WC,C,D).then((G){A.close(G.error);}).catchError((B){if(B is a){A.close(B);}else{A.close(new a('internalError',detail:'${B}'));}});return A;}Map YdB;void UV(Map A,qQ B){YdB=A;super.UV(A,B);}Map II(){Map B=super.II();if(YdB!=null){YdB.forEach((String A,C){if(A.startsWith(r'$')){B[A]=this.L[A];}});}return B;}bool get hasSubscriber{return pC.isNotEmpty;}operator[](String A){return get(A);}operator[]=(String A,Object B){if(A.startsWith(r"$")){L[A]=B;}else if(A.startsWith(r"@")){JB[A]=B;}else if(B is KB){sB(A,B);}}XT ZdB;Map MI={};Map iY={};Object Fr(String A){return MI[A];}void p9(String A,Object B,bool C){if(!C&&B is Map&&B['@']=='clear'){C=true;}if(ZdB==null&&provider.zr!=null){ZdB=provider.zr.sU(path);}if(C){if(MI.containsKey(A)){MI.remove(A);if(MI.containsKey(A)){JB[A]=MI[A];}else{JB.remove(A);}if(ZdB!=null){if(MI.isEmpty){ZdB.destroy();}else{ZdB.PC(MI);}}QG.add(A);}}else if(B!=MI[A]){MI[A]=B;JB[A]=B;if(ZdB!=null){ZdB.PC(MI);}QG.add(A);}}bool r7(String A,Object B,bool C){if(C){if(iY.containsKey(A)){iY.remove(A);if(!MI.containsKey(A)){JB.remove(A);return true;}}}else if(iY[A]!=B){iY[A]==B;if(!MI.containsKey(A)){JB[A]=B;return true;}}return false;}void EVB(Map A){if(A==null)return;MI=A;A.forEach((B,C){JB[B]=C;});}void mZ(){L.clear();JB.clear();iY.clear();Z.clear();MI.forEach((A,B){JB[A]=B;});}void q9(YK<String> A){TdB=A;}void load(Map<String,dynamic> A){}}class C0 extends oM{C0(nC A,LC B):super(A,B);void xJ(String M,List H,List N,Map O,a Q){bool I=false;if(H!=null){for(Object B in H){String A;Object C;bool D=false;if(B is Map){if(B['name'] is String){A=B['name'];}else{continue;}if(B['change']=='remove'){D=true;}else{C=B['value'];}}else if(B is List){if(B.length>0&&B[0] is String){A=B[0];if(B.length>1){C=B[1];}}else{continue;}}else{continue;}if(A.startsWith(r'$')){if(!I&&(A==r'$is'||A==r'$base'||(A==r'$disconnectedTs'&&C is String))){I=true;e.mZ();}if(A==r'$base'&&C is String){C=(e as zC).MdB.path+C;}if(A==r'$is'&&!e.L.containsKey(r'$base')){e.L[r'$base']=(e as zC).MdB.path;wC.add(r'$base');}wC.add(A);if(D){e.L.remove(A);}else{e.L[A]=C;}}else if(A.startsWith('@')){if(D){if((e as zC).r7(A,null,true)){wC.add(A);}}else{if((e as zC).r7(A,C,false)){wC.add(A);}}}else{wC.add(A);if(D){e.Z.remove(A);}else if(C is Map){e.Z[A]=PB.BO.Zh(e,A,C);}}if(e.JB["@icon"] is String){String G=e.JB["@icon"];if(!(G.startsWith("http:")||G.startsWith("https:"))){hb J=PB;i K=J.MdB.vK;K.wU[G]=J.MdB.path;}}}if(request.FF!=DC.nM){e.HZ=true;}Sg();}}}class hb extends LC implements Nl{final eD MdB;String EQ;hb(eD A,this.EQ):super(A),MdB=A;void DJ(){MdB.FI=RB.QT();super.DJ();}void JM(){MdB.FI=null;super.JM();}}const List<String> gFB=const[r"$uid",r"$brokerUUID"];class jH extends zC with vF implements j{jH(String B,String C,eD A):super(B,A.vK,C,A);bool get L9=>true;bool get r8{return L[r'$is']=='dsa/broker';}s DO;oM Pq(LC A){return new wz(this,A);}FB NO(String A,Object B,d C,FB D){var G=VT.Ec(A,mD);return D..close(G.NO(B,this,C));}FB QS(String A,d B,FB C){var D=VT.Ec(A,mD);return C..close(D.QS(this,B));}void load(Map C){C.forEach((String A,Object B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){JB[A]=B;}else if(B is Map){ag[A]=new UL()..load(B);}});if(C['?permissions'] is List){LI(C['?permissions']);}}Map GJ(bool G){Map A={};L.forEach((String B,Object C){A[B]=C;});JB.forEach((String B,Object C){A[B]=C;});ag.forEach((String B,UL C){A[B]=C.GJ();});List D=this.rZ();if(D!=null){A['?permissions']=D;}return A;}void gB(String A,[int B=f.tb]){QG.add(A);}List Br(){List A=[[r'$disconnectedTs',FI]];if(L.containsKey(r'$$group')){A.add([r'$$group',L[r'$$group']]);}return A;}void mZ(){Z.clear();L.remove(r'$disconnectedTs');}Map<String,UL> ag=new Map<String,UL>();vF qY(String A){return ag[A];}vF Gr(String A,bool B){if(A=='/'){return this;}List C=A.split('/');return uz(this,C,1,B);}static vF uz(vF A,List D,int G,bool H){if(G>=D.length){return A;}String C=D[G];vF B;if(C==''){B=A;}else{B=A.qY(C);if(B==null){if(H){B=new UL();if(A is jH){A.ag[C]=B;}else if(A is UL){A.Z[C]=B;}else{return null;}}else{return null;}}}return uz(B,D,G+1,H);}Map II(){Map A=super.II();if(L.containsKey(r'$linkData')){A[r'$linkData']=L[r'$linkData'];}return A;}bool OI(){bC.gl(provider.DL,3000);return true;}XT JdB=null;}class wz extends oM{wz(nC A,LC B):super(A,B);void xJ(String N,List H,List O,Map Q,a S){bool I=false;if(H!=null){for(Object B in H){String A;Object C;bool G=false;if(B is Map){if(B['name'] is String){A=B['name'];}else{continue;}if(B['change']=='remove'){G=true;}else{C=B['value'];}}else if(B is List){if(B.length>0&&B[0] is String){A=B[0];if(B.length>1){C=B[1];}}else{continue;}}else{continue;}if(gFB.contains(A)&&(A.startsWith(r"$")||A.startsWith("@"))){Map J=A.startsWith(r"$")?e.L:e.JB;if(G){J.remove(A);}else{J[A]=C;}wC.add(A);}if(A.startsWith(r'$')){if(!I&&(A==r'$is'||A==r'$base'||(A==r'$disconnectedTs'&&C is String))){if(A==r'$is'){if(C=='dsa/broker'){e.L[r'$is']='dsa/broker';}else{e.L[r'$is']='dsa/link';}}I=true;e.mZ();wC.add(A);}else if(A.startsWith(r'$link_')){e.L[A]=C;wC.add(A);}}else if(A.startsWith('@')){e.JB[A]=C;wC.add(A);if(e.JB["@icon"] is String){String D=e.JB["@icon"];if(!(D.startsWith("http:")||D.startsWith("https:"))){hb K=PB;i M=K.MdB.vK;if(M.wU[D] is!String){M.wU[D]=K.MdB.path;}}}}else{wC.add(A);if(G){e.Z.remove(A);}else if(C is Map){e.Z[A]=PB.BO.Zh(e,A,C);}}}if(request.FF!=DC.nM){e.HZ=true;}Sg();}}}class Qk extends d{Qk(jF A,String B):super(A,B);void invoke(Map A){NB B=NB.wb(A['path']);if(B!=null&&B.isAbsolute){int K=A['rid'];s D=EC.OB(B.AC,false);s C;bool I=false;if(B.name=='getHistory'&&D.Fr('@@getHistory') is Map){Map A=D.Fr('@@getHistory');if(A['val'] is List&&(A['val'] as List).length>0){String B=A['val'][0];C=EC.OB(B,false);I=true;}else{C=D.HI(B.name);}}else{C=D.HI(B.name);}if(C==null){ID(A['rid'],error:a.eI);return;}int G=EC.aF.OG(B.path,this);int J=f.dI(A['permit']);if(J<G){G=J;}if(I){int H=EC.aF.OG(C.path,this);if(H<H){G=H;}}if(C.rf()<=G){C.invoke(A['params'],this,AI(new W(this,K,D,C,B.name),B,A['params']),D,G);}else{ID(A['rid'],error:a.eI);}}else{ID(A['rid'],error:a.WW);}}}class Rk{final i provider;Rk(this.provider);LW Wg;LW xe;Rc fg;void init(){LW B(String C,String D){var A=new LW("/sys/${D}",provider);A.L.addAll({r"$name":C,r"$type":"number"});provider.v(A.path,A);return A;}Wg=B("Open Requests","openRequestsCount");xe=B("Active Subscriptions","activeSubscriptionsCount");start();}void start(){fg=H1.I1(bT.ZHB,(){GVB();});}void GVB(){if(Wg!=null&&Wg.hasSubscriber){var A=provider.ND.values.fold(0,(int B,lM C)=>B+C.OC.STB);Wg.q(A);}if(xe!=null&&xe.hasSubscriber){var A=provider.ND.values.fold(0,(int B,lM C)=>B+C.OC.j_);xe.q(A);}}void stop(){if(fg!=null){fg.af();fg=null;}}}class LW extends j{LW(String A,i B):super(A,B);}class jz{aI lr;aI Wq;aI I8;aI kr;aI Vq;aI H8;void zRB(jF A){lr=new aI("/sys/messagesOutPerSecond",A)..L[r"$type"]="number";kr=new aI("/sys/messagesInPerSecond",A)..L[r"$type"]="number";I8=new aI("/sys/frameOutPerSecond",A)..L[r"$type"]="number";H8=new aI("/sys/frameInPerSecond",A)..L[r"$type"]="number";Wq=new aI("/sys/dataOutPerSecond",A)..L[r"$type"]="number"..L[r"@unit"]="bytes";Vq=new aI("/sys/dataInPerSecond",A)..L[r"$type"]="number"..L[r"@unit"]="bytes";}Timer adB;void tPB(Timer A){kr.q(RD.sM,force:true);Vq.q(RD.gW,force:true);lr.q(RD.wQ,force:true);Wq.q(RD.hW,force:true);H8.q(RD.Jc,force:true);I8.q(RD.Kc,force:true);RD.sM=0;RD.gW=0;RD.Jc=0;RD.wQ=0;RD.hW=0;RD.Kc=0;}void set FL(bool A){if(A==RD.MH){return;}if(A){RD.MH=true;if(adB==null){RD.sM=0;RD.gW=0;RD.wQ=0;RD.hW=0;RD.Kc=0;RD.Jc=0;adB=new Timer.periodic(const Duration(seconds:1),tPB);}}else{RD.MH=lr.FL||Wq.FL||kr.FL||Vq.FL;if(!RD.MH&&adB!=null){adB.cancel();adB=null;}}}}class aI extends mC{aI(String A,i B):super(A,B);bool FL=false;pM TG(A(RB update),[int B=0]){if(!FL){FL=true;provider.Fh.FL=true;}return super.TG(A,B);}void GL(A(RB update)){super.GL(A);if(FL&&pC.isEmpty){FL=false;provider.Fh.FL=false;}}}class Pk{final i vK;Pk(this.vK);Map<String,JF> cH=new Map<String,JF>();Map<String,JF> bdB={};Map<String,JF> get xZ=>bdB;JF LQB(String B,i G){if(bdB.containsKey(B)){return bdB[B];}String C=gr();String D=C.substring(0,16);JF A=new JF(null,G,null,D);A.L[r'$$token']=C;A.init();cH[D]=A;bdB[B]=A;return A;}String gr(){List<int> C=new List<int>(48);int B=0;while(B<48){int A=rM.vQ.KS();if((A>=0x30&&A<=0x39)||(A>=0x41&&A<=0x5A)||(A>=0x61&&A<=0x7A)){C[B]=A;B++ ;}}String D=new String.fromCharCodes(C);String G=D.substring(0,16);if(cH.containsKey(G)){return gr();}return D;}JF rQB(String B,String G){if(B.length<16){return null;}String C=B.substring(0,16);String H=B.substring(16);if(!cH.containsKey(C)){return null;}JF A=cH[C];if(A.token==null||A.count==0){return null;}if(A.Oh>=0&&A.aS>=0){int D=new DateTime.now().millisecondsSinceEpoch;if(D<A.Oh||D>=A.aS){return null;}}String I=Ic.r0(const Utf8Encoder().convert('${G}${A.token}'));if(I==H){return A;}return null;}}class TJ extends mC{String j8;TJ(String B,i A,this.j8):super(B,A){L[r'$is']='broker/tokenGroup';mD=A.OB('/defs/profile/broker/tokenGroup',false);}void init(){}bool KdB=false;void load(Map D){if(KdB){L.clear();JB.clear();Z.clear();}D.forEach((String A,B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){JB[A]=B;}else if(B is Map){JF C=new JF('${path}/${A}',provider,this,A);provider.JJ.cH[A]=C;C.load(B);Z[A]=C;}});KdB=true;}}class JF extends j{int Oh=-1;int aS=-1;int count=-1;Timer ps;bool hr=false;List ND;TJ parent;String id;String token;String group;JF(String A,i B,this.parent,this.id):super(A,B){L[r'$is']='broker/token';mD=B.OB('/defs/profile/broker/token',false);if(A!=null){B.v(A,this);}}void load(Map A){super.load(A);init();}void init(){if(L[r'$$timeRange'] is String){String C=L[r'$$timeRange'];List A=C.split('/');if(A.length==2){try {Oh=DateTime.parse(A[0]).millisecondsSinceEpoch;aS=DateTime.parse(A[1]).millisecondsSinceEpoch;}catch (D){Oh=-1;aS=-1;}if(aS>-1){int B=new DateTime.now().millisecondsSinceEpoch;if(B<aS){ps=new Timer(new Duration(milliseconds:aS-B),delete);}else{bC.tO(delete);}}}}if(L[r'$$count'] is num){count=(L[r'$$count'] as num).toInt();}if(L[r'$$managed']==true){hr=true;if(L[r'$$links'] is List){ND=L[r'$$links'];}}if(L[r'$$token'] is String){token=L[r'$$token'];}if(L[r'$$group'] is String){group=L[r'$$group'];}}j jRB(){return provider.IG;}bool KVB(String A){if(count>0||hr){bC.fD(provider.mg,1000);}if(count>0){count-- ;L[r'$$count']=count;gB(r'$$count');}if(hr){if(ND==null){ND=[] ;L[r'$$links']=ND;}if(!ND.contains(A)){ND.add(A);}gB(r'$$links');return true;}return false;}void delete(){WQB();parent.Z.remove(id);provider.JJ.cH.remove(id);parent.gB(id);provider.zPB(this);bC.fD(provider.mg,1000);}void WQB(){if(ND!=null){for(Object B in ND){if(B is String){Object A=provider.pB(B);if(A is jH){Object C=A.L[r'$$token'];if(C==id){provider.BUB(A.path);}}}}}ND=null;}void Aa(){if(ND==null)return;var B=false;for(Object C in ND){if(C is!String)continue;Object A=provider.pB(C as String);if(A is!jH)continue;(A as jH).L[r'$$group']=group;(A as jH).gB(r'$$group');B=true;}if(B){bC.fD(provider.DL,300);}}}W qFB(Map D,d C,W B,s A){if(A is JF){A.delete();A.provider.NE('delete token: ${A.token}',C);return B..close();}return B..close(a.SC);}W rFB(Map H,d D,W B,s G){if(G is!JF){return B..close(a.SC);}var A=H['Group'] as String;if(A==null||A.isEmpty){return B..close(a.SC);}var C=G as JF;C..L[r'$$group']=A..group=A..gB(r'$$group')..Aa();bC.fD((D.EC as i).mg,1000);C.provider.NE('updated token: ${C.token} to group: ${A}',D);return B..close();}W tFB(Map C,d I,W H,s B){if(C==null){C={};}if(B is TJ){String G=B.provider.JJ.gr();String D=G.substring(0,16);JF A=new JF('${B.path}/${D}',B.provider,B,D);A.L[r'$$timeRange']=C['TimeRange'];A.L[r'$$count']=C['Count'];A.L[r'$$managed']=C['Managed'];A.L[r'$$group']=C['Group'];A.L[r'$$token']=G;A.init();B.provider.JJ.cH[D]=A;B.Z[D]=A;B.gB(D);H.TB([[G]],streamStatus:DC.QD);bC.fD((I.EC as i).mg,1000);A.provider.NE('add new token: ${G}',I);return H;}return H..close(a.SC);}final Map<String,dynamic> vFB=<String,dynamic>{"broker":{"token":{"delete":qFB,"update":rFB},"tokenGroup":{"add":tFB}}};class Sk extends NW{void init(){provider.v("/sys/trace",this);provider.v("/sys/trace/traceRequester",ws);provider.v("/sys/trace/traceConnection",vs);}Sk(i A):super("/sys/trace",A){ws=new lb(A);vs=new Xk(A);Z["traceRequester"]=ws;Z["traceConnection"]=vs;}lb ws;Xk vs;}class jb{final String path;final String TUB;final lb e;final d OC;jb(this.path,this.TUB,this.e,this.OC){OC.rp(PTB);FJ=[] ;}Map<String,jE> Eq=new Map<String,jE>();Map<int,jE> Dq=new Map<int,jE>();List<W> FJ;void destroy(){e.cdB.remove(path);}void PTB(jE A){if(A==null)return;if(A.wI=="+"){if(A.type=="subscribe"){Eq[A.path]=A;}else{Dq[A.OE]=A;}}else if(A.wI=="-"){if(A.type=="subscribe"){Eq.remove(A.path);}else{Dq.remove(A.OE);}}if(FJ!=null){for(W B in FJ){B.TB([A.Us]);}}}void add(W A){FJ.add(A);A.ZF=remove;A.TB(Eq.values.map((B)=>B.Us).toList());A.TB(Dq.values.map((B)=>B.Us).toList());}void remove(W A){FJ.remove(A);if(FJ.isEmpty){destroy();}}}class lb extends j{lb(i A):super("/sys/trace/traceRequester",A){L[r"$invokable"]="config";L[r"$result"]="stream";L[r"$params"]=[{"name":"requester","type":"string","placeholder":"full path to the requester dslink"},{"name":"sessionId","type":"string"}];L[r"$columns"]=[{"name":"path","type":"string"},{"name":"type","type":"string"},{"name":"rid","type":"number"},{"name":"action","type":"string"},{"name":"change","type":"string"}];}Map<String,jb> cdB=new Map<String,jb>();W invoke(Map G,d H,W D,s I,[int J=f.o]){Object A=G["requester"];Object B=G["sessionId"];if(B==null)B="";KB C=provider.OB(A,false);if(A is String&&B is String&&C is jH){if(C.MdB.PM!=null&&C.MdB.PM.containsKey(B)){if(!cdB.containsKey(A)){cdB[A]=new jb(A,B,this,C.MdB.PM[B]);}cdB[A].add(D);return D;}}return D..close(a.SC);}}class Xk extends j{Xk(i A):super("/sys/trace/traceConnection",A){L[r"$invokable"]="config";}}class hQ extends mC{Vk Tf;hQ(String B,i A):super(B,A){new Future((){Tf=new Vk("/sys/upstream/add_connection",A);A.v("/sys/upstream/add_connection",Tf);Tf.BK(A.defaultPermission);});}void sp(String A,String D,String G,String H,String I,[bool B=true]){if(B==null){B=true;}var C=new bI("/sys/upstream/${A}",A,D,G,H,I,provider);provider.v("/sys/upstream/${A}",C);(provider.OB("/sys/upstream",false) as j).gB(A);C.enabled=B;C.start();}void sSB(String B,String C){j A=provider.OB("/sys/upstream/${B}",false);if(A is bI){bool D=A.enabled;I_(B);sp(C,A.QE,A.FV,A.token,A.group,D);}}void I_(String A){s B=provider.OB("/sys/upstream/${A}",false);if(B is bI){B.stop();B.n_=true;Z.remove(A);var C="/sys/upstream/${A}/";provider.m.remove(C.substring(0,C.length-1));List<String> D=provider.m.keys.where((G)=>G.startsWith(C)).toList();D.forEach(provider.m.remove);gB(A);provider.CQB();}}void aSB(Map B){for(var C in B.keys){var A=B[C];sp(C,A["url"],A["name"],A["token"],A["group"],A["enabled"]);}}Map S8(){List<bI> C=provider.m.keys.where((A){try {if(A.startsWith("/sys/upstream/")&&A!="/sys/upstream/add_connection"){return A.codeUnits.where((D)=>D=="/".codeUnitAt(0)).length==3;}else{return false;}}catch (G){return false;}}).map((A)=>provider.OB(A,false)).where((A)=>A!=null).where((A)=>A is bI).where((bI A)=>!A.n_).toList();var B={};C.forEach((A){B[A.name]={"name":A.FV,"url":A.QE,"enabled":A.enabled,"token":A.token,"group":A.group};});return B;}void update(){if(xJ!=null){xJ(S8());}}Function xJ;}class Vk extends j{List qE;Vk(String A,i B):super(A,B){L[r"$name"]="Add Upstream Connection";L[r"$invokable"]="write";qE=[{"name":"Name","type":"string","description":"Upstream Broker Name","placeholder":"UpstreamBroker"},{"name":"Url","type":"string","description":"Url to the Upstream Broker","placeholder":"http://upstream.broker.com/conn"},{"name":"Broker Name","type":"string","description":"The name of the link when connected to the Upstream Broker","placeholder":"ThisBroker"},{"name":"Token","type":"string","description":"Broker Token (if needed)","placeholder":"OptionalAuthToken"},{"name":"Group","type":"string"}];L[r"$params"]=qE;L[r"$result"]="values";}void BK(List B){if(B==null){return;}List A=[] ;for(List C in B){A.add(C[0]);}A.sort();qE[4]={"name":"Group","type":"string","editor":"enum[${A.join(',')}]"};gB(r'$params');}W invoke(Map A,d H,W D,KB Q,[int S=f.o]){var G=A["Name"];var I=A["Broker Name"];var B=A["Url"];var J=A["Token"];var K=A["Group"];try {Uri.parse(B);}catch (M,N){var C=a.Cl;C.msg=M.toString();C.detail=N.toString();return D..close(C);}hQ O=provider.OB("/sys/upstream",false) as hQ;O.sp(G,B,I,J,K);provider.cF.update();provider.NE('add upstream ${B} ${G}',H);return D..close();}}class zz extends j{final String name;zz(String A,this.name,i B):super(A,B){L[r"$name"]="Remove";L[r"$invokable"]="write";L[r"$result"]="values";}W invoke(Map D,d A,W B,KB G,[int H=f.o]){var C=provider.OB("/sys/upstream",false) as hQ;C.I_(name);provider.cF.update();provider.NE('delete upstream ${name}',A);return B..close();}}class Zk extends j{Zk(String A,i B):super(A,B);FB PC(Object B,d G,FB C,[int H=f.o]){if(B!=null&&B.toString().length>0){var I=new NB(path).AC;bI A=provider.OB(I,false);try {Uri.parse(B.toString());}catch (J,K){var D=a.Cl;D.msg=J.toString();D.detail=K.toString();return C..close(D);}A.provider.EJ(A.JD,"@upstream@${A.name}",force:true);A.stop();A.QE=B.toString();A.enabled=true;A.start();provider.cF.update();return super.PC(B,G,C,H);}return C..close();}}class ak extends j{ak(String A,i B):super(A,B);FB PC(Object B,d D,FB C,[int G=f.o]){if(B!=null&&B.toString().length>0){var H=new NB(path).AC;bI A=provider.OB(H,false);A.provider.EJ(A.JD,"@upstream@${A.name}",force:true);A.stop();A.FV=B.toString();A.enabled=true;A.start();provider.cF.update();return super.PC(B,D,C,G);}return C..close();}}class bk extends j{bk(String A,i B):super(A,B);FB PC(Object A,d H,FB B,[int I=f.o]){if(A!=null&&A.toString().length>0&&provider.pB("/sys/upstream/${A}")==null){var C=new NB(path).AC;bI D=provider.OB(C,false);var G=provider.OB("/sys/upstream",false) as hQ;G.sSB(D.name,A.toString());}provider.cF.update();return B..close();}}class ck extends j{ck(String A,i B):super(A,B);FB PC(Object B,d D,FB C,[int G=f.o]){if(B!=null&&B.toString().length>0){var H=new NB(path).AC;bI A=provider.OB(H,false);A.provider.EJ(A.JD,"@upstream@${A.name}",force:true);A.stop();A.token=B.toString();A.enabled=true;A.start();provider.cF.update();return super.PC(B,D,C,G);}return C..close();}}class ek extends j{ek(String A,i B):super(A,B);FB PC(Object B,d D,FB C,[int G=f.o]){if(B!=null&&B.toString().length>0){var H=new NB(path).AC;bI A=provider.OB(H,false);A.provider.EJ(A.JD,"@upstream@${A.name}",force:true);A.stop();A.group=B.toString();A.enabled=true;A.start();provider.cF.update();return super.PC(B,D,C,G);}return C..close();}}class fk extends j{fk(String A,i B):super(A,B);FB PC(Object B,d C,FB D,[int G=f.o]){var H=new NB(path).AC;bI A=provider.OB(H,false);if(B&&A.enabled==false){A.enabled=true;A.start();}else{A.enabled=false;A.stop();}provider.cF.update();return super.PC(B,C,D,G);}}class bI extends j{String name;String QE;String token;String group;String FV;fk oN;Zk eS;bk JS;ck ZS;ek BS;ak rR;bool enabled=false;bool n_=false;PT JD;bI(String C,this.name,this.QE,this.FV,this.token,this.group,i A):super(C,A){oN=new fk("/sys/upstream/${name}/enabled",A);oN.L[r"$type"]="bool";oN.L[r"$writable"]="write";oN.q(enabled);eS=new Zk("/sys/upstream/${name}/url",A);eS.L[r"$type"]="string";eS.L[r"$writable"]="write";eS.q(QE);JS=new bk("/sys/upstream/${name}/name",A);JS.L[r"$type"]="string";JS.L[r"$writable"]="write";JS.q(name);rR=new ak("/sys/upstream/${name}/brokerName",A);rR.L[r"$type"]="string";rR.L[r"$writable"]="write";rR.q(FV);ZS=new ck("/sys/upstream/${name}/token",A);ZS.L[r"$type"]="string";ZS.L[r"$writable"]="write";ZS.q(token);BS=new ek("/sys/upstream/${name}/group",A);BS.L[r"$type"]="string";BS.L[r"$writable"]="write";BS.q(group);new Future((){var B=new zz("/sys/upstream/${name}/delete",name,A);A.v("/sys/upstream/${name}/delete",B);A.v(oN.path,oN);A.v(eS.path,eS);A.v(JS.path,JS);A.v(rR.path,rR);A.v(ZS.path,ZS);A.v(BS.path,BS);sB("delete",B);sB("enabled",oN);sB("url",eS);sB("name",JS);sB("brokerName",rR);sB("token",ZS);sB("group",BS);});}void start(){if(!enabled){return;}i A=provider;String C="@upstream@${name}";String D=provider.IS(C);if(D!=null){zC G=provider.OB(D,false);G.L[r'$$group']=group;}LC H=provider.Hr(C);d I=provider.pU(C,provider);MF J=MW();JD=new PT(QE,"${FV}-",J,nodeProvider:A,isRequester:true,isResponder:true,overrideRequester:H,overrideResponder:I,token:(token!=null&&token.isNotEmpty)?token:null,strictTls:A.strictTls);JD.vG="Upstream at /upstream/${name}";JD.connect();eD B=A.K7(JD,name);if(B==null){A.EJ(JD,"@upstream@${name}",force:true);B=A.K7(JD,name);}oN.q(true);enabled=true;JD.vP.then((LC K){if(JD.WC!=null){B.IE.L[r"$remotePath"]=JD.WC;B.IE.gB(r"$remotePath");}});}void stop(){if(JD==null){return;}JD.close();i A=provider;A.EJ(JD,"@upstream@${name}",force:true);oN.q(false);enabled=false;}}class VK extends j{final String username;VK(String B,i A,this.username):super(B,A){L[r'$is']='broker/userNode';mD=A.OB('/defs/profile/broker/userNode',false);}j parent;bool KdB=false;void load(Map I){if(KdB){L.clear();JB.clear();Z.clear();}String D;if(path=='/'){D='/';}else{D='${path}/';}I.forEach((String B,C){if(B.startsWith(r'$')){L[B]=C;}else if(B.startsWith('@')){JB[B]=C;}else if(C is Map){String G='${D}${B}';s A=provider.OB(G,false);if(A is VK){A.parent=this;}Z[B]=A;if(A is VK){A.load(C);}else if(A is jH){A.load(C);A.MdB.BJ=true;if(A.L[r'$$dsId'] is String){String H='${username}:${A.L[r'$$dsId']}';provider.NdB[H]=G;provider.OdB[G]=H;}}}});KdB=true;}}class KW extends VK{KW(String B,String C,i A):super(B,A,C){L[r'$is']='broker/userRoot';mD=A.OB('/defs/profile/broker/userRoot',false);}}W oz(Map H,d D,W C,s B){Object A=H['Name'];if(B is VK&&A is String&&A!=''&&!A.contains(NB.Al)&&!A.startsWith(r'$')&&!A.startsWith(r'!')&&!A.startsWith(r'#')){if(B.Z.containsKey(A)){return C..close(new a('invalidParameter',msg:'node already exist'));}VK G=D.EC.OB('${B.path}/${A}',false);G.parent=B;B.Z[A]=G;B.gB(A);bC.fD((D.EC as i).Q_,1000);return C..close();}return C..close(a.SC);}W oFB(Map G,d H,W B,s A){Object I=G['Recursive'];if(A is VK&&A is!KW&&A.parent!=null){if(I==true){A0(A,A.path.substring(A.path.lastIndexOf('/')+1));}else{if(A.Z.isEmpty){VK C=A.parent;String D=A.path.substring(A.path.lastIndexOf('/')+1);A.parent=null;A.JB.clear();C.Z.remove(D);C.gB(D);A.ZY();}else{return B..close(a.SC);}}bC.fD((H.EC as i).Q_,1000);return B..close();}return B..close(a.SC);}void A0(VK A,String B){for(String B in A.Z.keys.toList()){A0(A.Z[B],B);}A.JB.clear();VK C=A.parent;A.parent=null;C.Z.remove(B);C.gB(B);A.ZY();}final Map<String,dynamic> pFB=<String,dynamic>{"broker":{"userNode":{"addChild":oz,"removeNode":oFB},"userRoot":{"addChild":oz}}};class eFB implements VW{final Map<String,WK> PdB=new Map<String,WK>();bool MY(mM A){PdB[A.vD]=A;return true;}mM Cr(String A,{String sessionId: ""}){return PdB[A];}void EJ(mM B,String A){if(PdB[A]==B){PdB.remove(A);}}LC Hr(String A){return new LC();}d pU(String B,jF A,[String C="",bool D=false]){return new d(A);}void A$(String A,Map B){}String X8(String A,String B){return "/${A}";}void vr(mM A){}}typedef Future<WebSocket> iFB(HttpRequest _0,bool _1,[_2(List<String> _0)]);typedef void jFB(WK _0);class WK implements mM{static const bool kFB=const bool.fromEnvironment("dsa.msgpack.enabled",defaultValue:true);final String vD;final String session;final String token;final dJ pF;String path;String HYB;String vG;jFB onDisconnect;Completer<LC> xr=new Completer<LC>();Future<LC> get vP=>xr.future;LC PB;d OC;lF HQ;lF gS;lF get nonce=>gS;sk connection;final bool enableTimeout;final bool enableAck;final List<String> ddB=new List<String>(3);final List<int> edB=<int>[0,0,0];final List<String> MO=new List<String>(3);void fdB(int A){edB[A]+=rM.vQ.zSB();MO[A]='${ddB[A]}${edB[A].toRadixString(16)}';}WK(String A,this.pF,VW C,{jF nodeProvider,this.session,this.token,int maxPermission: f.o,this.enableTimeout: false,this.enableAck: true,this.onDisconnect,bool trusted: false}):vD=A{path=C.X8(A,token);if(path!=null){PB=C.Hr(A);if(nodeProvider!=null){OC=C.pU(A,nodeProvider,session,trusted);OC.Kg=maxPermission;}}for(int B=0;B<3; ++B){List<int> G=new List<int>(12);for(int D=0;D<12; ++D){G[D]=rM.vQ.KS();}ddB[B]=zF.uM(G);fdB(B);}}bool get ISB{return pF.OVB(vD);}bool isRequester=false;bool iq;bool isResponder=true;Map bg;yRB(HttpRequest C,bool D,bool G,String H,String I,{String wsUri: '/ws',String httpUri: '/http',int updateInterval: 200,Map linkData,List formats,bool trusted: false,bool enableCompression: false})async{isRequester=G;isResponder=D;bg=linkData;Map A={"id":H,"publicKey":I,"wsUri":wsUri,"httpUri":httpUri,"updateInterval":updateInterval,"version":Oc};if(!trusted){HQ=await lF.HHB(pF,gS);A["tempKey"]=HQ.kq;A["salt"]=MO[0];A["saltS"]=MO[1];A["saltL"]=MO[2];}if(PB is Nl){A["path"]=(PB as Nl).EQ;}if(formats!=null){if(formats.contains('msgpack')&&kFB){A['format']='msgpack';}else{A['format']='json';}}else{A['format']='json';}if(enableCompression==true){iq=true;}{String J="Handshake Response: ${A}";String B;if(vG!=null){B=vG;}else if(path!=null){B="Link at ${path}";}else{B="Link ${vD}";}fB.mB("[${B}] ${J}]");}eW(C);C.response.write(oC.qH(A));C.response.close();}bool Ea(int A,String B){if(B==null){fB.QB("${vD} was rejected due to an invalid auth value: null");return false;}if(gS!=null&&gS.Ea(MO[A],B)){fdB(A);return true;}else if(HQ!=null&&HQ.Ea(MO[A],B)){fdB(A);ATB();return true;}if(HQ!=null){fB.QB("${vD} was rejected due to an invalid auth value: ${B}, expects ${HQ.CS(MO[A])}");}else if(gS!=null){fB.QB("${vD} was unable to reconnect due to an invalid auth value: ${B}, expects ${gS.CS(MO[A])}");}else{fB.QB("${vD} was rejected, handshake not initialized");}return false;}void ATB(){gS=HQ;HQ=null;if(connection!=null){connection.close();connection=null;}}RD TM;void Lr(HttpRequest A,bool D,[iFB C]){if(C==null){C=(A,G,[H])=>XW.gGB(A,H,G);}if(!D&&!Ea(0,A.uri.queryParameters['auth'])){throw HttpStatus.UNAUTHORIZED;}if(TM!=null){TM.close();}eW(A,null,null,true);C(A,iq,(K)=>null).then((WebSocket I){TM=MQB(I,A.uri.queryParameters['format']);TM.KY('salt',MO[0]);if(connection!=null){connection.close();}connection=TM;if(OC!=null&&isResponder){OC.connection=connection.Ss;}if(PB!=null&&isRequester){PB.connection=connection.K_;if(!xr.isCompleted){xr.complete(PB);}}}).catchError((B,J){fB.QB('Error upgrading websocket',B);fB.kC('Error upgrading websocket',B,J);try {if(B is WebSocketException){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.writeln("Failed to upgrade to a WebSocket.");}else{A.response.statusCode=HttpStatus.INTERNAL_SERVER_ERROR;A.response.writeln("Internal Server Error");}}catch (B){}if(onDisconnect!=null){onDisconnect(this);}return A.response.close();});}void close(){if(TM!=null){TM.close();TM=null;connection=null;}}RD MQB(WebSocket B,String C){var A=new RD(B,enableTimeout:enableTimeout,enableAck:enableAck,useCodec:ZK.y0(C));B.done.then((D){close();});if(onDisconnect!=null){A.DJ.then((D){onDisconnect(this);close();});}A.A_=false;if(vG!=null){A.vG=vG;}else if(path!=null){A.vG="Link at ${path}";}else{A.vG="Link ${vD}";}return A;}}class QW{RawDatagramSocket gdB;QW();Future init([bool D=false])async{gdB=await RawDatagramSocket.bind("0.0.0.0",D?1900:0);gdB.multicastHops=10;gdB.broadcastEnabled=true;gdB.listen((RawSocketEvent B){if(B==RawSocketEvent.READ){var A=gdB.receive();gdB.writeEventsEnabled=true;if(A==null){return;}var G=UTF8.decode(A.data);hdB(A,G);}else if(B==RawSocketEvent.CLOSED){if(!idB.isClosed){idB.close();}}});gdB.writeEventsEnabled=true;var H=await NetworkInterface.list();try {for(var C in H){try {gdB.joinMulticast(new InternetAddress("239.255.255.230"),interface:C);}catch (I){gdB.joinMulticast(new InternetAddress("239.255.255.230"),interface:C);}}}catch (I){gdB.joinMulticast(new InternetAddress("239.255.255.230"));}}Stream<String> aQB({Duration timeout: const Duration(seconds:5)}){jdB("DISCOVER","239.255.255.230",1900);Stream<String> A=idB.stream;new Future.delayed(timeout,(){close();});return A;}void jdB(String A,String B,int C){gdB.send(UTF8.encode(A),new InternetAddress(B),C);}Stream<RW> get HUB=>kdB.stream;void hdB(Datagram C,String D){var A=D.split(" ");var B=A[0];var G=A.skip(1).join(" ");if(B=="BROKER"){idB.add(G);}else if(B=="DISCOVER"){kdB.add(new RW(this,C));}}StreamController<RW> kdB=new StreamController.broadcast();StreamController<String> idB=new StreamController.broadcast();void close(){gdB.close();}}class RW{final QW a7;final Datagram As;RW(this.a7,this.As);void GUB(String A){a7.jdB("BROKER ${A}",As.address.address,As.port);}}typedef void SGB(LL _0);typedef dynamic TGB(String _0,pH _1);class pk{PT JD;jF provider;MF dE;String WH;File ldB;String prefix;List<String> WF;bool isRequester=false;String command="link";bool isResponder=true;Map<String,dynamic> defaultNodes;Map<String,Function> profiles;bool enableHttp=true;bool encodePrettyJson=false;bool strictOptions=false;bool exitOnFailure=true;bool loadNodesJson=true;bool strictTls=false;String defaultLogLevel="INFO";String lSB;bool savePrivateKey=false;LC overrideRequester;d overrideResponder;Map linkData;String home;String token;pk(this.WF,this.prefix,{this.isRequester: false,this.command: "link",this.isResponder: true,this.defaultNodes,Map<String,dynamic> nodes,this.profiles,this.provider,this.enableHttp: true,this.encodePrettyJson: false,bool autoInitialize: true,this.strictOptions: false,this.exitOnFailure: true,this.loadNodesJson: true,this.strictTls: false,this.defaultLogLevel: "INFO",this.savePrivateKey: true,this.overrideRequester,this.overrideResponder,jF nodeProvider,this.linkData,Map<String,String> commandLineOptions}){exitOnFailure=Zone.current["dslink.runtime.config"] is!Map;if(nodeProvider!=null){provider=nodeProvider;}if(nodes!=null){defaultNodes=nodes;}if(commandLineOptions!=null){for(String A in commandLineOptions.keys){YPB(A,commandLineOptions[A]);}}if(autoInitialize){init();}}String mdB=Directory.current.path;String ndB;String odB;bool pdB=false;DH qdB=new DH();LL rdB;String sdB(hB A){return A.name.toLowerCase();}void YPB(String A,[String B=""]){qdB=qdB==null?new DH(allowTrailingOptions:!strictOptions):qdB;qdB.tI(A,defaultsTo:B);}bool GQB({DH argp,SGB optionsHandler}){pdB=true;if(JD!=null){JD.close();JD=null;}if(argp==null){argp=qdB==null?qdB=new DH(allowTrailingOptions:!strictOptions):qdB;}argp.tI("broker",abbr:"b",help:"Broker URL",defaultsTo:"http://127.0.0.1:8080/conn");argp.tI("name",abbr:"n",help:"Link Name");argp.tI("home",help:"Home");argp.tI("token",help:"Token");argp.tI("base-path",help:"Base Path for DSLink");argp.tI("watch-file",help:"Watch File for DSLink",hide:true);argp.tI("log-file",help:"Log File for DSLink");List<String> O=hB.Dm.map(sdB).toList();O.addAll(["auto","debug"]);argp.tI("log",abbr:"l",allowed:O,help:"Log Level",defaultsTo:"AUTO");argp.np("help",abbr:"h",help:"Displays this Help Message",negatable:false);argp.np("discover",abbr:"d",help:"Automatically Discover a Broker",negatable:false);argp.np("strictTls",help:"Enforces valid SSL/TLS certificates for secure connections to "+"broker.");LL A=rdB=argp.YD(WF);if(A["log"]=="auto"){if(THB){lW("all");}else{lW(defaultLogLevel);}}else{lW(A["log"]);}if(A["base-path"]!=null){mdB=A["base-path"];if(mdB.endsWith("/")){mdB=mdB.substring(0,mdB.length-1);}}if(A["watch-file"]!=null){ndB=A["watch-file"];}odB=A["log-file"];if(A["strictTls"]){strictTls=true;}if(odB!=null){var G=new File(odB);if(!G.existsSync()){G.createSync(recursive:true);}fB.Kq();IOSink I=tdB=G.openWrite(mode:FileMode.APPEND);fB.Tg.listen((B){I.writeln("[${new DateTime.now()}][${B.level.name}] ${B.message}");if(B.error!=null){I.writeln(B.error);}if(B.stackTrace!=null){I.writeln(B.stackTrace);}I.flush();});}if(ndB!=null){var G=new File(ndB);StreamSubscription Q;Q=G.watch(events:FileSystemEvent.DELETE).listen((qB){close();Q.cancel();if(tdB!=null){try {tdB.close();}catch (C){}}});}if(const bool.fromEnvironment("dslink.debugger.console",defaultValue:false)){dGB().listen((String S){if(S=="list-stored-nodes"){if(provider is pH){pH H=provider;print(H.m.keys.join("\n"));}else{print("Not a SimpleNodeProvider.");}}else if(S=="list-stub-nodes"){if(provider is pH){pH H=provider;for(var M in H.m.values){NB N=new NB(M.path);if(H.m[N.AC]==null){print(M.path);}else if(!H.m[N.AC].Z.containsKey(N.name)){print(M.path);}}}else{print("Not a SimpleNodeProvider.");}}});}{var V=Zone.current["dslink.runtime.config"];if(V!=null){var UB=(){close();if(tdB!=null){try {tdB.close();}catch (C){}}};V["closeHandler"]=UB;}}String b="usage: ${command} [--broker URL] [--log LEVEL] [--name NAME] [--discover]";if(A["help"]){print(b);print(argp.H$);if(exitOnFailure){exit(1);}else{return false;}}WH=A["broker"];if(WH==null&&!A["discover"]){print("No Broker URL Specified. One of [--broker, --discover] is required.");print(b);print(argp.H$);if(exitOnFailure){exit(1);}else{return false;}}String J=A["name"];home=A["home"];token=A["token"];if(J!=null){if(J.endsWith("-")){prefix=J;}else{prefix="${J}-";}}File h=new File("${mdB}/dslink.json");if(h.existsSync()){var C;try {String aB=h.readAsStringSync();gP=oC.AG(aB);}catch (r){C=r;}if(gP==null){fB.BC("Invalid dslink.json",C);if(exitOnFailure){exit(1);}else{return false;}}}else{gP={};}if(WH!=null){if(!WH.startsWith("http")){WH="http://${WH}";}}File EB=NG("key")==null?new File("${mdB}/.dslink.key"):new File.fromUri(Uri.parse(NG("key")));String D;try {D=EB.readAsStringSync();dE=new MF.QWB(D);}catch (r){}if(D==null||D.length!=131){if(rM.vQ.Y9){String K;if(Platform.isWindows){K=Process.runSync("getmac",[] ).stdout.toString();}else{try {K=Process.runSync("arp",["-an"]).stdout.toString();}catch (C){try {var IB="";for(var LB in Platform.environment.keys){IB+= "${LB}=${Platform.environment[LB]}\n";}K=IB;}catch (C){}}}rM.vQ.I7(K);}dE=new MF.PWB();D=dE.oZ();if(savePrivateKey){EB.writeAsStringSync(D);}}vB.xGB(dE.oZ());if(A["discover"]){udB=true;}if(optionsHandler!=null){optionsHandler(A);}return true;}Future<String> xPB(Stream<String> A)async{return await A.first;}bool udB=false;String get WC=>JD.WC;IOSink tdB;bool vdB=false;void init(){if(!pdB){if(!GQB()){return;}}if(wdB){return;}wdB=true;if(profiles!=null){for(var A in profiles.keys.toList()){var B=profiles[A];if(B is TGB){profiles[A]=(String H){return B(H,provider);};}}}if(provider==null){provider=new pH(null,profiles);(provider as pH).ZUB(MUB);}fSB();void C(){JD=IQB();xdB=true;if(ydB){connect();}}if(udB){var D=new QW();new Future(()async{await D.init();try {var G=await xPB(D.aQB());fB.jB("Discovered Broker at ${G}");WH=G;C();}catch (I,J){fB.BC("Failed to discover a broker.",I,J);exit(1);}});}else{C();}}PT IQB(){var A=new PT(WH,prefix,dE,isRequester:isRequester,isResponder:isResponder,nodeProvider:provider,overrideRequester:overrideRequester,overrideResponder:overrideResponder,strictTls:strictTls,home:home,token:token,linkData:linkData);A.vG=lSB;return A;}void fSB(){if(provider is dG&&!vdB){ldB=NG("nodes")==null?new File("${mdB}/nodes.json"):new File.fromUri(Uri.parse(NG("nodes")));Map<String,dynamic> A;if(loadNodesJson){ldB=NG("nodes")==null?new File("${mdB}/nodes.json"):new File.fromUri(Uri.parse(NG("nodes")));try {String C=ldB.readAsStringSync();var B=oC.AG(C);if(B is Map<String,dynamic>){A=B;}}catch (D){}}if(A!=null){ITB(A);(provider as dG).init(A);}else if(defaultNodes!=null){(provider as dG).init(defaultNodes);}}}Map gP;Object NG(String A){if(gP!=null&&gP["configs"] is Map&&gP["configs"][A] is Map&&gP["configs"][A].containsKey("value")){return gP["configs"][A]["value"];}return null;}void ITB(Map A){}bool wdB=false;bool xdB=false;bool ydB=false;Future connect(){if(zdB==null){zdB=new Completer();}if(!pdB||!wdB){init();}if(xdB){JD.ur.then(zdB.complete);if(JD!=null)JD.connect();}else{ydB=true;}return zdB.future;}Completer zdB;LC get PB=>JD.PB;Future<LC> get vP=>JD.vP;void close(){zdB=null;if(JD!=null){JD.close();JD=null;wdB=false;vdB=true;}}void stop()=>close();void PE(){if(ldB!=null&&provider!=null){if(provider is!dG){return;}ldB.writeAsStringSync(oC.qH((provider as dG).PE(),pretty:encodePrettyJson));}}Future MUB()async{if(ldB!=null&&provider!=null){if(provider is!dG){return;}var A=0;while(AeB){await new Future.delayed(const Duration(milliseconds:5));A++ ;if(A==100){break;}}var B=oC.qH((provider as dG).PE(),pretty:encodePrettyJson);AeB=true;await ldB.writeAsString(B);AeB=false;}}bool AeB=false;s pB(String A){return provider.pB(A);}s ze(String A,Map B){if(provider is!tQ){throw new Exception("Unable to Modify Node Provider: It is not mutable.");}return (provider as tQ).ze(A,B);}void CQ(String A){if(provider is!tQ){throw new Exception("Unable to Modify Node Provider: It is not mutable.");}(provider as tQ).CQ(A);}void q(String A,dynamic B){if(provider is!tQ){throw new Exception("Unable to Modify Node Provider: It is not mutable.");}(provider as tQ).q(A,B);}s operator[](String A)=>provider[A];s operator~()=>this["/"];}class PT extends yk{Completer<LC> BeB=new Completer<LC>();Completer CeB=new Completer();Future<LC> get vP=>BeB.future;Future get ur=>CeB.future;String WC;final String vD;final String home;final String token;final MF dE;String wZ;LC PB;d OC;bool JVB=true;final bool strictTls;String vG;lF DeB;lF get nonce=>DeB;RD EeB;String Vs;E$(String A){this.Vs=A;}String FeB;String GeB;bool enableAck=false;Map linkData;List G8=['msgpack','json'];String kP='json';PT(this.GeB,String B,MF A,{jF nodeProvider,bool isRequester: true,bool isResponder: true,LC overrideRequester,d overrideResponder,this.strictTls: false,this.home,this.token,this.linkData,List formats}):dE=A,vD='${NB.aGB(B)}${A.pF.eZ}'{if(isRequester){if(overrideRequester!=null){PB=overrideRequester;}else{PB=new LC();}}if(formats==null&&const String.fromEnvironment("dsa.codec.formats")!=null){var C=const String.fromEnvironment("dsa.codec.formats");formats=C.split(",");}if(formats!=null){this.G8=formats;}if(isResponder){if(overrideResponder!=null){OC=overrideResponder;}else if(nodeProvider!=null){OC=new d(nodeProvider);}}if(token!=null&&token.length>16){String D=token.substring(0,16);String G=Ic.r0(jl('${vD}${token}'));wZ='&token=${D}${G}';}}int HeB=0;Mq(){Ls=0;bC.gl(connect,(HeB==0?20:HeB*500));if(HeB<30)HeB++ ;}connect()async{if(IeB){return;}GHB();bC.YHB(vf);HttpClient C=new HttpClient();C.badCertificateCallback=(X509Certificate G,String M,int N){fB.jB(YF('Bad certificate for ${M}:${N}'));fB.kC(YF('Cert Issuer: ${G.issuer}, '+'Subject: ${G.subject}'));return !strictTls;};String B='${GeB}?dsId=${Uri.encodeComponent(vD)}';if(home!=null){B='${B}&home=${home}';}if(wZ!=null){B='${B}${wZ}';}Uri H=Uri.parse(B);fB.jB(YF("Connecting to ${GeB}"));runZoned(()async{await ()async{HttpClientRequest I=await C.postUrl(H);Map D={'publicKey':dE.pF.IV,'isRequester':PB!=null,'isResponder':OC!=null,'formats':G8,'version':Oc,'enableWebSocketCompression':true};if(linkData!=null){D['linkData']=linkData;}fB.kC(YF("Handshake Request: ${D}"));fB.mB(YF("ID: ${vD}"));I.add(jl(oC.qH(D)));HttpClientResponse O=await I.close();List<int> Q=await O.fold(<int>[] ,x0);String S=const Utf8Decoder().convert(Q);Map A=oC.AG(S);fB.kC(YF("Handshake Response: ${A}"));Vs=A['salt'];String J=A['tempKey'];if(J==null){DeB=const s0();}else{DeB=await dE.Jr(J);}enableAck=A.containsKey('version');WC=A['path'];if(A['wsUri'] is String){FeB='${H.resolve(A['wsUri'])}?dsId=${Uri.encodeComponent(vD)}'.replaceFirst('http','ws');if(home!=null){FeB='${FeB}&home=${home}';}}if(A['format'] is String){kP=A['format'];}}().timeout(new Duration(minutes:1),onTimeout:(){C.close(force:true);throw new TimeoutException('Connection to ${GeB}',const Duration(minutes:1));});await vf(false);},onError:(K,V){if(fB.level<=hB.Am){fB.QB("Client socket crashed: ${K} ${V}");}else{fB.QB("Client socket crashed: ${K}");}C.close();Mq();});}int JeB=0;int Ls=0;vf([bool C=true])async{if(IeB)return;Ls++ ;if(Ls>10){Mq();return;}try {String B='${FeB}&auth=${DeB.CS(Vs)}&format=${kP}';if(wZ!=null){B='${B}${wZ}';}var D=await XW.Y0(B,useStandardWebSocket:JVB);EeB=new RD(D,clientLink:this,enableTimeout:true,enableAck:enableAck,useCodec:ZK.y0(kP));fB.jB(YF("Connected"));if(!CeB.isCompleted){CeB.complete();}HeB=0;JeB=0;if(OC!=null){OC.connection=EeB.Ss;}if(PB!=null){EeB.vP.then((G){PB.connection=G;if(!BeB.isCompleted){BeB.complete(PB);}});}EeB.DJ.then((I){vf();});}catch (A,H){fB.mB(YF("Error while initializing WebSocket"),A,H);if(A is WebSocketException&&(A.message.contains('not upgraded to websocket')||A.message.contains('(401)'))){Mq();}else if(C){bC.gl(vf,JeB==0?20:JeB*500);if(JeB<30)JeB++ ;}}}bool IeB=false;void close(){if(IeB)return;CeB=new Completer();IeB=true;if(EeB!=null){EeB.close();EeB=null;}}}abstract class sk{KF get K_;KF get Ss;Future<KF> get vP;Future<bool> get DJ;void Qs();void KY(String A,Object B);void close();ZK aY=ZK.w0;ListQueue<mQ> Fs=new ListQueue<mQ>();void G7(int C){mQ B;for(mQ A in Fs){if(A.we==C){B=A;break;}else if(A.we<C){B=A;}}if(B!=null){int D=(new DateTime.now()).millisecondsSinceEpoch;do{mQ A=Fs.removeFirst();A.XPB(C,D);if(A==B){break;}}while(B!=null);}}}class oO{List<Map> wN;List<bG> wP;oO(this.wN,this.wP);}class mQ{int we;int c_;int pXB;List<bG> wP;mQ(this.we,this.c_,this.wP);void XPB(int C,int A){for(bG B in wP){B.JY(we,c_,A);}}}abstract class KF{}abstract class lM{LC get PB;d get OC;lF get nonce;Future<LC> get vP;void close();}abstract class mM extends lM{}abstract class yk extends lM{MF get dE;E$(String A);String get vG=>null;String YF(String A){if(vG!=null){return "[${vG}] ${A}";}return A;}connect();}abstract class VW{}class DC{static const String nM="initialize";static const String nQ="open";static const String QD="closed";}class vb{static const String zk="request";static const String YGB="response";}class a{String type;String detail;String msg;String path;String phase;a(this.type,{this.msg,this.detail,this.path,this.phase: vb.YGB});a.MWB(Map A){if(A["type"] is String){type=A["type"];}if(A["msg"] is String){msg=A["msg"];}if(A["path"] is String){path=A["path"];}if(A["phase"] is String){phase=A["phase"];}if(A["detail"] is String){detail=A["detail"];}}Map GJ(){Map A={};if(msg!=null){A["msg"]=msg;}if(type!=null){A["type"]=type;}if(path!=null){A["path"]=path;}if(phase==vb.zk){A["phase"]=vb.zk;}if(detail!=null){A["detail"]=detail;}return A;}static final a eI=new a("permissionDenied");static final a Bl=new a("invalidMethod");static final a bGB=new a("notImplemented");static final a WW=new a("invalidPath");static final a T0=new a("invalidPaths");static final a Cl=new a("invalidValue");static final a SC=new a("invalidParameter");static final a U0=new a("disconnected",phase:vb.zk);}class SW implements KF{final StreamController<List> CO=new StreamController<List>();Stream<List> get KTB=>CO.stream;List<Function> KeB=[] ;final sk bP;SW(this.bP,[this.f7=false]){}ub handler;void Zs(ub A){this.handler=A;bP.Qs();}oO qU(int A,int B){if(handler!=null){oO C=handler.qU(A,B);return C;}return null;}bool LeB=false;bool f7=true;final Completer<KF> VZ=new Completer<KF>();Future<KF> get DJ=>VZ.future;final Completer<KF> ETB=new Completer<KF>();Future<KF> get ur=>ETB.future;}abstract class bG{static const int qk=16;static int P0=256;}abstract class ub{KF MeB;StreamSubscription NeB;KF get connection=>MeB;set connection(KF A){if(NeB!=null){NeB.cancel();NeB=null;OeB(MeB);}MeB=A;NeB=MeB.KTB.listen(onData);MeB.DJ.then(OeB);if(MeB.f7){JM();}else{MeB.ur.then((A)=>JM());}}void OeB(KF A){if(MeB==A){if(NeB!=null){NeB.cancel();NeB=null;}DJ();MeB=null;}}void DJ();void JM(){if(PeB){MeB.Zs(this);}}void onData(List A);List<Map> QeB=<Map>[] ;void QY(Map A){QeB.add(A);if(!PeB){if(MeB!=null){MeB.Zs(this);}PeB=true;}}List<bG> KeB=[] ;void OY(bG A){KeB.add(A);if(!PeB){if(MeB!=null){MeB.Zs(this);}PeB=true;}}bool PeB=false;oO qU(int B,int C){PeB=false;List<bG> A=KeB;KeB=[] ;for(bG D in A){D.OV(B,C);}List<Map> G=QeB;QeB=[] ;return new oO(G,A);}void AQB(){KeB.length=0;PeB=false;}}Map UGB={"node":{},"static":{},"getHistory":{r"$invokable":"read",r"$result":"table",r"$params":[{"name":"Timerange","type":"string","editor":"daterange"},{"name":"Interval","type":"enum","editor":Sc(["default","none","1Y","3N","1N","1W","1D","12H","6H","4H","3H","2H","1H","30M","15M","10M","5M","1M","30S","15S","10S","5S","1S"])},{"name":"Rollup","type":Sc(["avg","min","max","sum","first","last","and","or","count","auto"])}],r"$columns":[{"name":"timestamp","type":"time"},{"name":"value","type":"dynamic"}]}};class KB{KB mD;Map<String,Object> JB={};Object Fr(String A){return JB[A];}KB();Object AS(String A){if(JB.containsKey(A)){return JB[A];}if(mD!=null&&mD.JB.containsKey(A)){return mD.JB[A];}return null;}Map<String,Object> L={r'$is':'node'};Object NG(String A){if(L.containsKey(A)){return L[A];}if(mD!=null&&mD.L.containsKey(A)){return mD.L[A];}return null;}Map<String,KB> Z={};void sB(String A,KB B){Z[A]=B;}String hg(dynamic A){if(A is String){Z.remove(HI(A));return A;}else if(A is KB){Z.remove(A);}else{throw new Exception("Invalid Input");}return null;}KB HI(String A){if(Z.containsKey(A)){return Z[A];}if(mD!=null&&mD.Z.containsKey(A)){return mD.Z[A];}return null;}Object get(String A){if(A.startsWith(r'$')){return NG(A);}if(A.startsWith('@')){return AS(A);}return HI(A);}Map<String,dynamic> II(){var A=<String,dynamic>{};if(L.containsKey(r'$is')){A[r'$is']=L[r'$is'];}if(L.containsKey(r'$type')){A[r'$type']=L[r'$type'];}if(L.containsKey(r'$name')){A[r'$name']=L[r'$name'];}if(L.containsKey(r'$invokable')){A[r'$invokable']=L[r'$invokable'];}if(L.containsKey(r'$writable')){A[r'$writable']=L[r'$writable'];}if(L.containsKey(r'$params')){A[r'$params']=L[r'$params'];}if(L.containsKey(r'$columns')){A[r'$columns']=L[r'$columns'];}if(L.containsKey(r'$result')){A[r'$result']=L[r'$result'];}return A;}}class NB{static final RegExp ZGB=new RegExp(r'[\\\?\*|"<>:]');static final RegExp Al=new RegExp(r'[\/\\\?\*|"<>:]');static String aGB(String A){if(A.contains(Al)){return Uri.encodeComponent(A);}return A;}static NB S0(Object A,[String C]){if(A is String){NB B=new NB(A);if(B.WV){return B..S9(C);}}return null;}static NB wb(Object B,[String C]){if(B is String){NB A=new NB(B);if(A.WV&&A.yY){return A..S9(C);}}return null;}String path;String AC;NB get parent=>new NB(AC);NB Jq(String A)=>new NB((path.endsWith("/")?path.substring(0,path.length-1):path)+"/"+(A.startsWith("/")?A.substring(1):A));String name;bool WV=true;NB(this.path){ReB();}void ReB(){if(path==''||path.contains(ZGB)||path.contains('//')){WV=false;}if(path=='/'){WV=true;name='/';AC='';return;}if(path.endsWith('/')){path=path.substring(0,path.length-1);}int A=path.lastIndexOf('/');if(A<0){name=path;AC='';}else if(A==0){AC='/';name=path.substring(1);}else{AC=path.substring(0,A);name=path.substring(A+1);if(AC.contains(r'/$')||AC.contains('/@')){WV=false;}}}bool get isAbsolute{return name=='/'||AC.startsWith('/');}bool get PSB{return name=='/';}bool get s8{return name.startsWith(r'$');}bool get Tr{return name.startsWith(r'@');}bool get yY{return !name.startsWith(r'@')&&!name.startsWith(r'$');}void S9(String A,[bool B=false]){if(A==null){return;}if(!isAbsolute){if(AC==''){AC=A;}else{AC='${A}/${AC}';}path='${AC}/${name}';}else if(B){if(name==''){path=A;ReB();}else{AC='${A}${AC}';path='${AC}/${name}';}}}}class f{static const int TW=0;static const int VGB=1;static const int tb=2;static const int lQ=3;static const int o=4;static const int UW=5;static const List<String> rk=const['none','list','read','write','config','never'];static const Map<String,int> Q0=const{'none':TW,'list':VGB,'read':tb,'write':lQ,'config':o,'never':UW};static int dI(Object A,[int B=UW]){if(A is String&&Q0.containsKey(A)){return Q0[A];}return B;}}class cG{String type;String name;Object defaultValue;cG(this.name,this.type,[this.defaultValue]);Map<String,dynamic> oY(){var A=<String,dynamic>{"type":type,"name":name};if(defaultValue!=null){A["default"]=defaultValue;}return A;}static List<Map<String,dynamic>> XGB(List C){var B=<Map<String,dynamic>>[] ;for(Object A in C){if(A is Map<String,dynamic>){B.add(A);}else if(A is cG){B.add(A.oY());}}return B;}static List<cG> uk(List D){List<cG> B=<cG>[] ;for(Object A in D){if(A is Map&&A["name"] is String){String C="string";if(A["type"] is String){C=A["type"];}B.add(new cG(A["name"],C,A["default"]));}else if(A is cG){B.add(A);}else{return null;}}return B;}}class vk{}class wk{}class xk{}typedef Y nO<Y>(RB _0);class RB{static final String WGB=(){int A=(new DateTime.now()).timeZoneOffset.inMinutes;String B="+";if(A<0){A=-A;B="-";}int C=A~/60;int D=A%60;return "${B}${C<10?'0':''}${C}:${D<10?"0":''}${D}";}();static String tk;static int R0=0;static String QT(){DateTime A=new DateTime.now();if(A.millisecondsSinceEpoch==R0){return tk;}R0=A.millisecondsSinceEpoch;tk="${A.toIso8601String()}${WGB}";return tk;}int Ga=-1;Object value;String ts;DateTime SeB;String status;int count;num sum;num min;num max;DateTime Qq;RB(this.value,{this.ts,Map meta,this.status,this.count: 1,this.sum: double.NAN,this.min: double.NAN,this.max: double.NAN}){if(ts==null){ts=QT();}Qq=new DateTime.now();if(meta!=null){if(meta["count"] is int){count=meta["count"];}else if(value==null){count=0;}if(meta["status"] is String){status=meta["status"];}if(meta["sum"] is num){sum=meta["sum"];}if(meta["max"] is num){max=meta["max"];}if(meta["min"] is num){min=meta["min"];}}if(value is num&&count==1){if(sum!=sum)sum=value;if(max!=max)max=value;if(min!=min)min=value;}}RB.LWB(RB B,RB A){value=A.value;ts=A.ts;status=A.status;count=B.count+A.count;sum=B.sum;if(!A.sum.isNaN){if(sum==sum){sum=A.sum;}else{sum+= A.sum;}}min=B.min;if(min.isNaN||A.min<min){min=A.min;}max=B.min;if(max.isNaN||A.max>max){max=A.max;}Qq=A.Qq;}Duration TeB;void pSB(RB A){value=A.value;ts=A.ts;status=A.status;count+= A.count;if(!A.sum.isNaN){if(sum==sum){sum+= A.sum;}else{sum=A.sum;}}if(min!=min||A.min<min){min=A.min;}if(max!=max||A.max>max){max=A.max;}}bool LE(RB A){if(value is Map){if(A.value is!Map){return false;}}else if(value is List){if(A.value is!List){return false;}}else if(value!=A.value){return false;}if(A.ts!=ts||A.count!=count){return false;}if(count==1){return true;}return A.sum==sum&&A.min==min&&A.max==max;}Map rs(){Map A={"ts":ts,"value":value};if(count==0){A["count"]=0;}else if(count>1){A["count"]=count;if(sum.isFinite){A["sum"]=sum;}if(max.isFinite){A["max"]=max;}if(min.isFinite){A["min"]=min;}}return A;}Object tZ;bool UeB=false;RB DQB(){if(!UeB){UeB=true;return this;}return new RB(value,ts:ts,status:status,count:count,sum:sum,min:min,max:max);}}class RD extends sk{SW VeB;KF get Ss=>VeB;SW WeB;KF get K_=>WeB;Completer<KF> wr=new Completer<KF>();Future<KF> get vP=>wr.future;Completer<bool> XeB=new Completer<bool>();Future<bool> get DJ=>XeB.future;final yk clientLink;final WebSocket socket;bool YeB=false;RD(this.socket,{this.clientLink,bool enableTimeout: false,bool enableAck: true,ZK useCodec}){if(useCodec!=null){aY=useCodec;}VeB=new SW(this,true);WeB=new SW(this,true);socket.listen(onData,onDone:ZeB,onError:(A)=>fB.QB(YF('Error listening to socket'),A));socket.add(aY.mPB);if(!enableAck){zN=-1;}if(enableTimeout){Gs=new Timer.periodic(const Duration(seconds:20),JTB);}}Timer Gs;bool aeB=false;int beB=0;static bool MH=false;static int gW=0;static int sM=0;static int hW=0;static int wQ=0;static int Jc=0;static int Kc=0;void JTB(Timer A){if(beB>=3){fB.kC('close stale connection');this.close();return;}beB++ ;if(aeB){aeB=false;return;}this.KY(null,null);}void Qs(){if(!ceB){ceB=true;bC.tO(deB);}}Map eeB;void KY(String A,Object B){if(eeB==null){eeB={};}if(A!=null){eeB[A]=B;}Qs();}void onData(dynamic B){if(MH){Jc++ ;}if(XeB.isCompleted){return;}if(!wr.isCompleted){wr.complete(WeB);}beB=0;Map A;if(B is List<int>){try {A=aY.Yq(B as List<int>);if(fB.xY(hB.tW)){fB.kC(YF("receive: ${A}"));}}catch (G,H){fB.mB(YF("Failed to decode binary data in WebSocket Connection"),G,H);close();return;}if(MH){gW+= B.length;}B=null;bool C=false;if(A["responses"] is List&&(A["responses"] as List).length>0){C=true;WeB.CO.add(A["responses"]);if(MH){sM+= (A["responses"] as List).length;}}if(A["requests"] is List&&(A["requests"] as List).length>0){C=true;VeB.CO.add(A["requests"]);if(MH){sM+= (A["requests"] as List).length;}}if(A["ack"] is int){G7(A["ack"]);}if(C){Object D=A["msg"];if(D!=null){KY("ack",D);}}}else if(B is String){try {A=aY.Wf(B);if(fB.xY(hB.tW)){fB.kC(YF("receive: ${A}"));}}catch (G,H){fB.BC(YF("Failed to decode string data from WebSocket Connection"),G,H);close();return;}if(MH){gW+= B.length;}if(A["salt"] is String&&clientLink!=null){clientLink.E$(A["salt"]);}bool C=false;if(A["responses"] is List&&(A["responses"] as List).length>0){C=true;WeB.CO.add(A["responses"]);if(MH){for(Map I in A["responses"]){if(I["updates"] is List){int J=I["updates"].length;if(J>0){sM+= J;}else{sM+= 1;}}else{sM+= 1;}}}}if(A["requests"] is List&&(A["requests"] as List).length>0){C=true;VeB.CO.add(A["requests"]);if(MH){sM+= A["requests"].length;}}if(A["ack"] is int){G7(A["ack"]);}if(C){Object D=A["msg"];if(D!=null){KY("ack",D);}}}}int zN=1;bool ceB=false;void deB(){if(!ceB){return;}ceB=false;bool C=false;Map B;if(eeB!=null){B=eeB;eeB=null;C=true;}else{B={};}var D=<bG>[] ;int G=(new DateTime.now()).millisecondsSinceEpoch;oO A=VeB.qU(G,zN);if(A!=null){if(A.wN.length>0){B["responses"]=A.wN;C=true;if(MH){for(Map H in A.wN){if(H["updates"] is List){int I=H["updates"].length;if(I>0){wQ+= I;}else{wQ+= 1;}}else{wQ+= 1;}}}}if(A.wP.length>0){D.addAll(A.wP);}}A=WeB.qU(G,zN);if(A!=null){if(A.wN.length>0){B["requests"]=A.wN;C=true;if(MH){wQ+= A.wN.length;}}if(A.wP.length>0){D.addAll(A.wP);}}if(C){if(zN!=-1){if(D.length>0){Fs.add(new mQ(zN,G,D));}B["msg"]=zN;if(zN<0x7FFFFFFF){ ++zN;}else{zN=1;}}ZPB(B);aeB=true;if(MH){Kc++ ;}}}void ZPB(Map B){Object A=aY.gf(B);if(fB.xY(hB.tW)){fB.kC(YF("send: ${B}"));}if(MH){if(A is String){hW+= A.length;}else if(A is List<int>){hW+= A.length;}else{fB.QB(YF("invalid data frame"));}}try {socket.add(A);}catch (C){fB.BC(YF('Error writing to socket'),C);close();}}bool A_=true;void ZeB(){if(YeB){return;}YeB=true;if(A_){fB.jB(YF("Disconnected"));}if(!WeB.CO.isClosed){WeB.CO.close();}if(!WeB.VZ.isCompleted){WeB.VZ.complete(WeB);}if(!VeB.CO.isClosed){VeB.CO.close();}if(!VeB.VZ.isCompleted){VeB.VZ.complete(VeB);}if(!XeB.isCompleted){XeB.complete(false);}if(Gs!=null){Gs.cancel();}ceB=false;}String YF(String A){if(clientLink!=null){return clientLink.YF(A);}if(vG!=null){return "[${vG}] ${A}";}return A;}String vG;void close(){if(socket.readyState==WebSocket.OPEN||socket.readyState==WebSocket.CONNECTING){socket.close();}ZeB();}}const bool V0=const bool.fromEnvironment("dsa.io.tcpNoDelay",defaultValue:true);Stream<String> cGB(){return const Utf8Decoder().bind(lh.stdin);}Stream<String> dGB(){var A=cGB();return const LineSplitter().bind(A);}class XW{static HttpClient eGB=new HttpClient();static Future<HttpClientRequest> fGB(String B,String C,{Map<String,String> headers})async{var A=await eGB.openUrl(B,Uri.parse(C));if(headers!=null){headers.forEach(A.headers.set);}return A;}static const String W0="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";static const bool X0=const bool.fromEnvironment("calzone.build",defaultValue:false)||const bool.fromEnvironment("websocket.standard",defaultValue:true);static Future<WebSocket> Y0(String M,{Iterable<String> protocols,Map<String,dynamic> headers,HttpClient httpClient,bool useStandardWebSocket})async{Uri A=Uri.parse(M);if(useStandardWebSocket==null){useStandardWebSocket=X0;}if(useStandardWebSocket==true&&A.scheme!="wss"){return await IHB(WebSocket.connect(M,protocols:protocols,headers:headers),60000,onSuccessAfterTimeout:(WebSocket D){D.close();});}if(A.scheme!="ws"&&A.scheme!="wss"){throw new WebSocketException("Unsupported URL scheme '${A.scheme}'");}Random b=new Random();Uint8List N=new Uint8List(16);for(int C=0;C<16;C++ ){N[C]=b.nextInt(256);}String O=BASE64.encode(N);int I=A.port;if(I==0){I=A.scheme=="wss"?443:80;}A=new Uri(scheme:A.scheme=="wss"?"https":"http",userInfo:A.userInfo,host:A.host,port:I,path:A.path,query:A.query);HttpClient Q=httpClient==null?(new HttpClient()..badCertificateCallback=(LB,UB,aB)=>true):httpClient;return Q.openUrl("GET",A).then((HttpClientRequest G)async{if(A.userInfo!=null&&!A.userInfo.isEmpty){String h=BASE64.encode(UTF8.encode(A.userInfo));G.headers.set(HttpHeaders.AUTHORIZATION,"Basic ${h}");}if(headers!=null){headers.forEach((r,J)=>G.headers.add(r,J));}G.headers..set(HttpHeaders.CONNECTION,"Upgrade")..set(HttpHeaders.UPGRADE,"websocket")..set("Sec-WebSocket-Key",O)..set("Cache-Control","no-cache")..set("Sec-WebSocket-Version","13");if(protocols!=null){G.headers.add("Sec-WebSocket-Protocol",protocols.toList());}return G.close();}).then((B){return B;}).then((HttpClientResponse B){void H(String EB){B.detachSocket().then((Socket D){D.destroy();});throw new WebSocketException(EB);}if(B.statusCode!=HttpStatus.SWITCHING_PROTOCOLS||B.headers[HttpHeaders.CONNECTION]==null||!B.headers[HttpHeaders.CONNECTION].any((J)=>J.toLowerCase()=="upgrade")||B.headers.value(HttpHeaders.UPGRADE).toLowerCase()!="websocket"){H("Connection to '${A}' was not upgraded to websocket");}String S=B.headers.value("Sec-WebSocket-Accept");if(S==null){H("Response did not contain a 'Sec-WebSocket-Accept' header");}List<int> K=PQ.convert("${O}${W0}".codeUnits).eC;List<int> V=BASE64.decode(S);if(K.length!=V.length){H("Response header 'Sec-WebSocket-Accept' is the wrong length");}for(int C=0;C<K.length;C++ ){if(K[C]!=V[C]){H("Bad response 'Sec-WebSocket-Accept' header");}}var IB=B.headers.value('Sec-WebSocket-Protocol');return B.detachSocket().then((D){D.setOption(SocketOption.TCP_NODELAY,V0);return new WebSocket.fromUpgradedSocket(D,protocol:IB,serverSide:false);});}).timeout(new Duration(minutes:1),onTimeout:(){Q.close(force:true);throw new WebSocketException('timeout');});}static Future<WebSocket> gGB(HttpRequest C,[H(List<String> protocols),bool I]){if(I==null){I=X0;}if(I){return WebSocketTransformer.upgrade(C,protocolSelector:H);}var A=C.response;if(!WebSocketTransformer.isUpgradeRequest(C)){A..statusCode=HttpStatus.BAD_REQUEST..close();return new Future.error(new WebSocketException("Invalid WebSocket upgrade request"));}Future<WebSocket> J(String B){A..statusCode=HttpStatus.SWITCHING_PROTOCOLS..headers.add(HttpHeaders.CONNECTION,"Upgrade")..headers.add(HttpHeaders.UPGRADE,"websocket");String M=C.headers.value("Sec-WebSocket-Key");String N=BASE64.encode(PQ.convert("${M}${W0}".codeUnits).eC);A.headers.add("Sec-WebSocket-Accept",N);if(B!=null){A.headers.add("Sec-WebSocket-Protocol",B);}A.headers.contentLength=0;return A.detachSocket().then((G){G.setOption(SocketOption.TCP_NODELAY,V0);return new WebSocket.fromUpgradedSocket(G,protocol:B,serverSide:true);});}var D=C.headers['Sec-WebSocket-Protocol'];if(D!=null&&H!=null){D=XW.hGB(D.join(', '));return new Future(()=>H(D)).then((String B){if(D.indexOf(B)<0){throw new WebSocketException("Selected protocol is not in the list of available protocols");}return B;}).catchError((O){A..statusCode=HttpStatus.INTERNAL_SERVER_ERROR..close();throw O;}).then((K){if(K is String){return J(K);}return null;}).then((WebSocket G){return G;});}else{return J(null);}}static List<String> hGB(String B){List<String> D=new List<String>();int C=0;int A=0;while(A<B.length){if(B[A]==","){D.add(B.substring(C,A));C=A+1;}else if(B[A]==" "||B[A]=="\t"){C++ ;}A++ ;}D.add(B.substring(C,A));return D;}}final iGB=nJB;Future<File> jGB(File B,dynamic G,Future<File> H(File file,dynamic content),{bool verifyJson: false})async{final C=await Directory.current.createTemp();final I=hG(B.path);var A=new File("${C.path}${iGB}${I}");A=await H(A,G);var D=true;if(verifyJson){final J=await A.readAsString();try {JSON.decode(J);}on FormatException catch (K,M){D=false;fB.BC("Couldn't parse JSON after trying to write ${B.path}",K,M);}}if(D){A=await A.rename(B.absolute.path);C.delete();return A;}else{fB.BC("${B.path} wasn't saved, the original will be preserved");return B;}}Future<File> YW(File B,String A,{bool verifyJson: false})async{return jGB(B,A,(File C,A)=>C.writeAsString(A,flush:true),verifyJson:verifyJson);}class ZW{static final List<String> kGB=[r"%",r".",r"/",r"\",r"?",r"*",r":",r"|",r"<",r">",r"$",r"@",r'"',r"'"];static String aW(String D){var C=new StringBuffer();A(String J)=>const Utf8Encoder().convert(J)[0];mainLoop:for(var B=0;B<D.length;B++ ){String I=D[B];if(I=="%"&&(B+1<D.length)){String G=D[B+1].toUpperCase();if((A(G)>=A("0")&&A(G)<=A("9"))||(A(G)>=A("A")&&A(G)<=A("F"))){if(B+2<D.length){String H=D[B+2].toUpperCase();if((A(H)>A("0")&&A(H)<=A("9"))||(A(H)>=A("A")&&A(H)<=A("F"))){B+= 2;C.write("%");C.write(G);C.write(H);continue;}else{ ++B;C.write("%${G}");continue;}}}}for(String K in kGB){if(I==K){var M=I.codeUnitAt(0).toRadixString(16);C.write("%${M}".toUpperCase());continue mainLoop;}}C.write(I);}return C.toString();}}Ic ZT=Gc.p0;bool FHB=false;GHB()=>FHB=true;abstract class Ic{static String r0(List<int> A){Uint8List B=zQ.u0(A);return ZT.jPB(B);}}abstract class lF{String get kq;static Future<lF> HHB(dJ A,lF B)async=>ZT.ePB(A,B);String CS(String A);bool Ea(String A,String B){return CS(A)==B;}}abstract class dJ{String get IV;String get eZ;dJ();factory dJ.OWB(Uint8List A)=>ZT.bRB(A);String U8(String A){return '${A}${eZ}';}bool OVB(String A){return (A.length>=43&&A.substring(A.length-43)==eZ);}}abstract class MF{factory MF.PWB()=>ZT.O8();factory MF.QWB(String A)=>ZT.eSB(A);}abstract class rM{static rM get vQ=>ZT.OM;}class s0 implements lF{final String kq="";const s0();String CS(String A){return '';}bool Ea(String A,String B){return true;}}lH i0;wF j0;int k0=-1;String l0;List<dynamic> BHB(List<int> I,String C){wE J=kF.XF.vR(I);lH A;wF D;int G=(new DateTime.now()).millisecondsSinceEpoch;if(l0==null||G-k0>60000||C==l0||C==''){var H=new rb();var K=new MT(kF);var M=new NT(K,Gc.p0.OM);H.init(M);var B=H.pf();A=B.dE;D=B.pF;if(C!=''){i0=B.dE;j0=B.pF;k0=G;}}else{A=i0;D=j0;}var N=J*A.sJ;return [A.sJ.IQ(),D.hK.nU(false),N.nU(false)];}void CHB(SendPort B){var C=new ReceivePort();B.send(C.sendPort);C.listen((A){if(A is List&&A.length==2){B.send(BHB(A[0] as List<int>,A[1].toString()));}});}class YT{static bool get n0=>Ol!=null;static Isolate Ol;static DHB()async{if(Ol!=null)return;var A=new ReceivePort();Ol=await Isolate.spawn(CHB,A.sendPort);A.listen(EHB);Pl();}static SendPort o0;static void EHB(A){if(A is SendPort){o0=A;}else if(A is List){if(uQ!=null&&A.length==3){var B=new n.tVB(1,A[0] as List<int>);var C=kF.XF.vR(A[1] as List<int>);var D=kF.XF.vR(A[2] as List<int>);var G=new rO(new lH(B,kF),new wF(C,kF),D);uQ.feB.complete(G);uQ=null;}}Pl();}static fW uQ;static void Pl(){if(uQ==null&&Ql.length>0){uQ=Ql.removeFirst();o0.send([uQ.D_.xK.hK.nU(false),uQ.f9]);}}static ListQueue<fW> Ql=new ListQueue<fW>();static Future<lF> Rl(dJ B,String C){var A=new fW(B,C);Ql.add(A);Pl();return A.future;}}class fW{sO D_;String f9;fW(this.D_,this.f9);Completer<lF> feB=new Completer<lF>();Future<lF> get future=>feB.future;}VL m0;VL get kF{if(m0!=null){return m0;}n B=new n("ffffffff00000001000000000000000000000000ffffffffffffffffffffffff",16);n C=new n("ffffffff00000001000000000000000000000000fffffffffffffffffffffffc",16);n D=new n("5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b",16);n G=new n("046b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c2964fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5",16);n H=new n("ffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",16);n I=new n("1",16);n J=new n("c49d360886e704936a6678e1139d26b7819f7e90",16);var K=J.IQ();var A=new qb(B,C,D);return new L0("secp256r1",A,A.vR(G.IQ()),H,I,K);}class Gc implements Ic{static final Gc p0=new Gc();final Sl OM=new Sl();lH geB;wF heB;int ieB=-1;Future<lF> ePB(dJ A,lF B)async{if(YT.n0){if(B is rO){return YT.Rl(A,B.jeB.sJ.ss(16));}else{return YT.Rl(A,null);}}int D=(new DateTime.now()).millisecondsSinceEpoch;if(geB==null||D-ieB>60000||(B is rO&&B.jeB==geB)){var G=new rb();var I=new MT(kF);var J=new NT(I,OM);G.init(J);var H=G.pf();geB=H.dE;heB=H.pF;ieB=D;}sO C;if(A is!sO){throw "Not a PublicKeyImpl: ${C}";}else{C=A;}var K=C.xK.hK*geB.sJ;return new rO(geB,heB,K);}Future<lF> Jr(dJ A)async{if(YT.n0){return YT.Rl(A,"");}var D=new rb();var G=new MT(kF);var H=new NT(G,OM);D.init(H);var B=D.pf() as ob<wF,lH>;sO C;if(A is!sO){throw "Not a PublicKeyImpl: ${C}";}else{C=A;}var I=C.xK.hK*B.dE.sJ;return new rO(B.dE,B.pF,I);}Future<MF> N8()async{return O8();}MF O8(){var A=new rb();var C=new MT(kF);var D=new NT(C,OM);A.init(D);var B=A.pf();return new Hc(B.dE,B.pF);}MF eSB(String A){if(A.contains(" ")){List D=A.split(" ");var B=new n.tVB(1,zF.vO(D[0]));lH C=new lH(B,kF);var G=kF.XF.vR(zF.vO(D[1]));wF H=new wF(G,kF);return new Hc(C,H);}else{var B=new n.tVB(1,zF.vO(A));lH C=new lH(B,kF);return new Hc(C);}}dJ bRB(Uint8List A){wE B=kF.XF.vR(A);return new sO(new wF(B,kF));}String jPB(Uint8List A){kQ B=new kQ();Uint8List C=B.process(new Uint8List.fromList(A));return zF.uM(C);}}class rO extends lF{String get kq=>zF.uM(keB.hK.nU(false));Uint8List eC;lH jeB;wF keB;rO(this.jeB,this.keB,wE D){eC=q0(D.x.IJ());if(eC.length>32){eC=eC.sublist(eC.length-32);}else if(eC.length<32){var B=new Uint8List(32);int C=32-eC.length;for(int A=0;A<eC.length; ++A){B[A+C]=eC[A];}for(int A=0;A<C; ++A){B[A]=0;}eC=B;}}String CS(String G){Uint8List B=jl(G);Uint8List C=new Uint8List(B.length+eC.length);int A;for(A=0;A<B.length;A++ ){C[A]=B[A];}for(var D=0;D<eC.length;D++ ){C[A]=eC[D];A++ ;}kQ H=new kQ();var I=H.process(C);return zF.uM(I);}}class sO extends dJ{wF xK;String IV;String eZ;sO(this.xK){List<int> A=xK.hK.nU(false);IV=zF.uM(A);kQ B=new kQ();eZ=zF.uM(B.process(A));}}class Hc implements MF{dJ pF;lH jU;wF xK;Hc(this.jU,[this.xK]){if(xK==null){xK=new wF(kF.pn*jU.sJ,kF);}pF=new sO(xK);}String oZ(){return "${zF.uM(q0(jU.sJ))} ${pF.IV}";}Future<rO> Jr(String A)async{wE B=jU.parameters.XF.vR(zF.vO(A));wF C=new wF(B,kF);var D=C.hK*jU.sJ;return new rO(jU,xK,D);}}class Sl extends N0 implements rM{bool get Y9=>true;mk leB;kO meB;Sl([int H=-1]){meB=new kO();leB=new mk(meB);Random A=new Random();final B=[A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256)];final C=new mO(new Uint8List.fromList(B));A=new Random((new DateTime.now()).millisecondsSinceEpoch);final D=new Uint8List.fromList([A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256),A.nextInt(256)]);final G=new OW<kH>(C,D);leB.pZ(G);}void pZ(kH A){if(A is OW<kH>){leB.pZ(A);}else{throw "${A} is not a ParametersWithIV implementation.";}}void I7(String G){List<int> A=const Utf8Encoder().convert(G);int C=(A.length).ceil()*16;if(C>A.length){A=A.toList();while(C>A.length){A.add(0);}}final D=new Uint8List.fromList(A);final H=new Uint8List(16);for(var B=0;B<D.lengthInBytes;){var I=meB.PS(D,B,H,0);B+= I;}}int KS(){return leB.KS();}}Uint8List q0(n C){List<int> A=C.IQ();if(A.length>32&&A[0]==0){A=A.sublist(1);}int D=A.length;for(int B=0;B<D; ++B){if(A[B]<0){A[B]&=0xff;}}return new Uint8List.fromList(A);}abstract class iF{final RT neB;iF(this.neB){}iF qR;Set<iF> QZ=new Set<iF>();Set<W> FJ=new Set<W>();void AI(W A){A.ZF=oeB;FJ.add(A);}void oeB(W A){FJ.remove(A);if(FJ.isEmpty&&QZ.isEmpty){destroy();}}void pp(iF A){QZ.add(A);}void DUB(iF A){QZ.remove(A);if(QZ.isEmpty&&FJ.isEmpty){destroy();}}void init(){}void zZ(List A);void destroy(){for(W A in FJ){A.close;}if(qR!=null){qR.DUB(this);}neB.peB.remove(d8());}String qeB;String d8(){if(qeB==null){if(qR!=null){qeB='${qR}|${this}';}else{qeB=toString();}}return qeB;}}class pO{static const int Dl=1;static const int El=0;static const int Z0=3;static const int a0=2;String prefix;String dZ;bool X9=false;bool vXB=false;String TD;pO(String B){if(B==''){return;}List A;if(B.contains('?')){A=B.split('?');}else if(B.contains('*')){A=B.split('*');X9=true;}if(A!=null){if(A.length!=2){throw 'invalid path "${B}"';}if(A[0]!=''){prefix=A[0];}if(A[1]!=''){dZ=A[1];}}else{TD=B;}}int KZ(String A,bool B){if(TD!=null){if(A==TD){return Dl;}else{return El;}}else{if(B&&prefix!=null&&!A.startsWith(prefix)){return El;}if(X9){if(dZ==null||A.endsWith(dZ)){return Z0;}else{return a0;}}else{if(dZ!=null&&!A.startsWith(dZ)){return El;}return Dl;}}}}class WL{xb command;List<pO> MM;Set<int> ir=new Set<int>();s e;StreamSubscription EM;WL(this.command,this.e,this.MM){}void NY(int A){if(!ir.contains(A)){ir.add(A);int B=A.abs();if(B==MM.length){S_=true;}else if(B<MM.length){if(EM==null){EM=e.br.listen(GTB);}e.Z.forEach((String D,KB C){if(C is s){X7(D,C,A);}});}}}bool reB=false;void set S_(bool A){if(reB!=A){reB=A;if(reB){command.bh([e,'+']);}else{command.bh([e,'-']);}}}void GTB(String A){if(A.startsWith('@')||A.startsWith(r'$')){return;}s B=e.Z[A];if(B==null){VQB(A);}else{for(int C in ir){X7(A,B,C);}}}void X7(String H,s D,int G){int B=G.abs();if(B>=MM.length){return;}bool I=G>0;int C=MM[B].KZ(H,I);if(C>0){WL A=command.peB[D.path];if(A==null){A=new WL(command,D,MM);command.peB[D.path]=A;}if(C==pO.Dl){A.NY(B+1);}else if(C==pO.a0){A.NY(-B);}else if(C==pO.Z0){A.NY(-B);A.NY(B+1);}}}void VQB(String B){String C='${e.path}/${B}';WL A=command.peB[C];if(A!=null){A.S_=false;A.destroy();command.peB.remove(A.e.path);}}void destroy(){if(EM!=null){EM.cancel();}}}class xb extends iF{List<String> JV;List<pO> MM;xb(Object A,RT B):super(B){if(A is String){JV=A.split('/');}else if(A is List<String>){JV=A;}}void init(){MM=new List<pO>(JV.length);for(int A=0;A<JV.length; ++A){MM[A]=new pO(JV[A]);}}Map<String,WL> peB=new Map<String,WL>();Set<String> seB=new Set<String>();bool teB=false;void bh(List A){for(var B in QZ){B.zZ([A]);}}void pp(iF A){super.pp(A);List B=[] ;peB.forEach((String D,WL C){if(C.reB){B.add([C.e,'+']);}});A.zZ(B);}void zZ(List D){for(List A in D){if(A[0] is s){s B=A[0];if(A[1]=='+'){if(peB.containsKey(B.path)){print('not implemented');}else{WL C=new WL(this,B,MM);peB[B.path]=C;C.NY(1);}}else if(A[1]=='-'){print('not implemented');}}}}String toString(){return 'list ${JV.join("/")}';}void destroy(){super.destroy();peB.forEach((String B,WL A){A.destroy();});}}class RT{jF provider;RT(this.provider){}iF t9(List A){return null;}iF fTB(String D){if(D.startsWith('[')){return t9(oC.AG(D));}List<String> A=D.split('|').map((G)=>G.trim()).toList();if(A.length==2&&A[0].startsWith('list /data')&&A[1].startsWith('subscribe')){String H=A[0].substring(5);iF B=new xb(H,this);B=ueB(B);if(B==null){return null;}iF C=new Fl(this);C.qR=B;C=ueB(C);return C;}return null;}Map<String,iF> peB=new Map<String,iF>();iF ueB(iF A){String B=A.d8();if(peB.containsKey(B)){return peB[B];}try {A.init();}catch (C){A.destroy();return null;}if(A.qR!=null){A.qR.pp(A);}else if(A is xb){A.zZ([[provider.pB('/'),'+']]);}peB[B]=A;return A;}}class oQ{final Fl command;final s e;pM EM;bool RS=false;bool Dg=true;oQ(this.command,this.e){if(e.fh){J$(e.vN);}EM=e.TG(J$);}RB uN;void J$(RB A){uN=A;command.bh(f8());}List f8(){if(!RS&&uN!=null){if(Dg){Dg=false;return [e.path,'+',uN.value,uN.ts];}else{return [e.path,'',uN.value,uN.ts];}}return null;}List hRB(){if(!RS&&!Dg&&uN!=null){return [e.path,'+',uN.value,uN.ts];}return null;}void destroy(){EM.cancel();}}class Fl extends iF{static List lGB=[{'name':'path','type':'string'},{'name':'change','type':'string'},{'name':'value','type':'string'},{'name':'ts','type':'string'}];Fl(RT A):super(A);void AI(W A){if(teB){veB();}super.AI(A);List B=[] ;dC.forEach((String G,oQ D){List C=D.hRB();if(C!=null){B.add(C);}});A.TB(B,columns:lGB);}Set<String> seB=new Set<String>();Map<String,oQ> dC=new Map<String,oQ>();bool teB=false;void FVB(String A){seB.add(A);if(!teB){teB=true;bC.tO(veB);}}List weB=[] ;void bh(List A){weB.add(A);if(!teB){teB=true;bC.tO(veB);}}void veB(){if(!teB){return;}teB=false;List B=weB;weB=[] ;for(String C in seB){oQ A=dC[C];if(A!=null){if(A.RS){if(!A.Dg){B.add([C,'-',null,RB.QT()]);}dC.remove(C);A.destroy();}else{List D=A.f8();if(D!=null){B.add(D);}}}}seB.clear();for(var G in FJ){G.TB(B);}}void zZ(List C){for(List B in C){if(B[0] is s){s A=B[0];if(B[1]=='+'){if(!dC.containsKey(A.path)){dC[A.path]=new oQ(this,A);}else{dC[A.path].RS=false;}}else if(B[1]=='-'){if(dC.containsKey(A.path)){dC[A.path].RS=true;FVB(A.path);}}}}}String toString(){return r'subscribe $value';}void destroy(){super.destroy();dC.forEach((String B,oQ A){A.destroy();});}}class yb{static final Map mGB={"node":{},"static":{},"getHistory":{r"$invokable":"read",r"$result":"table",r"$params":[{"name":"Timerange","type":"string","editor":"daterange"},{"name":"Interval","type":"enum","default":"none","editor":Sc(["default","none","1Y","3N","1N","1W","1D","12H","6H","4H","3H","2H","1H","30M","15M","10M","5M","1M","30S","15S","10S","5S","1S"])},{"name":"Rollup","default":"none","type":Sc(["none","avg","min","max","sum","first","last","count","delta"])}],r"$columns":[{"name":"timestamp","type":"time"},{"name":"value","type":"dynamic"}]}};static final Map<String,KB> Ac=(){var C=new Map<String,KB>();mGB.forEach((String D,Map H){String I='/defs/profile/${D}';Bc A=new Bc(I);H.forEach((String B,Object G){if(B.startsWith(r'$')){A.L[B]=G;}else if(B.startsWith('@')){A.JB[B]=G;}});A.HZ=true;C[D]=A;});return C;}();}class qQ{Map<String,nC> xeB=new Map<String,nC>();qQ(){}nC CM(String A){var B=xeB[A];if(B==null){if((xeB.length%1000)==0){fB.mB("Node Cache hit ${xeB.length} nodes in size.");}if(A.startsWith("defs")){B=xeB[A]=new Bc(A);}else{B=xeB[A]=new nC(A);}}return B;}void clear(){xeB.clear();}KB T8(String B,String A){if(yb.Ac.containsKey(A)){return yb.Ac[A];}return CM(B);}nC Zh(nC C,String D,Map G){String A;if(C.WC=='/'){A='/${D}';}else{A='${C.WC}/${D}';}nC B;if(xeB.containsKey(A)){B=xeB[A];B.UV(G,this);}else{B=new nC(A);xeB[A]=B;B.UV(G,this);}return B;}}class nC extends KB{final String WC;bool HZ=false;String name;oM yeB;oH zeB;bool get tRB{if(zeB==null){return false;}return zeB.AfB!=null;}RB get vN{if(tRB){return zeB.AfB;}else{return null;}}nC(this.WC){BfB();}void BfB(){if(WC=='/'){name='/';}else{name=WC.split('/').last;}}Stream<mH> CfB(LC A){if(yeB==null){yeB=Pq(A);}return yeB.stream;}oM Pq(LC A){return new oM(this,A);}void DfB(LC A,B(RB update),int C){if(zeB==null){zeB=new oH(this,A);}zeB.listen(B,C);}void EfB(LC B,A(RB update)){if(zeB!=null){zeB.pUB(A);}}Stream<XL> FfB(Map A,LC B,[int C=f.o,Hl D]){return new d0(this,B,A,C,D).GfB;}void UV(Map H,qQ G){String C;if(WC=='/'){C='/';}else{C='${WC}/';}H.forEach((String A,B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){JB[A]=B;}else if(B is Map){KB D=G.CM('${C}/${A}');Z[A]=D;if(D is nC){D.UV(B,G);}}});}void mZ(){L.clear();JB.clear();Z.clear();}Map PE({bool includeValue: true}){var A={};A.addAll(L);A.addAll(JB);for(String C in Z.keys){KB B=Z[C];A[C]=B is nC?B.PE():B.II();}if(includeValue&&zeB!=null&&zeB.AfB!=null){A["?value"]=zeB.AfB.value;A["?value_timestamp"]=zeB.AfB.ts;}return A;}}class Bc extends nC{Bc(String A):super(A);}class nH{final LC PB;final int OE;final Map data;final pQ cS;bool HfB=false;bool get isClosed=>HfB;nH(this.PB,this.OE,this.cS,this.data);String FF=DC.nM;void L_(){PB.QY(data);}void IfB(Map A){if(A["stream"] is String){FF=A["stream"];}List C;List D;Map G;if(A["updates"] is List){C=A["updates"];}if(A["columns"] is List){D=A["columns"];}if(A["meta"] is Map){G=A["meta"];}if(FF==DC.QD){PB.JfB.remove(OE);}a B;if(A.containsKey("error")&&A["error"] is Map){B=new a.MWB(A["error"]);PB.KfB.add(B);}cS.xJ(FF,C,D,G,B);}void LfB([a A]){if(FF!=DC.QD){FF=DC.QD;cS.xJ(DC.QD,null,null,null,A);}}void close(){PB.b7(this);}}class XL extends fI{List F_;List<cG> tD;List dS;a error;Map meta;XL(this.dS,this.F_,this.tD,String A,{this.meta,this.error}):super(A);List<List> MfB;List<List> get BL{int C=-1;if(tD!=null){C=tD.length;}if(MfB==null){MfB=[] ;if(dS==null){return MfB;}for(Object A in dS){List<dynamic> B;if(A is List){if(A.length<C){B=A.toList();for(int D=A.length;D<C; ++D){B.add(tD[D].defaultValue);}}else if(A.length>C){if(C==-1){B=A.toList();}else{B=A.sublist(0,C);}}else{B=A;}}else if(A is Map){B=[] ;if(tD==null){Map H=A;List<String> I=H.keys.map((J)=>J.toString()).toList();tD=I.map((K)=>new cG(K,"dynamic")).toList();}if(tD!=null){for(cG G in tD){if(A.containsKey(G.name)){B.add(A[G.name]);}else{B.add(G.defaultValue);}}}}MfB.add(B);}}return MfB;}}class d0 implements pQ{static List<cG> nGB(nC B){Object A=B.NG(r'$columns');if(A is!List&&B.mD!=null){A=B.mD.NG(r'$columns');}if(A is List){return cG.uk(A);}return null;}final nC e;final LC PB;StreamController<XL> NfB;Stream<XL> GfB;nH OfB;List<cG> PfB;String mode='stream';String D9=DC.nM;d0(this.e,this.PB,Map D,[int A=f.o,Hl B]){NfB=new StreamController<XL>();NfB.done.then(QfB);GfB=NfB.stream;var C=<String,dynamic>{'method':'invoke','path':e.WC,'params':D};if(A!=f.o){C['permit']=f.rk[A];}OfB=PB.RfB(C,this);if(B!=null){B(OfB);}}void QfB(A){if(OfB!=null&&OfB.FF!=DC.QD){OfB.close();}}void xJ(String A,List D,List C,Map B,a G){if(B!=null&&B['mode'] is String){mode=B['mode'];}if(C!=null){if(PfB==null||mode=='refresh'){PfB=cG.uk(C);}else{PfB.addAll(cG.uk(C));}}else if(PfB==null){PfB=nGB(e);}if(G!=null){A=DC.QD;NfB.add(new XL(null,null,null,A,error:G,meta:B));}else if(D!=null||B!=null||A!=D9){NfB.add(new XL(D,C,PfB,A,meta:B));}D9=A;if(A==DC.QD){NfB.close();}}void onDisconnect(){}void ZZ(){}}class mH extends fI{List<String> wC;nC e;mH(this.e,this.wC,String A):super(A);}class Il{final nC e;final LC PB;StreamSubscription EM;bool hZ=false;Il(this.e,this.PB,void B(RequesterListUpdate)){EM=PB.list(e.WC).listen((mH A){hZ=A.FF!=DC.nM;B(A);});}void cancel(){EM.cancel();}}class oM implements pQ,bG{final nC e;final LC PB;YK<mH> NfB;Stream<mH> get stream=>NfB.stream;nH request;oM(this.e,this.PB){NfB=new YK<mH>(EV,SfB,TfB);}String Zf;void onDisconnect(){Zf=RB.QT();e.L[r'$disconnectedTs']=Zf;NfB.add(new mH(e,[r'$disconnectedTs'],request.FF));}void ZZ(){if(Zf!=null){e.L.remove(r'$disconnectedTs');Zf=null;wC.add(r'$disconnectedTs');}}LinkedHashSet<String> wC=new LinkedHashSet<String>();void xJ(String I,List G,List J,Map K,a M){bool H=false;if(G!=null){for(Object B in G){String A;Object C;bool D=false;if(B is Map){if(B['name'] is String){A=B['name'];}else{continue;}if(B['change']=='remove'){D=true;}else{C=B['value'];}}else if(B is List){if(B.length>0&&B[0] is String){A=B[0];if(B.length>1){C=B[1];}}else{continue;}}else{continue;}if(A.startsWith(r'$')){if(!H&&(A==r'$is'||A==r'$base'||(A==r'$disconnectedTs'&&C is String))){H=true;e.mZ();}if(A==r'$is'){hSB(C);}wC.add(A);if(D){e.L.remove(A);}else{e.L[A]=C;}}else if(A.startsWith('@')){wC.add(A);if(D){e.JB.remove(A);}else{e.JB[A]=C;}}else{wC.add(A);if(D){e.Z.remove(A);}else if(C is Map){e.Z[A]=PB.BO.Zh(e,A,C);}}}if(request.FF!=DC.nM){e.HZ=true;}if(UfB){VfB();}Sg();}}Il WfB;void hSB(String B){XfB=true;String A=B;if(!A.startsWith('/')){Object C=e.L[r'$base'];if(C is String){A='${C}/defs/profile/${A}';}else{A='/defs/profile/${A}';}}if(e.mD is nC&&(e.mD as nC).WC==A){return;}e.mD=PB.BO.T8(A,B);if(B=='node'){return;}if((e.mD is nC)&&!(e.mD as nC).HZ){XfB=false;WfB=new Il(e.mD,PB,YfB);}}static const List<String> oGB=const[r'$is',r'$permission',r'$settings'];void YfB(mH A){if(WfB==null){fB.kC('warning, unexpected state of profile loading');return;}WfB.cancel();WfB=null;wC.addAll(A.wC.where((B)=>!oGB.contains(B)));XfB=true;Sg();}bool XfB=true;void Sg(){if(XfB){if(request.FF!=DC.nM){NfB.add(new mH(e,wC.toList(),request.FF));wC.clear();}if(request.FF==DC.QD){NfB.close();}}}bool UfB=false;void VfB(){UfB=false;}void EV(){if(request==null&&!Fa){Fa=true;PB.OY(this);}}bool Fa=false;void OV(int A,int B){if(!Fa){return;}request=PB.RfB({'method':'list','path':e.WC},this);Fa=false;}void JY(int A,int B,int C){}void TfB(B(mH update)){if(XfB&&request!=null){bC.tO((){if(request==null){return;}var A=<String>[] ;A..addAll(e.L.keys)..addAll(e.JB.keys)..addAll(e.Z.keys);mH C=new mH(e,A,request.FF);B(C);});}}void SfB(){ZfB();}void ZfB(){Fa=false;if(WfB!=null){WfB.cancel();WfB=null;}if(request!=null){PB.b7(request);request=null;}NfB.close();e.yeB=null;}}class b0 implements pQ{final Completer<fI> kN=new Completer<fI>();Future<fI> get future=>kN.future;final LC PB;final String path;nH OfB;b0(this.PB,this.path){var A=<String,dynamic>{'method':'remove','path':path};OfB=PB.RfB(A,this);}void xJ(String A,List B,List C,Map D,a G){kN.complete(new fI(A));}void onDisconnect(){}void ZZ(){}}class c0 implements pQ{final Completer<fI> kN=new Completer<fI>();Future<fI> get future=>kN.future;final LC PB;final String path;final Object value;nH OfB;c0(this.PB,this.path,this.value,[int A=f.o]){var B=<String,dynamic>{'method':'set','path':path,'value':value};if(A!=f.o){B['permit']=f.rk[A];}OfB=PB.RfB(B,this);}void xJ(String A,List C,List D,Map G,a B){kN.complete(new fI(A,B));}void onDisconnect(){}void ZZ(){}}class Gl implements StreamSubscription{nO callback;LC PB;String path;Gl(this.PB,this.path,this.callback);Future cancel(){if(callback!=null){PB.GL(path,callback);callback=null;}return null;}Future asFuture([A]){return null;}bool get isPaused=>false;void onData(void A(data)){}void onDone(void A()){}void onError(Function A){}void pause([Future A]){}void resume(){}}class Jl implements pQ{zb request;Jl();void onDisconnect(){}void ZZ(){}void xJ(String A,List B,List C,Map D,a G){}}class zb extends nH implements bG{int DZ=0;int dRB(){do{if(DZ<0x7FFFFFFF){ ++DZ;}else{DZ=1;}}while(vZ.containsKey(DZ));return DZ;}final Map<String,oH> dC=new Map<String,oH>();final Map<int,oH> vZ=new Map<int,oH>();zb(LC A,int B):super(A,B,new Jl(),null){(cS as Jl).request=this;}void L_(){aH();}void LfB([a A]){if(dC.isNotEmpty){afB.addAll(dC.keys);}bfB=0;cfB=-1;dfB=false;}void IfB(Map K){List I=K['updates'];if(I is List){for(Object A in I){String B;int C=-1;Object G;String H;Map J;if(A is Map){if(A['ts'] is String){B=A['path'];H=A['ts'];if(A['path'] is String){B=A['path'];}else if(A['sid'] is int){C=A['sid'];}else{continue;}}G=A['value'];J=A;}else if(A is List&&A.length>2){if(A[0] is String){B=A[0];}else if(A[0] is int){C=A[0];}else{continue;}G=A[1];H=A[2];}else{continue;}oH D;if(B!=null){D=dC[B];}else if(C>-1){D=vZ[C];}if(D!=null){var M=new RB(G,ts:H,meta:J);D.YP(M);}}}}HashSet<String> afB=new HashSet<String>();void addSubscription(oH A,int C){String B=A.e.WC;dC[B]=A;vZ[A.qF]=A;aH();afB.add(B);}void EUB(oH A){String B=A.e.WC;if(dC.containsKey(B)){Kh[dC[B].qF]=dC[B];aH();}else if(vZ.containsKey(A.qF)){fB.BC('unexpected remoteSubscription in the requester, sid: ${A.qF}');}}Map<int,oH> Kh=new Map<int,oH>();void OV(int K,int D){efB=false;if(D!=-1){bfB++ ;cfB=D;}if(PB.connection==null){return;}List B=[] ;HashSet<String> I=afB;afB=new HashSet<String>();for(String C in I){if(dC.containsKey(C)){oH A=dC[C];Map G={'path':C,'sid':A.qF};if(A.lN>0){G['qos']=A.lN;}B.add(G);}}if(!B.isEmpty){PB.RfB({'method':'subscribe','paths':B},null);}if(!Kh.isEmpty){List H=[] ;Kh.forEach((int J,oH A){if(A.pC.isEmpty){H.add(J);dC.remove(A.e.WC);vZ.remove(A.qF);A.ZfB();}});PB.RfB({'method':'unsubscribe','sids':H},null);Kh.clear();}}bool efB=false;int bfB=0;int cfB=-1;void JY(int A,int B,int C){if(A==cfB){bfB=0;}else{bfB-- ;}if(dfB){dfB=false;aH();}}bool dfB=false;void aH(){if(dfB){return;}if(bfB>bG.qk){dfB=true;return;}if(!efB){efB=true;PB.OY(this);}}}class oH{final nC e;final LC PB;Map<Function,int> pC=new Map<Function,int>();int lN=-1;int qF;oH(this.e,this.PB){qF=PB.ffB.dRB();}void listen(B(RB update),int A){if(A<0||A>3){A=0;}bool C=false;if(pC.containsKey(B)){pC[B]=A;C=D$();}else{pC[B]=A;if(A>lN){C=true;lN=A;}if(AfB!=null){B(AfB);}}if(C){PB.ffB.addSubscription(this,lN);}}void pUB(A(RB update)){if(pC.containsKey(A)){int B=pC.remove(A);if(pC.isEmpty){PB.ffB.EUB(this);}else if(B==lN&&lN>1){D$();}}}bool D$(){int A=0;for(var B in pC.values){A=(B>A?B:A);}if(A!=lN){lN=A;return true;}return false;}RB AfB;void YP(RB A){AfB=A;for(Function B in pC.keys.toList()){B(AfB);}}void ZfB(){pC.clear();e.zeB=null;}}typedef Y Hl<Y>(nH _0);abstract class pQ{}class fI{final String FF;final a error;fI(this.FF,[this.error=null]);}class LC extends ub{Map<int,nH> JfB=new Map<int,nH>();final qQ BO;zb ffB;LC([qQ A]):BO=A!=null?A:new qQ(){ffB=new zb(this,0);JfB[0]=ffB;}int get j_{return ffB.dC.length;}void onData(List B){for(Object A in B){if(A is Map){gfB(A);}}}void gfB(Map A){if(A['rid'] is int&&JfB.containsKey(A['rid'])){JfB[A['rid']].IfB(A);}}StreamController<a> KfB=new StreamController<a>.broadcast();Stream<a> get onError=>KfB.stream;int pP=0;int cRB(){do{if(pP<0x7FFFFFFF){ ++pP;}else{pP=1;}}while(JfB.containsKey(pP));return pP;}oO qU(int A,int B){oO C=super.qU(A,B);return C;}nH RfB(Map<String,dynamic> A,pQ C){A['rid']=cRB();nH B;if(C!=null){B=new nH(this,pP,C,A);JfB[pP]=B;}QY(A);return B;}Gl TG(String A,B(RB update),[int C=0]){nC D=BO.CM(A);D.DfB(this,B,C);return new Gl(this,A,B);}Future<nC> CM(String C){var A=new Completer<nC>();StreamSubscription B;B=list(C).listen((D){if(!A.isCompleted){A.complete(D.e);}if(B!=null){B.cancel();}},onError:(G,H){if(!A.isCompleted){A.completeError(G,H);}},cancelOnError:true);return A.future;}void GL(String A,B(RB update)){nC C=BO.CM(A);C.EfB(this,B);}Stream<mH> list(String A){nC B=BO.CM(A);return B.CfB(this);}Stream<XL> invoke(String A,[Map B=const{},int C=f.o,Hl D]){nC G=BO.CM(A);return G.FfB(B,this,C,D);}Future<fI> set(String A,Object B,[int C=f.o]){return new c0(this,A,B,C).future;}Future<fI> remove(String A){return new b0(this,A).future;}void b7(nH A){if(JfB.containsKey(A.OE)){if(A.FF!=DC.QD){QY({'method':'close','rid':A.OE});}JfB.remove(A.OE);A.LfB();}}bool hfB=false;void DJ(){if(!hfB)return;hfB=false;var B=new Map<int,nH>();B[0]=ffB;JfB.forEach((C,A){if(A.OE<=pP&&A.cS is!oM){A.LfB(a.U0);}else{B[A.OE]=A;A.cS.onDisconnect();}});JfB=B;}void JM(){if(hfB)return;hfB=true;super.JM();JfB.forEach((B,A){A.cS.ZZ();A.L_();});}}class ST{final String name;final String type;final Object defaultValue;ST.NWB(this.name,Map A):type=A.containsKey('type')?A['type']:'string',defaultValue=A.containsKey('default')?A['default']:null{}a NO(Object B,YL A,d C){if(A.L[name]!=B){A.L[name]=B;A.gB(name);}return null;}a QS(YL A,d B){if(A.L.containsKey(name)){A.L.remove(name);A.gB(name);}return null;}}class VT{static const Map vGB=const{r'$is':const{'type':'profile'},r'$interface':const{'type':'interface'},r'$permissions':const{'type':'list','require':f.o,'writable':f.o},r'$name':const{'type':'string'},r'$type':const{'type':'type'},r'$invokable':const{'type':'permission','default':'read'},r'$writable':const{'type':'permission','default':'never'},r'$settings':const{'type':'map'},r'$params':const{'type':'list'},r'$columns':const{'type':'list'},r'$streamMeta':const{'type':'list'}};static final VT g0=new VT()..load(vGB);static final ST wGB=new ST.NWB('',const{});static ST Ec(String A,KB B){if(g0.L.containsKey(A)){return g0.L[A];}if(B is qO&&B.L.containsKey(A)){return B.L[A];}return wGB;}Map<String,ST> L={};void load(Map C){C.forEach((A,B){if(B is Map){L[A]=new ST.NWB(A,B);}});}}typedef W Ll(Map _0,d _1,W _2,s _3);class qO extends YL{final jF provider;qO(String A,this.provider):super(A){this.L[r"$is"]="static";}Ll ifB;void XUB(Ll A){ifB=A;}W invoke(Map<String,dynamic> H,d B,W A,KB C,[int G=f.o]){if(ifB==null){return A..close(a.bGB);}String I=C is s?C.path:null;int D=B.EC.aF.OG(I,B);if(G<D){D=G;}if(rf()<=D){ifB(H,B,A,C);return A;}else{return A..close(a.eI);}}}abstract class Kl extends jF{Map<String,s> get m;}abstract class YL extends s{YL(String A):super(A);Map GJ(bool D){var C={};L.forEach((B,A){C[B]=A;});JB.forEach((B,A){C[B]=A;});Z.forEach((B,A){if(D){if(A is YL){C[B]=A.GJ(true);}else{C[B]=A.II();}}});return C;}bool jfB=false;bool get L9=>jfB;void load(Map G){if(jfB){L.clear();JB.clear();Z.clear();}String C;if(path=='/'){C='/';}else{C='${path}/';}G.forEach((String A,B){if(A.startsWith(r'$')){L[A]=B;}else if(A.startsWith('@')){JB[A]=B;}else if(B is Map){KB D=provider.OB('${C}${A}',false);if(D is YL){D.load(B);}Z[A]=D;}});jfB=true;}void gB(String A){QG.add(A);}FB QI(String A,Object B,d D,FB C){if(!JB.containsKey(A)||JB[A]!=B){JB[A]=B;gB(A);if(provider is dG){(provider as dG).OI();}}return C..close();}FB Os(String A,d C,FB B){if(JB.containsKey(A)){JB.remove(A);gB(A);if(provider is dG){(provider as dG).OI();}}return B..close();}FB NO(String B,Object C,d D,FB A){var G=VT.Ec(B,mD);A.close(G.NO(C,this,D));return A;}FB QS(String A,d B,FB C){var D=VT.Ec(A,mD);return C..close(D.QS(this,B));}FB PC(Object A,d C,FB B,[int D=f.o]){q(A);return B..close();}}abstract class bW{}class rGB implements bW{int OG(String A,d B){return f.o;}}abstract class cW{}abstract class sQ{String get EQ;LH b8(String A);void aq(String A);Future<List<LH>> load();void destroy();}abstract class LH{final String path;final sQ lC;int fZ;LH(this.path,this.lC);void YP(RB A);void PC(Iterable<RB> A,RB B);void Ps(RB A);void K$(Iterable<RB> A){}void destroy();List<RB> Y8();}abstract class WT{}abstract class XT{String get key;void PC(Object A);Future i8();void destroy();}typedef dynamic qM(jE _0);class jE{String path;String type;String wI;String H7;int OE;List get Us=>[path,type,OE,H7,wI];jE(this.path,this.type,this.OE,[this.wI='',this.H7]);}abstract class s extends KB{YK<String> kfB;YK<String> get QG{if(kfB==null){kfB=new YK<String>((){NS();},(){Pg();},null,true);}return kfB;}void q9(YK<String> A){kfB=A;}Stream<String> get br=>QG.stream;void NS(){}void Pg(){}bool get lfB=>kfB?.hasListener??false;jF get provider;final String path;s(this.path);Map<nO,int> pC=new Map<nO,int>();pM TG(A(RB update),[int B=0]){pC[A]=B;return new pM(this,A);}void GL(nO A){if(pC.containsKey(A)){pC.remove(A);}}RB mfB;RB get vN{if(mfB==null){mfB=new RB(null);}return mfB;}dynamic get value{if(mfB!=null){return mfB.value;}return null;}bool nfB=false;bool get fh=>nfB;void q(Object A,{bool force: false}){nfB=true;if(A is RB){mfB=A;pC.forEach((B,C){B(mfB);});}else if(mfB==null||mfB.value!=A||force){mfB=new RB(A);pC.forEach((B,C){B(mfB);});}}void ZY(){nfB=false;mfB=null;}bool get exists=>true;bool get H9=>true;String get FI=>null;List Br(){return [[r'$disconnectedTs',FI]];}bool get hasSubscriber=>pC.isNotEmpty;int rf(){return f.dI(NG(r'$invokable'));}int g8(){return f.dI(NG(r'$writable'));}W invoke(Map<String,dynamic> B,d C,W A,KB D,[int G=f.o]){return A..close();}FB QI(String A,Object C,d D,FB B){if(B!=null){return B..close();}else{if(!A.startsWith("@")){A="@${A}";}JB[A]=C;if(provider is dG){(provider as dG).OI();}return null;}}FB Os(String A,d C,FB B){if(B!=null){return B..close();}else{if(!A.startsWith("@")){A="@${A}";}JB.remove(A);if(provider is dG){(provider as dG).OI();}return null;}}FB NO(String A,Object C,d D,FB B){if(B!=null){return B..close();}else{if(!A.startsWith(r"$")){A="\$${A}";}L[A]=C;return null;}}FB QS(String A,d C,FB B){if(B!=null){return B..close();}else{if(!A.startsWith(r"$")){A="\$${A}";}L.remove(A);return null;}}FB PC(Object B,d C,FB A,[int D=f.o]){return A..close();}operator[](String A){return get(A);}operator[]=(String A,Object B){if(A.startsWith(r"$")){L[A]=B;}else if(A.startsWith(r"@")){JB[A]=B;}else if(B is KB){sB(A,B);}}void load(Map<String,dynamic> A){}}abstract class jF{s pB(String A);s OB(String A,[bool B=true]);s operator[](String A){return pB(A);}s operator~()=>OB("/",false);d dY(String A,String B);bW get aF;}class d extends ub{String DQ;int oSB=bG.P0;sQ lC;int Kg=f.o;void BSB(sQ D,List<LH> B){if(lC!=null){lC.destroy();}lC=D;if(lC!=null&&B!=null){for(LH A in B){var C=A.Y8();s G=EC.OB(A.path,false);yF H=ofB.add(A.path,G,-1,A.fZ);if(C.isNotEmpty){H.JUB(C);}}}}List<String> groups=[] ;void BK(List<String> B,[bool C=false]){if(C){groups=B.where((A)=>A!='').toList();}else{groups=[DQ]..addAll(B.where((A)=>A!=''));}}final Map<int,FB> pfB=new Map<int,FB>();int get STB{return pfB.length;}int get j_{return ofB.dC.length;}Dc ofB;final jF EC;d(this.EC,[this.DQ]){ofB=new Dc(this,0);pfB[0]=ofB;if(DQ!=null){groups=[DQ];}}FB AI(FB A,[NB D=null,Object G=null]){if(A.qfB!=DC.QD){pfB[A.OE]=A;if(rfB!=null){jE B=A.rU();for(qM C in rfB){C(B);}}}else{if(rfB!=null){jE B=A.rU('');for(qM C in rfB){C(B);}}}return A;}void u_(FB A){jE B=A.rU('-');for(qM C in rfB){C(B);}}bool o7=false;void onData(List B){if(o7){return;}for(Object A in B){if(A is Map){sfB(A);}}}void sfB(Map A){Object B=A['method'];if(A['rid'] is int){if(B==null){AVB(A);return;}else{if(pfB.containsKey(A['rid'])){if(B=='close'){close(A);}return;}switch (B){case 'list':list(A);return;case 'subscribe':TG(A);return;case 'unsubscribe':GL(A);return;case 'invoke':invoke(A);return;case 'set':set(A);return;case 'remove':remove(A);return;}}}ID(A['rid'],error:a.Bl);}void ID(int A,{FB response,a error}){if(response!=null){if(pfB[response.OE]!=response){return;}response.qfB=DC.QD;A=response.OE;}Map B={'rid':A,'stream':DC.QD};if(error!=null){B['error']=error.GJ();}pfB.remove(A);QY(B);}void ah(FB A,List C,{String streamStatus,List<dynamic> columns,Map meta,void handleMap(Map m)}){if(pfB[A.OE]==A){Map B={'rid':A.OE};if(streamStatus!=null&&streamStatus!=A.qfB){A.qfB=streamStatus;B['stream']=streamStatus;}if(columns!=null){B['columns']=columns;}if(C!=null){B['updates']=C;}if(meta!=null){B['meta']=meta;}if(handleMap!=null){handleMap(B);}QY(B);if(A.qfB==DC.QD){pfB.remove(A.OE);if(rfB!=null){u_(A);}}}}void list(Map A){NB B=NB.wb(A['path']);if(B!=null&&B.isAbsolute){int C=A['rid'];tfB(B,(s D){AI(new e0(this,C,D),B);},(G,H){var I=new a("nodeError",msg:G.toString(),detail:H.toString());ID(A['rid'],error:I);});}else{ID(A['rid'],error:a.WW);}}void TG(Map B){if(B['paths'] is List){for(Object A in B['paths']){String D;int G=0;int H=-1;if(A is Map){if(A['path'] is String){D=A['path'];}else{continue;}if(A['sid'] is int){H=A['sid'];}else{continue;}if(A['qos'] is int){G=A['qos'];}}NB C=NB.wb(D);if(C!=null&&C.isAbsolute){tfB(C,(s I){ofB.add(C.path,I,H,G);ID(B['rid']);},(J,K){var M=new a("nodeError",msg:J.toString(),detail:K.toString());ID(B['rid'],error:M);});}else{ID(B['rid']);}}}else{ID(B['rid'],error:a.T0);}}void tfB(NB I,AR<s> G,[RHB<dynamic,dynamic> B]){try {s A=EC.OB(I.path,false);if(A is UT){(A as UT).h9.then((H){if(H is s){A=H;}G(A);}).catchError((C,D){if(B!=null){B(C,D);}});}else{G(A);}}catch (C,D){if(B!=null){B(C,D);}else{rethrow;}}}void GL(Map A){if(A['sids'] is List){for(Object B in A['sids']){if(B is int){ofB.remove(B);}}ID(A['rid']);}else{ID(A['rid'],error:a.T0);}}void invoke(Map A){NB C=NB.wb(A['path']);if(C!=null&&C.isAbsolute){int M=A['rid'];s D;D=EC.OB(C.AC,false);H([s J]){s B=J==null?EC.pB(C.path):J;if(B==null){if(J==null){B=D.HI(C.name);if(B==null){ID(A['rid'],error:a.eI);return;}if(B is UT){(B as UT).h9.then((N)=>H(B));return;}else{H(B);return;}}else{ID(A['rid'],error:a.eI);return;}}int I=EC.aF.OG(C.path,this);int K=f.dI(A['permit']);if(K<I){I=K;}Map<String,dynamic> G;if(A["params"] is Map<String,dynamic>){G=A["params"] as Map<String,dynamic>;}if(G==null){G={};}if(B.rf()<=I){B.invoke(G,this,AI(new W(this,M,D,B,C.name),C,G),D,I);}else{ID(A['rid'],error:a.eI);}}if(D is UT){(D as UT).h9.then((N){H();}).catchError((O,Q){var S=new a("nodeError",msg:O.toString(),detail:Q.toString());ID(A['rid'],error:S);});}else{H();}}else{ID(A['rid'],error:a.WW);}}void AVB(Map A){int B=A['rid'];if(pfB[B] is W){if(A['params'] is Map){(pfB[B] as W).HVB(A['params']);}}else{ID(A['rid'],error:a.Bl);}}void set(Map B){NB A=NB.S0(B['path']);if(A==null||!A.isAbsolute){ID(B['rid'],error:a.WW);return;}if(!B.containsKey('value')){ID(B['rid'],error:a.Cl);return;}Object G=B['value'];int H=B['rid'];if(A.yY){tfB(A,(s C){int D=EC.aF.OG(C.path,this);int I=f.dI(B['permit']);if(I<D){D=I;}if(C.g8()<=D){C.PC(G,this,AI(new FB(this,H,'set'),A,G));}else{ID(B['rid'],error:a.eI);}},(J,K){var M=new a("nodeError",msg:J.toString(),detail:K.toString());ID(B['rid'],error:M);});}else if(A.s8){s C;C=EC.OB(A.AC,false);int D=EC.aF.OG(C.path,this);if(D<f.o){ID(B['rid'],error:a.eI);}else{C.NO(A.name,G,this,AI(new FB(this,H,'set'),A,G));}}else if(A.Tr){s C;C=EC.OB(A.AC,false);int D=EC.aF.OG(C.path,this);if(D<f.lQ){ID(B['rid'],error:a.eI);}else{C.QI(A.name,G,this,AI(new FB(this,H,'set'),A,G));}}else{throw 'unexpected case';}}void remove(Map C){NB A=NB.S0(C['path']);if(A==null||!A.isAbsolute){ID(C['rid'],error:a.WW);return;}int G=C['rid'];if(A.yY){ID(C['rid'],error:a.Bl);}else if(A.s8){s B;B=EC.OB(A.AC,false);int D=EC.aF.OG(B.path,this);if(D<f.o){ID(C['rid'],error:a.eI);}else{B.QS(A.name,this,AI(new FB(this,G,'set'),A));}}else if(A.Tr){s B;B=EC.OB(A.AC,false);int D=EC.aF.OG(B.path,this);if(D<f.lQ){ID(C['rid'],error:a.eI);}else{B.Os(A.name,this,AI(new FB(this,G,'set'),A));}}else{throw 'unexpected case';}}void close(Map B){if(B['rid'] is int){int A=B['rid'];if(pfB.containsKey(A)){pfB[A].ufB();FB C=pfB.remove(A);if(rfB!=null){u_(C);}}}}void DJ(){AQB();pfB.forEach((B,A){A.ufB();});pfB.clear();pfB[0]=ofB;}void JM(){super.JM();}List<qM> rfB;void rp(qM A){ofB.rp(A);pfB.forEach((int C,FB B){A(B.rU());});if(rfB==null)rfB=new List<qM>();rfB.add(A);}}class FB implements bG{final d OC;final int OE;String type;String qfB=DC.nM;FB(this.OC,this.OE,[this.type=null]);void close([a A=null]){qfB=DC.QD;OC.ID(OE,error:A,response:this);}void ufB(){}void aH(){if(!vfB){vfB=true;OC.OY(this);}}bool vfB=false;void OV(int A,int B){vfB=false;}void JY(int A,int B,int C){}jE rU([String A='+']){return null;}}typedef void f0(W _0);typedef void qGB(W _0,Map _1);typedef bool tGB(W _0,Map _1);class TT{String status;List tD;List dS;Map meta;TT(this.status,this.dS,this.tD,this.meta);}class W extends FB{final s DO;final s e;final String name;W(d A,int B,this.DO,this.e,this.name):super(A,B,'invoke');List<TT> OS=new List<TT>();bool wfB=false;void TB(List A,{List columns,String streamStatus: DC.nQ,Map meta,bool autoSendColumns: true}){if(meta!=null&&meta['mode']=='refresh'){OS.length=0;}if(!wfB){if(columns==null&&autoSendColumns&&e!=null&&e.L[r"$columns"] is List){columns=e.L[r"$columns"];}}if(columns!=null){wfB=true;}OS.add(new TT(streamStatus,A,columns,meta));aH();}tGB Ug;void HVB(Map A){if(Ug!=null){Ug(this,A);}}void OV(int D,int G){vfB=false;if(xfB!=null){OC.ID(OE,response:this,error:xfB);if(qfB==DC.QD){ufB();}return;}for(TT A in OS){List<Map<String,dynamic>> B;if(A.tD!=null){B=cG.XGB(A.tD);}OC.ah(this,A.dS,streamStatus:A.status,columns:B,meta:A.meta,handleMap:(C){if(k9!=null){k9(this,C);}});if(qfB==DC.QD){ufB();break;}}OS.length=0;}void close([a A=null]){if(A!=null){xfB=A;}if(!OS.isEmpty){OS.last.status=DC.QD;}else{OS.add(new TT(DC.QD,null,null,null));aH();}}a xfB;f0 ZF;qGB k9;void ufB(){if(ZF!=null){ZF(this);}}jE rU([String A='+']){return new jE(DO.path,'invoke',OE,A,name);}}class e0 extends FB{s e;StreamSubscription yfB;int zfB;e0(d A,int B,this.e):super(A,B,'list'){zfB=A.EC.aF.OG(e.path,A);yfB=e.br.listen(changed);if(e.H9){aH();}else if(e.FI!=null){aH();}}LinkedHashSet<String> wC=new LinkedHashSet<String>();bool Rr=true;void changed(String A){if(zfB==f.TW){return;}if(A.startsWith(r'$$')){if(zfB<f.o){return;}if(A.startsWith(r'$$$')){return;}}if(wC.isEmpty){wC.add(A);aH();}else{wC.add(A);}}bool AgB=false;void OV(int V,int S){vfB=false;if(S!=-1){BgB++ ;CgB=S;}Object I;Object M;List G=[] ;List N=[] ;List O=[] ;if(e.FI!=null){OC.ah(this,e.Br(),streamStatus:DC.nQ);AgB=true;wC.clear();return;}if(AgB&&!wC.contains(r'$disconnectedTs')){AgB=false;G.add({'name':r'$disconnectedTs','change':'remove'});if(e.L.containsKey(r'$disconnectedTs')){e.L.remove(r'$disconnectedTs');}}if(Rr||wC.contains(r'$is')){if(!Rr){var Q=OC.EC.pB(e.path);if(Q!=null&&e!=Q)e=Q;}Rr=false;if(zfB==f.TW)return;e.L.forEach((C,J){Object B=[C,J];if(C==r'$is'){I=B;}else if(C==r'$base'){M=B;}else if(C.startsWith(r'$$')){if(zfB==f.o&&!C.startsWith(r'$$$')){G.add(B);}}else{if(zfB!=f.o){if(C==r'$writable'){if(zfB<f.lQ){return;}}if(C==r'$invokable'){int D=f.dI(e.NG(r'$invokable'));if(D>zfB){G.add([r'$invokable','never']);return;}}}G.add(B);}});e.JB.forEach((C,J){N.add([C,J]);});e.Z.forEach((C,KB J){Map H=J.II();if(zfB!=f.o){int D=f.dI(H[r'$invokable']);if(D!=f.UW&&D>zfB){H[r'$invokable']='never';}}O.add([C,H]);});if(I==null){I=[r'$is','node'];}}else{for(String A in wC){Object B;if(A.startsWith(r'$')){if(zfB!=f.o){if(A==r'$writable'){if(zfB<f.lQ){continue;}}if(A==r'$invokable'){int D=f.dI(e.NG(r'$invokable'));if(D>zfB){G.add([r'$invokable','never']);continue;}}}if(e.L.containsKey(A)){B=[A,e.L[A]];}else{B={'name':A,'change':'remove'};}if(zfB==f.o||!A.startsWith(r'$$')){G.add(B);}}else if(A.startsWith(r'@')){if(e.JB.containsKey(A)){B=[A,e.JB[A]];}else{B={'name':A,'change':'remove'};}N.add(B);}else{if(e.Z.containsKey(A)){Map H=e.Z[A].II();if(zfB!=f.o){int D=f.dI(H[r'$invokable']);if(D!=f.UW&&D>zfB){H[r'$invokable']='never';}}B=[A,H];}else{B={'name':A,'change':'remove'};}O.add(B);}}}wC.clear();List K=[] ;if(M!=null){K.add(M);}if(I!=null){K.add(I);}K..addAll(G)..addAll(N)..addAll(O);OC.ah(this,K,streamStatus:DC.nQ);}int BgB=0;int CgB=-1;void JY(int A,int B,int C){if(A==CgB){BgB=0;}else{BgB-- ;}if(DgB){DgB=false;aH();}}bool DgB=false;void aH(){if(DgB){return;}if(BgB>bG.qk){DgB=true;return;}if(!vfB){vfB=true;OC.OY(this);}}void ufB(){yfB.cancel();}jE rU([String A='+']){return new jE(e.path,'list',OE,A,null);}}class pM{nO callback;s e;pM(this.e,this.callback);void cancel(){if(callback!=null){e.GL(callback);callback=null;}}}class Dc extends FB{Dc(d A,int B):super(A,B,'subscribe');final Map<String,yF> dC=new Map<String,yF>();final Map<int,yF> OO=new Map<int,yF>();final LinkedHashSet<yF> changed=new LinkedHashSet<yF>();yF add(String C,s D,int B,int G){yF A;if(dC[C]!=null){A=dC[C];if(A.qF!=B){if(A.qF>=0){OO.remove(A.qF);}A.qF=B;if(B>=0){OO[B]=A;}}A.E_=G;if(B>-1&&A.ME!=null){i_(A);}}else{int H=OC.EC.aF.OG(D.path,OC);A=new yF(this,D,B,H>=f.tb,G);dC[C]=A;if(B>=0){OO[B]=A;}if(OC.rfB!=null){jE I=new jE(C,'subscribe',0,'+');for(qM J in OC.rfB){J(I);}}}return A;}void remove(int A){if(OO[A]!=null){yF B=OO[A];OO[A].destroy();OO.remove(A);dC.remove(B.e.path);if(OC.rfB!=null){jE C=new jE(B.e.path,'subscribe',0,'-');for(qM D in OC.rfB){D(C);}}if(OO.isEmpty){BgB=0;}}}void i_(yF A){changed.add(A);aH();}void OV(int D,int A){vfB=false;if(A!=-1){BgB++ ;EgB=A;}List B=new List();for(yF C in changed){B.addAll(C.process(A));}OC.ah(this,B);changed.clear();}int BgB=0;int EgB=-1;void JY(int A,int C,int D){if(A==EgB){BgB=0;}else{BgB-- ;}dC.forEach((String G,yF B){if(B.FgB>0){B.CTB(A);}});if(DgB){DgB=false;aH();}}bool DgB=false;void aH(){if(DgB){return;}if(BgB>bG.qk){DgB=true;return;}if(OC.connection==null){return;}if(!vfB){vfB=true;OC.OY(this);}}void ufB(){List B;dC.forEach((C,yF A){if(A.FgB<2){A.destroy();}else{A.qF=-1;if(B==null){B=new List();}B.add(A);}});dC.clear();if(B!=null){for(yF A in B){dC[A.e.path]=A;}}OO.clear();BgB=0;EgB=-1;DgB=false;vfB=false;}void rp(qM A){dC.forEach((D,B){jE C=new jE(B.e.path,'subscribe',0,'+');A(C);});}}class yF{final s e;final Dc response;pM GgB;int qF;bool HgB=true;List<RB> uG=new List<RB>();ListQueue<RB> RE;RB ME;int FgB=-1;LH IgB;void set E_(int A){if(A<0||A>3)A=0;if(FgB==A)return;FgB=A;if(RE==null&&FgB>0){RE=new ListQueue<RB>();}qPB=(A>0);R7=(A>1);OI=(A>2);GgB=e.TG(YP,FgB);}bool JgB=false;void set qPB(bool A){if(A==JgB)return;JgB=A;if(!JgB){uG.length=0;}}bool R7=false;bool KgB=false;void set OI(bool B){if(B==KgB)return;KgB=B;sQ A=response.OC.lC;if(A!=null){if(KgB){IgB=A.b8(e.path);}else if(IgB!=null){A.aq(e.path);IgB=null;}}}yF(this.response,this.e,this.qF,this.HgB,int A){this.E_=A;if(e.fh&&e.vN!=null){YP(e.vN);}}bool LgB=true;void YP(RB A){A=A.DQB();if(JgB&&LgB){uG.add(A);bool B=(uG.length>response.OC.oSB);if(!B&&!R7&&response.DgB&&uG.length>1){B=true;}if(B){LgB=false;ME=new RB(null,ts:'');for(RB C in uG){ME.pSB(C);}uG.length=0;if(FgB>0){if(IgB!=null){IgB.PC(RE,ME);}RE..clear()..add(ME);}}else{ME=A;if(FgB>0){RE.add(ME);if(IgB!=null){IgB.YP(ME);}}}}else{if(ME!=null){ME=new RB.LWB(ME,A);}else{ME=A;}if(FgB>0){if(IgB!=null){IgB.PC(RE,ME);}RE..clear()..add(ME);}}if(HgB&&qF>-1){response.i_(this);}}List process(int B){List A=new List();if(JgB&&LgB){for(RB C in uG){A.add([qF,C.value,C.ts]);}if(FgB>0){for(RB G in uG){G.Ga=B;}}uG.length=0;}else{if(ME.count>1||ME.status!=null){Map D=ME.rs();D['sid']=qF;A.add(D);}else{A.add([qF,ME.value,ME.ts]);}if(FgB>0){ME.Ga=B;}LgB=true;}ME=null;return A;}void CTB(int A){if(RE.isEmpty){return;}bool B=false;if(!RE.isEmpty&&RE.first.Ga!=A){RB C;for(RB G in RE){if(G.Ga==A){C=G;break;}}if(C!=null){while(!RE.isEmpty&&RE.first!=C){RB D=RE.removeFirst();if(IgB!=null){IgB.Ps(D);B=true;}}}}while(!RE.isEmpty&&RE.first.Ga==A){RB D=RE.removeFirst();if(IgB!=null){IgB.Ps(D);B=true;}}if(B&&IgB!=null){IgB.K$(RE);}}void JUB(List<RB> A){if(this.JgB){if(uG.length>0&&uG.first.LE(A.last)){uG.removeAt(0);}uG=A..addAll(uG);if(RE!=null){RE.clear();RE.addAll(uG);}}else{uG.length=0;if(RE!=null){RE.clear();RE.add(A.last);}}ME=A.last;}void destroy(){if(IgB!=null){sQ A=response.OC.lC;A.aq(e.path);IgB=null;}GgB.cancel();}}typedef s Cc(String _0);typedef vB pGB(String _0);typedef Future<ByteData> sGB(String _0);class uGB{}abstract class UT{}class rQ{W response;List tD;List BL;String status=DC.nQ;Map meta;f0 ZF;rQ([this.tD]);void update(List A,[String B,Map C]){if(this.BL==null){this.BL=A;}else{this.BL.addAll(A);}this.meta=C;if(B!=null){status=B;}if(response==null){new Future(write);}else{write();}}void write([W A]){if(A!=null){if(response==null){response=A;}else{fB.QB("can not use same AsyncTableResult twice");}}if(response!=null&&(BL!=null||meta!=null||status==DC.QD)){response.TB(BL,columns:tD,streamStatus:status,meta:meta);BL=null;tD=null;}}void close(){if(response!=null){response.close();}else{status=DC.QD;}}}class h0{}abstract class dG{}abstract class tQ{}class pH extends Kl implements dG,tQ{static pH Ml;Nc KgB;sGB MgB;final Map<String,s> m=new Map<String,s>();List<pGB> NgB=[] ;s pB(String A){return tfB(A);}s tfB(String B,{bool allowStubs: false}){if(m.containsKey(B)){vB A=m[B];if(allowStubs||A.OgB==false){return A;}}if(NgB.isNotEmpty){for(var C in NgB){var A=C(B);if(A!=null){return A;}}}return null;}s OB(String B,[bool G=true,bool H=true]){s A=tfB(B,allowStubs:true);if(A!=null){if(G){NB C=new NB(B);if(!C.PSB){s D=pB(C.AC);if(D!=null&&!D.Z.containsKey(C.name)){D.sB(C.name,A);D.QG.add(C.name);A.QG.add(r"$is");}}if(A is vB){A.OgB=false;}}return A;}if(G){return JQB(B,H);}else{A=new vB(B,this)..OgB=true;m[B]=A;return A;}}void ZUB(Nc A){KgB=A;}void OI([bool A=false]){if(A){if(KgB==null){return;}KgB();}else{new Future.delayed(const Duration(seconds:5),(){if(KgB==null){return;}KgB();});}}vB JQB(String A,[bool H=true]){NB C=new NB(A);s B=m[A];if(B!=null){if(B is vB){if(B.OgB!=true){throw new Exception("Node at ${A} already exists.");}else{B.OgB=false;}}else{throw new Exception("Node at ${A} already exists.");}}vB D=B==null?new vB(A,this):B;m[A]=D;if(H){D.Qg();}vB G;if(C.AC!=""){G=pB(C.AC);}if(G!=null){G.Z[C.name]=D;G.tr(C.name,D);G.gB(C.name);}return D;}pH([Map<String,dynamic> A,Map<String,Cc> B]){if(Ml==null){Ml=this;}nB=new vB("/",this);m["/"]=nB;Zq=new dW('/defs',this);m[Zq.path]=Zq;ls=new dW('/sys',this);m[ls.path]=ls;init(A,B);}vB nB;dW Zq;dW ls;void init([Map<String,dynamic> B,Map<String,Cc> A]){if(A!=null){if(A.isNotEmpty){PgB.addAll(A);}else{PgB=A;}}if(B!=null){nB.load(B);}}Map PE(){return nB.PE();}void q(String A,Object B){vB C=pB(A);C.q(B);}void v(String B,vB A,{bool registerChildren: false}){if(B=='/'||!B.startsWith('/'))return null;NB C=new NB(B);vB D=pB(C.AC);m[B]=A;A.Qg();if(D!=null){D.Z[C.name]=A;D.tr(C.name,A);D.gB(C.name);}if(registerChildren){for(vB G in A.Z.values){v(G.path,G);}}}vB ze(String B,Map H){if(B=='/'||!B.startsWith('/'))return null;NB G=new NB(B);vB C=tfB(B,allowStubs:true);vB D=pB(G.AC);vB A;if(D!=null){A=D.HTB(G.name,H,this);}if(A==null){String I=H[r'$is'];if(PgB.containsKey(I)){A=PgB[I](B);}else{A=OB(B,true,false);}}if(C!=null){fB.mB("Found old node for ${B}: Copying subscriptions.");for(nO J in C.pC.keys){A.TG(J,C.pC[J]);}if(A is vB){try {A.kfB=C.kfB;A.kfB.EV=(){A.NS();};A.kfB.Og=(){A.Pg();};}catch (K){}if(A.lfB){A.NS();}}}m[B]=A;A.load(H);A.Qg();if(D!=null){D.sB(G.name,A);D.tr(G.name,A);D.gB(G.name);}A.gB(r"$is");if(C!=null){C.gB(r"$is");}return A;}void CQ(String B,{bool recurse: true}){if(B=='/'||!B.startsWith('/'))return;vB A=pB(B);if(A==null){return;}if(recurse){String C=B;if(!C.endsWith("/")){C+= "/";}int I=z0(C,"/");List<String> J=m.keys.where((String H){return H.startsWith(C)&&I==z0(H,"/");}).toList();for(String K in J){CQ(K);}}NB D=new NB(B);vB G=pB(D.AC);A.i9();A.RS=true;if(G!=null){G.Z.remove(D.name);G.DTB(D.name,A);G.gB(D.name);}if(A.pC.isEmpty&&!A.lfB){m.remove(B);}else{A.OgB=true;}}Map<String,Cc> PgB=new Map<String,Cc>();bW aF=new rGB();d dY(String A,String B){return new d(this,A);}String toString({bool showInstances: false}){var A=new StringBuffer();void C(s B,[int D=0]){NB G=new NB(B.path);A.write("${'  '*D}- ${G.name}");if(showInstances){A.write(": ${B}");}A.writeln();for(var H in B.Z.values){C(H,D+1);}}C(nB);return A.toString().trim();}}class vB extends YL{final pH provider;static kO cJ;static mO Fc;static xGB(String A){cJ=new kO();Fc=new mO(UTF8.encode(A).sublist(48,80));}static String yGB(String B){if(B==''){return '';}cJ.reset();cJ.init(true,Fc);Uint8List A=UTF8.encode(B);Uint8List C=new Uint8List((A.length+31)~/32*32);C.setRange(0,A.length,A);return '\u001Bpw:${zF.uM(cJ.process(C))}';}static String zGB(String B){if(B.startsWith('\u001Bpw:')){cJ.reset();cJ.init(false,Fc);String A=UTF8.decode(cJ.process(zF.vO(B.substring(4))));int C=A.indexOf('\u0000');if(C>=0)A=A.substring(0,C);return A;}else if(B.length==22){try {cJ.reset();cJ.init(false,Fc);String A=UTF8.decode(cJ.process(zF.vO(B)));int C=A.indexOf('\u0000');if(C>=0)A=A.substring(0,C);return A;}catch (D){return B;}}else{return B;}}bool OgB=false;vB(String B,[pH A]):provider=A==null?pH.Ml:A,super(B);bool RS=false;bool RUB=true;void load(Map D){if(jfB){L.clear();JB.clear();Z.clear();}String C;if(path=='/'){C='/';}else{C='${path}/';}D.forEach((String A,B){if(A.startsWith('?')){if(A=='?value'){q(B);}}else if(A.startsWith(r'$')){if(cJ!=null&&A.startsWith(r'$$')&&B is String){L[A]=zGB(B);}else{L[A]=B;}}else if(A.startsWith('@')){JB[A]=B;}else if(B is Map){String G='${C}${A}';provider.ze(G,B);}});jfB=true;}Map PE(){Map B={};L.forEach((A,C){if(cJ!=null&&C is String&&A.startsWith(r'$$')&&A.endsWith('password')){B[A]=yGB(C);}else{B[A]=C;}});JB.forEach((A,C){B[A]=C;});if(mfB!=null&&mfB.value!=null){B['?value']=mfB.value;}Z.forEach((A,KB D){if(D is vB&&D.RUB==true){B[A]=D.PE();}});return B;}W invoke(Map<String,dynamic> EB,d IB,W A,KB LB,[int UB=f.o]){Object D;try {D=FTB(EB);}catch (G,M){var H=new a("invokeException",msg:G.toString());try {H.detail=M.toString();}catch (G){}A.close(H);return A;}var N="values";if(L.containsKey(r"$result")){N=L[r"$result"];}if(D==null){if(N=="values"){D={};}else if(N=="table"){D=[] ;}else if(N=="stream"){D=[] ;}}if(D is Iterable){A.TB(D.toList(),streamStatus:DC.QD);}else if(D is Map){var b=[] ;var h=[] ;for(var K in D.keys){b.add({"name":K,"type":"dynamic"});h.add(D[K]);}A.TB([h],columns:b,streamStatus:DC.QD);}else if(D is uGB){A.TB(D.BL,columns:D.tD,streamStatus:DC.QD);}else if(D is a){A.close(D);}else if(D is rQ){(D as rQ).write(A);A.ZF=(var A){if((D as rQ).ZF!=null){(D as rQ).ZF(A);}};return A;}else if(D is vk){A.TB(D.BL,columns:D.tD,streamStatus:DC.QD);}else if(D is Stream){var B=new rQ();A.ZF=(var A){if(B.ZF!=null){B.ZF(A);}};Stream Q=D;if(N=="stream"){StreamSubscription I;B.ZF=(r){if(I!=null){I.cancel();}};I=Q.listen((C){if(C is xk){B.meta=C.meta;return;}else if(C is wk){B.tD=C.tD.map((K)=>K.oY()).toList();return;}if(C is Iterable){B.update(C.toList(),DC.nQ);}else if(C is Map){var O;if(C.containsKey("__META__")){O=C["__META__"];}B.update([C],DC.nQ,O);}else{throw new Exception("Unknown Value from Stream");}},onDone:(){B.close();},onError:(G,M){var H=new a("invokeException",msg:G.toString());try {H.detail=M.toString();}catch (G){}A.close(H);},cancelOnError:true);B.write(A);return A;}else{var S=[] ;StreamSubscription I;B.ZF=(r){if(I!=null){I.cancel();}};I=Q.listen((C){if(C is xk){B.meta=C.meta;return;}else if(C is wk){B.tD=C.tD.map((K)=>K.oY()).toList();return;}if(C is Iterable){S.addAll(C);}else if(C is Map){S.add(C);}else{throw new Exception("Unknown Value from Stream");}},onDone:(){B.update(S);B.close();},onError:(G,M){var H=new a("invokeException",msg:G.toString());try {H.detail=M.toString();}catch (G){}A.close(H);},cancelOnError:true);}B.write(A);return A;}else if(D is Future){var B=new rQ();A.ZF=(var A){if(B.ZF!=null){B.ZF(A);}};D.then((J){if(J is a){A.close(J);}else if(J is h0){B=null;J.QUB(A);}else if(J is Stream){Stream Q=J;StreamSubscription I;B.ZF=(r){if(I!=null){I.cancel();}};I=Q.listen((C){if(C is xk){B.meta=C.meta;return;}else if(C is wk){B.tD=C.tD.map((K)=>K.oY()).toList();return;}if(C is Iterable){B.update(C.toList());}else if(C is Map){var O;if(C.containsKey("__META__")){O=C["__META__"];}B.update([C],DC.nQ,O);}else{throw new Exception("Unknown Value from Stream");}},onDone:(){B.close();},onError:(G,M){var H=new a("invokeException",msg:G.toString());try {H.detail=M.toString();}catch (G){}A.close(H);},cancelOnError:true);}else if(J is vk){vk V=J;B.tD=V.tD.map((K)=>K.oY()).toList();B.update(V.BL,DC.QD,V.meta);B.close();}else{B.update(J is Iterable?J.toList():[J]);B.close();}}).catchError((G,M){var H=new a("invokeException",msg:G.toString());try {H.detail=M.toString();}catch (G){}A.close(H);});B.write(A);return A;}else if(D is h0){D.QUB(A);}else{A.close();}return A;}dynamic FTB(Map<String,dynamic> A){return null;}vB get parent=>provider.pB(new NB(path).AC);bool NTB(Object A)=>false;bool MTB(String A,Object B)=>false;bool LTB(String A,Object B)=>false;void OTB(){}void QTB(){}void Qg(){}void i9(){}void DTB(String A,KB B){}void tr(String A,KB B){}pM TG(nO A,[int B=0]){OTB();return super.TG(A,B);}void GL(nO A){QTB();super.GL(A);}vB HTB(String A,Map B,pH C){return null;}vB HQB(String B,[Map A]){var C=new NB(path).Jq(B).path;return provider.ze(C,A==null?{}:A);}String get name=>new NB(path).name;String get AM=>L[r"$name"];set AM(String A){if(A==null){L.remove(r"$name");}else{L[r"$name"]=A;}gB(r"$name");}String get type=>L[r"$type"];set type(String A){if(A==null){L.remove(r"$type");}else{L[r"$type"]=A;}gB(r"$type");}void remove(){provider.CQ(path);}void sB(String A,KB B){super.sB(A,B);gB(A);}String hg(dynamic B){String A=super.hg(B);if(A!=null){gB(A);}return A;}FB QI(String A,Object B,d D,FB C){if(LTB(A,B)!=true){super.QI(A,B,D,C);}return C;}FB NO(String A,Object B,d D,FB C){if(MTB(A,B)!=true){super.NO(A,B,D,C);}return C;}FB PC(Object A,d C,FB B,[int D=f.o]){if(NTB(A)!=true)super.PC(A,C,B,D);return B;}operator[](String A)=>get(A);operator[]=(String A,B){if(A.startsWith(r"$")||A.startsWith(r"@")){if(A.startsWith(r"$")){L[A]=B;}else{JB[A]=B;}}else{if(B==null){return hg(A);}else if(B is Map){return HQB(A,B);}else{sB(A,B);return B;}}}}class dW extends vB{dW(String A,pH B):super(A,B){L[r'$hidden']=true;}Map<String,dynamic> II(){var A=<String,dynamic>{r'$hidden':true};if(L.containsKey(r'$is')){A[r'$is']=L[r'$is'];}if(L.containsKey(r'$type')){A[r'$type']=L[r'$type'];}if(L.containsKey(r'$name')){A[r'$name']=L[r'$name'];}if(L.containsKey(r'$invokable')){A[r'$invokable']=L[r'$invokable'];}if(L.containsKey(r'$writable')){A[r'$writable']=L[r'$writable'];}return A;}}abstract class Nl{}ContentType AHB=new ContentType("application","json",charset:"utf-8");void eW(HttpRequest B,[int G=HttpStatus.OK,ContentType D,bool H=false]){var A=B.response;if(G!=null){A.statusCode=G;}A.headers.set("Access-Control-Allow-Methods","POST, OPTIONS, GET");A.headers.set("Access-Control-Allow-Headers","Content-Type");String C=B.headers.value("origin");if(B.headers.value("x-proxy-origin")!=null){C=B.headers.value("x-proxy-origin");}if(C==null){C="*";}A.headers.set("Access-Control-Allow-Origin",C);if(!H){if(D==null){D=AHB;}A.headers.contentType=D;}}void Tl(Object A){}class Ul implements cW{Map<String,tM> LV=new Map<String,tM>();Directory uD;Directory uZ;Ul(String A){uD=new Directory(A);if(!uD.existsSync()){uD.createSync(recursive:true);}uZ=new Directory("${A}/resp_subscription");if(!uZ.existsSync()){uZ.createSync(recursive:true);}}sQ eRB(String A){if(LV.containsKey(A)){return LV[A];}tM B=new tM("${uZ.path}/${Uri.encodeComponent(A)}",A);LV[A]=B;return B;}void destroy(){LV.forEach((String C,tM A){A.destroy();});LV.clear();values.forEach((String D,yQ B){B.destroy();});values.clear();}Future<List<List<LH>>> iSB()async{List<Future<List<LH>>> B=[] ;for(FileSystemEntity A in uZ.listSync()){if(await FileSystemEntity.type(A.path)==FileSystemEntityType.DIRECTORY){String C=Lc.Mc(A.path.substring(A.path.lastIndexOf(Platform.pathSeparator)+1));tM D=new tM(A.path,C);LV[C]=D;B.add(D.load());}}return Future.wait(B);}Map<String,yQ> values=new Map<String,yQ>();WT Er(String A){if(values.containsKey(A)){return values[A];}yQ B=new yQ(A,"${uD.path}/${Uri.encodeComponent(A)}");values[A]=B;return B;}}class tM extends sQ{Map<String,xQ> values=new Map<String,xQ>();Directory uD;String EQ;tM(String A,[this.EQ]){if(EQ==null){EQ=Lc.Mc(A.substring(A.lastIndexOf(Platform.pathSeparator)+1));}uD=new Directory(A);if(!uD.existsSync()){uD.createSync(recursive:true);}}LH b8(String A){if(values.containsKey(A)){return values[A];}xQ B=new xQ(A,Uri.encodeComponent(A),uD.path,this);values[A]=B;return B;}Future<List<LH>> load()async{List<Future<LH>> B=[] ;for(FileSystemEntity C in uD.listSync()){String D=C.path.substring(C.path.lastIndexOf(Platform.pathSeparator)+1);String A=Lc.Mc(D);values[A]=new xQ(A,D,uD.path,this);B.add(values[A].load());}return Future.wait(B);}void aq(String A){if(values.containsKey(A)){values[A].destroy();values.remove(A);}}void destroy(){values.forEach((String B,xQ A){A.destroy();});values.clear();}}class xQ extends LH{File file;String yK;xQ(String A,this.yK,String B,tM C):super(A,C){file=new File("${B}/${yK}");}void YP(RB A){fZ=3;A.tZ="${oC.qH(A.rs())}\n";file.openSync(mode:FileMode.APPEND)..writeStringSync(A.tZ)..closeSync();}void PC(Iterable<RB> B,RB A){fZ=2;A.tZ=" ${oC.qH(A.rs())}\n";file.writeAsStringSync(A.tZ);}void Ps(RB A){}void K$(Iterable<RB> A){file.writeAsStringSync(A.map((B)=>B.tZ).join());}void destroy(){file.delete().catchError(Tl);}List<RB> QgB;Future<LH> load()async{String B=file.readAsStringSync();List<String> C=B.split("\n");if(C.length==1&&B.startsWith(" ")){fZ=2;}else{fZ=3;}List<RB> D=new List<RB>();for(String G in C){if(G.length<18){continue;}try {Map A=oC.AG(G);RB H=new RB(A["value"],ts:A["ts"],meta:A);D.add(H);}catch (I){}}QgB=D;return this;}List<RB> Y8(){return QgB;}}class yQ implements WT{String category;Directory uD;yQ(this.category,String A){uD=new Directory(A);if(!uD.existsSync()){uD.createSync(recursive:true);}}XT sU(String A){return new t0(this,A);}void destroy(){uD.delete(recursive:true).catchError(Tl);}Future<Map> load()async{Map B={};for(FileSystemEntity A in uD.listSync()){String C=Lc.Mc(A.path.substring(A.path.lastIndexOf(Platform.pathSeparator)+1));File D=new File(A.path);String G=D.readAsStringSync();try {B[C]=oC.AG(G);}catch (H){fB.mB(H);}}return B;}}class t0 extends XT{String key;yQ Q7;File RgB;t0(this.Q7,this.key){RgB=new File("${Q7.uD.path}/${Uri.encodeComponent(key)}");}bool SgB=false;Object TgB;Object UgB;void PC(Object A){TgB=A;if(SgB){return;}UgB=A;TgB=null;SgB=true;RgB.writeAsString(oC.qH(A)).then(l9).catchError(l9);}void l9(Object A){SgB=false;if(TgB!=null){PC(TgB);}}void destroy(){TgB=null;UgB=null;RgB.delete().catchError(Tl);}i8()async{if(TgB!=null){return TgB;}try {return oC.AG(await RgB.readAsString());}catch (A){}return null;}}Future<String> fz(String A)async{var I=Platform.environment["PATH"].split(Platform.isWindows?";":":");var D=[A];if(Platform.isWindows){D.addAll(["${A}.exe","${A}.bat"]);}for(var B in I){if(Platform.environment.containsKey("HOME")){var C=Platform.environment["HOME"];if(!C.endsWith("/")){C+= "/";}B=B.replaceAll("~/",C);}var G=new Directory(f2(B));if(!(await G.exists())){continue;}for(var J in D){var H=new File("${G.path}/${J}");if(await H.exists()){return H.path;}}}return null;}class zF{static const int v0=61;static const int NHB=13;static const int Wl=10;static const int Xl=32;static const int OHB=43;static const int PHB=47;static const String ZL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";static final List<int> al=((){List<int> A=new List<int>(256);A.fillRange(0,256,-2);List<int> C=ZL.codeUnits;int D=C.length;for(int B=0;B<D; ++B){A[C[B]]=B;}A[OHB]=62;A[PHB]=63;A[NHB]=-1;A[Wl]=-1;A[Xl]=-1;A[Wl]=-1;A[v0]=0;return A;})();static String uM(List<int> G,[int Q=0,int I=0]){int J=G.length;if(J==0){return "";}final int K=J.remainder(3);final int S=J-K;int H=((J~/3)*4)+((K>0)?4:0)+I;int M=Q>>2;if(M>0){H+= ((H-1)~/(M<<2))*(1+I);}List<int> A=new List<int>(H);int B=0,C=0,N=0;for(int C=0;C<I; ++C){A[B++ ]=Xl;}while(C<S){int D=(((G[C++ ]%256)<<16)&0xFFFFFF)|(((G[C++ ]%256)<<8)&0xFFFFFF)|(G[C++ ]%256);A[B++ ]=ZL.codeUnitAt(D>>18);A[B++ ]=ZL.codeUnitAt((D>>12)&0x3F);A[B++ ]=ZL.codeUnitAt((D>>6)&0x3F);A[B++ ]=ZL.codeUnitAt(D&0x3f);if(M>0&& ++N==M&&B<H-2){A[B++ ]=Wl;for(int C=0;C<I; ++C){A[B++ ]=Xl;}N=0;}}if(K==1){int D=G[C]%256;A[B++ ]=ZL.codeUnitAt(D>>2);A[B++ ]=ZL.codeUnitAt((D<<4)&0x3F);return new String.fromCharCodes(A.sublist(0,H-2));}else if(K==2){int D=G[C]%256;int O=G[C+1]%256;A[B++ ]=ZL.codeUnitAt(D>>2);A[B++ ]=ZL.codeUnitAt(((D<<4)|(O>>4))&0x3F);A[B++ ]=ZL.codeUnitAt((O<<2)&0x3F);return new String.fromCharCodes(A.sublist(0,H-1));}return new String.fromCharCodes(A);}static Uint8List vO(String A){if(A==null){return null;}int C=A.length;if(C==0){return new Uint8List(0);}int K=0;for(int B=0;B<C;B++ ){int G=al[A.codeUnitAt(B)];if(G<0){K++ ;if(G==-2){return null;}}}int M=(C-K)%4;if(M==2){A='${A}==';C+= 2;}else if(M==3){A='${A}=';C+= 1;}else if(M==1){return null;}int N=0;for(int B=C-1;B>=0;B-- ){int O=A.codeUnitAt(B);if(al[O]>0)break;if(O==v0)N++ ;}int I=(((C-K)*6)>>3)-N;Uint8List J=new Uint8List(I);for(int B=0,D=0;D<I;){int H=0;for(int Q=4;Q>0;){int G=al[A.codeUnitAt(B++ )];if(G>=0){H=((H<<6)&0xFFFFFF)|G;Q-- ;}}J[D++ ]=H>>16;if(D<I){J[D++ ]=(H>>8)&0xFF;if(D<I)J[D++ ]=H&0xFF;}}return J;}}typedef Object JHB(Object _0);typedef Object KHB(String _0,Object _1);abstract class ZK{static final Map<String,ZK> QHB={"json":oC.Pc,"msgpack":fl.XHB};static final ZK w0=oC.Pc;static ZK y0(String B){ZK A=QHB[B];if(A==null){return w0;}return A;}Object VgB;Object get mPB{if(VgB==null){VgB=gf({});}return VgB;}Object gf(Map A);Map Wf(String A);Map Yq(List<int> A);}abstract class oC{static A1 Pc=new A1();static String qH(Object A,{bool pretty: false}){return Pc.iQB(A,pretty:pretty);}static dynamic AG(String A){return Pc.TQB(A);}}class A1 extends ZK implements oC{static dynamic B1(A){return null;}JsonEncoder encoder=new JsonEncoder(B1);JsonDecoder decoder=new JsonDecoder();JsonEncoder WgB;dynamic TQB(String A){return decoder.convert(A);}String iQB(B,{bool pretty: false}){JsonEncoder A=encoder;if(pretty){if(WgB==null){WgB=encoder=new JsonEncoder.withIndent("  ",B1);}A=WgB;}return A.convert(B);}JsonDecoder XgB;Map Yq(List<int> A){return Wf(const Utf8Decoder().convert(A));}Map Wf(String B){if(YgB==null){YgB=(D,A){if(A is String&&A.startsWith("\u001Bbytes:")){try {return zQ.Yl(zF.vO(A.substring(7)));}catch (G){return null;}}return A;};}if(XgB==null){XgB=new JsonDecoder(YgB);}var C=XgB.convert(B);return C;}KHB YgB;JHB ZgB;Object gf(Object C){if(ZgB==null){ZgB=(A){if(A is ByteData){return "\u001Bbytes:${zF.uM(zQ.SHB(A))}";}return null;};}JsonEncoder B;if(agB==null){agB=new JsonEncoder(ZgB);}B=agB;var D=B.convert(C);return D;}JsonEncoder agB;}class fl extends ZK{static fl XHB=new fl();Map Yq(List<int> C){Uint8List A=zQ.u0(C);if(bgB==null){bgB=new Tm(A.buffer,A.offsetInBytes);}else{bgB.reset(A.buffer,0);bgB.offset=A.offsetInBytes;}Object B=bgB.Ph();if(B is Map){return B;}bgB.data=null;return {};}Tm bgB;Map Wf(String A){return {};}Object gf(Map A){return GJB(A);}}class aT{Map cgB;Map get RSB=>cgB;String name;String version;String description;String uP;Map<String,dynamic> KG={};Map<String,Map<String,dynamic>> L={};List<String> pY=[] ;aT();factory aT.RWB(Map<String,dynamic> B){var A=new aT();A.cgB=B;A.name=B["name"];A.version=B["version"];A.description=B["description"];A.uP=B["main"];A.KG=B["engines"] as Map<String,dynamic>;A.L=B["configs"] as Map<String,Map<String,dynamic>>;A.pY=B["getDependencies"] as List<String>;return A;}void Ca(){if(name==null){throw new Exception("DSLink Name is required.");}if(uP==null){throw new Exception("DSLink Main Script is required.");}}Map PE(){Ca();var A=new Map<String,dynamic>.from(cgB!=null?cgB:{});A["name"]=name;A["version"]=version;A["description"]=description;A["main"]=uP;A["engines"]=KG;A["configs"]=L;A["getDependencies"]=pY;for(var B in A.keys.toList()){if(A[B]==null){A.remove(B);}}return A;}}class zQ{static Uint8List u0(List<int> A){if(A is Uint8List){return A;}return new Uint8List.fromList(A);}static ByteData Yl(Uint8List A){return A.buffer.asByteData(A.offsetInBytes,A.lengthInBytes);}static Uint8List SHB(ByteData A){return A.buffer.asUint8List(A.offsetInBytes,A.lengthInBytes);}static ByteData cl(List<int> A){if(A is Uint8List){return Yl(A);}return Yl(new Uint8List.fromList(A));}}Future IHB(Future G,int H,{Function onTimeout: null,Function onSuccessAfterTimeout: null,Function onErrorAfterTimeout: null}){Completer A=new Completer();Timer B=new Timer(new Duration(milliseconds:H),(){if(!A.isCompleted){if(onTimeout!=null){onTimeout();}A.completeError(new Exception('Future timeout before complete'));}});G.then((C){if(A.isCompleted){if(onSuccessAfterTimeout!=null){onSuccessAfterTimeout(C);}}else{B.cancel();A.complete(C);}}).catchError((D){if(A.isCompleted){if(onErrorAfterTimeout!=null){onErrorAfterTimeout(D);}}else{B.cancel();A.completeError(D);}});return A.future;}class YK<Y> implements StreamController<Y>{StreamController<Y> dgB;el<Y> egB;Stream<Y> get stream=>egB;Function EV;Function Og;YK([void A(),void B(),void C(callback(Y value)),bool D=false]){dgB=new StreamController<Y>(sync:D);egB=new el(dgB.stream.asBroadcastStream(onListen:fgB,onCancel:ggB),C);this.EV=A;this.Og=B;}bool hgB=false;bool igB=false;void fgB(StreamSubscription<Y> A){if(!igB){if(EV!=null){EV();}igB=true;}hgB=true;}void ggB(StreamSubscription<Y> A){hgB=false;if(Og!=null){if(!jgB){jgB=true;bC.tO(UQB);}}else{igB=false;}}bool jgB=false;void UQB(){jgB=false;if(!hgB&&igB){Og();igB=false;}}void add(Y A){dgB.add(A);egB.ME=A;}void addError(Object A,[StackTrace B]){dgB.addError(A,B);}Future addStream(Stream<Y> A,{bool cancelOnError: true}){return dgB.addStream(A,cancelOnError:cancelOnError);}Future close(){return dgB.close();}Future get done=>dgB.done;bool get hasListener=>dgB.hasListener;bool get isClosed=>dgB.isClosed;bool get isPaused=>dgB.isPaused;StreamSink<Y> get sink=>dgB.sink;void set onCancel(A()){throw ('BroadcastStreamController.onCancel not implemented');}void set onListen(void A()){throw ('BroadcastStreamController.onListen not implemented');}void set onPause(void A()){throw ('BroadcastStreamController.onPause not implemented');}void set onResume(void A()){throw ('BroadcastStreamController.onResume not implemented');}ControllerCancelCallback get onCancel=>null;ControllerCallback get onListen=>null;ControllerCallback get onPause=>null;ControllerCallback get onResume=>null;}class el<Y> extends Stream<Y>{Y ME;final Stream<Y> egB;final Function fgB;el(this.egB,this.fgB);Stream<Y> asBroadcastStream({void onListen(StreamSubscription<Y> subscription),void onCancel(StreamSubscription<Y> subscription)}){return this;}bool get isBroadcast=>true;StreamSubscription<Y> listen(void A(Y event),{Function onError,void onDone(),bool cancelOnError}){if(fgB!=null){fgB(A);}return egB.listen(A,onError:onError,onDone:onDone,cancelOnError:cancelOnError);}}class NF extends LinkedListEntry<NF>{final int JQ;List<Function> kgB=new List<Function>();NF(this.JQ);void add(Function A){if(!kgB.contains(A)){kgB.add(A);}}void remove(Function A){kgB.remove(A);}}class bC{static List<Function> Zl=[] ;static void bl(){Timer.run(F1);mW=true;}static void tO(Function A){if(!mW){bl();}Zl.add(A);}static LinkedList<NF> aL=new LinkedList<NF>();static Map<int,NF> dl=new Map<int,NF>();static Map<Function,NF> uO=new Map<Function,NF>();static NF C1(int C){NF B=dl[C];if(B!=null){return B;}B=new NF(C);dl[C]=B;NF A;if(aL.isNotEmpty){A=aL.first;}while(A!=null){if(A.JQ>C){A.insertBefore(B);break;}else if(A.next!=aL&&A.next!=A){A=A.next;}else{A=null;}}if(A==null){aL.add(B);}if(!mW){bl();}return B;}static NF WHB(int C){if(aL.isNotEmpty&&aL.first.JQ<=C){NF A=aL.first;dl.remove(A.JQ);A.unlink();for(Function B in A.kgB){uO.remove(B);try {B();}catch (D,G){print("callback error; ${D}\n${G}");}}return A;}return null;}static int Qc=-1;static void fD(Function A,int G){int B=(((new DateTime.now()).millisecondsSinceEpoch+G)/50).ceil();if(uO.containsKey(A)){NF C=uO[A];if(C.JQ<=B){return;}else{C.remove(A);}}if(B<=Qc){tO(A);return;}NF D=C1(B);D.add(A);uO[A]=D;}static void gl(Function A,int G){int B=(((new DateTime.now()).millisecondsSinceEpoch+G)/50).ceil();if(uO.containsKey(A)){NF C=uO[A];if(C.JQ>=B){return;}else{C.remove(A);}}if(B<=Qc){tO(A);return;}NF D=C1(B);D.add(A);uO[A]=D;}static void YHB(Function A){NF B=uO[A];if(B!=null){B.remove(A);}}static bool mW=false;static bool D1=false;static bool E1=false;static void F1(){mW=false;D1=true;List<Function> B=Zl;Zl=new List();for(var C in B){try {C();}catch (D,G){print("callback error; ${D}\n${G}");}}int A=(new DateTime.now()).millisecondsSinceEpoch;Qc=(A/50).floor();while(WHB(Qc)!=null){}D1=false;if(E1){E1=false;F1();}if(aL.isNotEmpty){if(!mW){if(hl!=aL.first.JQ){hl=aL.first.JQ;if(wO!=null&&wO.isActive){wO.cancel();}var H=new Duration(milliseconds:hl*50+1-A);wO=new Timer(H,bl);}}}else if(wO!=null){if(wO.isActive){wO.cancel();}wO=null;}}static int hl=-1;static Timer wO;}class Lc{static const int LHB=0x20;static const int Vl=0x25;static const int MHB=0x2B;static String Mc(String D){List<int> C=new List<int>();List<int> A=new List<int>();int I=D.length;for(int B=0;B<I;B++ ){var G=D.codeUnitAt(B);if(G==Vl){if(B+3>D.length){A.add(Vl);continue;}int H=UHB(D,B+1);if(H>0){A.add(H);B+= 2;}else{A.add(Vl);}}else{if(!A.isEmpty){C.addAll(const Utf8Decoder(allowMalformed:true).convert(A).codeUnits);A.clear();}if(G==MHB){C.add(LHB);}else{C.add(G);}}}if(!A.isEmpty){C.addAll(const Utf8Decoder().convert(A).codeUnits);A.clear();}return new String.fromCharCodes(C);}static int UHB(String D,int G){int B=0;for(int C=0;C<2;C++ ){int A=D.codeUnitAt(G+C);if(0x30<=A&&A<=0x39){B=B*16+A-0x30;}else if((A>=0x41&&A<=0x46)||(A>=0x61&&A<=0x66)){A|= 0x20;B=B*16+A-0x57;}else{return -1;}}return B;}}typedef dynamic Nc();typedef dynamic AR<Y>(Y _0);typedef dynamic RHB<zLB,nn>(zLB _0,nn _1);const String Oc="1.1.2";cC iW;bool jW;List<int> x0(List<int> A,List<int> B){return A..addAll(B);}int z0(String A,String B){var C=B.codeUnitAt(0);return A.codeUnits.where((D)=>C==D).length;}bool get THB{if(jW!=null){return jW;}try {assert(false);jW=false;}catch (A){jW=true;}return jW;}const bool VHB=identical(1,1.0);bool kW(CN B,String A,[bool D=false]){if(!VHB){bool C=new bool.fromEnvironment(A,defaultValue:null);if(C!=null){return C;}}if(B.zone[A] is bool){return B.zone[A];}return D;}cC get fB{if(iW!=null){return iW;}IR=true;iW=new cC("DSA");iW.Tg.listen((A){List<String> D=A.message.split("\n");bool G=kW(A,"dsa.logger.inline_errors",true);bool H=kW(A,"dsa.logger.sequence",false);if(G){if(A.error!=null){D.addAll(A.error.toString().split("\n"));}if(A.stackTrace!=null){D.addAll(A.stackTrace.toString().split("\n").where((I)=>I.isNotEmpty).toList());}}String C=A.er;if(A.zone["dsa.logger.name"] is String){C=A.zone["dsa.logger.name"];}bool J=kW(A,"dsa.logger.show_timestamps",false);if(!kW(A,"dsa.logger.show_name",true)){C=null;}for(String K in D){String B="";if(H){B+= "[${A.U_}]";}if(J){B+= "[${A.m_}]";}B+= "[${A.level.name}]";if(C!=null){B+= "[${C}]";}B+= " ";B+= K;if(kW(A,"dsa.logger.print",true)){print(B);}}if(!G){if(A.error!=null){print(A.error);}if(A.stackTrace!=null){print(A.stackTrace);}}});lW(const String.fromEnvironment("dsa.logger.default_level",defaultValue:"INFO"));return iW;}void lW(String A){A=A.trim().toUpperCase();if(A=="DEBUG"){A="ALL";}Map<String,hB> C={};for(var B in hB.Dm){C[B.name]=B;}var B=C[A];if(B!=null){fB.level=B;}}class bT{static final bT ZHB=new bT.SWB(250);final Duration duration;const bT(this.duration);bT.SWB(int A):this(new Duration(milliseconds:A));}abstract class Rc{void af();}class G1 extends Rc{final Nc function;G1(this.function);void af(){if(function!=null){function();}}}class H1{static Rc I1(A,H()){Duration B;if(A is Duration){B=A;}else if(A is int){B=new Duration(milliseconds:A);}else if(A is bT){B=A.duration;}else{throw new Exception("Invalid Interval: ${A}");}Nc C;Timer D;bool G=false;C=()async{await H();if(!G){new Timer(B,C);}};D=new Timer(B,C);return new G1((){if(D!=null){D.cancel();}G=true;});}}String Sc(Iterable<String> A)=>"enum[${A.join(",")}]";String aHB({int length: 30}){var H=new Random();var C=new StringBuffer();for(int D=1;D<=length;D++ ){var A=new Random(H.nextInt(0x70000000)+(new DateTime.now()).millisecondsSinceEpoch);var B=A.nextInt(50);if(B>=0&&B<=32){String G=Tc[A.nextInt(Tc.length)];C.write(A.nextBool()?G.toLowerCase():G);}else if(B>32&&B<=43){C.write(Uc[A.nextInt(Uc.length)]);}else if(B>43){C.write(il[A.nextInt(il.length)]);}}return C.toString();}String bHB({int length: 50}){var G=new Random();var B=new StringBuffer();for(int C=1;C<=length;C++ ){var A=new Random(G.nextInt(0x70000000)+(new DateTime.now()).millisecondsSinceEpoch);if(A.nextBool()){String D=Tc[A.nextInt(Tc.length)];B.write(A.nextBool()?D.toLowerCase():D);}else{B.write(Uc[A.nextInt(Uc.length)]);}}return B.toString();}const List<String> Tc=const["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];const List<int> Uc=const[0,1,2,3,4,5,6,7,8,9];const List<String> il=const["@","=","_","+","-","!","."];Uint8List jl(String B){int C=B.length;Uint8List D=new Uint8List(C);for(int A=0;A<C;A++ ){int G=B.codeUnitAt(A);if(G>=128){return new Uint8List.fromList(const Utf8Encoder().convert(B));}D[A]=G;}return D;}typedef void nW(xO _0);gC kl(nW D,{Map<String,dynamic> metadata}){var A=new ReceivePort();var B=new gC.TWB(A);var C=new ReceivePort();Isolate.spawn(D,new xO(A.sendPort,metadata),onError:C.sendPort).then((G){B.lgB=G;});C.listen((H){fB.BC(H);});return B;}gC J1(nW D,{Map<String,dynamic> metadata}){var A=new ReceivePort();var B=new gC.TWB(A);Timer.run((){var C=new xO(A.sendPort,metadata);C.mgB=B;D(C);});return B;}gC cHB(A,{List<String> args,Map<String,dynamic> metadata}){var C=new ReceivePort();var D=new gC.TWB(C);Uri B;if(A is Uri){B=A;}else if(A is String){B=Uri.parse(A);}else{throw new ArgumentError.value(A,"script","should be either a Uri or a String.");}Isolate.spawnUri(B,[] ,{"port":C.sendPort,"metadata":metadata}).then((G){D.lgB=G;});return D;}vM dHB(int C,nW D,{Map<String,dynamic> metadata}){var B=<gC>[] ;for(var A=1;A<=C;A++ ){B.add(kl(D,metadata:{"workerId":A}..addAll(metadata==null?{}:metadata)));}return new vM(B);}class vM{final List<gC> rF;Map<String,AR> ngB={};vM(this.rF){LUB();}Function XZ;Future gh(){return Future.wait(rF.map((A)=>A.gh()).toList());}Future stop(){return Future.wait(rF.map((A)=>A.stop()).toList());}vTB(int A)async{if(rF.length>A){var C=rF.length-A;List<gC> D=rF.skip(A).take(C).toList();for(var B in D){await B.close();B.kill();rF.remove(B);}}}KUB(int C,nW D,{Map<String,dynamic> metadata})async{if(rF.length<C){for(var A=rF.length+1;A<=C;A++ ){var B=kl(D,metadata:{"workerId":A}..addAll(metadata==null?{}:metadata));B.ogB=this;B.YZ=(G){if(XZ!=null){XZ(A,G);}};await B.init();rF.add(B);}}else{await vTB(C);}}void send(dynamic A){forEach((B)=>B.send(A));}void listen(void B(int worker,event)){var A=0;for(var C in rF){var D=A;C.listen((G){B(D,G);});A++ ;}}Future<vM> init()=>Future.wait(rF.map((A)=>A.init()).toList()).then((B)=>this);void forEach(void A(gC socket)){rF.forEach(A);}void u(String A,AR B){ngB[A]=B;}Future<List<dynamic>> callMethod(String A,[B]){return Future.wait(rF.map((C)=>C.callMethod(A,B)).toList());}Future<wM> createSession([dynamic A]){return YRB().createSession(A);}StreamController<wM> pgB=new StreamController<wM>.broadcast();bool qgB=false;int ZRB(){var B=rgB.keys.toList();B.sort((C,D)=>rgB[C].compareTo(rgB[D]));var A=B.first;rgB[A]=rgB[A]+1;return A;}gC YRB(){return L$(ZRB());}void LUB(){for(var A=0;A<rF.length;A++ ){rgB[A]=0;rF[A].ogB=this;rF[A].YZ=(B){if(XZ!=null){XZ(A,B);}};}}Map<int,int> rgB={};gC L$(int A)=>rF[A];gC operator[](int A)=>L$(A);}class xO{final SendPort port;final Map<String,dynamic> metadata;xO(this.port,[Map<String,dynamic> A]):metadata=A==null?{}:A;gC i7(){var A=new gC.UWB(port);if(mgB!=null){A.mgB=mgB;mgB.sgB=A;}return A;}Future<gC> init({Map<String,AR> methods})async=>await i7().init(methods:methods);dynamic get(String A)=>metadata[A];bool pRB(String A)=>metadata.containsKey(A);gC mgB;}class gC extends Stream implements StreamSink{static gC oW;final ReceivePort zP;SendPort tgB;gC.TWB(this.zP):BZ=false{zP.listen(l8);}gC.UWB(SendPort A):tgB=A,zP=new ReceivePort(),BZ=true{tgB.send({"t":"send_port","port":zP.sendPort});zP.listen(l8);}Function YZ;vM ogB;l8(B){if(YZ!=null){YZ(B);}if(B==null||B is!Map){return;}String C=B["t"];if(C==null){C=B["type"];}if(C==null){return;}if(C=="send_port"){tgB=B["port"];if(!ugB.isCompleted){ugB.complete();}}else if(C=="data"){vgB.add(B["d"]);}else if(C=="error"){vgB.addError(B["e"]);}else if(C=="ping"){tgB.send({"t":"pong","i":B["i"]});}else if(C=="pong"){var A=B["i"];if(wgB.containsKey(A)){wgB[A].complete();wgB.remove(A);}}else if(C=="req"){xgB(B["n"],B["i"],B["a"]);}else if(C=="res"){var A=B["i"];var H=B["r"];var G=B["e"];if(G!=null){if(ygB.containsKey(A)){ygB.remove(A).completeError(G,new StackTrace.fromString(B["s"]));}else{throw new Exception("Invalid Request ID: ${A}");}}else{if(ygB.containsKey(A)){ygB.remove(A).complete(H);}else{throw new Exception("Invalid Request ID: ${A}");}}}else if(C=="stop"){if(!zgB.isCompleted){zgB.complete();}tgB.send({"t":"stopped"});}else if(C=="stopped"){if(!zgB.isCompleted){zgB.complete();}}else if(C=="session.created"){var A=B["s"];AhB[A]=new BR(this,A,false,B["n"]);tgB.send({"t":"session.ready","s":A});pgB.add(AhB[A]);}else if(C=="session.ready"){var A=B["s"];if(BhB.containsKey(A)){BhB[A].complete();BhB.remove(A);}}else if(C=="session.data"){var A=B["s"];if(ChB.containsKey(A)){(ChB[A] as BR).DhB.add(B["d"]);}else if(AhB.containsKey(A)){(AhB[A] as BR).DhB.add(B["d"]);}}else if(C=="session.done"){var A=B["s"];if(ChB.containsKey(A)){var D=(ChB[A] as BR).EhB;if(!D.isCompleted){D.complete();}ChB.remove(A);}else if(AhB.containsKey(A)){var D=(AhB[A] as BR).EhB;if(!D.isCompleted){D.complete();}AhB.remove(A);}}else{throw new Exception("Unknown message: ${B}");}}Map<int,Completer> wgB={};final bool BZ;bool get MSB=>!BZ;Future gh(){if(BZ){return new Future.value();}else{return ugB.future;}}Future<gC> init({Map<String,AR> methods}){if(methods!=null){for(var A in methods.keys){u(A,methods[A]);}}return gh().then((B)=>this);}void u(String A,AR B){FhB[A]=B;}gC mgB;gC sgB;Future callMethod(String C,[G]){if(BZ&&mgB!=null){var A=mgB.FhB[C];if(A==null){A=mgB.ogB.ngB[C];}var B=A(G);if(B is!Future){return new Future.value(B);}else{return B;}}else if(sgB!=null){var A=sgB.FhB[C];if(A==null){A=sgB.ogB.ngB[C];}var B=A(G);if(B is!Future){return new Future.value(B);}else{return B;}}var H=new Completer();var D=0;while(ygB[D]!=null){D++ ;}ygB[D]=H;if(G==null){tgB.send({"t":"req","i":D,"n":C});}else{tgB.send({"t":"req","i":D,"n":C,"a":G});}return H.future;}xgB(String A,int C,H)async{try {if((ogB!=null&&ogB.ngB.containsKey(A))||FhB.containsKey(A)){var I=(ogB!=null&&ogB.ngB.containsKey(A))?ogB.ngB[A]:FhB[A];var B=I(H);if(B is Future){B=await B;}if(B==null){tgB.send({"t":"res","i":C});}else{tgB.send({"t":"res","i":C,"r":B});}}else{throw new Exception("Invalid Method: ${A}");}}catch (D,G){tgB.send({"t":"res","i":C,"e":D!=null?D.toString():null,"s":G!=null?G.toString():null});}}Map<int,Completer> ygB={};Map<String,AR> FhB={};Completer ugB=new Completer();int GhB=0;void add(A){tgB.send({"t":"data","d":A});}void send(A)=>add(A);void addError(A,[StackTrace B]){tgB.send({"t":"error","e":A});}Future addStream(Stream A){return A.listen((B){add(B);}).asFuture();}Future stop()=>close();Future close(){tgB.send({"t":"stop"});return zgB.future.then((A){if(MSB){zP.close();}else{return new Future.delayed(new Duration(seconds:1),(){zP.close();});}});}Future<wM> createSession([B])async{var A=aHB(length:25);var C=new BR(this,A,true,B);tgB.send({"t":"session.created","s":A,"n":B});await ((BhB[A]=new Completer.sync()).future);ChB[A]=C;return C;}Map<String,Completer> BhB={};Map<String,wM> ChB={};Map<String,wM> AhB={};StreamController<wM> pgB=new StreamController<wM>.broadcast();Future get done=>zgB.future;Completer zgB=new Completer();StreamSubscription listen(void A(event),{Function onError,void onDone(),bool cancelOnError}){return vgB.stream.listen(A,onError:onError,onDone:onDone,cancelOnError:cancelOnError);}bool kill(){zP.close();if(lgB!=null){lgB.kill();return true;}else{return false;}}Isolate lgB;StreamController vgB=new StreamController.broadcast();}abstract class wM{String get id;void send(A);Future close();Future get done;bool get isClosed;Stream get wN;}class BR extends wM{final bool NQB;final String id;final gC HhB;Completer EhB=new Completer.sync();StreamController DhB=new StreamController();Stream IhB;BR(this.HhB,this.id,this.NQB,this.JhB);Future close(){HhB.tgB.send({"t":"session.done","s":id});new Future((){if(!EhB.isCompleted){EhB.complete();}HhB.AhB.remove(id);HhB.ChB.remove(id);DhB.close();});return done;}Future get done=>EhB.future;Stream get wN{if(IhB==null){IhB=DhB.stream.asBroadcastStream();}return IhB;}void send(A){HhB.tgB.send({"t":"session.data","s":id,"d":A});}bool get isClosed=>EhB.isCompleted;dynamic JhB;}String Vc(String A,String B){PJ C=new PJ(PQ,UTF8.encode((A)));var D=C.convert(UTF8.encode(B)).eC;return Mi.encode(D);}String K1(String B,String C,String D,int G){num H=(new DateTime.now().millisecondsSinceEpoch/1000).round()+G;String I="${C}|${H}";String J=BASE64.encode(UTF8.encode(I));String A="${D}|${J}";return "${A}|${Vc(B,A)}";}String L1(String C,String H,String I,String J){num K=(new DateTime.now().millisecondsSinceEpoch/1000).round();List<String> A=H.split("|");if(A.length!=3){return null;}String D=A[0];String G=A[1];String M=A[2];String N=Vc(C,"${D}|${G}");if(Vc(C,N)!=Vc(C,M))return null;if(D!=I)return null;List<String> B=UTF8.decode(BASE64.decode(G)).split("|");if(B.length!=3)return null;String O=B[0];String Q=B[1];String S=B[2];if(Q!=J)return null;if(K>=int.parse(S))return null;return O;}String eHB(String B,String C,String D,String G){String A="${G}|${B}";var H=K1(C,A,"TX",300);var I=K1(D,A,"APP",3600);return "${H}:${I}";}String fHB(String B,String D,String G,String H){List<String> A=H.split(":");if(A.length!=2)return null;String I=A[0];String J=A[1];String C=L1(D,I,"AUTH",B);String K=L1(G,J,"APP",B);if(C!=K)return null;return C;}final Y3=new RegExp(r"\r\n?|\n");class An extends pT{int get line=>KhB;int KhB=0;int get column=>LhB;int LhB=0;GP get state=>new Z3(this,position,line,column);bool get MhB=>JC(-1)==Qu&&JC()==Ci;set position(int A){var C=position;super.position=A;if(A>C){var B=NhB(string.substring(C,A));KhB+= B.length;if(B.isEmpty){LhB+= A-C;}else{LhB=A-B.last.end;}}else{var B=NhB(string.substring(A,C));if(MhB)B.removeLast();KhB-= B.length;if(B.isEmpty){LhB-= C-A;}else{LhB=A-string.lastIndexOf(Y3,A)-1;}}}An(String A,{sourceUrl,int position}):super(A,sourceUrl:sourceUrl,position:position);int oB(){var A=super.oB();OhB(A);return A;}void OhB(int A){if(A==Ci||(A==Qu&&JC()!=Ci)){KhB+= 1;LhB=0;}else{LhB+= 1;}}bool ZB(Pattern B){if(!super.ZB(B))return false;var A=NhB(DF[0]);KhB+= A.length;if(A.isEmpty){LhB+= DF[0].length;}else{LhB=DF[0].length-A.last.end;}return true;}List<Match> NhB(String B){var A=Y3.allMatches(B).toList();if(MhB)A.removeLast();return A;}}class Z3 implements GP{final An PhB;final int position;final int line;final int column;Z3(this.PhB,this.position,this.line,this.column);}const int GK=0x7fffffff;abstract class HK<R>{}class cV<R> implements HK<R>{const cV();bool LE(R A,R B)=>A==B;int hash(R A)=>A.hashCode;bool AZ(Object A)=>true;}class dV<R> implements HK<Iterable<R>>{final HK<R> QhB;const dV([HK<R> A=const cV()]):QhB=A;bool LE(Iterable<R> A,Iterable<R> B){if(identical(A,B))return true;if(A==null||B==null)return false;var C=A.iterator;var D=B.iterator;while(true){bool G=C.moveNext();if(G!=D.moveNext())return false;if(!G)return true;if(!QhB.LE(C.current,D.current))return false;}}int hash(Iterable<R> B){int A=0;for(R C in B){int D=QhB.hash(C);A=(A+D)&GK;A=(A+(A<<10))&GK;A^= (A>>6);}A=(A+(A<<3))&GK;A^= (A>>11);A=(A+(A<<15))&GK;return A;}bool AZ(Object A)=>A is Iterable<R>;}class eV<R> implements HK<List<R>>{final HK<R> QhB;const eV([HK<R> A=const cV()]):QhB=A;bool LE(List<R> A,List<R> B){if(identical(A,B))return true;if(A==null||B==null)return false;int D=A.length;if(D!=B.length)return false;for(int C=0;C<D;C++ ){if(!QhB.LE(A[C],B[C]))return false;}return true;}int hash(List<R> C){int A=0;for(int B=0;B<C.length;B++ ){int D=QhB.hash(C[B]);A=(A+D)&GK;A=(A+(A<<10))&GK;A^= (A>>6);}A=(A+(A<<3))&GK;A^= (A>>11);A=(A+(A<<15))&GK;return A;}bool AZ(Object A)=>A is List<R>;}abstract class Gi<R,Y extends Iterable<R>> implements HK<Y>{final HK<R> QhB;const Gi(this.QhB);bool LE(Y D,Y G){if(identical(D,G))return true;if(D==null||G==null)return false;HashMap<R,int> C=new HashMap(equals:QhB.LE,hashCode:QhB.hash,isValidKey:QhB.AZ);int H=0;for(var B in D){int A=C[B];if(A==null)A=0;C[B]=A+1;H++ ;}for(var B in G){int A=C[B];if(A==null||A==0)return false;C[B]=A-1;H-- ;}return H==0;}int hash(Y B){int A=0;for(R C in B){int D=QhB.hash(C);A=(A+D)&GK;}A=(A+(A<<3))&GK;A^= (A>>11);A=(A+(A<<15))&GK;return A;}}class aa<R> extends Gi<R,Iterable<R>>{const aa([HK<R> A=const cV()]):super(A);bool AZ(Object A)=>A is Iterable<R>;}class Hi<R> extends Gi<R,Set<R>>{const Hi([HK<R> A=const cV()]):super(A);bool AZ(Object A)=>A is Set<R>;}class uh<Y> implements EventSink<Y>{final EventSink RhB;uh.rVB(this.RhB);static EventSink x$(EventSink A)=>A is EventSink?A:new uh.rVB(A);void add(Y A){RhB.add(A);}void addError(A,[StackTrace B]){RhB.addError(A,B);}void close(){RhB.close();}}class Yc implements Exception{final String message;final Uri uri;Yc(this.message,[this.uri]);String toString()=>message;}class zc extends HX{String get source=>super.source;Uri get XC=>l.XC;zc(String A,iD B,String C):super(A,B,C);}class V2 implements Exception{final CP credentials;V2(this.credentials);String toString()=>"OAuth2 credentials have expired and can't be refreshed.";}const int xm=10;const int KKB=13;class OR{final Uri QE;final ShB=<int>[0];final Uint32List ThB;int get length=>ThB.length;int get zU=>ShB.length;int UhB;OR(String A,{url}):this.yWB(A.runes,url:url);OR.yWB(Iterable<int> D,{url}):QE=url is String?Uri.parse(url):url,ThB=new Uint32List.fromList(D.toList()){for(var A=0;A<ThB.length;A++ ){var B=ThB[A];if(B==KKB){var C=A+1;if(C>=ThB.length||ThB[C]!=xm)B=xm;}if(B==xm)ShB.add(A+1);}}hD l(int B,[int A]){if(A==null)A=length-1;return new cK(this,B,A);}EP location(int A)=>new EP.zWB(this,A);int sf(int A){if(A<0){throw new RangeError("Offset may not be negative, was ${A}.");}else if(A>length){throw new RangeError("Offset ${A} must not be greater than the number " "of characters in the file, ${length}.");}if(A<ShB.first)return -1;if(A>=ShB.last)return ShB.length-1;if(VhB(A))return UhB;UhB=WhB(A)-1;return UhB;}bool VhB(int A){if(UhB==null)return false;if(A<ShB[UhB])return false;if(UhB>=ShB.length-1||A<ShB[UhB+1]){return true;}if(UhB>=ShB.length-2||A<ShB[UhB+2]){UhB++ ;return true;}return false;}int WhB(int D){int A=0;int B=ShB.length-1;while(A<B){var C=A+((B-A)~/2);if(ShB[C]>D){B=C;}else{A=C+1;}}return B;}int Ar(int A,{int line}){if(A<0){throw new RangeError("Offset may not be negative, was ${A}.");}else if(A>length){throw new RangeError("Offset ${A} must be not be greater than the " "number of characters in the file, ${length}.");}if(line==null){line=sf(A);}else if(line<0){throw new RangeError("Line may not be negative, was ${line}.");}else if(line>=zU){throw new RangeError("Line ${line} must be less than the number of " "lines in the file, ${zU}.");}var B=ShB[line];if(B>A){throw new RangeError("Line ${line} comes after offset ${A}.");}return A-B;}int a8(int A,[int B]){if(B==null)B=0;if(A<0){throw new RangeError("Line may not be negative, was ${A}.");}else if(A>=zU){throw new RangeError("Line ${A} must be less than the number of " "lines in the file, ${zU}.");}else if(B<0){throw new RangeError("Column may not be negative, was ${B}.");}var C=ShB[A]+B;if(C>length||(A+1<zU&&C>=ShB[A+1])){throw new RangeError("Line ${A} doesn't have ${B} columns.");}return C;}String h8(int A,[int B])=>new String.fromCharCodes(ThB.sublist(A,B));}class EP extends LKB implements jI{final OR file;final int offset;Uri get XC=>file.QE;int get line=>file.sf(offset);int get column=>file.Ar(offset);EP.zWB(this.file,this.offset){if(offset<0){throw new RangeError("Offset may not be negative, was ${offset}.");}else if(offset>file.length){throw new RangeError("Offset ${offset} must not be greater than the number " "of characters in the file, ${file.length}.");}}hD RG()=>new cK(file,offset,offset);}abstract class hD implements zm{}class cK extends R3 implements hD{final OR file;final int XhB;final int YhB;Uri get XC=>file.QE;int get length=>YhB-XhB;EP get start=>new EP.zWB(file,XhB);EP get end=>new EP.zWB(file,YhB);String get text=>file.h8(XhB,YhB);String get context=>file.h8(file.a8(start.line),end.line==file.zU-1?null:file.a8(end.line+1));cK(this.file,this.XhB,this.YhB){if(YhB<XhB){throw new ArgumentError('End ${YhB} must come after start ${XhB}.');}else if(YhB>file.length){throw new RangeError("End ${YhB} must not be greater than the number " "of characters in the file, ${file.length}.");}else if(XhB<0){throw new RangeError("Start may not be negative, was ${XhB}.");}}int compareTo(iD A){if(A is!cK)return super.compareTo(A);cK B=A;var C=XhB.compareTo(B.XhB);return C==0?YhB.compareTo(B.YhB):C;}iD union(iD A){if(A is!hD)return super.union(A);cK B=expand(A);if(A is cK){if(this.XhB>A.YhB||A.XhB>this.YhB){throw new ArgumentError("Spans ${this} and ${A} are disjoint.");}}else{if(this.XhB>A.end.offset||A.start.offset>this.YhB){throw new ArgumentError("Spans ${this} and ${A} are disjoint.");}}return B;}bool operator==(A){if(A is!hD)return super==A;if(A is!cK){return super==A&&XC==A.XC;}return XhB==A.XhB&&YhB==A.YhB&&XC==A.XC;}int get hashCode=>super.hashCode;hD expand(hD A){if(XC!=A.XC){throw new ArgumentError("Source URLs \"${XC}\" and " " \"${A.XC}\" don't match.");}if(A is cK){var B=LJ.min(this.XhB,A.XhB);var C=LJ.max(this.YhB,A.YhB);return new cK(file,B,C);}else{var B=LJ.min(this.XhB,A.start.offset);var C=LJ.max(this.YhB,A.end.offset);return new cK(file,B,C);}}}abstract class YC{static const String hF='www';static const String Nz='files';static final String HW=p(hF,'dgsb');static final String zEB=p(Nz,'proj');static final String AFB=p(Nz,'usr');static final File BFB=new File(p(hF,'access_denied.html'));static final File CFB=new File(p(hF,"authorize.html"));static final File Oz=new File(p(hF,"totp.html"));static final File DFB=new File(p(hF,"totp_ready.html"));static final File EFB=new File(p(hF,"change_password.html"));static final File FFB=new File(p(hF,"forgot_password.html"));static final File GFB=new File(p(hF,"favicon.ico"));static final File bb=new File(p(hF,"dglicense.json"));static File get HFB{return X.fU==null||X.fU.isEmpty?new File(p(hF,"login.html")):new File(p(hF,si.Jx,si.vBB));}static final File IFB=new File(p(hF,'404.html'));static final File JFB=new File(p(hF,'tls_error.html'));static final File KFB=new File(p(hF,"update.html"));static final File cb=new File(p(HW,"REVISION"));static final File Pz=new File(p(HW,"index.html"));static final File Lk=new File(p(HW,"viewer.html"));static final File db=new File(p(hF,'oid_session.html'));static final Directory Qz=new Directory(HW);static final Directory LFB=new Directory(p(hF,'dglux5'));static final Directory MFB=new Directory(p(hF,'asb'));static final Directory Rz=new Directory(zEB);static final Directory NFB=new Directory(AFB);}abstract class qT implements Kn{factory qT(String A,{Duration pollingDelay}){if(FileSystemEntity.isWatchSupported&&!Platform.isWindows){return new j3(A);}return new l3(A,pollingDelay:pollingDelay);}}final QKB=new RegExp(r'^#\d+\s+(\S.*) \((.+?)((?::\d+){0,2})\)$');final RKB=new RegExp(r'^\s*at (?:(\S.*?)(?: \[as [^\]]+\])? \((.*)\)|(.*))$');final SKB=new RegExp(r'^(.*):(\d+):(\d+)|native$');final T3=new RegExp(r'^eval at (?:\S.*?) \((.*)\)(?:, .*?:\d+:\d+)?$');final TKB=new RegExp(r'^' r'(?:' r'([^@(/]*)' r'(?:\(.*\))?' r'((?:/[^/]*)*)' r'(?:\(.*\))?' r'@' r')?' r'(.*?)' r':' r'(\d*)' r'(?::(\d*))?' r'$');final UKB=new RegExp(r'^(\S+)(?: (\d+)(?::(\d+))?)?\s+([^\d].*)$');final VKB=new RegExp(r'<(<anonymous closure>|[^>]+)_async_body>');final WKB=new RegExp(r"^\.");class uC{final Uri uri;final int line;final int column;final String HM;bool get t8=>uri.scheme=='dart';String get EZ{if(uri.scheme=='data')return "data:...";return g2(uri);}String get r9{if(uri.scheme!='package')return null;return uri.path.split('/').first;}String get location{if(line==null)return EZ;if(column==null)return '${EZ} ${line}';return '${EZ} ${line}:${column}';}factory uC.DXB(String A)=>uc(A,(){if(A=='...'){return new uC(new Uri(),null,null,'...');}var B=QKB.firstMatch(A);if(B==null)return new JN(A);var D=B[1].replaceAll(VKB,"<async>").replaceAll("<anonymous closure>","<fn>");var G=Uri.parse(B[2]);var C=B[3].split(':');var H=C.length>1?int.parse(C[1]):null;var I=C.length>2?int.parse(C[2]):null;return new uC(G,H,I,D);});factory uC.EXB(String C)=>uc(C,(){var A=RKB.firstMatch(C);if(A==null)return new JN(C);H(B,I){var G=T3.firstMatch(B);while(G!=null){B=G[1];G=T3.firstMatch(B);}if(B=='native'){return new uC(Uri.parse('native'),null,null,I);}var D=SKB.firstMatch(B);if(D==null)return new JN(C);return new uC(U3(D[1]),int.parse(D[2]),int.parse(D[3]),I);}if(A[2]!=null){return H(A[2],A[1].replaceAll("<anonymous>","<fn>").replaceAll("Anonymous function","<fn>").replaceAll("(anonymous function)","<fn>"));}else{return H(A[3],"<fn>");}});factory uC.FXB(String C)=>uc(C,(){var A=TKB.firstMatch(C);if(A==null)return new JN(C);var D=U3(A[3]);var B;if(A[1]!=null){B=A[1];B+= new List.filled('/'.allMatches(A[2]).length,".<fn>").join();if(B=='')B='<fn>';B=B.replaceFirst(WKB,'');}else{B='<fn>';}var G=A[4]==''?null:int.parse(A[4]);var H=A[5]==null||A[5]==''?null:int.parse(A[5]);return new uC(D,G,H,B);});factory uC.GXB(String C)=>uc(C,(){var A=UKB.firstMatch(C);if(A==null){throw new FormatException("Couldn't parse package:stack_trace stack trace line '${C}'.");}var B=A[1]=='data:...'?new Uri.dataFromString(''):Uri.parse(A[1]);if(B.scheme==''){B=rJB(oJB(qJB(B)));}var D=A[2]==null?null:int.parse(A[2]);var G=A[3]==null?null:int.parse(A[3]);return new uC(B,D,G,A[4]);});static final XKB=new RegExp(r'^[a-zA-Z][-+.a-zA-Z\d]*://');static final YKB=new RegExp(r'^([a-zA-Z]:[\\/]|\\\\)');static Uri U3(String A){if(A.contains(XKB)){return Uri.parse(A);}else if(A.contains(YKB)){return new Uri.file(A,windows:true);}else if(A.startsWith('/')){return new Uri.file(A,windows:false);}if(A.contains('\\'))return mJB.o_(A);return Uri.parse(A);}static uC uc(String A,uC B()){try {return B();}on FormatException catch (C){return new JN(A);}}uC(this.uri,this.line,this.column,this.HM);String toString()=>'${location} in ${HM}';}class DR implements Pattern{final String pattern;final AE context;final bool recursive;final OF ZhB;Xc ahB;bool get bhB{if(chB==null){chB=context.isAbsolute(context.current);}return chB;}bool chB;bool get dhB{if(ehB==null){ehB=ZhB.sR;}return ehB;}bool ehB;bool get fhB{if(ghB==null){ghB=ZhB.aU;}return ghB;}bool ghB;DR(String A,{AE context,bool recursive: false}):this.VWB(A,context==null?yE:context,recursive);DR.VWB(String A,AE B,bool C):pattern=A,context=B,recursive=C,ZhB=new O1(A+(C?"{,/**}":""),B).YD();Stream<FileSystemEntity> list({String root,bool followLinks: true}){if(context.BB!=lc){throw new StateError("Can't list glob \"${this}\"; it matches " "${context.BB} paths, but this platform uses ${lc} paths.");}if(ahB==null)ahB=new Xc(ZhB);return ahB.list(root:root,followLinks:followLinks);}List<FileSystemEntity> listSync({String root,bool followLinks: true}){if(context.BB!=lc){throw new StateError("Can't list glob \"${this}\"; it matches " "${context.BB} paths, but this platform uses ${lc} paths.");}if(ahB==null)ahB=new Xc(ZhB);return ahB.listSync(root:root,followLinks:followLinks);}bool XD(String A)=>matchAsPrefix(A)!=null;Match matchAsPrefix(String A,[int B=0]){if(B!=0)return null;if(dhB&&(bhB||context.isAbsolute(A))){var C=context.wJ(context.absolute(A));if(ZhB.XD(rl(context,C))){return new pl(A,this);}}if(fhB){var D=context.iZ(A);if(ZhB.XD(rl(context,D))){return new pl(A,this);}}return null;}Iterable<Match> allMatches(String B,[int C=0]){var A=matchAsPrefix(B,C);return A==null?[] :[A];}String toString()=>pattern;}const gHB=0x2F;abstract class OF{RegExp hhB;final bool sR=false;final bool aU=true;eG iP()=>new eG([new mF([this])]);bool XD(String A){if(hhB==null)hhB=new RegExp('^${ihB()}\$');return hhB.hasMatch(A);}String ihB();}class mF extends OF{final List<OF> m;bool get sR=>m.first.sR;bool get aU=>m.first.aU;mF(Iterable<OF> A):m=A.toList();eG iP(){if(m.isEmpty)return new eG([this]);var D=m.first.iP().lB.map((B)=>B.m);for(var C in m.skip(1)){var G=C.iP().lB;D=D.expand((B){return G.map((H){return B.toList()..addAll(H.m);});});}return new eG(D.map((B){return new mF(B.fold([] ,(A,C){if(A.isEmpty||A.last is!NH||C is!NH){return A..add(C);}A[A.length-1]=new NH(A.last.text+C.text);return A;}));}));}List<mF> split(AE D){var I=[] ;var B;G(C){if(B==null)B=[] ;B.add(C);}H(){if(B==null)return;I.add(new mF(B));B=null;}for(var C in m){if(C is!NH||!C.text.contains('/')){G(C);continue;}var J=C.text;if(D.BB==AD.fL)J=J.replaceAll("/","\\");var A=D.split(J);if(D.isAbsolute(A.first)){if(I.isEmpty&&B==null){var K=A.first;if(D.BB==AD.fL){K=K.replaceAll("\\","/");}G(new NH(K));}H();A=A.skip(1);if(A.isEmpty)continue;}for(var M in A.take(A.length-1)){G(new NH(M));H();}G(new NH(A.last));if(C.text.endsWith('/'))H();}H();return I;}String ihB()=>m.map((A)=>A.ihB()).join();bool operator==(Object A)=>A is mF&&const dV().LE(m,A.m);int get hashCode=>const dV().hash(m);String toString()=>m.join();}class ll extends OF{ll();String ihB()=>'[^/]*';bool operator==(Object A)=>A is ll;int get hashCode=>0;String toString()=>'*';}class Wc extends OF{final AE jhB;Wc(this.jhB);String ihB(){var A=new StringBuffer()..write(r'(?!^(?:\.\./|');if(jhB.BB==AD.o2){A.write(r'/');}else if(jhB.BB==AD.fL){A.write(r'//|[A-Za-z]:/');}else{assert(jhB.BB==AD.HN);A.write(r'[a-zA-Z][-+.a-zA-Z\d]*://|/');}A.write(r'))[^]*');return A.toString();}bool operator==(Object A)=>A is Wc;int get hashCode=>1;String toString()=>'**';}class ml extends OF{ml();String ihB()=>'[^/]';bool operator==(Object A)=>A is ml;int get hashCode=>2;String toString()=>'?';}class pW extends OF{final Set<xM> ZD;final bool negated;pW(Iterable<xM> A,{this.negated}):ZD=A.toSet();eG iP(){if(negated||ZD.any((A)=>!A.Vr)){return super.iP();}return new eG(ZD.map((A){return new mF([new NH(new String.fromCharCodes([A.min]))]);}));}String ihB(){var A=new StringBuffer();var C=ZD.any((B)=>B.contains(gHB));if(!negated&&C){A.write('(?!/)');}A.write('[');if(negated){A.write('^');if(!C)A.write('/');}for(var B in ZD){var D=new String.fromCharCodes([B.min]);A.write(ql(D));if(B.Vr)continue;A.write('-');A.write(ql(new String.fromCharCodes([B.max])));}A.write(']');return A.toString();}bool operator==(Object A){if(A is!pW)return false;if((A as pW).negated!=negated)return false;return const Hi().LE(ZD,(A as pW).ZD);}int get hashCode=>(negated?1:3)*const Hi().hash(ZD);String toString(){var A=new StringBuffer()..write('[');for(var B in ZD){A.writeCharCode(B.min);if(B.Vr)continue;A.write('-');A.writeCharCode(B.max);}A.write(']');return A.toString();}}class eG extends OF{final List<mF> lB;bool get sR=>lB.any((A)=>A.sR);bool get aU=>lB.any((A)=>A.aU);eG(Iterable<mF> A):lB=A.toList();eG iP()=>new eG(lB.expand((A)=>A.iP().lB));String ihB()=>'(?:${lB.map((A)=>A.ihB()).join("|")})';bool operator==(Object A)=>A is eG&&const aa().LE(lB,A.lB);int get hashCode=>const aa().hash(lB);String toString()=>'{${lB.join(',')}}';}class NH extends OF{final String text;final AE jhB;bool get sR{var A=jhB.BB==AD.fL?text.replaceAll('/','\\'):text;return jhB.isAbsolute(A);}bool get aU=>!sR;NH(this.text,[this.jhB]);String ihB()=>ql(text);bool operator==(Object A)=>A is NH&&A.text==text;int get hashCode=>text.hashCode;String toString()=>text;}const M1=2;const N1=3;class Xc{final khB=new Map<String,bL>();bool lhB;Xc(OF G){var H=G.iP();for(var I in H.lB){var A=I.split(yE);var B=A.first.m.first;var C='.';if(B is NH){var D=B.text;if(Platform.isWindows)D.replaceAll("/","\\");if(am(D)){assert(A.first.m.length==1);C=B.text;A.removeAt(0);}}mhB(C,A);}lhB=nhB();}void mhB(String C,List<OF> G){var A=khB[C];for(var D=0;D<G.length;D++ ){var B=G[D];var H=B.m.any((J)=>J is Wc);var I=D==G.length-1;if(A!=null){if(A.zY||H){A.R9();A.tI(nl(G.sublist(D)));return;}else if(I){A.tI(B);}else{if(!A.Z.containsKey(B)){A.Z[B]=new bL();}A=A.Z[B];}}else if(H){khB[C]=new bL.WWB(nl(G.sublist(D)));return;}else if(I){khB[C]=new bL()..tI(B);}else{khB[C]=new bL();khB[C].Z[B]=new bL();A=khB[C].Z[B];}}}bool nhB(){if(khB.length>1&&khB.containsKey('.'))return true;return khB.values.any((A)=>A.S7);}Stream<FileSystemEntity> list({String root,bool followLinks: true}){if(root==null)root='.';var A=new ol();for(var B in khB.keys){var G=B=='.'?root:B;A.add(khB[B].list(G,followLinks:followLinks));}A.Lq();if(!lhB)return A.stream;var C=new Set();return A.stream.where((D){if(C.contains(D.path))return false;C.add(D.path);return true;});}List<FileSystemEntity> listSync({String root,bool followLinks: true}){if(root==null)root='.';var B=khB.keys.expand((A){var G=A=='.'?root:A;return khB[A].listSync(G,followLinks:followLinks);});if(!lhB)return B.toList();var C=new Set();return B.where((D){if(C.contains(D.path))return false;C.add(D.path);return true;}).toList();}}class bL{Map<mF,bL> Z;eG ohB;bool get zY=>Z==null;bool get phB{if(ohB!=null)return false;return Z.keys.every((A)=>A.m.length==1&&A.m.first is NH);}bool get S7{if(zY)return false;if(Z.length>1&&Z.keys.any((A)=>A.m.length>1||A.m.single is!NH)){return true;}return Z.values.any((B)=>B.S7);}bL():Z=new Map<mF,bL>(),ohB=null;bL.WWB(mF A):Z=null,ohB=new eG([A]);void R9(){if(zY)return;ohB=new eG(Z.keys.map((A){var B=Z[A];B.R9();return nl([A,B.ohB]);}));Z=null;}void tI(mF A){if(ohB==null){ohB=new eG([A]);}else{ohB.lB.add(A);}}Stream<FileSystemEntity> list(String B,{bool followLinks: true}){if(zY){return new Directory(B).list(recursive:true,followLinks:followLinks).where((C)=>qhB(C.path.substring(B.length+1)));}var A=new ol();if(phB){Z.forEach((G,H){A.add(H.list(p(B,G.m.single.text),followLinks:followLinks));});A.Lq();return A.stream;}var D=new StreamController(sync:true);A.add(D.stream);new Directory(B).list(followLinks:followLinks).listen((C){var I=C.path.substring(B.length+1);if(qhB(I))D.add(C);Z.forEach((G,H){if(C is!Directory)return;if(!G.XD(I))return;var K=H.list(p(B,I),followLinks:followLinks).handleError((M){},test:(J){return J is FileSystemException&&(J.osError.errorCode==M1||J.osError.errorCode==N1);});A.add(K);});},onError:D.addError,onDone:D.close);A.Lq();return A.stream;}Iterable<FileSystemEntity> listSync(String A,{bool followLinks: true}){if(zY){return new Directory(A).listSync(recursive:true,followLinks:followLinks).where((C)=>qhB(C.path.substring(A.length+1)));}if(phB){return Z.keys.expand((B){return Z[B].listSync(p(A,B.m.single.text),followLinks:followLinks);});}return new Directory(A).listSync(followLinks:followLinks).expand((C){var D=[] ;var G=C.path.substring(A.length+1);if(qhB(G))D.add(C);if(C is!Directory)return D;D.addAll(Z.keys.where((B)=>B.XD(G)).expand((B){try {return Z[B].listSync(p(A,G),followLinks:followLinks).toList();}on FileSystemException catch (H){if(H.osError.errorCode==M1||H.osError.errorCode==N1){return const[] ;}else{rethrow;}}}));return D;});}bool qhB(String A){if(ohB==null)return false;return ohB.XD(rl(yE,A));}String toString()=>"(${ohB}) ${Z}";}mF nl(Iterable<OF> C){var B=C.toList();var A=[B.removeAt(0)];for(var D in B){A.add(new NH('/'));A.add(D);}return new mF(A);}const hHB=0x2D;const iHB=0x2F;class O1{final dK rhB;final AE shB;O1(String A,this.shB):rhB=new dK(A);mF YD()=>thB();mF thB({bool inOptions: false}){var A=[] ;if(rhB.JI){rhB.error('expected a glob.',position:0,length:0);}while(!rhB.JI){if(inOptions&&(rhB.XD(',')||rhB.XD('}')))break;A.add(uhB(inOptions:inOptions));}return new mF(A);}OF uhB({bool inOptions: false}){var A=vhB();if(A!=null)return A;var B=whB();if(B!=null)return B;var C=xhB();if(C!=null)return C;var D=yhB();if(D!=null)return D;return zhB(inOptions:inOptions);}OF vhB(){if(!rhB.ZB('*'))return null;return rhB.ZB('*')?new Wc(shB):new ll();}OF whB(){if(!rhB.ZB('?'))return null;return new ml();}OF xhB(){if(!rhB.ZB('['))return null;if(rhB.XD(']'))rhB.error('unexpected "]".');var C=rhB.ZB('!')||rhB.ZB('^');D(){var A=rhB.oB();if(C||A!=iHB)return A;rhB.error('"/" may not be used in a range.',position:rhB.position-1);}var B=[] ;while(!rhB.ZB(']')){var G=rhB.position;rhB.ZB('\\');var A=D();if(rhB.ZB('-')){if(rhB.XD(']')){B.add(new xM.XWB(A));B.add(new xM.XWB(hHB));continue;}rhB.ZB('\\');var H=D();if(H<A){rhB.error("Range out of order.",position:G,length:rhB.position-G);}B.add(new xM(A,H));}else{B.add(new xM.XWB(A));}}return new pW(B,negated:C);}OF yhB(){if(!rhB.ZB('{'))return null;if(rhB.XD('}'))rhB.error('unexpected "}".');var A=[] ;do{A.add(thB(inOptions:true));}while(rhB.ZB(','));if(A.length==1)rhB.LG(',');rhB.LG('}');return new eG(A);}OF zhB({bool inOptions: false}){var B=new RegExp(inOptions?r'[^*{[?\\}\],()]*':r'[^*{[?\\}\]()]*');rhB.ZB(B);var A=new StringBuffer()..write(rhB.DF[0]);while(rhB.ZB('\\')){A.writeCharCode(rhB.oB());rhB.ZB(B);A.write(rhB.DF[0]);}for(var C in const[']','(',')']){if(rhB.XD(C))rhB.error('unexpected "${C}"');}if(!inOptions&&rhB.XD('}'))rhB.error('unexpected "}"');return new NH(A.toString(),shB);}}class ol<Y>{Stream<Y> get stream=>AiB.stream;final StreamController<Y> AiB;final BiB=new Map<Stream<Y>,StreamSubscription<Y>>();bool CiB=false;ol():AiB=new StreamController<Y>(sync:true);void add(Stream<Y> A){if(BiB.containsKey(A))return;BiB[A]=A.listen(AiB.add,onError:AiB.addError,onDone:()=>remove(A));}void remove(Stream<Y> B){var A=BiB.remove(B);if(A!=null)A.cancel();if(CiB&&BiB.isEmpty)close();}void close(){for(var A in BiB.values){A.cancel();}BiB.clear();AiB.close();}void Lq(){if(BiB.isEmpty)close();CiB=true;}}class xM{final int min;final int max;bool get Vr=>min==max;xM(this.min,this.max);xM.XWB(int A):this(A,A);bool contains(int A)=>A>=min&&A<=max;bool operator==(Object A)=>A is xM&&A.min==min&&A.max==max;int get hashCode=>3*min+7*max;}class pl implements Match{final String input;final Pattern pattern;final int start=0;int get end=>input.length;int get groupCount=>0;pl(this.input,this.pattern);String operator[](int A)=>this.group(A);String group(int A){if(A!=0)throw new RangeError.range(A,0,0);return input;}List<String> groups(List<int> A)=>A.map((B)=>group(B)).toList();}final jHB=new RegExp(r"[+*?{}|[\]\\().^$-]");String ql(String A)=>A.replaceAllMapped(jHB,(B)=>"\\${B[0]}");String rl(AE B,String A){if(B.BB==AD.fL)return A.replaceAll('\\','/');if(B.BB==AD.HN)return Uri.decodeFull(A);return A;}const OJB=const Duration(seconds:10);CP W2(gI C,Uri H,DateTime b,List<String> M,String h){if(C.statusCode!=200)PJB(C,H);B(r,EB)=>X2(C,H,r,EB);var N=C.headers['content-type'];var I=N==null?null:new OH.bWB(N);B(I!=null&&(I.mimeType=="application/json"||I.mimeType=="text/javascript"),'content-type was "${I}", expected "application/json"');Map<String,dynamic> A;try {var O=JSON.decode(C.TD);B(O is Map,'parameters must be a map, was "${A}"');A=Li.au(O);}on FormatException {B(false,'invalid JSON');}for(var D in ['access_token','token_type']){B(A.containsKey(D),'did not contain required parameter "${D}"');B(A[D] is String,'required parameter "${D}" was not a string, was ' '"${A[D]}"');}B(A['token_type'].toLowerCase()=='bearer','"${H}": unknown token type "${A['token_type']}"');var G=(A['expires_in'] is String)?int.parse(A['expires_in'],onError:(LB)=>B(false,'parameter "expires_in" was a string but could not be parsed as int, was "${A['expires_in']}"')):A['expires_in'];B(G==null||G is int,'parameter "expires_in" was not an int, was "${G}"');for(var Q in ['refresh_token','scope']){var J=A[Q];B(J==null||J is String,'parameter "${Q}" was not a string, was "${J}"');}var S=A['scope'] as String;if(S!=null)M=S.split(h);var IB=G==null?null:b.add(new Duration(seconds:G)-OJB);var K=A['id_token'] as String;iT V;if(K!=null&&K.isNotEmpty){V=new iT.iWB(K);}return new CP(A['access_token'],refreshToken:A['refresh_token'],tokenEndpoint:H,scopes:M,idToken:V,expiration:IB);}void PJB(gI A,Uri H){C(M,N)=>X2(A,H,M,N);if(A.statusCode!=400&&A.statusCode!=401){var O='';if(A.reasonPhrase!=null&&!A.reasonPhrase.isEmpty){' ${A.reasonPhrase}';}throw new FormatException('OAuth request for "${H}" failed ' 'with status ${A.statusCode}${O}.\n\n${A.TD}');}var I=A.headers['content-type'];var D=I==null?null:new OH.bWB(I);C(D!=null&&D.mimeType=="application/json",'content-type was "${D}", expected "application/json"');var B;try {B=JSON.decode(A.TD);}on FormatException {C(false,'invalid JSON');}C(B.containsKey('error'),'did not contain required parameter "error"');C(B["error"] is String,'required parameter "error" was not a string, was ' '"${B["error"]}"');for(var J in ['error_description','error_uri']){var G=B[J];C(G==null||G is String,'parameter "${J}" was not a string, was "${G}"');}var Q=B['error_description'];var K=B['error_uri'];var S=K==null?null:Uri.parse(K);throw new jc(B['error'],Q,S);}void X2(gI A,Uri B,bool C,String D){if(C)return;throw new FormatException('Invalid OAuth response for "${B}": ' '${D}.\n\n${A.TD}');}abstract class NL extends Converter<List<int>,SE>{int get blockSize;const NL();SE convert(List<int> C){var A=new Ri();var B=startChunkedConversion(A);B.add(C);B.close();return A.value;}ByteConversionSink startChunkedConversion(Sink<SE> A);}abstract class Si implements Sink<List<int>>{final Sink<SE> DiB;final Endianness EiB;final Uint32List FiB;static const eAB=0x1fffffffffffffff;int GiB=0;final HiB=new f3();bool IiB=false;Uint32List get iB;Si(this.DiB,int A,{Endianness endian: Endianness.BIG_ENDIAN}):EiB=endian,FiB=new Uint32List(A);void Ct(Uint32List A);void add(List<int> A){if(IiB)throw new StateError('Hash.add() called after close().');GiB+= A.length;HiB.addAll(A);JiB();}void close(){if(IiB)return;IiB=true;KiB();JiB();assert(HiB.isEmpty);DiB.add(new SE(LiB()));DiB.close();}Uint8List LiB(){if(EiB==Endianness.HOST_ENDIAN)return iB.buffer.asUint8List();var B=new Uint8List(iB.lengthInBytes);var C=B.buffer.asByteData();for(var A=0;A<iB.length;A++ ){C.setUint32(A*rS,iB[A]);}return B;}void JiB(){var D=HiB.buffer.asByteData();var C=HiB.length~/FiB.lengthInBytes;for(var B=0;B<C;B++ ){for(var A=0;A<FiB.length;A++ ){FiB[A]=D.getUint32(B*FiB.lengthInBytes+A*rS,EiB);}Ct(FiB);}HiB.removeRange(0,C*FiB.lengthInBytes);}void KiB(){HiB.add(0x80);var C=GiB+9;var J=MiB(C,FiB.lengthInBytes);for(var D=0;D<J-C;D++ ){HiB.add(0);}if(GiB>eAB){throw new UnsupportedError('Hashing is unsupported for messages with more than 2^64 bits.');}var G=GiB*gAB;var A=HiB.length;HiB.addAll(new Uint8List(8));var B=HiB.buffer.asByteData();var H=G>>32;var I=G&QQ;if(EiB==Endianness.BIG_ENDIAN){B.setUint32(A,H,EiB);B.setUint32(A+rS,I,EiB);}else{B.setUint32(A,I,EiB);B.setUint32(A+rS,H,EiB);}}int MiB(int B,int A)=>(B+A-1)&-A;}class PJ extends Converter<List<int>,SE>{final NL NiB;final Uint8List OiB;PJ(NL B,List<int> A):NiB=B,OiB=new Uint8List(B.blockSize){if(A.length>NiB.blockSize)A=NiB.convert(A).eC;OiB.setRange(0,A.length,A);}SE convert(List<int> C){var A=new Ri();var B=startChunkedConversion(A);B.add(C);B.close();return A.value;}ByteConversionSink startChunkedConversion(Sink<SE> A)=>new gu(A,NiB,OiB);}class gu extends ByteConversionSink{final ByteConversionSink PiB;final QiB=new Ri();ByteConversionSink RiB;bool SiB=false;gu(Sink<SE> G,NL D,List<int> C):PiB=D.startChunkedConversion(G){RiB=D.startChunkedConversion(QiB);var B=new Uint8List(C.length);for(var A=0;A<B.length;A++ ){B[A]=0x5c^C[A];}PiB.add(B);for(var A=0;A<B.length;A++ ){B[A]=0x36^C[A];}RiB.add(B);}void add(List<int> A){if(SiB)throw new StateError('HMAC is closed');RiB.add(A);}void addSlice(List<int> A,int B,int C,bool D){if(SiB)throw new StateError('HMAC is closed');RiB.addSlice(A,B,C,D);}void close(){if(SiB)return;SiB=true;RiB.close();PiB.add(QiB.value.eC);PiB.close();}}class ul extends StreamView<HttpRequest> implements HttpServer{final Set<HttpServer> TiB;String get serverHeader=>TiB.first.serverHeader;set serverHeader(String A){for(var B in TiB){B.serverHeader=A;}}final HttpHeaders defaultResponseHeaders;Duration get idleTimeout=>TiB.first.idleTimeout;set idleTimeout(Duration A){for(var B in TiB){B.idleTimeout=A;}}bool get autoCompress=>TiB.first.autoCompress;set autoCompress(bool A){for(var B in TiB){B.autoCompress=A;}}int get port=>TiB.first.port;InternetAddress get address=>TiB.first.address;set sessionTimeout(int A){for(var B in TiB){B.sessionTimeout=A;}}ul(Iterable<HttpServer> A):TiB=A.toSet(),defaultResponseHeaders=new V1(A.map((B)=>B.defaultResponseHeaders)),super(wh.BAB(A));Future close({bool force: false})=>Future.wait(TiB.map((A)=>A.close(force:force)));HttpConnectionsInfo connectionsInfo(){var A=new HttpConnectionsInfo();for(var C in TiB){var B=C.connectionsInfo();A.total+= B.total;A.active+= B.active;A.idle+= B.idle;A.closing+= B.closing;}return A;}}class zM implements StreamTransformer<HttpRequest,dT>{static Future<dT> AN(HttpRequest A,{Encoding defaultEncoding: UTF8}){return FIB.GIB(A,defaultEncoding);}}abstract class ER{}abstract class dT extends ER{}abstract class X1{}class FIB{static Future<dT> GIB(HttpRequest A,Encoding B){return HIB(A,A.headers,B).then((C)=>new Z1(A,C),onError:(D){A.response.statusCode=HttpStatus.BAD_REQUEST;A.response.close();throw D;});}static Future<ER> HIB(Stream<List<int>> K,HttpHeaders IB,Encoding G){ContentType C=IB.contentType;Future<ER> V(){return K.fold(new BytesBuilder(),(M,A)=>M..add(A)).then((M)=>new FR("binary",M.takeBytes()));}Future<ER> N(Encoding G){var I;var b=C.charset;if(b!=null)I=Encoding.getByName(b);if(I==null)I=G;return K.transform(I.decoder).fold(new StringBuffer(),(O,A)=>O..write(A)).then((O)=>new FR("text",O.toString()));}Future<ER> LB(){return K.transform(new M2(C.parameters['boundary'])).map((J)=>bc.IIB(J,defaultEncoding:G)).map((D){var Q;if(D.QSB){Q=D.fold(new StringBuffer(),(B,UB)=>B..write(UB)).then((B)=>B.toString());}else{Q=D.fold(new BytesBuilder(),(B,aB)=>B..add(aB)).then((B)=>B.takeBytes());}return Q.then((A){var h=D.Nq.parameters['filename'];if(h!=null){A=new Y1(D.contentType,h,A);}return [D.Nq.parameters['name'],A];});}).fold([] ,(qB,CC)=>qB..add(CC)).then(Future.wait).then((FC){Map<String,dynamic> H=new Map<String,dynamic>();for(var J in FC){H[J[0]]=J[1];}return new FR('form',H);});}if(C==null){return V();}switch (C.primaryType){case "text":return N(G);case "application":switch (C.subType){case "json":return N(UTF8).then((S)=>new FR("json",JSON.decode(S.TD)));case "x-www-form-urlencoded":return N(ASCII).then((S){var H=Uri.splitQueryString(S.TD,encoding:G);var r={};for(var EB in H.keys){r[EB]=H[EB];}return new FR("form",r);});default:break;}break;case "multipart":switch (C.subType){case "form-data":return LB();default:break;}break;default:break;}return V();}}class Y1 implements X1{final ContentType contentType;final String yK;final dynamic JG;Y1(this.contentType,this.yK,this.JG);}class FR implements ER{final String type;final dynamic TD;FR(this.type,this.TD);}class Z1 extends FR implements dT{final HttpRequest request;Z1(this.request,ER A):super(A.type,A.TD);}abstract class bc implements Stream{static bc IIB(DN A,{Encoding defaultEncoding: UTF8})=>xl.JIB(A,defaultEncoding);}class xl extends Stream implements bc{final ContentType contentType;final HeaderValue Nq;final HeaderValue Oq;final DN UiB;bool ViB=false;Stream WiB;xl(ContentType this.contentType,HeaderValue this.Nq,HeaderValue this.Oq,DN this.UiB,Encoding B){WiB=UiB;if(Oq!=null){throw new HttpException("Unsupported contentTransferEncoding: " "${Oq.value}");}if(contentType==null||contentType.primaryType=='text'||contentType.mimeType=='application/json'){ViB=true;Encoding A;if(contentType!=null&&contentType.charset!=null){A=Encoding.getByName(contentType.charset);}if(A==null)A=B;WiB=WiB.transform(A.decoder);}}bool get QSB=>ViB;static bc JIB(DN A,Encoding H){var D;var G;var C;var I=new Map<String,String>();for(String B in A.headers.keys){switch (B){case 'content-type':D=ContentType.parse(A.headers[B]);break;case 'content-transfer-encoding':G=HeaderValue.parse(A.headers[B]);break;case 'content-disposition':C=HeaderValue.parse(A.headers[B],preserveBackslash:true);break;default:I[B]=A.headers[B];break;}}if(C==null){throw new HttpException("Mime Multipart doesn't contain a Content-Disposition header value");}return new xl(D,C,G,A,H);}StreamSubscription listen(void A(data),{void onDone(),Function onError,bool cancelOnError}){return WiB.listen(A,onDone:onDone,onError:onError,cancelOnError:cancelOnError);}String value(String A){return UiB.headers[A];}}class iT{static String Y2(String A){var B=A.length%4;if(B>0){return A.padRight(A.length+(4-B),'=');}return A;}final Xm uf;final Map payload;final yW jN;final String vg;final String token;factory iT.iWB(String C){var A=C.split('.');KR(A.length==3,'id_token string should be 3 parts. ' 'Got ${A.length} instead');var D=JSON.fuse(UTF8.fuse(BASE64));Map G;Map B;try {G=D.decode(Y2(A[0]));B=D.decode(Y2(A[1]));}catch (H){KR(H==null,'Error decoding id token. ${H}');}var I=new yW.lWB(B);return new iT(C,new Xm.jWB(G),B,I,A[2]);}iT(this.token,this.uf,this.payload,this.jN,this.vg);}class Xm{static const String QJB='typ';static const String RJB='cty';static const String SJB='alg';static const String TJB='kip';final String type;final String contentType;final String algorithm;final String SSB;Xm.jWB(Map A):type=A[QJB],contentType=A[RJB],algorithm=A[SJB],SSB=A[TJB];}class yW{static const String UJB='iss';static const String VJB='sub';static const String WJB='aud';static const String XJB='exp';static const String YJB='nbf';static const String ZJB='iat';static const String aJB='jti';static const String bJB='auth_time';static const String cJB='nonce';static const String dJB='acr';static const String eJB='amr';static const String fJB='azp';static const String gJB='session_state';final String issuer;final String subject;final List<String> audience;final DateTime expiration;final DateTime notBefore;final DateTime issuedAt;final DateTime authenticatedTime;final String nonce;final String authenticationContextClass;final String authenticationMethods;final String authorizedParty;final String jwtId;final String sessionState;final Map<String,dynamic> other;yW.kWB({this.issuer,this.subject,this.audience,this.jwtId,this.expiration,this.notBefore,this.issuedAt,this.authenticatedTime,this.nonce,this.authenticationContextClass,this.authenticationMethods,this.authorizedParty,this.sessionState,this.other});factory yW.lWB(Map A){var D=A.remove(UJB);KR(D!=null,'Required claim: Issuer is null');var G=A.remove(VJB);KR(G!=null,'Required claim: Subject is null');var B=A.remove(WJB);KR(B!=null,'Required claim: Audience is null');if(B is String){B=[B];}var H=A.remove(XJB);KR(H!=null,'Required claim: Expiration Time is null');DateTime M=kc(H);var I=A.remove(ZJB);KR(I!=null,'Required claim: Issued At Time is null');DateTime N=kc(I);var J=A.remove(YJB);DateTime O=J!=null?kc(J):null;var K=A.remove(bJB);DateTime Q=K!=null?kc(K):null;var S=A.remove(aJB);var V=A.remove(cJB);var b=A.remove(dJB);var C=A.remove(eJB);var h=A.remove(fJB);var r=A.remove(gJB);return new yW.kWB(issuer:D,subject:G,audience:B,expiration:M,issuedAt:N,notBefore:O,authenticatedTime:Q,jwtId:S,nonce:V,authenticationContextClass:b,authenticationMethods:C is List?C.join(","):C,authorizedParty:h,sessionState:r,other:A);}}void KR(bool A,String B){if(A)return;throw new FormatException('Invalid ID Token. ${B}');}const String iM='Success!';String XFB(String A)=>"A link of the name '${A}' already exists!";class iO{Directory sP;Directory yL;String nXB;String get GZ=>sP?.path;}class eb extends Object with jM{final String CB;final iO xR;Directory rP;eb(this.CB,this.xR){rP=new Directory('${xR.GZ}/${CB}');}Future<rB> iU()async{if(!await xR.sP.exists()){xR.sP=await xR.sP.create();}if(await rP.exists()){return new rB.KWB(XFB(CB));}xR.yL=await xR.sP.createTemp();return new rB.JWB(iM);}}class Tz extends Object with Mk{Tz(String C,String B,ByteData D){final A=new iO();A.sP=new Directory(C);xg=<jM>[new eb(B,A),new Uz(A,B,D)];}}class Uz extends Object with jM{iO EI;String CB;ByteData linkData;Uz(this.EI,this.CB,this.linkData);Future<rB> iU()async{try {await YQ(linkData.buffer.asUint8List(linkData.offsetInBytes,linkData.lengthInBytes),EI.yL,handleSingleDirectory:true);await EI.yL.rename('${EI.GZ}/${CB}');return new rB.JWB(iM);}catch (A){return new rB.KWB("An error occured while extracting the zip file. ${A.toString()}");}}}String get Vz=>Platform.isWindows?'gradlew.bat':'./gradlew';Future<bool> Wz(Directory A)=>new File('${A.path}/${Vz}').exists();class Xz extends Object with Mk{Xz(String C,String B,String D,String G){final A=new iO();A.sP=new Directory(C);xg=<jM>[new eb(B,A),new Yz(D,B,A,G),new Zz(A,B)];}}class Yz extends Object with jM{final String J_;final String CB;final iO bZ;final String M9;Directory rP;Yz(this.J_,this.CB,this.bZ,this.M9){rP=new Directory('${bZ.GZ}/${CB}');}Future<rB> iU()async{var A=await VE("git");if(A==null){return new rB.KWB("Git is not installed.");}IH B=await XiB(J_,bZ.yL,A);var C=YiB(B);return C;}Future<IH> XiB(String A,Directory B,String C)async{IH D=await gF(C,args:["clone",A,B.path],outputFile:new File(M9),writeToBuffer:true);return D;}Future<Null> onError()async{if(await bZ.yL.exists()){await bZ.yL.delete(recursive:true);}}rB YiB(IH A){if(A.exitCode!=0){String B;if(A.stderr.contains("Could not resolve host")){B="Failed to resolve host. Either this site does not exist, " "or you are not connected to the internet.";}else if(A.stderr.contains("does not exist")){B="Repository does not exist.";}else{B=A.stderr.toString();}return new rB.KWB(B);}else{return new rB.JWB(iM);}}}class Zz extends Object with jM{final iO EI;final String CB;Directory rP;Zz(this.EI,this.CB){rP=new Directory('${EI.GZ}/${CB}');}Future<Null> onError()async{await EI.yL.delete(recursive:true);}Future<rB> iU()async{final A=EI.yL;if(await Wz(A)){var B=await ZFB(A);if(!B.aD){return B;}final C=new Directory('${A.path}/build/distributions');if(!await C.exists()){return new rB.KWB("Directory doesn't contain 'distributions' directory");}File D=await YFB(C);if(D==null){return new rB.KWB("Couldn't find the distZip file.");}B=await aFB(rP,D);if(!B.aD){return B;}await A.delete(recursive:true);}else{await A.rename(rP.path);}return new rB.JWB(iM);}static Future<File> YFB(Directory A)async=>A.list().firstWhere((FileSystemEntity B)=>B.path.contains('.zip'),defaultValue:()=>null);static Future<rB> ZFB(Directory A)async{if(!await Wz(A)){return new rB.KWB("Gradle wrapper wasn't provided with the DSLink");}final B=await gF(Vz,workingDirectory:A.path,args:['distZip']);final C="Couldn't build the link.";if(B.exitCode!=0){return new rB.KWB('${C} Reason: ${lh.stderr}');}return new rB.JWB(iM);}static Future<rB> aFB(Directory A,File B)async{try {await YQ(await B.readAsBytes(),A,handleSingleDirectory:true);return new rB.JWB(iM);}catch (C){return new rB.KWB("An error occured while extracting the zip file. ${C.toString()}");}}}class az extends Object with Mk{az(String C,String B,String D){final A=new iO();A.sP=new Directory(C);xg=<jM>[new eb(B,A),new bz(A,D,B)];}}class bz extends Object with jM{iO EI;String F9;String CB;bz(this.EI,this.F9,this.CB);Future<rB> iU()async{try {await Hb(F9,EI.yL,handleSingleDirectory:true);await EI.yL.rename('${EI.GZ}/${CB}');return new rB.JWB(iM);}catch (A){return new rB.KWB(A.toString());}}}abstract class jM{Future<rB> iU();Future<Null> onError()async{}}abstract class Mk{List<jM> xg=[] ;Future<rB> mq()async{rB A=new rB.KWB('No step have been executed');for(final B in xg){A=await B.iU();if(!A.aD){await B.onError();break;}}if(!A.aD){await onError();}return A;}Future<Null> onError()async{}}class rB{final bool aD;final String message;rB.JWB(this.message):aD=true;rB.KWB(this.message):aD=false;}abstract class FN extends AD{String get AK;bool Rf(String A);bool VC(int A);bool CV(String A);int AL(String A,{bool withDrive: false});String e8(String A){var B=AL(A);if(B>0)return A.substring(0,B);return oF(A)?A[0]:null;}bool oF(String A);String cZ(Uri A);Uri Ns(String A){var B=context.split(A);if(VC(A.codeUnitAt(A.length-1)))B.add('');return new Uri(pathSegments:B);}Uri HY(String A);bool Of(int A,int B)=>A==B;bool Es(String A,String B)=>A==B;int U7(int A)=>A;String V7(String A)=>A;}class MIB{static String get cc{var A=Zone.current[#Intl.locale];return A==null?c1:A;}static set cc(String A){c1=A;}static String c1;static String PIB='en_US';static String e1(String A,Function B,{Function onFailure: QIB}){if(A==null){return e1(f1(),B,onFailure:onFailure);}if(B(A)){return A;}for(var C in [SIB(A),RIB(A),"fallback"]){if(B(C)){return C;}}return onFailure(A);}static String QIB(String A){throw new ArgumentError("Invalid locale '${A}'");}static String RIB(String A){if(A.length<2)return A;return A.substring(0,2).toLowerCase();}static String SIB(String A){if(A==null)return f1();if(A=="C")return "en_ISO";if(A.length<5)return A;if(A[2]!='-'&&(A[2]!='_'))return A;var B=A.substring(3);if(B.length<=3)B=B.toUpperCase();return '${A[0]}${A[1]}_${B}';}static String f1(){if(cc==null)cc=PIB;return cc;}}class eT{eT([String A,String B]){ZiB=MIB.e1(B,TIB);qp(A);}String kP(DateTime B){var A=new StringBuffer();aiB.forEach((C)=>A.write(C.kP(B)));return A.toString();}DateTime YD(String A,[B=false])=>biB(A,utc:B,strict:false);DateTime biB(String B,{utc: false,strict: false}){var A=new GR();if(utc)A.I$=true;var C=new fG(B);aiB.forEach((D)=>D.YD(C,A));if(strict&&!C.M7()){throw new FormatException("Characters remaining after date parsing in ${B}");}if(strict)A.Ca(B);return A.wp();}String get jSB=>ZiB;eT bPB()=>qp("yMMMMd");eT aPB()=>qp("jms");String ZiB;String ciB;List<BN> diB;List<BN> get aiB{if(diB==null){if(ciB==null)eiB();diB=jTB(ciB);}return diB;}eiB(){bPB();aPB();}static List<RegExp> g1=[new RegExp("^\'(?:[^\']|\'\')*\'"),new RegExp("^(?:G+|y+|M+|k+|S+|E+|a+|h+|K+|H+|c+|L+|Q+|d+|D+|m+|s+|v+|z+|Z+)"),new RegExp("^[^\'GyMkSEahKHcLQdDmsvzZ]+")];fiB(String A,[String B=' ']){ciB=ciB==null?A:"${ciB}${B}${A}";}eT qp(String A,[String B=' ']){diB=null;if(A==null)return this;if(!giB.containsKey(A)){fiB(A,B);}else{fiB(giB[A],B);}return this;}get pattern=>ciB;Map get giB=>WIB[jSB];qW get PQB{if(ZiB!=j1){j1=ZiB;i1=h1[ZiB];}return i1;}static bool TIB(A){if(A==null)return false;return h1.containsKey(A);}static List get UIB=>[(A,B)=>new b1(A,B),(A,B)=>new d1(A,B),(A,B)=>new a1(A,B)];List<BN> jTB(String A){if(A==null)return null;return hiB(A).reversed.toList();}List<BN> hiB(String A){if(A.isEmpty)return [] ;var B=iiB(A);if(B==null)return [] ;var C=hiB(A.substring(B.M8().length));C.add(B);return C;}BN iiB(String C){for(var A=0;A<g1.length;A++ ){var D=g1[A];var B=D.firstMatch(C);if(B!=null){return UIB[A](B.group(0),this);}}return null;}}abstract class BN{final String pattern;eT parent;String jiB;BN(this.pattern,this.parent){jiB=pattern.trim();}int get width=>pattern.length;String M8()=>pattern;String toString()=>pattern;String kP(DateTime A){return pattern;}void YD(fG A,GR B);void u9(fG A){var B=A.read(width);if(B!=pattern){Gh(A);}}void Gh(fG A){throw new FormatException("Trying to read ${this} from ${A.DI} " "at position ${A.index}");}}class a1 extends BN{a1(A,B):super(A,B);YD(fG A,GR B){u9(A);}}class b1 extends BN{String kiB;String M8()=>kiB;b1(A,B):super(OIB(A),B){kiB=A;}YD(fG A,GR B){u9(A);}static final NIB=new RegExp(r"''");static String OIB(String A){if(A=="''"){return "'";}else{return A.substring(1,A.length-1).replaceAll(NIB,"'");}}}class d1 extends BN{d1(A,B):super(A,B);String kP(DateTime A){return DRB(A);}void YD(fG A,GR B){hTB(A,B);}void hTB(fG A,GR B){try {switch (pattern[0]){case 'a':dTB(A,B);break;case 'c':kTB(A);break;case 'd':AJ(A,B.Y_);break;case 'D':AJ(A,B.Y_);break;case 'E':eTB(A);break;case 'G':gTB(A);break;case 'h':cTB(A,B);break;case 'H':AJ(A,B.rg);break;case 'K':AJ(A,B.rg);break;case 'k':AJ(A,B.rg,-1);break;case 'L':lTB(A,B);break;case 'M':iTB(A,B);break;case 'm':AJ(A,B.YUB);break;case 'Q':break;case 'S':AJ(A,B.VUB);break;case 's':AJ(A,B.bUB);break;case 'v':break;case 'y':AJ(A,B.cUB);break;case 'z':break;case 'Z':break;default:return;}}catch (C){Gh(A);}}String DRB(DateTime A){switch (pattern[0]){case 'a':return yQB(A);case 'c':return JRB(A);case 'd':return zQB(A);case 'D':return BRB(A);case 'E':return ARB(A);case 'G':return CRB(A);case 'h':return wQB(A);case 'H':return vQB(A);case 'K':return uQB(A);case 'k':return xQB(A);case 'L':return KRB(A);case 'M':return GRB(A);case 'm':return FRB(A);case 'Q':return HRB(A);case 'S':return ERB(A);case 's':return IRB(A);case 'v':return MRB(A);case 'y':return ORB(A);case 'z':return LRB(A);case 'Z':return NRB(A);default:return '';}}qW get symbols=>parent.PQB;CRB(DateTime B){var A=B.year>0?1:0;return width>=4?symbols.ERANAMES[A]:symbols.ERAS[A];}ORB(DateTime B){var A=B.year;if(A<0){A=-A;}return width==2?gG(2,A%100):gG(width,A);}void AJ(fG A,Function C,[int D=0]){var B=A.ySB();if(B==null)Gh(A);C(B+D);}int GV(fG B,List A){var C=new fG(A).qQB((D)=>B.OD(D.length)==D);if(C.isEmpty)Gh(B);C.sort((H,I)=>A[H].length.compareTo(A[I].length));var G=C.last;B.read(A[G].length);return G;}String GRB(DateTime A){switch (width){case 5:return symbols.NARROWMONTHS[A.month-1];case 4:return symbols.MONTHS[A.month-1];case 3:return symbols.SHORTMONTHS[A.month-1];default:return gG(width,A.month);}}void iTB(B,C){var A;switch (width){case 5:A=symbols.NARROWMONTHS;break;case 4:A=symbols.MONTHS;break;case 3:A=symbols.SHORTMONTHS;break;default:return AJ(B,C.Z_);}C.month=GV(B,A)+1;}String xQB(DateTime A){return gG(width,A.hour);}String ERB(DateTime B){var A=gG(3,B.millisecond);if(width-3>0){var C=gG(width-3,0);return A+C;}else{return A;}}String yQB(DateTime B){var A=B.hour;var C=(A>=12)&&(A<24)?1:0;var D=symbols.AMPMS;return D[C];}void dTB(A,B){var C=GV(A,symbols.AMPMS);if(C==1)B.x9=true;}String wQB(DateTime B){var A=B.hour;if(B.hour>12)A=A-12;if(A==0)A=12;return gG(width,A);}void cTB(fG B,GR A){AJ(B,A.rg);if(A.hour==12)A.hour=0;}String uQB(DateTime A){return gG(width,A.hour%12);}String vQB(DateTime A){return gG(width,A.hour);}String JRB(DateTime A){switch (width){case 5:return symbols.STANDALONENARROWWEEKDAYS[A.weekday%7];case 4:return symbols.STANDALONEWEEKDAYS[A.weekday%7];case 3:return symbols.STANDALONESHORTWEEKDAYS[A.weekday%7];default:return gG(1,A.day);}}void kTB(fG B){var A;switch (width){case 5:A=symbols.STANDALONENARROWWEEKDAYS;break;case 4:A=symbols.STANDALONEWEEKDAYS;break;case 3:A=symbols.STANDALONESHORTWEEKDAYS;break;default:return AJ(B,(C)=>C);}GV(B,A);}String KRB(DateTime A){switch (width){case 5:return symbols.STANDALONENARROWMONTHS[A.month-1];case 4:return symbols.STANDALONEMONTHS[A.month-1];case 3:return symbols.STANDALONESHORTMONTHS[A.month-1];default:return gG(width,A.month);}}void lTB(B,C){var A;switch (width){case 5:A=symbols.STANDALONENARROWMONTHS;break;case 4:A=symbols.STANDALONEMONTHS;break;case 3:A=symbols.STANDALONESHORTMONTHS;break;default:return AJ(B,C.Z_);}C.month=GV(B,A)+1;}String HRB(DateTime B){var A=((B.month-1)/3).truncate();switch (width){case 4:return symbols.QUARTERS[A];case 3:return symbols.SHORTQUARTERS[A];default:return gG(width,A+1);}}String zQB(DateTime A){return gG(width,A.day);}String BRB(DateTime A)=>gG(width,QQB(A));int QQB(DateTime A){if(A.month==1)return A.day;if(A.month==2)return A.day+31;return UTB(A)+59+(LSB(A)?1:0);}int UTB(DateTime A)=>((30.6*A.month)-91.4).floor()+A.day;bool LSB(DateTime A){var B=new DateTime(A.year,2,29);return B.month==2;}String ARB(DateTime A){return (width>=4?symbols.WEEKDAYS:symbols.SHORTWEEKDAYS)[(A.weekday)%7];}void eTB(fG A){var B=width>=4?symbols.WEEKDAYS:symbols.SHORTWEEKDAYS;GV(A,B);}void gTB(fG A){var B=width>=4?symbols.ERANAMES:symbols.ERAS;GV(A,B);}String FRB(DateTime A){return gG(width,A.minute);}String IRB(DateTime A){return gG(width,A.second);}String MRB(DateTime A){throw new UnimplementedError();}String LRB(DateTime A){throw new UnimplementedError();}String NRB(DateTime A){throw new UnimplementedError();}static String gG(int A,Object B)=>'${B}'.padLeft(A,'0');}class GR{int year=1970;int month=1;int day=1;int hour=0;int minute=0;int second=0;int mf=0;bool x9=false;bool I$=false;void cUB(A){year=A;}void Z_(A){month=A;}void Y_(A){day=A;}void rg(A){hour=A;}void YUB(A){minute=A;}void bUB(A){second=A;}void VUB(A){mf=A;}get sY=>x9?hour+12:hour;Ca(String B){liB(month,1,12,"month",B);liB(sY,0,23,"hour",B);liB(minute,0,59,"minute",B);liB(second,0,59,"second",B);liB(mf,0,999,"fractional second",B);var A=wp();liB(sY,A.hour,A.hour,"hour",B,A);liB(day,A.day,A.day,"day",B,A);liB(year,A.year,A.year,"year",B,A);}liB(int A,int B,int C,String G,String H,[DateTime D]){if(A<B||A>C){var I=D==null?"":" Date parsed as ${D}.";throw new FormatException("Error parsing ${H}, invalid ${G} value: ${A}." " Expected value between ${B} and ${C}.${I}");}}DateTime wp({int retries: 10}){var A;if(I$){A=new DateTime.utc(year,month,day,sY,minute,second,mf);}else{A=new DateTime(year,month,day,sY,minute,second,mf);if(retries>0&&(A.hour!=sY||A.day!=day)){A=wp(retries:retries-1);}}return A;}}class fG{var DI;int index=0;fG(this.DI);bool M7()=>index>=DI.length;next()=>DI[index++ ];read([int A=1]){var B=OD(A);index+= A;return B;}bool startsWith(String A){if(DI is String)return DI.startsWith(A,index);return A==OD(A.length);}OD([int B=1]){var A;if(DI is String){String C=DI;A=C.substring(index,LJ.min(index+B,C.length));}else{A=DI.sublist(index,index+B);}return A;}yJ()=>OD(DI.length-index);List qQB(Function B){var A=[] ;while(!M7()){if(B(next()))A.add(index-1);}return A;}var XQB=new RegExp(r'^\d+');int ySB(){var A=XQB.stringMatch(yJ());if(A==null||A.isEmpty)return null;read(A.length);return int.parse(A);}}class yl<MN> implements XIB{final String message;final MN C8;yl(this.message,this.C8);operator[](String A)=>(A=='en_US')?C8:miB();List<String> niB=[] ;List<String> get keys=>miB() as List<String>;bool containsKey(String A)=>(A=='en_US')?true:miB();miB(){throw new k1("Locale data has not been initialized" ", call ${message}.");}}abstract class XIB{}class k1 implements Exception{final String message;k1(this.message);toString()=>"LocaleDataException: ${message}";}bool get kHB=>tl!=null;final tl=oHB();final ClassMirror Q1=tl.declarations[const Symbol('HttpClient')];final ClassMirror lHB=tl.declarations[const Symbol('HttpException')];void R1(String A){if(kHB)return;throw new UnsupportedError("${A} isn't supported on this platform.");}mHB()=>Q1.newInstance(const Symbol(''),[] ).reflectee;bool S1(A)=>reflect(A).type.isSubtypeOf(lHB);bool nHB(A)=>reflect(A).type.isSubtypeOf(Q1);LibraryMirror oHB(){try {return currentMirrorSystem().findLibrary(const Symbol('dart.io'));}catch (A){return null;}}class Zc extends P1{var oiB;Zc([A]){R1("IOClient");if(A!=null){assert(nHB(A));oiB=A;}else{oiB=mHB();}}Future<cT> send(yO A)async{var H=A.rq();try {var D=await oiB.openUrl(A.method,A.QE);D..followRedirects=A.followRedirects..maxRedirects=A.maxRedirects..contentLength=A.contentLength==null?-1:A.contentLength..persistentConnection=A.persistentConnection;A.headers.forEach((I,J){D.headers.set(I,J);});var B=await H.pipe(vh.AAB(D));var G=<String,String>{};B.headers.forEach((K,M){G[K]=M.join(',');});return new cT(y$.z$(B).handleError((C)=>throw new Yc(C.message,C.uri),test:(C)=>S1(C)),B.statusCode,contentLength:B.contentLength==-1?null:B.contentLength,request:A,headers:G,isRedirect:B.isRedirect,persistentConnection:B.persistentConnection,reasonPhrase:B.reasonPhrase);}catch (C){if(!S1(C))rethrow;throw new Yc(C.message,C.uri);}}void close(){if(oiB!=null)oiB.close(force:true);oiB=null;}}typedef hC ZKB();class vc implements hC{final ZKB piB;hC qiB;vc(this.piB);hC get riB{if(qiB==null)qiB=piB();return qiB;}List<IC> get PO=>riB.PO;hC get YS=>riB.YS;hC jP(bool A(uC frame),{bool terse: false})=>new vc(()=>riB.jP(A,terse:terse));IC Lh()=>new oT(()=>riB.Lh());String toString()=>riB.toString();}typedef IC aKB();class oT implements IC{final aKB siB;IC tiB;oT(this.siB);IC get uiB{if(tiB==null)tiB=siB();return tiB;}List<uC> get GI=>uiB.GI;IC get YS=>new oT(()=>uiB.YS);IC jP(bool A(uC frame),{bool terse: false})=>new oT(()=>uiB.jP(A,terse:terse));String toString()=>uiB.toString();}enum _type {and,or,not,equal,approx,greater,less,present,ident,substring,lParen,rParen,END}class vE{_type type;String FM;vE(this.type,this.FM);}class Dy{final String input;int NV=0;int YH=0;Dy(this.input);String oB(){var A=input[YH];YH+= 1;return A;}String OD(){if(YH>=input.length){return null;}return input[YH];}bool KZ(String A){if(YH>=input.length||input[YH]!=A){return false;}YH+= 1;return true;}List<vE> WRB(){var A=<vE>[] ;while(YH<input.length){NV=YH;A.add(OUB());}A.add(new vE(_type.END,""));return A;}vE OUB(){var A=oB();switch (A){case '(':return new vE(_type.lParen,A);case ')':return new vE(_type.rParen,A);case '&':return new vE(_type.and,A);case '|':return new vE(_type.or,A);case '!':return new vE(_type.not,A);case '=':if(OD()=='*'){oB();return new vE(_type.present,input.substring(NV,YH));}return new vE(_type.equal,A);case '~':if(KZ('=')){return new vE(_type.approx,input.substring(NV,YH));}throw 'Unexpected character after "~" expected "=" got: "${OD}()"';case '>':if(KZ('=')){return new vE(_type.greater,input.substring(NV,YH));}throw 'Unexpected character after ">" expected "=" got: "${OD}()"';case '<':if(KZ('=')){return new vE(_type.less,input.substring(NV,YH));}throw 'Unexpected character after "<" expected "=" got: "${OD}()"';default:if(x8(A)){return identifier();}throw "Unknown token: '${A}'";}}final wRB=new RegExp(r'\w+|\s');bool x8(String A){return wRB.hasMatch(A);}vE identifier(){var A=OD();bool B=false;while(YH<input.length&&(A=='.'||A=='*'||A==' '||x8(A))){if(A=='*')B=true;oB();A=OD();}var C=B?_type.substring:_type.ident;return new vE(C,input.substring(NV,YH));}}class Lb{_type type;String pR;String value;List<SB> qq;SB qXB;}class bEB{int index=0;vE UD;vE qTB;List<vE> cH;void AO(){if(UD.type==_type.END||index>=cH.length)return;index+= 1;qTB=UD;UD=cH[index];}SB AMB(String A){var B=new Dy(A);cH=B.WRB();UD=cH[index];return Cs();}SB Cs(){var A=new Lb();if(UD.type!=_type.lParen){throw 'Unexpected token "${UD.FM}". expected "("';}AO();if(UD.type==_type.and){AO();return SB.tS(qq());}if(UD.type==_type.or){AO();return SB.yu(qq());}if(UD.type==_type.not){AO();return SB.rAB(Cs());}if(UD.type!=_type.ident){throw 'Unexpected token "${UD.FM}". Expected attribute name.';}A.pR=UD.FM;AO();if(UD.type==_type.present){viB(isPresent:true);return SB.zu(A.pR);}A.type=UD.type;AO();switch (A.type){case _type.equal:return LE(A);case _type.approx:return cPB(A);case _type.less:case _type.greater:return mSB(A);}throw 'Unexpected token: "${UD.FM}". '+"Expected filterType after attribute.";}List<SB> qq(){var A=<SB>[] ;while(UD.type!=_type.END&&UD.type!=_type.rParen){A.add(Cs());}if(UD.type!=_type.rParen){throw 'Unexpected token: "${UD.FM}". '+'Expected ")" after filter list.';}AO();return A;}SB LE(Lb A){A.value=wiB('=',acceptSubstring:true);if(UD.type==_type.substring)A.type=UD.type;viB();if(A.type==_type.substring){return SB.sAB('${A.pR}=${A.value}');}return SB.fa(A.pR,A.value);}SB cPB(Lb A){A.value=wiB('~=');viB();return SB.wAB(A.pR,A.value);}SB mSB(Lb A){var B=A.type==_type.less?'<=':'>=';A.value=wiB(B);viB();if(A.type==_type.less){return SB.uAB(A.pR,A.value);}return SB.tAB(A.pR,A.value);}String wiB(String A,{bool acceptSubstring: false}){if(UD.type==_type.ident||(UD.type==_type.substring&&acceptSubstring)){return UD.FM;}throw 'Unexpected token: "${UD.FM}". '+'Expected value after "${A}".';}String viB({bool isPresent: false}){AO();if(UD.type!=_type.rParen){if(isPresent){throw 'Unexpected token: "${UD.FM}". '+'Expected ")" after present filter.';}throw 'Unexpected token: "${UD.FM}". '+'Expected ")" after filter value.';}AO();}}class cw extends eO{String xiB;Map<String,EH> yiB;cw(this.xiB,Map<String,EH> this.yiB):super(nw);yC HJ(){var A=ziB();A.add(new FD(xiB));var C=new ZC();yiB.forEach((I,EH D){var B=new ZC();B.add(new FD(D.name));var G=new ZC();D.values.forEach((dynamic H){G.add(new FD(H));});B.add(G);C.add(B);});A.add(C);return A;}}class dw extends eO{String AjB;String BjB;static const int EBB=0x80;dw(this.AjB,this.BjB):super(ei);yC HJ(){var A=ziB();var B=new gH(3);A.add(B);var C=new FD(AjB);var D=new FD(BjB,tag:EBB);A.add(C);A.add(D);return A;}}class bw extends eO{String xiB;bw(this.xiB):super(pw);yC HJ()=>new FD(xiB,tag:pw);}class gE{int CjB;int DjB;int get Js=>DjB;ZC EjB;ZC FjB;yC GjB;List<yC> get zB=>(GjB as ZC).zB;int get IM=>CjB;ZC get Sf=>FjB;bool get qRB=>FjB!=null;ZC get HV=>EjB;int get qSB=>GjB.r_;gE(this.CjB,eO B,[List<QJ> A=null]){DjB=B.sTB;GjB=B.HJ();if(A!=null&&A.length>0){FjB=new ZC(tag:KBB);A.forEach((C){FjB.add(C.HJ());ii.kC("Adding control ${C}");});}}gE.HWB(Uint8List A){GjB=new ZC.lVB(A);if(GjB==null){throw new ia("Parsing error on ${A}");}if(zB.length!=2&&zB.length!=3){throw new ia("Expecting 2 or 3 elements: got ${zB.length} obj=${GjB}");}var C=zB[0] as gH;CjB=C.tG;EjB=zB[1] as ZC;DjB=EjB.tag;if(zB.length==3){var B=zB[2].uJ;if(B[0]==QJ.lAB)FjB=new ZC.lVB(B);}PL.mB(()=>"LDAP message received: Id=${IM} protocolOp=${HV}");}List<int> toBytes(){ZC A=new ZC();A.add(new gH(CjB));A.add(GjB);if(FjB!=null)A.add(FjB);var B=A.uJ;return B;}String toString(){var A=sw(DjB);return "Msg(id=${CjB}, op=${A},controls=${FjB})";}}const int ei=0x60;const int fi=0x61;const int hw=0x63;const int iw=0x64;const int jw=0x65;const int kw=0x73;const int lw=0x66;const int FBB=0x67;const int nw=0x68;const int ow=0x69;const int GBB=0x78;const int pw=0x4A;const int HBB=0x6B;const int IBB=0x6C;const int qw=0x6D;const int JBB=0x6E;const int rw=0x6F;const int KBB=0xA0;String sw(int A){switch (A){case ei:return "BND_REQ";case fi:return "BND_RESP";case hw:return "SRCH_REQ";case iw:return "SRCH_RES_ENTRY";case jw:return "SRCH_RES_DONE";case kw:return "SRCH_RES_REF";case lw:return "MODIFY_REQUEST";case nw:return "ADD_REQUEST";case ow:return "ADD_RESPONSE";case IBB:return "MODIFY_DN_REQ";case qw:return "MODIFY_DN_RESP";case JBB:return "COMPARE_REQ";case rw:return "COMPARE_RESP";default:return A.toRadixString(16);}}cC rD=new cC("ldap.connection");cC ii=new cC("ldap.send.ldap");cC ka=new cC("ldap.send.bytes");cC PL=new cC("ldap.recv.ldap");cC tw=new cC("ldap.recv.asn1");cC JK=new cC("ldap.recv.bytes");class gw extends IK{gw(gE A):super(A);}class di extends IK{di(gE A):super(A);}class mw extends IK{mw(gE A):super(A);}class hi extends IK{String N_;String response;hi(gE A):super(A){N_=HjB(A.zB[2]);if(A.zB.length==4){response=HjB(A.zB[3]);}}String HjB(yC A){var B=new FD.pVB(A.uJ);return B.bF;}}class ew extends eO{String xiB;List<hV> IjB;ew(this.xiB,this.IjB):super(lw);yC HJ(){var A=ziB();A.add(new FD(xiB));var D=new ZC();IjB.forEach((hV B){var C=new ZC();C.add(new gH(B.TTB));C.add(JjB(B.SY,B.values));D.add(C);});A.add(D);return A;}ZC JjB(String C,List D){var A=new ZC();A.add(new FD(C));var B=new ZC();D.forEach((G){B.add(new FD(G));});A.add(B);return A;}}class fw{int EjB;int get sTB=>EjB;fw(this.EjB);ZC ziB(){var A=new ZC(tag:EjB);return A;}}abstract class eO extends fw{eO(int A):super(A);yC HJ();}class IK{cB KjB;List<QJ> FjB=[] ;List<QJ> get Sf=>FjB;cB get GS=>KjB;IK.GWB();IK(gE A){PL.oE(()=>"Response op=${A}");KjB=LjB(A.HV);if(A.qRB)FjB=QJ.mAB(A.FjB);}cB LjB(ZC A){PL.oE("Parse LDAP result: ${A}");gH B=A.zB[0];var C=B.tG;var D=A.zB[1] as FD;var G=D.bF;var H=A.zB[2] as FD;var I=H.bF;List<String> J=[] ;if(A.zB.length>3){var K=A.zB[3];PL.oE("Parse LDAP result: type=${K}");}return new cB(C,G,I,J);}}abstract class CBB{static IK DBB(gE A){PL.oE(()=>"LDAP response received: ${sw(A.HV.tag)}");switch (A.HV.tag){case fi:return new gw(A);case iw:return new kV(A);case kw:return new kV.FWB(A);case jw:return new di(A);case GBB:return new hi(A);case ow:case HBB:case FBB:case qw:case rw:return new mw(A);default:throw "Not done";}}}class gi extends eO{String MjB;int NjB;int OjB;int PjB=0;List<String> yiB;bool QjB=false;int RjB=0;SB SjB;gi(this.MjB,this.SjB,this.yiB,[this.NjB=lu.mu,this.OjB=0]):super(hw);yC HJ(){var A=ziB();var B=new ZC();yiB.forEach((String C){B.add(new FD(C));});A..add(new FD(MjB))..add(new sh(NjB))..add(new sh(PjB))..add(new gH(OjB))..add(new gH(RjB))..add(new Ra(QjB))..add(SjB.HJ())..add(B);return A;}}class kV extends IK{tF TjB;tF get Xs=>TjB;kV.FWB(gE A):super.GWB(){PL.mB(()=>"Search result is a referral");var B=A.HV.zB;var C=B.map((D)=>(D as FD).bF).toList();TjB=new tF(null,referrals:C);}kV(gE H):super.GWB(){var A=H.HV;var I=A.zB[0] as FD;var C=I.bF;PL.mB(()=>"Search Result Entry: dn=${C}");var J=A.zB[1] as ZC;TjB=new tF(C);J.zB.forEach((K){var D=K as ZC;var B=D.zB[0] as FD;var M=D.zB[1] as mS;var G=M.zB.map((N)=>(N as FD).bF).toSet();Xs.JB[B.bF]=new EH(B.bF,G);PL.kC("attribute: ${B.bF}=${G}");});if(A.zB.length>=3){var O=A.zB[2];PL.kC("controls: ${O}");}}String toString(){return "SearchResultEntry(${Xs}})";}}class eL{static String rW;static Future<String> dIB()async{if(rW==null){try {HR A=await l1('git',args:['--version'],writeToBuffer:true);if(A.exitCode==0&&A.XE.startsWith('git version ')){rW=A.XE.substring(12).trim();}else{rW='';}}catch (B){rW='';}}return rW;}static Future<bool> eIB()async{return (await dIB())!='';}final Directory wR;factory eL.cWB(String A){var B=new Directory(A);return new eL.dWB(B);}factory eL.dWB(Directory A){if(!A.existsSync()){A.createSync(recursive:true);}return new eL.eWB(A.absolute);}eL.eWB(this.wR);Future<fT> zL(String B)async{var C=["commit","-m",B];var D=await BM(C);if(D.exitCode!=0){return null;}else{var A=await G9(limit:1);if(A==null){return null;}else{return A[0];}}}Future<List<fT>> G9({int limit,String range,String file,bool detail: false})async{var C=["log","--format=format:-;;;;-%H%n%T%n%aN%n%aE%n%cN%n%cE%n%ai%n%ci%n%d%n%B-;;;-","--no-color","--decorate"];if(limit!=null){C.add("--max-count=${limit}");}if(range!=null){C.add(range);}if(detail){C.add('--name-status');}if(file!=null){C.addAll(["--",file]);}HR J=await BM(C);if(J.exitCode!=0){return null;}else{String O=J.stdout.toString();var K=[] ;List<String> M=O.split("-;;;;-").map((D)=>D.trim()).toList();M.removeWhere((D)=>D.isEmpty||!D.contains("\n"));for(String G in M){List H;List N=G.split('-;;;-');G=N[0];if(detail){H=[] ;String Q=N[1];List S=Q.split('\n');for(String V in S){List I=V.split('\t');if(I.length==2){H.add(new ec(I[1],I[0]));}}}var A=G.split("\n");var B=new fT(this);B.wC=H;B.a_=A[0];B.oUB=A[1];B.gPB=new sW(this)..name=A[2]..GE=A[3];B.EQB=new sW(this)..name=A[4]..GE=A[5];B.hPB=DateTime.parse(A[6]);B.e7=DateTime.parse(A[7]);B.UUB(A[8]);B.message=A.getRange(9,A.length).join("\n").trim();K.add(B);}return K;}}Future add([String A="."])async{var B=["add",wR.path];var C=await BM(B);Mf(C.exitCode,"Failed to add ${A}.");}Future<bool> OSB()async{var A=await BM(["rev-parse","--show-cdup"]);return A.exitCode==m1.o1&&A.XE.trim()=="";}Future kg(String A)async{var B=["revert",A];var C=await BM(B);Mf(C.exitCode,"Failed to revert ${A}.");}Future KQB(String B,{String commit,String message})async{var A=["tag",B];if(commit!=null){A.add(commit);}if(message!=null){A.add('-m');A.add(message);}var C=await BM(A);Mf(C.exitCode,"Failed to create tag ${B}");}Future<HR> BM(List<String> A,{bool binary: false,dc outputHandler,stdin,bool writeToBuffer: true})async{var B=await l1("git",args:A,workingDirectory:wR.path,binary:binary,outputHandler:outputHandler,stdin:stdin,writeToBuffer:writeToBuffer);return B;}Future init({bool bare: false})async{var A=["init"];if(bare){A.add("--bare");}var B=await BM(A);Mf(B.exitCode,"Failed to init repository.");}Mf(int A,String B){if(A!=m1.o1){throw new n1(B);}}Future delete()async{await wR.delete(recursive:true);}}class ec{String name;String wI;ec(this.name,this.wI);}class fT{final eL Kr;fT(this.Kr);String a_;String oUB;String message;List<String> Xf;sW gPB;DateTime hPB;DateTime e7;sW EQB;List<ec> wC;void UUB(String A){if(A.length>2){Xf=A.substring(A.indexOf('(')+1,A.lastIndexOf(')')).split(', ');}else{Xf=null;}}}class sW{final eL Kr;sW(this.Kr);String name;String GE;String toString()=>"${name} <${GE}>";}class n1{final String message;n1(this.message);String toString()=>message;}class m1{static const int o1=0;}typedef dynamic YIB(HR _0);typedef dynamic ZIB(Process _0);typedef dynamic dc(String _0);typedef dynamic aIB(String _0);Stdin get bIB=>lh.stdin;class HR extends ProcessResult{final String XE;HR(int A,int B,C,D,this.XE):super(A,B,C,D);}class cIB{}Future<HR> l1(String I,{List<String> args: const[] ,String workingDirectory,Map<String,String> environment,bool includeParentEnvironment: true,bool runInShell: false,stdin,ZIB handler,dc stdoutHandler,dc stderrHandler,dc outputHandler,File outputFile,bool inherit: false,bool writeToBuffer: false,bool binary: false,YIB resultHandler,bool inheritStdin: false,aIB logHandler})async{cIB D=Zone.current["legit.io.process.ref"];if(D!=null){outputFile=outputFile!=null?outputFile:D.lY.wXB;logHandler=logHandler!=null?logHandler:D.lY.xXB;}IOSink C;if(outputFile!=null){if(!(await outputFile.exists())){await outputFile.create(recursive:true);}C=await outputFile.openWrite(mode:FileMode.APPEND);}try {Process A=await Process.start(I,args,workingDirectory:workingDirectory,environment:environment,includeParentEnvironment:includeParentEnvironment,runInShell:runInShell);var G=A.pid.toString();if(D!=null){D.AYB(A);inherit=inherit||D.lY.uXB;}if(C!=null){await C.writeln("[${zO}][${G}] == Executing ${I}" " with arguments ${args} (pid: ${A.pid}) ==");}if(logHandler!=null){logHandler("[${zO}][${G}] == Executing ${I}" " with arguments ${args} (pid: ${A.pid}) ==");}var J=new StringBuffer();var O=new StringBuffer();var Q=new StringBuffer();var K=<int>[] ;var S=<int>[] ;var V=<int>[] ;if(!binary){A.stdout.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((B)async{if(writeToBuffer){O.writeln(B);J.writeln(B);}if(stdoutHandler!=null){stdoutHandler(B);}if(outputHandler!=null){outputHandler(B);}if(inherit){lh.stdout.writeln(B);}if(C!=null){await C.writeln("[${zO}][${G}] ${B}");}if(logHandler!=null){logHandler("[${zO}][${G}] ${B}");}});A.stderr.transform(const Utf8Decoder(allowMalformed:true)).transform(const LineSplitter()).listen((B)async{if(writeToBuffer){Q.writeln(B);J.writeln(B);}if(stderrHandler!=null){stderrHandler(B);}if(outputHandler!=null){outputHandler(B);}if(inherit){lh.stderr.writeln(B);}if(C!=null){await C.writeln("[${zO}][${G}] ${B}");}if(logHandler!=null){logHandler("[${zO}][${G}] ${B}");}});}else{A.stdout.listen((H){K.addAll(H);V.addAll(H);});A.stderr.listen((H){K.addAll(H);S.addAll(H);});}if(handler!=null){handler(A);}if(stdin!=null){if(stdin is Stream){stdin.listen(A.stdin.add,onDone:A.stdin.close);}else if(stdin is List){A.stdin.add(stdin);}else{A.stdin.write(stdin);await A.stdin.close();}}else if(inheritStdin){bIB.listen(A.stdin.add,onDone:A.stdin.close);}var M=await A.exitCode;await new Future.delayed(const Duration(milliseconds:1));var b=A.pid;if(C!=null){await C.writeln("[${zO}][${G}] == Exited with status ${M} ==");await C.flush();await C.close();}if(logHandler!=null){logHandler("[${zO}][${G}] == Exited with status ${M} ==");}var N=new HR(b,M,binary?V:O.toString(),binary?S:Q.toString(),binary?K:J.toString());if(resultHandler!=null){resultHandler(N);}if(D!=null){D.BYB(N);}return N;}finally {if(C!=null){await C.flush();await C.close();}}}String get zO{return new DateTime.now().toString();}class iKB extends dK{}class GP{}class jI implements Comparable<jI>{}abstract class LKB implements jI{String get nUB{var A=XC==null?'unknown source':XC;return '${A}:${line+1}:${column+1}';}int bq(jI A){if(XC!=A.XC){throw new ArgumentError("Source URLs \"${XC}\" and " "\"${A.XC}\" don't match.");}return (offset-A.offset).abs();}iD RG()=>new iD(this,this,"");int compareTo(jI A){if(XC!=A.XC){throw new ArgumentError("Source URLs \"${XC}\" and " "\"${A.XC}\" don't match.");}return offset-A.offset;}bool operator==(A)=>A is jI&&XC==A.XC&&offset==A.offset;int get hashCode=>XC.hashCode+offset;String toString()=>'<${runtimeType}: ${offset} ${nUB}>';}bool IR=false;hB fIB=hB.r1;hB p1=hB.Cm;class cC{final String name;String get L8=>(parent==null||parent.name=='')?name:'${parent.L8}.${name}';final cC parent;hB UjB;final Map<String,cC> VjB;final Map<String,cC> Z;StreamController<CN> WjB;factory cC(String A){return gIB.putIfAbsent(A,()=>new cC.fWB(A));}factory cC.fWB(String A){if(A.startsWith('.')){throw new ArgumentError("name shouldn't start with a '.'");}int B=A.lastIndexOf('.');cC C;String D;if(B==-1){if(A!='')C=new cC('');D=A;}else{C=new cC(A.substring(0,B));D=A.substring(B+1);}return new cC.gWB(D,C,new Map<String,cC>());}cC.gWB(this.name,this.parent,Map<String,cC> A):this.VjB=A,this.Z=new UnmodifiableMapView(A){if(parent!=null)parent.VjB[name]=this;}hB get level{if(IR){if(UjB!=null)return UjB;if(parent!=null)return parent.level;}return p1;}set level(hB A){if(IR&&parent!=null){UjB=A;}else{if(parent!=null){throw new UnsupportedError('Please set "hierarchicalLoggingEnabled" to true if you want to ' 'change the level on a non-root logger.');}p1=A;}}Stream<CN> get Tg=>XjB();void Kq(){if(IR||parent==null){if(WjB!=null){WjB.close();WjB=null;}}else{zl.Kq();}}bool xY(hB A)=>(A>=level);void tP(hB B,A,[Object I,StackTrace G,Zone H]){Object J;if(xY(B)){if(A is Function){A=A();}String C;if(A is String){C=A;}else{C=A.toString();J=A;}if(G==null&&B>=fIB){G=StackTrace.current;I??= 'autogenerated stack trace for ${B} ${C}';}if(H==null)H=Zone.current;var K=new CN(B,C,L8,I,G,H,J);if(IR){var D=this;while(D!=null){D.YjB(K);D=D.parent;}}else{zl.YjB(K);}}}void kC(A,[Object B,StackTrace C])=>tP(hB.tW,A,B,C);void oE(A,[Object B,StackTrace C])=>tP(hB.Am,A,B,C);void mB(A,[Object B,StackTrace C])=>tP(hB.Bm,A,B,C);void xI(A,[Object B,StackTrace C])=>tP(hB.s1,A,B,C);void jB(A,[Object B,StackTrace C])=>tP(hB.Cm,A,B,C);void QB(A,[Object B,StackTrace C])=>tP(hB.t1,A,B,C);void BC(A,[Object B,StackTrace C])=>tP(hB.u1,A,B,C);Stream<CN> XjB(){if(IR||parent==null){if(WjB==null){WjB=new StreamController<CN>.broadcast(sync:true);}return WjB.stream;}else{return zl.XjB();}}void YjB(CN A){if(WjB!=null){WjB.add(A);}}static final cC zl=new cC('');static final Map<String,cC> gIB=<String,cC>{};}class hB implements Comparable<hB>{final String name;final int value;const hB(this.name,this.value);static const hB q1=const hB('ALL',0);static const hB r1=const hB('OFF',2000);static const hB tW=const hB('FINEST',300);static const hB Am=const hB('FINER',400);static const hB Bm=const hB('FINE',500);static const hB s1=const hB('CONFIG',700);static const hB Cm=const hB('INFO',800);static const hB t1=const hB('WARNING',900);static const hB u1=const hB('SEVERE',1000);static const hB hIB=const hB('SHOUT',1200);static const List<hB> Dm=const[q1,tW,Am,Bm,s1,Cm,t1,u1,hIB,r1];bool operator==(Object A)=>A is hB&&value==A.value;bool operator<(hB A)=>value<A.value;bool operator<=(hB A)=>value<=A.value;bool operator>(hB A)=>value>A.value;bool operator>=(hB A)=>value>=A.value;int compareTo(hB A)=>value-A.value;int get hashCode=>value;String toString()=>name;}class CN{final hB level;final String message;final Object BTB;final String er;final DateTime m_;final int U_;static int iIB=0;final Object error;final StackTrace stackTrace;final Zone zone;CN(this.level,this.message,this.er,[this.error,this.stackTrace,this.zone,this.BTB]):m_=new DateTime.now(),U_=CN.iIB++ ;String toString()=>'[${level.name}] ${er}: ${message}';}var BP=new cC('mailer');class Em implements Exception{String message;Em(this.message);String toString()=>message;}class HC extends Em{HC(String A):super("Address invalid: ${A}");}class w1 extends Em{w1():super("Not a mailbox address");}class eJ{String ZjB;int ajB;bool get Ur=>(lP==null);String AM;String AV;String domain;List<String> KO;List<eJ> lP;eJ(String A){if(A==null){throw new HC("value is null");}if(A.isEmpty){throw new HC("value is an empty string");}var C=A.length;var B=bjB(A,0,C);if(B==C){throw new HC("value is a blank string");}B=cjB(A,B,C);B=bjB(A,B,C);if(B!=C){throw new HC("unexpected text after address");}}eJ.hWB(String A,int B,int C){ajB=cjB(A,B,C);if(!this.Ur){throw new HC("nested groups are not permitted");}}int cjB(String C,int I,int B){AM=null;AV=null;domain=null;KO=null;lP=null;var A=I;var D=new List<String>();var G=null;while(A<B){A=djB(C,A,B);var H=ZjB;if(H!=null){D.add(H);}else{if(G!=null&&G==A){if(A<B){throw new HC("invalid address: unexpected character \"${C.substring(A,A+1)}\"");}else{throw new HC("invalid address");}}}G=A;A=bjB(C,A,B);if(B<=A){throw new HC("incomplete address");}switch (C.substring(A,A+1)){case ".":case "@":if(D.length!=1){throw new HC("simple address is invalid");}return ejB(C,A,B,D);case "<":return fjB(C,A,B,D);case ":":return gjB(C,A,B,D);default:break;}}throw new HC("incomplete address");}int ejB(String C,int G,int B,List<String> D){assert(G<B);assert(D.length==1);var A=G;do{switch (C.substring(A,A+1)){case ".":A=djB(C,A+1,B);var H=ZjB;if(H==null){throw new HC("local-part has unexpected final full-stop");}D.add(H);break;case "@":AV=D.join(".");A=hjB(C,A+1,B);return A;default:throw new HC("unexpected character in local-part");}}while(A<B);throw new HC("incomplete address");}int fjB(String B,int D,int C,List<String> G){assert(D<C);assert(B.substring(D,D+1)=="<");if(1<=G.length){AM=G.join(" ");}else{AM=null;}var A=D+1;A=bjB(B,A,C);if(C<=A){throw new HC("incomplete route-addr address");}if(B.substring(A,A+1)=="@"||B.substring(A,A+1)==","){A=ijB(B,A,C);}else{KO=null;}A=djB(B,A,C);var H=ZjB;if(H==null){throw new HC("addr-spec does not start with a word");}A=ejB(B,A,C,[H]);A=bjB(B,A,C);if(C<=A){throw new HC("incomplete route-addr address");}if(B.substring(A,A+1)!=">"){throw new HC("route-addr address missing \">\"");}A++ ;return A;}int gjB(String D,int G,int C,List<String> H){assert(G<C);assert(D.substring(G,G+1)==":");if(H.isEmpty){throw new HC("group missing display-name");}AM=H.join(" ");var A=G+1;lP=new List<eJ>();var B=null;do{if(A<C){var I=D.substring(A,A+1);if(I==";"){if(B!=null&&B){throw new HC("group has unexpected final comma");}return A+1;}else if(I==","){if(lP.isEmpty){throw new HC("group has unexpected initial comma");}if(B!=null&&B){throw new HC("group has unexpected extra comma");}A++ ;B=true;}else{if(B!=null&&!B){throw new HC("group is missing comma");}var J=new eJ.hWB(D,A,C);lP.add(J);A=J.ajB;B=false;}A=bjB(D,A,C);}}while(A<C);throw new HC("group is incomplete");}int ijB(String C,int B,int D){assert(C!=null);assert(B<D);assert(C.substring(B,B+1)=="@"||C.substring(B,B+1)==",");var A=B;KO=new List<String>();var G=true;while(B<D){switch (C.substring(A,A+1)){case "@":if(!G){throw new HC("route missing a comma");}try {A=hjB(C,A+1,D);KO.add(domain);domain=null;G=false;}on HC {throw new HC("route has bad domain");}break;case ",":A++ ;G=true;break;case ":":if(KO.isEmpty){throw new HC("route must have at least one domain");}return A+1;}A=bjB(C,A,D);}throw new HC("route is missing terminating colon");}int hjB(String C,int G,int B){assert(G<=B);var A=G;domain="";while(A<B){A=bjB(C,A,B);int D;if(C.substring(A,A+1)!="["){D=jjB(C,A,B);}else{D=kjB(C,A,B);}if(ZjB==null){if(domain.isEmpty){throw new HC("domain has unexpected initial full-stop");}else{throw new HC("domain has unexpected extra full-stop");}}domain+= ZjB;A=D;A=bjB(C,A,B);if(B<=A){return A;}if(C.substring(A,A+1)!="."){return A;}domain+= ".";A++ ;}if(domain.isEmpty){throw new HC("domain is missing");}else{throw new HC("domain has unexpected final full-stop");}}int kjB(String B,int D,int G){if(B.substring(D,D+1)!="["){throw new HC("domain-literal does not start with \"[\"");}var A=D+1;while(A<G){var C=B.codeUnitAt(A);if(C=="\\".codeUnitAt(0)){A++ ;if(G<A){throw new HC("domain-literal not terminated");}ZjB+= B.substring(A,A+1);A++ ;}else if(33<=C&&C<=126&&"\\[]\n".indexOf(new String.fromCharCode(C))<0){ZjB+= B.substring(A,A+1);A++ ;}else if(C!="]".codeUnitAt(0)){ZjB=B.substring(D,A);return A;}else{throw new HC("domain-literal not terminated with \"]\"");}}throw new HC("domain-literal not terminated with \"]\"");}int ljB(String B,int C,int G){assert(C<G);assert(B.substring(C,C+1)=="(");var D=0;ZjB="";var A=C;while(A<G){switch (B.substring(A,A+1)){case "(":D++ ;break;case ")":D-- ;if(D==0){return A+1;}break;case "\\":if(B.length<A){throw new HC("Unterminated comment");}ZjB+= B.substring(A+1,A+2);A++ ;break;default:ZjB+= B.substring(A,A+1);break;}A++ ;}throw new HC("Unterminated comment");}int djB(String C,int D,int B){assert(D<B);var A=bjB(C,D,B);if(A<B){if(C.substring(A,A+1)!="\""){return jjB(C,A,B);}else{return mjB(C,A,B);}}else{ZjB=null;return A;}}int jjB(String A,int D,int B){var C=bjB(A,D,B);C=njB(A,C,B);return bjB(A,C,B);}int njB(String C,int B,int D){var A=B;while(A<D){if(!Fm(C,A)){break;}A++ ;}if(B<A){ZjB=C.substring(B,A);}else{ZjB=null;}return A;}int mjB(String B,int C,int D){assert(C<D);assert(B.substring(C,C+1)=='"');ZjB="";var A=C+1;while(A<D){switch (B.substring(A,A+1)){case "\"":return bjB(B,A+1,D);case "\\":if(B.length<A){throw new HC("Incomplete escape in quoted string");}ZjB+= B.substring(A+1,A+2);A++ ;break;default:ZjB+= B.substring(A,A+1);break;}A++ ;}throw new HC("Unterminated quoted string");}int bjB(String C,int G,int D){var A=G;while(A<D){var B=C.substring(A,A+1);if(B==" "||B=="\t"){A++ ;}else if(B=="("){A=ljB(C,A,D);}else{break;}}return A;}static bool Fm(String B,int C){var A=B.codeUnitAt(C);if("a".codeUnitAt(0)<=A&&A<="z".codeUnitAt(0)||"A".codeUnitAt(0)<=A&&A<="Z".codeUnitAt(0)||"0".codeUnitAt(0)<=A&&A<="9".codeUnitAt(0)||"!#\$%&'*+-/=?^_`{|}~".indexOf(new String.fromCharCode(A))>=0||127<A){return true;}else{return false;}}String eUB(){if(!Ur){throw new w1();}var A=x1(AV);A+= "@";A+= x1(domain);return A;}String toString(){if(Ur){assert(lP==null);assert(AV!=null&&AV.isNotEmpty);assert(domain!=null&&domain.isNotEmpty);var B=eUB();if(KO!=null){var C="";for(var G in KO){C=C+"@"+G;}B="${C}:${B}";}if(AM==null&&KO==null){return B;}else{return "${y1(AM)} <${B}>";}}else{assert(lP!=null);assert(AV==null);assert(domain==null);assert(KO==null);var A;if(AM==null){throw new HC("Group cannot have no display-name");}else{A="${AM}:";}var D=true;for(var H in lP){if(D){D=false;}else{A+= ",";}A+= H.toString();}A+= ";";return A;}}static String x1(String A){return A.split(".").map((B)=>y1(B)).join(".");}static String y1(String A){var G=false;if(A.length==0){G=true;}else if(A.substring(0,1)==" "||A.substring(0,1)=="\t"){G=true;}else if(A.substring(A.length-1,A.length)==" "||A.substring(A.length-1,A.length)=="\t"){G=true;}var H=false;for(int B=0;B<A.length;B++ ){var C=A.substring(B,B+1);var I=C==' '||C=="\t";if(!Fm(A,B)&&!I){G=true;break;}if(I){if(H){G=true;break;}H=true;}else{H=false;}}var D;if(!G){D=A;}else{D='"';for(int B=0;B<A.length;B++ ){if(Fm(A,B)){D+= A.substring(B,B+1);}else{var C=A.substring(B,B+1);if(C=='"'||C=="\\"||C=="\r"){D+= "\\${C}";}else{D+= A.substring(B,B+1);}}}D+= '"';}return D;}static String gT(String A){return new eJ(A).toString();}}class lIB{}class AP{List<String> AQ=[] ;List<String> Fq=[] ;List<String> Bq=[] ;List<lIB> fPB=[] ;String nY='anonymous@${Platform.localHostname}';String vJ;String subject;String text;String tY;String xRB='mailer';Encoding encoding=UTF8;bool ojB=false;int pjB=0;Future<String> aRB(){return new Future((){var A=new StringBuffer();if(subject!=null)A.write('Subject: ${pIB(subject)}\r\n');if(nY!=null){var C=eJ.gT(nY);if(vJ!=null){C='${vJ} <${C}>';}A.write('From: ${C}\r\n');}if(AQ!=null&&!AQ.isEmpty){var H=AQ.map(eJ.gT).join(',');A.write('To: ${H}\r\n');}if(Fq!=null&&!Fq.isEmpty){var I=Fq.map(eJ.gT).join(',');A.write('Cc: ${I}\r\n');}if(Bq!=null&&!Bq.isEmpty){var J=Bq.map(eJ.gT).join(',');A.write('Bcc: ${J}\r\n');}A.write('Date: '+new eT('EEE, dd MMM yyyy HH:mm:ss +0000').kP(new DateTime.now().toUtc())+'\r\n');A.write('X-Mailer: Dart Mailer library\r\n');A.write('Mime-Version: 1.0\r\n');var B='${xRB}-?=_${ ++pjB}-${new DateTime.now().millisecondsSinceEpoch}';var K=tY!=null&&text!=null?'alternative':'mixed';A.write('Content-Type: multipart/${K}; '+'boundary="${B}"\r\n\r\n');if(text!=null){A.write('--${B}\r\n');A.write('Content-Type: text/plain; charset="${encoding.name}"\r\n');A.write('Content-Transfer-Encoding: 7bit\r\n\r\n');A.write('${text}\r\n\r\n');}if(tY!=null){A.write('--${B}\r\n');A.write('Content-Type: text/html; charset="${encoding.name}"\r\n');A.write('Content-Transfer-Encoding: 7bit\r\n\r\n');A.write('${tY}\r\n\r\n');}return Future.forEach(fPB,(D){var G=hG(D.file.path);return D.file.readAsBytes().then((M){var N=oIB(BASE64.encode(M));A.write('--${B}\r\n');A.write('Content-Type: ${nIB(D.file.path)}; name="${G}"\r\n');A.write('Content-Transfer-Encoding: base64\r\n');A.write('Content-Disposition: attachment; filename="${G}"\r\n\r\n');A.write('${N}\r\n\r\n');});}).then((O){A.write('--${B}--\r\n\r\n.');return A.toString();});});}}String nIB(String B){final A=CJB(B);return A!=null?A:'application/octet-stream';}class mIB extends uW{final String vU='smtp.gmail.com';final int port=465;final bool R_=true;}typedef void kIB(String _0);class v1{uW lB;kIB qjB;bool rjB=false;Socket sjB;bool tjB=false;List<String> GQ=[] ;Stream g9;StreamController ujB=new StreamController();Stream<AP> j9;StreamController vjB=new StreamController();List<int> wjB=[] ;AP xjB;v1(this.lB){g9=ujB.stream.asBroadcastStream();j9=vjB.stream.asBroadcastStream();}Future yjB({secured: false}){return new Future((){if(secured||lB.R_)return SecureSocket.connect(lB.vU,lB.port,onBadCertificate:(A)=>lB.o8);return Socket.connect(lB.vU,lB.port);}).then((B){BP.oE("Connecting to ${lB.vU} at port ${lB.port}.");tjB=true;sjB=B;sjB.listen(zjB,onError:vjB.addError);sjB.done.then((A)=>tjB=false).catchError(vjB.addError);});}Future send(AP B){return new Future((){if(B.ojB){throw 'You cannot send an envelope that has already been sent! Make sure you are not reusing an existing envelope, but instead creating new envelopes.';}B.ojB=true;g9.listen((H){qjB=AkB;zJ('MAIL FROM:<${eJ.gT(xjB.nY)}>');});xjB=B;qjB=BkB;return yjB().then((H){var A=new Completer();var D=new Timer(const Duration(seconds:60),(){CkB();A.completeError('Timed out sending an email.');});j9.listen((AP G){if(G==B){D.cancel();A.complete(G);}},onError:(C){CkB();D.cancel();if(!A.isCompleted){A.completeError('Failed to send an email: ${C}');BP.kC('Failed to send email',C);}else{BP.kC('Failed after sending email',C);}},cancelOnError:true);return A.future;});});}void zJ(String A){BP.mB('> ${A}');sjB.write('${A}\r\n');}void CkB(){sjB.close();}void zjB(List<int> A){if(rjB||A==null||A.length==0)return;wjB.addAll(A);if(wjB.last!=0x0A)return;var B=new String.fromCharCodes(wjB);if(new RegExp(r'(?:^|\n)\d{3}-[^\n]+\n$').hasMatch(B))return;wjB.clear();BP.mB(B);if(qjB!=null){try {qjB(B);}catch (C){vjB.addError(C);}}}void DkB(A){SecureSocket.secure(sjB,onBadCertificate:(B)=>lB.o8).then((SecureSocket C){sjB=C;sjB.listen(zjB,onError:vjB.addError);sjB.done.then((B)=>tjB=false).catchError(vjB.addError);A();});}void BkB(String A){if(A.startsWith('220')==false){BP.BC('Invalid greeting from server: ${A}');return;}qjB=EkB;zJ('EHLO ${lB.name}');}void EkB(String A){if(A.startsWith('2')==false){qjB=FkB;zJ('HELO ${lB.name}');return;}if(sjB is!SecureSocket&&new RegExp('[ \\-]STARTTLS\\r?\$',caseSensitive:false,multiLine:true).hasMatch(A)){zJ('STARTTLS');qjB=GkB;return;}if(new RegExp('AUTH(?:\\s+[^\\n]*\\s+|\\s+)PLAIN',caseSensitive:false).hasMatch(A))GQ.add('PLAIN');if(new RegExp('AUTH(?:\\s+[^\\n]*\\s+|\\s+)LOGIN',caseSensitive:false).hasMatch(A))GQ.add('LOGIN');if(new RegExp('AUTH(?:\\s+[^\\n]*\\s+|\\s+)CRAM-MD5',caseSensitive:false).hasMatch(A))GQ.add('CRAM-MD5');if(new RegExp('AUTH(?:\\s+[^\\n]*\\s+|\\s+)XOAUTH',caseSensitive:false).hasMatch(A))GQ.add('XOAUTH');if(new RegExp('AUTH(?:\\s+[^\\n]*\\s+|\\s+)XOAUTH2',caseSensitive:false).hasMatch(A))GQ.add('XOAUTH2');HkB();}void FkB(String A){if(A.startsWith('2')==false){BP.BC('Invalid response for EHLO/HELO: ${A}');return;}GQ.add('LOGIN');HkB();}void GkB(String A){if(A.startsWith('2')==false){qjB=FkB;zJ('HELO ${lB.name}');return;}DkB((){qjB=EkB;zJ('EHLO ${lB.name}');});}void HkB(){if(lB.username==null){qjB=IkB;ujB.add(true);return;}if(!GQ.contains('LOGIN')){throw 'The server does not support LOGIN authentication method. Available authentication methods are: ${GQ}';}qjB=JkB;zJ('AUTH LOGIN');}void JkB(String A){if(A.startsWith('334 VXNlcm5hbWU6')==false){throw 'Invalid logic sequence while waiting for "334 VXNlcm5hbWU6": ${A}';}qjB=KkB;zJ(BASE64.encode(lB.username.codeUnits));}void KkB(String A){if(A.startsWith('334 UGFzc3dvcmQ6')==false){throw 'Invalid logic sequence while waiting for "334 UGFzc3dvcmQ6": ${A}';}qjB=LkB;zJ(BASE64.encode(lB.password.codeUnits));}void LkB(String A){if(A.startsWith('2')==false)throw 'Invalid login: ${A}';qjB=IkB;ujB.add(true);}var MkB=0;void AkB(String B){if(B.startsWith('2')==false)throw 'Mail from command failed: ${B}';var A;if(MkB==xjB.AQ.length-1){MkB=0;qjB=NkB;A=xjB.AQ[MkB];}else{qjB=AkB;A=xjB.AQ[ ++MkB];}zJ('RCPT TO:<${eJ.gT(A)}>');}void NkB(String A){if(A.startsWith('2')==false){BP.BC('Recipient failure: ${A}');return;}qjB=OkB;zJ('DATA');}void OkB(String A){if(A.startsWith('2')==false&&A.startsWith('3')==false)throw 'Data command failed: ${A}';qjB=PkB;xjB.aRB().then(zJ);}PkB(String A){if(A.startsWith('2')==false)throw 'Could not send email: ${A}';qjB=IkB;vjB.add(xjB);xjB=null;CkB();}void IkB(String A){if(int.parse(A.substring(0,1))>3)throw 'Error: ${A}';throw 'We should never get here -- bug? Message: ${A}';}}class uW{String name=Platform.localHostname;String vU;int port=465;bool IUB=false;bool o8=true;bool R_=false;String username;String password;}class fc extends jIB{uW lB;fc(this.lB);Future send(AP A){return new Future((){return new v1(lB).send(A);});}}abstract class jIB{Future send(AP A);}final zHB=new RegExp(r'["\x00-\x1F\x7F]');class OH{final String type;final String zg;final Map<String,String> parameters;String get mimeType=>"${type}/${zg}";factory OH.bWB(String C){return W1("media type",C,(){var A=new dK(C);A.ZB(nF);A.LG(yM);var G=A.DF[0];A.LG('/');A.LG(yM);var H=A.DF[0];A.ZB(nF);var D=<String,String>{};while(A.ZB(';')){A.ZB(nF);A.LG(yM);var I=A.DF[0];A.LG('=');var B;if(A.ZB(yM)){B=A.DF[0];}else{B=wl(A);}A.ZB(nF);D[I]=B;}A.z7();return new OH(G,H,D);});}OH(String B,String C,[Map<String,String> A]):type=B.toLowerCase(),zg=C.toLowerCase(),parameters=new UnmodifiableMapView(A==null?{}:new vl.aWB(A));OH wI({String type,String subtype,String mimeType,Map<String,String> parameters,bool clearParameters: false}){if(mimeType!=null){if(type!=null){throw new ArgumentError("You may not pass both [type] and [mimeType].");}else if(subtype!=null){throw new ArgumentError("You may not pass both [subtype] and " "[mimeType].");}var A=mimeType.split('/');if(A.length!=2){throw new FormatException('Invalid mime type "${mimeType}".');}type=A[0];subtype=A[1];}if(type==null)type=this.type;if(subtype==null)subtype=this.zg;if(parameters==null)parameters={};if(!clearParameters){var B=parameters;parameters=new Map.from(this.parameters);parameters.addAll(B);}return new OH(type,subtype,parameters);}String toString(){var A=new StringBuffer()..write(type)..write("/")..write(zg);parameters.forEach((C,B){A.write("; ${C}=");if(DIB.hasMatch(B)){A..write('"')..write(B.replaceAllMapped(zHB,(D)=>"\\"+D[0]))..write('"');}else{A.write(B);}});return A.toString();}}const qIB=const[40,41,60,62,64,44,59,58,92,34,47,91,93,63,61,123,125,32,9];bool rIB(int A){return A>31&&A<128&&qIB.indexOf(A)==-1;}int Gm(int A){const B=gD.wIB-gD.L2;return (gD.L2<=A&&A<=gD.vIB)?A+B:A;}void vW(int A,int B){if(A!=B){throw new xW("Failed to parse multipart mime 1");}}void z1(int A){if(A!=gD.Qm&&A!=gD.Pm){throw new xW("Failed to parse multipart mime 2");}}class A2 extends DN{final Map<String,String> headers;final Stream<List<int>> QkB;A2(this.headers,this.QkB);StreamSubscription<List<int>> listen(void A(List<int> data),{void onDone(),Function onError,bool cancelOnError}){return QkB.listen(A,onDone:onDone,onError:onError,cancelOnError:cancelOnError);}}class B2{static const int C2=0;static const int Hm=1;static const int D2=2;static const int E2=3;static const int Im=4;static const int Jm=5;static const int F2=6;static const int Km=7;static const int G2=8;static const int Lm=9;static const int gc=10;static const int H2=11;static const int I2=12;static const int J2=13;static const int Mm=14;static const int sIB=15;final List<int> RkB;final List<int> SkB=[] ;final List<int> TkB=[] ;static const int tIB=0;static const int Nm=1;static const int Om=2;static const int K2=3;int UkB=tIB;StreamController<DN> VkB;Stream<DN> get stream=>VkB.stream;StreamSubscription WkB;StreamController<List<int>> XkB;Map<String,String> YkB;int ZkB=C2;int akB=2;int bkB;List<int> ckB;B2(this.RkB,Stream<List<int>> A){VkB=new StreamController(sync:true,onPause:dkB,onResume:ekB,onCancel:(){UkB=K2;fkB();},onListen:(){UkB=Nm;WkB=A.listen((B){assert(ckB==null);WkB.pause();ckB=B;bkB=0;gkB();},onDone:(){if(ZkB!=Mm){VkB.addError(new xW("Bad multipart ending"));}VkB.close();},onError:VkB.addError);});}void ekB(){assert(UkB==Om);UkB=Nm;fkB();}void dkB(){UkB=Om;fkB();}void fkB(){if(XkB==null){switch (UkB){case Nm:if(WkB.isPaused)WkB.resume();break;case Om:if(!WkB.isPaused)WkB.pause();break;case K2:WkB.cancel();break;default:throw new StateError("This code should never be reached.");}}}void gkB(){int C=0;int B;void G(){if(B<0){var D=C+bkB-akB;if(D<=C){XkB.add(RkB.sublist(0,D));}else{XkB.add(RkB.sublist(0,C));XkB.add(ckB.sublist(0,D-C));}}else{var H=bkB-akB;XkB.add(ckB.sublist(B,H));}}if(ZkB==gc&&akB==0){B=0;}else{B=null;}C=akB;while((bkB<ckB.length)&&ZkB!=sIB&&ZkB!=Mm){int A;if(bkB<0){A=RkB[C+bkB];}else{A=ckB[bkB];}switch (ZkB){case C2:if(A==RkB[akB]){akB++ ;if(akB==RkB.length){ZkB=Hm;akB=0;}}else{bkB=bkB-akB;akB=0;}break;case Hm:if(A==gD.JR){ZkB=D2;}else if(A==gD.hc){ZkB=H2;}else{z1(A);}break;case D2:vW(A,gD.wW);if(XkB!=null){XkB.close();XkB=null;fkB();}ZkB=E2;break;case E2:YkB=new Map<String,String>();if(A==gD.JR){ZkB=Lm;}else{SkB.add(Gm(A));ZkB=Im;}break;case Im:if(A==gD.uIB){ZkB=Jm;}else{if(!rIB(A)){throw new xW("Invalid header field name");}SkB.add(Gm(A));}break;case Jm:if(A==gD.JR){ZkB=Km;}else if(A!=gD.Qm&&A!=gD.Pm){TkB.add(A);ZkB=F2;}break;case F2:if(A==gD.JR){ZkB=Km;}else{TkB.add(A);}break;case Km:vW(A,gD.wW);ZkB=G2;break;case G2:if(A==gD.Qm||A==gD.Pm){ZkB=Jm;}else{String I=UTF8.decode(SkB);String J=UTF8.decode(TkB);YkB[I.toLowerCase()]=J;SkB.clear();TkB.clear();if(A==gD.JR){ZkB=Lm;}else{SkB.add(Gm(A));ZkB=Im;}}break;case Lm:vW(A,gD.wW);XkB=new StreamController(sync:true,onListen:(){if(WkB.isPaused)WkB.resume();},onPause:WkB.pause,onResume:WkB.resume);VkB.add(new A2(YkB,XkB.stream));YkB=null;ZkB=gc;B=bkB+1;break;case gc:if(A==RkB[akB]){akB++ ;if(akB==RkB.length){if(B!=null){bkB++ ;G();bkB-- ;}XkB.close();XkB=null;fkB();akB=0;ZkB=Hm;}}else{bkB=bkB-akB;if(B==null)B=bkB;akB=0;}break;case H2:vW(A,gD.hc);ZkB=I2;break;case I2:if(A==gD.JR){ZkB=J2;}else{z1(A);}break;case J2:vW(A,gD.wW);if(XkB!=null){XkB.close();XkB=null;fkB();}ZkB=Mm;break;default:assert(false);break;}bkB++ ;}if(ZkB==gc&&B!=null){G();}if(bkB==ckB.length){ckB=null;bkB=null;WkB.resume();}}}class gD{static const int Pm=9;static const int wW=10;static const int JR=13;static const int Qm=32;static const int hc=45;static const int uIB=58;static const int L2=65;static const int vIB=90;static const int wIB=97;}final Map<String,String> xIB=<String,String>{'123':'application/vnd.lotus-1-2-3','3dml':'text/vnd.in3d.3dml','3ds':'image/x-3ds','3g2':'video/3gpp2','3gp':'video/3gpp','7z':'application/x-7z-compressed','aab':'application/x-authorware-bin','aac':'audio/x-aac','aam':'application/x-authorware-map','aas':'application/x-authorware-seg','abw':'application/x-abiword','ac':'application/pkix-attr-cert','acc':'application/vnd.americandynamics.acc','ace':'application/x-ace-compressed','acu':'application/vnd.acucobol','acutc':'application/vnd.acucorp','adp':'audio/adpcm','aep':'application/vnd.audiograph','afm':'application/x-font-type1','afp':'application/vnd.ibm.modcap','ahead':'application/vnd.ahead.space','ai':'application/postscript','aif':'audio/x-aiff','aifc':'audio/x-aiff','aiff':'audio/x-aiff','air':'application/vnd.adobe.air-application-installer-package+zip','ait':'application/vnd.dvb.ait','ami':'application/vnd.amiga.ami','apk':'application/vnd.android.package-archive','appcache':'text/cache-manifest','application':'application/x-ms-application','apr':'application/vnd.lotus-approach','arc':'application/x-freearc','asc':'application/pgp-signature','asf':'video/x-ms-asf','asm':'text/x-asm','aso':'application/vnd.accpac.simply.aso','asx':'video/x-ms-asf','atc':'application/vnd.acucorp','atom':'application/atom+xml','atomcat':'application/atomcat+xml','atomsvc':'application/atomsvc+xml','atx':'application/vnd.antix.game-component','au':'audio/basic','avi':'video/x-msvideo','aw':'application/applixware','azf':'application/vnd.airzip.filesecure.azf','azs':'application/vnd.airzip.filesecure.azs','azw':'application/vnd.amazon.ebook','bat':'application/x-msdownload','bcpio':'application/x-bcpio','bdf':'application/x-font-bdf','bdm':'application/vnd.syncml.dm+wbxml','bed':'application/vnd.realvnc.bed','bh2':'application/vnd.fujitsu.oasysprs','bin':'application/octet-stream','blb':'application/x-blorb','blorb':'application/x-blorb','bmi':'application/vnd.bmi','bmp':'image/bmp','book':'application/vnd.framemaker','box':'application/vnd.previewsystems.box','boz':'application/x-bzip2','bpk':'application/octet-stream','btif':'image/prs.btif','bz':'application/x-bzip','bz2':'application/x-bzip2','c':'text/x-c','c11amc':'application/vnd.cluetrust.cartomobile-config','c11amz':'application/vnd.cluetrust.cartomobile-config-pkg','c4d':'application/vnd.clonk.c4group','c4f':'application/vnd.clonk.c4group','c4g':'application/vnd.clonk.c4group','c4p':'application/vnd.clonk.c4group','c4u':'application/vnd.clonk.c4group','cab':'application/vnd.ms-cab-compressed','caf':'audio/x-caf','cap':'application/vnd.tcpdump.pcap','car':'application/vnd.curl.car','cat':'application/vnd.ms-pki.seccat','cb7':'application/x-cbr','cba':'application/x-cbr','cbr':'application/x-cbr','cbt':'application/x-cbr','cbz':'application/x-cbr','cc':'text/x-c','cct':'application/x-director','ccxml':'application/ccxml+xml','cdbcmsg':'application/vnd.contact.cmsg','cdf':'application/x-netcdf','cdkey':'application/vnd.mediastation.cdkey','cdmia':'application/cdmi-capability','cdmic':'application/cdmi-container','cdmid':'application/cdmi-domain','cdmio':'application/cdmi-object','cdmiq':'application/cdmi-queue','cdx':'chemical/x-cdx','cdxml':'application/vnd.chemdraw+xml','cdy':'application/vnd.cinderella','cer':'application/pkix-cert','cfs':'application/x-cfs-compressed','cgm':'image/cgm','chat':'application/x-chat','chm':'application/vnd.ms-htmlhelp','chrt':'application/vnd.kde.kchart','cif':'chemical/x-cif','cii':'application/vnd.anser-web-certificate-issue-initiation','cil':'application/vnd.ms-artgalry','cla':'application/vnd.claymore','class':'application/java-vm','clkk':'application/vnd.crick.clicker.keyboard','clkp':'application/vnd.crick.clicker.palette','clkt':'application/vnd.crick.clicker.template','clkw':'application/vnd.crick.clicker.wordbank','clkx':'application/vnd.crick.clicker','clp':'application/x-msclip','cmc':'application/vnd.cosmocaller','cmdf':'chemical/x-cmdf','cml':'chemical/x-cml','cmp':'application/vnd.yellowriver-custom-menu','cmx':'image/x-cmx','cod':'application/vnd.rim.cod','com':'application/x-msdownload','conf':'text/plain','cpio':'application/x-cpio','cpp':'text/x-c','cpt':'application/mac-compactpro','crd':'application/x-mscardfile','crl':'application/pkix-crl','crt':'application/x-x509-ca-cert','cryptonote':'application/vnd.rig.cryptonote','csh':'application/x-csh','csml':'chemical/x-csml','csp':'application/vnd.commonspace','css':'text/css','cst':'application/x-director','csv':'text/csv','cu':'application/cu-seeme','curl':'text/vnd.curl','cww':'application/prs.cww','cxt':'application/x-director','cxx':'text/x-c','dae':'model/vnd.collada+xml','daf':'application/vnd.mobius.daf','dart':'application/dart','dataless':'application/vnd.fdsn.seed','davmount':'application/davmount+xml','dbk':'application/docbook+xml','dcr':'application/x-director','dcurl':'text/vnd.curl.dcurl','dd2':'application/vnd.oma.dd2+xml','ddd':'application/vnd.fujixerox.ddd','deb':'application/x-debian-package','def':'text/plain','deploy':'application/octet-stream','der':'application/x-x509-ca-cert','dfac':'application/vnd.dreamfactory','dgc':'application/x-dgc-compressed','dic':'text/x-c','dir':'application/x-director','dis':'application/vnd.mobius.dis','dist':'application/octet-stream','distz':'application/octet-stream','djv':'image/vnd.djvu','djvu':'image/vnd.djvu','dll':'application/x-msdownload','dmg':'application/x-apple-diskimage','dmp':'application/vnd.tcpdump.pcap','dms':'application/octet-stream','dna':'application/vnd.dna','doc':'application/msword','docm':'application/vnd.ms-word.document.macroenabled.12','docx':'application/vnd.openxmlformats-officedocument.wordprocessingml.document','dot':'application/msword','dotm':'application/vnd.ms-word.template.macroenabled.12','dotx':'application/vnd.openxmlformats-officedocument.wordprocessingml.template','dp':'application/vnd.osgi.dp','dpg':'application/vnd.dpgraph','dra':'audio/vnd.dra','dsc':'text/prs.lines.tag','dssc':'application/dssc+der','dtb':'application/x-dtbook+xml','dtd':'application/xml-dtd','dts':'audio/vnd.dts','dtshd':'audio/vnd.dts.hd','dump':'application/octet-stream','dvb':'video/vnd.dvb.file','dvi':'application/x-dvi','dwf':'model/vnd.dwf','dwg':'image/vnd.dwg','dxf':'image/vnd.dxf','dxp':'application/vnd.spotfire.dxp','dxr':'application/x-director','ecelp4800':'audio/vnd.nuera.ecelp4800','ecelp7470':'audio/vnd.nuera.ecelp7470','ecelp9600':'audio/vnd.nuera.ecelp9600','ecma':'application/ecmascript','edm':'application/vnd.novadigm.edm','edx':'application/vnd.novadigm.edx','efif':'application/vnd.picsel','ei6':'application/vnd.pg.osasli','elc':'application/octet-stream','emf':'application/x-msmetafile','eml':'message/rfc822','emma':'application/emma+xml','emz':'application/x-msmetafile','eol':'audio/vnd.digital-winds','eot':'application/vnd.ms-fontobject','eps':'application/postscript','epub':'application/epub+zip','es3':'application/vnd.eszigno3+xml','esa':'application/vnd.osgi.subsystem','esf':'application/vnd.epson.esf','et3':'application/vnd.eszigno3+xml','etx':'text/x-setext','eva':'application/x-eva','evy':'application/x-envoy','exe':'application/x-msdownload','exi':'application/exi','ext':'application/vnd.novadigm.ext','ez':'application/andrew-inset','ez2':'application/vnd.ezpix-album','ez3':'application/vnd.ezpix-package','f':'text/x-fortran','f4v':'video/x-f4v','f77':'text/x-fortran','f90':'text/x-fortran','fbs':'image/vnd.fastbidsheet','fcdt':'application/vnd.adobe.formscentral.fcdt','fcs':'application/vnd.isac.fcs','fdf':'application/vnd.fdf','fe_launch':'application/vnd.denovo.fcselayout-link','fg5':'application/vnd.fujitsu.oasysgp','fgd':'application/x-director','fh':'image/x-freehand','fh4':'image/x-freehand','fh5':'image/x-freehand','fh7':'image/x-freehand','fhc':'image/x-freehand','fig':'application/x-xfig','flac':'audio/x-flac','fli':'video/x-fli','flo':'application/vnd.micrografx.flo','flv':'video/x-flv','flw':'application/vnd.kde.kivio','flx':'text/vnd.fmi.flexstor','fly':'text/vnd.fly','fm':'application/vnd.framemaker','fnc':'application/vnd.frogans.fnc','for':'text/x-fortran','fpx':'image/vnd.fpx','frame':'application/vnd.framemaker','fsc':'application/vnd.fsc.weblaunch','fst':'image/vnd.fst','ftc':'application/vnd.fluxtime.clip','fti':'application/vnd.anser-web-funds-transfer-initiation','fvt':'video/vnd.fvt','fxp':'application/vnd.adobe.fxp','fxpl':'application/vnd.adobe.fxp','fzs':'application/vnd.fuzzysheet','g2w':'application/vnd.geoplan','g3':'image/g3fax','g3w':'application/vnd.geospace','gac':'application/vnd.groove-account','gam':'application/x-tads','gbr':'application/rpki-ghostbusters','gca':'application/x-gca-compressed','gdl':'model/vnd.gdl','geo':'application/vnd.dynageo','gex':'application/vnd.geometry-explorer','ggb':'application/vnd.geogebra.file','ggt':'application/vnd.geogebra.tool','ghf':'application/vnd.groove-help','gif':'image/gif','gim':'application/vnd.groove-identity-message','glb':'model/gltf-binary','gltf':'model/gltf+json','gml':'application/gml+xml','gmx':'application/vnd.gmx','gnumeric':'application/x-gnumeric','gph':'application/vnd.flographit','gpx':'application/gpx+xml','gqf':'application/vnd.grafeq','gqs':'application/vnd.grafeq','gram':'application/srgs','gramps':'application/x-gramps-xml','gre':'application/vnd.geometry-explorer','grv':'application/vnd.groove-injector','grxml':'application/srgs+xml','gsf':'application/x-font-ghostscript','gtar':'application/x-gtar','gtm':'application/vnd.groove-tool-message','gtw':'model/vnd.gtw','gv':'text/vnd.graphviz','gxf':'application/gxf','gxt':'application/vnd.geonext','h':'text/x-c','h261':'video/h261','h263':'video/h263','h264':'video/h264','hal':'application/vnd.hal+xml','hbci':'application/vnd.hbci','hdf':'application/x-hdf','hh':'text/x-c','hlp':'application/winhlp','hpgl':'application/vnd.hp-hpgl','hpid':'application/vnd.hp-hpid','hps':'application/vnd.hp-hps','hqx':'application/mac-binhex40','htke':'application/vnd.kenameaapp','htm':'text/html','html':'text/html','hvd':'application/vnd.yamaha.hv-dic','hvp':'application/vnd.yamaha.hv-voice','hvs':'application/vnd.yamaha.hv-script','i2g':'application/vnd.intergeo','icc':'application/vnd.iccprofile','ice':'x-conference/x-cooltalk','icm':'application/vnd.iccprofile','ico':'image/x-icon','ics':'text/calendar','ief':'image/ief','ifb':'text/calendar','ifm':'application/vnd.shana.informed.formdata','iges':'model/iges','igl':'application/vnd.igloader','igm':'application/vnd.insors.igm','igs':'model/iges','igx':'application/vnd.micrografx.igx','iif':'application/vnd.shana.informed.interchange','imp':'application/vnd.accpac.simply.imp','ims':'application/vnd.ms-ims','in':'text/plain','ink':'application/inkml+xml','inkml':'application/inkml+xml','install':'application/x-install-instructions','iota':'application/vnd.astraea-software.iota','ipfix':'application/ipfix','ipk':'application/vnd.shana.informed.package','irm':'application/vnd.ibm.rights-management','irp':'application/vnd.irepository.package+xml','iso':'application/x-iso9660-image','itp':'application/vnd.shana.informed.formtemplate','ivp':'application/vnd.immervision-ivp','ivu':'application/vnd.immervision-ivu','jad':'text/vnd.sun.j2me.app-descriptor','jam':'application/vnd.jam','jar':'application/java-archive','java':'text/x-java-source','jisp':'application/vnd.jisp','jlt':'application/vnd.hp-jlyt','jnlp':'application/x-java-jnlp-file','joda':'application/vnd.joost.joda-archive','jpe':'image/jpeg','jpeg':'image/jpeg','jpg':'image/jpeg','jpgm':'video/jpm','jpgv':'video/jpeg','jpm':'video/jpm','js':'application/javascript','json':'application/json','jsonml':'application/jsonml+json','kar':'audio/midi','karbon':'application/vnd.kde.karbon','kfo':'application/vnd.kde.kformula','kia':'application/vnd.kidspiration','kml':'application/vnd.google-earth.kml+xml','kmz':'application/vnd.google-earth.kmz','kne':'application/vnd.kinar','knp':'application/vnd.kinar','kon':'application/vnd.kde.kontour','kpr':'application/vnd.kde.kpresenter','kpt':'application/vnd.kde.kpresenter','kpxx':'application/vnd.ds-keypoint','ksp':'application/vnd.kde.kspread','ktr':'application/vnd.kahootz','ktx':'image/ktx','ktz':'application/vnd.kahootz','kwd':'application/vnd.kde.kword','kwt':'application/vnd.kde.kword','lasxml':'application/vnd.las.las+xml','latex':'application/x-latex','lbd':'application/vnd.llamagraphics.life-balance.desktop','lbe':'application/vnd.llamagraphics.life-balance.exchange+xml','les':'application/vnd.hhe.lesson-player','lha':'application/x-lzh-compressed','link66':'application/vnd.route66.link66+xml','list':'text/plain','list3820':'application/vnd.ibm.modcap','listafp':'application/vnd.ibm.modcap','lnk':'application/x-ms-shortcut','log':'text/plain','lostxml':'application/lost+xml','lrf':'application/octet-stream','lrm':'application/vnd.ms-lrm','ltf':'application/vnd.frogans.ltf','lvp':'audio/vnd.lucent.voice','lwp':'application/vnd.lotus-wordpro','lzh':'application/x-lzh-compressed','m13':'application/x-msmediaview','m14':'application/x-msmediaview','m1v':'video/mpeg','m21':'application/mp21','m2a':'audio/mpeg','m2v':'video/mpeg','m3a':'audio/mpeg','m3u':'audio/x-mpegurl','m3u8':'application/vnd.apple.mpegurl','m4u':'video/vnd.mpegurl','m4v':'video/x-m4v','ma':'application/mathematica','mads':'application/mads+xml','mag':'application/vnd.ecowin.chart','maker':'application/vnd.framemaker','man':'text/troff','mar':'application/octet-stream','mathml':'application/mathml+xml','mb':'application/mathematica','mbk':'application/vnd.mobius.mbk','mbox':'application/mbox','mc1':'application/vnd.medcalcdata','mcd':'application/vnd.mcd','mcurl':'text/vnd.curl.mcurl','mdb':'application/x-msaccess','mdi':'image/vnd.ms-modi','me':'text/troff','mesh':'model/mesh','meta4':'application/metalink4+xml','metalink':'application/metalink+xml','mets':'application/mets+xml','mfm':'application/vnd.mfmp','mft':'application/rpki-manifest','mgp':'application/vnd.osgeo.mapguide.package','mgz':'application/vnd.proteus.magazine','mid':'audio/midi','midi':'audio/midi','mie':'application/x-mie','mif':'application/vnd.mif','mime':'message/rfc822','mj2':'video/mj2','mjp2':'video/mj2','mk3d':'video/x-matroska','mka':'audio/x-matroska','mks':'video/x-matroska','mkv':'video/x-matroska','mlp':'application/vnd.dolby.mlp','mmd':'application/vnd.chipnuts.karaoke-mmd','mmf':'application/vnd.smaf','mmr':'image/vnd.fujixerox.edmics-mmr','mng':'video/x-mng','mny':'application/x-msmoney','mobi':'application/x-mobipocket-ebook','mods':'application/mods+xml','mov':'video/quicktime','movie':'video/x-sgi-movie','mp2':'audio/mpeg','mp21':'application/mp21','mp2a':'audio/mpeg','mp3':'audio/mpeg','mp4':'video/mp4','mp4a':'audio/mp4','mp4s':'application/mp4','mp4v':'video/mp4','mpc':'application/vnd.mophun.certificate','mpe':'video/mpeg','mpeg':'video/mpeg','mpg':'video/mpeg','mpg4':'video/mp4','mpga':'audio/mpeg','mpkg':'application/vnd.apple.installer+xml','mpm':'application/vnd.blueice.multipass','mpn':'application/vnd.mophun.application','mpp':'application/vnd.ms-project','mpt':'application/vnd.ms-project','mpy':'application/vnd.ibm.minipay','mqy':'application/vnd.mobius.mqy','mrc':'application/marc','mrcx':'application/marcxml+xml','ms':'text/troff','mscml':'application/mediaservercontrol+xml','mseed':'application/vnd.fdsn.mseed','mseq':'application/vnd.mseq','msf':'application/vnd.epson.msf','msh':'model/mesh','msi':'application/x-msdownload','msl':'application/vnd.mobius.msl','msty':'application/vnd.muvee.style','mts':'model/vnd.mts','mus':'application/vnd.musician','musicxml':'application/vnd.recordare.musicxml+xml','mvb':'application/x-msmediaview','mwf':'application/vnd.mfer','mxf':'application/mxf','mxl':'application/vnd.recordare.musicxml','mxml':'application/xv+xml','mxs':'application/vnd.triscape.mxs','mxu':'video/vnd.mpegurl','n-gage':'application/vnd.nokia.n-gage.symbian.install','n3':'text/n3','nb':'application/mathematica','nbp':'application/vnd.wolfram.player','nc':'application/x-netcdf','ncx':'application/x-dtbncx+xml','nfo':'text/x-nfo','ngdat':'application/vnd.nokia.n-gage.data','nitf':'application/vnd.nitf','nlu':'application/vnd.neurolanguage.nlu','nml':'application/vnd.enliven','nnd':'application/vnd.noblenet-directory','nns':'application/vnd.noblenet-sealer','nnw':'application/vnd.noblenet-web','npx':'image/vnd.net-fpx','nsc':'application/x-conference','nsf':'application/vnd.lotus-notes','ntf':'application/vnd.nitf','nzb':'application/x-nzb','oa2':'application/vnd.fujitsu.oasys2','oa3':'application/vnd.fujitsu.oasys3','oas':'application/vnd.fujitsu.oasys','obd':'application/x-msbinder','obj':'application/x-tgif','oda':'application/oda','odb':'application/vnd.oasis.opendocument.database','odc':'application/vnd.oasis.opendocument.chart','odf':'application/vnd.oasis.opendocument.formula','odft':'application/vnd.oasis.opendocument.formula-template','odg':'application/vnd.oasis.opendocument.graphics','odi':'application/vnd.oasis.opendocument.image','odm':'application/vnd.oasis.opendocument.text-master','odp':'application/vnd.oasis.opendocument.presentation','ods':'application/vnd.oasis.opendocument.spreadsheet','odt':'application/vnd.oasis.opendocument.text','oga':'audio/ogg','ogg':'audio/ogg','ogv':'video/ogg','ogx':'application/ogg','omdoc':'application/omdoc+xml','onepkg':'application/onenote','onetmp':'application/onenote','onetoc':'application/onenote','onetoc2':'application/onenote','opf':'application/oebps-package+xml','opml':'text/x-opml','oprc':'application/vnd.palm','org':'application/vnd.lotus-organizer','osf':'application/vnd.yamaha.openscoreformat','osfpvg':'application/vnd.yamaha.openscoreformat.osfpvg+xml','otc':'application/vnd.oasis.opendocument.chart-template','otf':'application/x-font-otf','otg':'application/vnd.oasis.opendocument.graphics-template','oth':'application/vnd.oasis.opendocument.text-web','oti':'application/vnd.oasis.opendocument.image-template','otp':'application/vnd.oasis.opendocument.presentation-template','ots':'application/vnd.oasis.opendocument.spreadsheet-template','ott':'application/vnd.oasis.opendocument.text-template','oxps':'application/oxps','oxt':'application/vnd.openofficeorg.extension','p':'text/x-pascal','p10':'application/pkcs10','p12':'application/x-pkcs12','p7b':'application/x-pkcs7-certificates','p7c':'application/pkcs7-mime','p7m':'application/pkcs7-mime','p7r':'application/x-pkcs7-certreqresp','p7s':'application/pkcs7-signature','p8':'application/pkcs8','pas':'text/x-pascal','paw':'application/vnd.pawaafile','pbd':'application/vnd.powerbuilder6','pbm':'image/x-portable-bitmap','pcap':'application/vnd.tcpdump.pcap','pcf':'application/x-font-pcf','pcl':'application/vnd.hp-pcl','pclxl':'application/vnd.hp-pclxl','pct':'image/x-pict','pcurl':'application/vnd.curl.pcurl','pcx':'image/x-pcx','pdb':'application/vnd.palm','pdf':'application/pdf','pfa':'application/x-font-type1','pfb':'application/x-font-type1','pfm':'application/x-font-type1','pfr':'application/font-tdpfr','pfx':'application/x-pkcs12','pgm':'image/x-portable-graymap','pgn':'application/x-chess-pgn','pgp':'application/pgp-encrypted','pic':'image/x-pict','pkg':'application/octet-stream','pki':'application/pkixcmp','pkipath':'application/pkix-pkipath','plb':'application/vnd.3gpp.pic-bw-large','plc':'application/vnd.mobius.plc','plf':'application/vnd.pocketlearn','pls':'application/pls+xml','pml':'application/vnd.ctc-posml','png':'image/png','pnm':'image/x-portable-anymap','portpkg':'application/vnd.macports.portpkg','pot':'application/vnd.ms-powerpoint','potm':'application/vnd.ms-powerpoint.template.macroenabled.12','potx':'application/vnd.openxmlformats-officedocument.presentationml.template','ppam':'application/vnd.ms-powerpoint.addin.macroenabled.12','ppd':'application/vnd.cups-ppd','ppm':'image/x-portable-pixmap','pps':'application/vnd.ms-powerpoint','ppsm':'application/vnd.ms-powerpoint.slideshow.macroenabled.12','ppsx':'application/vnd.openxmlformats-officedocument.presentationml.slideshow','ppt':'application/vnd.ms-powerpoint','pptm':'application/vnd.ms-powerpoint.presentation.macroenabled.12','pptx':'application/vnd.openxmlformats-officedocument.presentationml.presentation','pqa':'application/vnd.palm','prc':'application/x-mobipocket-ebook','pre':'application/vnd.lotus-freelance','prf':'application/pics-rules','ps':'application/postscript','psb':'application/vnd.3gpp.pic-bw-small','psd':'image/vnd.adobe.photoshop','psf':'application/x-font-linux-psf','pskcxml':'application/pskc+xml','ptid':'application/vnd.pvi.ptid1','pub':'application/x-mspublisher','pvb':'application/vnd.3gpp.pic-bw-var','pwn':'application/vnd.3m.post-it-notes','pya':'audio/vnd.ms-playready.media.pya','pyv':'video/vnd.ms-playready.media.pyv','qam':'application/vnd.epson.quickanime','qbo':'application/vnd.intu.qbo','qfx':'application/vnd.intu.qfx','qps':'application/vnd.publishare-delta-tree','qt':'video/quicktime','qwd':'application/vnd.quark.quarkxpress','qwt':'application/vnd.quark.quarkxpress','qxb':'application/vnd.quark.quarkxpress','qxd':'application/vnd.quark.quarkxpress','qxl':'application/vnd.quark.quarkxpress','qxt':'application/vnd.quark.quarkxpress','ra':'audio/x-pn-realaudio','ram':'audio/x-pn-realaudio','rar':'application/x-rar-compressed','ras':'image/x-cmu-raster','rcprofile':'application/vnd.ipunplugged.rcprofile','rdf':'application/rdf+xml','rdz':'application/vnd.data-vision.rdz','rep':'application/vnd.businessobjects','res':'application/x-dtbresource+xml','rgb':'image/x-rgb','rif':'application/reginfo+xml','rip':'audio/vnd.rip','ris':'application/x-research-info-systems','rl':'application/resource-lists+xml','rlc':'image/vnd.fujixerox.edmics-rlc','rld':'application/resource-lists-diff+xml','rm':'application/vnd.rn-realmedia','rmi':'audio/midi','rmp':'audio/x-pn-realaudio-plugin','rms':'application/vnd.jcp.javame.midlet-rms','rmvb':'application/vnd.rn-realmedia-vbr','rnc':'application/relax-ng-compact-syntax','roa':'application/rpki-roa','roff':'text/troff','rp9':'application/vnd.cloanto.rp9','rpss':'application/vnd.nokia.radio-presets','rpst':'application/vnd.nokia.radio-preset','rq':'application/sparql-query','rs':'application/rls-services+xml','rsd':'application/rsd+xml','rss':'application/rss+xml','rtf':'application/rtf','rtx':'text/richtext','s':'text/x-asm','s3m':'audio/s3m','saf':'application/vnd.yamaha.smaf-audio','sbml':'application/sbml+xml','sc':'application/vnd.ibm.secure-container','scd':'application/x-msschedule','scm':'application/vnd.lotus-screencam','scq':'application/scvp-cv-request','scs':'application/scvp-cv-response','scurl':'text/vnd.curl.scurl','sda':'application/vnd.stardivision.draw','sdc':'application/vnd.stardivision.calc','sdd':'application/vnd.stardivision.impress','sdkd':'application/vnd.solent.sdkm+xml','sdkm':'application/vnd.solent.sdkm+xml','sdp':'application/sdp','sdw':'application/vnd.stardivision.writer','see':'application/vnd.seemail','seed':'application/vnd.fdsn.seed','sema':'application/vnd.sema','semd':'application/vnd.semd','semf':'application/vnd.semf','ser':'application/java-serialized-object','setpay':'application/set-payment-initiation','setreg':'application/set-registration-initiation','sfd-hdstx':'application/vnd.hydrostatix.sof-data','sfs':'application/vnd.spotfire.sfs','sfv':'text/x-sfv','sgi':'image/sgi','sgl':'application/vnd.stardivision.writer-global','sgm':'text/sgml','sgml':'text/sgml','sh':'application/x-sh','shar':'application/x-shar','shf':'application/shf+xml','sid':'image/x-mrsid-image','sig':'application/pgp-signature','sil':'audio/silk','silo':'model/mesh','sis':'application/vnd.symbian.install','sisx':'application/vnd.symbian.install','sit':'application/x-stuffit','sitx':'application/x-stuffitx','skd':'application/vnd.koan','skm':'application/vnd.koan','skp':'application/vnd.koan','skt':'application/vnd.koan','sldm':'application/vnd.ms-powerpoint.slide.macroenabled.12','sldx':'application/vnd.openxmlformats-officedocument.presentationml.slide','slt':'application/vnd.epson.salt','sm':'application/vnd.stepmania.stepchart','smf':'application/vnd.stardivision.math','smi':'application/smil+xml','smil':'application/smil+xml','smv':'video/x-smv','smzip':'application/vnd.stepmania.package','snd':'audio/basic','snf':'application/x-font-snf','so':'application/octet-stream','spc':'application/x-pkcs7-certificates','spf':'application/vnd.yamaha.smaf-phrase','spl':'application/x-futuresplash','spot':'text/vnd.in3d.spot','spp':'application/scvp-vp-response','spq':'application/scvp-vp-request','spx':'audio/ogg','sql':'application/x-sql','src':'application/x-wais-source','srt':'application/x-subrip','sru':'application/sru+xml','srx':'application/sparql-results+xml','ssdl':'application/ssdl+xml','sse':'application/vnd.kodak-descriptor','ssf':'application/vnd.epson.ssf','ssml':'application/ssml+xml','st':'application/vnd.sailingtracker.track','stc':'application/vnd.sun.xml.calc.template','std':'application/vnd.sun.xml.draw.template','stf':'application/vnd.wt.stf','sti':'application/vnd.sun.xml.impress.template','stk':'application/hyperstudio','stl':'application/vnd.ms-pki.stl','str':'application/vnd.pg.format','stw':'application/vnd.sun.xml.writer.template','sub':'text/vnd.dvb.subtitle','sus':'application/vnd.sus-calendar','susp':'application/vnd.sus-calendar','sv4cpio':'application/x-sv4cpio','sv4crc':'application/x-sv4crc','svc':'application/vnd.dvb.service','svd':'application/vnd.svd','svg':'image/svg+xml','svgz':'image/svg+xml','swa':'application/x-director','swf':'application/x-shockwave-flash','swi':'application/vnd.aristanetworks.swi','sxc':'application/vnd.sun.xml.calc','sxd':'application/vnd.sun.xml.draw','sxg':'application/vnd.sun.xml.writer.global','sxi':'application/vnd.sun.xml.impress','sxm':'application/vnd.sun.xml.math','sxw':'application/vnd.sun.xml.writer','t':'text/troff','t3':'application/x-t3vm-image','taglet':'application/vnd.mynfc','tao':'application/vnd.tao.intent-module-archive','tar':'application/x-tar','tcap':'application/vnd.3gpp2.tcap','tcl':'application/x-tcl','teacher':'application/vnd.smart.teacher','tei':'application/tei+xml','teicorpus':'application/tei+xml','tex':'application/x-tex','texi':'application/x-texinfo','texinfo':'application/x-texinfo','text':'text/plain','tfi':'application/thraud+xml','tfm':'application/x-tex-tfm','tga':'image/x-tga','thmx':'application/vnd.ms-officetheme','tif':'image/tiff','tiff':'image/tiff','tmo':'application/vnd.tmobile-livetv','torrent':'application/x-bittorrent','tpl':'application/vnd.groove-tool-template','tpt':'application/vnd.trid.tpt','tr':'text/troff','tra':'application/vnd.trueapp','trm':'application/x-msterminal','tsd':'application/timestamped-data','tsv':'text/tab-separated-values','ttc':'application/x-font-ttf','ttf':'application/x-font-ttf','ttl':'text/turtle','twd':'application/vnd.simtech-mindmapper','twds':'application/vnd.simtech-mindmapper','txd':'application/vnd.genomatix.tuxedo','txf':'application/vnd.mobius.txf','txt':'text/plain','u32':'application/x-authorware-bin','udeb':'application/x-debian-package','ufd':'application/vnd.ufdl','ufdl':'application/vnd.ufdl','ulx':'application/x-glulx','umj':'application/vnd.umajin','unityweb':'application/vnd.unity','uoml':'application/vnd.uoml+xml','uri':'text/uri-list','uris':'text/uri-list','urls':'text/uri-list','ustar':'application/x-ustar','utz':'application/vnd.uiq.theme','uu':'text/x-uuencode','uva':'audio/vnd.dece.audio','uvd':'application/vnd.dece.data','uvf':'application/vnd.dece.data','uvg':'image/vnd.dece.graphic','uvh':'video/vnd.dece.hd','uvi':'image/vnd.dece.graphic','uvm':'video/vnd.dece.mobile','uvp':'video/vnd.dece.pd','uvs':'video/vnd.dece.sd','uvt':'application/vnd.dece.ttml+xml','uvu':'video/vnd.uvvu.mp4','uvv':'video/vnd.dece.video','uvva':'audio/vnd.dece.audio','uvvd':'application/vnd.dece.data','uvvf':'application/vnd.dece.data','uvvg':'image/vnd.dece.graphic','uvvh':'video/vnd.dece.hd','uvvi':'image/vnd.dece.graphic','uvvm':'video/vnd.dece.mobile','uvvp':'video/vnd.dece.pd','uvvs':'video/vnd.dece.sd','uvvt':'application/vnd.dece.ttml+xml','uvvu':'video/vnd.uvvu.mp4','uvvv':'video/vnd.dece.video','uvvx':'application/vnd.dece.unspecified','uvvz':'application/vnd.dece.zip','uvx':'application/vnd.dece.unspecified','uvz':'application/vnd.dece.zip','vcard':'text/vcard','vcd':'application/x-cdlink','vcf':'text/x-vcard','vcg':'application/vnd.groove-vcard','vcs':'text/x-vcalendar','vcx':'application/vnd.vcx','vis':'application/vnd.visionary','viv':'video/vnd.vivo','vob':'video/x-ms-vob','vor':'application/vnd.stardivision.writer','vox':'application/x-authorware-bin','vrml':'model/vrml','vsd':'application/vnd.visio','vsf':'application/vnd.vsf','vss':'application/vnd.visio','vst':'application/vnd.visio','vsw':'application/vnd.visio','vtu':'model/vnd.vtu','vxml':'application/voicexml+xml','w3d':'application/x-director','wad':'application/x-doom','wasm':'application/wasm','wav':'audio/x-wav','wax':'audio/x-ms-wax','wbmp':'image/vnd.wap.wbmp','wbs':'application/vnd.criticaltools.wbs+xml','wbxml':'application/vnd.wap.wbxml','wcm':'application/vnd.ms-works','wdb':'application/vnd.ms-works','wdp':'image/vnd.ms-photo','weba':'audio/webm','webm':'video/webm','webp':'image/webp','wg':'application/vnd.pmi.widget','wgt':'application/widget','wks':'application/vnd.ms-works','wm':'video/x-ms-wm','wma':'audio/x-ms-wma','wmd':'application/x-ms-wmd','wmf':'application/x-msmetafile','wml':'text/vnd.wap.wml','wmlc':'application/vnd.wap.wmlc','wmls':'text/vnd.wap.wmlscript','wmlsc':'application/vnd.wap.wmlscriptc','wmv':'video/x-ms-wmv','wmx':'video/x-ms-wmx','wmz':'application/x-ms-wmz','woff':'application/x-font-woff','wpd':'application/vnd.wordperfect','wpl':'application/vnd.ms-wpl','wps':'application/vnd.ms-works','wqd':'application/vnd.wqd','wri':'application/x-mswrite','wrl':'model/vrml','wsdl':'application/wsdl+xml','wspolicy':'application/wspolicy+xml','wtb':'application/vnd.webturbo','wvx':'video/x-ms-wvx','x32':'application/x-authorware-bin','x3d':'model/x3d+xml','x3db':'model/x3d+binary','x3dbz':'model/x3d+binary','x3dv':'model/x3d+vrml','x3dvz':'model/x3d+vrml','x3dz':'model/x3d+xml','xaml':'application/xaml+xml','xap':'application/x-silverlight-app','xar':'application/vnd.xara','xbap':'application/x-ms-xbap','xbd':'application/vnd.fujixerox.docuworks.binder','xbm':'image/x-xbitmap','xdf':'application/xcap-diff+xml','xdm':'application/vnd.syncml.dm+xml','xdp':'application/vnd.adobe.xdp+xml','xdssc':'application/dssc+xml','xdw':'application/vnd.fujixerox.docuworks','xenc':'application/xenc+xml','xer':'application/patch-ops-error+xml','xfdf':'application/vnd.adobe.xfdf','xfdl':'application/vnd.xfdl','xht':'application/xhtml+xml','xhtml':'application/xhtml+xml','xhvml':'application/xv+xml','xif':'image/vnd.xiff','xla':'application/vnd.ms-excel','xlam':'application/vnd.ms-excel.addin.macroenabled.12','xlc':'application/vnd.ms-excel','xlf':'application/x-xliff+xml','xlm':'application/vnd.ms-excel','xls':'application/vnd.ms-excel','xlsb':'application/vnd.ms-excel.sheet.binary.macroenabled.12','xlsm':'application/vnd.ms-excel.sheet.macroenabled.12','xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','xlt':'application/vnd.ms-excel','xltm':'application/vnd.ms-excel.template.macroenabled.12','xltx':'application/vnd.openxmlformats-officedocument.spreadsheetml.template','xlw':'application/vnd.ms-excel','xm':'audio/xm','xml':'application/xml','xo':'application/vnd.olpc-sugar','xop':'application/xop+xml','xpi':'application/x-xpinstall','xpl':'application/xproc+xml','xpm':'image/x-xpixmap','xpr':'application/vnd.is-xpr','xps':'application/vnd.ms-xpsdocument','xpw':'application/vnd.intercon.formnet','xpx':'application/vnd.intercon.formnet','xsl':'application/xml','xslt':'application/xslt+xml','xsm':'application/vnd.syncml+xml','xspf':'application/xspf+xml','xul':'application/vnd.mozilla.xul+xml','xvm':'application/xv+xml','xvml':'application/xv+xml','xwd':'image/x-xwindowdump','xyz':'chemical/x-xyz','xz':'application/x-xz','yang':'application/yang','yin':'application/yin+xml','z1':'application/x-zmachine','z2':'application/x-zmachine','z3':'application/x-zmachine','z4':'application/x-zmachine','z5':'application/x-zmachine','z6':'application/x-zmachine','z7':'application/x-zmachine','z8':'application/x-zmachine','zaz':'application/vnd.zzazz.deck+xml','zip':'application/zip','zir':'application/vnd.zul','zirz':'application/vnd.zul','zmm':'application/vnd.handheld-entertainment+xml'};class rH{final String mimeType;final List<int> RZ;final List<int> mask;const rH(this.mimeType,this.RZ,{this.mask});bool XD(List<int> B){if(B.length<RZ.length)return false;for(int A=0;A<RZ.length;A++ ){if(mask!=null){if((mask[A]&RZ[A])!=(mask[A]&B[A]))return false;}else{if(RZ[A]!=B[A])return false;}}return true;}}const int yIB=12;const List<rH> zIB=const[const rH('application/pdf',const[0x25,0x50,0x44,0x46]),const rH('application/postscript',const[0x25,0x51]),const rH('image/gif',const[0x47,0x49,0x46,0x38,0x37,0x61]),const rH('image/gif',const[0x47,0x49,0x46,0x38,0x39,0x61]),const rH('image/jpeg',const[0xFF,0xD8]),const rH('image/png',const[0x89,0x50,0x4E,0x47,0x0D,0x0A,0x1A,0x0A]),const rH('image/tiff',const[0x49,0x49,0x2A,0x00]),const rH('image/tiff',const[0x4D,0x4D,0x00,0x2A]),const rH('video/mp4',const[0x00,0x00,0x00,0x00,0x66,0x74,0x79,0x70,0x33,0x67,0x70,0x35],mask:const[0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF]),const rH('model/gltf-binary',const[0x46,0x54,0x6C,0x67])];final Rm BJB=new Rm();String CJB(String A,{List<int> headerBytes})=>BJB.lookup(A,headerBytes:headerBytes);class Rm{final Map<String,String> hkB={};final List<rH> ikB=[] ;final bool jkB;int kkB;Rm():jkB=true,kkB=yIB;String lookup(String C,{List<int> headerBytes}){String A;if(headerBytes!=null){A=N2(headerBytes,ikB);if(A!=null)return A;if(jkB){A=N2(headerBytes,zIB);if(A!=null)return A;}}var B=DJB(C);A=hkB[B];if(A!=null)return A;if(jkB){A=xIB[B];if(A!=null)return A;}return null;}static String N2(List<int> B,List<rH> C){for(var A in C){if(A.XD(B))return A.mimeType;}return null;}static String DJB(String A){int B=A.lastIndexOf('.');if(B<0||B+1>=A.length)return A;return A.substring(B+1).toLowerCase();}}Uint8List AJB(String C){var B=C.codeUnits;var A=new Uint8List(4+B.length);A[0]=gD.JR;A[1]=gD.wW;A[2]=gD.hc;A[3]=gD.hc;A.setRange(4,4+B.length,B);return A;}class M2 implements StreamTransformer<List<int>,DN>{final List<int> lkB;M2(String A):lkB=AJB(A);Stream<DN> bind(Stream<List<int>> A){return new B2(lkB,A).stream;}}class xW implements Exception{final String message;const xW([this.message=""]);String toString()=>"MimeMultipartException: ${message}";}abstract class DN extends Stream<List<int>>{Map<String,String> get headers;}String EJB(String A){int B=A.lastIndexOf('.',A.length-1);if(B!=-1){String C=A.substring(B+1);return O2[C];}else return null;}String Sm(String A)=>O2[A];Map O2=const{'123':'application/vnd.lotus-1-2-3','3dml':'text/vnd.in3d.3dml','3ds':'image/x-3ds','3g2':'video/3gpp2','3gp':'video/3gpp','7z':'application/x-7z-compressed','Z':'application/x-compress','aab':'application/x-authorware-bin','aac':'audio/x-aac','aam':'application/x-authorware-map','aas':'application/x-authorware-seg','abs':'audio/x-mpeg','abw':'application/x-abiword','ac':'application/pkix-attr-cert','acc':'application/vnd.americandynamics.acc','ace':'application/x-ace-compressed','acu':'application/vnd.acucobol','acutc':'application/vnd.acucorp','adp':'audio/adpcm','aep':'application/vnd.audiograph','afm':'application/x-font-type1','afp':'application/vnd.ibm.modcap','ahead':'application/vnd.ahead.space','ai':'application/postscript','aif':'audio/x-aiff','aifc':'audio/x-aiff','aiff':'audio/x-aiff','aim':'application/x-aim','air':'application/vnd.adobe.air-application-installer-package+zip','ait':'application/vnd.dvb.ait','ami':'application/vnd.amiga.ami','anx':'application/annodex','apk':'application/vnd.android.package-archive','appcache':'text/cache-manifest','application':'application/x-ms-application','apr':'application/vnd.lotus-approach','arc':'application/x-freearc','art':'image/x-jg','asc':'application/pgp-signature','asf':'video/x-ms-asf','asm':'text/x-asm','aso':'application/vnd.accpac.simply.aso','asx':'video/x-ms-asf','atc':'application/vnd.acucorp','atom':'application/atom+xml','atomcat':'application/atomcat+xml','atomsvc':'application/atomsvc+xml','atx':'application/vnd.antix.game-component','au':'audio/basic','avi':'video/x-msvideo','avs':'video/avs','avx':'video/x-rad-screenplay','aw':'application/applixware','axa':'audio/annodex','axv':'video/annodex','azf':'application/vnd.airzip.filesecure.azf','azs':'application/vnd.airzip.filesecure.azs','azw':'application/vnd.amazon.ebook','bat':'application/x-msdownload','bcpio':'application/x-bcpio','bdf':'application/x-font-bdf','bdm':'application/vnd.syncml.dm+wbxml','bed':'application/vnd.realvnc.bed','bh2':'application/vnd.fujitsu.oasysprs','bin':'application/octet-stream','blb':'application/x-blorb','blorb':'application/x-blorb','bmi':'application/vnd.bmi','bmp':'image/bmp','body':'text/html','book':'application/vnd.framemaker','box':'application/vnd.previewsystems.box','boz':'application/x-bzip2','bpk':'application/octet-stream','btif':'image/prs.btif','bwf':'audio/x-wav','bz':'application/x-bzip','bz2':'application/x-bzip2','c':'text/x-c','c11amc':'application/vnd.cluetrust.cartomobile-config','c11amz':'application/vnd.cluetrust.cartomobile-config-pkg','c4d':'application/vnd.clonk.c4group','c4f':'application/vnd.clonk.c4group','c4g':'application/vnd.clonk.c4group','c4p':'application/vnd.clonk.c4group','c4u':'application/vnd.clonk.c4group','cab':'application/vnd.ms-cab-compressed','caf':'audio/x-caf','cap':'application/vnd.tcpdump.pcap','car':'application/vnd.curl.car','cat':'application/vnd.ms-pki.seccat','cb7':'application/x-cbr','cba':'application/x-cbr','cbr':'application/x-cbr','cbt':'application/x-cbr','cbz':'application/x-cbr','cc':'text/x-c','cct':'application/x-director','ccxml':'application/ccxml+xml','cdbcmsg':'application/vnd.contact.cmsg','cdda':'audio/aiff','cdf':'application/x-netcdf','cdkey':'application/vnd.mediastation.cdkey','cdmia':'application/cdmi-capability','cdmic':'application/cdmi-container','cdmid':'application/cdmi-domain','cdmio':'application/cdmi-object','cdmiq':'application/cdmi-queue','cdx':'chemical/x-cdx','cdxml':'application/vnd.chemdraw+xml','cdy':'application/vnd.cinderella','cer':'application/pkix-cert','cfs':'application/x-cfs-compressed','cgm':'image/cgm','chat':'application/x-chat','chm':'application/vnd.ms-htmlhelp','chrt':'application/vnd.kde.kchart','cif':'chemical/x-cif','cii':'application/vnd.anser-web-certificate-issue-initiation','cil':'application/vnd.ms-artgalry','cla':'application/vnd.claymore','class':'application/java-vm','clkk':'application/vnd.crick.clicker.keyboard','clkp':'application/vnd.crick.clicker.palette','clkt':'application/vnd.crick.clicker.template','clkw':'application/vnd.crick.clicker.wordbank','clkx':'application/vnd.crick.clicker','clp':'application/x-msclip','cmc':'application/vnd.cosmocaller','cmdf':'chemical/x-cmdf','cml':'chemical/x-cml','cmp':'application/vnd.yellowriver-custom-menu','cmx':'image/x-cmx','cod':'application/vnd.rim.cod','com':'application/x-msdownload','conf':'text/plain','cpio':'application/x-cpio','cpp':'text/x-c','cpt':'application/mac-compactpro','crd':'application/x-mscardfile','cre':'music/crescendo-encrypted','crl':'application/pkix-crl','crt':'application/x-x509-ca-cert','cryptonote':'application/vnd.rig.cryptonote','csh':'application/x-csh','csml':'chemical/x-csml','csp':'application/vnd.commonspace','css':'text/css','cst':'application/x-director','csv':'text/csv','cu':'application/cu-seeme','curl':'text/vnd.curl','cww':'application/prs.cww','cxt':'application/x-director','cxx':'text/x-c','dae':'model/vnd.collada+xml','daf':'application/vnd.mobius.daf','dart':'application/vnd.dart','dataless':'application/vnd.fdsn.seed','davmount':'application/davmount+xml','dbk':'application/docbook+xml','dcr':'application/x-director','dcurl':'text/vnd.curl.dcurl','dd2':'application/vnd.oma.dd2+xml','ddd':'application/vnd.fujixerox.ddd','deb':'application/x-debian-package','def':'text/plain','deploy':'application/octet-stream','der':'application/x-x509-ca-cert','dfac':'application/vnd.dreamfactory','dgc':'application/x-dgc-compressed','dib':'image/bmp','dic':'text/x-c','dir':'application/x-director','dis':'application/vnd.mobius.dis','dist':'application/octet-stream','distz':'application/octet-stream','djv':'image/vnd.djvu','djvu':'image/vnd.djvu','dll':'application/x-msdownload','dmg':'application/x-apple-diskimage','dmp':'application/vnd.tcpdump.pcap','dms':'application/octet-stream','dna':'application/vnd.dna','doc':'application/msword','docm':'application/vnd.ms-word.document.macroenabled.12','docs':'application/vnd.google-apps.document','docx':'application/vnd.openxmlformats-officedocument.wordprocessingml.document','dot':'application/msword','dotm':'application/vnd.ms-word.template.macroenabled.12','dotx':'application/vnd.openxmlformats-officedocument.wordprocessingml.template','dp':'application/vnd.osgi.dp','dpg':'application/vnd.dpgraph','dra':'audio/vnd.dra','dsc':'text/prs.lines.tag','dssc':'application/dssc+der','dtb':'application/x-dtbook+xml','dtd':'application/xml-dtd','dts':'audio/vnd.dts','dtshd':'audio/vnd.dts.hd','dump':'application/octet-stream','dv':'video/x-dv','dvb':'video/vnd.dvb.file','dvi':'application/x-dvi','dwf':'model/vnd.dwf','dwg':'image/vnd.dwg','dxf':'image/vnd.dxf','dxp':'application/vnd.spotfire.dxp','dxr':'application/x-director','ecelp4800':'audio/vnd.nuera.ecelp4800','ecelp7470':'audio/vnd.nuera.ecelp7470','ecelp9600':'audio/vnd.nuera.ecelp9600','ecma':'application/ecmascript','edm':'application/vnd.novadigm.edm','edx':'application/vnd.novadigm.edx','efif':'application/vnd.picsel','ei6':'application/vnd.pg.osasli','elc':'application/octet-stream','emf':'application/x-msmetafile','eml':'message/rfc822','emma':'application/emma+xml','emz':'application/x-msmetafile','enc':'video/mpeg','eol':'audio/vnd.digital-winds','eot':'application/vnd.ms-fontobject','eps':'application/postscript','epub':'application/epub+zip','es3':'application/vnd.eszigno3+xml','esa':'application/vnd.osgi.subsystem','esf':'application/vnd.epson.esf','et3':'application/vnd.eszigno3+xml','etx':'text/x-setext','eva':'application/x-eva','evy':'application/x-envoy','exe':'application/x-msdownload','exi':'application/exi','ext':'application/vnd.novadigm.ext','ez':'application/andrew-inset','ez2':'application/vnd.ezpix-album','ez3':'application/vnd.ezpix-package','f':'text/x-fortran','f4v':'video/x-f4v','f77':'text/x-fortran','f90':'text/x-fortran','fbs':'image/vnd.fastbidsheet','fcdt':'application/vnd.adobe.formscentral.fcdt','fcs':'application/vnd.isac.fcs','fdf':'application/vnd.fdf','fe_launch':'application/vnd.denovo.fcselayout-link','fg5':'application/vnd.fujitsu.oasysgp','fgd':'application/x-director','fh':'image/x-freehand','fh4':'image/x-freehand','fh5':'image/x-freehand','fh7':'image/x-freehand','fhc':'image/x-freehand','fig':'application/x-xfig','flac':'audio/x-flac','flc':'video/flc','fli':'video/x-fli','flo':'application/vnd.micrografx.flo','flv':'video/x-flv','flw':'application/vnd.kde.kivio','flx':'text/vnd.fmi.flexstor','fly':'text/vnd.fly','fm':'application/vnd.framemaker','fnc':'application/vnd.frogans.fnc','for':'text/x-fortran','fpx':'image/vnd.fpx','frame':'application/vnd.framemaker','fsc':'application/vnd.fsc.weblaunch','fst':'image/vnd.fst','ftc':'application/vnd.fluxtime.clip','fti':'application/vnd.anser-web-funds-transfer-initiation','fvi':'video/isivideo','fvt':'video/vnd.fvt','fxp':'application/vnd.adobe.fxp','fxpl':'application/vnd.adobe.fxp','fzs':'application/vnd.fuzzysheet','g2w':'application/vnd.geoplan','g3':'image/g3fax','g3w':'application/vnd.geospace','gac':'application/vnd.groove-account','gam':'application/x-tads','gbr':'application/rpki-ghostbusters','gca':'application/x-gca-compressed','gdl':'model/vnd.gdl','gdoc':'application/vnd.google-apps.document','gdraw':'application/vnd.google-apps.drawing','geo':'application/vnd.dynageo','gex':'application/vnd.geometry-explorer','ggb':'application/vnd.geogebra.file','ggt':'application/vnd.geogebra.tool','ghf':'application/vnd.groove-help','gif':'image/gif','gim':'application/vnd.groove-identity-message','gml':'application/gml+xml','gmx':'application/vnd.gmx','gnumeric':'application/x-gnumeric','gph':'application/vnd.flographit','gpx':'application/gpx+xml','gqf':'application/vnd.grafeq','gqs':'application/vnd.grafeq','gram':'application/srgs','gramps':'application/x-gramps-xml','gre':'application/vnd.geometry-explorer','grv':'application/vnd.groove-injector','grxml':'application/srgs+xml','gsf':'application/x-font-ghostscript','gsheet':'application/vnd.google-apps.spreadsheet','gslide':'application/vnd.google-apps.presentation','gsm':'audio/x-gsm','gtar':'application/x-gtar','gtm':'application/vnd.groove-tool-message','gtw':'model/vnd.gtw','gv':'text/vnd.graphviz','gxf':'application/gxf','gxt':'application/vnd.geonext','gz':'application/x-gzip','gzip':'application/x-gzip','h':'text/x-c','h261':'video/h261','h263':'video/h263','h264':'video/h264','hal':'application/vnd.hal+xml','hbci':'application/vnd.hbci','hdf':'application/x-hdf','hdml':'text/x-hdml','hh':'text/x-c','hlp':'application/winhlp','hpgl':'application/vnd.hp-hpgl','hpid':'application/vnd.hp-hpid','hps':'application/vnd.hp-hps','hqx':'application/mac-binhex40','htc':'text/x-component','htke':'application/vnd.kenameaapp','htm':'text/html','html':'text/html','hvd':'application/vnd.yamaha.hv-dic','hvp':'application/vnd.yamaha.hv-voice','hvs':'application/vnd.yamaha.hv-script','i2g':'application/vnd.intergeo','icc':'application/vnd.iccprofile','ice':'x-conference/x-cooltalk','icm':'application/vnd.iccprofile','ico':'image/x-icon','ics':'text/calendar','ief':'image/ief','ifb':'text/calendar','ifm':'application/vnd.shana.informed.formdata','iges':'model/iges','igl':'application/vnd.igloader','igm':'application/vnd.insors.igm','igs':'model/iges','igx':'application/vnd.micrografx.igx','iif':'application/vnd.shana.informed.interchange','imp':'application/vnd.accpac.simply.imp','ims':'application/vnd.ms-ims','in':'text/plain','ink':'application/inkml+xml','inkml':'application/inkml+xml','install':'application/x-install-instructions','iota':'application/vnd.astraea-software.iota','ipfix':'application/ipfix','ipk':'application/vnd.shana.informed.package','irm':'application/vnd.ibm.rights-management','irp':'application/vnd.irepository.package+xml','iso':'application/x-iso9660-image','itp':'application/vnd.shana.informed.formtemplate','ivp':'application/vnd.immervision-ivp','ivu':'application/vnd.immervision-ivu','jad':'text/vnd.sun.j2me.app-descriptor','jam':'application/vnd.jam','jar':'application/java-archive','java':'text/x-java-source','jisp':'application/vnd.jisp','jlt':'application/vnd.hp-jlyt','jnlp':'application/x-java-jnlp-file','joda':'application/vnd.joost.joda-archive','jp2':'image/jp2','jpe':'image/jpeg','jpeg':'image/jpeg','jpg':'image/jpeg','jpgm':'video/jpm','jpgv':'video/jpeg','jpm':'video/jpm','js':'application/javascript','jsf':'text/plain','json':'application/json','jsonml':'application/jsonml+json','jsonp':'application/javascript','jspf':'text/plain','kar':'audio/midi','karbon':'application/vnd.kde.karbon','kfo':'application/vnd.kde.kformula','kia':'application/vnd.kidspiration','kml':'application/vnd.google-earth.kml+xml','kmz':'application/vnd.google-earth.kmz','kne':'application/vnd.kinar','knp':'application/vnd.kinar','kon':'application/vnd.kde.kontour','kpr':'application/vnd.kde.kpresenter','kpt':'application/vnd.kde.kpresenter','kpxx':'application/vnd.ds-keypoint','ksp':'application/vnd.kde.kspread','ktr':'application/vnd.kahootz','ktx':'image/ktx','ktz':'application/vnd.kahootz','kwd':'application/vnd.kde.kword','kwt':'application/vnd.kde.kword','lasxml':'application/vnd.las.las+xml','latex':'application/x-latex','lbd':'application/vnd.llamagraphics.life-balance.desktop','lbe':'application/vnd.llamagraphics.life-balance.exchange+xml','les':'application/vnd.hhe.lesson-player','lha':'application/x-lzh-compressed','link66':'application/vnd.route66.link66+xml','list':'text/plain','list3820':'application/vnd.ibm.modcap','listafp':'application/vnd.ibm.modcap','lnk':'application/x-ms-shortcut','log':'text/plain','lostxml':'application/lost+xml','lrf':'application/octet-stream','lrm':'application/vnd.ms-lrm','ltf':'application/vnd.frogans.ltf','lvp':'audio/vnd.lucent.voice','lwp':'application/vnd.lotus-wordpro','lzh':'application/x-lzh-compressed','m13':'application/x-msmediaview','m14':'application/x-msmediaview','m1v':'video/mpeg','m21':'application/mp21','m2a':'audio/mpeg','m2v':'video/mpeg','m3a':'audio/mpeg','m3u':'audio/x-mpegurl','m3u8':'application/vnd.apple.mpegurl','m4a':'audio/mp4','m4u':'video/vnd.mpegurl','m4v':'video/x-m4v','ma':'application/mathematica','mac':'image/x-macpaint','mads':'application/mads+xml','mag':'application/vnd.ecowin.chart','maker':'application/vnd.framemaker','man':'text/troff','map':'text/x-imagemap','mar':'application/octet-stream','mathml':'application/mathml+xml','mb':'application/mathematica','mbk':'application/vnd.mobius.mbk','mbox':'application/mbox','mc1':'application/vnd.medcalcdata','mcd':'application/vnd.mcd','mcurl':'text/vnd.curl.mcurl','md':'text/x-web-markdown','mdb':'application/x-msaccess','mdi':'image/vnd.ms-modi','me':'text/troff','mesh':'model/mesh','meta4':'application/metalink4+xml','metalink':'application/metalink+xml','mets':'application/mets+xml','mfm':'application/vnd.mfmp','mft':'application/rpki-manifest','mgp':'application/vnd.osgeo.mapguide.package','mgz':'application/vnd.proteus.magazine','mid':'audio/midi','midi':'audio/midi','mie':'application/x-mie','mif':'application/vnd.mif','mime':'message/rfc822','mj2':'video/mj2','mjp2':'video/mj2','mk3d':'video/x-matroska','mka':'audio/x-matroska','mkd':'text/x-web-markdown','mks':'video/x-matroska','mkv':'video/x-matroska','mlp':'application/vnd.dolby.mlp','mmd':'application/vnd.chipnuts.karaoke-mmd','mmf':'application/vnd.smaf','mmr':'image/vnd.fujixerox.edmics-mmr','mng':'video/x-mng','mny':'application/x-msmoney','mobi':'application/x-mobipocket-ebook','mods':'application/mods+xml','mov':'video/quicktime','movie':'video/x-sgi-movie','mp1':'audio/x-mpeg','mp2':'audio/mpeg','mp21':'application/mp21','mp2a':'audio/mpeg','mp3':'audio/mpeg','mp4':'video/mp4','mp4a':'audio/mp4','mp4s':'application/mp4','mp4v':'video/mp4','mpa':'audio/x-mpeg','mpc':'application/vnd.mophun.certificate','mpe':'video/mpeg','mpeg':'video/mpeg','mpega':'audio/x-mpeg','mpg':'video/mpeg','mpg4':'video/mp4','mpga':'audio/mpeg','mpkg':'application/vnd.apple.installer+xml','mpm':'application/vnd.blueice.multipass','mpn':'application/vnd.mophun.application','mpp':'application/vnd.ms-project','mpt':'application/vnd.ms-project','mpv2':'video/mpeg2','mpy':'application/vnd.ibm.minipay','mqv':'video/quicktime','mqy':'application/vnd.mobius.mqy','mrc':'application/marc','mrcx':'application/marcxml+xml','ms':'text/troff','mscml':'application/mediaservercontrol+xml','mseed':'application/vnd.fdsn.mseed','mseq':'application/vnd.mseq','msf':'application/vnd.epson.msf','msh':'model/mesh','msi':'application/x-msdownload','msl':'application/vnd.mobius.msl','msty':'application/vnd.muvee.style','mts':'model/vnd.mts','mus':'application/vnd.musician','musicxml':'application/vnd.recordare.musicxml+xml','mvb':'application/x-msmediaview','mwf':'application/vnd.mfer','mxf':'application/mxf','mxl':'application/vnd.recordare.musicxml','mxml':'application/xv+xml','mxs':'application/vnd.triscape.mxs','mxu':'video/vnd.mpegurl','n-gage':'application/vnd.nokia.n-gage.symbian.install','n3':'text/n3','nb':'application/mathematica','nbp':'application/vnd.wolfram.player','nc':'application/x-netcdf','ncx':'application/x-dtbncx+xml','nfo':'text/x-nfo','ngdat':'application/vnd.nokia.n-gage.data','nitf':'application/vnd.nitf','nlu':'application/vnd.neurolanguage.nlu','nml':'application/vnd.enliven','nnd':'application/vnd.noblenet-directory','nns':'application/vnd.noblenet-sealer','nnw':'application/vnd.noblenet-web','npx':'image/vnd.net-fpx','nsc':'application/x-conference','nsf':'application/vnd.lotus-notes','ntf':'application/vnd.nitf','nzb':'application/x-nzb','oa2':'application/vnd.fujitsu.oasys2','oa3':'application/vnd.fujitsu.oasys3','oas':'application/vnd.fujitsu.oasys','obd':'application/x-msbinder','obj':'application/x-tgif','oda':'application/oda','odb':'application/vnd.oasis.opendocument.database','odc':'application/vnd.oasis.opendocument.chart','odf':'application/vnd.oasis.opendocument.formula','odft':'application/vnd.oasis.opendocument.formula-template','odg':'application/vnd.oasis.opendocument.graphics','odi':'application/vnd.oasis.opendocument.image','odm':'application/vnd.oasis.opendocument.text-master','odp':'application/vnd.oasis.opendocument.presentation','ods':'application/vnd.oasis.opendocument.spreadsheet','odt':'application/vnd.oasis.opendocument.text','oga':'audio/ogg','ogg':'audio/ogg','ogv':'video/ogg','ogx':'application/ogg','omdoc':'application/omdoc+xml','onepkg':'application/onenote','onetmp':'application/onenote','onetoc':'application/onenote','onetoc2':'application/onenote','opf':'application/oebps-package+xml','opml':'text/x-opml','oprc':'application/vnd.palm','org':'application/vnd.lotus-organizer','osf':'application/vnd.yamaha.openscoreformat','osfpvg':'application/vnd.yamaha.openscoreformat.osfpvg+xml','otc':'application/vnd.oasis.opendocument.chart-template','otf':'application/x-font-otf','otg':'application/vnd.oasis.opendocument.graphics-template','oth':'application/vnd.oasis.opendocument.text-web','oti':'application/vnd.oasis.opendocument.image-template','otp':'application/vnd.oasis.opendocument.presentation-template','ots':'application/vnd.oasis.opendocument.spreadsheet-template','ott':'application/vnd.oasis.opendocument.text-template','oxps':'application/oxps','oxt':'application/vnd.openofficeorg.extension','p':'text/x-pascal','p10':'application/pkcs10','p12':'application/x-pkcs12','p7b':'application/x-pkcs7-certificates','p7c':'application/pkcs7-mime','p7m':'application/pkcs7-mime','p7r':'application/x-pkcs7-certreqresp','p7s':'application/pkcs7-signature','p8':'application/pkcs8','pages':'application/vnd.apple.pages','pas':'text/x-pascal','paw':'application/vnd.pawaafile','pbd':'application/vnd.powerbuilder6','pbm':'image/x-portable-bitmap','pcap':'application/vnd.tcpdump.pcap','pcd':'image/x-photo-cd','pcf':'application/x-font-pcf','pcl':'application/vnd.hp-pcl','pclxl':'application/vnd.hp-pclxl','pct':'image/x-pict','pcurl':'application/vnd.curl.pcurl','pcx':'image/x-pcx','pdb':'application/vnd.palm','pdf':'application/pdf','pfa':'application/x-font-type1','pfb':'application/x-font-type1','pfm':'application/x-font-type1','pfr':'application/font-tdpfr','pfx':'application/x-pkcs12','pgm':'image/x-portable-graymap','pgn':'application/x-chess-pgn','pgp':'application/pgp-encrypted','php':'application/x-php','pic':'image/x-pict','pict':'image/pict','pkg':'application/octet-stream','pki':'application/pkixcmp','pkipath':'application/pkix-pkipath','plb':'application/vnd.3gpp.pic-bw-large','plc':'application/vnd.mobius.plc','plf':'application/vnd.pocketlearn','pls':'application/pls+xml','pml':'application/vnd.ctc-posml','png':'image/png','pnm':'image/x-portable-anymap','pnt':'image/x-macpaint','portpkg':'application/vnd.macports.portpkg','pot':'application/vnd.ms-powerpoint','potm':'application/vnd.ms-powerpoint.template.macroenabled.12','potx':'application/vnd.openxmlformats-officedocument.presentationml.template','ppa':'application/vnd.ms-powerpoint','ppam':'application/vnd.ms-powerpoint.addin.macroenabled.12','ppd':'application/vnd.cups-ppd','ppm':'image/x-portable-pixmap','pps':'application/vnd.ms-powerpoint','ppsm':'application/vnd.ms-powerpoint.slideshow.macroenabled.12','ppsx':'application/vnd.openxmlformats-officedocument.presentationml.slideshow','ppt':'application/vnd.ms-powerpoint','pptm':'application/vnd.ms-powerpoint.presentation.macroenabled.12','pptx':'application/vnd.openxmlformats-officedocument.presentationml.presentation','pqa':'application/vnd.palm','prc':'application/x-mobipocket-ebook','pre':'application/vnd.lotus-freelance','prf':'application/pics-rules','ps':'application/postscript','psb':'application/vnd.3gpp.pic-bw-small','psd':'image/vnd.adobe.photoshop','psf':'application/x-font-linux-psf','pskcxml':'application/pskc+xml','ptid':'application/vnd.pvi.ptid1','pub':'application/x-mspublisher','pvb':'application/vnd.3gpp.pic-bw-var','pwn':'application/vnd.3m.post-it-notes','pya':'audio/vnd.ms-playready.media.pya','pyv':'video/vnd.ms-playready.media.pyv','qam':'application/vnd.epson.quickanime','qbo':'application/vnd.intu.qbo','qfx':'application/vnd.intu.qfx','qps':'application/vnd.publishare-delta-tree','qt':'video/quicktime','qti':'image/x-quicktime','qtif':'image/x-quicktime','qwd':'application/vnd.quark.quarkxpress','qwt':'application/vnd.quark.quarkxpress','qxb':'application/vnd.quark.quarkxpress','qxd':'application/vnd.quark.quarkxpress','qxl':'application/vnd.quark.quarkxpress','qxt':'application/vnd.quark.quarkxpress','ra':'audio/x-pn-realaudio','ram':'audio/x-pn-realaudio','rar':'application/x-rar-compressed','ras':'image/x-cmu-raster','rat':'text/x-rat','rcprofile':'application/vnd.ipunplugged.rcprofile','rdf':'application/rdf+xml','rdz':'application/vnd.data-vision.rdz','rep':'application/vnd.businessobjects','res':'application/x-dtbresource+xml','rgb':'image/x-rgb','rif':'application/reginfo+xml','rip':'audio/vnd.rip','ris':'application/x-research-info-systems','rl':'application/resource-lists+xml','rlc':'image/vnd.fujixerox.edmics-rlc','rld':'application/resource-lists-diff+xml','rm':'application/vnd.rn-realmedia','rmi':'audio/midi','rmp':'audio/x-pn-realaudio-plugin','rms':'application/vnd.jcp.javame.midlet-rms','rmvb':'application/vnd.rn-realmedia-vbr','rnc':'application/relax-ng-compact-syntax','roa':'application/rpki-roa','roff':'text/troff','rp9':'application/vnd.cloanto.rp9','rpss':'application/vnd.nokia.radio-presets','rpst':'application/vnd.nokia.radio-preset','rq':'application/sparql-query','rs':'application/rls-services+xml','rsd':'application/rsd+xml','rss':'application/rss+xml','rt':'text/vnd.rn-realtext','rtf':'application/rtf','rtx':'text/richtext','s':'text/x-asm','s3m':'audio/s3m','saf':'application/vnd.yamaha.smaf-audio','sbml':'application/sbml+xml','sc':'application/vnd.ibm.secure-container','scd':'application/x-msschedule','scm':'application/vnd.lotus-screencam','scq':'application/scvp-cv-request','scs':'application/scvp-cv-response','scurl':'text/vnd.curl.scurl','sda':'application/vnd.stardivision.draw','sdc':'application/vnd.stardivision.calc','sdd':'application/vnd.stardivision.impress','sdkd':'application/vnd.solent.sdkm+xml','sdkm':'application/vnd.solent.sdkm+xml','sdp':'application/sdp','sdw':'application/vnd.stardivision.writer','see':'application/vnd.seemail','seed':'application/vnd.fdsn.seed','sema':'application/vnd.sema','semd':'application/vnd.semd','semf':'application/vnd.semf','ser':'application/java-serialized-object','setpay':'application/set-payment-initiation','setreg':'application/set-registration-initiation','sfd-hdstx':'application/vnd.hydrostatix.sof-data','sfs':'application/vnd.spotfire.sfs','sfv':'text/x-sfv','sgi':'image/sgi','sgl':'application/vnd.stardivision.writer-global','sgm':'text/sgml','sgml':'text/sgml','sh':'application/x-sh','shar':'application/x-shar','shf':'application/shf+xml','sid':'image/x-mrsid-image','sig':'application/pgp-signature','sil':'audio/silk','silo':'model/mesh','sis':'application/vnd.symbian.install','sisx':'application/vnd.symbian.install','sit':'application/x-stuffit','sitx':'application/x-stuffitx','skd':'application/vnd.koan','skm':'application/vnd.koan','skp':'application/vnd.koan','skt':'application/vnd.koan','sldm':'application/vnd.ms-powerpoint.slide.macroenabled.12','sldx':'application/vnd.openxmlformats-officedocument.presentationml.slide','slides':'application/vnd.google-apps.presentation','slt':'application/vnd.epson.salt','sm':'application/vnd.stepmania.stepchart','smf':'application/vnd.stardivision.math','smi':'application/smil+xml','smil':'application/smil+xml','smv':'video/x-smv','smzip':'application/vnd.stepmania.package','snd':'audio/basic','snf':'application/x-font-snf','so':'application/octet-stream','spc':'application/x-pkcs7-certificates','spf':'application/vnd.yamaha.smaf-phrase','spl':'application/x-futuresplash','spot':'text/vnd.in3d.spot','spp':'application/scvp-vp-response','spq':'application/scvp-vp-request','spreadsheets':'application/vnd.google-apps.spreadsheet','spx':'audio/ogg','sql':'application/x-sql','src':'application/x-wais-source','srt':'application/x-subrip','sru':'application/sru+xml','srx':'application/sparql-results+xml','ssdl':'application/ssdl+xml','sse':'application/vnd.kodak-descriptor','ssf':'application/vnd.epson.ssf','ssml':'application/ssml+xml','st':'application/vnd.sailingtracker.track','stc':'application/vnd.sun.xml.calc.template','std':'application/vnd.sun.xml.draw.template','stf':'application/vnd.wt.stf','sti':'application/vnd.sun.xml.impress.template','stk':'application/hyperstudio','stl':'application/vnd.ms-pki.stl','str':'application/vnd.pg.format','stw':'application/vnd.sun.xml.writer.template','sub':'text/vnd.dvb.subtitle','sus':'application/vnd.sus-calendar','susp':'application/vnd.sus-calendar','sv4cpio':'application/x-sv4cpio','sv4crc':'application/x-sv4crc','svc':'application/vnd.dvb.service','svd':'application/vnd.svd','svg':'image/svg+xml','svgz':'image/svg+xml','swa':'application/x-director','swf':'application/x-shockwave-flash','swi':'application/vnd.aristanetworks.swi','sxc':'application/vnd.sun.xml.calc','sxd':'application/vnd.sun.xml.draw','sxg':'application/vnd.sun.xml.writer.global','sxi':'application/vnd.sun.xml.impress','sxm':'application/vnd.sun.xml.math','sxw':'application/vnd.sun.xml.writer','t':'text/troff','t3':'application/x-t3vm-image','taglet':'application/vnd.mynfc','talk':'text/x-speech','tao':'application/vnd.tao.intent-module-archive','tar':'application/x-tar','targa':'image/x-targa','tcap':'application/vnd.3gpp2.tcap','tcl':'application/x-tcl','teacher':'application/vnd.smart.teacher','tei':'application/tei+xml','teicorpus':'application/tei+xml','tex':'application/x-tex','texi':'application/x-texinfo','texinfo':'application/x-texinfo','text':'text/plain','tfi':'application/thraud+xml','tfm':'application/x-tex-tfm','tga':'image/x-tga','tgz':'application/x-tar','thmx':'application/vnd.ms-officetheme','tif':'image/tiff','tiff':'image/tiff','tmo':'application/vnd.tmobile-livetv','torrent':'application/x-bittorrent','tpl':'application/vnd.groove-tool-template','tpt':'application/vnd.trid.tpt','tr':'text/troff','tra':'application/vnd.trueapp','trm':'application/x-msterminal','tsd':'application/timestamped-data','tsv':'text/tab-separated-values','ttc':'application/x-font-ttf','ttf':'application/x-font-ttf','ttl':'text/turtle','twd':'application/vnd.simtech-mindmapper','twds':'application/vnd.simtech-mindmapper','txd':'application/vnd.genomatix.tuxedo','txf':'application/vnd.mobius.txf','txt':'text/plain','u32':'application/x-authorware-bin','udeb':'application/x-debian-package','ufd':'application/vnd.ufdl','ufdl':'application/vnd.ufdl','ulw':'audio/basic','ulx':'application/x-glulx','umj':'application/vnd.umajin','unityweb':'application/vnd.unity','uoml':'application/vnd.uoml+xml','uri':'text/uri-list','uris':'text/uri-list','urls':'text/uri-list','ustar':'application/x-ustar','utz':'application/vnd.uiq.theme','uu':'text/x-uuencode','uva':'audio/vnd.dece.audio','uvd':'application/vnd.dece.data','uvf':'application/vnd.dece.data','uvg':'image/vnd.dece.graphic','uvh':'video/vnd.dece.hd','uvi':'image/vnd.dece.graphic','uvm':'video/vnd.dece.mobile','uvp':'video/vnd.dece.pd','uvs':'video/vnd.dece.sd','uvt':'application/vnd.dece.ttml+xml','uvu':'video/vnd.uvvu.mp4','uvv':'video/vnd.dece.video','uvva':'audio/vnd.dece.audio','uvvd':'application/vnd.dece.data','uvvf':'application/vnd.dece.data','uvvg':'image/vnd.dece.graphic','uvvh':'video/vnd.dece.hd','uvvi':'image/vnd.dece.graphic','uvvm':'video/vnd.dece.mobile','uvvp':'video/vnd.dece.pd','uvvs':'video/vnd.dece.sd','uvvt':'application/vnd.dece.ttml+xml','uvvu':'video/vnd.uvvu.mp4','uvvv':'video/vnd.dece.video','uvvx':'application/vnd.dece.unspecified','uvvz':'application/vnd.dece.zip','uvx':'application/vnd.dece.unspecified','uvz':'application/vnd.dece.zip','vcard':'text/vcard','vcd':'application/x-cdlink','vcf':'text/x-vcard','vcg':'application/vnd.groove-vcard','vcs':'text/x-vcalendar','vcx':'application/vnd.vcx','vis':'application/vnd.visionary','viv':'video/vnd.vivo','vob':'video/x-ms-vob','vor':'application/vnd.stardivision.writer','vox':'application/x-authorware-bin','vrml':'model/vrml','vsd':'application/vnd.visio','vsf':'application/vnd.vsf','vss':'application/vnd.visio','vst':'application/vnd.visio','vsw':'application/vnd.visio','vtu':'model/vnd.vtu','vxml':'application/voicexml+xml','w3d':'application/x-director','wad':'application/x-doom','war':'application/java-archive','wav':'audio/x-wav','wax':'audio/x-ms-wax','wbmp':'image/vnd.wap.wbmp','wbs':'application/vnd.criticaltools.wbs+xml','wbxml':'application/vnd.wap.wbxml','wcm':'application/vnd.ms-works','wdb':'application/vnd.ms-works','wdp':'image/vnd.ms-photo','weba':'audio/webm','webm':'video/webm','webp':'image/webp','wg':'application/vnd.pmi.widget','wgt':'application/widget','wks':'application/vnd.ms-works','wlpg':'application/x-wlpg3-detect','wm':'video/x-ms-wm','wma':'audio/x-ms-wma','wmd':'application/x-ms-wmd','wmf':'application/x-msmetafile','wml':'text/vnd.wap.wml','wmlc':'application/vnd.wap.wmlc','wmls':'text/vnd.wap.wmlscript','wmlsc':'application/vnd.wap.wmlscriptc','wmlscriptc':'application/vnd.wap.wmlscriptc','wmv':'video/x-ms-wmv','wmx':'video/x-ms-wmx','wmz':'application/x-msmetafile','woff':'application/font-woff','woff2':'application/font-woff2','wpd':'application/vnd.wordperfect','wpl':'application/vnd.ms-wpl','wps':'application/vnd.ms-works','wqd':'application/vnd.wqd','wri':'application/x-mswrite','wrl':'model/vrml','wsdl':'application/wsdl+xml','wspolicy':'application/wspolicy+xml','wtb':'application/vnd.webturbo','wvx':'video/x-ms-wvx','x32':'application/x-authorware-bin','x3d':'model/x3d+xml','x3db':'model/x3d+binary','x3dbz':'model/x3d+binary','x3dv':'model/x3d+vrml','x3dvz':'model/x3d+vrml','x3dz':'model/x3d+xml','xaml':'application/xaml+xml','xap':'application/x-silverlight-app','xar':'application/vnd.xara','xbap':'application/x-ms-xbap','xbd':'application/vnd.fujixerox.docuworks.binder','xbm':'image/x-xbitmap','xdf':'application/xcap-diff+xml','xdm':'application/vnd.syncml.dm+xml','xdp':'application/vnd.adobe.xdp+xml','xdssc':'application/dssc+xml','xdw':'application/vnd.fujixerox.docuworks','xenc':'application/xenc+xml','xer':'application/patch-ops-error+xml','xfdf':'application/vnd.adobe.xfdf','xfdl':'application/vnd.xfdl','xht':'application/xhtml+xml','xhtml':'application/xhtml+xml','xhvml':'application/xv+xml','xif':'image/vnd.xiff','xla':'application/vnd.ms-excel','xlam':'application/vnd.ms-excel.addin.macroenabled.12','xlc':'application/vnd.ms-excel','xlf':'application/x-xliff+xml','xlm':'application/vnd.ms-excel','xls':'application/vnd.ms-excel','xlsb':'application/vnd.ms-excel.sheet.binary.macroenabled.12','xlsm':'application/vnd.ms-excel.sheet.macroenabled.12','xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','xlt':'application/vnd.ms-excel','xltm':'application/vnd.ms-excel.template.macroenabled.12','xltx':'application/vnd.openxmlformats-officedocument.spreadsheetml.template','xlw':'application/vnd.ms-excel','xm':'audio/xm','xml':'application/xml','xo':'application/vnd.olpc-sugar','xop':'application/xop+xml','xpi':'application/x-xpinstall','xpl':'application/xproc+xml','xpm':'image/x-xpixmap','xpr':'application/vnd.is-xpr','xps':'application/vnd.ms-xpsdocument','xpw':'application/vnd.intercon.formnet','xpx':'application/vnd.intercon.formnet','xsl':'application/xml','xslt':'application/xslt+xml','xsm':'application/vnd.syncml+xml','xspf':'application/xspf+xml','xul':'application/vnd.mozilla.xul+xml','xvm':'application/xv+xml','xvml':'application/xv+xml','xwd':'image/x-xwindowdump','xyz':'chemical/x-xyz','xz':'application/x-xz','yaml':'application/x-yaml','yang':'application/yang','yin':'application/yin+xml','z':'application/x-compress','z1':'application/x-zmachine','z2':'application/x-zmachine','z3':'application/x-zmachine','z4':'application/x-zmachine','z5':'application/x-zmachine','z6':'application/x-zmachine','z7':'application/x-zmachine','z8':'application/x-zmachine','zaz':'application/vnd.zzazz.deck+xml','zip':'application/zip','zir':'application/vnd.zul','zirz':'application/vnd.zul','zmm':'application/vnd.handheld-entertainment+xml'};class P2{static Map<String,List<int>> Q2={};static bool JJB(String A){return Q2.containsKey(A);}static List<int> KJB(String A){return Q2[A];}}Uint8List LJB(String B){int C=B.length;Uint8List D=new Uint8List(C);for(int A=0;A<C;A++ ){int G=B.codeUnitAt(A);if(G>=128){return new Uint8List.fromList(const Utf8Encoder().convert(B));}D[A]=G;}return D;}Uint8List GJB(A){if(ic==null){ic=new Um();}ic.Xg(A);return ic.done();}Um ic;class IJB{}class R2{}abstract class S2{}class T2 implements S2{static const int MJB=const int.fromEnvironment("msgpack.packer.defaultBufferSize",defaultValue:2048);List<Uint8List> mkB=<Uint8List>[] ;Uint8List nkB;int okB=0;int pkB=0;int qkB=0;int rkB=0;int skB=0;final int bufferSize;T2({this.bufferSize: MJB});void tkB(){if(nkB==null){nkB=new Uint8List(bufferSize);}if(nkB.lengthInBytes==okB){if(rkB==skB){mkB.add(nkB);skB++ ;}else{mkB[rkB]=nkB;}rkB++ ;nkB=new Uint8List(bufferSize);okB=0;pkB=0;}}void xB(int A){tkB();nkB[pkB]=A;pkB++ ;okB++ ;qkB++ ;}void KD(int A){tkB();if((nkB.lengthInBytes-okB)<2){xB((A>>8)&0xff);xB(A&0xff);}else{nkB[pkB++ ]=(A>>8)&0xff;nkB[pkB++ ]=A&0xff;okB+= 2;qkB+= 2;}}void GF(int A){tkB();if((nkB.lengthInBytes-okB)<4){xB((A>>24)&0xff);xB((A>>16)&0xff);xB((A>>8)&0xff);xB(A&0xff);}else{nkB[pkB++ ]=(A>>24)&0xff;nkB[pkB++ ]=(A>>16)&0xff;nkB[pkB++ ]=(A>>8)&0xff;nkB[pkB++ ]=A&0xff;okB+= 4;qkB+= 4;}}Uint8List read(){if(qkB<=bufferSize){return nkB.buffer.asUint8List(0,qkB);}var B=new Uint8List(qkB);var G=0;for(var A=0;A<skB;A++ ){Uint8List C=mkB[A];for(var D=C.offsetInBytes;D<C.lengthInBytes;D++ ){B[G++ ]=C[D];}}if(nkB!=null){for(var A=0;A<okB;A++ ){B[G++ ]=nkB[A];}}return B;}Uint8List done({bool reuse: false}){Uint8List A=read();if(!reuse){mkB=new List<Uint8List>();skB=0;}rkB=0;okB=0;qkB=0;pkB=0;if(!reuse){nkB=null;}return A;}void N$(Uint8List D){tkB();var A=D.lengthInBytes;var B=nkB.lengthInBytes-okB;if(B<A){var I=pkB+B;nkB.setRange(pkB,I,D);okB+= B;qkB+= B;var G=B;var H=A-B;while(G<A){tkB();if(okB==0){var C=H.clamp(0,bufferSize);nkB.setRange(0,C,D,G);pkB=C;okB=C;qkB+= C;G+= C;H-= C;}else{nkB[pkB]=D[G++ ];pkB++ ;okB++ ;qkB++ ;}}}else{nkB.setRange(pkB,pkB+A,D);pkB+= A;okB+= A;qkB+= A;}}}class Um{S2 buffer;Um([this.buffer]){if(buffer==null){buffer=new T2();}}void Xg(A){if(A is Iterable&&A is!List){A=A.toList();}if(A==null){buffer.xB(0xc0);}else if(A==false){buffer.xB(0xc2);}else if(A==true){buffer.xB(0xc3);}else if(A is int){YTB(A);}else if(A is String){bTB(A);}else if(A is List){ZTB(A);}else if(A is Map){aTB(A);}else if(A is double){WTB(A);}else if(A is R2){XTB(A);}else if(A is ByteData){VTB(A);}else if(A is IJB){hS(A.data);}else{throw new Exception("Failed to pack value: ${A}");}}void VTB(ByteData C){var B=C.buffer.asUint8List(C.offsetInBytes,C.lengthInBytes);var A=B.lengthInBytes;if(A<=255){buffer.xB(0xc4);buffer.xB(A);hS(B);}else if(A<=65535){buffer.xB(0xc5);buffer.KD(A);hS(B);}else{buffer.xB(0xc6);buffer.GF(A);hS(B);}}void YTB(int A){if(A>=0&&A<128){buffer.xB(A);return;}if(A<0){if(A>=-32){buffer.xB(0xe0+A+32);}else if(A>-0x80){buffer.xB(0xd0);buffer.xB(A+0x100);}else if(A>-0x8000){buffer.xB(0xd1);buffer.KD(A+0x10000);}else if(A>-0x80000000){buffer.xB(0xd2);buffer.GF(A+0x100000000);}else{buffer.xB(0xd3);ukB(A);}}else{if(A<0x100){buffer.xB(0xcc);buffer.xB(A);}else if(A<0x10000){buffer.xB(0xcd);buffer.KD(A);}else if(A<0x100000000){buffer.xB(0xce);buffer.GF(A);}else{buffer.xB(0xcf);ukB(A);}}}void ukB(int C){var A=(C/0x100000000).floor();var B=C&0xffffffff;buffer.xB((A>>24)&0xff);buffer.xB((A>>16)&0xff);buffer.xB((A>>8)&0xff);buffer.xB(A&0xff);buffer.xB((B>>24)&0xff);buffer.xB((B>>16)&0xff);buffer.xB((B>>8)&0xff);buffer.xB(B&0xff);}void bTB(String B){List<int> A;if(P2.JJB(B)){A=P2.KJB(B);}else{A=LJB(B);}if(A.length<0x20){buffer.xB(0xa0+A.length);}else if(A.length<0x100){buffer.xB(0xd9);buffer.xB(A.length);}else if(A.length<0x10000){buffer.xB(0xda);buffer.KD(A.length);}else{buffer.xB(0xdb);buffer.GF(A.length);}hS(A);}void WTB(double B){buffer.xB(0xcb);var A=new ByteData(8);A.setFloat64(0,B);hS(A);}void XTB(R2 B){buffer.xB(0xca);var A=new ByteData(4);A.setFloat32(0,B.value);hS(A);}void ZTB(List C){var A=C.length;if(A<16){buffer.xB(0x90+A);}else if(A<0x100){buffer.xB(0xdc);buffer.KD(A);}else{buffer.xB(0xdd);buffer.GF(A);}for(var B=0;B<A;B++ ){Xg(C[B]);}}void aTB(Map A){if(A.length<16){buffer.xB(0x80+A.length);}else if(A.length<0x100){buffer.xB(0xde);buffer.KD(A.length);}else{buffer.xB(0xdf);buffer.GF(A.length);}for(var B in A.keys){Xg(B);Xg(A[B]);}}void hS(A){if(A is Uint8List){buffer.N$(A);}else if(A is ByteData){buffer.N$(A.buffer.asUint8List(A.offsetInBytes,A.lengthInBytes));}else if(A is List){for(var B in A){buffer.xB(B);}}else{throw new Exception("I don't know how to write everything in ${A}");}}Uint8List done(){return buffer.done();}}const int FJB=4294967295;const bool HJB=true;class Tm{ByteData data;int offset;Tm(ByteBuffer A,[this.offset=0]){data=A.asByteData();}void reset(ByteBuffer A,int B){data=A.asByteData();offset=B;}Ph(){int A=data.getUint8(offset++ );if(A>=0xe0)return A-0x100;if(A<0xc0){if(A<0x80)return A;else if(A<0x90)return Rh(A-0x80);else if(A<0xa0)return Qh(A-0x90);else return Sh(A-0xa0);}switch (A){case 0xc0:return null;case 0xc2:return false;case 0xc3:return true;case 0xc4:return zs(A);case 0xc5:return zs(A);case 0xc6:return zs(A);case 0xcf:return wUB();case 0xce:return SV();case 0xcd:return Th();case 0xcc:return fE();case 0xd3:return uUB();case 0xd2:return tUB();case 0xd1:return sUB();case 0xd0:return vUB();case 0xd9:return Sh(fE());case 0xda:return Sh(Th());case 0xdb:return Sh(SV());case 0xdf:return Rh(SV());case 0xde:return Rh(Th());case 0x80:return Rh(fE());case 0xdd:return Qh(SV());case 0xdc:return Qh(Th());case 0x90:return Qh(fE());case 0xca:return rUB();case 0xcb:return qUB();}}ByteData zs(int D){int A;var C=0;if(D==0xc4){A=data.getUint8(offset);C=1;}else if(D==0xc5){A=data.getUint16(offset);C=2;}else if(D==0xc6){A=data.getUint32(offset);C=4;}else{throw new Exception("Bad Binary Type");}offset+= C;if(HJB){var B=data.buffer.asByteData(offset,A);offset+= A;return B;}else{var B=new Uint8List(A);var G=0;for(var H=offset;G<A;H++ ){B[G]=data.getUint8(H);G++ ;}offset+= A;return B.buffer.asByteData(B.offsetInBytes,B.lengthInBytes);}}double rUB(){var A=data.getFloat32(offset);offset+= 4;return A;}double qUB(){var A=new Uint8List.fromList(data.buffer.asUint8List(offset,8));offset+= 8;return A.buffer.asByteData().getFloat64(0);}int wUB(){var A=SV();var B=SV();return (A*(FJB+1))+B;}int SV(){var A=0;for(var B=0;B<4;B++ ){A=(A<<8)|fE();}return A;}int Th(){var A=fE();A=A<<8;A|= fE();return A;}int fE(){return data.getUint8(offset++ );}int uUB(){var B=[fE(),fE(),fE(),fE(),fE(),fE(),fE(),fE()];var C=B[0];if((C&0x80)!=0){var A=(C^0xff)*0x100000000000000;A+= (B[1]^0xff)*0x1000000000000;A+= (B[2]^0xff)*0x10000000000;A+= (B[3]^0xff)*0x100000000;A+= (B[4]^0xff)*0x1000000;A+= (B[5]^0xff)*0x10000;A+= (B[6]^0xff)*0x100;A+= (B[7]^0xff)+1;return -A;}else{var A=C*0x100000000000000;A+= B[1]*0x1000000000000;A+= B[2]*0x10000000000;A+= B[3]*0x100000000;A+= B[4]*0x1000000;A+= B[5]*0x10000;A+= B[6]*0x100;A+= B[7];return A;}}int tUB(){var D=[fE(),fE(),fE(),fE()];var G=(D[0]&0x40)!=0;var B=0;var J=0;var H=1;for(var C=3,I=1;C>=0;C-- ,I*= 256){var A=D[J+C];if(G){A=(A^0xff)+H;H=A>>8;A&= 0xff;}B+= A*I;}return G?-B:B;}int sUB(){int A=fE()*256+fE();if(A>0x7FFF)return A-0x10000;return A;}int vUB(){var A=fE();return A<0x80?A:A-0x100;}String Sh(int A){String B=const Utf8Decoder().convert(data.buffer.asUint8List(offset,A));offset+= A;return B;}Map Rh(int C){Map A={};for(int B=0;B<C; ++B){A[Ph()]=Ph();}return A;}List Qh(int C){List A=[] ;A.length=C;for(int B=0;B<C; ++B){A[B]=Ph();}return A;}}class V1 implements HttpHeaders{final Set<HttpHeaders> vkB;bool get chunkedTransferEncoding=>vkB.first.chunkedTransferEncoding;set chunkedTransferEncoding(bool A){for(var B in vkB){B.chunkedTransferEncoding=A;}}int get contentLength=>vkB.first.contentLength;set contentLength(int A){for(var B in vkB){B.contentLength=A;}}ContentType get contentType=>vkB.first.contentType;set contentType(ContentType A){for(var B in vkB){B.contentType=A;}}DateTime get date=>vkB.first.date;set date(DateTime A){for(var B in vkB){B.date=A;}}DateTime get expires=>vkB.first.expires;set expires(DateTime A){for(var B in vkB){B.expires=A;}}String get host=>vkB.first.host;set host(String A){for(var B in vkB){B.host=A;}}DateTime get ifModifiedSince=>vkB.first.ifModifiedSince;set ifModifiedSince(DateTime A){for(var B in vkB){B.ifModifiedSince=A;}}bool get persistentConnection=>vkB.first.persistentConnection;set persistentConnection(bool A){for(var B in vkB){B.persistentConnection=A;}}int get port=>vkB.first.port;set port(int A){for(var B in vkB){B.port=A;}}V1(Iterable<HttpHeaders> A):vkB=A.toSet();void add(String A,Object B){for(var C in vkB){C.add(A,B);}}void forEach(void A(String name,List<String> values))=>vkB.first.forEach(A);void noFolding(String A){for(var B in vkB){B.noFolding(A);}}void remove(String A,Object B){for(var C in vkB){C.remove(A,B);}}void removeAll(String A){for(var B in vkB){B.removeAll(A);}}void set(String A,Object B){for(var C in vkB){C.set(A,B);}}String value(String A)=>vkB.first.value(A);List<String> operator[](String A)=>vkB.first[A];void clear(){for(var A in vkB){A.clear();}}}class j3 extends In implements qT{j3(String A):super(A,()=>new k3(A));}class k3 implements qT,Jn{final String path;Stream<sH> get jf=>wkB.stream;final wkB=new StreamController<sH>.broadcast();Future get hZ=>xkB.future;final xkB=new Completer();StreamSubscription ykB;k3(this.path){zkB();xkB.complete();}void zkB(){ykB=new File(path).watch().transform(new sKB<FileSystemEvent>()).listen(AlB,onError:wkB.addError,onDone:BlB);}void AlB(List<FileSystemEvent> A){if(A.any((B)=>B.type==FileSystemEvent.DELETE)){return;}wkB.add(new sH(hL.Bd,path));}BlB()async{var A=await new File(path).exists();if(wkB.isClosed)return;if(A){wkB.add(new sH(hL.Bd,path));zkB();}else{wkB.add(new sH(hL.o3,path));close();}}void close(){if(ykB!=null)ykB.cancel();ykB=null;wkB.close();}}sF g$(String A,String B,String C,String D,List<String> G,Map<String,String> H,I,Function J,fH K,{bool negatable,bool splitCommas,bool hide: false}){return new sF.eVB(A,B,C,D,G,H,I,J,K,negatable:negatable,splitCommas:splitCommas,hide:hide);}class sF{final String name;final String XP;final List<String> RY;final defaultValue;final Function callback;final String Nr;final String Ft;final Map<String,String> ZU;final fH type;final bool negatable;final bool b_;final bool hide;bool get rN=>type==fH.ot;bool get y8=>type==fH.rh;sF.eVB(this.name,this.XP,this.Nr,this.Ft,List<String> A,Map<String,String> B,this.defaultValue,this.callback,fH C,{this.negatable,bool splitCommas,this.hide: false}):this.RY=A==null?null:new UnmodifiableListView(A),this.ZU=B==null?null:new UnmodifiableMapView(B),this.type=C,this.b_=splitCommas==null?C==fH.rh:splitCommas{if(name.isEmpty){throw new ArgumentError('Name cannot be empty.');}else if(name.startsWith('-')){throw new ArgumentError('Name ${name} cannot start with "-".');}if(nt.hasMatch(name)){throw new ArgumentError('Name "${name}" contains invalid characters.');}if(XP!=null){if(XP.length!=1){throw new ArgumentError('Abbreviation must be null or have length 1.');}else if(XP=='-'){throw new ArgumentError('Abbreviation cannot be "-".');}if(nt.hasMatch(XP)){throw new ArgumentError('Abbreviation is an invalid character.');}}}dynamic c8(A){if(A!=null)return A;if(!y8)return defaultValue;if(defaultValue!=null)return [defaultValue];return [] ;}static final nt=new RegExp(r'''[ \t\r\n"'\\/]''');}class fH{static const ot=const fH.fVB("OptionType.FLAG");static const h$=const fH.fVB("OptionType.SINGLE");static const rh=const fH.fVB("OptionType.MULTIPLE");final String name;const fH.fVB(this.name);}class GN{FN BB;String nB;bool oF;List<String> tB;List<String> EF;String get nq=>ClB()[1];bool get isAbsolute=>nB!=null;factory GN.oWB(String A,FN D){var H=D.e8(A);var J=D.oF(A);if(H!=null)A=A.substring(H.length);var I=<String>[] ;var G=<String>[] ;var B=0;if(A.isNotEmpty&&D.VC(A.codeUnitAt(0))){G.add(A[0]);B=1;}else{G.add('');}for(var C=B;C<A.length;C++ ){if(D.VC(A.codeUnitAt(C))){I.add(A.substring(B,C));G.add(A[C]);B=C+1;}}if(B<A.length){I.add(A.substring(B));G.add('');}return new GN.pWB(D,H,J,I,G);}GN.pWB(this.BB,this.nB,this.oF,this.tB,this.EF);String get zp{var A=this.xL();A.lZ();if(A.tB.isEmpty)return nB==null?'':nB;return A.tB.last;}String get Aq=>ClB()[0];bool get Mr=>!tB.isEmpty&&(tB.last==''||EF.last!='');void lZ(){while(!tB.isEmpty&&tB.last==''){tB.removeLast();EF.removeLast();}if(EF.length>0)EF[EF.length-1]='';}void wJ({bool canonicalize: false}){var C=0;var A=<String>[] ;for(var B in tB){if(B=='.'||B==''){}else if(B=='..'){if(A.length>0){A.removeLast();}else{C++ ;}}else{A.add(canonicalize?BB.V7(B):B);}}if(!isAbsolute){A.insertAll(0,new List.filled(C,'..'));}if(A.length==0&&!isAbsolute){A.add('.');}var D=new List<String>.generate(A.length,(G)=>BB.AK,growable:true);D.insert(0,isAbsolute&&A.length>0&&BB.CV(nB)?BB.AK:'');tB=A;EF=D;if(nB!=null&&BB==AD.fL){if(canonicalize)nB=nB.toLowerCase();nB=nB.replaceAll('/','\\');}lZ();}String toString(){var A=new StringBuffer();if(nB!=null)A.write(nB);for(var B=0;B<tB.length;B++ ){A.write(EF[B]);A.write(tB[B]);}A.write(EF.last);return A.toString();}List<String> ClB(){var A=tB.lastWhere((C)=>C!='',orElse:()=>null);if(A==null)return ['',''];if(A=='..')return ['..',''];var B=A.lastIndexOf('.');if(B<=0)return [A,''];return [A.substring(0,B),A.substring(B)];}GN xL()=>new GN.pWB(BB,nB,oF,new List.from(tB),new List.from(EF));}final i$=new RegExp(r'^-([a-zA-Z0-9])$');final j$=new RegExp(r'^-([a-zA-Z0-9]+)(.*)$');final k$=new RegExp(r'^--([a-zA-Z\-_0-9]+)(=(.*))?$');class ZV{final String c7;final ZV parent;final DH DM;final List<String> WF;final yJ=<String>[] ;final Map<String,dynamic> JO=<String,dynamic>{};ZV(this.c7,this.DM,this.WF,[this.parent,List<String> A]){if(A!=null)this.yJ.addAll(A);}String get current=>WF[0];LL YD(){var H=WF.toList();var C=null;while(WF.length>0){if(current=='--'){WF.removeAt(0);break;}var D=DM.bY[current];if(D!=null){KJ(yJ.isEmpty,'Cannot specify arguments before a command.');var A=WF.removeAt(0);var I=new ZV(A,D,WF,this,yJ);try {C=I.YD();}on Qa catch (G){if(A==null)rethrow;throw new Qa(G.message,[A]..addAll(G.bY));}yJ.clear();break;}if(w9())continue;if(s9(this))continue;if(Ds())continue;if(!DM.L7)break;yJ.add(WF.removeAt(0));}DM.lB.forEach((J,B){if(B.callback==null)return;B.callback(B.c8(JO[J]));});yJ.addAll(WF);WF.clear();return f$(DM,JO,c7,C,yJ,H);}void G_(sF A){KJ(WF.length>0,'Missing argument for "${A.name}".');setOption(JO,A,current);WF.removeAt(0);}bool w9(){var B=i$.firstMatch(current);if(B==null)return false;var A=DM.kf(B[1]);if(A==null){KJ(parent!=null,'Could not find an option or flag "-${B[1]}".');return parent.w9();}WF.removeAt(0);if(A.rN){qg(JO,A,true);}else{G_(A);}return true;}bool s9(ZV G){var A=j$.firstMatch(current);if(A==null)return false;var B=A[1].substring(0,1);var D=DM.kf(B);if(D==null){KJ(parent!=null,'Could not find an option with short name "-${B}".');return parent.s9(G);}else if(!D.rN){var H='${A[1].substring(1)}${A[2]}';setOption(JO,D,H);}else{KJ(A[2]=='','Option "-${B}" is a flag and cannot handle value ' '"${A[1].substring(1)}${A[2]}".');for(var C=0;C<A[1].length;C++ ){var B=A[1].substring(C,C+1);G.v9(B);}}WF.removeAt(0);return true;}void v9(String A){var B=DM.kf(A);if(B==null){KJ(parent!=null,'Could not find an option with short name "-${A}".');parent.v9(A);return;}KJ(B.rN,'Option "-${A}" must be a flag to be in a collapsed "-".');qg(JO,B,true);}bool Ds(){var C=k$.firstMatch(current);if(C==null)return false;var A=C[1];var B=DM.lB[A];if(B!=null){WF.removeAt(0);if(B.rN){KJ(C[3]==null,'Flag option "${A}" should not be given a value.');qg(JO,B,true);}else if(C[3]!=null){setOption(JO,B,C[3]);}else{G_(B);}}else if(A.startsWith('no-')){A=A.substring('no-'.length);B=DM.lB[A];if(B==null){KJ(parent!=null,'Could not find an option named "${A}".');return parent.Ds();}WF.removeAt(0);KJ(B.rN,'Cannot negate non-flag option "${A}".');KJ(B.negatable,'Cannot negate option "${A}".');qg(JO,B,false);}else{KJ(parent!=null,'Could not find an option named "${A}".');return parent.Ds();}return true;}void KJ(bool A,String B){if(!A)throw new Qa(B);}void setOption(Map C,sF A,String B){assert(!A.rN);if(!A.y8){DlB(A,B);C[A.name]=B;return;}var D=C.putIfAbsent(A.name,()=><String>[] );if(A.b_){for(var G in B.split(",")){DlB(A,G);D.add(G);}}else{DlB(A,B);D.add(B);}}void qg(Map B,sF A,bool C){assert(A.rN);B[A.name]=C;}void DlB(sF A,String B){if(A.RY==null)return;KJ(A.RY.contains(B),'"${B}" is not an allowed value for option "${A.name}".');}}abstract class Ym{}class iJB implements Ym{Random OM=new Random.secure();List<int> VRB(int C){var A=new List<int>();for(var B=0;B<C;B++ ){A.add(OM.nextInt(256));}return A;}}class zW{Ym P_;NL hash;int ElB;int FlB;zW({Ym saltGenerator,NL hash,int iterations: 1000,int keyLength: 32}){this.P_=saltGenerator==null?new iJB():saltGenerator;this.hash=hash==null?da:hash;this.ElB=iterations;this.FlB=keyLength;}bool Iq(String A,String C){var D=AX.jJB(A);var G=AX.kJB(A);var H=AX.a2(D,C,hash,ElB,FlB);var B=-1;return H.every((I){B++ ;return G[B]==I;});}String tf(String A,{List<int> salt}){if(salt==null){salt=P_.VRB(32);}var B=AX.a2(salt,A,hash,ElB,FlB);return AX.lJB(salt,B);}}class AX{static List<int> jJB(String A){var B=int.parse(A.substring(0,3));var C=A.substring(3,3+B);return BASE64.decode(C);}static List<int> kJB(String A){var B=int.parse(A.substring(0,3));var C=A.substring(3+B);return BASE64.decode(C);}static List<int> a2(List<int> A,String B,NL C,int D,int G){var H=new u2(hash:C);return H.URB(B,new String.fromCharCodes(A),D,G);}static String lJB(List<int> C,List<int> D){var B=BASE64.encode(C);var G=BASE64.encode(D);var H=B.length;var A="${H}";while(A.length<3){A="0${A}";}return "${A}${B}${G}";}}final AE mJB=new AE(style:AD.fL);final AE b2=new AE(style:AD.HN);final AE yE=sJB();AD get lc=>yE.BB;String get c2{var B=Uri.base;if(B==d2)return BX;d2=B;if(AD.hm==AD.HN){BX=B.resolve('.').toString();return BX;}else{var A=B.toFilePath();var C=A.length-1;assert(A[C]=='/'||A[C]=='\\');BX=C==0?A:A.substring(0,C);return BX;}}Uri d2;String BX;String get nJB=>yE.AK;String oJB(String A,[String B,String C,String D,String G,String H,String I])=>yE.absolute(A,B,C,D,G,H,I);String hG(String A)=>yE.zp(A);String pJB(String A)=>yE.Aq(A);String jT(String A)=>yE.YQB(A);String Zm(String A)=>yE.nq(A);bool am(String A)=>yE.isAbsolute(A);String p(String A,[String B,String C,String D,String G,String H,String I,String J])=>yE.join(A,B,C,D,G,H,I,J);String bm(Iterable<String> A)=>yE.B9(A);List<String> e2(String A)=>yE.split(A);String f2(String A)=>yE.wJ(A);String cm(String A,{String from})=>yE.iZ(A,from:from);String qJB(A)=>yE.K8(A);Uri rJB(String A)=>yE.o_(A);String g2(A)=>yE.pTB(A);class nc implements Exception{String message;nc(this.message);String toString()=>"PathException: ${message}";}final EKB=new RegExp(r'^' r'(\d+).(\d+).(\d+)' r'(-([0-9A-Za-z-]+(\.[0-9A-Za-z-]+)*))?' r'(\+([0-9A-Za-z-]+(\.[0-9A-Za-z-]+)*))?');final FKB=new RegExp(EKB.pattern+r'$');class u2{NL hash;List<int> GlB=new List<int>(4);int HlB=null;u2({this.hash});List<int> URB(String H,String I,int J,int B){if(B>(2<<31-1)*Hs){throw "derived key too long";}var C=(B/Hs).ceil();var K=B-(C-1)*Hs;var D=<int>[] ;for(var A=1;A<=C; ++A){var G=IlB(H,I,J,A);if(A<C){D.addAll(G);}else{D.addAll(G.sublist(0,K));}}return D;}int get Hs{if(HlB!=null){return HlB;}var A=hash.convert([1,2,3]);var B=A.eC.length;return B;}List<int> IlB(String D,String M,int N,int O){var A=new PJ(hash,D.codeUnits);var B=new vJB();var C=A.startChunkedConversion(B);C.add(M.codeUnits);JlB(C,O);C.close();B.close();var G=B.XRB();var H=G;var I=new List.from(G);for(var J=1;J<N;J++ ){A=new PJ(hash,D.codeUnits);var K=A.convert(H);KlB(I,K.eC);H=K.eC;}return I;}void JlB(ByteConversionSink B,int A){GlB[0]=A>>24;GlB[1]=A>>16;GlB[2]=A>>8;GlB[3]=A;B.add(GlB);}void KlB(List<int> B,List<int> C){for(var A=0;A<B.length;A++ ){B[A]=B[A]^C[A];}}}class vJB extends ChunkedConversionSink<SE>{final List<SE> F7=<SE>[] ;void add(SE A){F7.add(A);}void close(){}List<int> XRB()=>F7.fold([] ,(A,B)=>A..addAll(B.eC));}class jm extends bK{final Function LlB;jm(A,this.LlB):super(A);BE DD(zE B){var A=MlB.DD(B);if(A.tN){return A.aD(LlB(A.value));}else{return A;}}bool PG(DB A){return A is jm&&super.PG(A)&&LlB==A.LlB;}}class v2 extends bK{DB NlB;DB OlB;v2(A,this.NlB,this.OlB):super(A);BE DD(zE C){var A=C;do{A=NlB.DD(A);}while((A as BE).tN);var B=MlB.DD(A);if(B.ES){return B;}A=B;do{A=OlB.DD(A);}while((A as BE).tN);return A.aD(B.value);}List<DB> get Z=>[MlB,NlB,OlB];void replace(DB A,DB B){super.replace(A,B);if(NlB==A){NlB=B;}if(OlB==A){OlB=B;}}}class A3 extends bK{A3(A):super(A);BE DD(zE A){var B=MlB.DD(A);if(B.tN){var C=A.buffer is String?A.buffer.substring(A.position,B.position):A.buffer.sublist(A.position,B.position);return B.aD(C);}else{return B;}}}class F3 extends bK{F3(A):super(A);BE DD(zE B){var A=MlB.DD(B);if(A.tN){var C=new MR(A.value,B.buffer,B.position,A.position);return A.aD(C);}else{return A;}}}class lT extends DB{final IN PlB;final String QlB;lT(this.PlB,this.QlB);BE DD(zE A){var C=A.buffer;var B=A.position;if(B<C.length&&PlB.test(C.codeUnitAt(B))){return A.aD(C[B],B+1);}return A.pN(QlB);}String toString()=>'${super.toString()}[${QlB}]';bool PG(DB A){return A is lT&&super.PG(A)&&PlB==A.PlB&&QlB==A.QlB;}}abstract class IN{}class x2 implements IN{final IN z9;x2(this.z9);bool test(int A)=>!z9.test(A);}IN yJB(Iterable<mT> J){var H=new List.from(J,growable:false);H.sort((C,D){return C.start!=D.start?C.start-D.start:C.stop-D.stop;});var A=new List();for(var B in H){if(A.isEmpty){A.add(B);}else{var I=A.last;if(I.stop+1>=B.start){var K=new mT(I.start,B.stop);A[A.length-1]=K;}else{A.add(B);}}}if(A.length==1){return A[0].start==A[0].stop?new vm(A[0].start):A[0];}else{return new J3(A.length,A.map((G)=>G.start).toList(growable:false) as List<int>,A.map((G)=>G.stop).toList(growable:false) as List<int>);}}DB TC(A,[String B]){return new lT(new vm(FX(A)),B!=null?B:'"${A}" expected');}class vm implements IN{final int value;const vm(this.value);bool test(int A)=>identical(this.value,A);}DB oc([String A]){return new lT(zJB,A!=null?A:'digit expected');}class G3 implements IN{const G3();bool test(int A)=>48<=A&&A<=57;}const zJB=const G3();DB I3(String A,[String B]){return new lT(BKB.YD(A).value,B!=null?B:'[${A}] expected');}DB AKB(){var B=DP().map((A)=>new mT(FX(A),FX(A)));var C=DP().US(TC('-')).US(DP()).map((A)=>new mT(FX(A[0]),FX(A[2])));var D=C.LM(B).dg().map((A)=>yJB(A as Iterable<mT>));return TC('^').KM().US(D).map((A)=>A[0]==null?A[1]:new x2(A[1]));}final BKB=AKB();class J3 implements IN{final int length;final List<int> d_;final List<int> g_;J3(this.length,this.d_,this.g_);bool test(int D){var A=0;var B=length;while(A<B){var C=A+((B-A)>>1);var G=d_[C]-D;if(G==0){return true;}else if(G<0){A=C+1;}else{B=C;}}return 0<A&&D<=g_[A-1];}}class mT implements IN{final int start;final int stop;mT(this.start,this.stop);bool test(int A)=>start<=A&&A<=stop;}DB CKB([String A]){return new lT(DKB,A!=null?A:'whitespace expected');}class K3 implements IN{const K3();bool test(int A){if(A<256){return A==0x09||A==0x0A||A==0x0B||A==0x0C||A==0x0D||A==0x20||A==0x85||A==0xA0;}else{return A==0x1680||A==0x180E||A==0x2000||A==0x2001||A==0x2002||A==0x2003||A==0x2004||A==0x2005||A==0x2006||A==0x2007||A==0x2008||A==0x2009||A==0x200A||A==0x2028||A==0x2029||A==0x202F||A==0x205F||A==0x3000||A==0xFEFF;}}}const DKB=const K3();int FX(A){if(A is num){return A.round();}var B=A.toString();if(B.length!=1){throw new ArgumentError('${B} is not a character');}return B.codeUnitAt(0);}class bK extends DB{DB MlB;bK(this.MlB);BE DD(zE A){return MlB.DD(A);}List<DB> get Z=>[MlB];void replace(DB A,DB B){super.replace(A,B);if(MlB==A){MlB=B;}}}class mm extends bK{final String QlB;mm(A,this.QlB):super(A);BE DD(zE B){var A=MlB.DD(B);if(A.ES||A.position==A.buffer.length){return A;}return A.pN(QlB,A.position);}String toString()=>'${super.toString()}[${QlB}]';bool PG(DB A){return A is mm&&super.PG(A)&&QlB==A.QlB;}}class z2 extends bK{z2(A):super(A);BE DD(zE B){var A=MlB.DD(B);if(A.tN){return B.aD(A.value);}else{return A;}}}class rm extends bK{final String QlB;rm(A,this.QlB):super(A);BE DD(zE A){var B=MlB.DD(A);if(B.ES){return A.aD(null);}else{return A.pN(QlB);}}String toString()=>'${super.toString()}[${QlB}]';bool PG(DB A){return A is rm&&super.PG(A)&&QlB==A.QlB;}}class tm extends bK{final RlB;tm(A,this.RlB):super(A);BE DD(zE A){var B=MlB.DD(A);if(B.tN){return B;}else{return A.aD(RlB);}}bool PG(DB A){return A is tm&&super.PG(A)&&RlB==A.RlB;}}abstract class um extends DB{final List<DB> SlB;um(this.SlB);List<DB> get Z=>SlB;void replace(DB B,DB C){super.replace(B,C);for(var A=0;A<SlB.length;A++ ){if(SlB[A]==B){SlB[A]=C;}}}}class EX extends um{factory EX(Iterable<DB> A){return new EX.qWB(new List.from(A,growable:false));}EX.qWB(List<DB> A):super(A);BE DD(zE C){var A;for(var B=0;B<SlB.length;B++ ){A=SlB[B].DD(C);if(A.tN){return A;}}return A;}DB LM(DB A){return new EX(new List()..addAll(SlB)..add(A));}}class NR extends um{factory NR(Iterable<DB> A){return new NR.rWB(new List.from(A,growable:false));}NR.rWB(List<DB> A):super(A);BE DD(zE G){var C=G;var D=new List(SlB.length);for(var A=0;A<SlB.length;A++ ){var B=SlB[A].DD(C);if(B.ES){return B;}D[A]=B.value;C=B;}return C.aD(D);}DB US(DB A){return new NR(new List()..addAll(SlB)..add(A));}}class zE{const zE(this.buffer,this.position);final buffer;final int position;BE aD(B,[int A]){return new y2(buffer,A==null?this.position:A,B);}BE pN(String B,[int A]){return new om(buffer,A==null?this.position:A,B);}String toString()=>'Context[${Jh()}]';String Jh()=>MR.D3(buffer,position);}abstract class BE extends zE{const BE(A,B):super(A,B);bool get tN=>false;bool get ES=>false;get value;String get message;}class y2 extends BE{const y2(A,B,this.value):super(A,B);bool get tN=>true;final value;String get message=>null;String toString()=>'Success[${Jh()}]: ${value}';}class om extends BE{const om(A,B,this.message):super(A,B);bool get ES=>true;get value=>throw new B3(this);final String message;String toString()=>'Failure[${Jh()}]: ${message}';}class B3 extends Error{final om pN;B3(this.pN);String toString()=>'${pN.message} at ${pN.Jh()}';}abstract class qm{const qm();DB start();DB GB(Function A,[B,C,D,G,H,I]){var J=[B,C,D,G,H,I].takeWhile((K)=>K!=null).toList(growable:false);return new gL(A,J);}DB CI({Function start: null,List arguments: const[] }){return TlB(new gL(start!=null?start:this.start,arguments));}DB TlB(gL C){var H=new Map();DB I(gL C){var A=H[C];if(A==null){var D=[C];A=C.resolve();while(A is gL){if(D.contains(A)){throw new StateError('Recursive references detected: ${D}');}D.add(A);A=A.resolve();}for(var N in D){H[N]=A;}}return A;}var G=[I(C)];var J=new Set.from(G);while(G.isNotEmpty){var K=G.removeLast();for(var B in K.Z){if(B is gL){var M=I(B);K.replace(B,M);B=M;}if(!J.contains(B)){J.add(B);G.add(B);}}}return H[C];}}class H3 extends bK{H3(qm A):super(A.CI());}class gL extends DB{final Function function;final List arguments;gL(this.function,this.arguments);DB resolve()=>Function.apply(function,arguments);bool operator==(A){if(A is!gL||A.function!=function||A.arguments.length!=arguments.length){return false;}for(var B=0;B<arguments.length;B++ ){var C=arguments[B],D=A.arguments[B];if(C is DB&&C is!gL&&D is DB&&D is!gL){if(!C.v8(D)){return false;}}else{if(C!=D){return false;}}}return true;}int get hashCode=>function.hashCode;BE DD(zE A)=>throw new UnsupportedError('References cannot be parsed.');}abstract class DB{BE DD(zE A);BE YD(A){return DD(new zE(A,0));}Iterable XD(B){var A=new List();oR().map((C)=>A.add(C)).US(DP()).LM(DP()).RM().YD(B);return A;}Iterable nSB(B){var A=new List();map((C)=>A.add(C)).LM(DP()).RM().YD(B);return A;}DB KM([A])=>new tm(this,A);DB RM()=>ig(0,CX);DB dg()=>ig(1,CX);DB ig(int A,int B){return new w2(this,A,B);}DB Hh(int A)=>ig(A,A);DB US(DB A)=>new NR([this,A]);DB operator&(DB A)=>this.US(A);DB LM(DB A)=>new EX([this,A]);DB operator|(DB A)=>this.LM(A);DB oR()=>new z2(this);DB LS([String A])=>new rm(this,A);DB qr([String A])=>LS(A).US(DP()).FO(1);DB uq()=>new A3(this);DB token()=>new F3(this);DB trim([DB A,DB B]){if(A==null)A=CKB();if(B==null)B=A;return new v2(this,A,B);}DB end([String A='end of input expected']){return new mm(this,A);}DB map(Function A)=>new jm(this,A);DB FO(int A){return this.map((List B){return B[A<0?B.length+A:A];});}DB nTB(List<int> C){return this.map((List B){return C.map((A){return B[A<0?B.length+A:A];}).toList();});}DB qZ(DB B,{bool includeSeparators: true,bool optionalSeparatorAtEnd: false}){var D=new NR([B,this]).RM();var H=new NR(optionalSeparatorAtEnd?[this,D,B.KM(B)]:[this,D]);return H.map((List C){var A=new List();A.add(C[0]);for(var G in C[1]){if(includeSeparators){A.add(G[0]);}A.add(G[1]);}if(includeSeparators&&optionalSeparatorAtEnd&&!identical(C[2],B)){A.add(C[2]);}return A;});}bool v8(DB B,[Set<DB> A]){if(A==null){A=new Set();}if(this==B||A.contains(this)){return true;}A.add(this);return runtimeType==B.runtimeType&&PG(B)&&rRB(B,A);}bool PG(DB A)=>true;bool rRB(DB D,Set<DB> G){var B=Z,C=D.Z;if(B.length!=C.length){return false;}for(var A=0;A<B.length;A++ ){if(!B[A].v8(C[A],G)){return false;}}return true;}List<DB> get Z=>const[] ;void replace(DB A,DB B){}}DB DP([String A='input expected']){return new lm(A);}class lm extends DB{final String QlB;lm(this.QlB);BE DD(zE A){var B=A.position;var C=A.buffer;return B<C.length?A.aD(C[B],B+1):A.pN(QlB);}bool PG(DB A){return A is lm&&super.PG(A)&&QlB==A.QlB;}}DB nm(A,[String B]){return E3(1,(C)=>A.indexOf(C)>=0,B!=null?B:'any of ${A} expected');}DB DX(String A,[String B]){return E3(A.length,(String C)=>A==C,B!=null?B:'${A} expected');}typedef bool C3(_0);DB E3(int A,C3 B,String C){return new sm(A,B,C);}class sm extends DB{final int UlB;final C3 PlB;final String QlB;sm(this.UlB,this.PlB,this.QlB);BE DD(zE A){final C=A.position;final B=C+UlB;if(B<=A.buffer.length){var D=A.buffer is String?A.buffer.substring(C,B):A.buffer.sublist(C,B);if(PlB(D)){return A.aD(D,B);}}return A.pN(QlB);}String toString()=>'${super.toString()}[${QlB}]';bool PG(DB A){return A is sm&&super.PG(A)&&UlB==A.UlB&&PlB==A.PlB&&QlB==A.QlB;}}const int CX=-1;abstract class km extends bK{final int VlB;final int WlB;km(DB A,this.VlB,this.WlB):super(A){assert(0<=VlB);assert(WlB==CX||VlB<=WlB);}String toString(){var A=WlB==CX?'*':WlB;return '${super.toString()}[${VlB}..${A}]';}bool PG(DB A){return A is km&&super.PG(A)&&VlB==A.VlB&&WlB==A.WlB;}}class w2 extends km{w2(DB A,int B,int C):super(A,B,C);BE DD(zE D){var B=D;var C=new List();while(C.length<VlB){var A=MlB.DD(B);if(A.ES){return A;}C.add(A.value);B=A;}while(WlB==CX||C.length<WlB){var A=MlB.DD(B);if(A.ES){return B.aD(C);}C.add(A.value);B=A;}return B.aD(C);}}class MR{final value;final buffer;final int start;final int stop;const MR(this.value,this.buffer,this.start,this.stop);get input=>buffer is String?buffer.substring(start,stop):buffer.sublist(start,stop);int get length=>stop-start;int get line=>MR.pm(buffer,start)[0];int get column=>MR.pm(buffer,start)[1];String toString()=>'Token[${D3(buffer,start)}]: ${value}';bool operator==(A){return A is MR&&value==A.value&&start==A.start&&stop==A.stop;}int get hashCode=>value.hashCode+start.hashCode+stop.hashCode;static DB wJB()=>xJB;static final DB xJB=TC('\n')|(TC('\r')&TC('\n').KM());static List<int> pm(String G,int A){var B=1,C=0;for(var D in wJB().token().nSB(G)){if(A<D.stop){return [B,A-C+1];}B++ ;C=D.stop;}return [B,A-C+1];}static String D3(A,int B){if(A is String){var C=MR.pm(A,B);return '${C[0]}:${C[1]}';}else{return '${B}';}}}class l3 extends In implements qT{l3(String A,{Duration pollingDelay}):super(A,(){return new m3(A,pollingDelay!=null?pollingDelay:new Duration(seconds:1));});}class m3 implements qT,Jn{final String path;Stream<sH> get jf=>XlB.stream;final XlB=new StreamController<sH>.broadcast();Future get hZ=>YlB.future;final YlB=new Completer();Timer ZlB;DateTime alB;m3(this.path,Duration A){ZlB=new Timer.periodic(A,(B)=>blB());blB();}Future blB()async{var B=await new File(path).exists();if(XlB.isClosed)return;if(alB!=null&&!B){XlB.add(new sH(hL.o3,path));close();return;}var A;try {try {A=await rKB(path);}finally {if(XlB.isClosed)return;}}on FileSystemException catch (C,D){XlB.addError(C,D);close();return;}if(alB==A)return;if(alB==null){alB=A;YlB.complete();}else{alB=A;XlB.add(new sH(hL.Bd,path));}}void close(){ZlB.cancel();XlB.close();}}class p2 extends FN{p2();final name='posix';final AK='/';final EF=const['/'];final T_=new RegExp(r'/');final Z9=new RegExp(r'[^/]$');final O_=new RegExp(r'^/');final H_=null;bool Rf(String A)=>A.contains('/');bool VC(int A)=>A==fJ;bool CV(String A)=>A.isNotEmpty&&!VC(A.codeUnitAt(A.length-1));int AL(String A,{bool withDrive: false}){if(A.isNotEmpty&&VC(A.codeUnitAt(0)))return 1;return 0;}bool oF(String A)=>false;String cZ(Uri A){if(A.scheme==''||A.scheme=='file'){return Uri.decodeComponent(A.path);}throw new ArgumentError("Uri ${A} must have scheme 'file:'.");}Uri HY(String B){var A=new GN.oWB(B,this);if(A.tB.isEmpty){A.tB.addAll(["",""]);}else if(A.Mr){A.tB.add("");}return new Uri(scheme:'file',pathSegments:A.tB);}}class Tu<R> extends Object with ListMixin<R> implements Queue<R>{static const int Uu=8;List<R> clB;int dlB;int elB;Tu([int A]):dlB=0,elB=0{if(A==null||A<Uu){A=Uu;}else if(!Vu(A)){A=Wu(A);}assert(Vu(A));clB=new List<R>(A);}void add(R A){flB(A);}void addAll(Iterable<R> G){if(G is List){var B=G;int A=B.length;int C=this.length;if(C+A>=clB.length){glB(C+A);clB.setRange(C,C+A,B,0);elB+= A;}else{int D=clB.length-elB;if(A<D){clB.setRange(elB,elB+A,B,0);elB+= A;}else{int H=A-D;clB.setRange(elB,elB+D,B,0);clB.setRange(0,H,B,D);elB=H;}}}else{for(R I in G)flB(I);}}String toString()=>IterableBase.iterableToFullString(this,"{","}");void addLast(R A){flB(A);}void addFirst(R A){dlB=(dlB-1)&(clB.length-1);clB[dlB]=A;if(dlB==elB)hlB();}R removeFirst(){if(dlB==elB)throw new StateError("No element");R A=clB[dlB];clB[dlB]=null;dlB=(dlB+1)&(clB.length-1);return A;}R removeLast(){if(dlB==elB)throw new StateError("No element");elB=(elB-1)&(clB.length-1);R A=clB[elB];clB[elB]=null;return A;}int get length=>(elB-dlB)&(clB.length-1);void set length(int A){if(A<0)throw new RangeError("Length ${A} may not be negative.");int C=A-length;if(C>=0){if(clB.length<=A){glB(A);}elB=(elB+C)&(clB.length-1);return;}int B=elB+C;if(B>=0){clB.fillRange(B,elB,null);}else{B+= clB.length;clB.fillRange(0,elB,null);clB.fillRange(B,clB.length,null);}elB=B;}R operator[](int A){if(A<0||A>=length){throw new RangeError("Index ${A} must be in the range [0..${length}).");}return clB[(dlB+A)&(clB.length-1)];}void operator[]=(int A,R B){if(A<0||A>=length){throw new RangeError("Index ${A} must be in the range [0..${length}).");}clB[(dlB+A)&(clB.length-1)]=B;}static bool Vu(int A)=>(A&(A-1))==0;static int Wu(int A){assert(A>0);A=(A<<1)-1;for(;;){int B=A&(A-1);if(B==0)return A;A=B;}}void flB(R A){clB[elB]=A;elB=(elB+1)&(clB.length-1);if(dlB==elB)hlB();}void hlB(){List<R> A=new List<R>(clB.length*2);int B=clB.length-dlB;A.setRange(0,B,clB,dlB);A.setRange(B,B+dlB,clB,0);dlB=0;elB=clB.length;clB=A;}int ilB(List<R> A){assert(A.length>=length);if(dlB<=elB){int C=elB-dlB;A.setRange(0,C,clB,dlB);return C;}else{int B=clB.length-dlB;A.setRange(0,B,clB,dlB);A.setRange(B,B+elB,clB,0);return elB+B;}}void glB(int A){assert(A>=length);A+= A>>1;int C=Wu(A);List<R> B=new List<R>(C);elB=ilB(B);clB=B;dlB=0;}}abstract class nT<wB,dB> implements Map<wB,dB>{factory nT()=>new sc();}class sc<wB,dB> implements nT<wB,dB>{final Map<wB,dB> jlB;final Map<dB,wB> klB;nT<dB,wB> llB;sc():this.xWB(new HashMap(),new HashMap());sc.xWB(this.jlB,this.klB);dB operator[](Object A)=>jlB[A];void operator[]=(wB A,dB B){mlB(A,B,false);}void replace(wB A,dB B){mlB(A,B,true);}void addAll(Map<wB,dB> A)=>A.forEach((B,C)=>mlB(B,C,false));bool containsKey(Object A)=>jlB.containsKey(A);bool containsValue(Object A)=>klB.containsKey(A);void forEach(void A(wB key,dB value))=>jlB.forEach(A);bool get isEmpty=>jlB.isEmpty;bool get isNotEmpty=>jlB.isNotEmpty;Iterable<wB> get keys=>jlB.keys;int get length=>jlB.length;Iterable<dB> get values=>klB.keys;nT<dB,wB> get GSB{if(llB==null){llB=new sc.xWB(klB,jlB);}return llB;}dB putIfAbsent(wB A,dB C()){var B=jlB[A];if(B!=null)return B;if(!jlB.containsKey(A))return mlB(A,C(),false);return null;}dB remove(Object A){klB.remove(jlB[A]);return jlB.remove(A);}void clear(){jlB.clear();klB.clear();}dB mlB(wB B,dB A,bool D){if(B==null)throw new ArgumentError("null key");if(A==null)throw new ArgumentError("null value");var C=jlB[B];if(C==A)return A;if(klB.containsKey(A)){if(!D)throw new ArgumentError("Mapping for ${A} exists");jlB.remove(klB[A]);}klB.remove(C);jlB[B]=A;klB[A]=B;return A;}}Iterable IKB(Iterable<Iterable> A)=>A.expand((B)=>B);class T1 extends yO{int get contentLength=>wL.length;set contentLength(int A){throw new UnsupportedError("Cannot set the contentLength property of " "non-streaming Request objects.");}Encoding nlB;Encoding get encoding{if(olB==null||!olB.parameters.containsKey('charset')){return nlB;}return uHB(olB.parameters['charset']);}set encoding(Encoding A){plB();nlB=A;var B=olB;if(B==null)return;olB=B.wI(parameters:{'charset':A.name});}Uint8List get wL=>qlB;Uint8List qlB;set wL(List<int> A){plB();qlB=U1(A);}String get TD=>encoding.decode(wL);set TD(String B){wL=encoding.encode(B);var A=olB;if(A==null){olB=new OH("text","plain",{'charset':encoding.name});}else if(!A.parameters.containsKey('charset')){olB=A.wI(parameters:{'charset':encoding.name});}}set nPB(Map<String,String> B){var A=olB;if(A==null){olB=new OH("application","x-www-form-urlencoded");}else if(A.mimeType!="application/x-www-form-urlencoded"){throw new StateError('Cannot set the body fields of a Request with ' 'content-type "${A.mimeType}".');}this.TD=sHB(B,encoding:encoding);}T1(String A,Uri B):nlB=UTF8,qlB=new Uint8List(0),super(A,B);cL rq(){super.rq();return new cL.YWB(wL);}OH get olB{var A=headers['content-type'];if(A==null)return null;return new OH.bWB(A);}set olB(OH A){headers['content-type']=A.toString();}void plB(){if(!sq)return;throw new StateError("Can't modify a finalized Request.");}}class gI extends sl{final Uint8List wL;String get TD=>qHB(headers).decode(wL);gI.ZWB(List<int> A,int B,{yO request,Map<String,String> headers: const{},bool isRedirect: false,bool persistentConnection: true,String reasonPhrase}):wL=U1(A),super(B,contentLength:A.length,request:request,headers:headers,isRedirect:isRedirect,persistentConnection:persistentConnection,reasonPhrase:reasonPhrase);static Future<gI> pHB(cT A){return A.stream.toBytes().then((B){return new gI.ZWB(B,A.statusCode,request:A.request,headers:A.headers,isRedirect:A.isRedirect,persistentConnection:A.persistentConnection,reasonPhrase:A.reasonPhrase);});}}Encoding qHB(Map<String,String> A)=>tHB(rHB(A).parameters['charset']);OH rHB(Map<String,String> B){var A=B['content-type'];if(A!=null)return new OH.bWB(A);return new OH("application","octet-stream");}typedef Jn pKB();abstract class In implements Kn{final pKB rlB;final String path;Stream<sH> get jf=>slB.stream;StreamController<sH> slB;Future get hZ=>tlB.future;var tlB=new Completer();In(this.path,this.rlB){var A;var B;slB=new StreamController<sH>.broadcast(onListen:(){A=rlB();B=A.jf.listen(slB.add,onError:slB.addError,onDone:slB.close);A.hZ.then(tlB.complete);},onCancel:(){B.cancel();A.close();tlB=new Completer();},sync:true);}}abstract class Jn implements Kn{}final yM=new RegExp(r'[^()<>@,;:"\\/[\]?={} \t\x00-\x1F\x7F]+');final AIB=new RegExp(r"(?:\r\n)?[ \t]+");final BIB=new RegExp(r'"(?:[^"\x00-\x1F\x7F]|\\.)*"');final CIB=new RegExp(r'\\(.)');final DIB=new RegExp(r'[()<>@,;:"\\/\[\]?={} \t\x00-\x1F\x7F]');final nF=new RegExp("(?:${AIB.pattern})*");List EIB(dK A,C()){var B=[] ;while(A.ZB(",")){A.ZB(nF);}B.add(C());A.ZB(nF);while(A.ZB(",")){A.ZB(nF);if(A.XD(",")||A.JI)continue;B.add(C());A.ZB(nF);}return B;}String wl(dK A,{String name}){if(name==null)name="quoted string";A.LG(BIB,name:name);var B=A.DF[0];return B.substring(1,B.length-1).replaceAllMapped(CIB,(C)=>C[1]);}final PQ=new hu.AWB();class hu extends NL{final int blockSize=16*rS;hu.AWB();ByteConversionSink startChunkedConversion(Sink<SE> A)=>new ByteConversionSink.from(new iu(A));}class iu extends Si{final iB=new Uint32List(5);final Uint32List ulB;iu(Sink<SE> A):ulB=new Uint32List(80),super(A,16){iB[0]=0x67452301;iB[1]=0xEFCDAB89;iB[2]=0x98BADCFE;iB[3]=0x10325476;iB[4]=0xC3D2E1F0;}void Ct(Uint32List J){assert(J.length==16);var H=iB[0];var B=iB[1];var D=iB[2];var G=iB[3];var I=iB[4];for(var A=0;A<80;A++ ){if(A<16){ulB[A]=J[A];}else{ulB[A]=Ti(ulB[A-3]^ulB[A-8]^ulB[A-14]^ulB[A-16],1);}var C=sC(sC(Ti(H,5),I),ulB[A]);if(A<20){C=sC(sC(C,(B&D)|(~B&G)),0x5A827999);}else if(A<40){C=sC(sC(C,(B^D^G)),0x6ED9EBA1);}else if(A<60){C=sC(sC(C,(B&D)|(B&G)|(D&G)),0x8F1BBCDC);}else{C=sC(sC(C,B^D^G),0xCA62C1D6);}I=G;G=D;D=Ti(B,30);B=H;H=C&QQ;}iB[0]=sC(H,iB[0]);iB[1]=sC(B,iB[1]);iB[2]=sC(D,iB[2]);iB[3]=sC(G,iB[3]);iB[4]=sC(I,iB[4]);}}final da=new ju.BWB();class ju extends NL{final int blockSize=16*rS;ju.BWB();ByteConversionSink startChunkedConversion(Sink<SE> A)=>new ByteConversionSink.from(new ku(A));}const List<int> fAB=const[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];class ku extends Si{final iB=new Uint32List(8);final Uint32List vlB;ku(Sink<SE> A):vlB=new Uint32List(64),super(A,16){iB[0]=0x6a09e667;iB[1]=0xbb67ae85;iB[2]=0x3c6ef372;iB[3]=0xa54ff53a;iB[4]=0x510e527f;iB[5]=0x9b05688c;iB[6]=0x1f83d9ab;iB[7]=0x5be0cd19;}int wlB(int A,int B)=>(B>>A)|((B<<(32-A))&QQ);int xlB(int A,int B,int C)=>(A&B)^((~A&QQ)&C);int ylB(int A,int B,int C)=>(A&B)^(A&C)^(B&C);int zlB(int A)=>wlB(2,A)^wlB(13,A)^wlB(22,A);int AmB(int A)=>wlB(6,A)^wlB(11,A)^wlB(25,A);int BmB(int A)=>wlB(7,A)^wlB(18,A)^(A>>3);int CmB(int A)=>wlB(17,A)^wlB(19,A)^(A>>10);void Ct(Uint32List M){assert(M.length==16);for(var A=0;A<16;A++ ){vlB[A]=M[A];}for(var A=16;A<64;A++ ){vlB[A]=sC(sC(CmB(vlB[A-2]),vlB[A-7]),sC(BmB(vlB[A-15]),vlB[A-16]));}var B=iB[0];var D=iB[1];var G=iB[2];var J=iB[3];var C=iB[4];var H=iB[5];var I=iB[6];var K=iB[7];for(var A=0;A<64;A++ ){var N=sC(sC(K,AmB(C)),sC(xlB(C,H,I),sC(fAB[A],vlB[A])));var O=sC(zlB(B),ylB(B,D,G));K=I;I=H;H=C;C=sC(J,N);J=G;G=D;D=B;B=sC(N,O);}iB[0]=sC(B,iB[0]);iB[1]=sC(D,iB[1]);iB[2]=sC(G,iB[2]);iB[3]=sC(J,iB[3]);iB[4]=sC(C,iB[4]);iB[5]=sC(H,iB[5]);iB[6]=sC(I,iB[6]);iB[7]=sC(K,iB[7]);}}abstract class iD implements Comparable<iD>{factory iD(jI A,jI B,String C)=>new ym(A,B,C);}class ym extends R3{final jI start;final jI end;final String text;ym(this.start,this.end,this.text){if(end.XC!=start.XC){throw new ArgumentError("Source URLs \"${start.XC}\" and " " \"${end.XC}\" don't match.");}else if(end.offset<start.offset){throw new ArgumentError('End ${end} must come after start ${start}.');}else if(text.length!=start.bq(end)){throw new ArgumentError('Text "${text}" must be ${start.bq(end)} ' 'characters long.');}}}class Q3 implements Exception{String get message=>DmB;final String DmB;iD get l=>EmB;final iD EmB;Q3(this.DmB,this.EmB);String toString({color}){if(l==null)return message;return "Error on "+l.message(message,color:color);}}class HX extends Q3 implements FormatException{dynamic get source=>FmB;final FmB;int get offset=>l==null?null:l.start.offset;HX(String A,iD B,[this.FmB]):super(A,B);}abstract class R3 implements iD{Uri get XC=>start.XC;int get length=>end.offset-start.offset;int compareTo(iD A){var B=start.compareTo(A.start);return B==0?end.compareTo(A.end):B;}iD union(iD A){if(XC!=A.XC){throw new ArgumentError("Source URLs \"${XC}\" and " " \"${A.XC}\" don't match.");}var D=MKB(this.start,A.start);var G=NKB(this.end,A.end);var B=D==this.start?this:A;var C=G==this.end?this:A;if(B.end.compareTo(C.start)<0){throw new ArgumentError("Spans ${this} and ${A} are disjoint.");}var H=B.text+C.text.substring(B.end.bq(C.start));return new iD(D,G,H);}String message(String C,{color}){var A=new StringBuffer();A.write('line ${start.line+1}, column ${start.column+1}');if(XC!=null)A.write(' of ${g2(XC)}');A.write(': ${C}');var B=this.vRB(color:color);if(!B.isEmpty){A.writeln();A.write(B);}return A.toString();}String vRB({color}){if(color==true)color=JKB;if(color==false)color=null;var C=start.column;var A=new StringBuffer();String B;if(this is zm){var D=(this as zm).context;var G=OKB(D,text,C);if(G!=null&&G>0){A.write(D.substring(0,G));D=D.substring(G);}var J=D.indexOf('\n');B=J==-1?D:D.substring(0,J+1);C=LJ.min(C,B.length);}else if(length==0){return "";}else{B=text.split("\n").first;C=0;}var H=LJ.min(C+end.offset-start.offset,B.length);if(color!=null){A.write(B.substring(0,C));A.write(color);A.write(B.substring(C,H));A.write(P3);A.write(B.substring(H));}else{A.write(B);}if(!B.endsWith('\n'))A.write('\n');for(var I=0;I<C;I++ ){if(B.codeUnitAt(I)==Pu){A.writeCharCode(Pu);}else{A.writeCharCode(MAB);}}if(color!=null)A.write(color);A.write('^'*LJ.max(H-C,1));if(color!=null)A.write(P3);return A.toString();}bool operator==(A)=>A is iD&&start==A.start&&end==A.end;int get hashCode=>start.hashCode+(31*end.hashCode);String toString()=>'<${runtimeType}: from ${start} to ${end} "${text}">';}class pT extends dK implements iKB{final OR GmB;int get line=>GmB.sf(position);int get column=>GmB.Ar(position);GP get state=>new a3(this,position);hD HmB;EP get location=>GmB.location(position);hD get rG=>location.RG();pT(String A,{sourceUrl,int position}):GmB=new OR(A,url:sourceUrl),super(A,sourceUrl:sourceUrl,position:position);factory pT.JYB(String string,{sourceUrl,int position})=An;hD SG(GP B,[GP A]){var C=A==null?position:A.position;return GmB.l(B.position,C);}bool XD(Pattern A){if(!super.XD(A)){HmB=null;return false;}HmB=GmB.l(position,DF.end);return true;}void error(String A,{Match match,int position,int length}){b3(string,match,position,length);if(match==null&&position==null&&length==null)match=DF;if(position==null){position=match==null?this.position:match.start;}if(length==null)length=match==null?1:match.end-match.start;var B=GmB.l(position,position+length);throw new zc(A,B,string);}}class a3 implements GP{final pT ImB;final int position;int get line=>ImB.GmB.sf(position);int get column=>ImB.GmB.Ar(position);a3(this.ImB,this.position);}class zm extends ym{}typedef void bKB(_0,hC _1);class wc{static final V3=new Object();bool get JmB=>Zone.current[V3]==true;final KmB=new Expando<FP>("stack chains");final bKB LmB;FP MmB;wc([this.LmB]);ZoneSpecification mUB(){return new ZoneSpecification(handleUncaughtError:NmB,registerCallback:OmB,registerUnaryCallback:PmB,registerBinaryCallback:QmB,errorCallback:RmB);}hC OQB([int A=0])=>SmB(A+1).qs();hC W7(StackTrace A){if(A is hC)return A;var B=A==null?null:KmB[A];return new FP(A,B).qs();}ZoneCallback OmB(Zone G,ZoneDelegate B,Zone C,Function A){if(A==null||JmB)return B.registerCallback(C,A);var D=SmB(1);return B.registerCallback(C,()=>TmB(A,D));}ZoneUnaryCallback PmB(Zone H,ZoneDelegate B,Zone C,Function A){if(A==null||JmB)return B.registerUnaryCallback(C,A);var D=SmB(1);return B.registerUnaryCallback(C,(G){return TmB(()=>A(G),D);});}ZoneBinaryCallback QmB(Zone I,ZoneDelegate B,Zone C,Function A){if(A==null||JmB)return B.registerBinaryCallback(C,A);var D=SmB(1);return B.registerBinaryCallback(C,(G,H){return TmB(()=>A(G,H),D);});}NmB(Zone J,ZoneDelegate A,Zone B,C,StackTrace G){if(JmB){return A.handleUncaughtError(B,C,G);}var D=W7(G);if(LmB==null){return A.handleUncaughtError(B,C,D);}try {return A.runBinary(B,LmB,C,D);}catch (H,I){if(identical(H,C)){return A.handleUncaughtError(B,C,D);}else{return A.handleUncaughtError(B,H,I);}}}AsyncError RmB(Zone H,ZoneDelegate C,Zone D,Object B,StackTrace A){if(JmB)return C.errorCallback(D,B,A);if(A==null){A=SmB(2).qs();}else{if(KmB[A]==null)KmB[A]=SmB(2);}var G=C.errorCallback(D,B,A);return G==null?new AsyncError(B,A):G;}FP SmB([int A=0])=>new FP(W3(A+1),MmB);TmB(Function B,FP A){var C=MmB;MmB=A;try {return B();}catch (G,D){KmB[D]=A;rethrow;}finally {MmB=C;}}}class FP{final IC s_;final FP previous;FP(StackTrace A,[this.previous]):s_=A==null?W3():new IC.HXB(A);hC qs(){var B=<IC>[] ;var A=this;while(A!=null){B.add(A.s_);A=A.previous;}return new hC(B);}}IC W3([int B]){B??= 0;var D=StackTrace.current;return new oT((){var A=D.toString();var C=A.indexOf(yc);if(C!=-1)A=A.substring(0,C);var G=new IC.IXB(A);return new IC(G.GI.skip(B+(X3?2:1)));});}typedef DateTime qKB(String _0);qKB n3;Future<DateTime> rKB(String A){if(n3!=null){return new Future.value(n3(A));}return FileStat.stat(A).then((B)=>B.modified);}class y$<Y> extends StreamView<Y>{static Stream z$(Stream A)=>A is Stream?A:new FK(A);}class FK<Y> implements Stream<Y>{final Stream UmB;Future<Y> get first async=>(await UmB.first) as Y;Future<Y> get last async=>(await UmB.last) as Y;Future<Y> get single async=>(await UmB.single) as Y;bool get isBroadcast=>UmB.isBroadcast;Future<bool> get isEmpty=>UmB.isEmpty;Future<int> get length=>UmB.length;FK(this.UmB);Stream<Y> asBroadcastStream({void onListen(StreamSubscription<Y> subscription),void onCancel(StreamSubscription<Y> subscription)}){return new FK<Y>(UmB.asBroadcastStream(onListen:onListen==null?null:(A)=>onListen(new Ta<Y>(A)),onCancel:onCancel==null?null:(A)=>onCancel(new Ta<Y>(A))));}Stream asyncExpand(Stream A(Y event))=>UmB.asyncExpand(VmB(A));Stream asyncMap(A(Y event))=>UmB.asyncMap(VmB(A));Stream<Y> distinct([bool A(Y previous,Y next)])=>new FK<Y>(UmB.distinct(A==null?null:(B,C)=>A(B as Y,C as Y)));Future drain([A])=>UmB.drain(A);Stream expand(Iterable A(Y value))=>UmB.expand(VmB(A));Future firstWhere(bool A(Y element),{Object defaultValue()})=>UmB.firstWhere(VmB(A),defaultValue:defaultValue);Future lastWhere(bool A(Y element),{Object defaultValue()})=>UmB.lastWhere(VmB(A),defaultValue:defaultValue);Future<Y> singleWhere(bool A(Y element))async=>(await UmB.singleWhere(VmB(A))) as Y;Future fold(A,B(previous,Y element))=>UmB.fold(A,(C,D)=>B(C,D as Y));Future forEach(void A(Y element))=>UmB.forEach(VmB(A));Stream<Y> handleError(Function A,{bool test(error)})=>new FK<Y>(UmB.handleError(A,test:test));StreamSubscription<Y> listen(void A(Y value),{Function onError,void onDone(),bool cancelOnError})=>new Ta<Y>(UmB.listen(VmB(A),onError:onError,onDone:onDone,cancelOnError:cancelOnError));Stream map(A(Y event))=>UmB.map(VmB(A));Future pipe(StreamConsumer<Y> A)=>A.addStream(this).then((B)=>A.close());Future<Y> reduce(Y A(Y previous,Y element))async{var B=await UmB.reduce((C,D)=>A(C as Y,D as Y));return B as Y;}Stream<Y> skipWhile(bool A(Y element))=>new FK<Y>(UmB.skipWhile(VmB(A)));Stream<Y> takeWhile(bool A(Y element))=>new FK<Y>(UmB.takeWhile(VmB(A)));Stream<Y> timeout(Duration A,{void onTimeout(EventSink<Y> sink)})=>new FK<Y>(UmB.timeout(A,onTimeout:(B)=>onTimeout(uh.x$(B))));Future<List<Y>> toList()async=>Ki.Yu(await UmB.toList());Future<Set<Y>> toSet()async=>Zu.bAB(await UmB.toSet());Stream transform(StreamTransformer<Y,dynamic> A)=>A.bind(this);Stream<Y> where(bool A(Y element))=>new FK<Y>(UmB.where(VmB(A)));Future<bool> every(bool A(Y element))=>UmB.every(VmB(A));Future<bool> any(bool A(Y element))=>UmB.any(VmB(A));Stream<Y> skip(int A)=>new FK<Y>(UmB.skip(A));Stream<Y> take(int A)=>new FK<Y>(UmB.take(A));Future<Y> elementAt(int A)async=>(await UmB.elementAt(A)) as Y;Future<bool> contains(Object A)=>UmB.contains(A);Future<String> join([String A=""])=>UmB.join(A);String toString()=>UmB.toString();CAB VmB(A(Y value))=>A==null?null:(B)=>A(B as Y);}class vh<Y> implements StreamConsumer<Y>{final StreamConsumer WmB;vh.sVB(this.WmB);static StreamConsumer AAB(StreamConsumer A)=>A is StreamConsumer?A:new vh.sVB(A);Future addStream(Stream<Y> A)=>WmB.addStream(A);Future close()=>WmB.close();}class wh<Y> implements Sink<Stream<Y>>{Stream<Y> get stream=>XmB.stream;StreamController<Y> XmB;var YmB=false;var ZmB=XI.Du;final amB=new Map<Stream<Y>,StreamSubscription<Y>>();static Stream BAB(Iterable<Stream> B){var A=new wh();B.forEach(A.add);A.close();return A.stream;}wh(){XmB=new StreamController<Y>(onListen:bmB,onPause:cmB,onResume:dmB,onCancel:emB,sync:true);}Future add(Stream<Y> A){if(YmB){throw new StateError("Can't add a Stream to a closed StreamGroup.");}if(ZmB==XI.Du){amB.putIfAbsent(A,()=>null);}else if(ZmB==XI.Gu){return A.listen(null).cancel();}else{amB.putIfAbsent(A,()=>fmB(A));}return null;}Future remove(Stream<Y> B){var A=amB.remove(B);var C=A==null?null:A.cancel();if(YmB&&amB.isEmpty)XmB.close();return C;}void bmB(){ZmB=XI.Eu;amB.forEach((A,B){if(B!=null)return;amB[A]=fmB(A);});}void cmB(){ZmB=XI.Fu;for(var A in amB.values){A.pause();}}void dmB(){ZmB=XI.Eu;for(var A in amB.values){A.resume();}}Future emB(){ZmB=XI.Gu;var A=amB.values.map((B)=>B.cancel()).where((C)=>C!=null).toList();amB.clear();return A.isEmpty?null:Future.wait(A);}StreamSubscription<Y> fmB(Stream<Y> A){var B=A.listen(XmB.add,onError:XmB.addError,onDone:()=>remove(A));if(ZmB==XI.Fu)B.pause();return B;}Future close(){if(YmB)return XmB.done;YmB=true;if(amB.isEmpty)XmB.close();return XmB.done;}}class XI{static const Du=const XI("dormant");static const Eu=const XI("listening");static const Fu=const XI("paused");static const Gu=const XI("canceled");final String name;const XI(this.name);String toString()=>name;}class Ta<Y> implements StreamSubscription<Y>{final StreamSubscription gmB;bool get isPaused=>gmB.isPaused;Ta(this.gmB);void onData(void A(Y data)){gmB.onData((B)=>A(B as Y));}void onError(Function A){gmB.onError(A);}void onDone(void A()){gmB.onDone(A);}void pause([Future A]){gmB.pause(A);}void resume(){gmB.resume();}Future cancel()=>gmB.cancel();Future asFuture([A])=>gmB.asFuture(A);}class cT extends sl{final cL stream;cT(Stream<List<int>> A,int B,{int contentLength,yO request,Map<String,String> headers: const{},bool isRedirect: false,bool persistentConnection: true,String reasonPhrase}):this.stream=vHB(A),super(B,contentLength:contentLength,request:request,headers:headers,isRedirect:isRedirect,persistentConnection:persistentConnection,reasonPhrase:reasonPhrase);}final jKB=new RegExp("/").pattern=="\\/";class dK{final Uri XC;final String string;int get position=>hmB;set position(int A){if(A<0||A>string.length){throw new ArgumentError("Invalid position ${A}");}hmB=A;}int hmB=0;Match get DF=>imB;Match imB;String get yJ=>string.substring(position);bool get JI=>position==string.length;dK(this.string,{sourceUrl,int position}):XC=sourceUrl is String?Uri.parse(sourceUrl):sourceUrl{if(position!=null)this.position=position;}int oB(){if(JI)jmB("more input");return string.codeUnitAt(hmB++ );}int JC([int A]){if(A==null)A=0;var B=position+A;if(B<0||B>=string.length)return null;return string.codeUnitAt(B);}bool ZB(Pattern B){var A=XD(B);if(A)hmB=imB.end;return A;}void LG(Pattern A,{String name}){if(ZB(A))return;if(name==null){if(A is RegExp){var B=A.pattern;if(!jKB)B=B.replaceAll("/","\\/");name="/${B}/";}else{name=A.toString().replaceAll("\\","\\\\").replaceAll('"','\\"');name='"${name}"';}}jmB(name);}void z7(){if(JI)return;jmB("no more input");}bool XD(Pattern A){imB=A.matchAsPrefix(string,position);return imB!=null;}String substring(int B,[int A]){if(A==null)A=position;return string.substring(B,A);}void error(String A,{Match match,int position,int length}){b3(string,match,position,length);if(match==null&&position==null&&length==null)match=DF;if(position==null){position=match==null?this.position:match.start;}if(length==null)length=match==null?1:match.end-match.start;var B=new OR(string,url:XC);var C=B.l(position,position+length);throw new zc(A,C,string);}void jmB(String A){error("expected ${A}.",position:this.position,length:0);}}abstract class AD{static final AD o2=new p2();static final AD fL=new r2();static final AD HN=new q2();static final AD hm=uJB();static AD uJB(){if(Uri.base.scheme!='file')return AD.HN;if(!Uri.base.path.endsWith('/'))return AD.HN;if(new Uri(path:'a/b').toFilePath()=='a\\b')return AD.fL;return AD.o2;}String get name;AE get context=>new AE(style:this);String get AK;String e8(String A);String cZ(Uri A);Uri Ns(String A);Uri HY(String A);String toString()=>name;}class c3 extends H3{c3():super(new oKB());}class kKB{String encode(Map<String,dynamic> B){var A=new mKB();A.jq(B,name:[] );return A.toString();}}abstract class lKB{}typedef void Bn<dB>(dB _0);class mKB{static final RegExp nKB=new RegExp(r'^[A-Za-z0-9_-]+$');final StringBuffer kmB=new StringBuffer();void Sr(){if(kmB.isNotEmpty)kmB.writeln();}void CSB(List<String> B,{bool array: false}){if(B.isNotEmpty){Sr();Sr();kmB.write(array?'[[':'[');for(int A=0;A<B.length;A++ ){if(A!=0)kmB.write('.');v7(B[A]);}kmB.write(array?']]':']');}}At(A){while(A is lKB)A=A.GYB();return A;}void jq(Map<String,dynamic> H,{List<String> name,bool array: false}){var C={};var D={};H.forEach((B,A){A=At(A);if(A is Map){D[B]=A;return;}if(A is Iterable&&A.length>0){A=A.map(At);if(A.every((G)=>G is Map)){D[B]=A;return;}}C[B]=A;});if(array||C.isNotEmpty){CSB(name,array:array);C.forEach(DSB);}D.forEach((B,A){name.add(B);if(A is Map){jq(A,name:name);}else if(A is Iterable){A.forEach((G){jq(G,name:name,array:true);});}name.removeLast();});}void DSB(String A,B){Sr();v7(A);kmB.write(' = ');w7(B);}void v7(String A){if(nKB.hasMatch(A)){kmB.write(A);}else{u7(A);}}void w7(A){A=At(A);Bn B=kRB(A);if(B==null)throw new En(A);B(A);}Bn kRB(A){if(A is num)return mQB;if(A is bool)return gQB;if(A is DateTime)return hQB;if(A is String)return nQB;if(A is Iterable)return fQB;return null;}void mQB(num A){kmB.write('${A}');}void gQB(bool A){kmB.write(A?'true':'false');}void hQB(DateTime A){kmB.write(A.toIso8601String());}Type MVB(Iterable B){if(B.isEmpty)return null;if(identical(1,1.0)&&B.every((A)=>A is num)&&B.any((A)=>A is int)&&B.any((A)=>A is!int)){return num;}return B.map((A)=>A.runtimeType).reduce((C,D){if(C!=D)throw new Fn(B);return C;});}void fQB(Iterable B){var D=MVB(B);kmB.write('[');for(var A=0;A<B.length;A++ ){var C=B.elementAt(A);if(A!=0)kmB.write(', ');w7(C);if(D==num&&C is int)kmB.write('.0');}kmB.write(']');}Bn<String> iRB(String A){var C=[gJ.eK['"'],gJ.eK['\\']];bool B(String D)=>gJ.eK.values.where((G)=>!C.contains(G)).any(D.codeUnits.contains);if(A.contains('\n')||A.contains('\r')){if(A.split(new RegExp('\n|\r')).any(B)){return kQB;}return lQB;}if(A.contains("'")||B(A)){return u7;}return jQB;}void nQB(String A){var B=iRB(A);B(A);}void lmB(String A,{String quotes,Iterable<int> esc: const[] ,bool multiline: false}){if(esc.isNotEmpty){A=A.codeUnits.map((int B){if(esc.contains(B)){return '\\${gJ.eK.GSB[B]}';}return new String.fromCharCode(B);}).join();}if(multiline){if(quotes=='"""')A=A.replaceAll('"""',r'\"\"\"');}else if(A.contains('\n')||A.contains('\r')){throw new Ad('Newlines are only allowed in multi-line strings!');}if(!esc.contains(quotes.codeUnitAt(0))&&A.contains(quotes)){throw new Ad('"${quotes}" are prohibited in non-basic strings.');}kmB.write(quotes);if(multiline)kmB.writeln();kmB.write(A);kmB.write(quotes);}void u7(String A)=>lmB(A,quotes:'"',esc:gJ.eK.values);void kQB(String B)=>lmB(B,quotes:'"""',esc:gJ.eK.values.where((A)=>A!=gJ.eK['"']&&A!=gJ.eK['n']&&A!=gJ.eK['r']),multiline:true);void jQB(String A)=>lmB(A,quotes:"'");void lQB(String A)=>lmB(A,quotes:"'''",multiline:true);String toString()=>kmB.toString();}class Cn{final String jY;Cn(this.jY);bool operator==(A)=>A is Cn&&A.jY==jY;int get hashCode=>jY.hashCode;String toString()=>'The escape sequence "${jY}" is invalid!';}class Ad{final String msg;Ad(this.msg);bool operator==(A)=>A is Ad&&A.msg==msg;int get hashCode=>msg.hashCode;String toString()=>msg;}class IX{final String name;IX(this.name);bool operator==(A)=>A is IX&&A.name==name;int get hashCode=>name.hashCode;String toString()=>'Cannot redefine "${name}"!';}class Dn{final String name;Dn(this.name);bool operator==(A)=>A is Dn&&A.name==name;int get hashCode=>name.hashCode;String toString()=>'Cannot define table "${name}"! Parent must be a table!';}class En{final value;En(this.value);bool operator==(A)=>A is En&&A.value==value;int get hashCode=>value.hashCode;String toString()=>'"${value}" cannot be encoded as a TOMl value!';}class Fn{final Iterable YB;Fn(this.YB);bool operator==(A)=>A is Fn&&A.YB==YB;int get hashCode=>YB.hashCode;String toString()=>'The items of "${YB}" must all be of the same type!';}class gJ extends qm{static final nT<String,int> eK=new nT()..addAll({'b':0x08,'t':0x09,'n':0x0A,'f':0x0C,'r':0x0D,'"':0x22,r'\':0x5C});start()=>GB(dq).end();token(A,[bool C=false,bool B]){if(B==null)B=C;if(A is Function)A=GB(A);var D=GB(mP,C);var G=GB(mP,B);return A.uq().trim(D,G);}mP([bool A=false])=>A?GB(mP)|GB(yN):GB(Gt)|GB(wK);Gt()=>TC(' ')|TC('\t');yN()=>TC('\n')|TC('\r')&TC('\n');wK()=>TC('#')&GB(yN).qr().RM();value()=>GB(Vf)|GB(lf)|GB(xf)|GB(If)|GB(h_)|GB(YB)|GB(wf);DB mmB({DB quotes,DB esc,bool multiline: false}){var A=quotes;if(multiline)A=(A&GB(s7).KM()).FO(0);var C=quotes;if(!multiline)C|= GB(yN);var B=C.qr();if(esc!=null)B=esc|B;return (A&B.RM()&quotes).trim(GB(mP)).FO(1).map((List D)=>D.join());}h_()=>GB(tSB)|GB(O7)|GB(vSB)|GB(YSB);O7()=>mmB(quotes:TC('"'),esc:GB(hf));hf()=>TC('\\')&(GB(ys)|GB(es));ys()=>TC('u')&GB(m8).Hh(4).uq()|TC('U')&GB(m8).Hh(8).uq();es()=>DP();m8()=>I3('0-9a-fA-F');tSB()=>mmB(quotes:DX('"""'),esc:GB(uSB),multiline:true);uSB()=>GB(Ht)|GB(hf);Ht()=>TC('\\')&GB(s7).dg()&GB(Gt).RM();s7()=>GB(Gt).RM()&GB(yN);YSB()=>mmB(quotes:DX("'"));vSB()=>mmB(quotes:DX("'''"),multiline:true);xf()=>GB(token,nmB);nmB()=>nm('+-').KM()&(TC('0')|GB(n7));n7()=>oc().dg().qZ(TC('_'));lf()=>GB(token,omB);omB()=>GB(nmB)&(GB(PRB)&GB(A8).KM()|GB(A8));PRB()=>TC('.')&GB(n7);A8()=>nm('eE')&GB(nmB);If()=>GB(token,pmB);pmB()=>DX('true')|DX('false');Vf()=>GB(token,qmB);qmB()=>GB(QRB)&TC('T')&GB(RRB);QRB()=>GB(RQB)&TC('-')&GB(uR)&TC('-')&GB(uR);RRB()=>GB(mTB)&GB(kUB);mTB()=>GB(uR)&TC(':')&GB(uR)&TC(':')&GB(uR)&(TC('.')&oc().ig(1,6)).KM();kUB()=>TC('Z')|GB(jUB);jUB()=>nm('+-')&GB(uR)&TC(':')&GB(uR);uR()=>oc().Hh(2);RQB()=>oc().Hh(4);YB()=>iN(Vf)|iN(lf)|iN(xf)|iN(If)|iN(h_)|iN(YB)|iN(wf);iN(A)=>GB(token,TC('['),false,true)&GB(A).qZ(GB(token,TC(','),true),optionalSeparatorAtEnd:true,includeSeparators:false).KM([] )&GB(token,TC(']'),true,false);XS()=>GB(Dh).trim(GB(mP,true))&GB(Yr);Dh()=>TC('[')&GB(iUB)&TC(']');ms()=>GB(ns).trim(GB(mP,true))&GB(Yr);ns()=>TC('[')&GB(Dh)&TC(']');wf()=>GB(token,TC('{'))&GB(Fg).qZ(token(TC(',')),optionalSeparatorAtEnd:false,includeSeparators:false).KM([] )&GB(token,TC('}'));key()=>GB(token,iPB)|GB(tTB);iPB()=>I3('A-Za-z0-9_-').dg();tTB()=>GB(O7);iUB()=>GB(key).qZ(TC('.'),includeSeparators:false);Fg()=>GB(key)&TC('=')&GB(value);Yr()=>GB(Fg).qZ(GB(yN)&GB(mP,true).RM(),includeSeparators:false,optionalSeparatorAtEnd:true).KM([] );dq()=>GB(mP,true).RM()&GB(Yr)&(GB(XS)|GB(ms)).RM();}class oKB extends gJ{hf()=>super.hf().FO(1);es()=>super.es().map((String A){if(gJ.eK.containsKey(A)){return new String.fromCharCode(gJ.eK[A]);}throw new Cn('\\${A}');});ys()=>super.ys().FO(1).map((A)=>new String.fromCharCode(int.parse(A,radix:16)));Ht()=>super.Ht().map((A)=>'');xf()=>super.xf().map((A)=>int.parse(A.replaceAll('_','')));lf()=>super.lf().map((A)=>double.parse(A.replaceAll('_','')));If()=>super.If().map((A)=>A=='true');Vf()=>super.Vf().map(DateTime.parse);iN(A)=>super.iN(A).FO(1);XS()=>super.XS().map((List A)=>{'type':'table','parent':A[0].sublist(0,A[0].length-1),'name':A[0].last,'pairs':A[1]});Dh()=>super.Dh().FO(1);ms()=>super.ms().map((List A)=>{'type':'table-array','parent':A[0].sublist(0,A[0].length-1),'name':A[0].last,'pairs':A[1]});ns()=>super.ns().FO(1);wf()=>super.wf().FO(1).map((List C){var A={};C.forEach((Map B){A[B['key']]=B['value'];});return A;});Fg()=>super.Fg().nTB([0,2]).map((List A)=>{'key':A[0],'value':A[1]});dq()=>super.dq().map((List O){var I={};var Q=new Set();void J(String A){if(Q.contains(A))throw new IX(A);Q.add(A);}Function S(Map V,[String b])=>(Map G){var A=b==null?G['key']:'${b}.${G['key']}';J(A);if(V.containsKey(G['key']))throw new IX(A);V[G['key']]=G['value'];};O[1].forEach(S(I));O[2].forEach((Map C){var B=I;var A=[] ;C['parent'].forEach((String H){B=B.putIfAbsent(H,()=>{});if(B is List){H='${H}[${B.length-1}]';B=B.last;}A.add(H);if(B is!Map)throw new Dn(A.join('.'));});A.add(C['name']);A=A.join('.');var K;if(C['type']=='table-array'){var M=B.putIfAbsent(C['name'],(){J(A);return [] ;});if(M is Map)throw new IX(A);var h=M.length;M.add(K={});A='${A}[${h}]';}else{K=B.putIfAbsent(C['name'],()=>{});}J(A);C['pairs'].forEach(S(K,A));});N(D){if(D is Map){return new UnmodifiableMapView(new Map.fromIterables(D.keys,D.values.map(N)));}if(D is List){return new UnmodifiableListView(D.map(N));}return D;}return N(I);});}final cKB=new RegExp(r"(-patch)?([/\\].*)?$");final dKB=new RegExp(r"\n    ?at ");final eKB=new RegExp(r"    ?at ");final fKB=new RegExp(r"^" r"(" r"([.0-9A-Za-z_$/<]|\(.*\))*" r"@" r")?" r"[^\s]*" r":\d*" r"$",multiLine:true);final gKB=new RegExp(r"^[^\s<][^\s]*( \d+(:\d+)?)?[ \t]+[^\s]+$",multiLine:true);class IC implements StackTrace{final List<uC> GI;factory IC.HXB(StackTrace A){if(A==null){throw new ArgumentError("Cannot create a Trace from null.");}if(A is IC)return A;if(A is hC)return A.Lh();return new oT(()=>new IC.IXB(A.toString()));}factory IC.IXB(String A){try {if(A.isEmpty)return new IC(<uC>[] );if(A.contains(dKB))return new IC.KXB(A);if(A.contains("\tat "))return new IC.LXB(A);if(A.contains(fKB)){return new IC.MXB(A);}if(A.contains(xc))return new hC.CXB(A).Lh();if(A.contains(gKB)){return new IC.NXB(A);}return new IC.JXB(A);}on FormatException catch (B){throw new FormatException('${B.message}\nStack trace:\n${A}');}}IC.JXB(String A):this(hKB(A));static List<uC> hKB(String C){var A=C.trim().replaceAll(yc,'').split("\n");var B=A.take(A.length-1).map((D)=>new uC.DXB(D)).toList();if(!A.last.endsWith(".da")){B.add(new uC.DXB(A.last));}return B;}IC.KXB(String B):this(B.split("\n").skip(1).skipWhile((A)=>!A.startsWith(eKB)).map((A)=>new uC.EXB(A)));IC.LXB(String B):this(B.split("\n").where((A)=>A!="\tat ").map((A)=>new uC.EXB(A)));IC.MXB(String B):this(B.trim().split("\n").where((A)=>A.isNotEmpty&&A!='[native code]').map((A)=>new uC.FXB(A)));IC.NXB(String B):this(B.isEmpty?[] :B.trim().split("\n").where((A)=>!A.startsWith('=====')).map((A)=>new uC.GXB(A)));IC(Iterable<uC> A):GI=new List<uC>.unmodifiable(A);IC get YS=>jP((A)=>false,terse:true);IC jP(bool C(uC frame),{bool terse: false}){if(terse){var D=C;C=(A){if(D(A))return true;if(A.t8)return true;if(A.r9=='stack_trace')return true;if(!A.HM.contains('<async>'))return false;return A.line==null;};}var B=<uC>[] ;for(var A in GI.reversed){if(A is JN||!C(A)){B.add(A);}else if(B.isEmpty||!C(B.last)){B.add(new uC(A.uri,A.line,A.column,A.HM));}}if(terse){B=B.map((A){if(A is JN||!C(A))return A;var G=A.EZ.replaceAll(cKB,'');return new uC(Uri.parse(G),null,null,A.HM);}).toList();if(B.length>1&&C(B.first)){B.removeAt(0);}}return new IC(B.reversed);}String toString(){var B=GI.map((A)=>A.location.length).fold(0,LJ.max);return GI.map((A){if(A is JN)return "${A}\n";return '${A.location.padRight(B)}  ${A.HM}\n';}).join();}}abstract class Gn<R> extends ListBase<R>{static const int d3=8;List<R> rmB;TypedData get smB=>rmB as TypedData;int tmB;Gn(List<R> A):this.rmB=A,this.tmB=A.length;int get length=>tmB;R operator[](int A){if(A>=length)throw new RangeError.index(A,this);return rmB[A];}void operator[]=(int A,R B){if(A>=length)throw new RangeError.index(A,this);rmB[A]=B;}void set length(int A){if(A<tmB){R D=umB;for(int C=A;C<tmB;C++ ){rmB[C]=D;}}else if(A>rmB.length){List<R> B;if(rmB.length==0){B=vmB(A);}else{B=wmB(A);}B.setRange(0,tmB,rmB);rmB=B;}tmB=A;}void xmB(R A){if(tmB==rmB.length)ymB(tmB);rmB[tmB++ ]=A;}void add(R A){xmB(A);}void addAll(Iterable<R> C,[int A=0,int B]){RangeError.checkNotNegative(A,"start");if(B!=null&&A>B){throw new RangeError.range(B,A,null,"end");}zmB(C,A,B);}void insertAll(int D,Iterable<R> G,[int B=0,int A]){RangeError.checkValidIndex(D,this,"index",tmB+1);RangeError.checkNotNegative(B,"start");if(A!=null){if(B>A){throw new RangeError.range(A,B,null,"end");}if(B==A)return;}if(D==tmB){zmB(G,B,A);return;}if(A==null&&G is List){A=G.length;}if(A!=null){AnB(D,G,B,A);return;}var C=tmB;var H=B;for(var I in G){if(H>0){H-- ;continue;}if(C==rmB.length){ymB(C);}rmB[C++ ]=I;}if(H>0){throw new StateError("Too few elements");}if(A!=null&&C<A){throw new RangeError.range(A,B,C,"end");}Hn(rmB,D,tmB);Hn(rmB,tmB,C);Hn(rmB,D,C);tmB=C;return;}static void Hn(List B,int C,int A){A-- ;while(C<A){var D=B[C];var G=B[A];B[A]=D;B[C]=G;C++ ;A-- ;}}void zmB(Iterable<R> A,[int B=0,int C]){if(A is List)C??= A.length;if(C!=null){AnB(tmB,A,B,C);return;}var D=0;for(var G in A){if(D>=B)add(G);D++ ;}if(D<B)throw new StateError("Too few elements");}void AnB(int B,Iterable<R> A,int G,int C){if(A is List){C??= A.length;if(G>A.length||C>A.length){throw new StateError("Too few elements");}}else{assert(C!=null);}var D=C-G;var H=tmB+D;BnB(H);rmB.setRange(B+D,tmB+D,rmB,B);rmB.setRange(B,B+D,A,G);tmB=H;}void insert(int A,R C){if(A<0||A>tmB){throw new RangeError.range(A,0,tmB);}if(tmB<rmB.length){rmB.setRange(A+1,tmB+1,rmB,A);rmB[A]=C;tmB++ ;return;}List<R> B=wmB(null);B.setRange(0,A,rmB);B.setRange(A+1,tmB+1,rmB,A);B[A]=C;tmB++ ;rmB=B;}void BnB(int A){if(A<=rmB.length)return;var B=wmB(A);B.setRange(0,tmB,rmB);rmB=B;}List<R> wmB(int B){int A=rmB.length*2;if(B!=null&&A<B){A=B;}else if(A<d3){A=d3;}return vmB(A);}void ymB(int A){rmB=wmB(null)..setRange(0,A,rmB);}void setRange(int B,int A,Iterable<R> C,[int D=0]){if(A>tmB)throw new RangeError.range(A,0,tmB);CnB(B,A,C,D);}void CnB(int B,int C,Iterable<R> A,int D){if(A is Gn<R>){rmB.setRange(B,C,A.rmB,D);}else{rmB.setRange(B,C,A,D);}}int get elementSizeInBytes=>smB.elementSizeInBytes;int get lengthInBytes=>tmB*smB.elementSizeInBytes;int get offsetInBytes=>smB.offsetInBytes;ByteBuffer get buffer=>smB.buffer;R get umB;List<R> vmB(int A);}abstract class e3 extends Gn<int>{e3(List<int> A):super(A);int get umB=>0;}class f3 extends e3{f3([int A=0]):super(new Uint8List(A));Uint8List vmB(int A)=>new Uint8List(A);}typedef MN YAB<R,MN>(R _0);abstract class Xu<R> implements Iterable<R>{Iterable get DnB;Xu();bool any(bool A(R element))=>DnB.any(EnB(A));bool contains(Object A)=>DnB.contains(A);R elementAt(int A)=>DnB.elementAt(A) as R;bool every(bool A(R element))=>DnB.every(EnB(A));Iterable expand(Iterable A(R element))=>DnB.expand(EnB(A));R get first=>DnB.first as R;R firstWhere(bool A(R element),{R orElse()})=>DnB.firstWhere(EnB(A),orElse:orElse) as R;fold(A,B(previousValue,R element))=>DnB.fold(A,(C,D)=>B(C,D as R));void forEach(void A(R element))=>DnB.forEach(EnB(A));bool get isEmpty=>DnB.isEmpty;bool get isNotEmpty=>DnB.isNotEmpty;Iterator<R> get iterator=>DnB.map((A)=>A as R).iterator;String join([String A=""])=>DnB.join(A);R get last=>DnB.last as R;R lastWhere(bool A(R element),{R orElse()})=>DnB.lastWhere(EnB(A),orElse:orElse) as R;int get length=>DnB.length;Iterable map(A(R element))=>DnB.map(EnB(A));R reduce(R A(R value,R element))=>DnB.reduce((B,C)=>A(B as R,C as R)) as R;R get single=>DnB.single as R;R singleWhere(bool A(R element))=>DnB.singleWhere(EnB(A)) as R;Iterable<R> skip(int A)=>new OJ<R>(DnB.skip(A));Iterable<R> skipWhile(bool A(R value))=>new OJ<R>(DnB.skipWhile(EnB(A)));Iterable<R> take(int A)=>new OJ<R>(DnB.take(A));Iterable<R> takeWhile(bool A(R value))=>new OJ<R>(DnB.takeWhile(EnB(A)));List<R> toList({bool growable: true})=>new ba<R>(DnB.toList(growable:growable));Set<R> toSet()=>new qS<R>(DnB.toSet());Iterable<R> where(bool A(R element))=>new OJ<R>(DnB.where(EnB(A)));String toString()=>DnB.toString();YAB EnB(A(R value))=>(B)=>A(B as R);}class OJ<R> extends Xu<R> implements Ji<R>{final Iterable DnB;OJ(Iterable A):DnB=A;}class ba<R> extends OJ<R> implements Ki<R>{ba(List A):super(A);List get FnB=>DnB;R operator[](int A)=>FnB[A] as R;void operator[]=(int A,R B){FnB[A]=B;}void add(R A){FnB.add(A);}void addAll(Iterable<R> A){FnB.addAll(A);}Map<int,R> asMap()=>new Ii<int,R>(FnB.asMap());void clear(){FnB.clear();}void fillRange(int A,int B,[R C]){FnB.fillRange(A,B,C);}Iterable<R> getRange(int A,int B)=>new OJ<R>(FnB.getRange(A,B));int indexOf(R A,[int B=0])=>FnB.indexOf(A,B);void insert(int A,R B){FnB.insert(A,B);}void insertAll(int A,Iterable<R> B){FnB.insertAll(A,B);}int lastIndexOf(R A,[int B])=>FnB.lastIndexOf(A,B);void set length(int A){FnB.length=A;}bool remove(Object A)=>FnB.remove(A);R removeAt(int A)=>FnB.removeAt(A) as R;R removeLast()=>FnB.removeLast() as R;void removeRange(int A,int B){FnB.removeRange(A,B);}void removeWhere(bool A(R element)){FnB.removeWhere(EnB(A));}void replaceRange(int A,int B,Iterable<R> C){FnB.replaceRange(A,B,C);}void retainWhere(bool A(R element)){FnB.retainWhere(EnB(A));}Iterable<R> get reversed=>new OJ<R>(FnB.reversed);void setAll(int A,Iterable<R> B){FnB.setAll(A,B);}void setRange(int A,int B,Iterable<R> C,[int D=0]){FnB.setRange(A,B,C,D);}void shuffle([Random A]){FnB.shuffle(A);}void sort([int A(R a,R b)]){if(A==null){FnB.sort();}else{FnB.sort((B,C)=>A(B as R,C as R));}}List<R> sublist(int A,[int B])=>new ba<R>(FnB.sublist(A,B));}class qS<R> extends OJ<R> implements Zu<R>{qS(Set A):super(A);Set get GnB=>DnB;bool add(R A)=>GnB.add(A);void addAll(Iterable<R> A){GnB.addAll(A);}void clear(){GnB.clear();}bool containsAll(Iterable<Object> A)=>GnB.containsAll(A);Set<R> difference(Set<R> A)=>new qS<R>(GnB.difference(A));Set<R> intersection(Set<Object> A)=>new qS<R>(GnB.intersection(A));R lookup(Object A)=>GnB.lookup(A) as R;bool remove(Object A)=>GnB.remove(A);void removeAll(Iterable<Object> A){GnB.removeAll(A);}void removeWhere(bool A(R element)){GnB.removeWhere(EnB(A));}void retainAll(Iterable<Object> A){GnB.retainAll(A);}void retainWhere(bool A(R element)){GnB.retainWhere(EnB(A));}Set<R> union(Set<R> A)=>new qS<R>(GnB.union(A));}class Ii<wB,dB> implements Li<wB,dB>{final Map DnB;Ii(Map A):DnB=A;dB operator[](Object A)=>DnB[A] as dB;void operator[]=(wB A,dB B){DnB[A]=B;}void addAll(Map<wB,dB> A){DnB.addAll(A);}void clear(){DnB.clear();}bool containsKey(Object A)=>DnB.containsKey(A);bool containsValue(Object A)=>DnB.containsValue(A);void forEach(void A(wB key,dB value)){DnB.forEach((B,C)=>A(B as wB,C as dB));}bool get isEmpty=>DnB.isEmpty;bool get isNotEmpty=>DnB.isNotEmpty;Iterable<wB> get keys=>new OJ<wB>(DnB.keys);int get length=>DnB.length;dB putIfAbsent(wB A,dB B())=>DnB.putIfAbsent(A,B) as dB;dB remove(Object A)=>DnB.remove(A) as dB;Iterable<dB> get values=>new OJ<dB>(DnB.values);String toString()=>DnB.toString();}abstract class ZAB<wB,dB> implements Map<wB,dB>{static fV(){throw new UnsupportedError("Cannot modify an unmodifiable Map");}void operator[]=(wB A,dB B)=>fV();dB putIfAbsent(wB A,dB B())=>fV();void addAll(Map<wB,dB> A)=>fV();dB remove(Object A)=>fV();void clear()=>fV();}class JN implements uC{final Uri uri=new Uri(path:"unparsed");final int line=null;final int column=null;final bool t8=false;final String EZ="unparsed";final String r9=null;final String location="unparsed";final String HM;JN(this.HM);String toString()=>HM;}class q2 extends FN{q2();final name='url';final AK='/';final EF=const['/'];final T_=new RegExp(r'/');final Z9=new RegExp(r"(^[a-zA-Z][-+.a-zA-Z\d]*://|[^/])$");final O_=new RegExp(r"[a-zA-Z][-+.a-zA-Z\d]*://[^/]*");final H_=new RegExp(r"^/");bool Rf(String A)=>A.contains('/');bool VC(int A)=>A==fJ;bool CV(String A){if(A.isEmpty)return false;if(!VC(A.codeUnitAt(A.length-1)))return true;return A.endsWith("://")&&AL(A)==A.length;}int AL(String A,{bool withDrive: false}){if(A.isEmpty)return 0;if(VC(A.codeUnitAt(0)))return 1;for(var C=0;C<A.length;C++ ){var D=A.codeUnitAt(C);if(VC(D))return 0;if(D==dm){if(C==0)return 0;if(A.startsWith('//',C+1))C+= 3;var B=A.indexOf('/',C);if(B<=0)return A.length;if(!withDrive||A.length<B+3)return B;if(!A.startsWith('file://'))return B;if(!t2(A,B+1))return B;return A.length==B+3?B+3:B+4;}}return 0;}bool oF(String A)=>A.isNotEmpty&&VC(A.codeUnitAt(0));String cZ(Uri A)=>A.toString();Uri Ns(String A)=>Uri.parse(A);Uri HY(String A)=>Uri.parse(A);}class pt{static const aV=3;final List yr;StringBuffer buffer;int eP=0;List<int> Pf;int Ng=0;int PZ=0;pt(this.yr);String N8(){buffer=new StringBuffer();rPB();for(var B in yr){if(B is String){if(buffer.isNotEmpty)buffer.write("\n\n");buffer.write(B);PZ=1;continue;}var A=B as sF;if(A.hide)continue;write(0,P8(A));write(1,Z8(A));if(A.Nr!=null)write(2,A.Nr);if(A.ZU!=null){var C=A.ZU.keys.toList(growable:false);C.sort();yN();for(var D in C){write(1,Q8(D));write(2,A.ZU[D]);}yN();}else if(A.RY!=null){write(2,oPB(A));}else if(A.defaultValue!=null){if(A.rN&&A.defaultValue==true){write(2,'(defaults to on)');}else if(!A.rN){write(2,'(defaults to "${A.defaultValue}")');}}if(Ng>1)yN();}return buffer.toString();}String P8(sF A){if(A.XP!=null){return '-${A.XP}, ';}else{return '';}}String Z8(sF A){var B;if(A.negatable){B='--[no-]${A.name}';}else{B='--${A.name}';}if(A.Ft!=null)B+= "=<${A.Ft}>";return B;}String Q8(String A){return '      [${A}]';}void rPB(){int C=0;int A=0;for(var B in yr){if(B is!sF)continue;if(B.hide)continue;C=LJ.max(C,P8(B).length);A=LJ.max(A,Z8(B).length);if(B.ZU!=null){for(var D in B.ZU.keys){A=LJ.max(A,Q8(D).length);}}}A+= 4;Pf=[C,A];}void yN(){PZ++ ;eP=0;Ng=0;}void write(int B,String C){var A=C.split('\n');while(A.length>0&&A[0].trim()==''){A.removeRange(0,1);}while(A.length>0&&A[A.length-1].trim()==''){A.removeLast();}for(var D in A){SVB(B,D);}}void SVB(int A,String B){while(PZ>0){buffer.write('\n');PZ-- ;}while(eP!=A){if(eP<aV-1){buffer.write(qt('',Pf[eP]));}else{buffer.write('\n');}eP=(eP+1)%aV;}if(A<Pf.length){buffer.write(qt(B,Pf[A]));}else{buffer.write(B);}eP=(eP+1)%aV;if(A==aV-1)PZ++ ;if(A==aV-1){Ng++ ;}else{Ng=0;}}String oPB(sF B){var A=new StringBuffer();A.write('[');bool C=true;for(var D in B.RY){if(!C)A.write(', ');A.write(D);if(D==B.defaultValue){A.write(' (default)');}C=false;}A.write(']');return A.toString();}}String qt(String B,int C){final A=new StringBuffer();A.write(B);while(A.length<C){A.write(' ');}return A.toString();}oIB(String A){if(A==null)return null;var D=new StringBuffer();int B=0;int G=A.length;do{int C=B+76;if(C>G)C=G;D.write(A.substring(B,C));D.write('\r\n');B=C;}while(B<A.length);return D.toString();}String pIB(String A){if(A==null)return '';return A.replaceAll(new RegExp('(\\r|\\n|\\t)+',caseSensitive:false),'');}typedef MN CAB<R,MN>(R _0);class ca<R,MN>{R first;MN last;ca(this.first,this.last);}const QQ=0xFFFFFFFF;const gAB=8;const rS=4;int sC(int A,int B)=>(A+B)&QQ;int Ti(int A,int C){var B=C&31;return ((A<<B)&QQ)|((A&QQ)>>(32-B));}String sHB(Map<String,String> C,{Encoding encoding}){var A=<List<String>>[] ;C.forEach((D,G)=>A.add([Uri.encodeQueryComponent(D,encoding:encoding),Uri.encodeQueryComponent(G,encoding:encoding)]));return A.map((B)=>"${B[0]}=${B[1]}").join("&");}Encoding tHB(String A,[Encoding B=LATIN1]){if(A==null)return B;var C=Encoding.getByName(A);return C==null?B:C;}Encoding uHB(String A){var B=Encoding.getByName(A);if(B!=null)return B;throw new FormatException('Unsupported encoding "${A}".');}Uint8List U1(List<int> A){if(A is Uint8List)return A;if(A is TypedData){return new Uint8List.view((A as TypedData).buffer);}return new Uint8List.fromList(A);}cL vHB(Stream<List<int>> A){if(A is cL)return A;return new cL(A);}W1(String B,String C,D()){try {return D();}on HX catch (A){throw new HX('Invalid ${B}: ${A.message}',A.l,A.source);}on FormatException catch (A){throw new FormatException('Invalid ${B} "${C}": ${A.message}',A.source,A.offset);}}Uri hJB(Uri A,Map<String,String> B)=>A.replace(queryParameters:new Map.from(A.queryParameters)..addAll(B));String Z2(String A,String B){var C=Uri.encodeFull(A)+":"+Uri.encodeFull(B);return "Basic "+BASE64.encode(ASCII.encode(C));}DateTime kc(int A)=>new DateTime.fromMillisecondsSinceEpoch(A*1000);bool s2(int A)=>(A>=h2&&A<=i2)||(A>=j2&&A<=k2);bool t2(String A,int B){if(A.length<B+2)return false;if(!s2(A.codeUnitAt(B)))return false;if(A.codeUnitAt(B+1)!=dm)return false;if(A.length==B+2)return true;return A.codeUnitAt(B+2)==fJ;}bool GKB(yB A,yB B){if(A.max!=B.min)return false;return (A.VD&&!B.WD)||(!A.VD&&B.WD);}bool L3(yB B,yB A){if(B.min==null)return A.min!=null;if(A.min==null)return false;var C=B.min.compareTo(A.min);if(C==-1)return true;if(C==1)return false;return B.WD&&!A.WD;}bool pc(yB B,yB A){if(B.max==null)return A.max!=null;if(A.max==null)return false;var C=B.max.compareTo(A.max);if(C==1)return true;if(C==-1)return false;return B.VD&&!A.VD;}bool qc(yB A,yB B){if(A.max==null||B.min==null)return false;var C=A.max.compareTo(B.min);if(C==-1)return true;if(C==1)return false;return !A.VD||!B.WD;}bool wm(yB A,yB B)=>qc(B,A);bool M3(UC A,UC B)=>A.pE==B.pE&&A.cE==B.cE&&A.patch==B.patch;Comparable MKB(Comparable A,Comparable B)=>A.compareTo(B)>0?B:A;Comparable NKB(Comparable A,Comparable B)=>A.compareTo(B)>0?A:B;int OKB(String B,String C,int D){var I=C=='';var A=B.indexOf(C);while(A!=-1){var G=B.lastIndexOf('\n',A)+1;var H=A-G;if(D==H||(I&&D==H+1)){return G;}A=B.indexOf(C,A+1);}return null;}const xc='===== asynchronous gap ===========================\n';const yc='<asynchronous suspension>\n';final bool X3=0.0 is int;void b3(String C,Match D,int A,int B){if(D!=null&&(A!=null||B!=null)){throw new ArgumentError("Can't pass both match and position/length.");}if(A!=null){if(A<0){throw new RangeError("position must be greater than or equal to 0.");}else if(A>C.length){throw new RangeError("position must be less than or equal to the " "string length.");}}if(B!=null&&B<0){throw new RangeError("length must be greater than or equal to 0.");}if(A!=null&&B!=null&&A+B>C.length){throw new RangeError("position plus length must not go beyond the end of " "the string.");}}class sKB<Y> implements StreamTransformer<Y,List<Y>>{Stream<List<Y>> bind(Stream<Y> C){var A=new Queue<Y>();return new StreamTransformer<Y,List<Y>>.fromHandlers(handleData:(D,B){A.add(D);Timer.run((){if(A.isEmpty)return;B.add(A.toList());A.clear();});},handleDone:(B){if(A.isNotEmpty){B.add(A.toList());A.clear();}B.close();}).bind(C);}}final rc=const dV();class UC implements NC,yB{final int pE;final int cE;final int patch;final List GO;final List CI;final String HnB;UC get min=>this;UC get max=>this;bool get WD=>true;bool get VD=>true;UC.sWB(this.pE,this.cE,this.patch,String A,String B,this.HnB):GO=A==null?[] :N3(A),CI=B==null?[] :N3(B){if(pE<0)throw new ArgumentError('Major version must be non-negative.');if(cE<0)throw new ArgumentError('Minor version must be non-negative.');if(patch<0)throw new ArgumentError('Patch version must be non-negative.');}factory UC(int B,int C,int D,{String pre,String build}){var A="${B}.${C}.${D}";if(pre!=null)A+= "-${pre}";if(build!=null)A+= "+${build}";return new UC.sWB(B,C,D,pre,build,A);}factory UC.tWB(String B){final A=FKB.firstMatch(B);if(A==null){throw new FormatException('Could not parse "${B}".');}try {int C=int.parse(A[1]);int D=int.parse(A[2]);int G=int.parse(A[3]);String H=A[5];String I=A[8];return new UC.sWB(C,D,G,H,I,B);}on FormatException {throw new FormatException('Could not parse "${B}".');}}static List N3(String B){return B.split('.').map((A){try {return int.parse(A);}on FormatException {return A;}}).toList();}bool operator==(A){if(A is!UC)return false;return pE==A.pE&&cE==A.cE&&patch==A.patch&&rc.LE(GO,A.GO)&&rc.LE(CI,A.CI);}int get hashCode=>pE^cE^patch^rc.hash(GO)^rc.hash(CI);bool operator<(UC A)=>compareTo(A)<0;bool operator>(UC A)=>compareTo(A)>0;bool operator<=(UC A)=>compareTo(A)<=0;bool operator>=(UC A)=>compareTo(A)>=0;bool get Ag=>false;bool get isEmpty=>false;bool get nP=>GO.isNotEmpty;UC get sQB=>new UC(pE,cE,patch,pre:"0");bool get KSB=>GO.length==1&&GO.first==0;bool vL(UC A)=>this==A;bool aP(NC A)=>A.vL(this);NC union(NC A){if(A.vL(this))return A;if(A is yB){if(A.min==this){return new yB(min:A.min,max:A.max,includeMin:true,includeMax:A.VD,alwaysIncludeMaxPreRelease:true);}if(A.max==this){return new yB(min:A.min,max:A.max,includeMin:A.WD,includeMax:true,alwaysIncludeMaxPreRelease:true);}}return new NC.uWB([this,A]);}NC difference(NC A)=>A.vL(this)?NC.GX:this;int compareTo(yB A){if(A is UC){if(pE!=A.pE)return pE.compareTo(A.pE);if(cE!=A.cE)return cE.compareTo(A.cE);if(patch!=A.patch)return patch.compareTo(A.patch);if(!nP&&A.nP)return 1;if(!A.nP&&nP)return -1;var B=InB(GO,A.GO);if(B!=0)return B;if(CI.isEmpty&&A.CI.isNotEmpty)return -1;if(A.CI.isEmpty&&CI.isNotEmpty)return 1;return InB(CI,A.CI);}else{return -A.compareTo(this);}}String toString()=>HnB;int InB(List D,List G){for(var A=0;A<LJ.max(D.length,G.length);A++ ){var C=(A<D.length)?D[A]:null;var B=(A<G.length)?G[A]:null;if(C==B)continue;if(C==null)return -1;if(B==null)return 1;if(C is num){if(B is num){return C.compareTo(B);}else{return -1;}}else{if(B is num){return 1;}else{return C.compareTo(B);}}}return 0;}}abstract class NC{static NC HKB=new yB();static NC GX=const O3();factory NC.uWB(Iterable<NC> D){var C=D.expand((A){if(A.isEmpty)return [] ;if(A is iI)return A.ZD;return [A];}).toList();if(C.isEmpty)return NC.GX;if(C.any((A)=>A.Ag)){return NC.HKB;}for(var A in C){if(A is yB)continue;throw new ArgumentError('Unknown VersionConstraint type ${A}.');}C.sort();var B=<yB>[] ;for(var A in C){if(B.isEmpty||(!B.last.aP(A)&&!GKB(B.last,A))){B.add(A);}else{B[B.length-1]=B.last.union(A);}}if(B.length==1)return B.single;return new iI.wWB(B);}}class O3 implements NC{const O3();bool get isEmpty=>true;bool get Ag=>false;bool vL(UC A)=>false;bool aP(NC A)=>false;NC union(NC A)=>A;NC difference(NC A)=>this;String toString()=>'<empty>';}class yB implements Comparable<yB>,NC{final UC min;final UC max;final bool WD;final bool VD;factory yB({UC min,UC max,bool includeMin: false,bool includeMax: false,bool alwaysIncludeMaxPreRelease: false}){if(min!=null&&max!=null&&min>max){throw new ArgumentError('Minimum version ("${min}") must be less than maximum ("${max}").');}if(!alwaysIncludeMaxPreRelease&&!includeMax&&max!=null&&!max.nP&&max.CI.isEmpty&&(min==null||!min.nP||!M3(min,max))){max=max.sQB;}return new yB.vWB(min,max,includeMin,includeMax);}yB.vWB(this.min,this.max,this.WD,this.VD);bool operator==(A){if(A is!yB)return false;return min==A.min&&max==A.max&&WD==A.WD&&VD==A.VD;}int get hashCode=>min.hashCode^(max.hashCode*3)^(WD.hashCode*5)^(VD.hashCode*7);bool get isEmpty=>false;bool get Ag=>min==null&&max==null;bool vL(UC A){if(min!=null){if(A<min)return false;if(!WD&&A==min)return false;}if(max!=null){if(A>max)return false;if(!VD&&A==max)return false;}return true;}bool aP(NC A){if(A.isEmpty)return false;if(A is UC)return vL(A);if(A is iI){return A.ZD.any((B)=>aP(B));}if(A is yB){return !qc(A,this)&&!wm(A,this);}throw new ArgumentError('Unknown VersionConstraint type ${A}.');}NC union(NC A){if(A is UC){if(vL(A))return this;if(A==min){return new yB(min:this.min,max:this.max,includeMin:true,includeMax:this.VD,alwaysIncludeMaxPreRelease:true);}if(A==max){return new yB(min:this.min,max:this.max,includeMin:this.WD,includeMax:true,alwaysIncludeMaxPreRelease:true);}return new NC.uWB([this,A]);}if(A is yB){var H=(max==A.min&&(VD||A.WD))||(min==A.max&&(WD||A.VD));if(!H&&!aP(A)){return new NC.uWB([this,A]);}UC B;bool C;if(L3(this,A)){B=this.min;C=this.WD;}else{B=A.min;C=A.WD;}UC D;bool G;if(pc(this,A)){D=this.max;G=this.VD;}else{D=A.max;G=A.VD;}return new yB(min:B,max:D,includeMin:C,includeMax:G,alwaysIncludeMaxPreRelease:true);}return new NC.uWB([this,A]);}NC difference(NC A){if(A.isEmpty)return this;if(A is UC){if(!vL(A))return this;if(A==min){if(!WD)return this;return new yB(min:min,max:max,includeMin:false,includeMax:VD,alwaysIncludeMaxPreRelease:true);}if(A==max){if(!VD)return this;return new yB(min:min,max:max,includeMin:WD,includeMax:false,alwaysIncludeMaxPreRelease:true);}return new iI.wWB([new yB(min:min,max:A,includeMin:WD,includeMax:false,alwaysIncludeMaxPreRelease:true),new yB(min:A,max:max,includeMin:false,includeMax:VD,alwaysIncludeMaxPreRelease:true)]);}else if(A is yB){if(!aP(A))return this;yB B;if(!L3(this,A)){B=null;}else if(min==A.min){assert(WD&&!A.WD);assert(min!=null);B=min;}else{B=new yB(min:min,max:A.min,includeMin:WD,includeMax:!A.WD,alwaysIncludeMaxPreRelease:true);}yB C;if(!pc(this,A)){C=null;}else if(max==A.max){assert(VD&&!A.VD);assert(max!=null);C=max;}else{C=new yB(min:A.max,max:max,includeMin:!A.VD,includeMax:VD,alwaysIncludeMaxPreRelease:true);}if(B==null&&C==null)return NC.GX;if(B==null)return C;if(C==null)return B;return new iI.wWB([B,C]);}else if(A is iI){var H=<yB>[] ;var D=this;for(var I in A.ZD){if(qc(I,D))continue;if(wm(I,D))break;var G=D.difference(I);if(G.isEmpty){return NC.GX;}else if(G is iI){assert(G.ZD.length==2);H.add(G.ZD.first);D=G.ZD.last;}else{D=G as yB;}}if(H.isEmpty)return D;return new iI.wWB(H..add(D));}throw new ArgumentError('Unknown VersionConstraint type ${A}.');}int compareTo(yB A){if(min==null){if(A.min==null)return JnB(A);return -1;}else if(A.min==null){return 1;}var B=min.compareTo(A.min);if(B!=0)return B;if(WD!=A.WD)return WD?-1:1;return JnB(A);}int JnB(yB A){if(max==null){if(A.max==null)return 0;return 1;}else if(A.max==null){return -1;}var B=max.compareTo(A.max);if(B!=0)return B;if(VD!=A.VD)return VD?1:-1;return 0;}String toString(){var A=new StringBuffer();if(min!=null){A.write(WD?'>=':'>');A.write(min);}if(max!=null){if(min!=null)A.write(' ');if(VD){A.write('<=');A.write(max);}else{A.write('<');if(max.KSB){A.write("${max.pE}.${max.cE}.${max.patch}");}else{A.write(max);var B=min!=null&&min.nP&&M3(min,max);if(!max.nP&&max.CI.isEmpty&&!B){A.write("-");}}}}if(min==null&&max==null)A.write('any');return A.toString();}}class iI implements NC{final List<yB> ZD;bool get isEmpty=>false;bool get Ag=>false;iI.wWB(this.ZD);bool vL(UC A)=>ZD.any((B)=>B.vL(A));bool aP(NC C){var A=ZD.iterator;var B=KnB(C).iterator;A.moveNext();B.moveNext();while(A.current!=null&&B.current!=null){if(A.current.aP(B.current)){return true;}if(pc(B.current,A.current)){A.moveNext();}else{B.moveNext();}}return false;}NC difference(NC J){var C=ZD.iterator;var D=KnB(J).iterator;var B=<yB>[] ;C.moveNext();D.moveNext();var A=C.current;H(){if(D.moveNext())return true;B.add(A);while(C.moveNext()){B.add(C.current);}return false;}I({bool includeCurrent: true}){if(includeCurrent)B.add(A);if(!C.moveNext())return false;A=C.current;return true;}while(true){if(qc(D.current,A)){if(!H())break;continue;}if(wm(D.current,A)){if(!I())break;continue;}var G=A.difference(D.current);if(G is iI){assert(G.ZD.length==2);B.add(G.ZD.first);A=G.ZD.last;if(!H())break;}else if(G.isEmpty){if(!I(includeCurrent:false))break;}else{A=G as yB;if(pc(A,D.current)){if(!H())break;}else{if(!I())break;}}}if(B.isEmpty)return NC.GX;if(B.length==1)return B.single;return new iI.wWB(B);}List<yB> KnB(NC A){if(A.isEmpty)return [] ;if(A is iI)return A.ZD;if(A is yB)return [A];throw new ArgumentError('Unknown VersionConstraint type ${A}.');}NC union(NC A)=>new NC.uWB([this,A]);bool operator==(A){if(A is!iI)return false;return const eV().LE(ZD,A.ZD);}int get hashCode=>const eV().hash(ZD);String toString()=>ZD.join(" or ");}class sH{final hL type;final String path;sH(this.type,this.path);String toString()=>"${type} ${path}";}class hL{static const o3=const hL("remove");static const Bd=const hL("modify");final String LnB;const hL(this.LnB);String toString()=>LnB;}abstract class Kn{}const im=0x20;class r2 extends FN{r2();final name='windows';final AK='\\';final EF=const['/','\\'];final T_=new RegExp(r'[/\\]');final Z9=new RegExp(r'[^/\\]$');final O_=new RegExp(r'^(\\\\[^\\]+\\[^\\/]+|[a-zA-Z]:[/\\])');final H_=new RegExp(r"^[/\\](?![/\\])");bool Rf(String A)=>A.contains('/');bool VC(int A)=>A==fJ||A==kT;bool CV(String A){if(A.isEmpty)return false;return !VC(A.codeUnitAt(A.length-1));}int AL(String A,{bool withDrive: false}){if(A.isEmpty)return 0;if(A.codeUnitAt(0)==fJ)return 1;if(A.codeUnitAt(0)==kT){if(A.length<2||A.codeUnitAt(1)!=kT)return 1;var B=A.indexOf('\\',2);if(B>0){B=A.indexOf('\\',B+1);if(B>0)return B;}return A.length;}if(A.length<3)return 0;if(!s2(A.codeUnitAt(0)))return 0;if(A.codeUnitAt(1)!=dm)return 0;if(!VC(A.codeUnitAt(2)))return 0;return 3;}bool oF(String A)=>AL(A)==1;String cZ(Uri B){if(B.scheme!=''&&B.scheme!='file'){throw new ArgumentError("Uri ${B} must have scheme 'file:'.");}var A=B.path;if(B.host==''){if(A.length>=3&&A.startsWith('/')&&t2(A,1)){A=A.replaceFirst("/","");}}else{A='\\\\${B.host}${A}';}return Uri.decodeComponent(A.replaceAll("/","\\"));}Uri HY(String C){var A=new GN.oWB(C,this);if(A.nB.startsWith(r'\\')){var B=A.nB.split('\\').where((D)=>D!='');A.tB.insert(0,B.last);if(A.Mr){A.tB.add("");}return new Uri(scheme:'file',host:B.first,pathSegments:A.tB);}else{if(A.tB.length==0||A.Mr){A.tB.add("");}A.tB.insert(0,A.nB.replaceAll("/","").replaceAll("\\",""));return new Uri(scheme:'file',pathSegments:A.tB);}}bool Of(int A,int B){if(A==B)return true;if(A==fJ)return B==kT;if(A==kT)return B==fJ;if(A^B!=im)return false;var C=A|im;return C>=j2&&C<=k2;}bool Es(String A,String C){if(identical(A,C))return true;if(A.length!=C.length)return false;for(var B=0;B<A.length;B++ ){if(!Of(A.codeUnitAt(B),C.codeUnitAt(B))){return false;}}return true;}int U7(int A){if(A==fJ)return kT;if(A<h2)return A;if(A>i2)return A;return A|im;}String V7(String A)=>A.toLowerCase();}abstract class aAB<R> implements Iterable<R>{}class Ji<R> extends aAB<R>{}class Ki<R> extends Ji<R> implements List<R>{static List Yu(List A)=>A is List?A:new ba(A);}class Zu<R> extends Ji<R> implements Set<R>{static Set bAB(Set A)=>A is Set?A:new qS(A);}class Li<wB,dB> implements Map<wB,dB>{static Map au(Map A)=>A is Map?A:new Ii(A);}qLB(String A,{sourceUrl})=>rLB(A,sourceUrl:sourceUrl).value;kE rLB(String A,{sourceUrl})=>sLB(A,sourceUrl:sourceUrl).DI;vT sLB(String D,{sourceUrl}){var A=new x3(D,sourceUrl:sourceUrl);var B=A.load();if(B==null){return new vT.SXB(new AF.WXB(null,A.l),A.l,null,const[] );}var C=A.load();if(C!=null){throw new MC("Only expected one document.",C.l);}return B;}Map tKB()=>new HashMap(equals:uKB,hashCode:p3);bool uKB(A,B)=>new vKB().LE(A,B);class vKB{final MnB=[] ;final NnB=[] ;bool LE(A,B){if(A is AF)A=A.value;if(B is AF)B=B.value;for(var C=0;C<MnB.length;C++ ){var D=identical(A,MnB[C]);var G=identical(B,NnB[C]);if(D&&G)return true;if(D||G)return false;}MnB.add(A);NnB.add(B);try {if(A is List&&B is List){return OnB(A,B);}else if(A is Map&&B is Map){return PnB(A,B);}else if(A is num&&B is num){return QnB(A,B);}else{return A==B;}}finally {MnB.removeLast();NnB.removeLast();}}bool OnB(List B,List C){if(B.length!=C.length)return false;for(var A=0;A<B.length;A++ ){if(!LE(B[A],C[A]))return false;}return true;}bool PnB(Map A,Map B){if(A.length!=B.length)return false;for(var C in A.keys){if(!B.containsKey(C))return false;if(!LE(A[C],B[C]))return false;}return true;}bool QnB(num A,num B){if(A.isNaN&&B.isNaN)return true;return A==B;}}int p3(G){var B=[] ;C(A){if(B.any((H)=>identical(H,A)))return -1;B.add(A);try {if(A is Map){var D=const aa();return D.hash(A.keys.map(C))^D.hash(A.values.map(C));}else if(A is Iterable){return const dV().hash(A.map(p3));}else if(A is AF){return A.value.hashCode;}else{return A.hashCode;}}finally {B.removeLast();}}return C(G);}class BD{final iC type;final hD l;BD(this.type,this.l);String toString()=>type.toString();}class Cd implements BD{get type=>iC.wKB;final hD l;final QX versionDirective;final List<iJ> Eh;final bool isImplicit;Cd(this.l,{this.versionDirective,List<iJ> tagDirectives,this.isImplicit: true}):Eh=tagDirectives==null?[] :tagDirectives;String toString()=>"DOCUMENT_START";}class Dd implements BD{get type=>iC.s3;final hD l;final bool isImplicit;Dd(this.l,{this.isImplicit: true});String toString()=>"DOCUMENT_END";}class Ln implements BD{get type=>iC.t3;final hD l;final String name;Ln(this.l,this.name);String toString()=>"ALIAS ${name}";}abstract class Mn implements BD{String get anchor;String get tag;String toString(){var A=new StringBuffer('${type}');if(anchor!=null)A.write(" &${anchor}");if(tag!=null)A.write(" ${tag}");return A.toString();}}class hJ extends Mn{get type=>iC.u3;final hD l;final String anchor;final String tag;final String value;final PF BB;hJ(this.l,this.value,this.BB,{this.anchor,this.tag});String toString()=>"${super.toString()} \"${value}\"";}class JX extends Mn{get type=>iC.v3;final hD l;final String anchor;final String tag;final kI BB;JX(this.l,this.BB,{this.anchor,this.tag});}class KX extends Mn{get type=>iC.w3;final hD l;final String anchor;final String tag;final kI BB;KX(this.l,this.BB,{this.anchor,this.tag});}class iC{static const q3=const iC.OXB("STREAM_START");static const r3=const iC.OXB("STREAM_END");static const wKB=const iC.OXB("DOCUMENT_START");static const s3=const iC.OXB("DOCUMENT_END");static const t3=const iC.OXB("ALIAS");static const u3=const iC.OXB("SCALAR");static const v3=const iC.OXB("SEQUENCE_START");static const Ed=const iC.OXB("SEQUENCE_END");static const w3=const iC.OXB("MAPPING_START");static const Fd=const iC.OXB("MAPPING_END");final String name;const iC.OXB(this.name);String toString()=>name;}class MC extends HX{MC(String A,iD B):super(A,B);}class x3{final Nn RnB;final SnB=new Map<String,kE>();hD get l=>TnB;hD TnB;x3(String B,{sourceUrl}):RnB=new Nn(B,sourceUrl:sourceUrl){var A=RnB.YD();TnB=A.l;assert(A.type==iC.q3);}vT load(){if(RnB.JI)return null;var A=RnB.YD();if(A.type==iC.r3){TnB=TnB.expand(A.l);return null;}var B=UnB(A);TnB=TnB.expand(B.l);SnB.clear();return B;}vT UnB(Cd A){var C=VnB(RnB.YD());var B=RnB.YD() as Dd;assert(B.type==iC.s3);return new vT.SXB(C,A.l.expand(B.l),A.versionDirective,A.Eh,startImplicit:A.isImplicit,endImplicit:B.isImplicit);}kE VnB(BD A){switch (A.type){case iC.t3:return WnB(A);case iC.u3:return XnB(A);case iC.v3:return YnB(A);case iC.w3:return ZnB(A);default:throw "Unreachable";}}void anB(String A,kE B){if(A==null)return;SnB[A]=B;}kE WnB(Ln A){var B=SnB[A.name];if(B!=null)return B;throw new MC("Undefined alias.",A.l);}kE XnB(hJ A){var B;if(A.tag=="!"){B=new AF.VXB(A.value,A);}else if(A.tag!=null){B=bnB(A);}else{B=cnB(A);}anB(A.anchor,B);return B;}kE YnB(JX A){if(A.tag!="!"&&A.tag!=null&&A.tag!="tag:yaml.org,2002:seq"){throw new MC("Invalid tag for sequence.",A.l);}var D=<kE>[] ;var C=new Y4.UXB(D,A.l,A.BB);anB(A.anchor,C);var B=RnB.YD();while(B.type!=iC.Ed){D.add(VnB(B));B=RnB.YD();}Z4(C,A.l.expand(B.l));return C;}kE ZnB(KX A){if(A.tag!="!"&&A.tag!=null&&A.tag!="tag:yaml.org,2002:map"){throw new MC("Invalid tag for mapping.",A.l);}var D=tKB();var C=new X4.TXB(D,A.l,A.BB);anB(A.anchor,C);var B=RnB.YD();while(B.type!=iC.Fd){var G=VnB(B);var H=VnB(RnB.YD());D[G]=H;B=RnB.YD();}Z4(C,A.l.expand(B.l));return C;}AF bnB(hJ A){switch (A.tag){case "tag:yaml.org,2002:null":var B=dnB(A);if(B!=null)return B;throw new MC("Invalid null scalar.",A.l);case "tag:yaml.org,2002:bool":var B=enB(A);if(B!=null)return B;throw new MC("Invalid bool scalar.",A.l);case "tag:yaml.org,2002:int":var B=fnB(A,allowFloat:false);if(B!=null)return B;throw new MC("Invalid int scalar.",A.l);case "tag:yaml.org,2002:float":var B=fnB(A,allowInt:false);if(B!=null)return B;throw new MC("Invalid float scalar.",A.l);case "tag:yaml.org,2002:str":return new AF.VXB(A.value,A);default:throw new MC('Undefined tag: ${A.tag}.',A.l);}}AF cnB(hJ A)=>gnB(A)??new AF.VXB(A.value,A);AF gnB(hJ A){var B=A.value.length;if(B==0)return new AF.VXB(null,A);var C=A.value.codeUnitAt(0);switch (C){case Ya:case Di:case Ei:return fnB(A);case QAB:case OAB:return B==4?dnB(A):null;case SAB:case PAB:return B==4?enB(A):null;case Ru:case NAB:return B==5?enB(A):null;case VAB:return B==1?new AF.VXB(null,A):null;default:if(C>=cO&&C<=Za)return fnB(A);return null;}}AF dnB(hJ A){switch (A.value){case "":case "null":case "Null":case "NULL":case "~":return new AF.VXB(null,A);default:return null;}}AF enB(hJ A){switch (A.value){case "true":case "True":case "TRUE":return new AF.VXB(true,A);case "false":case "False":case "FALSE":return new AF.VXB(false,A);default:return null;}}kE fnB(hJ A,{bool allowInt: true,bool allowFloat: true}){var B=hnB(A.value,allowInt:allowInt,allowFloat:allowFloat);return B==null?null:new AF.VXB(B,A);}num hnB(String A,{bool allowInt: true,bool allowFloat: true}){assert(allowInt||allowFloat);var B=A.codeUnitAt(0);var G=A.length;if(allowInt&&G==1){var H=B-cO;return H>=0&&H<=9?H:null;}var C=A.codeUnitAt(1);if(allowInt&&B==cO){if(C==UAB)return int.parse(A,onError:(D)=>null);if(C==RAB){var J=A.substring(2);return int.parse(J,radix:8,onError:(D)=>null);}}if((B>=cO&&B<=Za)||((B==Di||B==Ei)&&C>=cO&&C<=Za)){var I=null;if(allowInt){I=int.parse(A,radix:10,onError:(D)=>null);}if(allowFloat)I??= double.parse(A,(D)=>null);return I;}if(!allowFloat)return null;if((B==Ya&&C>=cO&&C<=Za)||(B==Ei||B==Di)&&C==Ya){if(G==5){switch (A){case "+.inf":case "+.Inf":case "+.INF":return double.INFINITY;case "-.inf":case "-.Inf":case "-.INF":return -double.INFINITY;}}return double.parse(A,(D)=>null);}if(G==4&&B==Ya){switch (A){case ".inf":case ".Inf":case ".INF":return double.INFINITY;case ".nan":case ".NaN":case ".NAN":return double.NAN;}}return null;}}class Nn{final Vn inB;final jnB=new List<HB>();var knB=HB.y3;final lnB=new Map<String,iJ>();bool get JI=>knB==HB.H4;Nn(String A,{sourceUrl}):inB=new Vn(A,sourceUrl:sourceUrl);BD YD(){try {if(JI)throw new StateError("No more events.");var B=mnB();return B;}on zc catch (A){throw new MC(A.message,A.l);}}BD mnB(){switch (knB){case HB.y3:return nnB();case HB.On:return onB();case HB.z3:return pnB();case HB.Pn:return qnB();case HB.A4:return rnB(block:true);case HB.xKB:return rnB(block:true,indentlessSequence:true);case HB.yKB:return rnB();case HB.B4:inB.ZB();return snB();case HB.Qn:return snB();case HB.Gd:return tnB();case HB.C4:inB.ZB();return unB();case HB.Hd:return unB();case HB.Id:return vnB();case HB.D4:return wnB(first:true);case HB.Rn:return wnB();case HB.E4:return xnB();case HB.Sn:return ynB();case HB.Tn:return znB();case HB.F4:return AoB(first:true);case HB.Jd:return AoB();case HB.Un:return BoB();case HB.G4:return BoB(empty:true);default:throw "Unreachable";}}BD nnB(){var A=inB.ZB();assert(A.type==k.R4);knB=HB.On;return new BD(iC.q3,A.l);}BD onB(){var A=inB.OD();while(A.type==k.Zd){A=inB.uI();}if(A.type!=k.Wd&&A.type!=k.Xd&&A.type!=k.Yd&&A.type!=k.OX){CoB();jnB.add(HB.Pn);knB=HB.A4;return new Cd(A.l.start.RG());}if(A.type==k.OX){knB=HB.H4;inB.ZB();return new BD(iC.r3,A.l);}var C=A.l;var B=CoB();var D=B.first;var G=B.last;A=inB.OD();if(A.type!=k.Yd){throw new MC("Expected document start.",A.l);}jnB.add(HB.Pn);knB=HB.z3;inB.ZB();return new Cd(C.expand(A.l),versionDirective:D,tagDirectives:G,isImplicit:false);}BD pnB(){var A=inB.OD();switch (A.type){case k.Wd:case k.Xd:case k.Yd:case k.Zd:case k.OX:knB=jnB.removeLast();return DoB(A.l.start);default:return rnB(block:true);}}BD qnB(){lnB.clear();knB=HB.On;var A=inB.OD();if(A.type==k.Zd){inB.ZB();return new Dd(A.l,isImplicit:false);}else{return new Dd(A.l.start.RG(),isImplicit:true);}}BD rnB({bool block: false,bool indentlessSequence: false}){var A=inB.OD();if(A is ln){inB.ZB();knB=jnB.removeLast();return new Ln(A.l,A.name);}var D;var G;var B=A.l.start.RG();H(A){D=A.name;B=B.expand(A.l);return inB.uI();}I(A){G=A;B=B.expand(A.l);return inB.uI();}if(A is Ud){A=H(A);if(A is Vd)A=I(A);}else if(A is Vd){A=I(A);if(A is Ud)A=H(A);}var C;if(G!=null){if(G.zI==null){C=G.Ah;}else{var J=lnB[G.zI];if(J==null){throw new MC("Undefined tag handle.",G.l);}C=J.prefix+G.Ah;}}if(indentlessSequence&&A.type==k.uT){knB=HB.Gd;return new JX(B.expand(A.l),kI.gn,anchor:D,tag:C);}if(A is rT){if(C==null&&A.BB!=PF.Td)C="!";knB=jnB.removeLast();inB.ZB();return new hJ(B.expand(A.l),A.value,A.BB,anchor:D,tag:C);}if(A.type==k.T4){knB=HB.D4;return new JX(B.expand(A.l),kI.hn,anchor:D,tag:C);}if(A.type==k.U4){knB=HB.F4;return new KX(B.expand(A.l),kI.hn,anchor:D,tag:C);}if(block&&A.type==k.S4){knB=HB.B4;return new JX(B.expand(A.l),kI.gn,anchor:D,tag:C);}if(block&&A.type==k.ad){knB=HB.C4;return new KX(B.expand(A.l),kI.gn,anchor:D,tag:C);}if(D!=null||C!=null){knB=jnB.removeLast();return new hJ(B,'',PF.Td,anchor:D,tag:C);}throw new MC("Expected node content.",B);}BD snB(){var A=inB.OD();if(A.type==k.uT){A=inB.uI();if(A.type==k.uT||A.type==k.QR){knB=HB.Qn;return DoB(A.l.end);}else{jnB.add(HB.Qn);return rnB(block:true);}}if(A.type==k.QR){inB.ZB();knB=jnB.removeLast();return new BD(iC.Ed,A.l);}throw new MC("While parsing a block collection, expected '-'.",A.l.start.RG());}BD tnB(){var A=inB.OD();if(A.type!=k.uT){knB=jnB.removeLast();return new BD(iC.Ed,A.l.start.RG());}var B=A.l.start;A=inB.uI();if(A.type==k.uT||A.type==k.LN||A.type==k.lL||A.type==k.QR){knB=HB.Gd;return DoB(B);}else{jnB.add(HB.Gd);return rnB(block:true);}}BD unB(){var A=inB.OD();if(A.type==k.LN){var B=A.l.start;A=inB.uI();if(A.type==k.LN||A.type==k.lL||A.type==k.QR){knB=HB.Id;return DoB(B);}else{jnB.add(HB.Id);return rnB(block:true,indentlessSequence:true);}}if(A.type==k.lL){knB=HB.Id;return DoB(A.l.start);}if(A.type==k.QR){inB.ZB();knB=jnB.removeLast();return new BD(iC.Fd,A.l);}throw new MC("Expected a key while parsing a block mapping.",A.l.start.RG());}BD vnB(){var A=inB.OD();if(A.type!=k.lL){knB=HB.Hd;return DoB(A.l.start);}var B=A.l.start;A=inB.uI();if(A.type==k.LN||A.type==k.lL||A.type==k.QR){knB=HB.Hd;return DoB(B);}else{jnB.add(HB.Hd);return rnB(block:true,indentlessSequence:true);}}BD wnB({bool first: false}){if(first)inB.ZB();var A=inB.OD();if(A.type!=k.sT){if(!first){if(A.type!=k.RR){throw new MC("While parsing a flow sequence, expected ',' or ']'.",A.l.start.RG());}A=inB.uI();}if(A.type==k.LN){knB=HB.E4;inB.ZB();return new KX(A.l,kI.hn);}else if(A.type!=k.sT){jnB.add(HB.Rn);return rnB();}}inB.ZB();knB=jnB.removeLast();return new BD(iC.Ed,A.l);}BD xnB(){var A=inB.OD();if(A.type==k.lL||A.type==k.RR||A.type==k.sT){var B=A.l.start;knB=HB.Sn;return DoB(B);}else{jnB.add(HB.Sn);return rnB();}}BD ynB(){var A=inB.OD();if(A.type==k.lL){A=inB.uI();if(A.type!=k.RR&&A.type!=k.sT){jnB.add(HB.Tn);return rnB();}}knB=HB.Tn;return DoB(A.l.start);}BD znB(){knB=HB.Rn;return new BD(iC.Fd,inB.OD().l.start.RG());}BD AoB({bool first: false}){if(first)inB.ZB();var A=inB.OD();if(A.type!=k.tT){if(!first){if(A.type!=k.RR){throw new MC("While parsing a flow mapping, expected ',' or '}'.",A.l.start.RG());}A=inB.uI();}if(A.type==k.LN){A=inB.uI();if(A.type!=k.lL&&A.type!=k.RR&&A.type!=k.tT){jnB.add(HB.Un);return rnB();}else{knB=HB.Un;return DoB(A.l.start);}}else if(A.type!=k.tT){jnB.add(HB.G4);return rnB();}}inB.ZB();knB=jnB.removeLast();return new BD(iC.Fd,A.l);}BD BoB({bool empty: false}){var A=inB.OD();if(empty){knB=HB.Jd;return DoB(A.l.start);}if(A.type==k.lL){A=inB.uI();if(A.type!=k.RR&&A.type!=k.tT){jnB.add(HB.Jd);return rnB();}}knB=HB.Jd;return DoB(A.l.start);}BD DoB(jI A)=>new hJ(A.RG(),'',PF.Td);PX<QX,List<iJ>> CoB(){var A=inB.OD();var B;var C=<iJ>[] ;while(A.type==k.Wd||A.type==k.Xd){if(A is jn){if(B!=null){throw new MC("Duplicate %YAML directive.",A.l);}if(A.pE!=1||A.cE==0){throw new MC("Incompatible YAML document. This parser only supports YAML 1.1 " "and 1.2.",A.l);}else if(A.cE>2){W4("Warning: this parser only supports YAML 1.1 and 1.2.",A.l);}B=new QX(A.pE,A.cE);}else if(A is kn){var D=new iJ(A.zI,A.prefix);EoB(D,A.l);C.add(D);}A=inB.uI();}EoB(new iJ("!","!"),A.l.start.RG(),allowDuplicates:true);EoB(new iJ("!!","tag:yaml.org,2002:"),A.l.start.RG(),allowDuplicates:true);return new PX(B,C);}void EoB(iJ A,hD B,{bool allowDuplicates: false}){if(lnB.containsKey(A.zI)){if(allowDuplicates)return;throw new MC("Duplicate %TAG directive.",B);}lnB[A.zI]=A;}}class HB{static const y3=const HB("STREAM_START");static const On=const HB("DOCUMENT_START");static const z3=const HB("DOCUMENT_CONTENT");static const Pn=const HB("DOCUMENT_END");static const A4=const HB("BLOCK_NODE");static const xKB=const HB("BLOCK_NODE_OR_INDENTLESS_SEQUENCE");static const yKB=const HB("FLOW_NODE");static const B4=const HB("BLOCK_SEQUENCE_FIRST_ENTRY");static const Qn=const HB("BLOCK_SEQUENCE_ENTRY");static const Gd=const HB("INDENTLESS_SEQUENCE_ENTRY");static const C4=const HB("BLOCK_MAPPING_FIRST_KEY");static const Hd=const HB("BLOCK_MAPPING_KEY");static const Id=const HB("BLOCK_MAPPING_VALUE");static const D4=const HB("FLOW_SEQUENCE_FIRST_ENTRY");static const Rn=const HB("FLOW_SEQUENCE_ENTRY");static const E4=const HB("FLOW_SEQUENCE_ENTRY_MAPPING_KEY");static const Sn=const HB("FLOW_SEQUENCE_ENTRY_MAPPING_VALUE");static const Tn=const HB("FLOW_SEQUENCE_ENTRY_MAPPING_END");static const F4=const HB("FLOW_MAPPING_FIRST_KEY");static const Jd=const HB("FLOW_MAPPING_KEY");static const Un=const HB("FLOW_MAPPING_VALUE");static const G4=const HB("FLOW_MAPPING_EMPTY_VALUE");static const H4=const HB("END");final String name;const HB(this.name);String toString()=>name;}class Vn{static const iL=0x9;static const jL=0xA;static const kL=0xD;static const fK=0x20;static const zKB=0x24;static const ALB=0x28;static const BLB=0x29;static const LX=0x2B;static const MX=0x2C;static const Kd=0x2D;static const CLB=0x2E;static const Wn=0x3F;static const Ld=0x3A;static const DLB=0x3B;static const ELB=0x3D;static const Md=0x5B;static const NX=0x5D;static const Xn=0x7B;static const Nd=0x7D;static const Yn=0x23;static const I4=0x26;static const J4=0x2A;static const K4=0x21;static const FLB=0x7C;static const GLB=0x3C;static const HLB=0x3E;static const PR=0x27;static const Od=0x22;static const Pd=0x25;static const Zn=0x40;static const L4=0x60;static const ILB=0x7E;static const JLB=0x0;static const KLB=0x7;static const LLB=0x8;static const MLB=0xB;static const NLB=0xC;static const OLB=0x1B;static const M4=0x2F;static const an=0x5C;static const PLB=0x5F;static const Qd=0x85;static const QLB=0xA0;static const RLB=0x2028;static const SLB=0x2029;static const bn=0xFEFF;static const KN=0x30;static const Rd=0x39;static const Sd=0x61;static const TLB=0x62;static const ULB=0x65;static const N4=0x66;static const VLB=0x6E;static const WLB=0x72;static const XLB=0x74;static const YLB=0x75;static const ZLB=0x76;static const aLB=0x78;static const bLB=0x7A;static const cn=0x41;static const O4=0x46;static const cLB=0x4C;static const dLB=0x4E;static const eLB=0x50;static const fLB=0x55;static const gLB=0x5A;final pT FoB;var GoB=false;var HoB=false;final IoB=new Tu<jD>();var JoB=0;var KoB=false;final LoB=<int>[-1];var MoB=true;final NoB=<dn>[null];int get OoB=>LoB.last;bool get PoB=>NoB.length==1;bool get QoB=>FoB.JI||RoB;bool get RoB=>SoB(0);bool get ToB=>UoB(0);bool get VoB=>WoB(0);bool get XoB{var A=FoB.JC();if(A==null)return false;switch (A){case Kd:case DLB:case M4:case Ld:case Zn:case I4:case ELB:case LX:case zKB:case CLB:case ILB:case Wn:case J4:case PR:case ALB:case BLB:case Pd:return true;default:return (A>=KN&&A<=Rd)||(A>=Sd&&A<=bLB)||(A>=cn&&A<=gLB);}}bool get YoB{if(!ZoB)return false;switch (FoB.JC()){case MX:case Md:case NX:case Xn:case Nd:return false;default:return true;}}bool get aoB{var A=FoB.JC();return A!=null&&(A>=KN&&A<=Rd);}bool get boB{var A=FoB.JC();if(A==null)return false;return (A>=KN&&A<=Rd)||(A>=Sd&&A<=N4)||(A>=cn&&A<=O4);}bool get coB=>doB(0);bool get eoB{var A=FoB.JC();if(A==null)return false;switch (A){case jL:case kL:case bn:return false;case iL:case Qd:return true;default:return (A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF);}}bool get ZoB{var A=FoB.JC();if(A==null)return false;switch (A){case jL:case kL:case bn:case fK:return false;case Qd:return true;default:return (A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF);}}bool get foB{return FoB.column==0&&UoB(3)&&(FoB.XD('---')||FoB.XD('...'));}Vn(String A,{sourceUrl}):FoB=new pT.JYB(A,sourceUrl:sourceUrl);jD ZB(){if(HoB)throw new StateError("Out of tokens.");if(!KoB)goB();var A=IoB.removeFirst();KoB=false;JoB++ ;HoB=A is jD&&A.type==k.OX;return A;}jD uI(){ZB();return OD();}jD OD(){if(HoB)return null;if(!KoB)goB();return IoB.first;}void goB(){while(true){if(IoB.isNotEmpty){hoB();if(!NoB.any((A)=>A!=null&&A.Mh==JoB)){break;}}ioB();}KoB=true;}void ioB(){if(!GoB){joB();return;}koB();hoB();loB(FoB.column);if(FoB.JI){moB();return;}if(FoB.column==0){if(FoB.JC()==Pd){noB();return;}if(UoB(3)){if(FoB.XD('---')){ooB(k.Yd);return;}if(FoB.XD('...')){ooB(k.Zd);return;}}}switch (FoB.JC()){case Md:poB(k.T4);return;case Xn:poB(k.U4);return;case NX:qoB(k.sT);return;case Nd:qoB(k.tT);return;case MX:roB();return;case J4:soB(anchor:false);return;case I4:soB(anchor:true);return;case K4:toB();return;case PR:uoB(singleQuote:true);return;case Od:uoB(singleQuote:false);return;case FLB:if(!PoB)voB();woB(literal:true);return;case HLB:if(!PoB)voB();woB(literal:false);return;case Pd:case Zn:case L4:voB();return;case Kd:if(doB(1)){xoB();}else{yoB();}return;case Wn:if(doB(1)){xoB();}else{zoB();}return;case Ld:if(!PoB&&IoB.isNotEmpty){var A=IoB.last;if(A.type==k.sT||A.type==k.tT||(A.type==k.V4&&(A as rT).BB.NSB)){ApB();return;}}if(doB(1)){xoB();}else{ApB();}return;default:if(!eoB)voB();xoB();return;}throw 'Inaccessible';}void voB()=>FoB.error("Unexpected character.",length:1);void hoB(){for(var A=0;A<NoB.length;A++ ){var B=NoB[A];if(B==null)continue;if(!PoB)continue;if(B.line==FoB.line)continue;if(B.Rs){throw new MC("Expected ':'.",FoB.rG);}NoB[A]=null;}}void BpB(){var A=PoB&&OoB==FoB.column;assert(MoB||!A);if(!MoB)return;CpB();NoB[NoB.length-1]=new dn(JoB+IoB.length,FoB.line,FoB.column,FoB.location,required:A);}void CpB(){var A=NoB.last;if(A!=null&&A.Rs){throw new MC("Could not find expected ':' for simple key.",A.location.RG());}NoB[NoB.length-1]=null;}void DpB(){NoB.add(null);}void EpB(){if(PoB)return;NoB.removeLast();}void FpB(int A,k C,jI D,{int tokenNumber}){if(!PoB)return;if(OoB!=-1&&OoB>=A)return;LoB.add(A);var B=new jD(C,D.RG());if(tokenNumber==null){IoB.add(B);}else{IoB.insert(tokenNumber-JoB,B);}}void loB(int A){if(!PoB)return;while(OoB>A){IoB.add(new jD(k.QR,FoB.rG));LoB.removeLast();}}void GpB()=>loB(-1);void joB(){GoB=true;IoB.add(new jD(k.R4,FoB.rG));}void moB(){GpB();CpB();MoB=false;IoB.add(new jD(k.OX,FoB.rG));}void noB(){GpB();CpB();MoB=false;var A=HpB();if(A!=null)IoB.add(A);}void ooB(k A){GpB();CpB();MoB=false;var B=FoB.state;FoB.oB();FoB.oB();FoB.oB();IoB.add(new jD(A,FoB.SG(B)));}void poB(k A){BpB();DpB();MoB=true;IpB(A);}void qoB(k A){CpB();EpB();MoB=false;IpB(A);}void roB(){CpB();MoB=true;IpB(k.RR);}void yoB(){if(PoB){if(!MoB){throw new MC("Block sequence entries are not allowed here.",FoB.rG);}FpB(FoB.column,k.S4,FoB.location);}else{}CpB();MoB=true;IpB(k.uT);}void zoB(){if(PoB){if(!MoB){throw new MC("Mapping keys are not allowed here.",FoB.rG);}FpB(FoB.column,k.ad,FoB.location);}MoB=PoB;IpB(k.LN);}void ApB(){var A=NoB.last;if(A!=null){IoB.insert(A.Mh-JoB,new jD(k.LN,A.location.RG()));FpB(A.column,k.ad,A.location,tokenNumber:A.Mh);NoB[NoB.length-1]=null;MoB=false;}else if(PoB){if(!MoB){throw new MC("Mapping values are not allowed here. Did you miss a colon " "earlier?",FoB.rG);}FpB(FoB.column,k.ad,FoB.location);MoB=true;}else if(MoB){MoB=false;IpB(k.LN);}IpB(k.lL);}void IpB(k A){var B=FoB.state;FoB.oB();IoB.add(new jD(A,FoB.SG(B)));}void soB({bool anchor: true}){BpB();MoB=false;IoB.add(JpB(anchor:anchor));}void toB(){BpB();MoB=false;IoB.add(KpB());}void woB({bool literal: false}){CpB();MoB=true;IoB.add(LpB(literal:literal));}void uoB({bool singleQuote: false}){BpB();MoB=false;IoB.add(MpB(singleQuote:singleQuote));}void xoB(){BpB();MoB=false;IoB.add(NpB());}void koB(){var A=false;while(true){if(FoB.column==0)FoB.ZB("\uFEFF");while(FoB.JC()==fK||((!PoB||!A)&&FoB.JC()==iL)){FoB.oB();}if(FoB.JC()==iL){FoB.error("Tab characters are not allowed as indentation.",length:1);}OpB();if(RoB){PpB();if(PoB)MoB=true;A=true;}else{break;}}}jD HpB(){var A=FoB.state;FoB.oB();var B;var C=QpB();if(C=="YAML"){B=RpB(A);}else if(C=="TAG"){B=SpB(A);}else{W4("Warning: unknown directive.",FoB.SG(A));while(!QoB){FoB.oB();}return null;}TpB();OpB();if(!QoB){throw new MC("Expected comment or line break after directive.",FoB.SG(A));}PpB();return B;}String QpB(){var B=FoB.position;while(ZoB){FoB.oB();}var A=FoB.substring(B);if(A.isEmpty){throw new MC("Expected directive name.",FoB.rG);}else if(!ToB){throw new MC("Unexpected character in directive name.",FoB.rG);}return A;}jD RpB(GP A){TpB();var B=UpB();FoB.LG('.');var C=UpB();return new jn(FoB.SG(A),B,C);}int UpB(){var B=FoB.position;while(aoB){FoB.oB();}var A=FoB.substring(B);if(A.isEmpty){throw new MC("Expected version number.",FoB.rG);}return int.parse(A);}jD SpB(GP A){TpB();var B=VpB(directive:true);if(!VoB){throw new MC("Expected whitespace.",FoB.rG);}TpB();var C=WpB();if(!ToB){throw new MC("Expected whitespace.",FoB.rG);}return new kn(FoB.SG(A),B,C);}jD JpB({bool anchor: true}){var C=FoB.state;FoB.oB();var D=FoB.position;while(YoB){FoB.oB();}var B=FoB.substring(D);var A=FoB.JC();if(B.isEmpty||(!ToB&&A!=Wn&&A!=Ld&&A!=MX&&A!=NX&&A!=Nd&&A!=Pd&&A!=Zn&&A!=L4)){throw new MC("Expected alphanumeric character.",FoB.rG);}if(anchor){return new Ud(FoB.SG(C),B);}else{return new ln(FoB.SG(C),B);}}jD KpB(){var A;var B;var C=FoB.state;if(FoB.JC(1)==GLB){FoB.oB();FoB.oB();A='';B=WpB();FoB.LG('>');}else{A=VpB();if(A.length>1&&A.startsWith('!')&&A.endsWith('!')){B=WpB(flowSeparators:false);}else{B=WpB(head:A,flowSeparators:false);if(B.isEmpty){A=null;B='!';}else{A='!';}}}return new Vd(FoB.SG(C),A,B);}String VpB({bool directive: false}){FoB.LG('!');var A=new StringBuffer('!');var B=FoB.position;while(XoB){FoB.oB();}A.write(FoB.substring(B));if(FoB.JC()==K4){A.writeCharCode(FoB.oB());}else{if(directive&&A.toString()!='!')FoB.LG('!');}return A.toString();}String WpB({String head,bool flowSeparators: true}){var B=head==null?0:head.length;var C=new StringBuffer();if(B>1)C.write(head.substring(1));var D=FoB.position;var A=FoB.JC();while(XoB||(flowSeparators&&(A==MX||A==Md||A==NX))){FoB.oB();A=FoB.JC();}return Uri.decodeFull(FoB.substring(D));}jD LpB({bool literal: false}){var K=FoB.state;FoB.oB();var I=gK.hLB;var D=0;var A=FoB.JC();if(A==LX||A==Kd){I=A==LX?gK.fn:gK.en;FoB.oB();if(aoB){if(FoB.JC()==KN){throw new MC("0 may not be used as an indentation indicator.",FoB.SG(K));}D=FoB.oB()-KN;}}else if(aoB){if(FoB.JC()==KN){throw new MC("0 may not be used as an indentation indicator.",FoB.SG(K));}D=FoB.oB()-KN;A=FoB.JC();if(A==LX||A==Kd){I=A==LX?gK.fn:gK.en;FoB.oB();}}TpB();OpB();if(!QoB){throw new MC("Expected comment or line break.",FoB.rG);}PpB();var C=0;if(D!=0){C=OoB>=0?OoB+D:D;}var G=XpB(C);C=G.first;var J=G.last;var B=new StringBuffer();var H='';var M=false;var N=false;var O=FoB.state;while(FoB.column==C&&!FoB.JI){if(foB)break;N=VoB;if(!literal&&H.isNotEmpty&&!M&&!N){if(J.isEmpty)B.writeCharCode(fK);}else{B.write(H);}H='';B.write(J);M=VoB;var Q=FoB.position;while(!QoB){FoB.oB();}B.write(FoB.substring(Q));O=FoB.state;if(!FoB.JI)H=YpB();var G=XpB(C);C=G.first;J=G.last;}if(I!=gK.en)B.write(H);if(I==gK.fn)B.write(J);return new rT(FoB.SG(K,O),B.toString(),literal?PF.jLB:PF.kLB);}PX<int,String> XpB(int A){var B=0;var C=new StringBuffer();while(true){while((A==0||FoB.column<A)&&FoB.JC()==fK){FoB.oB();}if(FoB.column>B)B=FoB.column;if(!RoB)break;C.write(YpB());}if(A==0){A=B;if(A<OoB+1)A=OoB+1;}return new PX(A,C.toString());}jD MpB({bool singleQuote: false}){var N=FoB.state;var A=new StringBuffer();FoB.oB();while(true){if(foB){FoB.error("Unexpected document indicator.");}if(FoB.JI){throw new MC("Unexpected end of file.",FoB.rG);}var D=false;while(!ToB){var G=FoB.JC();if(singleQuote&&G==PR&&FoB.JC(1)==PR){FoB.oB();FoB.oB();A.writeCharCode(PR);}else if(G==(singleQuote?PR:Od)){break;}else if(!singleQuote&&G==an&&SoB(1)){FoB.oB();PpB();D=true;break;}else if(!singleQuote&&G==an){var I=FoB.state;var B=null;switch (FoB.JC(1)){case KN:A.writeCharCode(JLB);break;case Sd:A.writeCharCode(KLB);break;case TLB:A.writeCharCode(LLB);break;case XLB:case iL:A.writeCharCode(iL);break;case VLB:A.writeCharCode(jL);break;case ZLB:A.writeCharCode(MLB);break;case N4:A.writeCharCode(NLB);break;case WLB:A.writeCharCode(kL);break;case ULB:A.writeCharCode(OLB);break;case fK:case Od:case M4:case an:A.writeCharCode(FoB.JC(1));break;case dLB:A.writeCharCode(Qd);break;case PLB:A.writeCharCode(QLB);break;case cLB:A.writeCharCode(RLB);break;case eLB:A.writeCharCode(SLB);break;case aLB:B=2;break;case YLB:B=4;break;case fLB:B=8;break;default:throw new MC("Unknown escape character.",FoB.SG(I));}FoB.oB();FoB.oB();if(B!=null){var C=0;for(var K=0;K<B;K++ ){if(!boB){FoB.oB();throw new MC("Expected ${B}-digit hexidecimal number.",FoB.SG(I));}C=(C<<4)+ZpB(FoB.oB());}if((C>=0xD800&&C<=0xDFFF)||C>0x10FFFF){throw new MC("Invalid Unicode character escape code.",FoB.SG(I));}A.writeCharCode(C);}}else{A.writeCharCode(FoB.oB());}}if(FoB.JC()==(singleQuote?PR:Od)){break;}var H=new StringBuffer();var M='';var J=new StringBuffer();while(VoB||RoB){if(VoB){if(!D){H.writeCharCode(FoB.oB());}else{FoB.oB();}}else{if(!D){H.clear();M=YpB();D=true;}else{J.write(YpB());}}}if(D){if(M.isNotEmpty&&J.isEmpty){A.writeCharCode(fK);}else{A.write(J);}}else{A.write(H);H.clear();}}FoB.oB();return new rT(FoB.SG(N),A.toString(),singleQuote?PF.P4:PF.Q4);}jD NpB(){var I=FoB.state;var G=FoB.state;var B=new StringBuffer();var A='';var C='';var D=new StringBuffer();var H=OoB+1;while(true){if(foB)break;if(FoB.JC()==Yn)break;if(coB){if(A.isNotEmpty){if(C.isEmpty){B.writeCharCode(fK);}else{B.write(C);}A='';C='';}else{B.write(D);D.clear();}}var J=FoB.position;while(coB){FoB.oB();}B.write(FoB.substring(J));G=FoB.state;if(!VoB&&!RoB)break;while(VoB||RoB){if(VoB){if(A.isNotEmpty&&FoB.column<H&&FoB.JC()==iL){FoB.error("Expected a space but found a tab.",length:1);}if(A.isEmpty){D.writeCharCode(FoB.oB());}else{FoB.oB();}}else{if(A.isEmpty){A=YpB();D.clear();}else{C=YpB();}}}if(PoB&&FoB.column<H)break;}if(A.isNotEmpty)MoB=true;return new rT(FoB.SG(I,G),B.toString(),PF.Td);}void PpB(){var A=FoB.JC();if(A!=kL&&A!=jL)return;FoB.oB();if(A==kL&&FoB.JC()==jL)FoB.oB();}String YpB(){var A=FoB.JC();if(A!=kL&&A!=jL){throw new MC("Expected newline.",FoB.rG);}FoB.oB();if(A==kL&&FoB.JC()==jL)FoB.oB();return "\n";}bool WoB(int B){var A=FoB.JC(B);return A==fK||A==iL;}bool SoB(int B){var A=FoB.JC(B);return A==kL||A==jL;}bool UoB(int B){var A=FoB.JC(B);return A==null||A==fK||A==iL||A==kL||A==jL;}bool doB(int A){switch (FoB.JC(A)){case Ld:return apB(A+1);case Yn:var B=FoB.JC(A-1);return B!=fK&&B!=iL;default:return apB(A);}}bool apB(int B){var A=FoB.JC(B);switch (A){case MX:case Md:case NX:case Xn:case Nd:return PoB;case fK:case iL:case jL:case kL:case bn:return false;case Qd:return true;default:return A!=null&&((A>=0x00020&&A<=0x00007E)||(A>=0x000A0&&A<=0x00D7FF)||(A>=0x0E000&&A<=0x00FFFD)||(A>=0x10000&&A<=0x10FFFF));}}int ZpB(int A){if(A<=Rd)return A-KN;if(A<=O4)return 10+A-cn;return 10+A-Sd;}void TpB(){while(VoB){FoB.oB();}}void OpB(){if(FoB.JC()!=Yn)return;while(!QoB){FoB.oB();}}}class dn{final int Mh;final jI location;final int line;final int column;final bool Rs;dn(this.Mh,this.line,this.column,this.location,{bool required}):Rs=required;}class gK{static const en=const gK("STRIP");static const hLB=const gK("CLIP");static const fn=const gK("KEEP");final String name;const gK(this.name);String toString()=>name;}class PF{static const iLB=const PF.PXB("ANY");static const Td=const PF.PXB("PLAIN");static const jLB=const PF.PXB("LITERAL");static const kLB=const PF.PXB("FOLDED");static const P4=const PF.PXB("SINGLE_QUOTED");static const Q4=const PF.PXB("DOUBLE_QUOTED");final String name;bool get NSB=>this==P4||this==Q4;const PF.PXB(this.name);String toString()=>name;}class kI{static const gn=const kI.QXB("BLOCK");static const hn=const kI.QXB("FLOW");final String name;const kI.QXB(this.name);String toString()=>name;}class jD{final k type;final hD l;jD(this.type,this.l);String toString()=>type.toString();}class jn implements jD{get type=>k.Wd;final hD l;final int pE;final int cE;jn(this.l,this.pE,this.cE);String toString()=>"VERSION_DIRECTIVE ${pE}.${cE}";}class kn implements jD{get type=>k.Xd;final hD l;final String zI;final String prefix;kn(this.l,this.zI,this.prefix);String toString()=>"TAG_DIRECTIVE ${zI} ${prefix}";}class Ud implements jD{get type=>k.mLB;final hD l;final String name;Ud(this.l,this.name);String toString()=>"ANCHOR ${name}";}class ln implements jD{get type=>k.lLB;final hD l;final String name;ln(this.l,this.name);String toString()=>"ALIAS ${name}";}class Vd implements jD{get type=>k.nLB;final hD l;final String zI;final String Ah;Vd(this.l,this.zI,this.Ah);String toString()=>"TAG ${zI} ${Ah}";}class rT implements jD{get type=>k.V4;final hD l;final String value;final PF BB;rT(this.l,this.value,this.BB);String toString()=>"SCALAR ${BB} \"${value}\"";}class k{static const R4=const k.RXB("STREAM_START");static const OX=const k.RXB("STREAM_END");static const Wd=const k.RXB("VERSION_DIRECTIVE");static const Xd=const k.RXB("TAG_DIRECTIVE");static const Yd=const k.RXB("DOCUMENT_START");static const Zd=const k.RXB("DOCUMENT_END");static const S4=const k.RXB("BLOCK_SEQUENCE_START");static const ad=const k.RXB("BLOCK_MAPPING_START");static const QR=const k.RXB("BLOCK_END");static const T4=const k.RXB("FLOW_SEQUENCE_START");static const sT=const k.RXB("FLOW_SEQUENCE_END");static const U4=const k.RXB("FLOW_MAPPING_START");static const tT=const k.RXB("FLOW_MAPPING_END");static const uT=const k.RXB("BLOCK_ENTRY");static const RR=const k.RXB("FLOW_ENTRY");static const LN=const k.RXB("KEY");static const lL=const k.RXB("VALUE");static const lLB=const k.RXB("ALIAS");static const mLB=const k.RXB("ANCHOR");static const nLB=const k.RXB("TAG");static const V4=const k.RXB("SCALAR");final String name;const k.RXB(this.name);String toString()=>name;}class PX<R,MN>{final R first;final MN last;PX(this.first,this.last);String toString()=>'(${first}, ${last})';}void W4(String A,[iD B])=>pLB(A,B);typedef dynamic oLB(String _0,[iD _1]);oLB pLB=(A,[B]){if(B!=null)A=B.message(A);print(A);};String tLB(B){var A=new StringBuffer();uLB(B,A);return A.toString();}void uLB(A,StringSink B){mn(A,0,B,true);}void mn(A,int C,StringSink B,bool D){if(A is Map){wLB(A,C,B,D);}else if(A is Iterable){yLB(A,C,B,D);}else if(A is String){B..writeln('"${vLB(A)}"');}else if(A is double){B.writeln("!!float ${A}");}else{B.writeln(A);}}String vLB(String A)=>A.replaceAll('"',r'\"').replaceAll("\n",r"\n");void wLB(Map C,int B,StringSink A,bool G){if(!G){A.writeln();B+= 2;}final H=xLB(C);H.forEach((D){final I=C[D];a4(B,A);A..write(D)..write(': ');mn(I,B,A,false);});}Iterable<String> xLB(Map H){final B=[] ;final C=[] ;final D=[] ;H.forEach((A,G){if(G is String){B.add(A);}else if(G is Map){C.add(A);}else{D.add(A);}});return IKB([B..sort(),C..sort(),D..sort()]) as Iterable<String>;}void yLB(Iterable C,int B,StringSink A,bool D){if(!D){A.writeln();B+= 2;}C.forEach((G){a4(B,A);A.write('- ');mn(G,B,A,false);});}void a4(int A,StringSink B)=>B.write(' '*A);class vT{final kE DI;final iD l;final QX versionDirective;final List<iJ> Eh;final bool startImplicit;final bool endImplicit;vT.SXB(this.DI,this.l,this.versionDirective,List<iJ> A,{this.startImplicit: false,this.endImplicit: false}):Eh=new UnmodifiableListView(A);String toString()=>DI.toString();}class QX{final int pE;final int cE;QX(this.pE,this.cE);String toString()=>"%YAML ${pE}.${cE}";}class iJ{final String zI;final String prefix;iJ(this.zI,this.prefix);String toString()=>"%TAG ${zI} ${prefix}";}abstract class kE{iD get l=>bpB;iD bpB;get value;}class X4 extends kE with MapMixin,ZAB{final Map<dynamic,kE> m;final kI BB;Map get value=>this;Iterable get keys=>m.keys.map((A)=>A.value);X4.TXB(Map<dynamic,kE> A,iD B,this.BB):m=new UnmodifiableMapView<dynamic,kE>(A){bpB=B;}operator[](B){var A=m[B];return A==null?null:A.value;}}class Y4 extends kE with ListMixin{final List<kE> m;final kI BB;List get value=>this;int get length=>m.length;set length(int A){throw new UnsupportedError("Cannot modify an unmodifiable List");}Y4.UXB(List<kE> A,iD B,this.BB):m=new UnmodifiableListView<kE>(A){bpB=B;}operator[](int A)=>m[A].value;operator[]=(int A,B){throw new UnsupportedError("Cannot modify an unmodifiable List");}}class AF extends kE{final value;final PF BB;AF.VXB(this.value,hJ A):BB=A.BB{bpB=A.l;}AF.WXB(this.value,iD A):BB=PF.iLB{bpB=A;}String toString()=>value.toString();}void Z4(kE A,iD B){A.bpB=B;}